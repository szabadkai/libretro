var z9=Object.defineProperty;var lI=n=>{throw TypeError(n)};var K9=(n,e,t)=>e in n?z9(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var v=(n,e,t)=>K9(n,typeof e!="symbol"?e+"":e,t),S0=(n,e,t)=>e.has(n)||lI("Cannot "+t);var q=(n,e,t)=>(S0(n,e,"read from private field"),t?t.call(n):e.get(n)),Qe=(n,e,t)=>e.has(n)?lI("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(n):e.set(n,t),qe=(n,e,t,r)=>(S0(n,e,"write to private field"),r?r.call(n,t):e.set(n,t),t),Pe=(n,e,t)=>(S0(n,e,"access private method"),t);var Gi=(n,e,t,r)=>({set _(i){qe(n,e,i,t)},get _(){return q(n,e,r)}});function V9(n,e){for(var t=0;t<e.length;t++){const r=e[t];if(typeof r!="string"&&!Array.isArray(r)){for(const i in r)if(i!=="default"&&!(i in n)){const s=Object.getOwnPropertyDescriptor(r,i);s&&Object.defineProperty(n,i,s.get?s:{enumerable:!0,get:()=>r[i]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Kp=globalThis,BE=Kp.ShadowRoot&&(Kp.ShadyCSS===void 0||Kp.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,UE=Symbol(),cI=new WeakMap;let fO=class{constructor(e,t,r){if(this._$cssResult$=!0,r!==UE)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=e,this.t=t}get styleSheet(){let e=this.o;const t=this.t;if(BE&&e===void 0){const r=t!==void 0&&t.length===1;r&&(e=cI.get(t)),e===void 0&&((this.o=e=new CSSStyleSheet).replaceSync(this.cssText),r&&cI.set(t,e))}return e}toString(){return this.cssText}};const G9=n=>new fO(typeof n=="string"?n:n+"",void 0,UE),by=(n,...e)=>{const t=n.length===1?n[0]:e.reduce((r,i,s)=>r+(o=>{if(o._$cssResult$===!0)return o.cssText;if(typeof o=="number")return o;throw Error("Value passed to 'css' function must be a 'css' function result: "+o+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(i)+n[s+1],n[0]);return new fO(t,n,UE)},Y9=(n,e)=>{if(BE)n.adoptedStyleSheets=e.map(t=>t instanceof CSSStyleSheet?t:t.styleSheet);else for(const t of e){const r=document.createElement("style"),i=Kp.litNonce;i!==void 0&&r.setAttribute("nonce",i),r.textContent=t.cssText,n.appendChild(r)}},uI=BE?n=>n:n=>n instanceof CSSStyleSheet?(e=>{let t="";for(const r of e.cssRules)t+=r.cssText;return G9(t)})(n):n;/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const{is:X9,defineProperty:Z9,getOwnPropertyDescriptor:Q9,getOwnPropertyNames:J9,getOwnPropertySymbols:e7,getPrototypeOf:t7}=Object,ma=globalThis,hI=ma.trustedTypes,r7=hI?hI.emptyScript:"",A0=ma.reactiveElementPolyfillSupport,Uh=(n,e)=>n,qg={toAttribute(n,e){switch(e){case Boolean:n=n?r7:null;break;case Object:case Array:n=n==null?n:JSON.stringify(n)}return n},fromAttribute(n,e){let t=n;switch(e){case Boolean:t=n!==null;break;case Number:t=n===null?null:Number(n);break;case Object:case Array:try{t=JSON.parse(n)}catch{t=null}}return t}},FE=(n,e)=>!X9(n,e),fI={attribute:!0,type:String,converter:qg,reflect:!1,useDefault:!1,hasChanged:FE};Symbol.metadata??(Symbol.metadata=Symbol("metadata")),ma.litPropertyMetadata??(ma.litPropertyMetadata=new WeakMap);let $c=class extends HTMLElement{static addInitializer(e){this._$Ei(),(this.l??(this.l=[])).push(e)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(e,t=fI){if(t.state&&(t.attribute=!1),this._$Ei(),this.prototype.hasOwnProperty(e)&&((t=Object.create(t)).wrapped=!0),this.elementProperties.set(e,t),!t.noAccessor){const r=Symbol(),i=this.getPropertyDescriptor(e,r,t);i!==void 0&&Z9(this.prototype,e,i)}}static getPropertyDescriptor(e,t,r){const{get:i,set:s}=Q9(this.prototype,e)??{get(){return this[t]},set(o){this[t]=o}};return{get:i,set(o){const a=i==null?void 0:i.call(this);s==null||s.call(this,o),this.requestUpdate(e,a,r)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){return this.elementProperties.get(e)??fI}static _$Ei(){if(this.hasOwnProperty(Uh("elementProperties")))return;const e=t7(this);e.finalize(),e.l!==void 0&&(this.l=[...e.l]),this.elementProperties=new Map(e.elementProperties)}static finalize(){if(this.hasOwnProperty(Uh("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(Uh("properties"))){const t=this.properties,r=[...J9(t),...e7(t)];for(const i of r)this.createProperty(i,t[i])}const e=this[Symbol.metadata];if(e!==null){const t=litPropertyMetadata.get(e);if(t!==void 0)for(const[r,i]of t)this.elementProperties.set(r,i)}this._$Eh=new Map;for(const[t,r]of this.elementProperties){const i=this._$Eu(t,r);i!==void 0&&this._$Eh.set(i,t)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(e){const t=[];if(Array.isArray(e)){const r=new Set(e.flat(1/0).reverse());for(const i of r)t.unshift(uI(i))}else e!==void 0&&t.push(uI(e));return t}static _$Eu(e,t){const r=t.attribute;return r===!1?void 0:typeof r=="string"?r:typeof e=="string"?e.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){var e;this._$ES=new Promise(t=>this.enableUpdating=t),this._$AL=new Map,this._$E_(),this.requestUpdate(),(e=this.constructor.l)==null||e.forEach(t=>t(this))}addController(e){var t;(this._$EO??(this._$EO=new Set)).add(e),this.renderRoot!==void 0&&this.isConnected&&((t=e.hostConnected)==null||t.call(e))}removeController(e){var t;(t=this._$EO)==null||t.delete(e)}_$E_(){const e=new Map,t=this.constructor.elementProperties;for(const r of t.keys())this.hasOwnProperty(r)&&(e.set(r,this[r]),delete this[r]);e.size>0&&(this._$Ep=e)}createRenderRoot(){const e=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return Y9(e,this.constructor.elementStyles),e}connectedCallback(){var e;this.renderRoot??(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),(e=this._$EO)==null||e.forEach(t=>{var r;return(r=t.hostConnected)==null?void 0:r.call(t)})}enableUpdating(e){}disconnectedCallback(){var e;(e=this._$EO)==null||e.forEach(t=>{var r;return(r=t.hostDisconnected)==null?void 0:r.call(t)})}attributeChangedCallback(e,t,r){this._$AK(e,r)}_$ET(e,t){var s;const r=this.constructor.elementProperties.get(e),i=this.constructor._$Eu(e,r);if(i!==void 0&&r.reflect===!0){const o=(((s=r.converter)==null?void 0:s.toAttribute)!==void 0?r.converter:qg).toAttribute(t,r.type);this._$Em=e,o==null?this.removeAttribute(i):this.setAttribute(i,o),this._$Em=null}}_$AK(e,t){var s,o;const r=this.constructor,i=r._$Eh.get(e);if(i!==void 0&&this._$Em!==i){const a=r.getPropertyOptions(i),l=typeof a.converter=="function"?{fromAttribute:a.converter}:((s=a.converter)==null?void 0:s.fromAttribute)!==void 0?a.converter:qg;this._$Em=i;const c=l.fromAttribute(t,a.type);this[i]=c??((o=this._$Ej)==null?void 0:o.get(i))??c,this._$Em=null}}requestUpdate(e,t,r){var i;if(e!==void 0){const s=this.constructor,o=this[e];if(r??(r=s.getPropertyOptions(e)),!((r.hasChanged??FE)(o,t)||r.useDefault&&r.reflect&&o===((i=this._$Ej)==null?void 0:i.get(e))&&!this.hasAttribute(s._$Eu(e,r))))return;this.C(e,t,r)}this.isUpdatePending===!1&&(this._$ES=this._$EP())}C(e,t,{useDefault:r,reflect:i,wrapped:s},o){r&&!(this._$Ej??(this._$Ej=new Map)).has(e)&&(this._$Ej.set(e,o??t??this[e]),s!==!0||o!==void 0)||(this._$AL.has(e)||(this.hasUpdated||r||(t=void 0),this._$AL.set(e,t)),i===!0&&this._$Em!==e&&(this._$Eq??(this._$Eq=new Set)).add(e))}async _$EP(){this.isUpdatePending=!0;try{await this._$ES}catch(t){Promise.reject(t)}const e=this.scheduleUpdate();return e!=null&&await e,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){var r;if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??(this.renderRoot=this.createRenderRoot()),this._$Ep){for(const[s,o]of this._$Ep)this[s]=o;this._$Ep=void 0}const i=this.constructor.elementProperties;if(i.size>0)for(const[s,o]of i){const{wrapped:a}=o,l=this[s];a!==!0||this._$AL.has(s)||l===void 0||this.C(s,void 0,o,l)}}let e=!1;const t=this._$AL;try{e=this.shouldUpdate(t),e?(this.willUpdate(t),(r=this._$EO)==null||r.forEach(i=>{var s;return(s=i.hostUpdate)==null?void 0:s.call(i)}),this.update(t)):this._$EM()}catch(i){throw e=!1,this._$EM(),i}e&&this._$AE(t)}willUpdate(e){}_$AE(e){var t;(t=this._$EO)==null||t.forEach(r=>{var i;return(i=r.hostUpdated)==null?void 0:i.call(r)}),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(e)),this.updated(e)}_$EM(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(e){return!0}update(e){this._$Eq&&(this._$Eq=this._$Eq.forEach(t=>this._$ET(t,this[t]))),this._$EM()}updated(e){}firstUpdated(e){}};$c.elementStyles=[],$c.shadowRootOptions={mode:"open"},$c[Uh("elementProperties")]=new Map,$c[Uh("finalized")]=new Map,A0==null||A0({ReactiveElement:$c}),(ma.reactiveElementVersions??(ma.reactiveElementVersions=[])).push("2.1.1");/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Fh=globalThis,Hg=Fh.trustedTypes,dI=Hg?Hg.createPolicy("lit-html",{createHTML:n=>n}):void 0,dO="$lit$",sa=`lit$${Math.random().toFixed(9).slice(2)}$`,pO="?"+sa,n7=`<${pO}>`,Ol=document,rf=()=>Ol.createComment(""),nf=n=>n===null||typeof n!="object"&&typeof n!="function",jE=Array.isArray,i7=n=>jE(n)||typeof(n==null?void 0:n[Symbol.iterator])=="function",x0=`[ 	
\f\r]`,ph=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,pI=/-->/g,gI=/>/g,Ua=RegExp(`>|${x0}(?:([^\\s"'>=/]+)(${x0}*=${x0}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),mI=/'/g,yI=/"/g,gO=/^(?:script|style|textarea|title)$/i,s7=n=>(e,...t)=>({_$litType$:n,strings:e,values:t}),or=s7(1),_a=Symbol.for("lit-noChange"),jr=Symbol.for("lit-nothing"),bI=new WeakMap,nl=Ol.createTreeWalker(Ol,129);function mO(n,e){if(!jE(n)||!n.hasOwnProperty("raw"))throw Error("invalid template strings array");return dI!==void 0?dI.createHTML(e):e}const o7=(n,e)=>{const t=n.length-1,r=[];let i,s=e===2?"<svg>":e===3?"<math>":"",o=ph;for(let a=0;a<t;a++){const l=n[a];let c,h,d=-1,p=0;for(;p<l.length&&(o.lastIndex=p,h=o.exec(l),h!==null);)p=o.lastIndex,o===ph?h[1]==="!--"?o=pI:h[1]!==void 0?o=gI:h[2]!==void 0?(gO.test(h[2])&&(i=RegExp("</"+h[2],"g")),o=Ua):h[3]!==void 0&&(o=Ua):o===Ua?h[0]===">"?(o=i??ph,d=-1):h[1]===void 0?d=-2:(d=o.lastIndex-h[2].length,c=h[1],o=h[3]===void 0?Ua:h[3]==='"'?yI:mI):o===yI||o===mI?o=Ua:o===pI||o===gI?o=ph:(o=Ua,i=void 0);const g=o===Ua&&n[a+1].startsWith("/>")?" ":"";s+=o===ph?l+n7:d>=0?(r.push(c),l.slice(0,d)+dO+l.slice(d)+sa+g):l+sa+(d===-2?a:g)}return[mO(n,s+(n[t]||"<?>")+(e===2?"</svg>":e===3?"</math>":"")),r]};class sf{constructor({strings:e,_$litType$:t},r){let i;this.parts=[];let s=0,o=0;const a=e.length-1,l=this.parts,[c,h]=o7(e,t);if(this.el=sf.createElement(c,r),nl.currentNode=this.el.content,t===2||t===3){const d=this.el.content.firstChild;d.replaceWith(...d.childNodes)}for(;(i=nl.nextNode())!==null&&l.length<a;){if(i.nodeType===1){if(i.hasAttributes())for(const d of i.getAttributeNames())if(d.endsWith(dO)){const p=h[o++],g=i.getAttribute(d).split(sa),m=/([.?@])?(.*)/.exec(p);l.push({type:1,index:s,name:m[2],strings:g,ctor:m[1]==="."?l7:m[1]==="?"?c7:m[1]==="@"?u7:wy}),i.removeAttribute(d)}else d.startsWith(sa)&&(l.push({type:6,index:s}),i.removeAttribute(d));if(gO.test(i.tagName)){const d=i.textContent.split(sa),p=d.length-1;if(p>0){i.textContent=Hg?Hg.emptyScript:"";for(let g=0;g<p;g++)i.append(d[g],rf()),nl.nextNode(),l.push({type:2,index:++s});i.append(d[p],rf())}}}else if(i.nodeType===8)if(i.data===pO)l.push({type:2,index:s});else{let d=-1;for(;(d=i.data.indexOf(sa,d+1))!==-1;)l.push({type:7,index:s}),d+=sa.length-1}s++}}static createElement(e,t){const r=Ol.createElement("template");return r.innerHTML=e,r}}function du(n,e,t=n,r){var o,a;if(e===_a)return e;let i=r!==void 0?(o=t._$Co)==null?void 0:o[r]:t._$Cl;const s=nf(e)?void 0:e._$litDirective$;return(i==null?void 0:i.constructor)!==s&&((a=i==null?void 0:i._$AO)==null||a.call(i,!1),s===void 0?i=void 0:(i=new s(n),i._$AT(n,t,r)),r!==void 0?(t._$Co??(t._$Co=[]))[r]=i:t._$Cl=i),i!==void 0&&(e=du(n,i._$AS(n,e.values),i,r)),e}let a7=class{constructor(e,t){this._$AV=[],this._$AN=void 0,this._$AD=e,this._$AM=t}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(e){const{el:{content:t},parts:r}=this._$AD,i=((e==null?void 0:e.creationScope)??Ol).importNode(t,!0);nl.currentNode=i;let s=nl.nextNode(),o=0,a=0,l=r[0];for(;l!==void 0;){if(o===l.index){let c;l.type===2?c=new jf(s,s.nextSibling,this,e):l.type===1?c=new l.ctor(s,l.name,l.strings,this,e):l.type===6&&(c=new h7(s,this,e)),this._$AV.push(c),l=r[++a]}o!==(l==null?void 0:l.index)&&(s=nl.nextNode(),o++)}return nl.currentNode=Ol,i}p(e){let t=0;for(const r of this._$AV)r!==void 0&&(r.strings!==void 0?(r._$AI(e,r,t),t+=r.strings.length-2):r._$AI(e[t])),t++}};class jf{get _$AU(){var e;return((e=this._$AM)==null?void 0:e._$AU)??this._$Cv}constructor(e,t,r,i){this.type=2,this._$AH=jr,this._$AN=void 0,this._$AA=e,this._$AB=t,this._$AM=r,this.options=i,this._$Cv=(i==null?void 0:i.isConnected)??!0}get parentNode(){let e=this._$AA.parentNode;const t=this._$AM;return t!==void 0&&(e==null?void 0:e.nodeType)===11&&(e=t.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,t=this){e=du(this,e,t),nf(e)?e===jr||e==null||e===""?(this._$AH!==jr&&this._$AR(),this._$AH=jr):e!==this._$AH&&e!==_a&&this._(e):e._$litType$!==void 0?this.$(e):e.nodeType!==void 0?this.T(e):i7(e)?this.k(e):this._(e)}O(e){return this._$AA.parentNode.insertBefore(e,this._$AB)}T(e){this._$AH!==e&&(this._$AR(),this._$AH=this.O(e))}_(e){this._$AH!==jr&&nf(this._$AH)?this._$AA.nextSibling.data=e:this.T(Ol.createTextNode(e)),this._$AH=e}$(e){var s;const{values:t,_$litType$:r}=e,i=typeof r=="number"?this._$AC(e):(r.el===void 0&&(r.el=sf.createElement(mO(r.h,r.h[0]),this.options)),r);if(((s=this._$AH)==null?void 0:s._$AD)===i)this._$AH.p(t);else{const o=new a7(i,this),a=o.u(this.options);o.p(t),this.T(a),this._$AH=o}}_$AC(e){let t=bI.get(e.strings);return t===void 0&&bI.set(e.strings,t=new sf(e)),t}k(e){jE(this._$AH)||(this._$AH=[],this._$AR());const t=this._$AH;let r,i=0;for(const s of e)i===t.length?t.push(r=new jf(this.O(rf()),this.O(rf()),this,this.options)):r=t[i],r._$AI(s),i++;i<t.length&&(this._$AR(r&&r._$AB.nextSibling,i),t.length=i)}_$AR(e=this._$AA.nextSibling,t){var r;for((r=this._$AP)==null?void 0:r.call(this,!1,!0,t);e!==this._$AB;){const i=e.nextSibling;e.remove(),e=i}}setConnected(e){var t;this._$AM===void 0&&(this._$Cv=e,(t=this._$AP)==null||t.call(this,e))}}class wy{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(e,t,r,i,s){this.type=1,this._$AH=jr,this._$AN=void 0,this.element=e,this.name=t,this._$AM=i,this.options=s,r.length>2||r[0]!==""||r[1]!==""?(this._$AH=Array(r.length-1).fill(new String),this.strings=r):this._$AH=jr}_$AI(e,t=this,r,i){const s=this.strings;let o=!1;if(s===void 0)e=du(this,e,t,0),o=!nf(e)||e!==this._$AH&&e!==_a,o&&(this._$AH=e);else{const a=e;let l,c;for(e=s[0],l=0;l<s.length-1;l++)c=du(this,a[r+l],t,l),c===_a&&(c=this._$AH[l]),o||(o=!nf(c)||c!==this._$AH[l]),c===jr?e=jr:e!==jr&&(e+=(c??"")+s[l+1]),this._$AH[l]=c}o&&!i&&this.j(e)}j(e){e===jr?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,e??"")}}class l7 extends wy{constructor(){super(...arguments),this.type=3}j(e){this.element[this.name]=e===jr?void 0:e}}let c7=class extends wy{constructor(){super(...arguments),this.type=4}j(e){this.element.toggleAttribute(this.name,!!e&&e!==jr)}};class u7 extends wy{constructor(e,t,r,i,s){super(e,t,r,i,s),this.type=5}_$AI(e,t=this){if((e=du(this,e,t,0)??jr)===_a)return;const r=this._$AH,i=e===jr&&r!==jr||e.capture!==r.capture||e.once!==r.once||e.passive!==r.passive,s=e!==jr&&(r===jr||i);i&&this.element.removeEventListener(this.name,this,r),s&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){var t;typeof this._$AH=="function"?this._$AH.call(((t=this.options)==null?void 0:t.host)??this.element,e):this._$AH.handleEvent(e)}}class h7{constructor(e,t,r){this.element=e,this.type=6,this._$AN=void 0,this._$AM=t,this.options=r}get _$AU(){return this._$AM._$AU}_$AI(e){du(this,e)}}const I0=Fh.litHtmlPolyfillSupport;I0==null||I0(sf,jf),(Fh.litHtmlVersions??(Fh.litHtmlVersions=[])).push("3.3.1");const f7=(n,e,t)=>{const r=(t==null?void 0:t.renderBefore)??e;let i=r._$litPart$;if(i===void 0){const s=(t==null?void 0:t.renderBefore)??null;r._$litPart$=i=new jf(e.insertBefore(rf(),s),s,void 0,t??{})}return i._$AI(n),i};/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const _l=globalThis;let ya=class extends $c{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){var t;const e=super.createRenderRoot();return(t=this.renderOptions).renderBefore??(t.renderBefore=e.firstChild),e}update(e){const t=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(e),this._$Do=f7(t,this.renderRoot,this.renderOptions)}connectedCallback(){var e;super.connectedCallback(),(e=this._$Do)==null||e.setConnected(!0)}disconnectedCallback(){var e;super.disconnectedCallback(),(e=this._$Do)==null||e.setConnected(!1)}render(){return _a}};var IR;ya._$litElement$=!0,ya.finalized=!0,(IR=_l.litElementHydrateSupport)==null||IR.call(_l,{LitElement:ya});const T0=_l.litElementPolyfillSupport;T0==null||T0({LitElement:ya});(_l.litElementVersions??(_l.litElementVersions=[])).push("4.2.1");/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const vy=n=>(e,t)=>{t!==void 0?t.addInitializer(()=>{customElements.define(n,e)}):customElements.define(n,e)};/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const d7={attribute:!0,type:String,converter:qg,reflect:!1,hasChanged:FE},p7=(n=d7,e,t)=>{const{kind:r,metadata:i}=t;let s=globalThis.litPropertyMetadata.get(i);if(s===void 0&&globalThis.litPropertyMetadata.set(i,s=new Map),r==="setter"&&((n=Object.create(n)).wrapped=!0),s.set(t.name,n),r==="accessor"){const{name:o}=t;return{set(a){const l=e.get.call(this);e.set.call(this,a),this.requestUpdate(o,l,n)},init(a){return a!==void 0&&this.C(o,void 0,n,a),a}}}if(r==="setter"){const{name:o}=t;return function(a){const l=this[o];e.call(this,a),this.requestUpdate(o,l,n)}}throw Error("Unsupported decorator location: "+r)};function Ai(n){return(e,t)=>typeof t=="object"?p7(n,e,t):((r,i,s)=>{const o=i.hasOwnProperty(s);return i.constructor.createProperty(s,r),o?Object.getOwnPropertyDescriptor(i,s):void 0})(n,e,t)}/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function Vt(n){return Ai({...n,state:!0,attribute:!1})}/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const g7=(n,e,t)=>(t.configurable=!0,t.enumerable=!0,Reflect.decorate&&typeof e!="object"&&Object.defineProperty(n,e,t),t);/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function _y(n,e){return(t,r,i)=>{const s=o=>{var a;return((a=o.renderRoot)==null?void 0:a.querySelector(n))??null};return g7(t,r,{get(){return s(this)}})}}const on=[];for(let n=0;n<256;++n)on.push((n+256).toString(16).slice(1));function m7(n,e=0){return(on[n[e+0]]+on[n[e+1]]+on[n[e+2]]+on[n[e+3]]+"-"+on[n[e+4]]+on[n[e+5]]+"-"+on[n[e+6]]+on[n[e+7]]+"-"+on[n[e+8]]+on[n[e+9]]+"-"+on[n[e+10]]+on[n[e+11]]+on[n[e+12]]+on[n[e+13]]+on[n[e+14]]+on[n[e+15]]).toLowerCase()}let C0;const y7=new Uint8Array(16);function b7(){if(!C0){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");C0=crypto.getRandomValues.bind(crypto)}return C0(y7)}const w7=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),wI={randomUUID:w7};function v7(n,e,t){var i;n=n||{};const r=n.random??((i=n.rng)==null?void 0:i.call(n))??b7();if(r.length<16)throw new Error("Random bytes length must be >= 16");return r[6]=r[6]&15|64,r[8]=r[8]&63|128,m7(r)}function El(n,e,t){return wI.randomUUID&&!n?wI.randomUUID():v7(n)}const{floor:_7,random:E7}=Math,pu="Trystero",of=(n,e)=>Array(n).fill().map(e),vI="0123456789AaBbCcDdEeFfGgHhIiJjKkLlMmNnOoPpQqRrSsTtUuVvWwXxYyZz",yO=n=>of(n,()=>vI[_7(E7()*vI.length)]).join(""),bi=yO(20),oa=Promise.all.bind(Promise),bO=typeof window<"u",{entries:fv,fromEntries:wO,keys:S7}=Object,Js=()=>{},eo=n=>new Error(`${pu}: ${n}`),A7=new TextEncoder,x7=new TextDecoder,Sl=n=>A7.encode(n),jh=n=>x7.decode(n),Xd=(...n)=>n.join("@"),vO=(n,e,t,r)=>(n.relayUrls||e).slice(0,n.relayUrls?n.relayUrls.length:n.relayRedundancy||t),Ll=JSON.stringify,af=JSON.parse,_I=3333,bc={};let qh=null,Hh=null;const I7=()=>{qh||(qh=new Promise(n=>{Hh=n}).finally(()=>{Hh=null,qh=null}))},T7=()=>Hh==null?void 0:Hh(),C7=(n,e)=>{const t={},r=()=>{const i=new WebSocket(n);i.onclose=()=>{if(qh){qh.then(r);return}bc[n]??(bc[n]=_I),setTimeout(r,bc[n]),bc[n]*=2},i.onmessage=s=>e(s.data),t.socket=i,t.url=i.url,t.ready=new Promise(s=>i.onopen=()=>{s(t),bc[n]=_I}),t.send=s=>{i.readyState===1&&i.send(s)}};return r(),t},k7=()=>{if(bO){const n=new AbortController;return addEventListener("online",T7,{signal:n.signal}),addEventListener("offline",I7,{signal:n.signal}),()=>n.abort()}return Js},qE="AES-GCM",k0={},P7=n=>btoa(String.fromCharCode.apply(null,new Uint8Array(n))),R7=n=>{const e=atob(n);return new Uint8Array(e.length).map((t,r)=>e.charCodeAt(r)).buffer},O7=async(n,e)=>new Uint8Array(await crypto.subtle.digest(n,Sl(e))),Ah=async n=>k0[n]||(k0[n]=Array.from(await O7("SHA-1",n)).map(e=>e.toString(36)).join("")),L7=async(n,e,t)=>crypto.subtle.importKey("raw",await crypto.subtle.digest({name:"SHA-256"},Sl(`${n}:${e}:${t}`)),{name:qE},!1,["encrypt","decrypt"]),_O="$",EO=",",N7=async(n,e)=>{const t=crypto.getRandomValues(new Uint8Array(16));return t.join(EO)+_O+P7(await crypto.subtle.encrypt({name:qE,iv:t},await n,Sl(e)))},D7=async(n,e)=>{const[t,r]=e.split(_O);return jh(await crypto.subtle.decrypt({name:qE,iv:new Uint8Array(t.split(EO))},await n,R7(r)))},$7=5e3,EI="icegatheringstatechange",SI="offer",M7="answer",AI=(n,{rtcConfig:e,rtcPolyfill:t,turnConfig:r})=>{const i=new(t||RTCPeerConnection)({iceServers:B7.concat(r||[]),...e}),s={};let o=!1,a=!1,l=null;const c=d=>{d.binaryType="arraybuffer",d.bufferedAmountLowThreshold=65535,d.onmessage=p=>{var g;return(g=s.data)==null?void 0:g.call(s,p.data)},d.onopen=()=>{var p;return(p=s.connect)==null?void 0:p.call(s)},d.onclose=()=>{var p;return(p=s.close)==null?void 0:p.call(s)},d.onerror=p=>{var g;return(g=s.error)==null?void 0:g.call(s,p)}},h=d=>Promise.race([new Promise(p=>{const g=()=>{d.iceGatheringState==="complete"&&(d.removeEventListener(EI,g),p())};d.addEventListener(EI,g),g()}),new Promise(p=>setTimeout(p,$7))]).then(()=>({type:d.localDescription.type,sdp:d.localDescription.sdp.replace(/a=ice-options:trickle\s\n/g,"")}));return n?(l=i.createDataChannel("data"),c(l)):i.ondatachannel=({channel:d})=>{l=d,c(d)},i.onnegotiationneeded=async()=>{var d,p;try{o=!0,await i.setLocalDescription();const g=await h(i);(d=s.signal)==null||d.call(s,g)}catch(g){(p=s.error)==null||p.call(s,g)}finally{o=!1}},i.onconnectionstatechange=()=>{var d;["disconnected","failed","closed"].includes(i.connectionState)&&((d=s.close)==null||d.call(s))},i.ontrack=d=>{var p,g;(p=s.track)==null||p.call(s,d.track,d.streams[0]),(g=s.stream)==null||g.call(s,d.streams[0])},i.onremovestream=d=>{var p;return(p=s.stream)==null?void 0:p.call(s,d.stream)},n&&(i.canTrickleIceCandidates||i.onnegotiationneeded()),{created:Date.now(),connection:i,get channel(){return l},get isDead(){return i.connectionState==="closed"},async signal(d){var p,g,m;if(!((l==null?void 0:l.readyState)==="open"&&!((p=d.sdp)!=null&&p.includes("a=rtpmap"))))try{if(d.type===SI){if(o||i.signalingState!=="stable"&&!a){if(n)return;await oa([i.setLocalDescription({type:"rollback"}),i.setRemoteDescription(d)])}else await i.setRemoteDescription(d);await i.setLocalDescription();const E=await h(i);return(g=s.signal)==null||g.call(s,E),E}else if(d.type===M7){a=!0;try{await i.setRemoteDescription(d)}finally{a=!1}}}catch(E){(m=s.error)==null||m.call(s,E)}},sendData:d=>l.send(d),destroy:()=>{l==null||l.close(),i.close(),o=!1,a=!1},setHandlers:d=>Object.assign(s,d),offerPromise:n?new Promise(d=>s.signal=p=>{p.type===SI&&d(p)}):Promise.resolve(),addStream:d=>d.getTracks().forEach(p=>i.addTrack(p,d)),removeStream:d=>i.getSenders().filter(p=>d.getTracks().includes(p.track)).forEach(p=>i.removeTrack(p)),addTrack:(d,p)=>i.addTrack(d,p),removeTrack:d=>{const p=i.getSenders().find(g=>g.track===d);p&&i.removeTrack(p)},replaceTrack:(d,p)=>{const g=i.getSenders().find(m=>m.track===d);if(g)return g.replaceTrack(p)}}},B7=[...of(3,(n,e)=>`stun:stun${e||""}.l.google.com:19302`),"stun:stun.cloudflare.com:3478"].map(n=>({urls:n})),U7=Object.getPrototypeOf(Uint8Array),Vp=12,SO=0,Gp=SO+Vp,Yp=Gp+1,xh=Yp+1,Ih=xh+1,Fa=16*2**10-Ih,Zd=255,xI="bufferedamountlow",wc=n=>"@_"+n,F7=(n,e,t)=>{const r={},i={},s={},o={},a={},l={},c={},h={onPeerJoin:Js,onPeerLeave:Js,onPeerStream:Js,onPeerTrack:Js},d=(C,B)=>(C?Array.isArray(C)?C:[C]:S7(r)).flatMap(N=>{const L=r[N];return L?B(N,L):(console.warn(`${pu}: no peer with id ${N} found`),[])}),p=C=>{r[C]&&(r[C].destroy(),delete r[C],delete o[C],delete a[C],h.onPeerLeave(C),e(C))},g=C=>{if(i[C])return s[C];if(!C)throw eo("action type argument is required");const B=Sl(C);if(B.byteLength>Vp)throw eo(`action type string "${C}" (${B.byteLength}b) exceeds byte limit (${Vp}). Hint: choose a shorter name.`);const N=new Uint8Array(Vp);N.set(B);let L=0;return i[C]={onComplete:Js,onProgress:Js,setOnComplete:V=>i[C]={...i[C],onComplete:V},setOnProgress:V=>i[C]={...i[C],onProgress:V},send:async(V,W,H,G)=>{if(H&&typeof H!="object")throw eo("action meta argument must be an object");const z=typeof V;if(z==="undefined")throw eo("action data cannot be undefined");const Z=z!=="string",F=V instanceof Blob,ie=F||V instanceof ArrayBuffer||V instanceof U7;if(H&&!ie)throw eo("action meta argument can only be used with binary data");const fe=ie?new Uint8Array(F?await V.arrayBuffer():V):Sl(Z?Ll(V):V),J=H?Sl(Ll(H)):null,_e=Math.ceil(fe.byteLength/Fa)+(H?1:0)||1,oe=of(_e,(ne,de)=>{const k=de===_e-1,X=H&&de===0,ee=new Uint8Array(Ih+(X?J.byteLength:k?fe.byteLength-Fa*(_e-(H?2:1)):Fa));return ee.set(N),ee.set([L],Gp),ee.set([k|X<<1|ie<<2|Z<<3],Yp),ee.set([Math.round((de+1)/_e*Zd)],xh),ee.set(H?X?J:fe.subarray((de-1)*Fa,de*Fa):fe.subarray(de*Fa,(de+1)*Fa),Ih),ee});return L=L+1&Zd,oa(d(W,async(ne,de)=>{const{channel:k}=de;let X=0;for(;X<_e;){const ee=oe[X];if(k.bufferedAmount>k.bufferedAmountLowThreshold&&await new Promise(me=>{const be=()=>{k.removeEventListener(xI,be),me()};k.addEventListener(xI,be)}),!r[ne])break;de.sendData(ee),X++,G==null||G(ee[xh]/Zd,ne,H)}}))}},s[C]||(s[C]=[i[C].send,i[C].setOnComplete,i[C].setOnProgress])},m=(C,B)=>{var _e,oe;const N=new Uint8Array(B),L=jh(N.subarray(SO,Gp)).replaceAll("\0",""),[V]=N.subarray(Gp,Yp),[W]=N.subarray(Yp,xh),[H]=N.subarray(xh,Ih),G=N.subarray(Ih),z=!!(W&1),Z=!!(W&2),F=!!(W&4),ie=!!(W&8);if(!i[L]){console.warn(`${pu}: received message with unregistered type (${L})`);return}o[C]||(o[C]={}),(_e=o[C])[L]||(_e[L]={});const fe=(oe=o[C][L])[V]||(oe[V]={chunks:[]});if(Z?fe.meta=af(jh(G)):fe.chunks.push(G),i[L].onProgress(H/Zd,C,fe.meta),!z)return;const J=new Uint8Array(fe.chunks.reduce((ne,de)=>ne+de.byteLength,0));if(fe.chunks.reduce((ne,de)=>(J.set(de,ne),ne+de.byteLength),0),delete o[C][L][V],F)i[L].onComplete(J,C,fe.meta);else{const ne=jh(J);i[L].onComplete(ie?af(ne):ne,C)}},E=async()=>{await M(""),await new Promise(C=>setTimeout(C,99)),fv(r).forEach(([C,B])=>{B.destroy(),delete r[C]}),t()},[y,S]=g(wc("ping")),[b,_]=g(wc("pong")),[I,x]=g(wc("signal")),[$,U]=g(wc("stream")),[O,P]=g(wc("track")),[M,K]=g(wc("leave"));return n((C,B)=>{r[B]||(r[B]=C,C.setHandlers({data:N=>m(B,N),stream:N=>{h.onPeerStream(N,B,l[B]),delete l[B]},track:(N,L)=>{h.onPeerTrack(N,L,B,c[B]),delete c[B]},signal:N=>I(N,B),close:()=>p(B),error:N=>{console.error(N),p(B)}}),h.onPeerJoin(B))}),S((C,B)=>b("",B)),_((C,B)=>{var N;(N=a[B])==null||N.call(a),delete a[B]}),x((C,B)=>{var N;return(N=r[B])==null?void 0:N.signal(C)}),U((C,B)=>l[B]=C),P((C,B)=>c[B]=C),K((C,B)=>p(B)),bO&&addEventListener("beforeunload",E),{makeAction:g,leave:E,ping:async C=>{if(!C)throw eo("ping() must be called with target peer ID");const B=Date.now();return y("",C),await new Promise(N=>a[C]=N),Date.now()-B},getPeers:()=>wO(fv(r).map(([C,B])=>[C,B.connection])),addStream:(C,B,N)=>d(B,async(L,V)=>{N&&await $(N,L),V.addStream(C)}),removeStream:(C,B)=>d(B,(N,L)=>L.removeStream(C)),addTrack:(C,B,N,L)=>d(N,async(V,W)=>{L&&await O(L,V),W.addTrack(C,B)}),removeTrack:(C,B)=>d(B,(N,L)=>L.removeTrack(C)),replaceTrack:(C,B,N,L)=>d(N,async(V,W)=>{L&&await O(L,V),W.replaceTrack(C,B)}),onPeerJoin:C=>h.onPeerJoin=C,onPeerLeave:C=>h.onPeerLeave=C,onPeerStream:C=>h.onPeerStream=C,onPeerTrack:C=>h.onPeerTrack=C}},j7=20,q7=5333,II=57333,Ey=({init:n,subscribe:e,announce:t})=>{const r={};let i=!1,s,o,a,l;return(c,h,d)=>{var W;const{appId:p}=c;if((W=r[p])!=null&&W[h])return r[p][h];const g={},m={},E=Xd(pu,p,h),y=Ah(E),S=Ah(Xd(E,bi)),b=L7(c.password||"",p,h),_=H=>async G=>({type:G.type,sdp:await H(b,G.sdp)}),I=_(D7),x=_(N7),$=()=>AI(!0,c),U=(H,G,z)=>{var Z;if(m[G]){m[G]!==H&&H.destroy();return}m[G]=H,V(H,G),(Z=g[G])==null||Z.forEach((F,ie)=>{ie!==z&&F.destroy()}),delete g[G]},O=(H,G)=>{m[G]===H&&delete m[G]},P=(H,G)=>{var Z;if(m[H])return;const z=(Z=g[H])==null?void 0:Z[G];z&&(delete g[H][G],z.destroy())},M=H=>(o.push(...of(H,$)),oa(o.splice(0,H).map(G=>G.offerPromise.then(x).then(z=>({peer:G,offer:z}))))),K=(H,G)=>d==null?void 0:d({error:`incorrect password (${c.password}) when decrypting ${G}`,appId:p,peerId:H,roomId:h}),C=H=>async(G,z,Z)=>{var ne,de,k;const[F,ie]=await oa([y,S]);if(G!==F&&G!==ie)return;const{peerId:fe,offer:J,answer:_e,peer:oe}=typeof z=="string"?af(z):z;if(!(fe===bi||m[fe])){if(fe&&!J&&!_e){if((ne=g[fe])!=null&&ne[H])return;const[[{peer:X,offer:ee}],me]=await oa([M(1),Ah(Xd(E,fe))]);g[fe]||(g[fe]=[]),g[fe][H]=X,setTimeout(()=>P(fe,H),B[H]*.9),X.setHandlers({connect:()=>U(X,fe,H),close:()=>O(X,fe)}),Z(me,Ll({peerId:bi,offer:ee}))}else if(J){if(((de=g[fe])==null?void 0:de[H])&&bi>fe)return;const ee=AI(!1,c);ee.setHandlers({connect:()=>U(ee,fe,H),close:()=>O(ee,fe)});let me;try{me=await I(J)}catch{K(fe,"offer");return}if(ee.isDead)return;const[be,te]=await oa([Ah(Xd(E,fe)),ee.signal(me)]);Z(be,Ll({peerId:bi,answer:await x(te)}))}else if(_e){let X;try{X=await I(_e)}catch{K(fe,"answer");return}if(oe)oe.setHandlers({connect:()=>U(oe,fe,H),close:()=>O(oe,fe)}),oe.signal(X);else{const ee=(k=g[fe])==null?void 0:k[H];ee&&!ee.isDead&&ee.signal(X)}}}};if(!c)throw eo("requires a config map as the first argument");if(!p&&!c.firebaseApp)throw eo("config map is missing appId field");if(!h)throw eo("roomId argument required");if(!i){const H=n(c);o=of(j7,$),s=Array.isArray(H)?H:[H],i=!0,a=setInterval(()=>o=o.filter(G=>{const z=Date.now()-G.created<II;return z||G.destroy(),z}),II*1.03),l=c.manualRelayReconnection?Js:k7()}const B=s.map(()=>q7),N=[],L=s.map(async(H,G)=>e(await H,await y,await S,C(G),M));oa([y,S]).then(([H,G])=>{const z=async(Z,F)=>{const ie=await t(Z,H,G);typeof ie=="number"&&(B[F]=ie),N[F]=setTimeout(()=>z(Z,F),B[F])};L.forEach(async(Z,F)=>{await Z,z(await s[F],F)})});let V=Js;return r[p]||(r[p]={}),r[p][h]=F7(H=>V=H,H=>delete m[H],()=>{delete r[p][h],N.forEach(clearTimeout),L.forEach(async H=>(await H)()),clearInterval(a),l(),i=!1})}},P0={},AO={},ja={},qa={},gh={},TI={},Qd={},H7="announce",xO=20,CI=10,W7=33333,z7=120333,K7=3,V7=async n=>{if(P0[n])return P0[n];const e=(await Ah(n)).slice(0,xO);return P0[n]=e,AO[e]=n,e},kI=async(n,e,t)=>n.send(Ll({action:H7,info_hash:await V7(e),peer_id:bi,...t})),PI=(n,e,t)=>console.warn(`${pu}: torrent tracker ${t?"failure":"warning"} from ${n} - ${e}`),G7=Ey({init:n=>vO(n,Y7,K7).map(e=>{const t=C7(e,i=>{var h,d;const s=af(i),o=s["failure reason"],a=s["warning message"],{interval:l}=s,c=AO[s.info_hash];if(o){PI(r,o,!0);return}if(a&&PI(r,a),l&&l*1e3>gh[r]&&qa[r][c]){const p=Math.min(l*1e3,z7);clearInterval(ja[r][c]),gh[r]=p,ja[r][c]=setInterval(qa[r][c],p)}TI[s.offer_id]||(s.offer||s.answer)&&(TI[s.offer_id]=!0,(d=(h=Qd[r])[c])==null||d.call(h,s))}),{url:r}=t;return Qd[r]={},t.ready}),subscribe:(n,e,t,r,i)=>{const{url:s}=n,o=async()=>{const a=wO((await i(CI)).map(l=>[yO(xO),l]));Qd[n.url][e]=l=>{if(l.offer)r(e,{offer:l.offer,peerId:l.peer_id},(c,h)=>kI(n,e,{answer:af(h).answer,offer_id:l.offer_id,to_peer_id:l.peer_id}));else if(l.answer){const c=a[l.offer_id];c&&r(e,{answer:l.answer,peerId:l.peer_id,peer:c.peer})}},kI(n,e,{numwant:CI,offers:fv(a).map(([l,{offer:c}])=>({offer_id:l,offer:c}))})};return gh[s]=W7,qa[s]||(qa[s]={}),qa[s][e]=o,ja[s]||(ja[s]={}),ja[s][e]=setInterval(o,gh[s]),o(),()=>{clearInterval(ja[s][e]),delete Qd[s][e],delete qa[s][e]}},announce:n=>gh[n.url]}),Y7=["tracker.webtorrent.dev","tracker.openwebtorrent.com","tracker.btorrent.xyz","tracker.files.fm:7073/announce"].map(n=>"wss://"+n);var HE=Object.defineProperty,X7=Object.getOwnPropertyDescriptor,Z7=Object.getOwnPropertyNames,Q7=Object.prototype.hasOwnProperty,ii=(n,e)=>()=>(n&&(e=n(n=0)),e),$e=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports),ju=(n,e)=>{for(var t in e)HE(n,t,{get:e[t],enumerable:!0})},J7=(n,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of Z7(e))!Q7.call(n,i)&&i!==t&&HE(n,i,{get:()=>e[i],enumerable:!(r=X7(e,i))||r.enumerable});return n},nr=n=>J7(HE({},"__esModule",{value:!0}),n),Oe=ii(()=>{}),Ut={};ju(Ut,{_debugEnd:()=>Kv,_debugProcess:()=>zv,_events:()=>a_,_eventsCount:()=>l_,_exiting:()=>Rv,_fatalExceptions:()=>qv,_getActiveHandles:()=>OO,_getActiveRequests:()=>RO,_kill:()=>Nv,_linkedBinding:()=>kO,_maxListeners:()=>o_,_preload_modules:()=>i_,_rawDebug:()=>Cv,_startProfilerIdleNotifier:()=>Vv,_stopProfilerIdleNotifier:()=>Gv,_tickCallback:()=>Wv,abort:()=>Qv,addListener:()=>c_,allowedNodeEnvironmentFlags:()=>Fv,arch:()=>pv,argv:()=>yv,argv0:()=>n_,assert:()=>LO,binding:()=>Ev,browser:()=>Tv,chdir:()=>xv,config:()=>Ov,cpuUsage:()=>Th,cwd:()=>Av,debugPort:()=>r_,default:()=>zE,dlopen:()=>PO,domain:()=>Pv,emit:()=>p_,emitWarning:()=>_v,env:()=>mv,execArgv:()=>bv,execPath:()=>t_,exit:()=>Bv,features:()=>jv,hasUncaughtExceptionCaptureCallback:()=>NO,hrtime:()=>Xp,kill:()=>Mv,listeners:()=>$O,memoryUsage:()=>$v,moduleLoadList:()=>kv,nextTick:()=>TO,off:()=>h_,on:()=>Vs,once:()=>u_,openStdin:()=>Uv,pid:()=>Jv,platform:()=>gv,ppid:()=>e_,prependListener:()=>g_,prependOnceListener:()=>m_,reallyExit:()=>Lv,release:()=>Iv,removeAllListeners:()=>d_,removeListener:()=>f_,resourceUsage:()=>Dv,setSourceMapsEnabled:()=>s_,setUncaughtExceptionCaptureCallback:()=>Hv,stderr:()=>Xv,stdin:()=>Zv,stdout:()=>Yv,title:()=>dv,umask:()=>Sv,uptime:()=>DO,version:()=>wv,versions:()=>vv});function WE(n){throw new Error("Node.js process "+n+" is not supported by JSPM core outside of Node.js")}function ej(){!Al||!il||(Al=!1,il.length?Ss=il.concat(Ss):Wh=-1,Ss.length&&IO())}function IO(){if(!Al){var n=setTimeout(ej,0);Al=!0;for(var e=Ss.length;e;){for(il=Ss,Ss=[];++Wh<e;)il&&il[Wh].run();Wh=-1,e=Ss.length}il=null,Al=!1,clearTimeout(n)}}function TO(n){var e=new Array(arguments.length-1);if(arguments.length>1)for(var t=1;t<arguments.length;t++)e[t-1]=arguments[t];Ss.push(new CO(n,e)),Ss.length===1&&!Al&&setTimeout(IO,0)}function CO(n,e){this.fun=n,this.array=e}function wn(){}function kO(n){WE("_linkedBinding")}function PO(n){WE("dlopen")}function RO(){return[]}function OO(){return[]}function LO(n,e){if(!n)throw new Error(e||"assertion error")}function NO(){return!1}function DO(){return to.now()/1e3}function Xp(n){var e=Math.floor((Date.now()-to.now())*.001),t=to.now()*.001,r=Math.floor(t)+e,i=Math.floor(t%1*1e9);return n&&(r=r-n[0],i=i-n[1],i<0&&(r--,i+=Zp)),[r,i]}function Vs(){return zE}function $O(n){return[]}var Ss,Al,il,Wh,dv,pv,gv,mv,yv,bv,wv,vv,_v,Ev,Sv,Av,xv,Iv,Tv,Cv,kv,Pv,Rv,Ov,Lv,Nv,Th,Dv,$v,Mv,Bv,Uv,Fv,jv,qv,Hv,Wv,zv,Kv,Vv,Gv,Yv,Xv,Zv,Qv,Jv,e_,t_,r_,n_,i_,s_,to,R0,Zp,o_,a_,l_,c_,u_,h_,f_,d_,p_,g_,m_,zE,tj=ii(()=>{Oe(),Ne(),Le(),Ss=[],Al=!1,Wh=-1,CO.prototype.run=function(){this.fun.apply(null,this.array)},dv="browser",pv="x64",gv="browser",mv={PATH:"/usr/bin",LANG:typeof navigator<"u"?navigator.language+".UTF-8":void 0,PWD:"/",HOME:"/home",TMP:"/tmp"},yv=["/usr/bin/node"],bv=[],wv="v16.8.0",vv={},_v=function(n,e){console.warn((e?e+": ":"")+n)},Ev=function(n){WE("binding")},Sv=function(n){return 0},Av=function(){return"/"},xv=function(n){},Iv={name:"node",sourceUrl:"",headersUrl:"",libUrl:""},Tv=!0,Cv=wn,kv=[],Pv={},Rv=!1,Ov={},Lv=wn,Nv=wn,Th=function(){return{}},Dv=Th,$v=Th,Mv=wn,Bv=wn,Uv=wn,Fv={},jv={inspector:!1,debug:!1,uv:!1,ipv6:!1,tls_alpn:!1,tls_sni:!1,tls_ocsp:!1,tls:!1,cached_builtins:!0},qv=wn,Hv=wn,Wv=wn,zv=wn,Kv=wn,Vv=wn,Gv=wn,Yv=void 0,Xv=void 0,Zv=void 0,Qv=wn,Jv=2,e_=1,t_="/bin/usr/node",r_=9229,n_="node",i_=[],s_=wn,to={now:typeof performance<"u"?performance.now.bind(performance):void 0,timing:typeof performance<"u"?performance.timing:void 0},to.now===void 0&&(R0=Date.now(),to.timing&&to.timing.navigationStart&&(R0=to.timing.navigationStart),to.now=()=>Date.now()-R0),Zp=1e9,Xp.bigint=function(n){var e=Xp(n);return typeof BigInt>"u"?e[0]*Zp+e[1]:BigInt(e[0]*Zp)+BigInt(e[1])},o_=10,a_={},l_=0,c_=Vs,u_=Vs,h_=Vs,f_=Vs,d_=Vs,p_=wn,g_=Vs,m_=Vs,zE={version:wv,versions:vv,arch:pv,platform:gv,browser:Tv,release:Iv,_rawDebug:Cv,moduleLoadList:kv,binding:Ev,_linkedBinding:kO,_events:a_,_eventsCount:l_,_maxListeners:o_,on:Vs,addListener:c_,once:u_,off:h_,removeListener:f_,removeAllListeners:d_,emit:p_,prependListener:g_,prependOnceListener:m_,listeners:$O,domain:Pv,_exiting:Rv,config:Ov,dlopen:PO,uptime:DO,_getActiveRequests:RO,_getActiveHandles:OO,reallyExit:Lv,_kill:Nv,cpuUsage:Th,resourceUsage:Dv,memoryUsage:$v,kill:Mv,exit:Bv,openStdin:Uv,allowedNodeEnvironmentFlags:Fv,assert:LO,features:jv,_fatalExceptions:qv,setUncaughtExceptionCaptureCallback:Hv,hasUncaughtExceptionCaptureCallback:NO,emitWarning:_v,nextTick:TO,_tickCallback:Wv,_debugProcess:zv,_debugEnd:Kv,_startProfilerIdleNotifier:Vv,_stopProfilerIdleNotifier:Gv,stdout:Yv,stdin:Zv,stderr:Xv,abort:Qv,umask:Sv,chdir:xv,cwd:Av,env:mv,title:dv,argv:yv,execArgv:bv,pid:Jv,ppid:e_,execPath:t_,debugPort:r_,hrtime:Xp,argv0:n_,_preload_modules:i_,setSourceMapsEnabled:s_}}),Le=ii(()=>{tj()});function rj(){if(y_)return Mc;y_=!0,Mc.byteLength=a,Mc.toByteArray=c,Mc.fromByteArray=p;for(var n=[],e=[],t=typeof Uint8Array<"u"?Uint8Array:Array,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=0,s=r.length;i<s;++i)n[i]=r[i],e[r.charCodeAt(i)]=i;e[45]=62,e[95]=63;function o(g){var m=g.length;if(m%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var E=g.indexOf("=");E===-1&&(E=m);var y=E===m?0:4-E%4;return[E,y]}function a(g){var m=o(g),E=m[0],y=m[1];return(E+y)*3/4-y}function l(g,m,E){return(m+E)*3/4-E}function c(g){var m,E=o(g),y=E[0],S=E[1],b=new t(l(g,y,S)),_=0,I=S>0?y-4:y,x;for(x=0;x<I;x+=4)m=e[g.charCodeAt(x)]<<18|e[g.charCodeAt(x+1)]<<12|e[g.charCodeAt(x+2)]<<6|e[g.charCodeAt(x+3)],b[_++]=m>>16&255,b[_++]=m>>8&255,b[_++]=m&255;return S===2&&(m=e[g.charCodeAt(x)]<<2|e[g.charCodeAt(x+1)]>>4,b[_++]=m&255),S===1&&(m=e[g.charCodeAt(x)]<<10|e[g.charCodeAt(x+1)]<<4|e[g.charCodeAt(x+2)]>>2,b[_++]=m>>8&255,b[_++]=m&255),b}function h(g){return n[g>>18&63]+n[g>>12&63]+n[g>>6&63]+n[g&63]}function d(g,m,E){for(var y,S=[],b=m;b<E;b+=3)y=(g[b]<<16&16711680)+(g[b+1]<<8&65280)+(g[b+2]&255),S.push(h(y));return S.join("")}function p(g){for(var m,E=g.length,y=E%3,S=[],b=16383,_=0,I=E-y;_<I;_+=b)S.push(d(g,_,_+b>I?I:_+b));return y===1?(m=g[E-1],S.push(n[m>>2]+n[m<<4&63]+"==")):y===2&&(m=(g[E-2]<<8)+g[E-1],S.push(n[m>>10]+n[m>>4&63]+n[m<<2&63]+"=")),S.join("")}return Mc}function nj(){return b_?Ch:(b_=!0,Ch.read=function(n,e,t,r,i){var s,o,a=i*8-r-1,l=(1<<a)-1,c=l>>1,h=-7,d=t?i-1:0,p=t?-1:1,g=n[e+d];for(d+=p,s=g&(1<<-h)-1,g>>=-h,h+=a;h>0;s=s*256+n[e+d],d+=p,h-=8);for(o=s&(1<<-h)-1,s>>=-h,h+=r;h>0;o=o*256+n[e+d],d+=p,h-=8);if(s===0)s=1-c;else{if(s===l)return o?NaN:(g?-1:1)*(1/0);o=o+Math.pow(2,r),s=s-c}return(g?-1:1)*o*Math.pow(2,s-r)},Ch.write=function(n,e,t,r,i,s){var o,a,l,c=s*8-i-1,h=(1<<c)-1,d=h>>1,p=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,g=r?0:s-1,m=r?1:-1,E=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=h):(o=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-o))<1&&(o--,l*=2),o+d>=1?e+=p/l:e+=p*Math.pow(2,1-d),e*l>=2&&(o++,l/=2),o+d>=h?(a=0,o=h):o+d>=1?(a=(e*l-1)*Math.pow(2,i),o=o+d):(a=e*Math.pow(2,d-1)*Math.pow(2,i),o=0));i>=8;n[t+g]=a&255,g+=m,a/=256,i-=8);for(o=o<<i|a,c+=i;c>0;n[t+g]=o&255,g+=m,o/=256,c-=8);n[t+g-m]|=E*128},Ch)}function ij(){if(w_)return Xo;w_=!0;let n=rj(),e=nj(),t=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;Xo.Buffer=o,Xo.SlowBuffer=S,Xo.INSPECT_MAX_BYTES=50;let r=2147483647;Xo.kMaxLength=r,o.TYPED_ARRAY_SUPPORT=i(),!o.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function i(){try{let A=new Uint8Array(1),T={foo:function(){return 42}};return Object.setPrototypeOf(T,Uint8Array.prototype),Object.setPrototypeOf(A,T),A.foo()===42}catch{return!1}}Object.defineProperty(o.prototype,"parent",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.buffer}}),Object.defineProperty(o.prototype,"offset",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.byteOffset}});function s(A){if(A>r)throw new RangeError('The value "'+A+'" is invalid for option "size"');let T=new Uint8Array(A);return Object.setPrototypeOf(T,o.prototype),T}function o(A,T,D){if(typeof A=="number"){if(typeof T=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return h(A)}return a(A,T,D)}o.poolSize=8192;function a(A,T,D){if(typeof A=="string")return d(A,T);if(ArrayBuffer.isView(A))return g(A);if(A==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof A);if(ye(A,ArrayBuffer)||A&&ye(A.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(ye(A,SharedArrayBuffer)||A&&ye(A.buffer,SharedArrayBuffer)))return m(A,T,D);if(typeof A=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');let Y=A.valueOf&&A.valueOf();if(Y!=null&&Y!==A)return o.from(Y,T,D);let ae=E(A);if(ae)return ae;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof A[Symbol.toPrimitive]=="function")return o.from(A[Symbol.toPrimitive]("string"),T,D);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof A)}o.from=function(A,T,D){return a(A,T,D)},Object.setPrototypeOf(o.prototype,Uint8Array.prototype),Object.setPrototypeOf(o,Uint8Array);function l(A){if(typeof A!="number")throw new TypeError('"size" argument must be of type number');if(A<0)throw new RangeError('The value "'+A+'" is invalid for option "size"')}function c(A,T,D){return l(A),A<=0?s(A):T!==void 0?typeof D=="string"?s(A).fill(T,D):s(A).fill(T):s(A)}o.alloc=function(A,T,D){return c(A,T,D)};function h(A){return l(A),s(A<0?0:y(A)|0)}o.allocUnsafe=function(A){return h(A)},o.allocUnsafeSlow=function(A){return h(A)};function d(A,T){if((typeof T!="string"||T==="")&&(T="utf8"),!o.isEncoding(T))throw new TypeError("Unknown encoding: "+T);let D=b(A,T)|0,Y=s(D),ae=Y.write(A,T);return ae!==D&&(Y=Y.slice(0,ae)),Y}function p(A){let T=A.length<0?0:y(A.length)|0,D=s(T);for(let Y=0;Y<T;Y+=1)D[Y]=A[Y]&255;return D}function g(A){if(ye(A,Uint8Array)){let T=new Uint8Array(A);return m(T.buffer,T.byteOffset,T.byteLength)}return p(A)}function m(A,T,D){if(T<0||A.byteLength<T)throw new RangeError('"offset" is outside of buffer bounds');if(A.byteLength<T+(D||0))throw new RangeError('"length" is outside of buffer bounds');let Y;return T===void 0&&D===void 0?Y=new Uint8Array(A):D===void 0?Y=new Uint8Array(A,T):Y=new Uint8Array(A,T,D),Object.setPrototypeOf(Y,o.prototype),Y}function E(A){if(o.isBuffer(A)){let T=y(A.length)|0,D=s(T);return D.length===0||A.copy(D,0,0,T),D}if(A.length!==void 0)return typeof A.length!="number"||Re(A.length)?s(0):p(A);if(A.type==="Buffer"&&Array.isArray(A.data))return p(A.data)}function y(A){if(A>=r)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+r.toString(16)+" bytes");return A|0}function S(A){return+A!=A&&(A=0),o.alloc(+A)}o.isBuffer=function(A){return A!=null&&A._isBuffer===!0&&A!==o.prototype},o.compare=function(A,T){if(ye(A,Uint8Array)&&(A=o.from(A,A.offset,A.byteLength)),ye(T,Uint8Array)&&(T=o.from(T,T.offset,T.byteLength)),!o.isBuffer(A)||!o.isBuffer(T))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(A===T)return 0;let D=A.length,Y=T.length;for(let ae=0,pe=Math.min(D,Y);ae<pe;++ae)if(A[ae]!==T[ae]){D=A[ae],Y=T[ae];break}return D<Y?-1:Y<D?1:0},o.isEncoding=function(A){switch(String(A).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},o.concat=function(A,T){if(!Array.isArray(A))throw new TypeError('"list" argument must be an Array of Buffers');if(A.length===0)return o.alloc(0);let D;if(T===void 0)for(T=0,D=0;D<A.length;++D)T+=A[D].length;let Y=o.allocUnsafe(T),ae=0;for(D=0;D<A.length;++D){let pe=A[D];if(ye(pe,Uint8Array))ae+pe.length>Y.length?(o.isBuffer(pe)||(pe=o.from(pe)),pe.copy(Y,ae)):Uint8Array.prototype.set.call(Y,pe,ae);else if(o.isBuffer(pe))pe.copy(Y,ae);else throw new TypeError('"list" argument must be an Array of Buffers');ae+=pe.length}return Y};function b(A,T){if(o.isBuffer(A))return A.length;if(ArrayBuffer.isView(A)||ye(A,ArrayBuffer))return A.byteLength;if(typeof A!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof A);let D=A.length,Y=arguments.length>2&&arguments[2]===!0;if(!Y&&D===0)return 0;let ae=!1;for(;;)switch(T){case"ascii":case"latin1":case"binary":return D;case"utf8":case"utf-8":return le(A).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return D*2;case"hex":return D>>>1;case"base64":return Ae(A).length;default:if(ae)return Y?-1:le(A).length;T=(""+T).toLowerCase(),ae=!0}}o.byteLength=b;function _(A,T,D){let Y=!1;if((T===void 0||T<0)&&(T=0),T>this.length||((D===void 0||D>this.length)&&(D=this.length),D<=0)||(D>>>=0,T>>>=0,D<=T))return"";for(A||(A="utf8");;)switch(A){case"hex":return H(this,T,D);case"utf8":case"utf-8":return B(this,T,D);case"ascii":return V(this,T,D);case"latin1":case"binary":return W(this,T,D);case"base64":return C(this,T,D);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return G(this,T,D);default:if(Y)throw new TypeError("Unknown encoding: "+A);A=(A+"").toLowerCase(),Y=!0}}o.prototype._isBuffer=!0;function I(A,T,D){let Y=A[T];A[T]=A[D],A[D]=Y}o.prototype.swap16=function(){let A=this.length;if(A%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let T=0;T<A;T+=2)I(this,T,T+1);return this},o.prototype.swap32=function(){let A=this.length;if(A%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let T=0;T<A;T+=4)I(this,T,T+3),I(this,T+1,T+2);return this},o.prototype.swap64=function(){let A=this.length;if(A%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let T=0;T<A;T+=8)I(this,T,T+7),I(this,T+1,T+6),I(this,T+2,T+5),I(this,T+3,T+4);return this},o.prototype.toString=function(){let A=this.length;return A===0?"":arguments.length===0?B(this,0,A):_.apply(this,arguments)},o.prototype.toLocaleString=o.prototype.toString,o.prototype.equals=function(A){if(!o.isBuffer(A))throw new TypeError("Argument must be a Buffer");return this===A?!0:o.compare(this,A)===0},o.prototype.inspect=function(){let A="",T=Xo.INSPECT_MAX_BYTES;return A=this.toString("hex",0,T).replace(/(.{2})/g,"$1 ").trim(),this.length>T&&(A+=" ... "),"<Buffer "+A+">"},t&&(o.prototype[t]=o.prototype.inspect),o.prototype.compare=function(A,T,D,Y,ae){if(ye(A,Uint8Array)&&(A=o.from(A,A.offset,A.byteLength)),!o.isBuffer(A))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof A);if(T===void 0&&(T=0),D===void 0&&(D=A?A.length:0),Y===void 0&&(Y=0),ae===void 0&&(ae=this.length),T<0||D>A.length||Y<0||ae>this.length)throw new RangeError("out of range index");if(Y>=ae&&T>=D)return 0;if(Y>=ae)return-1;if(T>=D)return 1;if(T>>>=0,D>>>=0,Y>>>=0,ae>>>=0,this===A)return 0;let pe=ae-Y,Ee=D-T,ue=Math.min(pe,Ee),we=this.slice(Y,ae),He=A.slice(T,D);for(let ze=0;ze<ue;++ze)if(we[ze]!==He[ze]){pe=we[ze],Ee=He[ze];break}return pe<Ee?-1:Ee<pe?1:0};function x(A,T,D,Y,ae){if(A.length===0)return-1;if(typeof D=="string"?(Y=D,D=0):D>2147483647?D=2147483647:D<-2147483648&&(D=-2147483648),D=+D,Re(D)&&(D=ae?0:A.length-1),D<0&&(D=A.length+D),D>=A.length){if(ae)return-1;D=A.length-1}else if(D<0)if(ae)D=0;else return-1;if(typeof T=="string"&&(T=o.from(T,Y)),o.isBuffer(T))return T.length===0?-1:$(A,T,D,Y,ae);if(typeof T=="number")return T=T&255,typeof Uint8Array.prototype.indexOf=="function"?ae?Uint8Array.prototype.indexOf.call(A,T,D):Uint8Array.prototype.lastIndexOf.call(A,T,D):$(A,[T],D,Y,ae);throw new TypeError("val must be string, number or Buffer")}function $(A,T,D,Y,ae){let pe=1,Ee=A.length,ue=T.length;if(Y!==void 0&&(Y=String(Y).toLowerCase(),Y==="ucs2"||Y==="ucs-2"||Y==="utf16le"||Y==="utf-16le")){if(A.length<2||T.length<2)return-1;pe=2,Ee/=2,ue/=2,D/=2}function we(ze,Ke){return pe===1?ze[Ke]:ze.readUInt16BE(Ke*pe)}let He;if(ae){let ze=-1;for(He=D;He<Ee;He++)if(we(A,He)===we(T,ze===-1?0:He-ze)){if(ze===-1&&(ze=He),He-ze+1===ue)return ze*pe}else ze!==-1&&(He-=He-ze),ze=-1}else for(D+ue>Ee&&(D=Ee-ue),He=D;He>=0;He--){let ze=!0;for(let Ke=0;Ke<ue;Ke++)if(we(A,He+Ke)!==we(T,Ke)){ze=!1;break}if(ze)return He}return-1}o.prototype.includes=function(A,T,D){return this.indexOf(A,T,D)!==-1},o.prototype.indexOf=function(A,T,D){return x(this,A,T,D,!0)},o.prototype.lastIndexOf=function(A,T,D){return x(this,A,T,D,!1)};function U(A,T,D,Y){D=Number(D)||0;let ae=A.length-D;Y?(Y=Number(Y),Y>ae&&(Y=ae)):Y=ae;let pe=T.length;Y>pe/2&&(Y=pe/2);let Ee;for(Ee=0;Ee<Y;++Ee){let ue=parseInt(T.substr(Ee*2,2),16);if(Re(ue))return Ee;A[D+Ee]=ue}return Ee}function O(A,T,D,Y){return Te(le(T,A.length-D),A,D,Y)}function P(A,T,D,Y){return Te(ge(T),A,D,Y)}function M(A,T,D,Y){return Te(Ae(T),A,D,Y)}function K(A,T,D,Y){return Te(Ie(T,A.length-D),A,D,Y)}o.prototype.write=function(A,T,D,Y){if(T===void 0)Y="utf8",D=this.length,T=0;else if(D===void 0&&typeof T=="string")Y=T,D=this.length,T=0;else if(isFinite(T))T=T>>>0,isFinite(D)?(D=D>>>0,Y===void 0&&(Y="utf8")):(Y=D,D=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");let ae=this.length-T;if((D===void 0||D>ae)&&(D=ae),A.length>0&&(D<0||T<0)||T>this.length)throw new RangeError("Attempt to write outside buffer bounds");Y||(Y="utf8");let pe=!1;for(;;)switch(Y){case"hex":return U(this,A,T,D);case"utf8":case"utf-8":return O(this,A,T,D);case"ascii":case"latin1":case"binary":return P(this,A,T,D);case"base64":return M(this,A,T,D);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return K(this,A,T,D);default:if(pe)throw new TypeError("Unknown encoding: "+Y);Y=(""+Y).toLowerCase(),pe=!0}},o.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function C(A,T,D){return T===0&&D===A.length?n.fromByteArray(A):n.fromByteArray(A.slice(T,D))}function B(A,T,D){D=Math.min(A.length,D);let Y=[],ae=T;for(;ae<D;){let pe=A[ae],Ee=null,ue=pe>239?4:pe>223?3:pe>191?2:1;if(ae+ue<=D){let we,He,ze,Ke;switch(ue){case 1:pe<128&&(Ee=pe);break;case 2:we=A[ae+1],(we&192)===128&&(Ke=(pe&31)<<6|we&63,Ke>127&&(Ee=Ke));break;case 3:we=A[ae+1],He=A[ae+2],(we&192)===128&&(He&192)===128&&(Ke=(pe&15)<<12|(we&63)<<6|He&63,Ke>2047&&(Ke<55296||Ke>57343)&&(Ee=Ke));break;case 4:we=A[ae+1],He=A[ae+2],ze=A[ae+3],(we&192)===128&&(He&192)===128&&(ze&192)===128&&(Ke=(pe&15)<<18|(we&63)<<12|(He&63)<<6|ze&63,Ke>65535&&Ke<1114112&&(Ee=Ke))}}Ee===null?(Ee=65533,ue=1):Ee>65535&&(Ee-=65536,Y.push(Ee>>>10&1023|55296),Ee=56320|Ee&1023),Y.push(Ee),ae+=ue}return L(Y)}let N=4096;function L(A){let T=A.length;if(T<=N)return String.fromCharCode.apply(String,A);let D="",Y=0;for(;Y<T;)D+=String.fromCharCode.apply(String,A.slice(Y,Y+=N));return D}function V(A,T,D){let Y="";D=Math.min(A.length,D);for(let ae=T;ae<D;++ae)Y+=String.fromCharCode(A[ae]&127);return Y}function W(A,T,D){let Y="";D=Math.min(A.length,D);for(let ae=T;ae<D;++ae)Y+=String.fromCharCode(A[ae]);return Y}function H(A,T,D){let Y=A.length;(!T||T<0)&&(T=0),(!D||D<0||D>Y)&&(D=Y);let ae="";for(let pe=T;pe<D;++pe)ae+=Fe[A[pe]];return ae}function G(A,T,D){let Y=A.slice(T,D),ae="";for(let pe=0;pe<Y.length-1;pe+=2)ae+=String.fromCharCode(Y[pe]+Y[pe+1]*256);return ae}o.prototype.slice=function(A,T){let D=this.length;A=~~A,T=T===void 0?D:~~T,A<0?(A+=D,A<0&&(A=0)):A>D&&(A=D),T<0?(T+=D,T<0&&(T=0)):T>D&&(T=D),T<A&&(T=A);let Y=this.subarray(A,T);return Object.setPrototypeOf(Y,o.prototype),Y};function z(A,T,D){if(A%1!==0||A<0)throw new RangeError("offset is not uint");if(A+T>D)throw new RangeError("Trying to access beyond buffer length")}o.prototype.readUintLE=o.prototype.readUIntLE=function(A,T,D){A=A>>>0,T=T>>>0,D||z(A,T,this.length);let Y=this[A],ae=1,pe=0;for(;++pe<T&&(ae*=256);)Y+=this[A+pe]*ae;return Y},o.prototype.readUintBE=o.prototype.readUIntBE=function(A,T,D){A=A>>>0,T=T>>>0,D||z(A,T,this.length);let Y=this[A+--T],ae=1;for(;T>0&&(ae*=256);)Y+=this[A+--T]*ae;return Y},o.prototype.readUint8=o.prototype.readUInt8=function(A,T){return A=A>>>0,T||z(A,1,this.length),this[A]},o.prototype.readUint16LE=o.prototype.readUInt16LE=function(A,T){return A=A>>>0,T||z(A,2,this.length),this[A]|this[A+1]<<8},o.prototype.readUint16BE=o.prototype.readUInt16BE=function(A,T){return A=A>>>0,T||z(A,2,this.length),this[A]<<8|this[A+1]},o.prototype.readUint32LE=o.prototype.readUInt32LE=function(A,T){return A=A>>>0,T||z(A,4,this.length),(this[A]|this[A+1]<<8|this[A+2]<<16)+this[A+3]*16777216},o.prototype.readUint32BE=o.prototype.readUInt32BE=function(A,T){return A=A>>>0,T||z(A,4,this.length),this[A]*16777216+(this[A+1]<<16|this[A+2]<<8|this[A+3])},o.prototype.readBigUInt64LE=Ce(function(A){A=A>>>0,ee(A,"offset");let T=this[A],D=this[A+7];(T===void 0||D===void 0)&&me(A,this.length-8);let Y=T+this[++A]*2**8+this[++A]*2**16+this[++A]*2**24,ae=this[++A]+this[++A]*2**8+this[++A]*2**16+D*2**24;return BigInt(Y)+(BigInt(ae)<<BigInt(32))}),o.prototype.readBigUInt64BE=Ce(function(A){A=A>>>0,ee(A,"offset");let T=this[A],D=this[A+7];(T===void 0||D===void 0)&&me(A,this.length-8);let Y=T*2**24+this[++A]*2**16+this[++A]*2**8+this[++A],ae=this[++A]*2**24+this[++A]*2**16+this[++A]*2**8+D;return(BigInt(Y)<<BigInt(32))+BigInt(ae)}),o.prototype.readIntLE=function(A,T,D){A=A>>>0,T=T>>>0,D||z(A,T,this.length);let Y=this[A],ae=1,pe=0;for(;++pe<T&&(ae*=256);)Y+=this[A+pe]*ae;return ae*=128,Y>=ae&&(Y-=Math.pow(2,8*T)),Y},o.prototype.readIntBE=function(A,T,D){A=A>>>0,T=T>>>0,D||z(A,T,this.length);let Y=T,ae=1,pe=this[A+--Y];for(;Y>0&&(ae*=256);)pe+=this[A+--Y]*ae;return ae*=128,pe>=ae&&(pe-=Math.pow(2,8*T)),pe},o.prototype.readInt8=function(A,T){return A=A>>>0,T||z(A,1,this.length),this[A]&128?(255-this[A]+1)*-1:this[A]},o.prototype.readInt16LE=function(A,T){A=A>>>0,T||z(A,2,this.length);let D=this[A]|this[A+1]<<8;return D&32768?D|4294901760:D},o.prototype.readInt16BE=function(A,T){A=A>>>0,T||z(A,2,this.length);let D=this[A+1]|this[A]<<8;return D&32768?D|4294901760:D},o.prototype.readInt32LE=function(A,T){return A=A>>>0,T||z(A,4,this.length),this[A]|this[A+1]<<8|this[A+2]<<16|this[A+3]<<24},o.prototype.readInt32BE=function(A,T){return A=A>>>0,T||z(A,4,this.length),this[A]<<24|this[A+1]<<16|this[A+2]<<8|this[A+3]},o.prototype.readBigInt64LE=Ce(function(A){A=A>>>0,ee(A,"offset");let T=this[A],D=this[A+7];(T===void 0||D===void 0)&&me(A,this.length-8);let Y=this[A+4]+this[A+5]*2**8+this[A+6]*2**16+(D<<24);return(BigInt(Y)<<BigInt(32))+BigInt(T+this[++A]*2**8+this[++A]*2**16+this[++A]*2**24)}),o.prototype.readBigInt64BE=Ce(function(A){A=A>>>0,ee(A,"offset");let T=this[A],D=this[A+7];(T===void 0||D===void 0)&&me(A,this.length-8);let Y=(T<<24)+this[++A]*2**16+this[++A]*2**8+this[++A];return(BigInt(Y)<<BigInt(32))+BigInt(this[++A]*2**24+this[++A]*2**16+this[++A]*2**8+D)}),o.prototype.readFloatLE=function(A,T){return A=A>>>0,T||z(A,4,this.length),e.read(this,A,!0,23,4)},o.prototype.readFloatBE=function(A,T){return A=A>>>0,T||z(A,4,this.length),e.read(this,A,!1,23,4)},o.prototype.readDoubleLE=function(A,T){return A=A>>>0,T||z(A,8,this.length),e.read(this,A,!0,52,8)},o.prototype.readDoubleBE=function(A,T){return A=A>>>0,T||z(A,8,this.length),e.read(this,A,!1,52,8)};function Z(A,T,D,Y,ae,pe){if(!o.isBuffer(A))throw new TypeError('"buffer" argument must be a Buffer instance');if(T>ae||T<pe)throw new RangeError('"value" argument is out of bounds');if(D+Y>A.length)throw new RangeError("Index out of range")}o.prototype.writeUintLE=o.prototype.writeUIntLE=function(A,T,D,Y){if(A=+A,T=T>>>0,D=D>>>0,!Y){let Ee=Math.pow(2,8*D)-1;Z(this,A,T,D,Ee,0)}let ae=1,pe=0;for(this[T]=A&255;++pe<D&&(ae*=256);)this[T+pe]=A/ae&255;return T+D},o.prototype.writeUintBE=o.prototype.writeUIntBE=function(A,T,D,Y){if(A=+A,T=T>>>0,D=D>>>0,!Y){let Ee=Math.pow(2,8*D)-1;Z(this,A,T,D,Ee,0)}let ae=D-1,pe=1;for(this[T+ae]=A&255;--ae>=0&&(pe*=256);)this[T+ae]=A/pe&255;return T+D},o.prototype.writeUint8=o.prototype.writeUInt8=function(A,T,D){return A=+A,T=T>>>0,D||Z(this,A,T,1,255,0),this[T]=A&255,T+1},o.prototype.writeUint16LE=o.prototype.writeUInt16LE=function(A,T,D){return A=+A,T=T>>>0,D||Z(this,A,T,2,65535,0),this[T]=A&255,this[T+1]=A>>>8,T+2},o.prototype.writeUint16BE=o.prototype.writeUInt16BE=function(A,T,D){return A=+A,T=T>>>0,D||Z(this,A,T,2,65535,0),this[T]=A>>>8,this[T+1]=A&255,T+2},o.prototype.writeUint32LE=o.prototype.writeUInt32LE=function(A,T,D){return A=+A,T=T>>>0,D||Z(this,A,T,4,4294967295,0),this[T+3]=A>>>24,this[T+2]=A>>>16,this[T+1]=A>>>8,this[T]=A&255,T+4},o.prototype.writeUint32BE=o.prototype.writeUInt32BE=function(A,T,D){return A=+A,T=T>>>0,D||Z(this,A,T,4,4294967295,0),this[T]=A>>>24,this[T+1]=A>>>16,this[T+2]=A>>>8,this[T+3]=A&255,T+4};function F(A,T,D,Y,ae){X(T,Y,ae,A,D,7);let pe=Number(T&BigInt(4294967295));A[D++]=pe,pe=pe>>8,A[D++]=pe,pe=pe>>8,A[D++]=pe,pe=pe>>8,A[D++]=pe;let Ee=Number(T>>BigInt(32)&BigInt(4294967295));return A[D++]=Ee,Ee=Ee>>8,A[D++]=Ee,Ee=Ee>>8,A[D++]=Ee,Ee=Ee>>8,A[D++]=Ee,D}function ie(A,T,D,Y,ae){X(T,Y,ae,A,D,7);let pe=Number(T&BigInt(4294967295));A[D+7]=pe,pe=pe>>8,A[D+6]=pe,pe=pe>>8,A[D+5]=pe,pe=pe>>8,A[D+4]=pe;let Ee=Number(T>>BigInt(32)&BigInt(4294967295));return A[D+3]=Ee,Ee=Ee>>8,A[D+2]=Ee,Ee=Ee>>8,A[D+1]=Ee,Ee=Ee>>8,A[D]=Ee,D+8}o.prototype.writeBigUInt64LE=Ce(function(A,T=0){return F(this,A,T,BigInt(0),BigInt("0xffffffffffffffff"))}),o.prototype.writeBigUInt64BE=Ce(function(A,T=0){return ie(this,A,T,BigInt(0),BigInt("0xffffffffffffffff"))}),o.prototype.writeIntLE=function(A,T,D,Y){if(A=+A,T=T>>>0,!Y){let ue=Math.pow(2,8*D-1);Z(this,A,T,D,ue-1,-ue)}let ae=0,pe=1,Ee=0;for(this[T]=A&255;++ae<D&&(pe*=256);)A<0&&Ee===0&&this[T+ae-1]!==0&&(Ee=1),this[T+ae]=(A/pe>>0)-Ee&255;return T+D},o.prototype.writeIntBE=function(A,T,D,Y){if(A=+A,T=T>>>0,!Y){let ue=Math.pow(2,8*D-1);Z(this,A,T,D,ue-1,-ue)}let ae=D-1,pe=1,Ee=0;for(this[T+ae]=A&255;--ae>=0&&(pe*=256);)A<0&&Ee===0&&this[T+ae+1]!==0&&(Ee=1),this[T+ae]=(A/pe>>0)-Ee&255;return T+D},o.prototype.writeInt8=function(A,T,D){return A=+A,T=T>>>0,D||Z(this,A,T,1,127,-128),A<0&&(A=255+A+1),this[T]=A&255,T+1},o.prototype.writeInt16LE=function(A,T,D){return A=+A,T=T>>>0,D||Z(this,A,T,2,32767,-32768),this[T]=A&255,this[T+1]=A>>>8,T+2},o.prototype.writeInt16BE=function(A,T,D){return A=+A,T=T>>>0,D||Z(this,A,T,2,32767,-32768),this[T]=A>>>8,this[T+1]=A&255,T+2},o.prototype.writeInt32LE=function(A,T,D){return A=+A,T=T>>>0,D||Z(this,A,T,4,2147483647,-2147483648),this[T]=A&255,this[T+1]=A>>>8,this[T+2]=A>>>16,this[T+3]=A>>>24,T+4},o.prototype.writeInt32BE=function(A,T,D){return A=+A,T=T>>>0,D||Z(this,A,T,4,2147483647,-2147483648),A<0&&(A=4294967295+A+1),this[T]=A>>>24,this[T+1]=A>>>16,this[T+2]=A>>>8,this[T+3]=A&255,T+4},o.prototype.writeBigInt64LE=Ce(function(A,T=0){return F(this,A,T,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),o.prototype.writeBigInt64BE=Ce(function(A,T=0){return ie(this,A,T,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function fe(A,T,D,Y,ae,pe){if(D+Y>A.length)throw new RangeError("Index out of range");if(D<0)throw new RangeError("Index out of range")}function J(A,T,D,Y,ae){return T=+T,D=D>>>0,ae||fe(A,T,D,4),e.write(A,T,D,Y,23,4),D+4}o.prototype.writeFloatLE=function(A,T,D){return J(this,A,T,!0,D)},o.prototype.writeFloatBE=function(A,T,D){return J(this,A,T,!1,D)};function _e(A,T,D,Y,ae){return T=+T,D=D>>>0,ae||fe(A,T,D,8),e.write(A,T,D,Y,52,8),D+8}o.prototype.writeDoubleLE=function(A,T,D){return _e(this,A,T,!0,D)},o.prototype.writeDoubleBE=function(A,T,D){return _e(this,A,T,!1,D)},o.prototype.copy=function(A,T,D,Y){if(!o.isBuffer(A))throw new TypeError("argument should be a Buffer");if(D||(D=0),!Y&&Y!==0&&(Y=this.length),T>=A.length&&(T=A.length),T||(T=0),Y>0&&Y<D&&(Y=D),Y===D||A.length===0||this.length===0)return 0;if(T<0)throw new RangeError("targetStart out of bounds");if(D<0||D>=this.length)throw new RangeError("Index out of range");if(Y<0)throw new RangeError("sourceEnd out of bounds");Y>this.length&&(Y=this.length),A.length-T<Y-D&&(Y=A.length-T+D);let ae=Y-D;return this===A&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(T,D,Y):Uint8Array.prototype.set.call(A,this.subarray(D,Y),T),ae},o.prototype.fill=function(A,T,D,Y){if(typeof A=="string"){if(typeof T=="string"?(Y=T,T=0,D=this.length):typeof D=="string"&&(Y=D,D=this.length),Y!==void 0&&typeof Y!="string")throw new TypeError("encoding must be a string");if(typeof Y=="string"&&!o.isEncoding(Y))throw new TypeError("Unknown encoding: "+Y);if(A.length===1){let pe=A.charCodeAt(0);(Y==="utf8"&&pe<128||Y==="latin1")&&(A=pe)}}else typeof A=="number"?A=A&255:typeof A=="boolean"&&(A=Number(A));if(T<0||this.length<T||this.length<D)throw new RangeError("Out of range index");if(D<=T)return this;T=T>>>0,D=D===void 0?this.length:D>>>0,A||(A=0);let ae;if(typeof A=="number")for(ae=T;ae<D;++ae)this[ae]=A;else{let pe=o.isBuffer(A)?A:o.from(A,Y),Ee=pe.length;if(Ee===0)throw new TypeError('The value "'+A+'" is invalid for argument "value"');for(ae=0;ae<D-T;++ae)this[ae+T]=pe[ae%Ee]}return this};let oe={};function ne(A,T,D){oe[A]=class extends D{constructor(){super(),Object.defineProperty(this,"message",{value:T.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${A}]`,this.stack,delete this.name}get code(){return A}set code(Y){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:Y,writable:!0})}toString(){return`${this.name} [${A}]: ${this.message}`}}}ne("ERR_BUFFER_OUT_OF_BOUNDS",function(A){return A?`${A} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),ne("ERR_INVALID_ARG_TYPE",function(A,T){return`The "${A}" argument must be of type number. Received type ${typeof T}`},TypeError),ne("ERR_OUT_OF_RANGE",function(A,T,D){let Y=`The value of "${A}" is out of range.`,ae=D;return Number.isInteger(D)&&Math.abs(D)>2**32?ae=de(String(D)):typeof D=="bigint"&&(ae=String(D),(D>BigInt(2)**BigInt(32)||D<-(BigInt(2)**BigInt(32)))&&(ae=de(ae)),ae+="n"),Y+=` It must be ${T}. Received ${ae}`,Y},RangeError);function de(A){let T="",D=A.length,Y=A[0]==="-"?1:0;for(;D>=Y+4;D-=3)T=`_${A.slice(D-3,D)}${T}`;return`${A.slice(0,D)}${T}`}function k(A,T,D){ee(T,"offset"),(A[T]===void 0||A[T+D]===void 0)&&me(T,A.length-(D+1))}function X(A,T,D,Y,ae,pe){if(A>D||A<T){let Ee=typeof T=="bigint"?"n":"",ue;throw T===0||T===BigInt(0)?ue=`>= 0${Ee} and < 2${Ee} ** ${(pe+1)*8}${Ee}`:ue=`>= -(2${Ee} ** ${(pe+1)*8-1}${Ee}) and < 2 ** ${(pe+1)*8-1}${Ee}`,new oe.ERR_OUT_OF_RANGE("value",ue,A)}k(Y,ae,pe)}function ee(A,T){if(typeof A!="number")throw new oe.ERR_INVALID_ARG_TYPE(T,"number",A)}function me(A,T,D){throw Math.floor(A)!==A?(ee(A,D),new oe.ERR_OUT_OF_RANGE("offset","an integer",A)):T<0?new oe.ERR_BUFFER_OUT_OF_BOUNDS:new oe.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${T}`,A)}let be=/[^+/0-9A-Za-z-_]/g;function te(A){if(A=A.split("=")[0],A=A.trim().replace(be,""),A.length<2)return"";for(;A.length%4!==0;)A=A+"=";return A}function le(A,T){T=T||1/0;let D,Y=A.length,ae=null,pe=[];for(let Ee=0;Ee<Y;++Ee){if(D=A.charCodeAt(Ee),D>55295&&D<57344){if(!ae){if(D>56319){(T-=3)>-1&&pe.push(239,191,189);continue}else if(Ee+1===Y){(T-=3)>-1&&pe.push(239,191,189);continue}ae=D;continue}if(D<56320){(T-=3)>-1&&pe.push(239,191,189),ae=D;continue}D=(ae-55296<<10|D-56320)+65536}else ae&&(T-=3)>-1&&pe.push(239,191,189);if(ae=null,D<128){if((T-=1)<0)break;pe.push(D)}else if(D<2048){if((T-=2)<0)break;pe.push(D>>6|192,D&63|128)}else if(D<65536){if((T-=3)<0)break;pe.push(D>>12|224,D>>6&63|128,D&63|128)}else if(D<1114112){if((T-=4)<0)break;pe.push(D>>18|240,D>>12&63|128,D>>6&63|128,D&63|128)}else throw new Error("Invalid code point")}return pe}function ge(A){let T=[];for(let D=0;D<A.length;++D)T.push(A.charCodeAt(D)&255);return T}function Ie(A,T){let D,Y,ae,pe=[];for(let Ee=0;Ee<A.length&&!((T-=2)<0);++Ee)D=A.charCodeAt(Ee),Y=D>>8,ae=D%256,pe.push(ae),pe.push(Y);return pe}function Ae(A){return n.toByteArray(te(A))}function Te(A,T,D,Y){let ae;for(ae=0;ae<Y&&!(ae+D>=T.length||ae>=A.length);++ae)T[ae+D]=A[ae];return ae}function ye(A,T){return A instanceof T||A!=null&&A.constructor!=null&&A.constructor.name!=null&&A.constructor.name===T.name}function Re(A){return A!==A}let Fe=function(){let A="0123456789abcdef",T=new Array(256);for(let D=0;D<16;++D){let Y=D*16;for(let ae=0;ae<16;++ae)T[Y+ae]=A[D]+A[ae]}return T}();function Ce(A){return typeof BigInt>"u"?et:A}function et(){throw new Error("BigInt not supported")}return Xo}var Mc,y_,Ch,b_,Xo,w_,sj=ii(()=>{Oe(),Ne(),Le(),Mc={},y_=!1,Ch={},b_=!1,Xo={},w_=!1}),Qr={};ju(Qr,{Buffer:()=>Wg,INSPECT_MAX_BYTES:()=>MO,default:()=>Gs,kMaxLength:()=>BO});var Gs,Wg,MO,BO,Jr=ii(()=>{Oe(),Ne(),Le(),sj(),Gs=ij(),Gs.Buffer,Gs.SlowBuffer,Gs.INSPECT_MAX_BYTES,Gs.kMaxLength,Wg=Gs.Buffer,MO=Gs.INSPECT_MAX_BYTES,BO=Gs.kMaxLength}),Ne=ii(()=>{Jr()}),Ir=$e((n,e)=>{Oe(),Ne(),Le();var t=class extends Error{constructor(r){if(!Array.isArray(r))throw new TypeError(`Expected input to be an Array, got ${typeof r}`);let i="";for(let s=0;s<r.length;s++)i+=`    ${r[s].stack}
`;super(i),this.name="AggregateError",this.errors=r}};e.exports={AggregateError:t,ArrayIsArray(r){return Array.isArray(r)},ArrayPrototypeIncludes(r,i){return r.includes(i)},ArrayPrototypeIndexOf(r,i){return r.indexOf(i)},ArrayPrototypeJoin(r,i){return r.join(i)},ArrayPrototypeMap(r,i){return r.map(i)},ArrayPrototypePop(r,i){return r.pop(i)},ArrayPrototypePush(r,i){return r.push(i)},ArrayPrototypeSlice(r,i,s){return r.slice(i,s)},Error,FunctionPrototypeCall(r,i,...s){return r.call(i,...s)},FunctionPrototypeSymbolHasInstance(r,i){return Function.prototype[Symbol.hasInstance].call(r,i)},MathFloor:Math.floor,Number,NumberIsInteger:Number.isInteger,NumberIsNaN:Number.isNaN,NumberMAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER,NumberMIN_SAFE_INTEGER:Number.MIN_SAFE_INTEGER,NumberParseInt:Number.parseInt,ObjectDefineProperties(r,i){return Object.defineProperties(r,i)},ObjectDefineProperty(r,i,s){return Object.defineProperty(r,i,s)},ObjectGetOwnPropertyDescriptor(r,i){return Object.getOwnPropertyDescriptor(r,i)},ObjectKeys(r){return Object.keys(r)},ObjectSetPrototypeOf(r,i){return Object.setPrototypeOf(r,i)},Promise,PromisePrototypeCatch(r,i){return r.catch(i)},PromisePrototypeThen(r,i,s){return r.then(i,s)},PromiseReject(r){return Promise.reject(r)},PromiseResolve(r){return Promise.resolve(r)},ReflectApply:Reflect.apply,RegExpPrototypeTest(r,i){return r.test(i)},SafeSet:Set,String,StringPrototypeSlice(r,i,s){return r.slice(i,s)},StringPrototypeToLowerCase(r){return r.toLowerCase()},StringPrototypeToUpperCase(r){return r.toUpperCase()},StringPrototypeTrim(r){return r.trim()},Symbol,SymbolFor:Symbol.for,SymbolAsyncIterator:Symbol.asyncIterator,SymbolHasInstance:Symbol.hasInstance,SymbolIterator:Symbol.iterator,SymbolDispose:Symbol.dispose||Symbol("Symbol.dispose"),SymbolAsyncDispose:Symbol.asyncDispose||Symbol("Symbol.asyncDispose"),TypedArrayPrototypeSet(r,i,s){return r.set(i,s)},Boolean,Uint8Array}}),UO=$e((n,e)=>{Oe(),Ne(),Le(),e.exports={format(t,...r){return t.replace(/%([sdifj])/g,function(...[i,s]){let o=r.shift();return s==="f"?o.toFixed(6):s==="j"?JSON.stringify(o):s==="s"&&typeof o=="object"?`${o.constructor!==Object?o.constructor.name:""} {}`.trim():o.toString()})},inspect(t){switch(typeof t){case"string":if(t.includes("'"))if(t.includes('"')){if(!t.includes("`")&&!t.includes("${"))return`\`${t}\``}else return`"${t}"`;return`'${t}'`;case"number":return isNaN(t)?"NaN":Object.is(t,-0)?String(t):t;case"bigint":return`${String(t)}n`;case"boolean":case"undefined":return String(t);case"object":return"{}"}}}}),Fn=$e((n,e)=>{Oe(),Ne(),Le();var{format:t,inspect:r}=UO(),{AggregateError:i}=Ir(),s=globalThis.AggregateError||i,o=Symbol("kIsNodeError"),a=["string","function","number","object","Function","Object","boolean","bigint","symbol"],l=/^([A-Z][a-z0-9]*)+$/,c="__node_internal_",h={};function d(b,_){if(!b)throw new h.ERR_INTERNAL_ASSERTION(_)}function p(b){let _="",I=b.length,x=b[0]==="-"?1:0;for(;I>=x+4;I-=3)_=`_${b.slice(I-3,I)}${_}`;return`${b.slice(0,I)}${_}`}function g(b,_,I){if(typeof _=="function")return d(_.length<=I.length,`Code: ${b}; The provided arguments length (${I.length}) does not match the required ones (${_.length}).`),_(...I);let x=(_.match(/%[dfijoOs]/g)||[]).length;return d(x===I.length,`Code: ${b}; The provided arguments length (${I.length}) does not match the required ones (${x}).`),I.length===0?_:t(_,...I)}function m(b,_,I){I||(I=Error);class x extends I{constructor(...U){super(g(b,_,U))}toString(){return`${this.name} [${b}]: ${this.message}`}}Object.defineProperties(x.prototype,{name:{value:I.name,writable:!0,enumerable:!1,configurable:!0},toString:{value(){return`${this.name} [${b}]: ${this.message}`},writable:!0,enumerable:!1,configurable:!0}}),x.prototype.code=b,x.prototype[o]=!0,h[b]=x}function E(b){let _=c+b.name;return Object.defineProperty(b,"name",{value:_}),b}function y(b,_){if(b&&_&&b!==_){if(Array.isArray(_.errors))return _.errors.push(b),_;let I=new s([_,b],_.message);return I.code=_.code,I}return b||_}var S=class extends Error{constructor(b="The operation was aborted",_=void 0){if(_!==void 0&&typeof _!="object")throw new h.ERR_INVALID_ARG_TYPE("options","Object",_);super(b,_),this.code="ABORT_ERR",this.name="AbortError"}};m("ERR_ASSERTION","%s",Error),m("ERR_INVALID_ARG_TYPE",(b,_,I)=>{d(typeof b=="string","'name' must be a string"),Array.isArray(_)||(_=[_]);let x="The ";b.endsWith(" argument")?x+=`${b} `:x+=`"${b}" ${b.includes(".")?"property":"argument"} `,x+="must be ";let $=[],U=[],O=[];for(let M of _)d(typeof M=="string","All expected entries have to be of type string"),a.includes(M)?$.push(M.toLowerCase()):l.test(M)?U.push(M):(d(M!=="object",'The value "object" should be written as "Object"'),O.push(M));if(U.length>0){let M=$.indexOf("object");M!==-1&&($.splice($,M,1),U.push("Object"))}if($.length>0){switch($.length){case 1:x+=`of type ${$[0]}`;break;case 2:x+=`one of type ${$[0]} or ${$[1]}`;break;default:{let M=$.pop();x+=`one of type ${$.join(", ")}, or ${M}`}}(U.length>0||O.length>0)&&(x+=" or ")}if(U.length>0){switch(U.length){case 1:x+=`an instance of ${U[0]}`;break;case 2:x+=`an instance of ${U[0]} or ${U[1]}`;break;default:{let M=U.pop();x+=`an instance of ${U.join(", ")}, or ${M}`}}O.length>0&&(x+=" or ")}switch(O.length){case 0:break;case 1:O[0].toLowerCase()!==O[0]&&(x+="an "),x+=`${O[0]}`;break;case 2:x+=`one of ${O[0]} or ${O[1]}`;break;default:{let M=O.pop();x+=`one of ${O.join(", ")}, or ${M}`}}if(I==null)x+=`. Received ${I}`;else if(typeof I=="function"&&I.name)x+=`. Received function ${I.name}`;else if(typeof I=="object"){var P;if((P=I.constructor)!==null&&P!==void 0&&P.name)x+=`. Received an instance of ${I.constructor.name}`;else{let M=r(I,{depth:-1});x+=`. Received ${M}`}}else{let M=r(I,{colors:!1});M.length>25&&(M=`${M.slice(0,25)}...`),x+=`. Received type ${typeof I} (${M})`}return x},TypeError),m("ERR_INVALID_ARG_VALUE",(b,_,I="is invalid")=>{let x=r(_);return x.length>128&&(x=x.slice(0,128)+"..."),`The ${b.includes(".")?"property":"argument"} '${b}' ${I}. Received ${x}`},TypeError),m("ERR_INVALID_RETURN_VALUE",(b,_,I)=>{var x;let $=I!=null&&(x=I.constructor)!==null&&x!==void 0&&x.name?`instance of ${I.constructor.name}`:`type ${typeof I}`;return`Expected ${b} to be returned from the "${_}" function but got ${$}.`},TypeError),m("ERR_MISSING_ARGS",(...b)=>{d(b.length>0,"At least one arg needs to be specified");let _,I=b.length;switch(b=(Array.isArray(b)?b:[b]).map(x=>`"${x}"`).join(" or "),I){case 1:_+=`The ${b[0]} argument`;break;case 2:_+=`The ${b[0]} and ${b[1]} arguments`;break;default:{let x=b.pop();_+=`The ${b.join(", ")}, and ${x} arguments`}break}return`${_} must be specified`},TypeError),m("ERR_OUT_OF_RANGE",(b,_,I)=>{d(_,'Missing "range" argument');let x;if(Number.isInteger(I)&&Math.abs(I)>2**32)x=p(String(I));else if(typeof I=="bigint"){x=String(I);let $=BigInt(2)**BigInt(32);(I>$||I<-$)&&(x=p(x)),x+="n"}else x=r(I);return`The value of "${b}" is out of range. It must be ${_}. Received ${x}`},RangeError),m("ERR_MULTIPLE_CALLBACK","Callback called multiple times",Error),m("ERR_METHOD_NOT_IMPLEMENTED","The %s method is not implemented",Error),m("ERR_STREAM_ALREADY_FINISHED","Cannot call %s after a stream was finished",Error),m("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable",Error),m("ERR_STREAM_DESTROYED","Cannot call %s after a stream was destroyed",Error),m("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),m("ERR_STREAM_PREMATURE_CLOSE","Premature close",Error),m("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF",Error),m("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event",Error),m("ERR_STREAM_WRITE_AFTER_END","write after end",Error),m("ERR_UNKNOWN_ENCODING","Unknown encoding: %s",TypeError),e.exports={AbortError:S,aggregateTwoErrors:E(y),hideStackFrames:E,codes:h}}),lf=$e((n,e)=>{Oe(),Ne(),Le();var{AbortController:t,AbortSignal:r}=typeof self<"u"?self:typeof window<"u"?window:void 0;e.exports=t,e.exports.AbortSignal=r,e.exports.default=t}),Aa={};ju(Aa,{EventEmitter:()=>FO,default:()=>Bc,defaultMaxListeners:()=>jO,init:()=>qO,listenerCount:()=>HO,on:()=>WO,once:()=>zO});function oj(){if(v_)return kh;v_=!0;var n=typeof Reflect=="object"?Reflect:null,e=n&&typeof n.apply=="function"?n.apply:function(I,x,$){return Function.prototype.apply.call(I,x,$)},t;n&&typeof n.ownKeys=="function"?t=n.ownKeys:Object.getOwnPropertySymbols?t=function(I){return Object.getOwnPropertyNames(I).concat(Object.getOwnPropertySymbols(I))}:t=function(I){return Object.getOwnPropertyNames(I)};function r(I){console&&console.warn&&console.warn(I)}var i=Number.isNaN||function(I){return I!==I};function s(){s.init.call(this)}kh=s,kh.once=S,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var o=10;function a(I){if(typeof I!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof I)}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(I){if(typeof I!="number"||I<0||i(I))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+I+".");o=I}}),s.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(I){if(typeof I!="number"||I<0||i(I))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+I+".");return this._maxListeners=I,this};function l(I){return I._maxListeners===void 0?s.defaultMaxListeners:I._maxListeners}s.prototype.getMaxListeners=function(){return l(this)},s.prototype.emit=function(I){for(var x=[],$=1;$<arguments.length;$++)x.push(arguments[$]);var U=I==="error",O=this._events;if(O!==void 0)U=U&&O.error===void 0;else if(!U)return!1;if(U){var P;if(x.length>0&&(P=x[0]),P instanceof Error)throw P;var M=new Error("Unhandled error."+(P?" ("+P.message+")":""));throw M.context=P,M}var K=O[I];if(K===void 0)return!1;if(typeof K=="function")e(K,this,x);else for(var C=K.length,B=m(K,C),$=0;$<C;++$)e(B[$],this,x);return!0};function c(I,x,$,U){var O,P,M;if(a($),P=I._events,P===void 0?(P=I._events=Object.create(null),I._eventsCount=0):(P.newListener!==void 0&&(I.emit("newListener",x,$.listener?$.listener:$),P=I._events),M=P[x]),M===void 0)M=P[x]=$,++I._eventsCount;else if(typeof M=="function"?M=P[x]=U?[$,M]:[M,$]:U?M.unshift($):M.push($),O=l(I),O>0&&M.length>O&&!M.warned){M.warned=!0;var K=new Error("Possible EventEmitter memory leak detected. "+M.length+" "+String(x)+" listeners added. Use emitter.setMaxListeners() to increase limit");K.name="MaxListenersExceededWarning",K.emitter=I,K.type=x,K.count=M.length,r(K)}return I}s.prototype.addListener=function(I,x){return c(this,I,x,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(I,x){return c(this,I,x,!0)};function h(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function d(I,x,$){var U={fired:!1,wrapFn:void 0,target:I,type:x,listener:$},O=h.bind(U);return O.listener=$,U.wrapFn=O,O}s.prototype.once=function(I,x){return a(x),this.on(I,d(this,I,x)),this},s.prototype.prependOnceListener=function(I,x){return a(x),this.prependListener(I,d(this,I,x)),this},s.prototype.removeListener=function(I,x){var $,U,O,P,M;if(a(x),U=this._events,U===void 0)return this;if($=U[I],$===void 0)return this;if($===x||$.listener===x)--this._eventsCount===0?this._events=Object.create(null):(delete U[I],U.removeListener&&this.emit("removeListener",I,$.listener||x));else if(typeof $!="function"){for(O=-1,P=$.length-1;P>=0;P--)if($[P]===x||$[P].listener===x){M=$[P].listener,O=P;break}if(O<0)return this;O===0?$.shift():E($,O),$.length===1&&(U[I]=$[0]),U.removeListener!==void 0&&this.emit("removeListener",I,M||x)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(I){var x,$,U;if($=this._events,$===void 0)return this;if($.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):$[I]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete $[I]),this;if(arguments.length===0){var O=Object.keys($),P;for(U=0;U<O.length;++U)P=O[U],P!=="removeListener"&&this.removeAllListeners(P);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(x=$[I],typeof x=="function")this.removeListener(I,x);else if(x!==void 0)for(U=x.length-1;U>=0;U--)this.removeListener(I,x[U]);return this};function p(I,x,$){var U=I._events;if(U===void 0)return[];var O=U[x];return O===void 0?[]:typeof O=="function"?$?[O.listener||O]:[O]:$?y(O):m(O,O.length)}s.prototype.listeners=function(I){return p(this,I,!0)},s.prototype.rawListeners=function(I){return p(this,I,!1)},s.listenerCount=function(I,x){return typeof I.listenerCount=="function"?I.listenerCount(x):g.call(I,x)},s.prototype.listenerCount=g;function g(I){var x=this._events;if(x!==void 0){var $=x[I];if(typeof $=="function")return 1;if($!==void 0)return $.length}return 0}s.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]};function m(I,x){for(var $=new Array(x),U=0;U<x;++U)$[U]=I[U];return $}function E(I,x){for(;x+1<I.length;x++)I[x]=I[x+1];I.pop()}function y(I){for(var x=new Array(I.length),$=0;$<x.length;++$)x[$]=I[$].listener||I[$];return x}function S(I,x){return new Promise(function($,U){function O(M){I.removeListener(x,P),U(M)}function P(){typeof I.removeListener=="function"&&I.removeListener("error",O),$([].slice.call(arguments))}_(I,x,P,{once:!0}),x!=="error"&&b(I,O,{once:!0})})}function b(I,x,$){typeof I.on=="function"&&_(I,"error",x,$)}function _(I,x,$,U){if(typeof I.on=="function")U.once?I.once(x,$):I.on(x,$);else if(typeof I.addEventListener=="function")I.addEventListener(x,function O(P){U.once&&I.removeEventListener(x,O),$(P)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof I)}return kh}var kh,v_,Bc,FO,jO,qO,HO,WO,zO,Kl=ii(()=>{Oe(),Ne(),Le(),kh={},v_=!1,Bc=oj(),Bc.once,Bc.once=function(n,e){return new Promise((t,r)=>{function i(...o){s!==void 0&&n.removeListener("error",s),t(o)}let s;e!=="error"&&(s=o=>{n.removeListener(name,i),r(o)},n.once("error",s)),n.once(e,i)})},Bc.on=function(n,e){let t=[],r=[],i=null,s=!1,o={async next(){let c=t.shift();if(c)return createIterResult(c,!1);if(i){let h=Promise.reject(i);return i=null,h}return s?createIterResult(void 0,!0):new Promise((h,d)=>r.push({resolve:h,reject:d}))},async return(){n.removeListener(e,a),n.removeListener("error",l),s=!0;for(let c of r)c.resolve(createIterResult(void 0,!0));return createIterResult(void 0,!0)},throw(c){i=c,n.removeListener(e,a),n.removeListener("error",l)},[Symbol.asyncIterator](){return this}};return n.on(e,a),n.on("error",l),o;function a(...c){let h=r.shift();h?h.resolve(createIterResult(c,!1)):t.push(c)}function l(c){s=!0;let h=r.shift();h?h.reject(c):i=c,o.return()}},{EventEmitter:FO,defaultMaxListeners:jO,init:qO,listenerCount:HO,on:WO,once:zO}=Bc}),ri=$e((n,e)=>{Oe(),Ne(),Le();var t=(Jr(),nr(Qr)),{format:r,inspect:i}=UO(),{codes:{ERR_INVALID_ARG_TYPE:s}}=Fn(),{kResistStopPropagation:o,AggregateError:a,SymbolDispose:l}=Ir(),c=globalThis.AbortSignal||lf().AbortSignal,h=globalThis.AbortController||lf().AbortController,d=Object.getPrototypeOf(async function(){}).constructor,p=globalThis.Blob||t.Blob,g=typeof p<"u"?function(y){return y instanceof p}:function(y){return!1},m=(y,S)=>{if(y!==void 0&&(y===null||typeof y!="object"||!("aborted"in y)))throw new s(S,"AbortSignal",y)},E=(y,S)=>{if(typeof y!="function")throw new s(S,"Function",y)};e.exports={AggregateError:a,kEmptyObject:Object.freeze({}),once(y){let S=!1;return function(...b){S||(S=!0,y.apply(this,b))}},createDeferredPromise:function(){let y,S;return{promise:new Promise((b,_)=>{y=b,S=_}),resolve:y,reject:S}},promisify(y){return new Promise((S,b)=>{y((_,...I)=>_?b(_):S(...I))})},debuglog(){return function(){}},format:r,inspect:i,types:{isAsyncFunction(y){return y instanceof d},isArrayBufferView(y){return ArrayBuffer.isView(y)}},isBlob:g,deprecate(y,S){return y},addAbortListener:(Kl(),nr(Aa)).addAbortListener||function(y,S){if(y===void 0)throw new s("signal","AbortSignal",y);m(y,"signal"),E(S,"listener");let b;return y.aborted?queueMicrotask(()=>S()):(y.addEventListener("abort",S,{__proto__:null,once:!0,[o]:!0}),b=()=>{y.removeEventListener("abort",S)}),{__proto__:null,[l](){var _;(_=b)===null||_===void 0||_()}}},AbortSignalAny:c.any||function(y){if(y.length===1)return y[0];let S=new h,b=()=>S.abort();return y.forEach(_=>{m(_,"signals"),_.addEventListener("abort",b,{once:!0})}),S.signal.addEventListener("abort",()=>{y.forEach(_=>_.removeEventListener("abort",b))},{once:!0}),S.signal}},e.exports.promisify.custom=Symbol.for("nodejs.util.promisify.custom")}),qf=$e((n,e)=>{Oe(),Ne(),Le();var{ArrayIsArray:t,ArrayPrototypeIncludes:r,ArrayPrototypeJoin:i,ArrayPrototypeMap:s,NumberIsInteger:o,NumberIsNaN:a,NumberMAX_SAFE_INTEGER:l,NumberMIN_SAFE_INTEGER:c,NumberParseInt:h,ObjectPrototypeHasOwnProperty:d,RegExpPrototypeExec:p,String:g,StringPrototypeToUpperCase:m,StringPrototypeTrim:E}=Ir(),{hideStackFrames:y,codes:{ERR_SOCKET_BAD_PORT:S,ERR_INVALID_ARG_TYPE:b,ERR_INVALID_ARG_VALUE:_,ERR_OUT_OF_RANGE:I,ERR_UNKNOWN_SIGNAL:x}}=Fn(),{normalizeEncoding:$}=ri(),{isAsyncFunction:U,isArrayBufferView:O}=ri().types,P={};function M(ye){return ye===(ye|0)}function K(ye){return ye===ye>>>0}var C=/^[0-7]+$/,B="must be a 32-bit unsigned integer or an octal string";function N(ye,Re,Fe){if(typeof ye>"u"&&(ye=Fe),typeof ye=="string"){if(p(C,ye)===null)throw new _(Re,ye,B);ye=h(ye,8)}return W(ye,Re),ye}var L=y((ye,Re,Fe=c,Ce=l)=>{if(typeof ye!="number")throw new b(Re,"number",ye);if(!o(ye))throw new I(Re,"an integer",ye);if(ye<Fe||ye>Ce)throw new I(Re,`>= ${Fe} && <= ${Ce}`,ye)}),V=y((ye,Re,Fe=-2147483648,Ce=2147483647)=>{if(typeof ye!="number")throw new b(Re,"number",ye);if(!o(ye))throw new I(Re,"an integer",ye);if(ye<Fe||ye>Ce)throw new I(Re,`>= ${Fe} && <= ${Ce}`,ye)}),W=y((ye,Re,Fe=!1)=>{if(typeof ye!="number")throw new b(Re,"number",ye);if(!o(ye))throw new I(Re,"an integer",ye);let Ce=Fe?1:0,et=4294967295;if(ye<Ce||ye>et)throw new I(Re,`>= ${Ce} && <= ${et}`,ye)});function H(ye,Re){if(typeof ye!="string")throw new b(Re,"string",ye)}function G(ye,Re,Fe=void 0,Ce){if(typeof ye!="number")throw new b(Re,"number",ye);if(Fe!=null&&ye<Fe||Ce!=null&&ye>Ce||(Fe!=null||Ce!=null)&&a(ye))throw new I(Re,`${Fe!=null?`>= ${Fe}`:""}${Fe!=null&&Ce!=null?" && ":""}${Ce!=null?`<= ${Ce}`:""}`,ye)}var z=y((ye,Re,Fe)=>{if(!r(Fe,ye)){let Ce="must be one of: "+i(s(Fe,et=>typeof et=="string"?`'${et}'`:g(et)),", ");throw new _(Re,ye,Ce)}});function Z(ye,Re){if(typeof ye!="boolean")throw new b(Re,"boolean",ye)}function F(ye,Re,Fe){return ye==null||!d(ye,Re)?Fe:ye[Re]}var ie=y((ye,Re,Fe=null)=>{let Ce=F(Fe,"allowArray",!1),et=F(Fe,"allowFunction",!1);if(!F(Fe,"nullable",!1)&&ye===null||!Ce&&t(ye)||typeof ye!="object"&&(!et||typeof ye!="function"))throw new b(Re,"Object",ye)}),fe=y((ye,Re)=>{if(ye!=null&&typeof ye!="object"&&typeof ye!="function")throw new b(Re,"a dictionary",ye)}),J=y((ye,Re,Fe=0)=>{if(!t(ye))throw new b(Re,"Array",ye);if(ye.length<Fe){let Ce=`must be longer than ${Fe}`;throw new _(Re,ye,Ce)}});function _e(ye,Re){J(ye,Re);for(let Fe=0;Fe<ye.length;Fe++)H(ye[Fe],`${Re}[${Fe}]`)}function oe(ye,Re){J(ye,Re);for(let Fe=0;Fe<ye.length;Fe++)Z(ye[Fe],`${Re}[${Fe}]`)}function ne(ye,Re){J(ye,Re);for(let Fe=0;Fe<ye.length;Fe++){let Ce=ye[Fe],et=`${Re}[${Fe}]`;if(Ce==null)throw new b(et,"AbortSignal",Ce);me(Ce,et)}}function de(ye,Re="signal"){if(H(ye,Re),P[ye]===void 0)throw P[m(ye)]!==void 0?new x(ye+" (signals must use all capital letters)"):new x(ye)}var k=y((ye,Re="buffer")=>{if(!O(ye))throw new b(Re,["Buffer","TypedArray","DataView"],ye)});function X(ye,Re){let Fe=$(Re),Ce=ye.length;if(Fe==="hex"&&Ce%2!==0)throw new _("encoding",Re,`is invalid for data of length ${Ce}`)}function ee(ye,Re="Port",Fe=!0){if(typeof ye!="number"&&typeof ye!="string"||typeof ye=="string"&&E(ye).length===0||+ye!==+ye>>>0||ye>65535||ye===0&&!Fe)throw new S(Re,ye,Fe);return ye|0}var me=y((ye,Re)=>{if(ye!==void 0&&(ye===null||typeof ye!="object"||!("aborted"in ye)))throw new b(Re,"AbortSignal",ye)}),be=y((ye,Re)=>{if(typeof ye!="function")throw new b(Re,"Function",ye)}),te=y((ye,Re)=>{if(typeof ye!="function"||U(ye))throw new b(Re,"Function",ye)}),le=y((ye,Re)=>{if(ye!==void 0)throw new b(Re,"undefined",ye)});function ge(ye,Re,Fe){if(!r(Fe,ye))throw new b(Re,`('${i(Fe,"|")}')`,ye)}var Ie=/^(?:<[^>]*>)(?:\s*;\s*[^;"\s]+(?:=(")?[^;"\s]*\1)?)*$/;function Ae(ye,Re){if(typeof ye>"u"||!p(Ie,ye))throw new _(Re,ye,'must be an array or string of format "</styles.css>; rel=preload; as=style"')}function Te(ye){if(typeof ye=="string")return Ae(ye,"hints"),ye;if(t(ye)){let Re=ye.length,Fe="";if(Re===0)return Fe;for(let Ce=0;Ce<Re;Ce++){let et=ye[Ce];Ae(et,"hints"),Fe+=et,Ce!==Re-1&&(Fe+=", ")}return Fe}throw new _("hints",ye,'must be an array or string of format "</styles.css>; rel=preload; as=style"')}e.exports={isInt32:M,isUint32:K,parseFileMode:N,validateArray:J,validateStringArray:_e,validateBooleanArray:oe,validateAbortSignalArray:ne,validateBoolean:Z,validateBuffer:k,validateDictionary:fe,validateEncoding:X,validateFunction:be,validateInt32:V,validateInteger:L,validateNumber:G,validateObject:ie,validateOneOf:z,validatePlainFunction:te,validatePort:ee,validateSignalName:de,validateString:H,validateUint32:W,validateUndefined:le,validateUnion:ge,validateAbortSignal:me,validateLinkHeaderValue:Te}}),Vl=$e((n,e)=>{Oe(),Ne(),Le();var t=e.exports={},r,i;function s(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?r=setTimeout:r=s}catch{r=s}try{typeof clearTimeout=="function"?i=clearTimeout:i=o}catch{i=o}})();function a(S){if(r===setTimeout)return setTimeout(S,0);if((r===s||!r)&&setTimeout)return r=setTimeout,setTimeout(S,0);try{return r(S,0)}catch{try{return r.call(null,S,0)}catch{return r.call(this,S,0)}}}function l(S){if(i===clearTimeout)return clearTimeout(S);if((i===o||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(S);try{return i(S)}catch{try{return i.call(null,S)}catch{return i.call(this,S)}}}var c=[],h=!1,d,p=-1;function g(){!h||!d||(h=!1,d.length?c=d.concat(c):p=-1,c.length&&m())}function m(){if(!h){var S=a(g);h=!0;for(var b=c.length;b;){for(d=c,c=[];++p<b;)d&&d[p].run();p=-1,b=c.length}d=null,h=!1,l(S)}}t.nextTick=function(S){var b=new Array(arguments.length-1);if(arguments.length>1)for(var _=1;_<arguments.length;_++)b[_-1]=arguments[_];c.push(new E(S,b)),c.length===1&&!h&&a(m)};function E(S,b){this.fun=S,this.array=b}E.prototype.run=function(){this.fun.apply(null,this.array)},t.title="browser",t.browser=!0,t.env={},t.argv=[],t.version="",t.versions={};function y(){}t.on=y,t.addListener=y,t.once=y,t.off=y,t.removeListener=y,t.removeAllListeners=y,t.emit=y,t.prependListener=y,t.prependOnceListener=y,t.listeners=function(S){return[]},t.binding=function(S){throw new Error("process.binding is not supported")},t.cwd=function(){return"/"},t.chdir=function(S){throw new Error("process.chdir is not supported")},t.umask=function(){return 0}}),_o=$e((n,e)=>{Oe(),Ne(),Le();var{SymbolAsyncIterator:t,SymbolIterator:r,SymbolFor:i}=Ir(),s=i("nodejs.stream.destroyed"),o=i("nodejs.stream.errored"),a=i("nodejs.stream.readable"),l=i("nodejs.stream.writable"),c=i("nodejs.stream.disturbed"),h=i("nodejs.webstream.isClosedPromise"),d=i("nodejs.webstream.controllerErrorFunction");function p(F,ie=!1){var fe;return!!(F&&typeof F.pipe=="function"&&typeof F.on=="function"&&(!ie||typeof F.pause=="function"&&typeof F.resume=="function")&&(!F._writableState||((fe=F._readableState)===null||fe===void 0?void 0:fe.readable)!==!1)&&(!F._writableState||F._readableState))}function g(F){var ie;return!!(F&&typeof F.write=="function"&&typeof F.on=="function"&&(!F._readableState||((ie=F._writableState)===null||ie===void 0?void 0:ie.writable)!==!1))}function m(F){return!!(F&&typeof F.pipe=="function"&&F._readableState&&typeof F.on=="function"&&typeof F.write=="function")}function E(F){return F&&(F._readableState||F._writableState||typeof F.write=="function"&&typeof F.on=="function"||typeof F.pipe=="function"&&typeof F.on=="function")}function y(F){return!!(F&&!E(F)&&typeof F.pipeThrough=="function"&&typeof F.getReader=="function"&&typeof F.cancel=="function")}function S(F){return!!(F&&!E(F)&&typeof F.getWriter=="function"&&typeof F.abort=="function")}function b(F){return!!(F&&!E(F)&&typeof F.readable=="object"&&typeof F.writable=="object")}function _(F){return y(F)||S(F)||b(F)}function I(F,ie){return F==null?!1:ie===!0?typeof F[t]=="function":ie===!1?typeof F[r]=="function":typeof F[t]=="function"||typeof F[r]=="function"}function x(F){if(!E(F))return null;let ie=F._writableState,fe=F._readableState,J=ie||fe;return!!(F.destroyed||F[s]||J!=null&&J.destroyed)}function $(F){if(!g(F))return null;if(F.writableEnded===!0)return!0;let ie=F._writableState;return ie!=null&&ie.errored?!1:typeof(ie==null?void 0:ie.ended)!="boolean"?null:ie.ended}function U(F,ie){if(!g(F))return null;if(F.writableFinished===!0)return!0;let fe=F._writableState;return fe!=null&&fe.errored?!1:typeof(fe==null?void 0:fe.finished)!="boolean"?null:!!(fe.finished||ie===!1&&fe.ended===!0&&fe.length===0)}function O(F){if(!p(F))return null;if(F.readableEnded===!0)return!0;let ie=F._readableState;return!ie||ie.errored?!1:typeof(ie==null?void 0:ie.ended)!="boolean"?null:ie.ended}function P(F,ie){if(!p(F))return null;let fe=F._readableState;return fe!=null&&fe.errored?!1:typeof(fe==null?void 0:fe.endEmitted)!="boolean"?null:!!(fe.endEmitted||ie===!1&&fe.ended===!0&&fe.length===0)}function M(F){return F&&F[a]!=null?F[a]:typeof(F==null?void 0:F.readable)!="boolean"?null:x(F)?!1:p(F)&&F.readable&&!P(F)}function K(F){return F&&F[l]!=null?F[l]:typeof(F==null?void 0:F.writable)!="boolean"?null:x(F)?!1:g(F)&&F.writable&&!$(F)}function C(F,ie){return E(F)?x(F)?!0:!((ie==null?void 0:ie.readable)!==!1&&M(F)||(ie==null?void 0:ie.writable)!==!1&&K(F)):null}function B(F){var ie,fe;return E(F)?F.writableErrored?F.writableErrored:(ie=(fe=F._writableState)===null||fe===void 0?void 0:fe.errored)!==null&&ie!==void 0?ie:null:null}function N(F){var ie,fe;return E(F)?F.readableErrored?F.readableErrored:(ie=(fe=F._readableState)===null||fe===void 0?void 0:fe.errored)!==null&&ie!==void 0?ie:null:null}function L(F){if(!E(F))return null;if(typeof F.closed=="boolean")return F.closed;let ie=F._writableState,fe=F._readableState;return typeof(ie==null?void 0:ie.closed)=="boolean"||typeof(fe==null?void 0:fe.closed)=="boolean"?(ie==null?void 0:ie.closed)||(fe==null?void 0:fe.closed):typeof F._closed=="boolean"&&V(F)?F._closed:null}function V(F){return typeof F._closed=="boolean"&&typeof F._defaultKeepAlive=="boolean"&&typeof F._removedConnection=="boolean"&&typeof F._removedContLen=="boolean"}function W(F){return typeof F._sent100=="boolean"&&V(F)}function H(F){var ie;return typeof F._consuming=="boolean"&&typeof F._dumped=="boolean"&&((ie=F.req)===null||ie===void 0?void 0:ie.upgradeOrConnect)===void 0}function G(F){if(!E(F))return null;let ie=F._writableState,fe=F._readableState,J=ie||fe;return!J&&W(F)||!!(J&&J.autoDestroy&&J.emitClose&&J.closed===!1)}function z(F){var ie;return!!(F&&((ie=F[c])!==null&&ie!==void 0?ie:F.readableDidRead||F.readableAborted))}function Z(F){var ie,fe,J,_e,oe,ne,de,k,X,ee;return!!(F&&((ie=(fe=(J=(_e=(oe=(ne=F[o])!==null&&ne!==void 0?ne:F.readableErrored)!==null&&oe!==void 0?oe:F.writableErrored)!==null&&_e!==void 0?_e:(de=F._readableState)===null||de===void 0?void 0:de.errorEmitted)!==null&&J!==void 0?J:(k=F._writableState)===null||k===void 0?void 0:k.errorEmitted)!==null&&fe!==void 0?fe:(X=F._readableState)===null||X===void 0?void 0:X.errored)!==null&&ie!==void 0?ie:!((ee=F._writableState)===null||ee===void 0)&&ee.errored))}e.exports={isDestroyed:x,kIsDestroyed:s,isDisturbed:z,kIsDisturbed:c,isErrored:Z,kIsErrored:o,isReadable:M,kIsReadable:a,kIsClosedPromise:h,kControllerErrorFunction:d,kIsWritable:l,isClosed:L,isDuplexNodeStream:m,isFinished:C,isIterable:I,isReadableNodeStream:p,isReadableStream:y,isReadableEnded:O,isReadableFinished:P,isReadableErrored:N,isNodeStream:E,isWebStream:_,isWritable:K,isWritableNodeStream:g,isWritableStream:S,isWritableEnded:$,isWritableFinished:U,isWritableErrored:B,isServerRequest:H,isServerResponse:W,willEmitClose:G,isTransformStream:b}}),xa=$e((n,e)=>{Oe(),Ne(),Le();var t=Vl(),{AbortError:r,codes:i}=Fn(),{ERR_INVALID_ARG_TYPE:s,ERR_STREAM_PREMATURE_CLOSE:o}=i,{kEmptyObject:a,once:l}=ri(),{validateAbortSignal:c,validateFunction:h,validateObject:d,validateBoolean:p}=qf(),{Promise:g,PromisePrototypeThen:m,SymbolDispose:E}=Ir(),{isClosed:y,isReadable:S,isReadableNodeStream:b,isReadableStream:_,isReadableFinished:I,isReadableErrored:x,isWritable:$,isWritableNodeStream:U,isWritableStream:O,isWritableFinished:P,isWritableErrored:M,isNodeStream:K,willEmitClose:C,kIsClosedPromise:B}=_o(),N;function L(z){return z.setHeader&&typeof z.abort=="function"}var V=()=>{};function W(z,Z,F){var ie,fe;if(arguments.length===2?(F=Z,Z=a):Z==null?Z=a:d(Z,"options"),h(F,"callback"),c(Z.signal,"options.signal"),F=l(F),_(z)||O(z))return H(z,Z,F);if(!K(z))throw new s("stream",["ReadableStream","WritableStream","Stream"],z);let J=(ie=Z.readable)!==null&&ie!==void 0?ie:b(z),_e=(fe=Z.writable)!==null&&fe!==void 0?fe:U(z),oe=z._writableState,ne=z._readableState,de=()=>{z.writable||ee()},k=C(z)&&b(z)===J&&U(z)===_e,X=P(z,!1),ee=()=>{X=!0,z.destroyed&&(k=!1),!(k&&(!z.readable||J))&&(!J||me)&&F.call(z)},me=I(z,!1),be=()=>{me=!0,z.destroyed&&(k=!1),!(k&&(!z.writable||_e))&&(!_e||X)&&F.call(z)},te=ye=>{F.call(z,ye)},le=y(z),ge=()=>{le=!0;let ye=M(z)||x(z);if(ye&&typeof ye!="boolean")return F.call(z,ye);if(J&&!me&&b(z,!0)&&!I(z,!1))return F.call(z,new o);if(_e&&!X&&!P(z,!1))return F.call(z,new o);F.call(z)},Ie=()=>{le=!0;let ye=M(z)||x(z);if(ye&&typeof ye!="boolean")return F.call(z,ye);F.call(z)},Ae=()=>{z.req.on("finish",ee)};L(z)?(z.on("complete",ee),k||z.on("abort",ge),z.req?Ae():z.on("request",Ae)):_e&&!oe&&(z.on("end",de),z.on("close",de)),!k&&typeof z.aborted=="boolean"&&z.on("aborted",ge),z.on("end",be),z.on("finish",ee),Z.error!==!1&&z.on("error",te),z.on("close",ge),le?t.nextTick(ge):oe!=null&&oe.errorEmitted||ne!=null&&ne.errorEmitted?k||t.nextTick(Ie):(!J&&(!k||S(z))&&(X||$(z)===!1)||!_e&&(!k||$(z))&&(me||S(z)===!1)||ne&&z.req&&z.aborted)&&t.nextTick(Ie);let Te=()=>{F=V,z.removeListener("aborted",ge),z.removeListener("complete",ee),z.removeListener("abort",ge),z.removeListener("request",Ae),z.req&&z.req.removeListener("finish",ee),z.removeListener("end",de),z.removeListener("close",de),z.removeListener("finish",ee),z.removeListener("end",be),z.removeListener("error",te),z.removeListener("close",ge)};if(Z.signal&&!le){let ye=()=>{let Re=F;Te(),Re.call(z,new r(void 0,{cause:Z.signal.reason}))};if(Z.signal.aborted)t.nextTick(ye);else{N=N||ri().addAbortListener;let Re=N(Z.signal,ye),Fe=F;F=l((...Ce)=>{Re[E](),Fe.apply(z,Ce)})}}return Te}function H(z,Z,F){let ie=!1,fe=V;if(Z.signal)if(fe=()=>{ie=!0,F.call(z,new r(void 0,{cause:Z.signal.reason}))},Z.signal.aborted)t.nextTick(fe);else{N=N||ri().addAbortListener;let _e=N(Z.signal,fe),oe=F;F=l((...ne)=>{_e[E](),oe.apply(z,ne)})}let J=(..._e)=>{ie||t.nextTick(()=>F.apply(z,_e))};return m(z[B].promise,J,J),V}function G(z,Z){var F;let ie=!1;return Z===null&&(Z=a),(F=Z)!==null&&F!==void 0&&F.cleanup&&(p(Z.cleanup,"cleanup"),ie=Z.cleanup),new g((fe,J)=>{let _e=W(z,Z,oe=>{ie&&_e(),oe?J(oe):fe()})})}e.exports=W,e.exports.finished=G}),qu=$e((n,e)=>{Oe(),Ne(),Le();var t=Vl(),{aggregateTwoErrors:r,codes:{ERR_MULTIPLE_CALLBACK:i},AbortError:s}=Fn(),{Symbol:o}=Ir(),{kIsDestroyed:a,isDestroyed:l,isFinished:c,isServerRequest:h}=_o(),d=o("kDestroy"),p=o("kConstruct");function g(C,B,N){C&&(C.stack,B&&!B.errored&&(B.errored=C),N&&!N.errored&&(N.errored=C))}function m(C,B){let N=this._readableState,L=this._writableState,V=L||N;return L!=null&&L.destroyed||N!=null&&N.destroyed?(typeof B=="function"&&B(),this):(g(C,L,N),L&&(L.destroyed=!0),N&&(N.destroyed=!0),V.constructed?E(this,C,B):this.once(d,function(W){E(this,r(W,C),B)}),this)}function E(C,B,N){let L=!1;function V(W){if(L)return;L=!0;let H=C._readableState,G=C._writableState;g(W,G,H),G&&(G.closed=!0),H&&(H.closed=!0),typeof N=="function"&&N(W),W?t.nextTick(y,C,W):t.nextTick(S,C)}try{C._destroy(B||null,V)}catch(W){V(W)}}function y(C,B){b(C,B),S(C)}function S(C){let B=C._readableState,N=C._writableState;N&&(N.closeEmitted=!0),B&&(B.closeEmitted=!0),(N!=null&&N.emitClose||B!=null&&B.emitClose)&&C.emit("close")}function b(C,B){let N=C._readableState,L=C._writableState;L!=null&&L.errorEmitted||N!=null&&N.errorEmitted||(L&&(L.errorEmitted=!0),N&&(N.errorEmitted=!0),C.emit("error",B))}function _(){let C=this._readableState,B=this._writableState;C&&(C.constructed=!0,C.closed=!1,C.closeEmitted=!1,C.destroyed=!1,C.errored=null,C.errorEmitted=!1,C.reading=!1,C.ended=C.readable===!1,C.endEmitted=C.readable===!1),B&&(B.constructed=!0,B.destroyed=!1,B.closed=!1,B.closeEmitted=!1,B.errored=null,B.errorEmitted=!1,B.finalCalled=!1,B.prefinished=!1,B.ended=B.writable===!1,B.ending=B.writable===!1,B.finished=B.writable===!1)}function I(C,B,N){let L=C._readableState,V=C._writableState;if(V!=null&&V.destroyed||L!=null&&L.destroyed)return this;L!=null&&L.autoDestroy||V!=null&&V.autoDestroy?C.destroy(B):B&&(B.stack,V&&!V.errored&&(V.errored=B),L&&!L.errored&&(L.errored=B),N?t.nextTick(b,C,B):b(C,B))}function x(C,B){if(typeof C._construct!="function")return;let N=C._readableState,L=C._writableState;N&&(N.constructed=!1),L&&(L.constructed=!1),C.once(p,B),!(C.listenerCount(p)>1)&&t.nextTick($,C)}function $(C){let B=!1;function N(L){if(B){I(C,L??new i);return}B=!0;let V=C._readableState,W=C._writableState,H=W||V;V&&(V.constructed=!0),W&&(W.constructed=!0),H.destroyed?C.emit(d,L):L?I(C,L,!0):t.nextTick(U,C)}try{C._construct(L=>{t.nextTick(N,L)})}catch(L){t.nextTick(N,L)}}function U(C){C.emit(p)}function O(C){return(C==null?void 0:C.setHeader)&&typeof C.abort=="function"}function P(C){C.emit("close")}function M(C,B){C.emit("error",B),t.nextTick(P,C)}function K(C,B){!C||l(C)||(!B&&!c(C)&&(B=new s),h(C)?(C.socket=null,C.destroy(B)):O(C)?C.abort():O(C.req)?C.req.abort():typeof C.destroy=="function"?C.destroy(B):typeof C.close=="function"?C.close():B?t.nextTick(M,C,B):t.nextTick(P,C),C.destroyed||(C[a]=!0))}e.exports={construct:x,destroyer:K,destroy:m,undestroy:_,errorOrDestroy:I}}),KE=$e((n,e)=>{Oe(),Ne(),Le();var{ArrayIsArray:t,ObjectSetPrototypeOf:r}=Ir(),{EventEmitter:i}=(Kl(),nr(Aa));function s(a){i.call(this,a)}r(s.prototype,i.prototype),r(s,i),s.prototype.pipe=function(a,l){let c=this;function h(S){a.writable&&a.write(S)===!1&&c.pause&&c.pause()}c.on("data",h);function d(){c.readable&&c.resume&&c.resume()}a.on("drain",d),!a._isStdio&&(!l||l.end!==!1)&&(c.on("end",g),c.on("close",m));let p=!1;function g(){p||(p=!0,a.end())}function m(){p||(p=!0,typeof a.destroy=="function"&&a.destroy())}function E(S){y(),i.listenerCount(this,"error")===0&&this.emit("error",S)}o(c,"error",E),o(a,"error",E);function y(){c.removeListener("data",h),a.removeListener("drain",d),c.removeListener("end",g),c.removeListener("close",m),c.removeListener("error",E),a.removeListener("error",E),c.removeListener("end",y),c.removeListener("close",y),a.removeListener("close",y)}return c.on("end",y),c.on("close",y),a.on("close",y),a.emit("pipe",c),a};function o(a,l,c){if(typeof a.prependListener=="function")return a.prependListener(l,c);!a._events||!a._events[l]?a.on(l,c):t(a._events[l])?a._events[l].unshift(c):a._events[l]=[c,a._events[l]]}e.exports={Stream:s,prependListener:o}}),Sy=$e((n,e)=>{Oe(),Ne(),Le();var{SymbolDispose:t}=Ir(),{AbortError:r,codes:i}=Fn(),{isNodeStream:s,isWebStream:o,kControllerErrorFunction:a}=_o(),l=xa(),{ERR_INVALID_ARG_TYPE:c}=i,h,d=(p,g)=>{if(typeof p!="object"||!("aborted"in p))throw new c(g,"AbortSignal",p)};e.exports.addAbortSignal=function(p,g){if(d(p,"signal"),!s(g)&&!o(g))throw new c("stream",["ReadableStream","WritableStream","Stream"],g);return e.exports.addAbortSignalNoValidate(p,g)},e.exports.addAbortSignalNoValidate=function(p,g){if(typeof p!="object"||!("aborted"in p))return g;let m=s(g)?()=>{g.destroy(new r(void 0,{cause:p.reason}))}:()=>{g[a](new r(void 0,{cause:p.reason}))};if(p.aborted)m();else{h=h||ri().addAbortListener;let E=h(p,m);l(g,E[t])}return g}}),aj=$e((n,e)=>{Oe(),Ne(),Le();var{StringPrototypeSlice:t,SymbolIterator:r,TypedArrayPrototypeSet:i,Uint8Array:s}=Ir(),{Buffer:o}=(Jr(),nr(Qr)),{inspect:a}=ri();e.exports=class{constructor(){this.head=null,this.tail=null,this.length=0}push(l){let c={data:l,next:null};this.length>0?this.tail.next=c:this.head=c,this.tail=c,++this.length}unshift(l){let c={data:l,next:this.head};this.length===0&&(this.tail=c),this.head=c,++this.length}shift(){if(this.length===0)return;let l=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,l}clear(){this.head=this.tail=null,this.length=0}join(l){if(this.length===0)return"";let c=this.head,h=""+c.data;for(;(c=c.next)!==null;)h+=l+c.data;return h}concat(l){if(this.length===0)return o.alloc(0);let c=o.allocUnsafe(l>>>0),h=this.head,d=0;for(;h;)i(c,h.data,d),d+=h.data.length,h=h.next;return c}consume(l,c){let h=this.head.data;if(l<h.length){let d=h.slice(0,l);return this.head.data=h.slice(l),d}return l===h.length?this.shift():c?this._getString(l):this._getBuffer(l)}first(){return this.head.data}*[r](){for(let l=this.head;l;l=l.next)yield l.data}_getString(l){let c="",h=this.head,d=0;do{let p=h.data;if(l>p.length)c+=p,l-=p.length;else{l===p.length?(c+=p,++d,h.next?this.head=h.next:this.head=this.tail=null):(c+=t(p,0,l),this.head=h,h.data=t(p,l));break}++d}while((h=h.next)!==null);return this.length-=d,c}_getBuffer(l){let c=o.allocUnsafe(l),h=l,d=this.head,p=0;do{let g=d.data;if(l>g.length)i(c,g,h-l),l-=g.length;else{l===g.length?(i(c,g,h-l),++p,d.next?this.head=d.next:this.head=this.tail=null):(i(c,new s(g.buffer,g.byteOffset,l),h-l),this.head=d,d.data=g.slice(l));break}++p}while((d=d.next)!==null);return this.length-=p,c}[Symbol.for("nodejs.util.inspect.custom")](l,c){return a(this,{...c,depth:0,customInspect:!1})}}}),Ay=$e((n,e)=>{Oe(),Ne(),Le();var{MathFloor:t,NumberIsInteger:r}=Ir(),{validateInteger:i}=qf(),{ERR_INVALID_ARG_VALUE:s}=Fn().codes,o=16*1024,a=16;function l(p,g,m){return p.highWaterMark!=null?p.highWaterMark:g?p[m]:null}function c(p){return p?a:o}function h(p,g){i(g,"value",0),p?a=g:o=g}function d(p,g,m,E){let y=l(g,E,m);if(y!=null){if(!r(y)||y<0){let S=E?`options.${m}`:"options.highWaterMark";throw new s(S,y)}return t(y)}return c(p.objectMode)}e.exports={getHighWaterMark:d,getDefaultHighWaterMark:c,setDefaultHighWaterMark:h}}),lj=$e((n,e)=>{Oe(),Ne(),Le();var t=(Jr(),nr(Qr)),r=t.Buffer;function i(o,a){for(var l in o)a[l]=o[l]}r.from&&r.alloc&&r.allocUnsafe&&r.allocUnsafeSlow?e.exports=t:(i(t,n),n.Buffer=s);function s(o,a,l){return r(o,a,l)}s.prototype=Object.create(r.prototype),i(r,s),s.from=function(o,a,l){if(typeof o=="number")throw new TypeError("Argument must not be a number");return r(o,a,l)},s.alloc=function(o,a,l){if(typeof o!="number")throw new TypeError("Argument must be a number");var c=r(o);return a!==void 0?typeof l=="string"?c.fill(a,l):c.fill(a):c.fill(0),c},s.allocUnsafe=function(o){if(typeof o!="number")throw new TypeError("Argument must be a number");return r(o)},s.allocUnsafeSlow=function(o){if(typeof o!="number")throw new TypeError("Argument must be a number");return t.SlowBuffer(o)}}),cj=$e(n=>{Oe(),Ne(),Le();var e=lj().Buffer,t=e.isEncoding||function(b){switch(b=""+b,b&&b.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function r(b){if(!b)return"utf8";for(var _;;)switch(b){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return b;default:if(_)return;b=(""+b).toLowerCase(),_=!0}}function i(b){var _=r(b);if(typeof _!="string"&&(e.isEncoding===t||!t(b)))throw new Error("Unknown encoding: "+b);return _||b}n.StringDecoder=s;function s(b){this.encoding=i(b);var _;switch(this.encoding){case"utf16le":this.text=p,this.end=g,_=4;break;case"utf8":this.fillLast=c,_=4;break;case"base64":this.text=m,this.end=E,_=3;break;default:this.write=y,this.end=S;return}this.lastNeed=0,this.lastTotal=0,this.lastChar=e.allocUnsafe(_)}s.prototype.write=function(b){if(b.length===0)return"";var _,I;if(this.lastNeed){if(_=this.fillLast(b),_===void 0)return"";I=this.lastNeed,this.lastNeed=0}else I=0;return I<b.length?_?_+this.text(b,I):this.text(b,I):_||""},s.prototype.end=d,s.prototype.text=h,s.prototype.fillLast=function(b){if(this.lastNeed<=b.length)return b.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);b.copy(this.lastChar,this.lastTotal-this.lastNeed,0,b.length),this.lastNeed-=b.length};function o(b){return b<=127?0:b>>5===6?2:b>>4===14?3:b>>3===30?4:b>>6===2?-1:-2}function a(b,_,I){var x=_.length-1;if(x<I)return 0;var $=o(_[x]);return $>=0?($>0&&(b.lastNeed=$-1),$):--x<I||$===-2?0:($=o(_[x]),$>=0?($>0&&(b.lastNeed=$-2),$):--x<I||$===-2?0:($=o(_[x]),$>=0?($>0&&($===2?$=0:b.lastNeed=$-3),$):0))}function l(b,_,I){if((_[0]&192)!==128)return b.lastNeed=0,"";if(b.lastNeed>1&&_.length>1){if((_[1]&192)!==128)return b.lastNeed=1,"";if(b.lastNeed>2&&_.length>2&&(_[2]&192)!==128)return b.lastNeed=2,""}}function c(b){var _=this.lastTotal-this.lastNeed,I=l(this,b);if(I!==void 0)return I;if(this.lastNeed<=b.length)return b.copy(this.lastChar,_,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);b.copy(this.lastChar,_,0,b.length),this.lastNeed-=b.length}function h(b,_){var I=a(this,b,_);if(!this.lastNeed)return b.toString("utf8",_);this.lastTotal=I;var x=b.length-(I-this.lastNeed);return b.copy(this.lastChar,0,x),b.toString("utf8",_,x)}function d(b){var _=b&&b.length?this.write(b):"";return this.lastNeed?_+"":_}function p(b,_){if((b.length-_)%2===0){var I=b.toString("utf16le",_);if(I){var x=I.charCodeAt(I.length-1);if(x>=55296&&x<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=b[b.length-2],this.lastChar[1]=b[b.length-1],I.slice(0,-1)}return I}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=b[b.length-1],b.toString("utf16le",_,b.length-1)}function g(b){var _=b&&b.length?this.write(b):"";if(this.lastNeed){var I=this.lastTotal-this.lastNeed;return _+this.lastChar.toString("utf16le",0,I)}return _}function m(b,_){var I=(b.length-_)%3;return I===0?b.toString("base64",_):(this.lastNeed=3-I,this.lastTotal=3,I===1?this.lastChar[0]=b[b.length-1]:(this.lastChar[0]=b[b.length-2],this.lastChar[1]=b[b.length-1]),b.toString("base64",_,b.length-I))}function E(b){var _=b&&b.length?this.write(b):"";return this.lastNeed?_+this.lastChar.toString("base64",0,3-this.lastNeed):_}function y(b){return b.toString(this.encoding)}function S(b){return b&&b.length?this.write(b):""}}),KO=$e((n,e)=>{Oe(),Ne(),Le();var t=Vl(),{PromisePrototypeThen:r,SymbolAsyncIterator:i,SymbolIterator:s}=Ir(),{Buffer:o}=(Jr(),nr(Qr)),{ERR_INVALID_ARG_TYPE:a,ERR_STREAM_NULL_VALUES:l}=Fn().codes;function c(h,d,p){let g;if(typeof d=="string"||d instanceof o)return new h({objectMode:!0,...p,read(){this.push(d),this.push(null)}});let m;if(d&&d[i])m=!0,g=d[i]();else if(d&&d[s])m=!1,g=d[s]();else throw new a("iterable",["Iterable"],d);let E=new h({objectMode:!0,highWaterMark:1,...p}),y=!1;E._read=function(){y||(y=!0,b())},E._destroy=function(_,I){r(S(_),()=>t.nextTick(I,_),x=>t.nextTick(I,x||_))};async function S(_){let I=_!=null,x=typeof g.throw=="function";if(I&&x){let{value:$,done:U}=await g.throw(_);if(await $,U)return}if(typeof g.return=="function"){let{value:$}=await g.return();await $}}async function b(){for(;;){try{let{value:_,done:I}=m?await g.next():g.next();if(I)E.push(null);else{let x=_&&typeof _.then=="function"?await _:_;if(x===null)throw y=!1,new l;if(E.push(x))continue;y=!1}}catch(_){E.destroy(_)}break}}return E}e.exports=c}),xy=$e((n,e)=>{Oe(),Ne(),Le();var t=Vl(),{ArrayPrototypeIndexOf:r,NumberIsInteger:i,NumberIsNaN:s,NumberParseInt:o,ObjectDefineProperties:a,ObjectKeys:l,ObjectSetPrototypeOf:c,Promise:h,SafeSet:d,SymbolAsyncDispose:p,SymbolAsyncIterator:g,Symbol:m}=Ir();e.exports=Ce,Ce.ReadableState=Fe;var{EventEmitter:E}=(Kl(),nr(Aa)),{Stream:y,prependListener:S}=KE(),{Buffer:b}=(Jr(),nr(Qr)),{addAbortSignal:_}=Sy(),I=xa(),x=ri().debuglog("stream",se=>{x=se}),$=aj(),U=qu(),{getHighWaterMark:O,getDefaultHighWaterMark:P}=Ay(),{aggregateTwoErrors:M,codes:{ERR_INVALID_ARG_TYPE:K,ERR_METHOD_NOT_IMPLEMENTED:C,ERR_OUT_OF_RANGE:B,ERR_STREAM_PUSH_AFTER_EOF:N,ERR_STREAM_UNSHIFT_AFTER_END_EVENT:L},AbortError:V}=Fn(),{validateObject:W}=qf(),H=m("kPaused"),{StringDecoder:G}=cj(),z=KO();c(Ce.prototype,y.prototype),c(Ce,y);var Z=()=>{},{errorOrDestroy:F}=U,ie=1,fe=2,J=4,_e=8,oe=16,ne=32,de=64,k=128,X=256,ee=512,me=1024,be=2048,te=4096,le=8192,ge=16384,Ie=32768,Ae=65536,Te=1<<17,ye=1<<18;function Re(se){return{enumerable:!1,get(){return(this.state&se)!==0},set(ce){ce?this.state|=se:this.state&=~se}}}a(Fe.prototype,{objectMode:Re(ie),ended:Re(fe),endEmitted:Re(J),reading:Re(_e),constructed:Re(oe),sync:Re(ne),needReadable:Re(de),emittedReadable:Re(k),readableListening:Re(X),resumeScheduled:Re(ee),errorEmitted:Re(me),emitClose:Re(be),autoDestroy:Re(te),destroyed:Re(le),closed:Re(ge),closeEmitted:Re(Ie),multiAwaitDrain:Re(Ae),readingMore:Re(Te),dataEmitted:Re(ye)});function Fe(se,ce,Ue){typeof Ue!="boolean"&&(Ue=ce instanceof mo()),this.state=be|te|oe|ne,se&&se.objectMode&&(this.state|=ie),Ue&&se&&se.readableObjectMode&&(this.state|=ie),this.highWaterMark=se?O(this,se,"readableHighWaterMark",Ue):P(!1),this.buffer=new $,this.length=0,this.pipes=[],this.flowing=null,this[H]=null,se&&se.emitClose===!1&&(this.state&=~be),se&&se.autoDestroy===!1&&(this.state&=~te),this.errored=null,this.defaultEncoding=se&&se.defaultEncoding||"utf8",this.awaitDrainWriters=null,this.decoder=null,this.encoding=null,se&&se.encoding&&(this.decoder=new G(se.encoding),this.encoding=se.encoding)}function Ce(se){if(!(this instanceof Ce))return new Ce(se);let ce=this instanceof mo();this._readableState=new Fe(se,this,ce),se&&(typeof se.read=="function"&&(this._read=se.read),typeof se.destroy=="function"&&(this._destroy=se.destroy),typeof se.construct=="function"&&(this._construct=se.construct),se.signal&&!ce&&_(se.signal,this)),y.call(this,se),U.construct(this,()=>{this._readableState.needReadable&&ue(this,this._readableState)})}Ce.prototype.destroy=U.destroy,Ce.prototype._undestroy=U.undestroy,Ce.prototype._destroy=function(se,ce){ce(se)},Ce.prototype[E.captureRejectionSymbol]=function(se){this.destroy(se)},Ce.prototype[p]=function(){let se;return this.destroyed||(se=this.readableEnded?null:new V,this.destroy(se)),new h((ce,Ue)=>I(this,We=>We&&We!==se?Ue(We):ce(null)))},Ce.prototype.push=function(se,ce){return et(this,se,ce,!1)},Ce.prototype.unshift=function(se,ce){return et(this,se,ce,!0)};function et(se,ce,Ue,We){x("readableAddChunk",ce);let Ve=se._readableState,lr;if(!(Ve.state&ie)&&(typeof ce=="string"?(Ue=Ue||Ve.defaultEncoding,Ve.encoding!==Ue&&(We&&Ve.encoding?ce=b.from(ce,Ue).toString(Ve.encoding):(ce=b.from(ce,Ue),Ue=""))):ce instanceof b?Ue="":y._isUint8Array(ce)?(ce=y._uint8ArrayToBuffer(ce),Ue=""):ce!=null&&(lr=new K("chunk",["string","Buffer","Uint8Array"],ce))),lr)F(se,lr);else if(ce===null)Ve.state&=~_e,ae(se,Ve);else if(Ve.state&ie||ce&&ce.length>0)if(We)if(Ve.state&J)F(se,new L);else{if(Ve.destroyed||Ve.errored)return!1;A(se,Ve,ce,!0)}else if(Ve.ended)F(se,new N);else{if(Ve.destroyed||Ve.errored)return!1;Ve.state&=~_e,Ve.decoder&&!Ue?(ce=Ve.decoder.write(ce),Ve.objectMode||ce.length!==0?A(se,Ve,ce,!1):ue(se,Ve)):A(se,Ve,ce,!1)}else We||(Ve.state&=~_e,ue(se,Ve));return!Ve.ended&&(Ve.length<Ve.highWaterMark||Ve.length===0)}function A(se,ce,Ue,We){ce.flowing&&ce.length===0&&!ce.sync&&se.listenerCount("data")>0?(ce.state&Ae?ce.awaitDrainWriters.clear():ce.awaitDrainWriters=null,ce.dataEmitted=!0,se.emit("data",Ue)):(ce.length+=ce.objectMode?1:Ue.length,We?ce.buffer.unshift(Ue):ce.buffer.push(Ue),ce.state&de&&pe(se)),ue(se,ce)}Ce.prototype.isPaused=function(){let se=this._readableState;return se[H]===!0||se.flowing===!1},Ce.prototype.setEncoding=function(se){let ce=new G(se);this._readableState.decoder=ce,this._readableState.encoding=this._readableState.decoder.encoding;let Ue=this._readableState.buffer,We="";for(let Ve of Ue)We+=ce.write(Ve);return Ue.clear(),We!==""&&Ue.push(We),this._readableState.length=We.length,this};var T=1073741824;function D(se){if(se>T)throw new B("size","<= 1GiB",se);return se--,se|=se>>>1,se|=se>>>2,se|=se>>>4,se|=se>>>8,se|=se>>>16,se++,se}function Y(se,ce){return se<=0||ce.length===0&&ce.ended?0:ce.state&ie?1:s(se)?ce.flowing&&ce.length?ce.buffer.first().length:ce.length:se<=ce.length?se:ce.ended?ce.length:0}Ce.prototype.read=function(se){x("read",se),se===void 0?se=NaN:i(se)||(se=o(se,10));let ce=this._readableState,Ue=se;if(se>ce.highWaterMark&&(ce.highWaterMark=D(se)),se!==0&&(ce.state&=~k),se===0&&ce.needReadable&&((ce.highWaterMark!==0?ce.length>=ce.highWaterMark:ce.length>0)||ce.ended))return x("read: emitReadable",ce.length,ce.ended),ce.length===0&&ce.ended?St(this):pe(this),null;if(se=Y(se,ce),se===0&&ce.ended)return ce.length===0&&St(this),null;let We=(ce.state&de)!==0;if(x("need readable",We),(ce.length===0||ce.length-se<ce.highWaterMark)&&(We=!0,x("length less than watermark",We)),ce.ended||ce.reading||ce.destroyed||ce.errored||!ce.constructed)We=!1,x("reading, ended or constructing",We);else if(We){x("do read"),ce.state|=_e|ne,ce.length===0&&(ce.state|=de);try{this._read(ce.highWaterMark)}catch(lr){F(this,lr)}ce.state&=~ne,ce.reading||(se=Y(Ue,ce))}let Ve;return se>0?Ve=nt(se,ce):Ve=null,Ve===null?(ce.needReadable=ce.length<=ce.highWaterMark,se=0):(ce.length-=se,ce.multiAwaitDrain?ce.awaitDrainWriters.clear():ce.awaitDrainWriters=null),ce.length===0&&(ce.ended||(ce.needReadable=!0),Ue!==se&&ce.ended&&St(this)),Ve!==null&&!ce.errorEmitted&&!ce.closeEmitted&&(ce.dataEmitted=!0,this.emit("data",Ve)),Ve};function ae(se,ce){if(x("onEofChunk"),!ce.ended){if(ce.decoder){let Ue=ce.decoder.end();Ue&&Ue.length&&(ce.buffer.push(Ue),ce.length+=ce.objectMode?1:Ue.length)}ce.ended=!0,ce.sync?pe(se):(ce.needReadable=!1,ce.emittedReadable=!0,Ee(se))}}function pe(se){let ce=se._readableState;x("emitReadable",ce.needReadable,ce.emittedReadable),ce.needReadable=!1,ce.emittedReadable||(x("emitReadable",ce.flowing),ce.emittedReadable=!0,t.nextTick(Ee,se))}function Ee(se){let ce=se._readableState;x("emitReadable_",ce.destroyed,ce.length,ce.ended),!ce.destroyed&&!ce.errored&&(ce.length||ce.ended)&&(se.emit("readable"),ce.emittedReadable=!1),ce.needReadable=!ce.flowing&&!ce.ended&&ce.length<=ce.highWaterMark,er(se)}function ue(se,ce){!ce.readingMore&&ce.constructed&&(ce.readingMore=!0,t.nextTick(we,se,ce))}function we(se,ce){for(;!ce.reading&&!ce.ended&&(ce.length<ce.highWaterMark||ce.flowing&&ce.length===0);){let Ue=ce.length;if(x("maybeReadMore read 0"),se.read(0),Ue===ce.length)break}ce.readingMore=!1}Ce.prototype._read=function(se){throw new C("_read()")},Ce.prototype.pipe=function(se,ce){let Ue=this,We=this._readableState;We.pipes.length===1&&(We.multiAwaitDrain||(We.multiAwaitDrain=!0,We.awaitDrainWriters=new d(We.awaitDrainWriters?[We.awaitDrainWriters]:[]))),We.pipes.push(se),x("pipe count=%d opts=%j",We.pipes.length,ce);let Ve=(!ce||ce.end!==!1)&&se!==t.stdout&&se!==t.stderr?Cr:Hn;We.endEmitted?t.nextTick(Ve):Ue.once("end",Ve),se.on("unpipe",lr);function lr(en,mn){x("onunpipe"),en===Ue&&mn&&mn.hasUnpiped===!1&&(mn.hasUnpiped=!0,Ii())}function Cr(){x("onend"),se.end()}let Vr,xi=!1;function Ii(){x("cleanup"),se.removeListener("close",Gr),se.removeListener("finish",Rn),Vr&&se.removeListener("drain",Vr),se.removeListener("error",qn),se.removeListener("unpipe",lr),Ue.removeListener("end",Cr),Ue.removeListener("end",Hn),Ue.removeListener("data",Hi),xi=!0,Vr&&We.awaitDrainWriters&&(!se._writableState||se._writableState.needDrain)&&Vr()}function Ti(){xi||(We.pipes.length===1&&We.pipes[0]===se?(x("false write response, pause",0),We.awaitDrainWriters=se,We.multiAwaitDrain=!1):We.pipes.length>1&&We.pipes.includes(se)&&(x("false write response, pause",We.awaitDrainWriters.size),We.awaitDrainWriters.add(se)),Ue.pause()),Vr||(Vr=He(Ue,se),se.on("drain",Vr))}Ue.on("data",Hi);function Hi(en){x("ondata");let mn=se.write(en);x("dest.write",mn),mn===!1&&Ti()}function qn(en){if(x("onerror",en),Hn(),se.removeListener("error",qn),se.listenerCount("error")===0){let mn=se._writableState||se._readableState;mn&&!mn.errorEmitted?F(se,en):se.emit("error",en)}}S(se,"error",qn);function Gr(){se.removeListener("finish",Rn),Hn()}se.once("close",Gr);function Rn(){x("onfinish"),se.removeListener("close",Gr),Hn()}se.once("finish",Rn);function Hn(){x("unpipe"),Ue.unpipe(se)}return se.emit("pipe",Ue),se.writableNeedDrain===!0?Ti():We.flowing||(x("pipe resume"),Ue.resume()),se};function He(se,ce){return function(){let Ue=se._readableState;Ue.awaitDrainWriters===ce?(x("pipeOnDrain",1),Ue.awaitDrainWriters=null):Ue.multiAwaitDrain&&(x("pipeOnDrain",Ue.awaitDrainWriters.size),Ue.awaitDrainWriters.delete(ce)),(!Ue.awaitDrainWriters||Ue.awaitDrainWriters.size===0)&&se.listenerCount("data")&&se.resume()}}Ce.prototype.unpipe=function(se){let ce=this._readableState,Ue={hasUnpiped:!1};if(ce.pipes.length===0)return this;if(!se){let Ve=ce.pipes;ce.pipes=[],this.pause();for(let lr=0;lr<Ve.length;lr++)Ve[lr].emit("unpipe",this,{hasUnpiped:!1});return this}let We=r(ce.pipes,se);return We===-1?this:(ce.pipes.splice(We,1),ce.pipes.length===0&&this.pause(),se.emit("unpipe",this,Ue),this)},Ce.prototype.on=function(se,ce){let Ue=y.prototype.on.call(this,se,ce),We=this._readableState;return se==="data"?(We.readableListening=this.listenerCount("readable")>0,We.flowing!==!1&&this.resume()):se==="readable"&&!We.endEmitted&&!We.readableListening&&(We.readableListening=We.needReadable=!0,We.flowing=!1,We.emittedReadable=!1,x("on readable",We.length,We.reading),We.length?pe(this):We.reading||t.nextTick(Ke,this)),Ue},Ce.prototype.addListener=Ce.prototype.on,Ce.prototype.removeListener=function(se,ce){let Ue=y.prototype.removeListener.call(this,se,ce);return se==="readable"&&t.nextTick(ze,this),Ue},Ce.prototype.off=Ce.prototype.removeListener,Ce.prototype.removeAllListeners=function(se){let ce=y.prototype.removeAllListeners.apply(this,arguments);return(se==="readable"||se===void 0)&&t.nextTick(ze,this),ce};function ze(se){let ce=se._readableState;ce.readableListening=se.listenerCount("readable")>0,ce.resumeScheduled&&ce[H]===!1?ce.flowing=!0:se.listenerCount("data")>0?se.resume():ce.readableListening||(ce.flowing=null)}function Ke(se){x("readable nexttick read 0"),se.read(0)}Ce.prototype.resume=function(){let se=this._readableState;return se.flowing||(x("resume"),se.flowing=!se.readableListening,it(this,se)),se[H]=!1,this};function it(se,ce){ce.resumeScheduled||(ce.resumeScheduled=!0,t.nextTick(Gt,se,ce))}function Gt(se,ce){x("resume",ce.reading),ce.reading||se.read(0),ce.resumeScheduled=!1,se.emit("resume"),er(se),ce.flowing&&!ce.reading&&se.read(0)}Ce.prototype.pause=function(){return x("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(x("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState[H]=!0,this};function er(se){let ce=se._readableState;for(x("flow",ce.flowing);ce.flowing&&se.read()!==null;);}Ce.prototype.wrap=function(se){let ce=!1;se.on("data",We=>{!this.push(We)&&se.pause&&(ce=!0,se.pause())}),se.on("end",()=>{this.push(null)}),se.on("error",We=>{F(this,We)}),se.on("close",()=>{this.destroy()}),se.on("destroy",()=>{this.destroy()}),this._read=()=>{ce&&se.resume&&(ce=!1,se.resume())};let Ue=l(se);for(let We=1;We<Ue.length;We++){let Ve=Ue[We];this[Ve]===void 0&&typeof se[Ve]=="function"&&(this[Ve]=se[Ve].bind(se))}return this},Ce.prototype[g]=function(){return yt(this)},Ce.prototype.iterator=function(se){return se!==void 0&&W(se,"options"),yt(this,se)};function yt(se,ce){typeof se.read!="function"&&(se=Ce.wrap(se,{objectMode:!0}));let Ue=Rt(se,ce);return Ue.stream=se,Ue}async function*Rt(se,ce){let Ue=Z;function We(Cr){this===se?(Ue(),Ue=Z):Ue=Cr}se.on("readable",We);let Ve,lr=I(se,{writable:!1},Cr=>{Ve=Cr?M(Ve,Cr):null,Ue(),Ue=Z});try{for(;;){let Cr=se.destroyed?null:se.read();if(Cr!==null)yield Cr;else{if(Ve)throw Ve;if(Ve===null)return;await new h(We)}}}catch(Cr){throw Ve=M(Ve,Cr),Ve}finally{(Ve||(ce==null?void 0:ce.destroyOnReturn)!==!1)&&(Ve===void 0||se._readableState.autoDestroy)?U.destroyer(se,null):(se.off("readable",We),lr())}}a(Ce.prototype,{readable:{__proto__:null,get(){let se=this._readableState;return!!se&&se.readable!==!1&&!se.destroyed&&!se.errorEmitted&&!se.endEmitted},set(se){this._readableState&&(this._readableState.readable=!!se)}},readableDidRead:{__proto__:null,enumerable:!1,get:function(){return this._readableState.dataEmitted}},readableAborted:{__proto__:null,enumerable:!1,get:function(){return!!(this._readableState.readable!==!1&&(this._readableState.destroyed||this._readableState.errored)&&!this._readableState.endEmitted)}},readableHighWaterMark:{__proto__:null,enumerable:!1,get:function(){return this._readableState.highWaterMark}},readableBuffer:{__proto__:null,enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}},readableFlowing:{__proto__:null,enumerable:!1,get:function(){return this._readableState.flowing},set:function(se){this._readableState&&(this._readableState.flowing=se)}},readableLength:{__proto__:null,enumerable:!1,get(){return this._readableState.length}},readableObjectMode:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.objectMode:!1}},readableEncoding:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.encoding:null}},errored:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.errored:null}},closed:{__proto__:null,get(){return this._readableState?this._readableState.closed:!1}},destroyed:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.destroyed:!1},set(se){this._readableState&&(this._readableState.destroyed=se)}},readableEnded:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.endEmitted:!1}}}),a(Fe.prototype,{pipesCount:{__proto__:null,get(){return this.pipes.length}},paused:{__proto__:null,get(){return this[H]!==!1},set(se){this[H]=!!se}}}),Ce._fromList=nt;function nt(se,ce){if(ce.length===0)return null;let Ue;return ce.objectMode?Ue=ce.buffer.shift():!se||se>=ce.length?(ce.decoder?Ue=ce.buffer.join(""):ce.buffer.length===1?Ue=ce.buffer.first():Ue=ce.buffer.concat(ce.length),ce.buffer.clear()):Ue=ce.buffer.consume(se,ce.decoder),Ue}function St(se){let ce=se._readableState;x("endReadable",ce.endEmitted),ce.endEmitted||(ce.ended=!0,t.nextTick(Ot,ce,se))}function Ot(se,ce){if(x("endReadableNT",se.endEmitted,se.length),!se.errored&&!se.closeEmitted&&!se.endEmitted&&se.length===0){if(se.endEmitted=!0,ce.emit("end"),ce.writable&&ce.allowHalfOpen===!1)t.nextTick(Zt,ce);else if(se.autoDestroy){let Ue=ce._writableState;(!Ue||Ue.autoDestroy&&(Ue.finished||Ue.writable===!1))&&ce.destroy()}}}function Zt(se){se.writable&&!se.writableEnded&&!se.destroyed&&se.end()}Ce.from=function(se,ce){return z(Ce,se,ce)};var ar;function Kr(){return ar===void 0&&(ar={}),ar}Ce.fromWeb=function(se,ce){return Kr().newStreamReadableFromReadableStream(se,ce)},Ce.toWeb=function(se,ce){return Kr().newReadableStreamFromStreamReadable(se,ce)},Ce.wrap=function(se,ce){var Ue,We;return new Ce({objectMode:(Ue=(We=se.readableObjectMode)!==null&&We!==void 0?We:se.objectMode)!==null&&Ue!==void 0?Ue:!0,...ce,destroy(Ve,lr){U.destroyer(se,Ve),lr(Ve)}}).wrap(se)}}),VE=$e((n,e)=>{Oe(),Ne(),Le();var t=Vl(),{ArrayPrototypeSlice:r,Error:i,FunctionPrototypeSymbolHasInstance:s,ObjectDefineProperty:o,ObjectDefineProperties:a,ObjectSetPrototypeOf:l,StringPrototypeToLowerCase:c,Symbol:h,SymbolHasInstance:d}=Ir();e.exports=W,W.WritableState=L;var{EventEmitter:p}=(Kl(),nr(Aa)),g=KE().Stream,{Buffer:m}=(Jr(),nr(Qr)),E=qu(),{addAbortSignal:y}=Sy(),{getHighWaterMark:S,getDefaultHighWaterMark:b}=Ay(),{ERR_INVALID_ARG_TYPE:_,ERR_METHOD_NOT_IMPLEMENTED:I,ERR_MULTIPLE_CALLBACK:x,ERR_STREAM_CANNOT_PIPE:$,ERR_STREAM_DESTROYED:U,ERR_STREAM_ALREADY_FINISHED:O,ERR_STREAM_NULL_VALUES:P,ERR_STREAM_WRITE_AFTER_END:M,ERR_UNKNOWN_ENCODING:K}=Fn().codes,{errorOrDestroy:C}=E;l(W.prototype,g.prototype),l(W,g);function B(){}var N=h("kOnFinished");function L(te,le,ge){typeof ge!="boolean"&&(ge=le instanceof mo()),this.objectMode=!!(te&&te.objectMode),ge&&(this.objectMode=this.objectMode||!!(te&&te.writableObjectMode)),this.highWaterMark=te?S(this,te,"writableHighWaterMark",ge):b(!1),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;let Ie=!!(te&&te.decodeStrings===!1);this.decodeStrings=!Ie,this.defaultEncoding=te&&te.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=F.bind(void 0,le),this.writecb=null,this.writelen=0,this.afterWriteTickInfo=null,V(this),this.pendingcb=0,this.constructed=!0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!te||te.emitClose!==!1,this.autoDestroy=!te||te.autoDestroy!==!1,this.errored=null,this.closed=!1,this.closeEmitted=!1,this[N]=[]}function V(te){te.buffered=[],te.bufferedIndex=0,te.allBuffers=!0,te.allNoop=!0}L.prototype.getBuffer=function(){return r(this.buffered,this.bufferedIndex)},o(L.prototype,"bufferedRequestCount",{__proto__:null,get(){return this.buffered.length-this.bufferedIndex}});function W(te){let le=this instanceof mo();if(!le&&!s(W,this))return new W(te);this._writableState=new L(te,this,le),te&&(typeof te.write=="function"&&(this._write=te.write),typeof te.writev=="function"&&(this._writev=te.writev),typeof te.destroy=="function"&&(this._destroy=te.destroy),typeof te.final=="function"&&(this._final=te.final),typeof te.construct=="function"&&(this._construct=te.construct),te.signal&&y(te.signal,this)),g.call(this,te),E.construct(this,()=>{let ge=this._writableState;ge.writing||_e(this,ge),k(this,ge)})}o(W,d,{__proto__:null,value:function(te){return s(this,te)?!0:this!==W?!1:te&&te._writableState instanceof L}}),W.prototype.pipe=function(){C(this,new $)};function H(te,le,ge,Ie){let Ae=te._writableState;if(typeof ge=="function")Ie=ge,ge=Ae.defaultEncoding;else{if(!ge)ge=Ae.defaultEncoding;else if(ge!=="buffer"&&!m.isEncoding(ge))throw new K(ge);typeof Ie!="function"&&(Ie=B)}if(le===null)throw new P;if(!Ae.objectMode)if(typeof le=="string")Ae.decodeStrings!==!1&&(le=m.from(le,ge),ge="buffer");else if(le instanceof m)ge="buffer";else if(g._isUint8Array(le))le=g._uint8ArrayToBuffer(le),ge="buffer";else throw new _("chunk",["string","Buffer","Uint8Array"],le);let Te;return Ae.ending?Te=new M:Ae.destroyed&&(Te=new U("write")),Te?(t.nextTick(Ie,Te),C(te,Te,!0),Te):(Ae.pendingcb++,G(te,Ae,le,ge,Ie))}W.prototype.write=function(te,le,ge){return H(this,te,le,ge)===!0},W.prototype.cork=function(){this._writableState.corked++},W.prototype.uncork=function(){let te=this._writableState;te.corked&&(te.corked--,te.writing||_e(this,te))},W.prototype.setDefaultEncoding=function(te){if(typeof te=="string"&&(te=c(te)),!m.isEncoding(te))throw new K(te);return this._writableState.defaultEncoding=te,this};function G(te,le,ge,Ie,Ae){let Te=le.objectMode?1:ge.length;le.length+=Te;let ye=le.length<le.highWaterMark;return ye||(le.needDrain=!0),le.writing||le.corked||le.errored||!le.constructed?(le.buffered.push({chunk:ge,encoding:Ie,callback:Ae}),le.allBuffers&&Ie!=="buffer"&&(le.allBuffers=!1),le.allNoop&&Ae!==B&&(le.allNoop=!1)):(le.writelen=Te,le.writecb=Ae,le.writing=!0,le.sync=!0,te._write(ge,Ie,le.onwrite),le.sync=!1),ye&&!le.errored&&!le.destroyed}function z(te,le,ge,Ie,Ae,Te,ye){le.writelen=Ie,le.writecb=ye,le.writing=!0,le.sync=!0,le.destroyed?le.onwrite(new U("write")):ge?te._writev(Ae,le.onwrite):te._write(Ae,Te,le.onwrite),le.sync=!1}function Z(te,le,ge,Ie){--le.pendingcb,Ie(ge),J(le),C(te,ge)}function F(te,le){let ge=te._writableState,Ie=ge.sync,Ae=ge.writecb;if(typeof Ae!="function"){C(te,new x);return}ge.writing=!1,ge.writecb=null,ge.length-=ge.writelen,ge.writelen=0,le?(le.stack,ge.errored||(ge.errored=le),te._readableState&&!te._readableState.errored&&(te._readableState.errored=le),Ie?t.nextTick(Z,te,ge,le,Ae):Z(te,ge,le,Ae)):(ge.buffered.length>ge.bufferedIndex&&_e(te,ge),Ie?ge.afterWriteTickInfo!==null&&ge.afterWriteTickInfo.cb===Ae?ge.afterWriteTickInfo.count++:(ge.afterWriteTickInfo={count:1,cb:Ae,stream:te,state:ge},t.nextTick(ie,ge.afterWriteTickInfo)):fe(te,ge,1,Ae))}function ie({stream:te,state:le,count:ge,cb:Ie}){return le.afterWriteTickInfo=null,fe(te,le,ge,Ie)}function fe(te,le,ge,Ie){for(!le.ending&&!te.destroyed&&le.length===0&&le.needDrain&&(le.needDrain=!1,te.emit("drain"));ge-- >0;)le.pendingcb--,Ie();le.destroyed&&J(le),k(te,le)}function J(te){if(te.writing)return;for(let Ae=te.bufferedIndex;Ae<te.buffered.length;++Ae){var le;let{chunk:Te,callback:ye}=te.buffered[Ae],Re=te.objectMode?1:Te.length;te.length-=Re,ye((le=te.errored)!==null&&le!==void 0?le:new U("write"))}let ge=te[N].splice(0);for(let Ae=0;Ae<ge.length;Ae++){var Ie;ge[Ae]((Ie=te.errored)!==null&&Ie!==void 0?Ie:new U("end"))}V(te)}function _e(te,le){if(le.corked||le.bufferProcessing||le.destroyed||!le.constructed)return;let{buffered:ge,bufferedIndex:Ie,objectMode:Ae}=le,Te=ge.length-Ie;if(!Te)return;let ye=Ie;if(le.bufferProcessing=!0,Te>1&&te._writev){le.pendingcb-=Te-1;let Re=le.allNoop?B:Ce=>{for(let et=ye;et<ge.length;++et)ge[et].callback(Ce)},Fe=le.allNoop&&ye===0?ge:r(ge,ye);Fe.allBuffers=le.allBuffers,z(te,le,!0,le.length,Fe,"",Re),V(le)}else{do{let{chunk:Re,encoding:Fe,callback:Ce}=ge[ye];ge[ye++]=null;let et=Ae?1:Re.length;z(te,le,!1,et,Re,Fe,Ce)}while(ye<ge.length&&!le.writing);ye===ge.length?V(le):ye>256?(ge.splice(0,ye),le.bufferedIndex=0):le.bufferedIndex=ye}le.bufferProcessing=!1}W.prototype._write=function(te,le,ge){if(this._writev)this._writev([{chunk:te,encoding:le}],ge);else throw new I("_write()")},W.prototype._writev=null,W.prototype.end=function(te,le,ge){let Ie=this._writableState;typeof te=="function"?(ge=te,te=null,le=null):typeof le=="function"&&(ge=le,le=null);let Ae;if(te!=null){let Te=H(this,te,le);Te instanceof i&&(Ae=Te)}return Ie.corked&&(Ie.corked=1,this.uncork()),Ae||(!Ie.errored&&!Ie.ending?(Ie.ending=!0,k(this,Ie,!0),Ie.ended=!0):Ie.finished?Ae=new O("end"):Ie.destroyed&&(Ae=new U("end"))),typeof ge=="function"&&(Ae||Ie.finished?t.nextTick(ge,Ae):Ie[N].push(ge)),this};function oe(te){return te.ending&&!te.destroyed&&te.constructed&&te.length===0&&!te.errored&&te.buffered.length===0&&!te.finished&&!te.writing&&!te.errorEmitted&&!te.closeEmitted}function ne(te,le){let ge=!1;function Ie(Ae){if(ge){C(te,Ae??x());return}if(ge=!0,le.pendingcb--,Ae){let Te=le[N].splice(0);for(let ye=0;ye<Te.length;ye++)Te[ye](Ae);C(te,Ae,le.sync)}else oe(le)&&(le.prefinished=!0,te.emit("prefinish"),le.pendingcb++,t.nextTick(X,te,le))}le.sync=!0,le.pendingcb++;try{te._final(Ie)}catch(Ae){Ie(Ae)}le.sync=!1}function de(te,le){!le.prefinished&&!le.finalCalled&&(typeof te._final=="function"&&!le.destroyed?(le.finalCalled=!0,ne(te,le)):(le.prefinished=!0,te.emit("prefinish")))}function k(te,le,ge){oe(le)&&(de(te,le),le.pendingcb===0&&(ge?(le.pendingcb++,t.nextTick((Ie,Ae)=>{oe(Ae)?X(Ie,Ae):Ae.pendingcb--},te,le)):oe(le)&&(le.pendingcb++,X(te,le))))}function X(te,le){le.pendingcb--,le.finished=!0;let ge=le[N].splice(0);for(let Ie=0;Ie<ge.length;Ie++)ge[Ie]();if(te.emit("finish"),le.autoDestroy){let Ie=te._readableState;(!Ie||Ie.autoDestroy&&(Ie.endEmitted||Ie.readable===!1))&&te.destroy()}}a(W.prototype,{closed:{__proto__:null,get(){return this._writableState?this._writableState.closed:!1}},destroyed:{__proto__:null,get(){return this._writableState?this._writableState.destroyed:!1},set(te){this._writableState&&(this._writableState.destroyed=te)}},writable:{__proto__:null,get(){let te=this._writableState;return!!te&&te.writable!==!1&&!te.destroyed&&!te.errored&&!te.ending&&!te.ended},set(te){this._writableState&&(this._writableState.writable=!!te)}},writableFinished:{__proto__:null,get(){return this._writableState?this._writableState.finished:!1}},writableObjectMode:{__proto__:null,get(){return this._writableState?this._writableState.objectMode:!1}},writableBuffer:{__proto__:null,get(){return this._writableState&&this._writableState.getBuffer()}},writableEnded:{__proto__:null,get(){return this._writableState?this._writableState.ending:!1}},writableNeedDrain:{__proto__:null,get(){let te=this._writableState;return te?!te.destroyed&&!te.ending&&te.needDrain:!1}},writableHighWaterMark:{__proto__:null,get(){return this._writableState&&this._writableState.highWaterMark}},writableCorked:{__proto__:null,get(){return this._writableState?this._writableState.corked:0}},writableLength:{__proto__:null,get(){return this._writableState&&this._writableState.length}},errored:{__proto__:null,enumerable:!1,get(){return this._writableState?this._writableState.errored:null}},writableAborted:{__proto__:null,enumerable:!1,get:function(){return!!(this._writableState.writable!==!1&&(this._writableState.destroyed||this._writableState.errored)&&!this._writableState.finished)}}});var ee=E.destroy;W.prototype.destroy=function(te,le){let ge=this._writableState;return!ge.destroyed&&(ge.bufferedIndex<ge.buffered.length||ge[N].length)&&t.nextTick(J,ge),ee.call(this,te,le),this},W.prototype._undestroy=E.undestroy,W.prototype._destroy=function(te,le){le(te)},W.prototype[p.captureRejectionSymbol]=function(te){this.destroy(te)};var me;function be(){return me===void 0&&(me={}),me}W.fromWeb=function(te,le){return be().newStreamWritableFromWritableStream(te,le)},W.toWeb=function(te){return be().newWritableStreamFromStreamWritable(te)}}),uj=$e((n,e)=>{Oe(),Ne(),Le();var t=Vl(),r=(Jr(),nr(Qr)),{isReadable:i,isWritable:s,isIterable:o,isNodeStream:a,isReadableNodeStream:l,isWritableNodeStream:c,isDuplexNodeStream:h,isReadableStream:d,isWritableStream:p}=_o(),g=xa(),{AbortError:m,codes:{ERR_INVALID_ARG_TYPE:E,ERR_INVALID_RETURN_VALUE:y}}=Fn(),{destroyer:S}=qu(),b=mo(),_=xy(),I=VE(),{createDeferredPromise:x}=ri(),$=KO(),U=globalThis.Blob||r.Blob,O=typeof U<"u"?function(N){return N instanceof U}:function(N){return!1},P=globalThis.AbortController||lf().AbortController,{FunctionPrototypeCall:M}=Ir(),K=class extends b{constructor(N){super(N),(N==null?void 0:N.readable)===!1&&(this._readableState.readable=!1,this._readableState.ended=!0,this._readableState.endEmitted=!0),(N==null?void 0:N.writable)===!1&&(this._writableState.writable=!1,this._writableState.ending=!0,this._writableState.ended=!0,this._writableState.finished=!0)}};e.exports=function N(L,V){if(h(L))return L;if(l(L))return B({readable:L});if(c(L))return B({writable:L});if(a(L))return B({writable:!1,readable:!1});if(d(L))return B({readable:_.fromWeb(L)});if(p(L))return B({writable:I.fromWeb(L)});if(typeof L=="function"){let{value:H,write:G,final:z,destroy:Z}=C(L);if(o(H))return $(K,H,{objectMode:!0,write:G,final:z,destroy:Z});let F=H==null?void 0:H.then;if(typeof F=="function"){let ie,fe=M(F,H,J=>{if(J!=null)throw new y("nully","body",J)},J=>{S(ie,J)});return ie=new K({objectMode:!0,readable:!1,write:G,final(J){z(async()=>{try{await fe,t.nextTick(J,null)}catch(_e){t.nextTick(J,_e)}})},destroy:Z})}throw new y("Iterable, AsyncIterable or AsyncFunction",V,H)}if(O(L))return N(L.arrayBuffer());if(o(L))return $(K,L,{objectMode:!0,writable:!1});if(d(L==null?void 0:L.readable)&&p(L==null?void 0:L.writable))return K.fromWeb(L);if(typeof(L==null?void 0:L.writable)=="object"||typeof(L==null?void 0:L.readable)=="object"){let H=L!=null&&L.readable?l(L==null?void 0:L.readable)?L==null?void 0:L.readable:N(L.readable):void 0,G=L!=null&&L.writable?c(L==null?void 0:L.writable)?L==null?void 0:L.writable:N(L.writable):void 0;return B({readable:H,writable:G})}let W=L==null?void 0:L.then;if(typeof W=="function"){let H;return M(W,L,G=>{G!=null&&H.push(G),H.push(null)},G=>{S(H,G)}),H=new K({objectMode:!0,writable:!1,read(){}})}throw new E(V,["Blob","ReadableStream","WritableStream","Stream","Iterable","AsyncIterable","Function","{ readable, writable } pair","Promise"],L)};function C(N){let{promise:L,resolve:V}=x(),W=new P,H=W.signal;return{value:N(async function*(){for(;;){let G=L;L=null;let{chunk:z,done:Z,cb:F}=await G;if(t.nextTick(F),Z)return;if(H.aborted)throw new m(void 0,{cause:H.reason});({promise:L,resolve:V}=x()),yield z}}(),{signal:H}),write(G,z,Z){let F=V;V=null,F({chunk:G,done:!1,cb:Z})},final(G){let z=V;V=null,z({done:!0,cb:G})},destroy(G,z){W.abort(),z(G)}}}function B(N){let L=N.readable&&typeof N.readable.read!="function"?_.wrap(N.readable):N.readable,V=N.writable,W=!!i(L),H=!!s(V),G,z,Z,F,ie;function fe(J){let _e=F;F=null,_e?_e(J):J&&ie.destroy(J)}return ie=new K({readableObjectMode:!!(L!=null&&L.readableObjectMode),writableObjectMode:!!(V!=null&&V.writableObjectMode),readable:W,writable:H}),H&&(g(V,J=>{H=!1,J&&S(L,J),fe(J)}),ie._write=function(J,_e,oe){V.write(J,_e)?oe():G=oe},ie._final=function(J){V.end(),z=J},V.on("drain",function(){if(G){let J=G;G=null,J()}}),V.on("finish",function(){if(z){let J=z;z=null,J()}})),W&&(g(L,J=>{W=!1,J&&S(L,J),fe(J)}),L.on("readable",function(){if(Z){let J=Z;Z=null,J()}}),L.on("end",function(){ie.push(null)}),ie._read=function(){for(;;){let J=L.read();if(J===null){Z=ie._read;return}if(!ie.push(J))return}}),ie._destroy=function(J,_e){!J&&F!==null&&(J=new m),Z=null,G=null,z=null,F===null?_e(J):(F=_e,S(V,J),S(L,J))},ie}}),mo=$e((n,e)=>{Oe(),Ne(),Le();var{ObjectDefineProperties:t,ObjectGetOwnPropertyDescriptor:r,ObjectKeys:i,ObjectSetPrototypeOf:s}=Ir();e.exports=l;var o=xy(),a=VE();s(l.prototype,o.prototype),s(l,o);{let p=i(a.prototype);for(let g=0;g<p.length;g++){let m=p[g];l.prototype[m]||(l.prototype[m]=a.prototype[m])}}function l(p){if(!(this instanceof l))return new l(p);o.call(this,p),a.call(this,p),p?(this.allowHalfOpen=p.allowHalfOpen!==!1,p.readable===!1&&(this._readableState.readable=!1,this._readableState.ended=!0,this._readableState.endEmitted=!0),p.writable===!1&&(this._writableState.writable=!1,this._writableState.ending=!0,this._writableState.ended=!0,this._writableState.finished=!0)):this.allowHalfOpen=!0}t(l.prototype,{writable:{__proto__:null,...r(a.prototype,"writable")},writableHighWaterMark:{__proto__:null,...r(a.prototype,"writableHighWaterMark")},writableObjectMode:{__proto__:null,...r(a.prototype,"writableObjectMode")},writableBuffer:{__proto__:null,...r(a.prototype,"writableBuffer")},writableLength:{__proto__:null,...r(a.prototype,"writableLength")},writableFinished:{__proto__:null,...r(a.prototype,"writableFinished")},writableCorked:{__proto__:null,...r(a.prototype,"writableCorked")},writableEnded:{__proto__:null,...r(a.prototype,"writableEnded")},writableNeedDrain:{__proto__:null,...r(a.prototype,"writableNeedDrain")},destroyed:{__proto__:null,get(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set(p){this._readableState&&this._writableState&&(this._readableState.destroyed=p,this._writableState.destroyed=p)}}});var c;function h(){return c===void 0&&(c={}),c}l.fromWeb=function(p,g){return h().newStreamDuplexFromReadableWritablePair(p,g)},l.toWeb=function(p){return h().newReadableWritablePairFromDuplex(p)};var d;l.from=function(p){return d||(d=uj()),d(p,"body")}}),VO=$e((n,e)=>{Oe(),Ne(),Le();var{ObjectSetPrototypeOf:t,Symbol:r}=Ir();e.exports=l;var{ERR_METHOD_NOT_IMPLEMENTED:i}=Fn().codes,s=mo(),{getHighWaterMark:o}=Ay();t(l.prototype,s.prototype),t(l,s);var a=r("kCallback");function l(d){if(!(this instanceof l))return new l(d);let p=d?o(this,d,"readableHighWaterMark",!0):null;p===0&&(d={...d,highWaterMark:null,readableHighWaterMark:p,writableHighWaterMark:d.writableHighWaterMark||0}),s.call(this,d),this._readableState.sync=!1,this[a]=null,d&&(typeof d.transform=="function"&&(this._transform=d.transform),typeof d.flush=="function"&&(this._flush=d.flush)),this.on("prefinish",h)}function c(d){typeof this._flush=="function"&&!this.destroyed?this._flush((p,g)=>{if(p){d?d(p):this.destroy(p);return}g!=null&&this.push(g),this.push(null),d&&d()}):(this.push(null),d&&d())}function h(){this._final!==c&&c.call(this)}l.prototype._final=c,l.prototype._transform=function(d,p,g){throw new i("_transform()")},l.prototype._write=function(d,p,g){let m=this._readableState,E=this._writableState,y=m.length;this._transform(d,p,(S,b)=>{if(S){g(S);return}b!=null&&this.push(b),E.ended||y===m.length||m.length<m.highWaterMark?g():this[a]=g})},l.prototype._read=function(){if(this[a]){let d=this[a];this[a]=null,d()}}}),GO=$e((n,e)=>{Oe(),Ne(),Le();var{ObjectSetPrototypeOf:t}=Ir();e.exports=i;var r=VO();t(i.prototype,r.prototype),t(i,r);function i(s){if(!(this instanceof i))return new i(s);r.call(this,s)}i.prototype._transform=function(s,o,a){a(null,s)}}),GE=$e((n,e)=>{Oe(),Ne(),Le();var t=Vl(),{ArrayIsArray:r,Promise:i,SymbolAsyncIterator:s,SymbolDispose:o}=Ir(),a=xa(),{once:l}=ri(),c=qu(),h=mo(),{aggregateTwoErrors:d,codes:{ERR_INVALID_ARG_TYPE:p,ERR_INVALID_RETURN_VALUE:g,ERR_MISSING_ARGS:m,ERR_STREAM_DESTROYED:E,ERR_STREAM_PREMATURE_CLOSE:y},AbortError:S}=Fn(),{validateFunction:b,validateAbortSignal:_}=qf(),{isIterable:I,isReadable:x,isReadableNodeStream:$,isNodeStream:U,isTransformStream:O,isWebStream:P,isReadableStream:M,isReadableFinished:K}=_o(),C=globalThis.AbortController||lf().AbortController,B,N,L;function V(J,_e,oe){let ne=!1;J.on("close",()=>{ne=!0});let de=a(J,{readable:_e,writable:oe},k=>{ne=!k});return{destroy:k=>{ne||(ne=!0,c.destroyer(J,k||new E("pipe")))},cleanup:de}}function W(J){return b(J[J.length-1],"streams[stream.length - 1]"),J.pop()}function H(J){if(I(J))return J;if($(J))return G(J);throw new p("val",["Readable","Iterable","AsyncIterable"],J)}async function*G(J){N||(N=xy()),yield*N.prototype[s].call(J)}async function z(J,_e,oe,{end:ne}){let de,k=null,X=be=>{if(be&&(de=be),k){let te=k;k=null,te()}},ee=()=>new i((be,te)=>{de?te(de):k=()=>{de?te(de):be()}});_e.on("drain",X);let me=a(_e,{readable:!1},X);try{_e.writableNeedDrain&&await ee();for await(let be of J)_e.write(be)||await ee();ne&&(_e.end(),await ee()),oe()}catch(be){oe(de!==be?d(de,be):be)}finally{me(),_e.off("drain",X)}}async function Z(J,_e,oe,{end:ne}){O(_e)&&(_e=_e.writable);let de=_e.getWriter();try{for await(let k of J)await de.ready,de.write(k).catch(()=>{});await de.ready,ne&&await de.close(),oe()}catch(k){try{await de.abort(k),oe(k)}catch(X){oe(X)}}}function F(...J){return ie(J,l(W(J)))}function ie(J,_e,oe){if(J.length===1&&r(J[0])&&(J=J[0]),J.length<2)throw new m("streams");let ne=new C,de=ne.signal,k=oe==null?void 0:oe.signal,X=[];_(k,"options.signal");function ee(){Ae(new S)}L=L||ri().addAbortListener;let me;k&&(me=L(k,ee));let be,te,le=[],ge=0;function Ie(Fe){Ae(Fe,--ge===0)}function Ae(Fe,Ce){var et;if(Fe&&(!be||be.code==="ERR_STREAM_PREMATURE_CLOSE")&&(be=Fe),!(!be&&!Ce)){for(;le.length;)le.shift()(be);(et=me)===null||et===void 0||et[o](),ne.abort(),Ce&&(be||X.forEach(A=>A()),t.nextTick(_e,be,te))}}let Te;for(let Fe=0;Fe<J.length;Fe++){let Ce=J[Fe],et=Fe<J.length-1,A=Fe>0,T=et||(oe==null?void 0:oe.end)!==!1,D=Fe===J.length-1;if(U(Ce)){let Y=function(ae){ae&&ae.name!=="AbortError"&&ae.code!=="ERR_STREAM_PREMATURE_CLOSE"&&Ie(ae)};if(T){let{destroy:ae,cleanup:pe}=V(Ce,et,A);le.push(ae),x(Ce)&&D&&X.push(pe)}Ce.on("error",Y),x(Ce)&&D&&X.push(()=>{Ce.removeListener("error",Y)})}if(Fe===0)if(typeof Ce=="function"){if(Te=Ce({signal:de}),!I(Te))throw new g("Iterable, AsyncIterable or Stream","source",Te)}else I(Ce)||$(Ce)||O(Ce)?Te=Ce:Te=h.from(Ce);else if(typeof Ce=="function"){if(O(Te)){var ye;Te=H((ye=Te)===null||ye===void 0?void 0:ye.readable)}else Te=H(Te);if(Te=Ce(Te,{signal:de}),et){if(!I(Te,!0))throw new g("AsyncIterable",`transform[${Fe-1}]`,Te)}else{var Re;B||(B=GO());let Y=new B({objectMode:!0}),ae=(Re=Te)===null||Re===void 0?void 0:Re.then;if(typeof ae=="function")ge++,ae.call(Te,ue=>{te=ue,ue!=null&&Y.write(ue),T&&Y.end(),t.nextTick(Ie)},ue=>{Y.destroy(ue),t.nextTick(Ie,ue)});else if(I(Te,!0))ge++,z(Te,Y,Ie,{end:T});else if(M(Te)||O(Te)){let ue=Te.readable||Te;ge++,z(ue,Y,Ie,{end:T})}else throw new g("AsyncIterable or Promise","destination",Te);Te=Y;let{destroy:pe,cleanup:Ee}=V(Te,!1,!0);le.push(pe),D&&X.push(Ee)}}else if(U(Ce)){if($(Te)){ge+=2;let Y=fe(Te,Ce,Ie,{end:T});x(Ce)&&D&&X.push(Y)}else if(O(Te)||M(Te)){let Y=Te.readable||Te;ge++,z(Y,Ce,Ie,{end:T})}else if(I(Te))ge++,z(Te,Ce,Ie,{end:T});else throw new p("val",["Readable","Iterable","AsyncIterable","ReadableStream","TransformStream"],Te);Te=Ce}else if(P(Ce)){if($(Te))ge++,Z(H(Te),Ce,Ie,{end:T});else if(M(Te)||I(Te))ge++,Z(Te,Ce,Ie,{end:T});else if(O(Te))ge++,Z(Te.readable,Ce,Ie,{end:T});else throw new p("val",["Readable","Iterable","AsyncIterable","ReadableStream","TransformStream"],Te);Te=Ce}else Te=h.from(Ce)}return(de!=null&&de.aborted||k!=null&&k.aborted)&&t.nextTick(ee),Te}function fe(J,_e,oe,{end:ne}){let de=!1;if(_e.on("close",()=>{de||oe(new y)}),J.pipe(_e,{end:!1}),ne){let k=function(){de=!0,_e.end()};K(J)?t.nextTick(k):J.once("end",k)}else oe();return a(J,{readable:!0,writable:!1},k=>{let X=J._readableState;k&&k.code==="ERR_STREAM_PREMATURE_CLOSE"&&X&&X.ended&&!X.errored&&!X.errorEmitted?J.once("end",oe).once("error",oe):oe(k)}),a(_e,{readable:!1,writable:!0},oe)}e.exports={pipelineImpl:ie,pipeline:F}}),YO=$e((n,e)=>{Oe(),Ne(),Le();var{pipeline:t}=GE(),r=mo(),{destroyer:i}=qu(),{isNodeStream:s,isReadable:o,isWritable:a,isWebStream:l,isTransformStream:c,isWritableStream:h,isReadableStream:d}=_o(),{AbortError:p,codes:{ERR_INVALID_ARG_VALUE:g,ERR_MISSING_ARGS:m}}=Fn(),E=xa();e.exports=function(...y){if(y.length===0)throw new m("streams");if(y.length===1)return r.from(y[0]);let S=[...y];if(typeof y[0]=="function"&&(y[0]=r.from(y[0])),typeof y[y.length-1]=="function"){let C=y.length-1;y[C]=r.from(y[C])}for(let C=0;C<y.length;++C)if(!(!s(y[C])&&!l(y[C]))){if(C<y.length-1&&!(o(y[C])||d(y[C])||c(y[C])))throw new g(`streams[${C}]`,S[C],"must be readable");if(C>0&&!(a(y[C])||h(y[C])||c(y[C])))throw new g(`streams[${C}]`,S[C],"must be writable")}let b,_,I,x,$;function U(C){let B=x;x=null,B?B(C):C?$.destroy(C):!K&&!M&&$.destroy()}let O=y[0],P=t(y,U),M=!!(a(O)||h(O)||c(O)),K=!!(o(P)||d(P)||c(P));if($=new r({writableObjectMode:!!(O!=null&&O.writableObjectMode),readableObjectMode:!!(P!=null&&P.readableObjectMode),writable:M,readable:K}),M){if(s(O))$._write=function(B,N,L){O.write(B,N)?L():b=L},$._final=function(B){O.end(),_=B},O.on("drain",function(){if(b){let B=b;b=null,B()}});else if(l(O)){let B=(c(O)?O.writable:O).getWriter();$._write=async function(N,L,V){try{await B.ready,B.write(N).catch(()=>{}),V()}catch(W){V(W)}},$._final=async function(N){try{await B.ready,B.close().catch(()=>{}),_=N}catch(L){N(L)}}}let C=c(P)?P.readable:P;E(C,()=>{if(_){let B=_;_=null,B()}})}if(K){if(s(P))P.on("readable",function(){if(I){let C=I;I=null,C()}}),P.on("end",function(){$.push(null)}),$._read=function(){for(;;){let C=P.read();if(C===null){I=$._read;return}if(!$.push(C))return}};else if(l(P)){let C=(c(P)?P.readable:P).getReader();$._read=async function(){for(;;)try{let{value:B,done:N}=await C.read();if(!$.push(B))return;if(N){$.push(null);return}}catch{return}}}}return $._destroy=function(C,B){!C&&x!==null&&(C=new p),I=null,b=null,_=null,x===null?B(C):(x=B,s(P)&&i(P,C))},$}}),hj=$e((n,e)=>{Oe(),Ne(),Le();var t=globalThis.AbortController||lf().AbortController,{codes:{ERR_INVALID_ARG_VALUE:r,ERR_INVALID_ARG_TYPE:i,ERR_MISSING_ARGS:s,ERR_OUT_OF_RANGE:o},AbortError:a}=Fn(),{validateAbortSignal:l,validateInteger:c,validateObject:h}=qf(),d=Ir().Symbol("kWeak"),p=Ir().Symbol("kResistStopPropagation"),{finished:g}=xa(),m=YO(),{addAbortSignalNoValidate:E}=Sy(),{isWritable:y,isNodeStream:S}=_o(),{deprecate:b}=ri(),{ArrayPrototypePush:_,Boolean:I,MathFloor:x,Number:$,NumberIsNaN:U,Promise:O,PromiseReject:P,PromiseResolve:M,PromisePrototypeThen:K,Symbol:C}=Ir(),B=C("kEmpty"),N=C("kEof");function L(k,X){if(X!=null&&h(X,"options"),(X==null?void 0:X.signal)!=null&&l(X.signal,"options.signal"),S(k)&&!y(k))throw new r("stream",k,"must be writable");let ee=m(this,k);return X!=null&&X.signal&&E(X.signal,ee),ee}function V(k,X){if(typeof k!="function")throw new i("fn",["Function","AsyncFunction"],k);X!=null&&h(X,"options"),(X==null?void 0:X.signal)!=null&&l(X.signal,"options.signal");let ee=1;(X==null?void 0:X.concurrency)!=null&&(ee=x(X.concurrency));let me=ee-1;return(X==null?void 0:X.highWaterMark)!=null&&(me=x(X.highWaterMark)),c(ee,"options.concurrency",1),c(me,"options.highWaterMark",0),me+=ee,(async function*(){let be=ri().AbortSignalAny([X==null?void 0:X.signal].filter(I)),te=this,le=[],ge={signal:be},Ie,Ae,Te=!1,ye=0;function Re(){Te=!0,Fe()}function Fe(){ye-=1,Ce()}function Ce(){Ae&&!Te&&ye<ee&&le.length<me&&(Ae(),Ae=null)}async function et(){try{for await(let A of te){if(Te)return;if(be.aborted)throw new a;try{if(A=k(A,ge),A===B)continue;A=M(A)}catch(T){A=P(T)}ye+=1,K(A,Fe,Re),le.push(A),Ie&&(Ie(),Ie=null),!Te&&(le.length>=me||ye>=ee)&&await new O(T=>{Ae=T})}le.push(N)}catch(A){let T=P(A);K(T,Fe,Re),le.push(T)}finally{Te=!0,Ie&&(Ie(),Ie=null)}}et();try{for(;;){for(;le.length>0;){let A=await le[0];if(A===N)return;if(be.aborted)throw new a;A!==B&&(yield A),le.shift(),Ce()}await new O(A=>{Ie=A})}}finally{Te=!0,Ae&&(Ae(),Ae=null)}}).call(this)}function W(k=void 0){return k!=null&&h(k,"options"),(k==null?void 0:k.signal)!=null&&l(k.signal,"options.signal"),(async function*(){let X=0;for await(let me of this){var ee;if(k!=null&&(ee=k.signal)!==null&&ee!==void 0&&ee.aborted)throw new a({cause:k.signal.reason});yield[X++,me]}}).call(this)}async function H(k,X=void 0){for await(let ee of F.call(this,k,X))return!0;return!1}async function G(k,X=void 0){if(typeof k!="function")throw new i("fn",["Function","AsyncFunction"],k);return!await H.call(this,async(...ee)=>!await k(...ee),X)}async function z(k,X){for await(let ee of F.call(this,k,X))return ee}async function Z(k,X){if(typeof k!="function")throw new i("fn",["Function","AsyncFunction"],k);async function ee(me,be){return await k(me,be),B}for await(let me of V.call(this,ee,X));}function F(k,X){if(typeof k!="function")throw new i("fn",["Function","AsyncFunction"],k);async function ee(me,be){return await k(me,be)?me:B}return V.call(this,ee,X)}var ie=class extends s{constructor(){super("reduce"),this.message="Reduce of an empty stream requires an initial value"}};async function fe(k,X,ee){var me;if(typeof k!="function")throw new i("reducer",["Function","AsyncFunction"],k);ee!=null&&h(ee,"options"),(ee==null?void 0:ee.signal)!=null&&l(ee.signal,"options.signal");let be=arguments.length>1;if(ee!=null&&(me=ee.signal)!==null&&me!==void 0&&me.aborted){let Ae=new a(void 0,{cause:ee.signal.reason});throw this.once("error",()=>{}),await g(this.destroy(Ae)),Ae}let te=new t,le=te.signal;if(ee!=null&&ee.signal){let Ae={once:!0,[d]:this,[p]:!0};ee.signal.addEventListener("abort",()=>te.abort(),Ae)}let ge=!1;try{for await(let Ae of this){var Ie;if(ge=!0,ee!=null&&(Ie=ee.signal)!==null&&Ie!==void 0&&Ie.aborted)throw new a;be?X=await k(X,Ae,{signal:le}):(X=Ae,be=!0)}if(!ge&&!be)throw new ie}finally{te.abort()}return X}async function J(k){k!=null&&h(k,"options"),(k==null?void 0:k.signal)!=null&&l(k.signal,"options.signal");let X=[];for await(let me of this){var ee;if(k!=null&&(ee=k.signal)!==null&&ee!==void 0&&ee.aborted)throw new a(void 0,{cause:k.signal.reason});_(X,me)}return X}function _e(k,X){let ee=V.call(this,k,X);return(async function*(){for await(let me of ee)yield*me}).call(this)}function oe(k){if(k=$(k),U(k))return 0;if(k<0)throw new o("number",">= 0",k);return k}function ne(k,X=void 0){return X!=null&&h(X,"options"),(X==null?void 0:X.signal)!=null&&l(X.signal,"options.signal"),k=oe(k),(async function*(){var ee;if(X!=null&&(ee=X.signal)!==null&&ee!==void 0&&ee.aborted)throw new a;for await(let be of this){var me;if(X!=null&&(me=X.signal)!==null&&me!==void 0&&me.aborted)throw new a;k--<=0&&(yield be)}}).call(this)}function de(k,X=void 0){return X!=null&&h(X,"options"),(X==null?void 0:X.signal)!=null&&l(X.signal,"options.signal"),k=oe(k),(async function*(){var ee;if(X!=null&&(ee=X.signal)!==null&&ee!==void 0&&ee.aborted)throw new a;for await(let be of this){var me;if(X!=null&&(me=X.signal)!==null&&me!==void 0&&me.aborted)throw new a;if(k-- >0&&(yield be),k<=0)return}}).call(this)}e.exports.streamReturningOperators={asIndexedPairs:b(W,"readable.asIndexedPairs will be removed in a future version."),drop:ne,filter:F,flatMap:_e,map:V,take:de,compose:L},e.exports.promiseReturningOperators={every:G,forEach:Z,reduce:fe,toArray:J,some:H,find:z}}),XO=$e((n,e)=>{Oe(),Ne(),Le();var{ArrayPrototypePop:t,Promise:r}=Ir(),{isIterable:i,isNodeStream:s,isWebStream:o}=_o(),{pipelineImpl:a}=GE(),{finished:l}=xa();ZO();function c(...h){return new r((d,p)=>{let g,m,E=h[h.length-1];if(E&&typeof E=="object"&&!s(E)&&!i(E)&&!o(E)){let y=t(h);g=y.signal,m=y.end}a(h,(y,S)=>{y?p(y):d(S)},{signal:g,end:m})})}e.exports={finished:l,pipeline:c}}),ZO=$e((n,e)=>{Oe(),Ne(),Le();var{Buffer:t}=(Jr(),nr(Qr)),{ObjectDefineProperty:r,ObjectKeys:i,ReflectApply:s}=Ir(),{promisify:{custom:o}}=ri(),{streamReturningOperators:a,promiseReturningOperators:l}=hj(),{codes:{ERR_ILLEGAL_CONSTRUCTOR:c}}=Fn(),h=YO(),{setDefaultHighWaterMark:d,getDefaultHighWaterMark:p}=Ay(),{pipeline:g}=GE(),{destroyer:m}=qu(),E=xa(),y=XO(),S=_o(),b=e.exports=KE().Stream;b.isDestroyed=S.isDestroyed,b.isDisturbed=S.isDisturbed,b.isErrored=S.isErrored,b.isReadable=S.isReadable,b.isWritable=S.isWritable,b.Readable=xy();for(let I of i(a)){let x=function(...U){if(new.target)throw c();return b.Readable.from(s($,this,U))},$=a[I];r(x,"name",{__proto__:null,value:$.name}),r(x,"length",{__proto__:null,value:$.length}),r(b.Readable.prototype,I,{__proto__:null,value:x,enumerable:!1,configurable:!0,writable:!0})}for(let I of i(l)){let x=function(...U){if(new.target)throw c();return s($,this,U)},$=l[I];r(x,"name",{__proto__:null,value:$.name}),r(x,"length",{__proto__:null,value:$.length}),r(b.Readable.prototype,I,{__proto__:null,value:x,enumerable:!1,configurable:!0,writable:!0})}b.Writable=VE(),b.Duplex=mo(),b.Transform=VO(),b.PassThrough=GO(),b.pipeline=g;var{addAbortSignal:_}=Sy();b.addAbortSignal=_,b.finished=E,b.destroy=m,b.compose=h,b.setDefaultHighWaterMark=d,b.getDefaultHighWaterMark=p,r(b,"promises",{__proto__:null,configurable:!0,enumerable:!0,get(){return y}}),r(g,o,{__proto__:null,enumerable:!0,get(){return y.pipeline}}),r(E,o,{__proto__:null,enumerable:!0,get(){return y.finished}}),b.Stream=b,b._isUint8Array=function(I){return I instanceof Uint8Array},b._uint8ArrayToBuffer=function(I){return t.from(I.buffer,I.byteOffset,I.byteLength)}}),Gl=$e((n,e)=>{Oe(),Ne(),Le();var t=ZO(),r=XO(),i=t.Readable.destroy;e.exports=t.Readable,e.exports._uint8ArrayToBuffer=t._uint8ArrayToBuffer,e.exports._isUint8Array=t._isUint8Array,e.exports.isDisturbed=t.isDisturbed,e.exports.isErrored=t.isErrored,e.exports.isReadable=t.isReadable,e.exports.Readable=t.Readable,e.exports.Writable=t.Writable,e.exports.Duplex=t.Duplex,e.exports.Transform=t.Transform,e.exports.PassThrough=t.PassThrough,e.exports.addAbortSignal=t.addAbortSignal,e.exports.finished=t.finished,e.exports.destroy=t.destroy,e.exports.destroy=i,e.exports.pipeline=t.pipeline,e.exports.compose=t.compose,Object.defineProperty(t,"promises",{configurable:!0,enumerable:!0,get(){return r}}),e.exports.Stream=t.Stream,e.exports.default=e.exports}),fj=$e((n,e)=>{Oe(),Ne(),Le(),typeof Object.create=="function"?e.exports=function(t,r){r&&(t.super_=r,t.prototype=Object.create(r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}))}:e.exports=function(t,r){if(r){t.super_=r;var i=function(){};i.prototype=r.prototype,t.prototype=new i,t.prototype.constructor=t}}}),dj=$e((n,e)=>{Oe(),Ne(),Le();var{Buffer:t}=(Jr(),nr(Qr)),r=Symbol.for("BufferList");function i(s){if(!(this instanceof i))return new i(s);i._init.call(this,s)}i._init=function(s){Object.defineProperty(this,r,{value:!0}),this._bufs=[],this.length=0,s&&this.append(s)},i.prototype._new=function(s){return new i(s)},i.prototype._offset=function(s){if(s===0)return[0,0];let o=0;for(let a=0;a<this._bufs.length;a++){let l=o+this._bufs[a].length;if(s<l||a===this._bufs.length-1)return[a,s-o];o=l}},i.prototype._reverseOffset=function(s){let o=s[0],a=s[1];for(let l=0;l<o;l++)a+=this._bufs[l].length;return a},i.prototype.getBuffers=function(){return this._bufs},i.prototype.get=function(s){if(s>this.length||s<0)return;let o=this._offset(s);return this._bufs[o[0]][o[1]]},i.prototype.slice=function(s,o){return typeof s=="number"&&s<0&&(s+=this.length),typeof o=="number"&&o<0&&(o+=this.length),this.copy(null,0,s,o)},i.prototype.copy=function(s,o,a,l){if((typeof a!="number"||a<0)&&(a=0),(typeof l!="number"||l>this.length)&&(l=this.length),a>=this.length||l<=0)return s||t.alloc(0);let c=!!s,h=this._offset(a),d=l-a,p=d,g=c&&o||0,m=h[1];if(a===0&&l===this.length){if(!c)return this._bufs.length===1?this._bufs[0]:t.concat(this._bufs,this.length);for(let E=0;E<this._bufs.length;E++)this._bufs[E].copy(s,g),g+=this._bufs[E].length;return s}if(p<=this._bufs[h[0]].length-m)return c?this._bufs[h[0]].copy(s,o,m,m+p):this._bufs[h[0]].slice(m,m+p);c||(s=t.allocUnsafe(d));for(let E=h[0];E<this._bufs.length;E++){let y=this._bufs[E].length-m;if(p>y)this._bufs[E].copy(s,g,m),g+=y;else{this._bufs[E].copy(s,g,m,m+p),g+=y;break}p-=y,m&&(m=0)}return s.length>g?s.slice(0,g):s},i.prototype.shallowSlice=function(s,o){if(s=s||0,o=typeof o!="number"?this.length:o,s<0&&(s+=this.length),o<0&&(o+=this.length),s===o)return this._new();let a=this._offset(s),l=this._offset(o),c=this._bufs.slice(a[0],l[0]+1);return l[1]===0?c.pop():c[c.length-1]=c[c.length-1].slice(0,l[1]),a[1]!==0&&(c[0]=c[0].slice(a[1])),this._new(c)},i.prototype.toString=function(s,o,a){return this.slice(o,a).toString(s)},i.prototype.consume=function(s){if(s=Math.trunc(s),Number.isNaN(s)||s<=0)return this;for(;this._bufs.length;)if(s>=this._bufs[0].length)s-=this._bufs[0].length,this.length-=this._bufs[0].length,this._bufs.shift();else{this._bufs[0]=this._bufs[0].slice(s),this.length-=s;break}return this},i.prototype.duplicate=function(){let s=this._new();for(let o=0;o<this._bufs.length;o++)s.append(this._bufs[o]);return s},i.prototype.append=function(s){return this._attach(s,i.prototype._appendBuffer)},i.prototype.prepend=function(s){return this._attach(s,i.prototype._prependBuffer,!0)},i.prototype._attach=function(s,o,a){if(s==null)return this;if(s.buffer)o.call(this,t.from(s.buffer,s.byteOffset,s.byteLength));else if(Array.isArray(s)){let[l,c]=a?[s.length-1,-1]:[0,1];for(let h=l;h>=0&&h<s.length;h+=c)this._attach(s[h],o,a)}else if(this._isBufferList(s)){let[l,c]=a?[s._bufs.length-1,-1]:[0,1];for(let h=l;h>=0&&h<s._bufs.length;h+=c)this._attach(s._bufs[h],o,a)}else typeof s=="number"&&(s=s.toString()),o.call(this,t.from(s));return this},i.prototype._appendBuffer=function(s){this._bufs.push(s),this.length+=s.length},i.prototype._prependBuffer=function(s){this._bufs.unshift(s),this.length+=s.length},i.prototype.indexOf=function(s,o,a){if(a===void 0&&typeof o=="string"&&(a=o,o=void 0),typeof s=="function"||Array.isArray(s))throw new TypeError('The "value" argument must be one of type string, Buffer, BufferList, or Uint8Array.');if(typeof s=="number"?s=t.from([s]):typeof s=="string"?s=t.from(s,a):this._isBufferList(s)?s=s.slice():Array.isArray(s.buffer)?s=t.from(s.buffer,s.byteOffset,s.byteLength):t.isBuffer(s)||(s=t.from(s)),o=Number(o||0),isNaN(o)&&(o=0),o<0&&(o=this.length+o),o<0&&(o=0),s.length===0)return o>this.length?this.length:o;let l=this._offset(o),c=l[0],h=l[1];for(;c<this._bufs.length;c++){let d=this._bufs[c];for(;h<d.length;)if(d.length-h>=s.length){let p=d.indexOf(s,h);if(p!==-1)return this._reverseOffset([c,p]);h=d.length-s.length+1}else{let p=this._reverseOffset([c,h]);if(this._match(p,s))return p;h++}h=0}return-1},i.prototype._match=function(s,o){if(this.length-s<o.length)return!1;for(let a=0;a<o.length;a++)if(this.get(s+a)!==o[a])return!1;return!0},function(){let s={readDoubleBE:8,readDoubleLE:8,readFloatBE:4,readFloatLE:4,readBigInt64BE:8,readBigInt64LE:8,readBigUInt64BE:8,readBigUInt64LE:8,readInt32BE:4,readInt32LE:4,readUInt32BE:4,readUInt32LE:4,readInt16BE:2,readInt16LE:2,readUInt16BE:2,readUInt16LE:2,readInt8:1,readUInt8:1,readIntBE:null,readIntLE:null,readUIntBE:null,readUIntLE:null};for(let o in s)(function(a){s[a]===null?i.prototype[a]=function(l,c){return this.slice(l,l+c)[a](0,c)}:i.prototype[a]=function(l=0){return this.slice(l,l+s[a])[a](0)}})(o)}(),i.prototype._isBufferList=function(s){return s instanceof i||i.isBufferList(s)},i.isBufferList=function(s){return s!=null&&s[r]},e.exports=i}),pj=$e((n,e)=>{Oe(),Ne(),Le();var t=Gl().Duplex,r=fj(),i=dj();function s(o){if(!(this instanceof s))return new s(o);if(typeof o=="function"){this._callback=o;let a=(function(l){this._callback&&(this._callback(l),this._callback=null)}).bind(this);this.on("pipe",function(l){l.on("error",a)}),this.on("unpipe",function(l){l.removeListener("error",a)}),o=null}i._init.call(this,o),t.call(this)}r(s,t),Object.assign(s.prototype,i.prototype),s.prototype._new=function(o){return new s(o)},s.prototype._write=function(o,a,l){this._appendBuffer(o),typeof l=="function"&&l()},s.prototype._read=function(o){if(!this.length)return this.push(null);o=Math.min(o,this.length),this.push(this.slice(0,o)),this.consume(o)},s.prototype.end=function(o){t.prototype.end.call(this,o),this._callback&&(this._callback(null,this.slice()),this._callback=null)},s.prototype._destroy=function(o,a){this._bufs.length=0,this.length=0,a(o)},s.prototype._isBufferList=function(o){return o instanceof s||o instanceof i||s.isBufferList(o)},s.isBufferList=i.isBufferList,e.exports=s,e.exports.BufferListStream=s,e.exports.BufferList=i}),gj=$e((n,e)=>{Oe(),Ne(),Le();var t=class{constructor(){this.cmd=null,this.retain=!1,this.qos=0,this.dup=!1,this.length=-1,this.topic=null,this.payload=null}};e.exports=t}),QO=$e((n,e)=>{Oe(),Ne(),Le();var t=e.exports,{Buffer:r}=(Jr(),nr(Qr));t.types={0:"reserved",1:"connect",2:"connack",3:"publish",4:"puback",5:"pubrec",6:"pubrel",7:"pubcomp",8:"subscribe",9:"suback",10:"unsubscribe",11:"unsuback",12:"pingreq",13:"pingresp",14:"disconnect",15:"auth"},t.requiredHeaderFlags={1:0,2:0,4:0,5:0,6:2,7:0,8:2,9:0,10:2,11:0,12:0,13:0,14:0,15:0},t.requiredHeaderFlagsErrors={};for(let s in t.requiredHeaderFlags){let o=t.requiredHeaderFlags[s];t.requiredHeaderFlagsErrors[s]="Invalid header flag bits, must be 0x"+o.toString(16)+" for "+t.types[s]+" packet"}t.codes={};for(let s in t.types){let o=t.types[s];t.codes[o]=s}t.CMD_SHIFT=4,t.CMD_MASK=240,t.DUP_MASK=8,t.QOS_MASK=3,t.QOS_SHIFT=1,t.RETAIN_MASK=1,t.VARBYTEINT_MASK=127,t.VARBYTEINT_FIN_MASK=128,t.VARBYTEINT_MAX=268435455,t.SESSIONPRESENT_MASK=1,t.SESSIONPRESENT_HEADER=r.from([t.SESSIONPRESENT_MASK]),t.CONNACK_HEADER=r.from([t.codes.connack<<t.CMD_SHIFT]),t.USERNAME_MASK=128,t.PASSWORD_MASK=64,t.WILL_RETAIN_MASK=32,t.WILL_QOS_MASK=24,t.WILL_QOS_SHIFT=3,t.WILL_FLAG_MASK=4,t.CLEAN_SESSION_MASK=2,t.CONNECT_HEADER=r.from([t.codes.connect<<t.CMD_SHIFT]),t.properties={sessionExpiryInterval:17,willDelayInterval:24,receiveMaximum:33,maximumPacketSize:39,topicAliasMaximum:34,requestResponseInformation:25,requestProblemInformation:23,userProperties:38,authenticationMethod:21,authenticationData:22,payloadFormatIndicator:1,messageExpiryInterval:2,contentType:3,responseTopic:8,correlationData:9,maximumQoS:36,retainAvailable:37,assignedClientIdentifier:18,reasonString:31,wildcardSubscriptionAvailable:40,subscriptionIdentifiersAvailable:41,sharedSubscriptionAvailable:42,serverKeepAlive:19,responseInformation:26,serverReference:28,topicAlias:35,subscriptionIdentifier:11},t.propertiesCodes={};for(let s in t.properties){let o=t.properties[s];t.propertiesCodes[o]=s}t.propertiesTypes={sessionExpiryInterval:"int32",willDelayInterval:"int32",receiveMaximum:"int16",maximumPacketSize:"int32",topicAliasMaximum:"int16",requestResponseInformation:"byte",requestProblemInformation:"byte",userProperties:"pair",authenticationMethod:"string",authenticationData:"binary",payloadFormatIndicator:"byte",messageExpiryInterval:"int32",contentType:"string",responseTopic:"string",correlationData:"binary",maximumQoS:"int8",retainAvailable:"byte",assignedClientIdentifier:"string",reasonString:"string",wildcardSubscriptionAvailable:"byte",subscriptionIdentifiersAvailable:"byte",sharedSubscriptionAvailable:"byte",serverKeepAlive:"int16",responseInformation:"string",serverReference:"string",topicAlias:"int16",subscriptionIdentifier:"var"};function i(s){return[0,1,2].map(o=>[0,1].map(a=>[0,1].map(l=>{let c=r.alloc(1);return c.writeUInt8(t.codes[s]<<t.CMD_SHIFT|(a?t.DUP_MASK:0)|o<<t.QOS_SHIFT|l,0,!0),c})))}t.PUBLISH_HEADER=i("publish"),t.SUBSCRIBE_HEADER=i("subscribe"),t.SUBSCRIBE_OPTIONS_QOS_MASK=3,t.SUBSCRIBE_OPTIONS_NL_MASK=1,t.SUBSCRIBE_OPTIONS_NL_SHIFT=2,t.SUBSCRIBE_OPTIONS_RAP_MASK=1,t.SUBSCRIBE_OPTIONS_RAP_SHIFT=3,t.SUBSCRIBE_OPTIONS_RH_MASK=3,t.SUBSCRIBE_OPTIONS_RH_SHIFT=4,t.SUBSCRIBE_OPTIONS_RH=[0,16,32],t.SUBSCRIBE_OPTIONS_NL=4,t.SUBSCRIBE_OPTIONS_RAP=8,t.SUBSCRIBE_OPTIONS_QOS=[0,1,2],t.UNSUBSCRIBE_HEADER=i("unsubscribe"),t.ACKS={unsuback:i("unsuback"),puback:i("puback"),pubcomp:i("pubcomp"),pubrel:i("pubrel"),pubrec:i("pubrec")},t.SUBACK_HEADER=r.from([t.codes.suback<<t.CMD_SHIFT]),t.VERSION3=r.from([3]),t.VERSION4=r.from([4]),t.VERSION5=r.from([5]),t.VERSION131=r.from([131]),t.VERSION132=r.from([132]),t.QOS=[0,1,2].map(s=>r.from([s])),t.EMPTY={pingreq:r.from([t.codes.pingreq<<4,0]),pingresp:r.from([t.codes.pingresp<<4,0]),disconnect:r.from([t.codes.disconnect<<4,0])},t.MQTT5_PUBACK_PUBREC_CODES={0:"Success",16:"No matching subscribers",128:"Unspecified error",131:"Implementation specific error",135:"Not authorized",144:"Topic Name invalid",145:"Packet identifier in use",151:"Quota exceeded",153:"Payload format invalid"},t.MQTT5_PUBREL_PUBCOMP_CODES={0:"Success",146:"Packet Identifier not found"},t.MQTT5_SUBACK_CODES={0:"Granted QoS 0",1:"Granted QoS 1",2:"Granted QoS 2",128:"Unspecified error",131:"Implementation specific error",135:"Not authorized",143:"Topic Filter invalid",145:"Packet Identifier in use",151:"Quota exceeded",158:"Shared Subscriptions not supported",161:"Subscription Identifiers not supported",162:"Wildcard Subscriptions not supported"},t.MQTT5_UNSUBACK_CODES={0:"Success",17:"No subscription existed",128:"Unspecified error",131:"Implementation specific error",135:"Not authorized",143:"Topic Filter invalid",145:"Packet Identifier in use"},t.MQTT5_DISCONNECT_CODES={0:"Normal disconnection",4:"Disconnect with Will Message",128:"Unspecified error",129:"Malformed Packet",130:"Protocol Error",131:"Implementation specific error",135:"Not authorized",137:"Server busy",139:"Server shutting down",141:"Keep Alive timeout",142:"Session taken over",143:"Topic Filter invalid",144:"Topic Name invalid",147:"Receive Maximum exceeded",148:"Topic Alias invalid",149:"Packet too large",150:"Message rate too high",151:"Quota exceeded",152:"Administrative action",153:"Payload format invalid",154:"Retain not supported",155:"QoS not supported",156:"Use another server",157:"Server moved",158:"Shared Subscriptions not supported",159:"Connection rate exceeded",160:"Maximum connect time",161:"Subscription Identifiers not supported",162:"Wildcard Subscriptions not supported"},t.MQTT5_AUTH_CODES={0:"Success",24:"Continue authentication",25:"Re-authenticate"}}),mj=$e((n,e)=>{Oe(),Ne(),Le();var t=1e3,r=t*60,i=r*60,s=i*24,o=s*7,a=s*365.25;e.exports=function(p,g){g=g||{};var m=typeof p;if(m==="string"&&p.length>0)return l(p);if(m==="number"&&isFinite(p))return g.long?h(p):c(p);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(p))};function l(p){if(p=String(p),!(p.length>100)){var g=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(p);if(g){var m=parseFloat(g[1]),E=(g[2]||"ms").toLowerCase();switch(E){case"years":case"year":case"yrs":case"yr":case"y":return m*a;case"weeks":case"week":case"w":return m*o;case"days":case"day":case"d":return m*s;case"hours":case"hour":case"hrs":case"hr":case"h":return m*i;case"minutes":case"minute":case"mins":case"min":case"m":return m*r;case"seconds":case"second":case"secs":case"sec":case"s":return m*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return m;default:return}}}}function c(p){var g=Math.abs(p);return g>=s?Math.round(p/s)+"d":g>=i?Math.round(p/i)+"h":g>=r?Math.round(p/r)+"m":g>=t?Math.round(p/t)+"s":p+"ms"}function h(p){var g=Math.abs(p);return g>=s?d(p,g,s,"day"):g>=i?d(p,g,i,"hour"):g>=r?d(p,g,r,"minute"):g>=t?d(p,g,t,"second"):p+" ms"}function d(p,g,m,E){var y=g>=m*1.5;return Math.round(p/m)+" "+E+(y?"s":"")}}),yj=$e((n,e)=>{Oe(),Ne(),Le();function t(r){s.debug=s,s.default=s,s.coerce=d,s.disable=c,s.enable=a,s.enabled=h,s.humanize=mj(),s.destroy=p,Object.keys(r).forEach(g=>{s[g]=r[g]}),s.names=[],s.skips=[],s.formatters={};function i(g){let m=0;for(let E=0;E<g.length;E++)m=(m<<5)-m+g.charCodeAt(E),m|=0;return s.colors[Math.abs(m)%s.colors.length]}s.selectColor=i;function s(g){let m,E=null,y,S;function b(..._){if(!b.enabled)return;let I=b,x=Number(new Date),$=x-(m||x);I.diff=$,I.prev=m,I.curr=x,m=x,_[0]=s.coerce(_[0]),typeof _[0]!="string"&&_.unshift("%O");let U=0;_[0]=_[0].replace(/%([a-zA-Z%])/g,(O,P)=>{if(O==="%%")return"%";U++;let M=s.formatters[P];if(typeof M=="function"){let K=_[U];O=M.call(I,K),_.splice(U,1),U--}return O}),s.formatArgs.call(I,_),(I.log||s.log).apply(I,_)}return b.namespace=g,b.useColors=s.useColors(),b.color=s.selectColor(g),b.extend=o,b.destroy=s.destroy,Object.defineProperty(b,"enabled",{enumerable:!0,configurable:!1,get:()=>E!==null?E:(y!==s.namespaces&&(y=s.namespaces,S=s.enabled(g)),S),set:_=>{E=_}}),typeof s.init=="function"&&s.init(b),b}function o(g,m){let E=s(this.namespace+(typeof m>"u"?":":m)+g);return E.log=this.log,E}function a(g){s.save(g),s.namespaces=g,s.names=[],s.skips=[];let m=(typeof g=="string"?g:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(let E of m)E[0]==="-"?s.skips.push(E.slice(1)):s.names.push(E)}function l(g,m){let E=0,y=0,S=-1,b=0;for(;E<g.length;)if(y<m.length&&(m[y]===g[E]||m[y]==="*"))m[y]==="*"?(S=y,b=E,y++):(E++,y++);else if(S!==-1)y=S+1,b++,E=b;else return!1;for(;y<m.length&&m[y]==="*";)y++;return y===m.length}function c(){let g=[...s.names,...s.skips.map(m=>"-"+m)].join(",");return s.enable(""),g}function h(g){for(let m of s.skips)if(l(g,m))return!1;for(let m of s.names)if(l(g,m))return!0;return!1}function d(g){return g instanceof Error?g.stack||g.message:g}function p(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return s.enable(s.load()),s}e.exports=t}),yo=$e((n,e)=>{Oe(),Ne(),Le(),n.formatArgs=r,n.save=i,n.load=s,n.useColors=t,n.storage=o(),n.destroy=(()=>{let l=!1;return()=>{l||(l=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),n.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function t(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let l;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(l=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(l[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function r(l){if(l[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+l[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;let c="color: "+this.color;l.splice(1,0,c,"color: inherit");let h=0,d=0;l[0].replace(/%[a-zA-Z%]/g,p=>{p!=="%%"&&(h++,p==="%c"&&(d=h))}),l.splice(d,0,c)}n.log=console.debug||console.log||(()=>{});function i(l){try{l?n.storage.setItem("debug",l):n.storage.removeItem("debug")}catch{}}function s(){let l;try{l=n.storage.getItem("debug")||n.storage.getItem("DEBUG")}catch{}return!l&&typeof Ut<"u"&&"env"in Ut&&(l=Ut.env.DEBUG),l}function o(){try{return localStorage}catch{}}e.exports=yj()(n);var{formatters:a}=e.exports;a.j=function(l){try{return JSON.stringify(l)}catch(c){return"[UnexpectedJSONParseError]: "+c.message}}}),bj=$e((n,e)=>{Oe(),Ne(),Le();var t=pj(),{EventEmitter:r}=(Kl(),nr(Aa)),i=gj(),s=QO(),o=yo()("mqtt-packet:parser"),a=class __ extends r{constructor(){super(),this.parser=this.constructor.parser}static parser(c){return this instanceof __?(this.settings=c||{},this._states=["_parseHeader","_parseLength","_parsePayload","_newPacket"],this._resetState(),this):new __().parser(c)}_resetState(){o("_resetState: resetting packet, error, _list, and _stateCounter"),this.packet=new i,this.error=null,this._list=t(),this._stateCounter=0}parse(c){for(this.error&&this._resetState(),this._list.append(c),o("parse: current state: %s",this._states[this._stateCounter]);(this.packet.length!==-1||this._list.length>0)&&this[this._states[this._stateCounter]]()&&!this.error;)this._stateCounter++,o("parse: state complete. _stateCounter is now: %d",this._stateCounter),o("parse: packet.length: %d, buffer list length: %d",this.packet.length,this._list.length),this._stateCounter>=this._states.length&&(this._stateCounter=0);return o("parse: exited while loop. packet: %d, buffer list length: %d",this.packet.length,this._list.length),this._list.length}_parseHeader(){let c=this._list.readUInt8(0),h=c>>s.CMD_SHIFT;this.packet.cmd=s.types[h];let d=c&15,p=s.requiredHeaderFlags[h];return p!=null&&d!==p?this._emitError(new Error(s.requiredHeaderFlagsErrors[h])):(this.packet.retain=(c&s.RETAIN_MASK)!==0,this.packet.qos=c>>s.QOS_SHIFT&s.QOS_MASK,this.packet.qos>2?this._emitError(new Error("Packet must not have both QoS bits set to 1")):(this.packet.dup=(c&s.DUP_MASK)!==0,o("_parseHeader: packet: %o",this.packet),this._list.consume(1),!0))}_parseLength(){let c=this._parseVarByteNum(!0);return c&&(this.packet.length=c.value,this._list.consume(c.bytes)),o("_parseLength %d",c.value),!!c}_parsePayload(){o("_parsePayload: payload %O",this._list);let c=!1;if(this.packet.length===0||this._list.length>=this.packet.length){switch(this._pos=0,this.packet.cmd){case"connect":this._parseConnect();break;case"connack":this._parseConnack();break;case"publish":this._parsePublish();break;case"puback":case"pubrec":case"pubrel":case"pubcomp":this._parseConfirmation();break;case"subscribe":this._parseSubscribe();break;case"suback":this._parseSuback();break;case"unsubscribe":this._parseUnsubscribe();break;case"unsuback":this._parseUnsuback();break;case"pingreq":case"pingresp":break;case"disconnect":this._parseDisconnect();break;case"auth":this._parseAuth();break;default:this._emitError(new Error("Not supported"))}c=!0}return o("_parsePayload complete result: %s",c),c}_parseConnect(){o("_parseConnect");let c,h,d,p,g={},m=this.packet,E=this._parseString();if(E===null)return this._emitError(new Error("Cannot parse protocolId"));if(E!=="MQTT"&&E!=="MQIsdp")return this._emitError(new Error("Invalid protocolId"));if(m.protocolId=E,this._pos>=this._list.length)return this._emitError(new Error("Packet too short"));if(m.protocolVersion=this._list.readUInt8(this._pos),m.protocolVersion>=128&&(m.bridgeMode=!0,m.protocolVersion=m.protocolVersion-128),m.protocolVersion!==3&&m.protocolVersion!==4&&m.protocolVersion!==5)return this._emitError(new Error("Invalid protocol version"));if(this._pos++,this._pos>=this._list.length)return this._emitError(new Error("Packet too short"));if(this._list.readUInt8(this._pos)&1)return this._emitError(new Error("Connect flag bit 0 must be 0, but got 1"));g.username=this._list.readUInt8(this._pos)&s.USERNAME_MASK,g.password=this._list.readUInt8(this._pos)&s.PASSWORD_MASK,g.will=this._list.readUInt8(this._pos)&s.WILL_FLAG_MASK;let y=!!(this._list.readUInt8(this._pos)&s.WILL_RETAIN_MASK),S=(this._list.readUInt8(this._pos)&s.WILL_QOS_MASK)>>s.WILL_QOS_SHIFT;if(g.will)m.will={},m.will.retain=y,m.will.qos=S;else{if(y)return this._emitError(new Error("Will Retain Flag must be set to zero when Will Flag is set to 0"));if(S)return this._emitError(new Error("Will QoS must be set to zero when Will Flag is set to 0"))}if(m.clean=(this._list.readUInt8(this._pos)&s.CLEAN_SESSION_MASK)!==0,this._pos++,m.keepalive=this._parseNum(),m.keepalive===-1)return this._emitError(new Error("Packet too short"));if(m.protocolVersion===5){let _=this._parseProperties();Object.getOwnPropertyNames(_).length&&(m.properties=_)}let b=this._parseString();if(b===null)return this._emitError(new Error("Packet too short"));if(m.clientId=b,o("_parseConnect: packet.clientId: %s",m.clientId),g.will){if(m.protocolVersion===5){let _=this._parseProperties();Object.getOwnPropertyNames(_).length&&(m.will.properties=_)}if(c=this._parseString(),c===null)return this._emitError(new Error("Cannot parse will topic"));if(m.will.topic=c,o("_parseConnect: packet.will.topic: %s",m.will.topic),h=this._parseBuffer(),h===null)return this._emitError(new Error("Cannot parse will payload"));m.will.payload=h,o("_parseConnect: packet.will.paylaod: %s",m.will.payload)}if(g.username){if(p=this._parseString(),p===null)return this._emitError(new Error("Cannot parse username"));m.username=p,o("_parseConnect: packet.username: %s",m.username)}if(g.password){if(d=this._parseBuffer(),d===null)return this._emitError(new Error("Cannot parse password"));m.password=d}return this.settings=m,o("_parseConnect: complete"),m}_parseConnack(){o("_parseConnack");let c=this.packet;if(this._list.length<1)return null;let h=this._list.readUInt8(this._pos++);if(h>1)return this._emitError(new Error("Invalid connack flags, bits 7-1 must be set to 0"));if(c.sessionPresent=!!(h&s.SESSIONPRESENT_MASK),this.settings.protocolVersion===5)this._list.length>=2?c.reasonCode=this._list.readUInt8(this._pos++):c.reasonCode=0;else{if(this._list.length<2)return null;c.returnCode=this._list.readUInt8(this._pos++)}if(c.returnCode===-1||c.reasonCode===-1)return this._emitError(new Error("Cannot parse return code"));if(this.settings.protocolVersion===5){let d=this._parseProperties();Object.getOwnPropertyNames(d).length&&(c.properties=d)}o("_parseConnack: complete")}_parsePublish(){o("_parsePublish");let c=this.packet;if(c.topic=this._parseString(),c.topic===null)return this._emitError(new Error("Cannot parse topic"));if(!(c.qos>0&&!this._parseMessageId())){if(this.settings.protocolVersion===5){let h=this._parseProperties();Object.getOwnPropertyNames(h).length&&(c.properties=h)}c.payload=this._list.slice(this._pos,c.length),o("_parsePublish: payload from buffer list: %o",c.payload)}}_parseSubscribe(){o("_parseSubscribe");let c=this.packet,h,d,p,g,m,E,y;if(c.subscriptions=[],!!this._parseMessageId()){if(this.settings.protocolVersion===5){let S=this._parseProperties();Object.getOwnPropertyNames(S).length&&(c.properties=S)}if(c.length<=0)return this._emitError(new Error("Malformed subscribe, no payload specified"));for(;this._pos<c.length;){if(h=this._parseString(),h===null)return this._emitError(new Error("Cannot parse topic"));if(this._pos>=c.length)return this._emitError(new Error("Malformed Subscribe Payload"));if(d=this._parseByte(),this.settings.protocolVersion===5){if(d&192)return this._emitError(new Error("Invalid subscribe topic flag bits, bits 7-6 must be 0"))}else if(d&252)return this._emitError(new Error("Invalid subscribe topic flag bits, bits 7-2 must be 0"));if(p=d&s.SUBSCRIBE_OPTIONS_QOS_MASK,p>2)return this._emitError(new Error("Invalid subscribe QoS, must be <= 2"));if(E=(d>>s.SUBSCRIBE_OPTIONS_NL_SHIFT&s.SUBSCRIBE_OPTIONS_NL_MASK)!==0,m=(d>>s.SUBSCRIBE_OPTIONS_RAP_SHIFT&s.SUBSCRIBE_OPTIONS_RAP_MASK)!==0,g=d>>s.SUBSCRIBE_OPTIONS_RH_SHIFT&s.SUBSCRIBE_OPTIONS_RH_MASK,g>2)return this._emitError(new Error("Invalid retain handling, must be <= 2"));y={topic:h,qos:p},this.settings.protocolVersion===5?(y.nl=E,y.rap=m,y.rh=g):this.settings.bridgeMode&&(y.rh=0,y.rap=!0,y.nl=!0),o("_parseSubscribe: push subscription `%s` to subscription",y),c.subscriptions.push(y)}}}_parseSuback(){o("_parseSuback");let c=this.packet;if(this.packet.granted=[],!!this._parseMessageId()){if(this.settings.protocolVersion===5){let h=this._parseProperties();Object.getOwnPropertyNames(h).length&&(c.properties=h)}if(c.length<=0)return this._emitError(new Error("Malformed suback, no payload specified"));for(;this._pos<this.packet.length;){let h=this._list.readUInt8(this._pos++);if(this.settings.protocolVersion===5){if(!s.MQTT5_SUBACK_CODES[h])return this._emitError(new Error("Invalid suback code"))}else if(h>2&&h!==128)return this._emitError(new Error("Invalid suback QoS, must be 0, 1, 2 or 128"));this.packet.granted.push(h)}}}_parseUnsubscribe(){o("_parseUnsubscribe");let c=this.packet;if(c.unsubscriptions=[],!!this._parseMessageId()){if(this.settings.protocolVersion===5){let h=this._parseProperties();Object.getOwnPropertyNames(h).length&&(c.properties=h)}if(c.length<=0)return this._emitError(new Error("Malformed unsubscribe, no payload specified"));for(;this._pos<c.length;){let h=this._parseString();if(h===null)return this._emitError(new Error("Cannot parse topic"));o("_parseUnsubscribe: push topic `%s` to unsubscriptions",h),c.unsubscriptions.push(h)}}}_parseUnsuback(){o("_parseUnsuback");let c=this.packet;if(!this._parseMessageId())return this._emitError(new Error("Cannot parse messageId"));if((this.settings.protocolVersion===3||this.settings.protocolVersion===4)&&c.length!==2)return this._emitError(new Error("Malformed unsuback, payload length must be 2"));if(c.length<=0)return this._emitError(new Error("Malformed unsuback, no payload specified"));if(this.settings.protocolVersion===5){let h=this._parseProperties();for(Object.getOwnPropertyNames(h).length&&(c.properties=h),c.granted=[];this._pos<this.packet.length;){let d=this._list.readUInt8(this._pos++);if(!s.MQTT5_UNSUBACK_CODES[d])return this._emitError(new Error("Invalid unsuback code"));this.packet.granted.push(d)}}}_parseConfirmation(){o("_parseConfirmation: packet.cmd: `%s`",this.packet.cmd);let c=this.packet;if(this._parseMessageId(),this.settings.protocolVersion===5){if(c.length>2){switch(c.reasonCode=this._parseByte(),this.packet.cmd){case"puback":case"pubrec":if(!s.MQTT5_PUBACK_PUBREC_CODES[c.reasonCode])return this._emitError(new Error("Invalid "+this.packet.cmd+" reason code"));break;case"pubrel":case"pubcomp":if(!s.MQTT5_PUBREL_PUBCOMP_CODES[c.reasonCode])return this._emitError(new Error("Invalid "+this.packet.cmd+" reason code"));break}o("_parseConfirmation: packet.reasonCode `%d`",c.reasonCode)}else c.reasonCode=0;if(c.length>3){let h=this._parseProperties();Object.getOwnPropertyNames(h).length&&(c.properties=h)}}return!0}_parseDisconnect(){let c=this.packet;if(o("_parseDisconnect"),this.settings.protocolVersion===5){this._list.length>0?(c.reasonCode=this._parseByte(),s.MQTT5_DISCONNECT_CODES[c.reasonCode]||this._emitError(new Error("Invalid disconnect reason code"))):c.reasonCode=0;let h=this._parseProperties();Object.getOwnPropertyNames(h).length&&(c.properties=h)}return o("_parseDisconnect result: true"),!0}_parseAuth(){o("_parseAuth");let c=this.packet;if(this.settings.protocolVersion!==5)return this._emitError(new Error("Not supported auth packet for this version MQTT"));if(c.reasonCode=this._parseByte(),!s.MQTT5_AUTH_CODES[c.reasonCode])return this._emitError(new Error("Invalid auth reason code"));let h=this._parseProperties();return Object.getOwnPropertyNames(h).length&&(c.properties=h),o("_parseAuth: result: true"),!0}_parseMessageId(){let c=this.packet;return c.messageId=this._parseNum(),c.messageId===null?(this._emitError(new Error("Cannot parse messageId")),!1):(o("_parseMessageId: packet.messageId %d",c.messageId),!0)}_parseString(c){let h=this._parseNum(),d=h+this._pos;if(h===-1||d>this._list.length||d>this.packet.length)return null;let p=this._list.toString("utf8",this._pos,d);return this._pos+=h,o("_parseString: result: %s",p),p}_parseStringPair(){return o("_parseStringPair"),{name:this._parseString(),value:this._parseString()}}_parseBuffer(){let c=this._parseNum(),h=c+this._pos;if(c===-1||h>this._list.length||h>this.packet.length)return null;let d=this._list.slice(this._pos,h);return this._pos+=c,o("_parseBuffer: result: %o",d),d}_parseNum(){if(this._list.length-this._pos<2)return-1;let c=this._list.readUInt16BE(this._pos);return this._pos+=2,o("_parseNum: result: %s",c),c}_parse4ByteNum(){if(this._list.length-this._pos<4)return-1;let c=this._list.readUInt32BE(this._pos);return this._pos+=4,o("_parse4ByteNum: result: %s",c),c}_parseVarByteNum(c){o("_parseVarByteNum");let h=4,d=0,p=1,g=0,m=!1,E,y=this._pos?this._pos:0;for(;d<h&&y+d<this._list.length;){if(E=this._list.readUInt8(y+d++),g+=p*(E&s.VARBYTEINT_MASK),p*=128,(E&s.VARBYTEINT_FIN_MASK)===0){m=!0;break}if(this._list.length<=d)break}return!m&&d===h&&this._list.length>=d&&this._emitError(new Error("Invalid variable byte integer")),y&&(this._pos+=d),m?c?m={bytes:d,value:g}:m=g:m=!1,o("_parseVarByteNum: result: %o",m),m}_parseByte(){let c;return this._pos<this._list.length&&(c=this._list.readUInt8(this._pos),this._pos++),o("_parseByte: result: %o",c),c}_parseByType(c){switch(o("_parseByType: type: %s",c),c){case"byte":return this._parseByte()!==0;case"int8":return this._parseByte();case"int16":return this._parseNum();case"int32":return this._parse4ByteNum();case"var":return this._parseVarByteNum();case"string":return this._parseString();case"pair":return this._parseStringPair();case"binary":return this._parseBuffer()}}_parseProperties(){o("_parseProperties");let c=this._parseVarByteNum(),h=this._pos+c,d={};for(;this._pos<h;){let p=this._parseByte();if(!p)return this._emitError(new Error("Cannot parse property code type")),!1;let g=s.propertiesCodes[p];if(!g)return this._emitError(new Error("Unknown property")),!1;if(g==="userProperties"){d[g]||(d[g]=Object.create(null));let m=this._parseByType(s.propertiesTypes[g]);if(d[g][m.name])if(Array.isArray(d[g][m.name]))d[g][m.name].push(m.value);else{let E=d[g][m.name];d[g][m.name]=[E],d[g][m.name].push(m.value)}else d[g][m.name]=m.value;continue}d[g]?Array.isArray(d[g])?d[g].push(this._parseByType(s.propertiesTypes[g])):(d[g]=[d[g]],d[g].push(this._parseByType(s.propertiesTypes[g]))):d[g]=this._parseByType(s.propertiesTypes[g])}return d}_newPacket(){return o("_newPacket"),this.packet&&(this._list.consume(this.packet.length),o("_newPacket: parser emit packet: packet.cmd: %s, packet.payload: %s, packet.length: %d",this.packet.cmd,this.packet.payload,this.packet.length),this.emit("packet",this.packet)),o("_newPacket: new packet"),this.packet=new i,this._pos=0,!0}_emitError(c){o("_emitError",c),this.error=c,this.emit("error",c)}};e.exports=a}),wj=$e((n,e)=>{Oe(),Ne(),Le();var{Buffer:t}=(Jr(),nr(Qr)),r=65536,i={},s=t.isBuffer(t.from([1,2]).subarray(0,1));function o(h){let d=t.allocUnsafe(2);return d.writeUInt8(h>>8,0),d.writeUInt8(h&255,1),d}function a(){for(let h=0;h<r;h++)i[h]=o(h)}function l(h){let d=0,p=0,g=t.allocUnsafe(4);do d=h%128|0,h=h/128|0,h>0&&(d=d|128),g.writeUInt8(d,p++);while(h>0&&p<4);return h>0&&(p=0),s?g.subarray(0,p):g.slice(0,p)}function c(h){let d=t.allocUnsafe(4);return d.writeUInt32BE(h,0),d}e.exports={cache:i,generateCache:a,generateNumber:o,genBufVariableByteInt:l,generate4ByteBuffer:c}}),vj=$e((n,e)=>{Oe(),Ne(),Le(),typeof Ut>"u"||!Ut.version||Ut.version.indexOf("v0.")===0||Ut.version.indexOf("v1.")===0&&Ut.version.indexOf("v1.8.")!==0?e.exports={nextTick:t}:e.exports=Ut;function t(r,i,s,o){if(typeof r!="function")throw new TypeError('"callback" argument must be a function');var a=arguments.length,l,c;switch(a){case 0:case 1:return Ut.nextTick(r);case 2:return Ut.nextTick(function(){r.call(null,i)});case 3:return Ut.nextTick(function(){r.call(null,i,s)});case 4:return Ut.nextTick(function(){r.call(null,i,s,o)});default:for(l=new Array(a-1),c=0;c<l.length;)l[c++]=arguments[c];return Ut.nextTick(function(){r.apply(null,l)})}}}),JO=$e((n,e)=>{Oe(),Ne(),Le();var t=QO(),{Buffer:r}=(Jr(),nr(Qr)),i=r.allocUnsafe(0),s=r.from([0]),o=wj(),a=vj().nextTick,l=yo()("mqtt-packet:writeToStream"),c=o.cache,h=o.generateNumber,d=o.generateCache,p=o.genBufVariableByteInt,g=o.generate4ByteBuffer,m=W,E=!0;function y(oe,ne,de){switch(l("generate called"),ne.cork&&(ne.cork(),a(S,ne)),E&&(E=!1,d()),l("generate: packet.cmd: %s",oe.cmd),oe.cmd){case"connect":return b(oe,ne);case"connack":return _(oe,ne,de);case"publish":return I(oe,ne,de);case"puback":case"pubrec":case"pubrel":case"pubcomp":return x(oe,ne,de);case"subscribe":return $(oe,ne,de);case"suback":return U(oe,ne,de);case"unsubscribe":return O(oe,ne,de);case"unsuback":return P(oe,ne,de);case"pingreq":case"pingresp":return M(oe,ne);case"disconnect":return K(oe,ne,de);case"auth":return C(oe,ne,de);default:return ne.destroy(new Error("Unknown command")),!1}}Object.defineProperty(y,"cacheNumbers",{get(){return m===W},set(oe){oe?((!c||Object.keys(c).length===0)&&(E=!0),m=W):(E=!1,m=H)}});function S(oe){oe.uncork()}function b(oe,ne,de){let k=oe||{},X=k.protocolId||"MQTT",ee=k.protocolVersion||4,me=k.will,be=k.clean,te=k.keepalive||0,le=k.clientId||"",ge=k.username,Ie=k.password,Ae=k.properties;be===void 0&&(be=!0);let Te=0;if(typeof X!="string"&&!r.isBuffer(X))return ne.destroy(new Error("Invalid protocolId")),!1;if(Te+=X.length+2,ee!==3&&ee!==4&&ee!==5)return ne.destroy(new Error("Invalid protocol version")),!1;if(Te+=1,(typeof le=="string"||r.isBuffer(le))&&(le||ee>=4)&&(le||be))Te+=r.byteLength(le)+2;else{if(ee<4)return ne.destroy(new Error("clientId must be supplied before 3.1.1")),!1;if(be*1===0)return ne.destroy(new Error("clientId must be given if cleanSession set to 0")),!1}if(typeof te!="number"||te<0||te>65535||te%1!==0)return ne.destroy(new Error("Invalid keepalive")),!1;Te+=2,Te+=1;let ye,Re;if(ee===5){if(ye=Z(ne,Ae),!ye)return!1;Te+=ye.length}if(me){if(typeof me!="object")return ne.destroy(new Error("Invalid will")),!1;if(!me.topic||typeof me.topic!="string")return ne.destroy(new Error("Invalid will topic")),!1;if(Te+=r.byteLength(me.topic)+2,Te+=2,me.payload)if(me.payload.length>=0)typeof me.payload=="string"?Te+=r.byteLength(me.payload):Te+=me.payload.length;else return ne.destroy(new Error("Invalid will payload")),!1;if(Re={},ee===5){if(Re=Z(ne,me.properties),!Re)return!1;Te+=Re.length}}let Fe=!1;if(ge!=null)if(_e(ge))Fe=!0,Te+=r.byteLength(ge)+2;else return ne.destroy(new Error("Invalid username")),!1;if(Ie!=null){if(!Fe)return ne.destroy(new Error("Username is required to use password")),!1;if(_e(Ie))Te+=J(Ie)+2;else return ne.destroy(new Error("Invalid password")),!1}ne.write(t.CONNECT_HEADER),N(ne,Te),z(ne,X),k.bridgeMode&&(ee+=128),ne.write(ee===131?t.VERSION131:ee===132?t.VERSION132:ee===4?t.VERSION4:ee===5?t.VERSION5:t.VERSION3);let Ce=0;return Ce|=ge!=null?t.USERNAME_MASK:0,Ce|=Ie!=null?t.PASSWORD_MASK:0,Ce|=me&&me.retain?t.WILL_RETAIN_MASK:0,Ce|=me&&me.qos?me.qos<<t.WILL_QOS_SHIFT:0,Ce|=me?t.WILL_FLAG_MASK:0,Ce|=be?t.CLEAN_SESSION_MASK:0,ne.write(r.from([Ce])),m(ne,te),ee===5&&ye.write(),z(ne,le),me&&(ee===5&&Re.write(),L(ne,me.topic),z(ne,me.payload)),ge!=null&&z(ne,ge),Ie!=null&&z(ne,Ie),!0}function _(oe,ne,de){let k=de?de.protocolVersion:4,X=oe||{},ee=k===5?X.reasonCode:X.returnCode,me=X.properties,be=2;if(typeof ee!="number")return ne.destroy(new Error("Invalid return code")),!1;let te=null;if(k===5){if(te=Z(ne,me),!te)return!1;be+=te.length}return ne.write(t.CONNACK_HEADER),N(ne,be),ne.write(X.sessionPresent?t.SESSIONPRESENT_HEADER:s),ne.write(r.from([ee])),te==null||te.write(),!0}function I(oe,ne,de){l("publish: packet: %o",oe);let k=de?de.protocolVersion:4,X=oe||{},ee=X.qos||0,me=X.retain?t.RETAIN_MASK:0,be=X.topic,te=X.payload||i,le=X.messageId,ge=X.properties,Ie=0;if(typeof be=="string")Ie+=r.byteLength(be)+2;else if(r.isBuffer(be))Ie+=be.length+2;else return ne.destroy(new Error("Invalid topic")),!1;if(r.isBuffer(te)?Ie+=te.length:Ie+=r.byteLength(te),ee&&typeof le!="number")return ne.destroy(new Error("Invalid messageId")),!1;ee&&(Ie+=2);let Ae=null;if(k===5){if(Ae=Z(ne,ge),!Ae)return!1;Ie+=Ae.length}return ne.write(t.PUBLISH_HEADER[ee][X.dup?1:0][me?1:0]),N(ne,Ie),m(ne,J(be)),ne.write(be),ee>0&&m(ne,le),Ae==null||Ae.write(),l("publish: payload: %o",te),ne.write(te)}function x(oe,ne,de){let k=de?de.protocolVersion:4,X=oe||{},ee=X.cmd||"puback",me=X.messageId,be=X.dup&&ee==="pubrel"?t.DUP_MASK:0,te=0,le=X.reasonCode,ge=X.properties,Ie=k===5?3:2;if(ee==="pubrel"&&(te=1),typeof me!="number")return ne.destroy(new Error("Invalid messageId")),!1;let Ae=null;if(k===5&&typeof ge=="object"){if(Ae=F(ne,ge,de,Ie),!Ae)return!1;Ie+=Ae.length}return ne.write(t.ACKS[ee][te][be][0]),Ie===3&&(Ie+=le!==0?1:-1),N(ne,Ie),m(ne,me),k===5&&Ie!==2&&ne.write(r.from([le])),Ae!==null?Ae.write():Ie===4&&ne.write(r.from([0])),!0}function $(oe,ne,de){l("subscribe: packet: ");let k=de?de.protocolVersion:4,X=oe||{},ee=X.dup?t.DUP_MASK:0,me=X.messageId,be=X.subscriptions,te=X.properties,le=0;if(typeof me!="number")return ne.destroy(new Error("Invalid messageId")),!1;le+=2;let ge=null;if(k===5){if(ge=Z(ne,te),!ge)return!1;le+=ge.length}if(typeof be=="object"&&be.length)for(let Ae=0;Ae<be.length;Ae+=1){let Te=be[Ae].topic,ye=be[Ae].qos;if(typeof Te!="string")return ne.destroy(new Error("Invalid subscriptions - invalid topic")),!1;if(typeof ye!="number")return ne.destroy(new Error("Invalid subscriptions - invalid qos")),!1;if(k===5){if(typeof(be[Ae].nl||!1)!="boolean")return ne.destroy(new Error("Invalid subscriptions - invalid No Local")),!1;if(typeof(be[Ae].rap||!1)!="boolean")return ne.destroy(new Error("Invalid subscriptions - invalid Retain as Published")),!1;let Re=be[Ae].rh||0;if(typeof Re!="number"||Re>2)return ne.destroy(new Error("Invalid subscriptions - invalid Retain Handling")),!1}le+=r.byteLength(Te)+2+1}else return ne.destroy(new Error("Invalid subscriptions")),!1;l("subscribe: writing to stream: %o",t.SUBSCRIBE_HEADER),ne.write(t.SUBSCRIBE_HEADER[1][ee?1:0][0]),N(ne,le),m(ne,me),ge!==null&&ge.write();let Ie=!0;for(let Ae of be){let Te=Ae.topic,ye=Ae.qos,Re=+Ae.nl,Fe=+Ae.rap,Ce=Ae.rh,et;L(ne,Te),et=t.SUBSCRIBE_OPTIONS_QOS[ye],k===5&&(et|=Re?t.SUBSCRIBE_OPTIONS_NL:0,et|=Fe?t.SUBSCRIBE_OPTIONS_RAP:0,et|=Ce?t.SUBSCRIBE_OPTIONS_RH[Ce]:0),Ie=ne.write(r.from([et]))}return Ie}function U(oe,ne,de){let k=de?de.protocolVersion:4,X=oe||{},ee=X.messageId,me=X.granted,be=X.properties,te=0;if(typeof ee!="number")return ne.destroy(new Error("Invalid messageId")),!1;if(te+=2,typeof me=="object"&&me.length)for(let ge=0;ge<me.length;ge+=1){if(typeof me[ge]!="number")return ne.destroy(new Error("Invalid qos vector")),!1;te+=1}else return ne.destroy(new Error("Invalid qos vector")),!1;let le=null;if(k===5){if(le=F(ne,be,de,te),!le)return!1;te+=le.length}return ne.write(t.SUBACK_HEADER),N(ne,te),m(ne,ee),le!==null&&le.write(),ne.write(r.from(me))}function O(oe,ne,de){let k=de?de.protocolVersion:4,X=oe||{},ee=X.messageId,me=X.dup?t.DUP_MASK:0,be=X.unsubscriptions,te=X.properties,le=0;if(typeof ee!="number")return ne.destroy(new Error("Invalid messageId")),!1;if(le+=2,typeof be=="object"&&be.length)for(let Ae=0;Ae<be.length;Ae+=1){if(typeof be[Ae]!="string")return ne.destroy(new Error("Invalid unsubscriptions")),!1;le+=r.byteLength(be[Ae])+2}else return ne.destroy(new Error("Invalid unsubscriptions")),!1;let ge=null;if(k===5){if(ge=Z(ne,te),!ge)return!1;le+=ge.length}ne.write(t.UNSUBSCRIBE_HEADER[1][me?1:0][0]),N(ne,le),m(ne,ee),ge!==null&&ge.write();let Ie=!0;for(let Ae=0;Ae<be.length;Ae++)Ie=L(ne,be[Ae]);return Ie}function P(oe,ne,de){let k=de?de.protocolVersion:4,X=oe||{},ee=X.messageId,me=X.dup?t.DUP_MASK:0,be=X.granted,te=X.properties,le=X.cmd,ge=0,Ie=2;if(typeof ee!="number")return ne.destroy(new Error("Invalid messageId")),!1;if(k===5)if(typeof be=="object"&&be.length)for(let Te=0;Te<be.length;Te+=1){if(typeof be[Te]!="number")return ne.destroy(new Error("Invalid qos vector")),!1;Ie+=1}else return ne.destroy(new Error("Invalid qos vector")),!1;let Ae=null;if(k===5){if(Ae=F(ne,te,de,Ie),!Ae)return!1;Ie+=Ae.length}return ne.write(t.ACKS[le][ge][me][0]),N(ne,Ie),m(ne,ee),Ae!==null&&Ae.write(),k===5&&ne.write(r.from(be)),!0}function M(oe,ne,de){return ne.write(t.EMPTY[oe.cmd])}function K(oe,ne,de){let k=de?de.protocolVersion:4,X=oe||{},ee=X.reasonCode,me=X.properties,be=k===5?1:0,te=null;if(k===5){if(te=F(ne,me,de,be),!te)return!1;be+=te.length}return ne.write(r.from([t.codes.disconnect<<4])),N(ne,be),k===5&&ne.write(r.from([ee])),te!==null&&te.write(),!0}function C(oe,ne,de){let k=de?de.protocolVersion:4,X=oe||{},ee=X.reasonCode,me=X.properties,be=k===5?1:0;k!==5&&ne.destroy(new Error("Invalid mqtt version for auth packet"));let te=F(ne,me,de,be);return te?(be+=te.length,ne.write(r.from([t.codes.auth<<4])),N(ne,be),ne.write(r.from([ee])),te!==null&&te.write(),!0):!1}var B={};function N(oe,ne){if(ne>t.VARBYTEINT_MAX)return oe.destroy(new Error(`Invalid variable byte integer: ${ne}`)),!1;let de=B[ne];return de||(de=p(ne),ne<16384&&(B[ne]=de)),l("writeVarByteInt: writing to stream: %o",de),oe.write(de)}function L(oe,ne){let de=r.byteLength(ne);return m(oe,de),l("writeString: %s",ne),oe.write(ne,"utf8")}function V(oe,ne,de){L(oe,ne),L(oe,de)}function W(oe,ne){return l("writeNumberCached: number: %d",ne),l("writeNumberCached: %o",c[ne]),oe.write(c[ne])}function H(oe,ne){let de=h(ne);return l("writeNumberGenerated: %o",de),oe.write(de)}function G(oe,ne){let de=g(ne);return l("write4ByteNumber: %o",de),oe.write(de)}function z(oe,ne){typeof ne=="string"?L(oe,ne):ne?(m(oe,ne.length),oe.write(ne)):m(oe,0)}function Z(oe,ne){if(typeof ne!="object"||ne.length!=null)return{length:1,write(){fe(oe,{},0)}};let de=0;function k(X,ee){let me=t.propertiesTypes[X],be=0;switch(me){case"byte":{if(typeof ee!="boolean")return oe.destroy(new Error(`Invalid ${X}: ${ee}`)),!1;be+=2;break}case"int8":{if(typeof ee!="number"||ee<0||ee>255)return oe.destroy(new Error(`Invalid ${X}: ${ee}`)),!1;be+=2;break}case"binary":{if(ee&&ee===null)return oe.destroy(new Error(`Invalid ${X}: ${ee}`)),!1;be+=1+r.byteLength(ee)+2;break}case"int16":{if(typeof ee!="number"||ee<0||ee>65535)return oe.destroy(new Error(`Invalid ${X}: ${ee}`)),!1;be+=3;break}case"int32":{if(typeof ee!="number"||ee<0||ee>4294967295)return oe.destroy(new Error(`Invalid ${X}: ${ee}`)),!1;be+=5;break}case"var":{if(typeof ee!="number"||ee<0||ee>268435455)return oe.destroy(new Error(`Invalid ${X}: ${ee}`)),!1;be+=1+r.byteLength(p(ee));break}case"string":{if(typeof ee!="string")return oe.destroy(new Error(`Invalid ${X}: ${ee}`)),!1;be+=3+r.byteLength(ee.toString());break}case"pair":{if(typeof ee!="object")return oe.destroy(new Error(`Invalid ${X}: ${ee}`)),!1;be+=Object.getOwnPropertyNames(ee).reduce((te,le)=>{let ge=ee[le];return Array.isArray(ge)?te+=ge.reduce((Ie,Ae)=>(Ie+=3+r.byteLength(le.toString())+2+r.byteLength(Ae.toString()),Ie),0):te+=3+r.byteLength(le.toString())+2+r.byteLength(ee[le].toString()),te},0);break}default:return oe.destroy(new Error(`Invalid property ${X}: ${ee}`)),!1}return be}if(ne)for(let X in ne){let ee=0,me=0,be=ne[X];if(be!==void 0){if(Array.isArray(be))for(let te=0;te<be.length;te++){if(me=k(X,be[te]),!me)return!1;ee+=me}else{if(me=k(X,be),!me)return!1;ee=me}if(!ee)return!1;de+=ee}}return{length:r.byteLength(p(de))+de,write(){fe(oe,ne,de)}}}function F(oe,ne,de,k){let X=["reasonString","userProperties"],ee=de&&de.properties&&de.properties.maximumPacketSize?de.properties.maximumPacketSize:0,me=Z(oe,ne);if(ee)for(;k+me.length>ee;){let be=X.shift();if(be&&ne[be])delete ne[be],me=Z(oe,ne);else return!1}return me}function ie(oe,ne,de){switch(t.propertiesTypes[ne]){case"byte":{oe.write(r.from([t.properties[ne]])),oe.write(r.from([+de]));break}case"int8":{oe.write(r.from([t.properties[ne]])),oe.write(r.from([de]));break}case"binary":{oe.write(r.from([t.properties[ne]])),z(oe,de);break}case"int16":{oe.write(r.from([t.properties[ne]])),m(oe,de);break}case"int32":{oe.write(r.from([t.properties[ne]])),G(oe,de);break}case"var":{oe.write(r.from([t.properties[ne]])),N(oe,de);break}case"string":{oe.write(r.from([t.properties[ne]])),L(oe,de);break}case"pair":{Object.getOwnPropertyNames(de).forEach(k=>{let X=de[k];Array.isArray(X)?X.forEach(ee=>{oe.write(r.from([t.properties[ne]])),V(oe,k.toString(),ee.toString())}):(oe.write(r.from([t.properties[ne]])),V(oe,k.toString(),X.toString()))});break}default:return oe.destroy(new Error(`Invalid property ${ne} value: ${de}`)),!1}}function fe(oe,ne,de){N(oe,de);for(let k in ne)if(Object.prototype.hasOwnProperty.call(ne,k)&&ne[k]!=null){let X=ne[k];if(Array.isArray(X))for(let ee=0;ee<X.length;ee++)ie(oe,k,X[ee]);else ie(oe,k,X)}}function J(oe){return oe?oe instanceof r?oe.length:r.byteLength(oe):0}function _e(oe){return typeof oe=="string"||oe instanceof r}e.exports=y}),_j=$e((n,e)=>{Oe(),Ne(),Le();var t=JO(),{EventEmitter:r}=(Kl(),nr(Aa)),{Buffer:i}=(Jr(),nr(Qr));function s(a,l){let c=new o;return t(a,c,l),c.concat()}var o=class extends r{constructor(){super(),this._array=new Array(20),this._i=0}write(a){return this._array[this._i++]=a,!0}concat(){let a=0,l=new Array(this._array.length),c=this._array,h=0,d;for(d=0;d<c.length&&c[d]!==void 0;d++)typeof c[d]!="string"?l[d]=c[d].length:l[d]=i.byteLength(c[d]),a+=l[d];let p=i.allocUnsafe(a);for(d=0;d<c.length&&c[d]!==void 0;d++)typeof c[d]!="string"?(c[d].copy(p,h),h+=l[d]):(p.write(c[d],h),h+=l[d]);return p}destroy(a){a&&this.emit("error",a)}};e.exports=s}),Ej=$e(n=>{Oe(),Ne(),Le(),n.parser=bj().parser,n.generate=_j(),n.writeToStream=JO()}),Sj=$e((n,e)=>{Oe(),Ne(),Le(),e.exports=r;function t(s){return s instanceof Wg?Wg.from(s):new s.constructor(s.buffer.slice(),s.byteOffset,s.length)}function r(s){if(s=s||{},s.circles)return i(s);let o=new Map;if(o.set(Date,d=>new Date(d)),o.set(Map,(d,p)=>new Map(l(Array.from(d),p))),o.set(Set,(d,p)=>new Set(l(Array.from(d),p))),s.constructorHandlers)for(let d of s.constructorHandlers)o.set(d[0],d[1]);let a=null;return s.proto?h:c;function l(d,p){let g=Object.keys(d),m=new Array(g.length);for(let E=0;E<g.length;E++){let y=g[E],S=d[y];typeof S!="object"||S===null?m[y]=S:S.constructor!==Object&&(a=o.get(S.constructor))?m[y]=a(S,p):ArrayBuffer.isView(S)?m[y]=t(S):m[y]=p(S)}return m}function c(d){if(typeof d!="object"||d===null)return d;if(Array.isArray(d))return l(d,c);if(d.constructor!==Object&&(a=o.get(d.constructor)))return a(d,c);let p={};for(let g in d){if(Object.hasOwnProperty.call(d,g)===!1)continue;let m=d[g];typeof m!="object"||m===null?p[g]=m:m.constructor!==Object&&(a=o.get(m.constructor))?p[g]=a(m,c):ArrayBuffer.isView(m)?p[g]=t(m):p[g]=c(m)}return p}function h(d){if(typeof d!="object"||d===null)return d;if(Array.isArray(d))return l(d,h);if(d.constructor!==Object&&(a=o.get(d.constructor)))return a(d,h);let p={};for(let g in d){let m=d[g];typeof m!="object"||m===null?p[g]=m:m.constructor!==Object&&(a=o.get(m.constructor))?p[g]=a(m,h):ArrayBuffer.isView(m)?p[g]=t(m):p[g]=h(m)}return p}}function i(s){let o=[],a=[],l=new Map;if(l.set(Date,g=>new Date(g)),l.set(Map,(g,m)=>new Map(h(Array.from(g),m))),l.set(Set,(g,m)=>new Set(h(Array.from(g),m))),s.constructorHandlers)for(let g of s.constructorHandlers)l.set(g[0],g[1]);let c=null;return s.proto?p:d;function h(g,m){let E=Object.keys(g),y=new Array(E.length);for(let S=0;S<E.length;S++){let b=E[S],_=g[b];if(typeof _!="object"||_===null)y[b]=_;else if(_.constructor!==Object&&(c=l.get(_.constructor)))y[b]=c(_,m);else if(ArrayBuffer.isView(_))y[b]=t(_);else{let I=o.indexOf(_);I!==-1?y[b]=a[I]:y[b]=m(_)}}return y}function d(g){if(typeof g!="object"||g===null)return g;if(Array.isArray(g))return h(g,d);if(g.constructor!==Object&&(c=l.get(g.constructor)))return c(g,d);let m={};o.push(g),a.push(m);for(let E in g){if(Object.hasOwnProperty.call(g,E)===!1)continue;let y=g[E];if(typeof y!="object"||y===null)m[E]=y;else if(y.constructor!==Object&&(c=l.get(y.constructor)))m[E]=c(y,d);else if(ArrayBuffer.isView(y))m[E]=t(y);else{let S=o.indexOf(y);S!==-1?m[E]=a[S]:m[E]=d(y)}}return o.pop(),a.pop(),m}function p(g){if(typeof g!="object"||g===null)return g;if(Array.isArray(g))return h(g,p);if(g.constructor!==Object&&(c=l.get(g.constructor)))return c(g,p);let m={};o.push(g),a.push(m);for(let E in g){let y=g[E];if(typeof y!="object"||y===null)m[E]=y;else if(y.constructor!==Object&&(c=l.get(y.constructor)))m[E]=c(y,p);else if(ArrayBuffer.isView(y))m[E]=t(y);else{let S=o.indexOf(y);S!==-1?m[E]=a[S]:m[E]=p(y)}}return o.pop(),a.pop(),m}}}),Aj=$e((n,e)=>{Oe(),Ne(),Le(),e.exports=Sj()()}),xj=$e(n=>{Oe(),Ne(),Le(),Object.defineProperty(n,"__esModule",{value:!0}),n.validateTopic=e,n.validateTopics=t;function e(r){let i=r.split("/");for(let s=0;s<i.length;s++)if(i[s]!=="+"){if(i[s]==="#")return s===i.length-1;if(i[s].indexOf("+")!==-1||i[s].indexOf("#")!==-1)return!1}return!0}function t(r){if(r.length===0)return"empty_topic_list";for(let i=0;i<r.length;i++)if(!e(r[i]))return r[i];return null}}),e3=$e(n=>{Oe(),Ne(),Le(),Object.defineProperty(n,"__esModule",{value:!0});var e=Gl(),t={objectMode:!0},r={clean:!0},i=class{constructor(s){v(this,"options");v(this,"_inflights");this.options=s||{},this.options={...r,...s},this._inflights=new Map}put(s,o){return this._inflights.set(s.messageId,s),o&&o(),this}createStream(){let s=new e.Readable(t),o=[],a=!1,l=0;return this._inflights.forEach((c,h)=>{o.push(c)}),s._read=()=>{!a&&l<o.length?s.push(o[l++]):s.push(null)},s.destroy=c=>{if(!a)return a=!0,setTimeout(()=>{s.emit("close")},0),s},s}del(s,o){let a=this._inflights.get(s.messageId);return a?(this._inflights.delete(s.messageId),o(null,a)):o&&o(new Error("missing packet")),this}get(s,o){let a=this._inflights.get(s.messageId);return a?o(null,a):o&&o(new Error("missing packet")),this}close(s){this.options.clean&&(this._inflights=null),s&&s()}};n.default=i}),Ij=$e(n=>{Oe(),Ne(),Le(),Object.defineProperty(n,"__esModule",{value:!0});var e=[0,16,128,131,135,144,145,151,153],t=(r,i,s)=>{r.log("handlePublish: packet %o",i),s=typeof s<"u"?s:r.noop;let o=i.topic.toString(),a=i.payload,{qos:l}=i,{messageId:c}=i,{options:h}=r;if(r.options.protocolVersion===5){let d;if(i.properties&&(d=i.properties.topicAlias),typeof d<"u")if(o.length===0)if(d>0&&d<=65535){let p=r.topicAliasRecv.getTopicByAlias(d);if(p)o=p,r.log("handlePublish :: topic complemented by alias. topic: %s - alias: %d",o,d);else{r.log("handlePublish :: unregistered topic alias. alias: %d",d),r.emit("error",new Error("Received unregistered Topic Alias"));return}}else{r.log("handlePublish :: topic alias out of range. alias: %d",d),r.emit("error",new Error("Received Topic Alias is out of range"));return}else if(r.topicAliasRecv.put(o,d))r.log("handlePublish :: registered topic: %s - alias: %d",o,d);else{r.log("handlePublish :: topic alias out of range. alias: %d",d),r.emit("error",new Error("Received Topic Alias is out of range"));return}}switch(r.log("handlePublish: qos %d",l),l){case 2:{h.customHandleAcks(o,a,i,(d,p)=>{if(typeof d=="number"&&(p=d,d=null),d)return r.emit("error",d);if(e.indexOf(p)===-1)return r.emit("error",new Error("Wrong reason code for pubrec"));p?r._sendPacket({cmd:"pubrec",messageId:c,reasonCode:p},s):r.incomingStore.put(i,()=>{r._sendPacket({cmd:"pubrec",messageId:c},s)})});break}case 1:{h.customHandleAcks(o,a,i,(d,p)=>{if(typeof d=="number"&&(p=d,d=null),d)return r.emit("error",d);if(e.indexOf(p)===-1)return r.emit("error",new Error("Wrong reason code for puback"));p||r.emit("message",o,a,i),r.handleMessage(i,g=>{if(g)return s&&s(g);r._sendPacket({cmd:"puback",messageId:c,reasonCode:p},s)})});break}case 0:r.emit("message",o,a,i),r.handleMessage(i,s);break;default:r.log("handlePublish: unknown QoS. Doing nothing.");break}};n.default=t}),Tj=$e((n,e)=>{e.exports={version:"5.14.1"}}),Hu=$e(n=>{Oe(),Ne(),Le(),Object.defineProperty(n,"__esModule",{value:!0}),n.MQTTJS_VERSION=n.nextTick=n.ErrorWithSubackPacket=n.ErrorWithReasonCode=void 0,n.applyMixin=r;var e=class t3 extends Error{constructor(o,a){super(o);v(this,"code");this.code=a,Object.setPrototypeOf(this,t3.prototype),Object.getPrototypeOf(this).name="ErrorWithReasonCode"}};n.ErrorWithReasonCode=e;var t=class r3 extends Error{constructor(o,a){super(o);v(this,"packet");this.packet=a,Object.setPrototypeOf(this,r3.prototype),Object.getPrototypeOf(this).name="ErrorWithSubackPacket"}};n.ErrorWithSubackPacket=t;function r(i,s,o=!1){let a=[s];for(;;){let l=a[0],c=Object.getPrototypeOf(l);if(c!=null&&c.prototype)a.unshift(c);else break}for(let l of a)for(let c of Object.getOwnPropertyNames(l.prototype))(o||c!=="constructor")&&Object.defineProperty(i.prototype,c,Object.getOwnPropertyDescriptor(l.prototype,c)??Object.create(null))}n.nextTick=typeof(Ut==null?void 0:Ut.nextTick)=="function"?Ut.nextTick:i=>{setTimeout(i,0)},n.MQTTJS_VERSION=Tj().version}),Iy=$e(n=>{Oe(),Ne(),Le(),Object.defineProperty(n,"__esModule",{value:!0}),n.ReasonCodes=void 0;var e=Hu();n.ReasonCodes={0:"",1:"Unacceptable protocol version",2:"Identifier rejected",3:"Server unavailable",4:"Bad username or password",5:"Not authorized",16:"No matching subscribers",17:"No subscription existed",128:"Unspecified error",129:"Malformed Packet",130:"Protocol Error",131:"Implementation specific error",132:"Unsupported Protocol Version",133:"Client Identifier not valid",134:"Bad User Name or Password",135:"Not authorized",136:"Server unavailable",137:"Server busy",138:"Banned",139:"Server shutting down",140:"Bad authentication method",141:"Keep Alive timeout",142:"Session taken over",143:"Topic Filter invalid",144:"Topic Name invalid",145:"Packet identifier in use",146:"Packet Identifier not found",147:"Receive Maximum exceeded",148:"Topic Alias invalid",149:"Packet too large",150:"Message rate too high",151:"Quota exceeded",152:"Administrative action",153:"Payload format invalid",154:"Retain not supported",155:"QoS not supported",156:"Use another server",157:"Server moved",158:"Shared Subscriptions not supported",159:"Connection rate exceeded",160:"Maximum connect time",161:"Subscription Identifiers not supported",162:"Wildcard Subscriptions not supported"};var t=(r,i)=>{let{messageId:s}=i,o=i.cmd,a=null,l=r.outgoing[s]?r.outgoing[s].cb:null,c=null;if(!l){r.log("_handleAck :: Server sent an ack in error. Ignoring.");return}switch(r.log("_handleAck :: packet type",o),o){case"pubcomp":case"puback":{let h=i.reasonCode;h&&h>0&&h!==16?(c=new e.ErrorWithReasonCode(`Publish error: ${n.ReasonCodes[h]}`,h),r._removeOutgoingAndStoreMessage(s,()=>{l(c,i)})):r._removeOutgoingAndStoreMessage(s,l);break}case"pubrec":{a={cmd:"pubrel",qos:2,messageId:s};let h=i.reasonCode;h&&h>0&&h!==16?(c=new e.ErrorWithReasonCode(`Publish error: ${n.ReasonCodes[h]}`,h),r._removeOutgoingAndStoreMessage(s,()=>{l(c,i)})):r._sendPacket(a);break}case"suback":{delete r.outgoing[s],r.messageIdProvider.deallocate(s);let h=i.granted;for(let d=0;d<h.length;d++){let p=h[d];if(p&128){c=new Error(`Subscribe error: ${n.ReasonCodes[p]}`),c.code=p;let g=r.messageIdToTopic[s];g&&g.forEach(m=>{delete r._resubscribeTopics[m]})}}delete r.messageIdToTopic[s],r._invokeStoreProcessingQueue(),l(c,i);break}case"unsuback":{delete r.outgoing[s],r.messageIdProvider.deallocate(s),r._invokeStoreProcessingQueue(),l(null,i);break}default:r.emit("error",new Error("unrecognized packet type"))}r.disconnecting&&Object.keys(r.outgoing).length===0&&r.emit("outgoingEmpty")};n.default=t}),Cj=$e(n=>{Oe(),Ne(),Le(),Object.defineProperty(n,"__esModule",{value:!0});var e=Hu(),t=Iy(),r=(i,s)=>{let{options:o}=i,a=o.protocolVersion,l=a===5?s.reasonCode:s.returnCode;if(a!==5){let c=new e.ErrorWithReasonCode(`Protocol error: Auth packets are only supported in MQTT 5. Your version:${a}`,l);i.emit("error",c);return}i.handleAuth(s,(c,h)=>{if(c){i.emit("error",c);return}if(l===24)i.reconnecting=!1,i._sendPacket(h);else{let d=new e.ErrorWithReasonCode(`Connection refused: ${t.ReasonCodes[l]}`,l);i.emit("error",d)}})};n.default=r}),kj=$e(n=>{var g,m,E,y,S,b,_,I,x,$,U,O,P,M,K,C,B,N,L,V,W,H,G,z,Z,F,ie,fe,J,E_,oe,ne,de,k,n3,ee,me,be,Zo,Qo,S_,Qp,Jp,pr,A_,Ph,Jo,x_,et;Oe(),Ne(),Le(),Object.defineProperty(n,"__esModule",{value:!0}),n.LRUCache=void 0;var e=typeof performance=="object"&&performance&&typeof performance.now=="function"?performance:Date,t=new Set,r=typeof Ut=="object"&&Ut?Ut:{},i=(A,T,D,Y)=>{typeof r.emitWarning=="function"?r.emitWarning(A,T,D,Y):console.error(`[${D}] ${T}: ${A}`)},s=globalThis.AbortController,o=globalThis.AbortSignal;if(typeof s>"u"){o=class{constructor(){v(this,"onabort");v(this,"_onabort",[]);v(this,"reason");v(this,"aborted",!1)}addEventListener(D,Y){this._onabort.push(Y)}},s=class{constructor(){v(this,"signal",new o);T()}abort(D){var Y,ae;if(!this.signal.aborted){this.signal.reason=D,this.signal.aborted=!0;for(let pe of this.signal._onabort)pe(D);(ae=(Y=this.signal).onabort)==null||ae.call(Y,D)}}};let A=((g=r.env)==null?void 0:g.LRU_CACHE_IGNORE_AC_WARNING)!=="1",T=()=>{A&&(A=!1,i("AbortController is not defined. If using lru-cache in node 14, load an AbortController polyfill from the `node-abort-controller` package. A minimal polyfill is provided for use by LRUCache.fetch(), but it should not be relied upon in other contexts (eg, passing it to other APIs that use AbortController/AbortSignal might have undesirable effects). You may disable this with LRU_CACHE_IGNORE_AC_WARNING=1 in the env.","NO_ABORT_CONTROLLER","ENOTSUP",T))}}var a=A=>!t.has(A),l=A=>A&&A===Math.floor(A)&&A>0&&isFinite(A),c=A=>l(A)?A<=Math.pow(2,8)?Uint8Array:A<=Math.pow(2,16)?Uint16Array:A<=Math.pow(2,32)?Uint32Array:A<=Number.MAX_SAFE_INTEGER?h:null:null,h=class extends Array{constructor(A){super(A),this.fill(0)}},d=(m=class{constructor(T,D){v(this,"heap");v(this,"length");if(!q(m,E))throw new TypeError("instantiate Stack using Stack.create(n)");this.heap=new D(T),this.length=0}static create(T){let D=c(T);if(!D)return[];qe(m,E,!0);let Y=new m(T,D);return qe(m,E,!1),Y}push(T){this.heap[this.length++]=T}pop(){return this.heap[--this.length]}},E=new WeakMap,Qe(m,E,!1),m),p=(et=class{constructor(T){Qe(this,J);Qe(this,b);Qe(this,_);Qe(this,I);Qe(this,x);Qe(this,$);Qe(this,U);v(this,"ttl");v(this,"ttlResolution");v(this,"ttlAutopurge");v(this,"updateAgeOnGet");v(this,"updateAgeOnHas");v(this,"allowStale");v(this,"noDisposeOnSet");v(this,"noUpdateTTL");v(this,"maxEntrySize");v(this,"sizeCalculation");v(this,"noDeleteOnFetchRejection");v(this,"noDeleteOnStaleGet");v(this,"allowStaleOnFetchAbort");v(this,"allowStaleOnFetchRejection");v(this,"ignoreFetchAbort");Qe(this,O);Qe(this,P);Qe(this,M);Qe(this,K);Qe(this,C);Qe(this,B);Qe(this,N);Qe(this,L);Qe(this,V);Qe(this,W);Qe(this,H);Qe(this,G);Qe(this,z);Qe(this,Z);Qe(this,F);Qe(this,ie);Qe(this,fe);Qe(this,oe,()=>{});Qe(this,ne,()=>{});Qe(this,de,()=>{});Qe(this,k,()=>!1);Qe(this,ee,T=>{});Qe(this,me,(T,D,Y)=>{});Qe(this,be,(T,D,Y,ae)=>{if(Y||ae)throw new TypeError("cannot set size without setting maxSize or maxEntrySize on cache");return 0});v(this,y,"LRUCache");let{max:D=0,ttl:Y,ttlResolution:ae=1,ttlAutopurge:pe,updateAgeOnGet:Ee,updateAgeOnHas:ue,allowStale:we,dispose:He,disposeAfter:ze,noDisposeOnSet:Ke,noUpdateTTL:it,maxSize:Gt=0,maxEntrySize:er=0,sizeCalculation:yt,fetchMethod:Rt,memoMethod:nt,noDeleteOnFetchRejection:St,noDeleteOnStaleGet:Ot,allowStaleOnFetchRejection:Zt,allowStaleOnFetchAbort:ar,ignoreFetchAbort:Kr}=T;if(D!==0&&!l(D))throw new TypeError("max option must be a nonnegative integer");let se=D?c(D):Array;if(!se)throw new Error("invalid max value: "+D);if(qe(this,b,D),qe(this,_,Gt),this.maxEntrySize=er||q(this,_),this.sizeCalculation=yt,this.sizeCalculation){if(!q(this,_)&&!this.maxEntrySize)throw new TypeError("cannot set sizeCalculation without setting maxSize or maxEntrySize");if(typeof this.sizeCalculation!="function")throw new TypeError("sizeCalculation set to non-function")}if(nt!==void 0&&typeof nt!="function")throw new TypeError("memoMethod must be a function if defined");if(qe(this,U,nt),Rt!==void 0&&typeof Rt!="function")throw new TypeError("fetchMethod must be a function if specified");if(qe(this,$,Rt),qe(this,ie,!!Rt),qe(this,M,new Map),qe(this,K,new Array(D).fill(void 0)),qe(this,C,new Array(D).fill(void 0)),qe(this,B,new se(D)),qe(this,N,new se(D)),qe(this,L,0),qe(this,V,0),qe(this,W,d.create(D)),qe(this,O,0),qe(this,P,0),typeof He=="function"&&qe(this,I,He),typeof ze=="function"?(qe(this,x,ze),qe(this,H,[])):(qe(this,x,void 0),qe(this,H,void 0)),qe(this,F,!!q(this,I)),qe(this,fe,!!q(this,x)),this.noDisposeOnSet=!!Ke,this.noUpdateTTL=!!it,this.noDeleteOnFetchRejection=!!St,this.allowStaleOnFetchRejection=!!Zt,this.allowStaleOnFetchAbort=!!ar,this.ignoreFetchAbort=!!Kr,this.maxEntrySize!==0){if(q(this,_)!==0&&!l(q(this,_)))throw new TypeError("maxSize must be a positive integer if specified");if(!l(this.maxEntrySize))throw new TypeError("maxEntrySize must be a positive integer if specified");Pe(this,J,n3).call(this)}if(this.allowStale=!!we,this.noDeleteOnStaleGet=!!Ot,this.updateAgeOnGet=!!Ee,this.updateAgeOnHas=!!ue,this.ttlResolution=l(ae)||ae===0?ae:1,this.ttlAutopurge=!!pe,this.ttl=Y||0,this.ttl){if(!l(this.ttl))throw new TypeError("ttl must be a positive integer if specified");Pe(this,J,E_).call(this)}if(q(this,b)===0&&this.ttl===0&&q(this,_)===0)throw new TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!q(this,b)&&!q(this,_)){let ce="LRU_CACHE_UNBOUNDED";a(ce)&&(t.add(ce),i("TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.","UnboundedCacheWarning",ce,et))}}static unsafeExposeInternals(T){return{starts:q(T,z),ttls:q(T,Z),sizes:q(T,G),keyMap:q(T,M),keyList:q(T,K),valList:q(T,C),next:q(T,B),prev:q(T,N),get head(){return q(T,L)},get tail(){return q(T,V)},free:q(T,W),isBackgroundFetch:D=>{var Y;return Pe(Y=T,J,pr).call(Y,D)},backgroundFetch:(D,Y,ae,pe)=>{var Ee;return Pe(Ee=T,J,Jp).call(Ee,D,Y,ae,pe)},moveToTail:D=>{var Y;return Pe(Y=T,J,Ph).call(Y,D)},indexes:D=>{var Y;return Pe(Y=T,J,Zo).call(Y,D)},rindexes:D=>{var Y;return Pe(Y=T,J,Qo).call(Y,D)},isStale:D=>{var Y;return q(Y=T,k).call(Y,D)}}}get max(){return q(this,b)}get maxSize(){return q(this,_)}get calculatedSize(){return q(this,P)}get size(){return q(this,O)}get fetchMethod(){return q(this,$)}get memoMethod(){return q(this,U)}get dispose(){return q(this,I)}get disposeAfter(){return q(this,x)}getRemainingTTL(T){return q(this,M).has(T)?1/0:0}*entries(){for(let T of Pe(this,J,Zo).call(this))q(this,C)[T]!==void 0&&q(this,K)[T]!==void 0&&!Pe(this,J,pr).call(this,q(this,C)[T])&&(yield[q(this,K)[T],q(this,C)[T]])}*rentries(){for(let T of Pe(this,J,Qo).call(this))q(this,C)[T]!==void 0&&q(this,K)[T]!==void 0&&!Pe(this,J,pr).call(this,q(this,C)[T])&&(yield[q(this,K)[T],q(this,C)[T]])}*keys(){for(let T of Pe(this,J,Zo).call(this)){let D=q(this,K)[T];D!==void 0&&!Pe(this,J,pr).call(this,q(this,C)[T])&&(yield D)}}*rkeys(){for(let T of Pe(this,J,Qo).call(this)){let D=q(this,K)[T];D!==void 0&&!Pe(this,J,pr).call(this,q(this,C)[T])&&(yield D)}}*values(){for(let T of Pe(this,J,Zo).call(this))q(this,C)[T]!==void 0&&!Pe(this,J,pr).call(this,q(this,C)[T])&&(yield q(this,C)[T])}*rvalues(){for(let T of Pe(this,J,Qo).call(this))q(this,C)[T]!==void 0&&!Pe(this,J,pr).call(this,q(this,C)[T])&&(yield q(this,C)[T])}[(S=Symbol.iterator,y=Symbol.toStringTag,S)](){return this.entries()}find(T,D={}){for(let Y of Pe(this,J,Zo).call(this)){let ae=q(this,C)[Y],pe=Pe(this,J,pr).call(this,ae)?ae.__staleWhileFetching:ae;if(pe!==void 0&&T(pe,q(this,K)[Y],this))return this.get(q(this,K)[Y],D)}}forEach(T,D=this){for(let Y of Pe(this,J,Zo).call(this)){let ae=q(this,C)[Y],pe=Pe(this,J,pr).call(this,ae)?ae.__staleWhileFetching:ae;pe!==void 0&&T.call(D,pe,q(this,K)[Y],this)}}rforEach(T,D=this){for(let Y of Pe(this,J,Qo).call(this)){let ae=q(this,C)[Y],pe=Pe(this,J,pr).call(this,ae)?ae.__staleWhileFetching:ae;pe!==void 0&&T.call(D,pe,q(this,K)[Y],this)}}purgeStale(){let T=!1;for(let D of Pe(this,J,Qo).call(this,{allowStale:!0}))q(this,k).call(this,D)&&(Pe(this,J,Jo).call(this,q(this,K)[D],"expire"),T=!0);return T}info(T){let D=q(this,M).get(T);if(D===void 0)return;let Y=q(this,C)[D],ae=Pe(this,J,pr).call(this,Y)?Y.__staleWhileFetching:Y;if(ae===void 0)return;let pe={value:ae};if(q(this,Z)&&q(this,z)){let Ee=q(this,Z)[D],ue=q(this,z)[D];if(Ee&&ue){let we=Ee-(e.now()-ue);pe.ttl=we,pe.start=Date.now()}}return q(this,G)&&(pe.size=q(this,G)[D]),pe}dump(){let T=[];for(let D of Pe(this,J,Zo).call(this,{allowStale:!0})){let Y=q(this,K)[D],ae=q(this,C)[D],pe=Pe(this,J,pr).call(this,ae)?ae.__staleWhileFetching:ae;if(pe===void 0||Y===void 0)continue;let Ee={value:pe};if(q(this,Z)&&q(this,z)){Ee.ttl=q(this,Z)[D];let ue=e.now()-q(this,z)[D];Ee.start=Math.floor(Date.now()-ue)}q(this,G)&&(Ee.size=q(this,G)[D]),T.unshift([Y,Ee])}return T}load(T){this.clear();for(let[D,Y]of T){if(Y.start){let ae=Date.now()-Y.start;Y.start=e.now()-ae}this.set(D,Y.value,Y)}}set(T,D,Y={}){var it,Gt,er,yt,Rt;if(D===void 0)return this.delete(T),this;let{ttl:ae=this.ttl,start:pe,noDisposeOnSet:Ee=this.noDisposeOnSet,sizeCalculation:ue=this.sizeCalculation,status:we}=Y,{noUpdateTTL:He=this.noUpdateTTL}=Y,ze=q(this,be).call(this,T,D,Y.size||0,ue);if(this.maxEntrySize&&ze>this.maxEntrySize)return we&&(we.set="miss",we.maxEntrySizeExceeded=!0),Pe(this,J,Jo).call(this,T,"set"),this;let Ke=q(this,O)===0?void 0:q(this,M).get(T);if(Ke===void 0)Ke=q(this,O)===0?q(this,V):q(this,W).length!==0?q(this,W).pop():q(this,O)===q(this,b)?Pe(this,J,Qp).call(this,!1):q(this,O),q(this,K)[Ke]=T,q(this,C)[Ke]=D,q(this,M).set(T,Ke),q(this,B)[q(this,V)]=Ke,q(this,N)[Ke]=q(this,V),qe(this,V,Ke),Gi(this,O)._++,q(this,me).call(this,Ke,ze,we),we&&(we.set="add"),He=!1;else{Pe(this,J,Ph).call(this,Ke);let nt=q(this,C)[Ke];if(D!==nt){if(q(this,ie)&&Pe(this,J,pr).call(this,nt)){nt.__abortController.abort(new Error("replaced"));let{__staleWhileFetching:St}=nt;St!==void 0&&!Ee&&(q(this,F)&&((it=q(this,I))==null||it.call(this,St,T,"set")),q(this,fe)&&((Gt=q(this,H))==null||Gt.push([St,T,"set"])))}else Ee||(q(this,F)&&((er=q(this,I))==null||er.call(this,nt,T,"set")),q(this,fe)&&((yt=q(this,H))==null||yt.push([nt,T,"set"])));if(q(this,ee).call(this,Ke),q(this,me).call(this,Ke,ze,we),q(this,C)[Ke]=D,we){we.set="replace";let St=nt&&Pe(this,J,pr).call(this,nt)?nt.__staleWhileFetching:nt;St!==void 0&&(we.oldValue=St)}}else we&&(we.set="update")}if(ae!==0&&!q(this,Z)&&Pe(this,J,E_).call(this),q(this,Z)&&(He||q(this,de).call(this,Ke,ae,pe),we&&q(this,ne).call(this,we,Ke)),!Ee&&q(this,fe)&&q(this,H)){let nt=q(this,H),St;for(;St=nt==null?void 0:nt.shift();)(Rt=q(this,x))==null||Rt.call(this,...St)}return this}pop(){var T;try{for(;q(this,O);){let D=q(this,C)[q(this,L)];if(Pe(this,J,Qp).call(this,!0),Pe(this,J,pr).call(this,D)){if(D.__staleWhileFetching)return D.__staleWhileFetching}else if(D!==void 0)return D}}finally{if(q(this,fe)&&q(this,H)){let D=q(this,H),Y;for(;Y=D==null?void 0:D.shift();)(T=q(this,x))==null||T.call(this,...Y)}}}has(T,D={}){let{updateAgeOnHas:Y=this.updateAgeOnHas,status:ae}=D,pe=q(this,M).get(T);if(pe!==void 0){let Ee=q(this,C)[pe];if(Pe(this,J,pr).call(this,Ee)&&Ee.__staleWhileFetching===void 0)return!1;if(q(this,k).call(this,pe))ae&&(ae.has="stale",q(this,ne).call(this,ae,pe));else return Y&&q(this,oe).call(this,pe),ae&&(ae.has="hit",q(this,ne).call(this,ae,pe)),!0}else ae&&(ae.has="miss");return!1}peek(T,D={}){let{allowStale:Y=this.allowStale}=D,ae=q(this,M).get(T);if(ae===void 0||!Y&&q(this,k).call(this,ae))return;let pe=q(this,C)[ae];return Pe(this,J,pr).call(this,pe)?pe.__staleWhileFetching:pe}async fetch(T,D={}){let{allowStale:Y=this.allowStale,updateAgeOnGet:ae=this.updateAgeOnGet,noDeleteOnStaleGet:pe=this.noDeleteOnStaleGet,ttl:Ee=this.ttl,noDisposeOnSet:ue=this.noDisposeOnSet,size:we=0,sizeCalculation:He=this.sizeCalculation,noUpdateTTL:ze=this.noUpdateTTL,noDeleteOnFetchRejection:Ke=this.noDeleteOnFetchRejection,allowStaleOnFetchRejection:it=this.allowStaleOnFetchRejection,ignoreFetchAbort:Gt=this.ignoreFetchAbort,allowStaleOnFetchAbort:er=this.allowStaleOnFetchAbort,context:yt,forceRefresh:Rt=!1,status:nt,signal:St}=D;if(!q(this,ie))return nt&&(nt.fetch="get"),this.get(T,{allowStale:Y,updateAgeOnGet:ae,noDeleteOnStaleGet:pe,status:nt});let Ot={allowStale:Y,updateAgeOnGet:ae,noDeleteOnStaleGet:pe,ttl:Ee,noDisposeOnSet:ue,size:we,sizeCalculation:He,noUpdateTTL:ze,noDeleteOnFetchRejection:Ke,allowStaleOnFetchRejection:it,allowStaleOnFetchAbort:er,ignoreFetchAbort:Gt,status:nt,signal:St},Zt=q(this,M).get(T);if(Zt===void 0){nt&&(nt.fetch="miss");let ar=Pe(this,J,Jp).call(this,T,Zt,Ot,yt);return ar.__returned=ar}else{let ar=q(this,C)[Zt];if(Pe(this,J,pr).call(this,ar)){let Ue=Y&&ar.__staleWhileFetching!==void 0;return nt&&(nt.fetch="inflight",Ue&&(nt.returnedStale=!0)),Ue?ar.__staleWhileFetching:ar.__returned=ar}let Kr=q(this,k).call(this,Zt);if(!Rt&&!Kr)return nt&&(nt.fetch="hit"),Pe(this,J,Ph).call(this,Zt),ae&&q(this,oe).call(this,Zt),nt&&q(this,ne).call(this,nt,Zt),ar;let se=Pe(this,J,Jp).call(this,T,Zt,Ot,yt),ce=se.__staleWhileFetching!==void 0&&Y;return nt&&(nt.fetch=Kr?"stale":"refresh",ce&&Kr&&(nt.returnedStale=!0)),ce?se.__staleWhileFetching:se.__returned=se}}async forceFetch(T,D={}){let Y=await this.fetch(T,D);if(Y===void 0)throw new Error("fetch() returned undefined");return Y}memo(T,D={}){let Y=q(this,U);if(!Y)throw new Error("no memoMethod provided to constructor");let{context:ae,forceRefresh:pe,...Ee}=D,ue=this.get(T,Ee);if(!pe&&ue!==void 0)return ue;let we=Y(T,ue,{options:Ee,context:ae});return this.set(T,we,Ee),we}get(T,D={}){let{allowStale:Y=this.allowStale,updateAgeOnGet:ae=this.updateAgeOnGet,noDeleteOnStaleGet:pe=this.noDeleteOnStaleGet,status:Ee}=D,ue=q(this,M).get(T);if(ue!==void 0){let we=q(this,C)[ue],He=Pe(this,J,pr).call(this,we);return Ee&&q(this,ne).call(this,Ee,ue),q(this,k).call(this,ue)?(Ee&&(Ee.get="stale"),He?(Ee&&Y&&we.__staleWhileFetching!==void 0&&(Ee.returnedStale=!0),Y?we.__staleWhileFetching:void 0):(pe||Pe(this,J,Jo).call(this,T,"expire"),Ee&&Y&&(Ee.returnedStale=!0),Y?we:void 0)):(Ee&&(Ee.get="hit"),He?we.__staleWhileFetching:(Pe(this,J,Ph).call(this,ue),ae&&q(this,oe).call(this,ue),we))}else Ee&&(Ee.get="miss")}delete(T){return Pe(this,J,Jo).call(this,T,"delete")}clear(){return Pe(this,J,x_).call(this,"delete")}},b=new WeakMap,_=new WeakMap,I=new WeakMap,x=new WeakMap,$=new WeakMap,U=new WeakMap,O=new WeakMap,P=new WeakMap,M=new WeakMap,K=new WeakMap,C=new WeakMap,B=new WeakMap,N=new WeakMap,L=new WeakMap,V=new WeakMap,W=new WeakMap,H=new WeakMap,G=new WeakMap,z=new WeakMap,Z=new WeakMap,F=new WeakMap,ie=new WeakMap,fe=new WeakMap,J=new WeakSet,E_=function(){let T=new h(q(this,b)),D=new h(q(this,b));qe(this,Z,T),qe(this,z,D),qe(this,de,(pe,Ee,ue=e.now())=>{if(D[pe]=Ee!==0?ue:0,T[pe]=Ee,Ee!==0&&this.ttlAutopurge){let we=setTimeout(()=>{q(this,k).call(this,pe)&&Pe(this,J,Jo).call(this,q(this,K)[pe],"expire")},Ee+1);we.unref&&we.unref()}}),qe(this,oe,pe=>{D[pe]=T[pe]!==0?e.now():0}),qe(this,ne,(pe,Ee)=>{if(T[Ee]){let ue=T[Ee],we=D[Ee];if(!ue||!we)return;pe.ttl=ue,pe.start=we,pe.now=Y||ae();let He=pe.now-we;pe.remainingTTL=ue-He}});let Y=0,ae=()=>{let pe=e.now();if(this.ttlResolution>0){Y=pe;let Ee=setTimeout(()=>Y=0,this.ttlResolution);Ee.unref&&Ee.unref()}return pe};this.getRemainingTTL=pe=>{let Ee=q(this,M).get(pe);if(Ee===void 0)return 0;let ue=T[Ee],we=D[Ee];if(!ue||!we)return 1/0;let He=(Y||ae())-we;return ue-He},qe(this,k,pe=>{let Ee=D[pe],ue=T[pe];return!!ue&&!!Ee&&(Y||ae())-Ee>ue})},oe=new WeakMap,ne=new WeakMap,de=new WeakMap,k=new WeakMap,n3=function(){let T=new h(q(this,b));qe(this,P,0),qe(this,G,T),qe(this,ee,D=>{qe(this,P,q(this,P)-T[D]),T[D]=0}),qe(this,be,(D,Y,ae,pe)=>{if(Pe(this,J,pr).call(this,Y))return 0;if(!l(ae))if(pe){if(typeof pe!="function")throw new TypeError("sizeCalculation must be a function");if(ae=pe(Y,D),!l(ae))throw new TypeError("sizeCalculation return invalid (expect positive integer)")}else throw new TypeError("invalid size value (must be positive integer). When maxSize or maxEntrySize is used, sizeCalculation or size must be set.");return ae}),qe(this,me,(D,Y,ae)=>{if(T[D]=Y,q(this,_)){let pe=q(this,_)-T[D];for(;q(this,P)>pe;)Pe(this,J,Qp).call(this,!0)}qe(this,P,q(this,P)+T[D]),ae&&(ae.entrySize=Y,ae.totalCalculatedSize=q(this,P))})},ee=new WeakMap,me=new WeakMap,be=new WeakMap,Zo=function*({allowStale:T=this.allowStale}={}){if(q(this,O))for(let D=q(this,V);!(!Pe(this,J,S_).call(this,D)||((T||!q(this,k).call(this,D))&&(yield D),D===q(this,L)));)D=q(this,N)[D]},Qo=function*({allowStale:T=this.allowStale}={}){if(q(this,O))for(let D=q(this,L);!(!Pe(this,J,S_).call(this,D)||((T||!q(this,k).call(this,D))&&(yield D),D===q(this,V)));)D=q(this,B)[D]},S_=function(T){return T!==void 0&&q(this,M).get(q(this,K)[T])===T},Qp=function(T){var pe,Ee;let D=q(this,L),Y=q(this,K)[D],ae=q(this,C)[D];return q(this,ie)&&Pe(this,J,pr).call(this,ae)?ae.__abortController.abort(new Error("evicted")):(q(this,F)||q(this,fe))&&(q(this,F)&&((pe=q(this,I))==null||pe.call(this,ae,Y,"evict")),q(this,fe)&&((Ee=q(this,H))==null||Ee.push([ae,Y,"evict"]))),q(this,ee).call(this,D),T&&(q(this,K)[D]=void 0,q(this,C)[D]=void 0,q(this,W).push(D)),q(this,O)===1?(qe(this,L,qe(this,V,0)),q(this,W).length=0):qe(this,L,q(this,B)[D]),q(this,M).delete(Y),Gi(this,O)._--,D},Jp=function(T,D,Y,ae){let pe=D===void 0?void 0:q(this,C)[D];if(Pe(this,J,pr).call(this,pe))return pe;let Ee=new s,{signal:ue}=Y;ue==null||ue.addEventListener("abort",()=>Ee.abort(ue.reason),{signal:Ee.signal});let we={signal:Ee.signal,options:Y,context:ae},He=(yt,Rt=!1)=>{let{aborted:nt}=Ee.signal,St=Y.ignoreFetchAbort&&yt!==void 0;if(Y.status&&(nt&&!Rt?(Y.status.fetchAborted=!0,Y.status.fetchError=Ee.signal.reason,St&&(Y.status.fetchAbortIgnored=!0)):Y.status.fetchResolved=!0),nt&&!St&&!Rt)return Ke(Ee.signal.reason);let Ot=Gt;return q(this,C)[D]===Gt&&(yt===void 0?Ot.__staleWhileFetching?q(this,C)[D]=Ot.__staleWhileFetching:Pe(this,J,Jo).call(this,T,"fetch"):(Y.status&&(Y.status.fetchUpdated=!0),this.set(T,yt,we.options))),yt},ze=yt=>(Y.status&&(Y.status.fetchRejected=!0,Y.status.fetchError=yt),Ke(yt)),Ke=yt=>{let{aborted:Rt}=Ee.signal,nt=Rt&&Y.allowStaleOnFetchAbort,St=nt||Y.allowStaleOnFetchRejection,Ot=St||Y.noDeleteOnFetchRejection,Zt=Gt;if(q(this,C)[D]===Gt&&(!Ot||Zt.__staleWhileFetching===void 0?Pe(this,J,Jo).call(this,T,"fetch"):nt||(q(this,C)[D]=Zt.__staleWhileFetching)),St)return Y.status&&Zt.__staleWhileFetching!==void 0&&(Y.status.returnedStale=!0),Zt.__staleWhileFetching;if(Zt.__returned===Zt)throw yt},it=(yt,Rt)=>{var St;let nt=(St=q(this,$))==null?void 0:St.call(this,T,pe,we);nt&&nt instanceof Promise&&nt.then(Ot=>yt(Ot===void 0?void 0:Ot),Rt),Ee.signal.addEventListener("abort",()=>{(!Y.ignoreFetchAbort||Y.allowStaleOnFetchAbort)&&(yt(void 0),Y.allowStaleOnFetchAbort&&(yt=Ot=>He(Ot,!0)))})};Y.status&&(Y.status.fetchDispatched=!0);let Gt=new Promise(it).then(He,ze),er=Object.assign(Gt,{__abortController:Ee,__staleWhileFetching:pe,__returned:void 0});return D===void 0?(this.set(T,er,{...we.options,status:void 0}),D=q(this,M).get(T)):q(this,C)[D]=er,er},pr=function(T){if(!q(this,ie))return!1;let D=T;return!!D&&D instanceof Promise&&D.hasOwnProperty("__staleWhileFetching")&&D.__abortController instanceof s},A_=function(T,D){q(this,N)[D]=T,q(this,B)[T]=D},Ph=function(T){T!==q(this,V)&&(T===q(this,L)?qe(this,L,q(this,B)[T]):Pe(this,J,A_).call(this,q(this,N)[T],q(this,B)[T]),Pe(this,J,A_).call(this,q(this,V),T),qe(this,V,T))},Jo=function(T,D){var ae,pe,Ee,ue;let Y=!1;if(q(this,O)!==0){let we=q(this,M).get(T);if(we!==void 0)if(Y=!0,q(this,O)===1)Pe(this,J,x_).call(this,D);else{q(this,ee).call(this,we);let He=q(this,C)[we];if(Pe(this,J,pr).call(this,He)?He.__abortController.abort(new Error("deleted")):(q(this,F)||q(this,fe))&&(q(this,F)&&((ae=q(this,I))==null||ae.call(this,He,T,D)),q(this,fe)&&((pe=q(this,H))==null||pe.push([He,T,D]))),q(this,M).delete(T),q(this,K)[we]=void 0,q(this,C)[we]=void 0,we===q(this,V))qe(this,V,q(this,N)[we]);else if(we===q(this,L))qe(this,L,q(this,B)[we]);else{let ze=q(this,N)[we];q(this,B)[ze]=q(this,B)[we];let Ke=q(this,B)[we];q(this,N)[Ke]=q(this,N)[we]}Gi(this,O)._--,q(this,W).push(we)}}if(q(this,fe)&&((Ee=q(this,H))!=null&&Ee.length)){let we=q(this,H),He;for(;He=we==null?void 0:we.shift();)(ue=q(this,x))==null||ue.call(this,...He)}return Y},x_=function(T){var D,Y,ae;for(let pe of Pe(this,J,Qo).call(this,{allowStale:!0})){let Ee=q(this,C)[pe];if(Pe(this,J,pr).call(this,Ee))Ee.__abortController.abort(new Error("deleted"));else{let ue=q(this,K)[pe];q(this,F)&&((D=q(this,I))==null||D.call(this,Ee,ue,T)),q(this,fe)&&((Y=q(this,H))==null||Y.push([Ee,ue,T]))}}if(q(this,M).clear(),q(this,C).fill(void 0),q(this,K).fill(void 0),q(this,Z)&&q(this,z)&&(q(this,Z).fill(0),q(this,z).fill(0)),q(this,G)&&q(this,G).fill(0),qe(this,L,0),qe(this,V,0),q(this,W).length=0,qe(this,P,0),qe(this,O,0),q(this,fe)&&q(this,H)){let pe=q(this,H),Ee;for(;Ee=pe==null?void 0:pe.shift();)(ae=q(this,x))==null||ae.call(this,...Ee)}},et);n.LRUCache=p}),Eo=$e(n=>{Oe(),Ne(),Le(),Object.defineProperty(n,"t",{value:!0}),n.ContainerIterator=n.Container=n.Base=void 0;var e=class{constructor(i=0){this.iteratorType=i}equals(i){return this.o===i.o}};n.ContainerIterator=e;var t=class{constructor(){this.i=0}get length(){return this.i}size(){return this.i}empty(){return this.i===0}};n.Base=t;var r=class extends t{};n.Container=r}),Pj=$e(n=>{Oe(),Ne(),Le(),Object.defineProperty(n,"t",{value:!0}),n.default=void 0;var e=Eo(),t=class extends e.Base{constructor(i=[]){super(),this.S=[];let s=this;i.forEach(function(o){s.push(o)})}clear(){this.i=0,this.S=[]}push(i){return this.S.push(i),this.i+=1,this.i}pop(){if(this.i!==0)return this.i-=1,this.S.pop()}top(){return this.S[this.i-1]}},r=t;n.default=r}),Rj=$e(n=>{Oe(),Ne(),Le(),Object.defineProperty(n,"t",{value:!0}),n.default=void 0;var e=Eo(),t=class extends e.Base{constructor(i=[]){super(),this.j=0,this.q=[];let s=this;i.forEach(function(o){s.push(o)})}clear(){this.q=[],this.i=this.j=0}push(i){let s=this.q.length;if(this.j/s>.5&&this.j+this.i>=s&&s>4096){let o=this.i;for(let a=0;a<o;++a)this.q[a]=this.q[this.j+a];this.j=0,this.q[this.i]=i}else this.q[this.j+this.i]=i;return++this.i}pop(){if(this.i===0)return;let i=this.q[this.j++];return this.i-=1,i}front(){if(this.i!==0)return this.q[this.j]}},r=t;n.default=r}),Oj=$e(n=>{Oe(),Ne(),Le(),Object.defineProperty(n,"t",{value:!0}),n.default=void 0;var e=Eo(),t=class extends e.Base{constructor(i=[],s=function(a,l){return a>l?-1:a<l?1:0},o=!0){if(super(),this.v=s,Array.isArray(i))this.C=o?[...i]:i;else{this.C=[];let l=this;i.forEach(function(c){l.C.push(c)})}this.i=this.C.length;let a=this.i>>1;for(let l=this.i-1>>1;l>=0;--l)this.k(l,a)}m(i){let s=this.C[i];for(;i>0;){let o=i-1>>1,a=this.C[o];if(this.v(a,s)<=0)break;this.C[i]=a,i=o}this.C[i]=s}k(i,s){let o=this.C[i];for(;i<s;){let a=i<<1|1,l=a+1,c=this.C[a];if(l<this.i&&this.v(c,this.C[l])>0&&(a=l,c=this.C[l]),this.v(c,o)>=0)break;this.C[i]=c,i=a}this.C[i]=o}clear(){this.i=0,this.C.length=0}push(i){this.C.push(i),this.m(this.i),this.i+=1}pop(){if(this.i===0)return;let i=this.C[0],s=this.C.pop();return this.i-=1,this.i&&(this.C[0]=s,this.k(0,this.i>>1)),i}top(){return this.C[0]}find(i){return this.C.indexOf(i)>=0}remove(i){let s=this.C.indexOf(i);return s<0?!1:(s===0?this.pop():s===this.i-1?(this.C.pop(),this.i-=1):(this.C.splice(s,1,this.C.pop()),this.i-=1,this.m(s),this.k(s,this.i>>1)),!0)}updateItem(i){let s=this.C.indexOf(i);return s<0?!1:(this.m(s),this.k(s,this.i>>1),!0)}toArray(){return[...this.C]}},r=t;n.default=r}),YE=$e(n=>{Oe(),Ne(),Le(),Object.defineProperty(n,"t",{value:!0}),n.default=void 0;var e=Eo(),t=class extends e.Container{},r=t;n.default=r}),So=$e(n=>{Oe(),Ne(),Le(),Object.defineProperty(n,"t",{value:!0}),n.throwIteratorAccessError=e;function e(){throw new RangeError("Iterator access denied!")}}),i3=$e(n=>{Oe(),Ne(),Le(),Object.defineProperty(n,"t",{value:!0}),n.RandomIterator=void 0;var e=Eo(),t=So(),r=class extends e.ContainerIterator{constructor(i,s){super(s),this.o=i,this.iteratorType===0?(this.pre=function(){return this.o===0&&(0,t.throwIteratorAccessError)(),this.o-=1,this},this.next=function(){return this.o===this.container.size()&&(0,t.throwIteratorAccessError)(),this.o+=1,this}):(this.pre=function(){return this.o===this.container.size()-1&&(0,t.throwIteratorAccessError)(),this.o+=1,this},this.next=function(){return this.o===-1&&(0,t.throwIteratorAccessError)(),this.o-=1,this})}get pointer(){return this.container.getElementByPos(this.o)}set pointer(i){this.container.setElementByPos(this.o,i)}};n.RandomIterator=r}),Lj=$e(n=>{Oe(),Ne(),Le(),Object.defineProperty(n,"t",{value:!0}),n.default=void 0;var e=r(YE()),t=i3();function r(a){return a&&a.t?a:{default:a}}var i=class s3 extends t.RandomIterator{constructor(l,c,h){super(l,h),this.container=c}copy(){return new s3(this.o,this.container,this.iteratorType)}},s=class extends e.default{constructor(a=[],l=!0){if(super(),Array.isArray(a))this.J=l?[...a]:a,this.i=a.length;else{this.J=[];let c=this;a.forEach(function(h){c.pushBack(h)})}}clear(){this.i=0,this.J.length=0}begin(){return new i(0,this)}end(){return new i(this.i,this)}rBegin(){return new i(this.i-1,this,1)}rEnd(){return new i(-1,this,1)}front(){return this.J[0]}back(){return this.J[this.i-1]}getElementByPos(a){if(a<0||a>this.i-1)throw new RangeError;return this.J[a]}eraseElementByPos(a){if(a<0||a>this.i-1)throw new RangeError;return this.J.splice(a,1),this.i-=1,this.i}eraseElementByValue(a){let l=0;for(let c=0;c<this.i;++c)this.J[c]!==a&&(this.J[l++]=this.J[c]);return this.i=this.J.length=l,this.i}eraseElementByIterator(a){let l=a.o;return a=a.next(),this.eraseElementByPos(l),a}pushBack(a){return this.J.push(a),this.i+=1,this.i}popBack(){if(this.i!==0)return this.i-=1,this.J.pop()}setElementByPos(a,l){if(a<0||a>this.i-1)throw new RangeError;this.J[a]=l}insert(a,l,c=1){if(a<0||a>this.i)throw new RangeError;return this.J.splice(a,0,...new Array(c).fill(l)),this.i+=c,this.i}find(a){for(let l=0;l<this.i;++l)if(this.J[l]===a)return new i(l,this);return this.end()}reverse(){this.J.reverse()}unique(){let a=1;for(let l=1;l<this.i;++l)this.J[l]!==this.J[l-1]&&(this.J[a++]=this.J[l]);return this.i=this.J.length=a,this.i}sort(a){this.J.sort(a)}forEach(a){for(let l=0;l<this.i;++l)a(this.J[l],l,this)}[Symbol.iterator](){return(function*(){yield*this.J}).bind(this)()}},o=s;n.default=o}),Nj=$e(n=>{Oe(),Ne(),Le(),Object.defineProperty(n,"t",{value:!0}),n.default=void 0;var e=i(YE()),t=Eo(),r=So();function i(l){return l&&l.t?l:{default:l}}var s=class o3 extends t.ContainerIterator{constructor(c,h,d,p){super(p),this.o=c,this.h=h,this.container=d,this.iteratorType===0?(this.pre=function(){return this.o.L===this.h&&(0,r.throwIteratorAccessError)(),this.o=this.o.L,this},this.next=function(){return this.o===this.h&&(0,r.throwIteratorAccessError)(),this.o=this.o.B,this}):(this.pre=function(){return this.o.B===this.h&&(0,r.throwIteratorAccessError)(),this.o=this.o.B,this},this.next=function(){return this.o===this.h&&(0,r.throwIteratorAccessError)(),this.o=this.o.L,this})}get pointer(){return this.o===this.h&&(0,r.throwIteratorAccessError)(),this.o.l}set pointer(c){this.o===this.h&&(0,r.throwIteratorAccessError)(),this.o.l=c}copy(){return new o3(this.o,this.h,this.container,this.iteratorType)}},o=class extends e.default{constructor(l=[]){super(),this.h={},this.p=this._=this.h.L=this.h.B=this.h;let c=this;l.forEach(function(h){c.pushBack(h)})}V(l){let{L:c,B:h}=l;c.B=h,h.L=c,l===this.p&&(this.p=h),l===this._&&(this._=c),this.i-=1}G(l,c){let h=c.B,d={l,L:c,B:h};c.B=d,h.L=d,c===this.h&&(this.p=d),h===this.h&&(this._=d),this.i+=1}clear(){this.i=0,this.p=this._=this.h.L=this.h.B=this.h}begin(){return new s(this.p,this.h,this)}end(){return new s(this.h,this.h,this)}rBegin(){return new s(this._,this.h,this,1)}rEnd(){return new s(this.h,this.h,this,1)}front(){return this.p.l}back(){return this._.l}getElementByPos(l){if(l<0||l>this.i-1)throw new RangeError;let c=this.p;for(;l--;)c=c.B;return c.l}eraseElementByPos(l){if(l<0||l>this.i-1)throw new RangeError;let c=this.p;for(;l--;)c=c.B;return this.V(c),this.i}eraseElementByValue(l){let c=this.p;for(;c!==this.h;)c.l===l&&this.V(c),c=c.B;return this.i}eraseElementByIterator(l){let c=l.o;return c===this.h&&(0,r.throwIteratorAccessError)(),l=l.next(),this.V(c),l}pushBack(l){return this.G(l,this._),this.i}popBack(){if(this.i===0)return;let l=this._.l;return this.V(this._),l}pushFront(l){return this.G(l,this.h),this.i}popFront(){if(this.i===0)return;let l=this.p.l;return this.V(this.p),l}setElementByPos(l,c){if(l<0||l>this.i-1)throw new RangeError;let h=this.p;for(;l--;)h=h.B;h.l=c}insert(l,c,h=1){if(l<0||l>this.i)throw new RangeError;if(h<=0)return this.i;if(l===0)for(;h--;)this.pushFront(c);else if(l===this.i)for(;h--;)this.pushBack(c);else{let d=this.p;for(let g=1;g<l;++g)d=d.B;let p=d.B;for(this.i+=h;h--;)d.B={l:c,L:d},d.B.L=d,d=d.B;d.B=p,p.L=d}return this.i}find(l){let c=this.p;for(;c!==this.h;){if(c.l===l)return new s(c,this.h,this);c=c.B}return this.end()}reverse(){if(this.i<=1)return;let l=this.p,c=this._,h=0;for(;h<<1<this.i;){let d=l.l;l.l=c.l,c.l=d,l=l.B,c=c.L,h+=1}}unique(){if(this.i<=1)return this.i;let l=this.p;for(;l!==this.h;){let c=l;for(;c.B!==this.h&&c.l===c.B.l;)c=c.B,this.i-=1;l.B=c.B,l.B.L=l,l=l.B}return this.i}sort(l){if(this.i<=1)return;let c=[];this.forEach(function(d){c.push(d)}),c.sort(l);let h=this.p;c.forEach(function(d){h.l=d,h=h.B})}merge(l){let c=this;if(this.i===0)l.forEach(function(h){c.pushBack(h)});else{let h=this.p;l.forEach(function(d){for(;h!==c.h&&h.l<=d;)h=h.B;c.G(d,h.L)})}return this.i}forEach(l){let c=this.p,h=0;for(;c!==this.h;)l(c.l,h++,this),c=c.B}[Symbol.iterator](){return(function*(){if(this.i===0)return;let l=this.p;for(;l!==this.h;)yield l.l,l=l.B}).bind(this)()}},a=o;n.default=a}),Dj=$e(n=>{Oe(),Ne(),Le(),Object.defineProperty(n,"t",{value:!0}),n.default=void 0;var e=r(YE()),t=i3();function r(a){return a&&a.t?a:{default:a}}var i=class a3 extends t.RandomIterator{constructor(l,c,h){super(l,h),this.container=c}copy(){return new a3(this.o,this.container,this.iteratorType)}},s=class extends e.default{constructor(a=[],l=4096){super(),this.j=0,this.D=0,this.R=0,this.N=0,this.P=0,this.A=[];let c=(()=>{if(typeof a.length=="number")return a.length;if(typeof a.size=="number")return a.size;if(typeof a.size=="function")return a.size();throw new TypeError("Cannot get the length or size of the container")})();this.F=l,this.P=Math.max(Math.ceil(c/this.F),1);for(let p=0;p<this.P;++p)this.A.push(new Array(this.F));let h=Math.ceil(c/this.F);this.j=this.R=(this.P>>1)-(h>>1),this.D=this.N=this.F-c%this.F>>1;let d=this;a.forEach(function(p){d.pushBack(p)})}T(){let a=[],l=Math.max(this.P>>1,1);for(let c=0;c<l;++c)a[c]=new Array(this.F);for(let c=this.j;c<this.P;++c)a[a.length]=this.A[c];for(let c=0;c<this.R;++c)a[a.length]=this.A[c];a[a.length]=[...this.A[this.R]],this.j=l,this.R=a.length-1;for(let c=0;c<l;++c)a[a.length]=new Array(this.F);this.A=a,this.P=a.length}O(a){let l=this.D+a+1,c=l%this.F,h=c-1,d=this.j+(l-c)/this.F;return c===0&&(d-=1),d%=this.P,h<0&&(h+=this.F),{curNodeBucketIndex:d,curNodePointerIndex:h}}clear(){this.A=[new Array(this.F)],this.P=1,this.j=this.R=this.i=0,this.D=this.N=this.F>>1}begin(){return new i(0,this)}end(){return new i(this.i,this)}rBegin(){return new i(this.i-1,this,1)}rEnd(){return new i(-1,this,1)}front(){if(this.i!==0)return this.A[this.j][this.D]}back(){if(this.i!==0)return this.A[this.R][this.N]}pushBack(a){return this.i&&(this.N<this.F-1?this.N+=1:this.R<this.P-1?(this.R+=1,this.N=0):(this.R=0,this.N=0),this.R===this.j&&this.N===this.D&&this.T()),this.i+=1,this.A[this.R][this.N]=a,this.i}popBack(){if(this.i===0)return;let a=this.A[this.R][this.N];return this.i!==1&&(this.N>0?this.N-=1:this.R>0?(this.R-=1,this.N=this.F-1):(this.R=this.P-1,this.N=this.F-1)),this.i-=1,a}pushFront(a){return this.i&&(this.D>0?this.D-=1:this.j>0?(this.j-=1,this.D=this.F-1):(this.j=this.P-1,this.D=this.F-1),this.j===this.R&&this.D===this.N&&this.T()),this.i+=1,this.A[this.j][this.D]=a,this.i}popFront(){if(this.i===0)return;let a=this.A[this.j][this.D];return this.i!==1&&(this.D<this.F-1?this.D+=1:this.j<this.P-1?(this.j+=1,this.D=0):(this.j=0,this.D=0)),this.i-=1,a}getElementByPos(a){if(a<0||a>this.i-1)throw new RangeError;let{curNodeBucketIndex:l,curNodePointerIndex:c}=this.O(a);return this.A[l][c]}setElementByPos(a,l){if(a<0||a>this.i-1)throw new RangeError;let{curNodeBucketIndex:c,curNodePointerIndex:h}=this.O(a);this.A[c][h]=l}insert(a,l,c=1){if(a<0||a>this.i)throw new RangeError;if(a===0)for(;c--;)this.pushFront(l);else if(a===this.i)for(;c--;)this.pushBack(l);else{let h=[];for(let d=a;d<this.i;++d)h.push(this.getElementByPos(d));this.cut(a-1);for(let d=0;d<c;++d)this.pushBack(l);for(let d=0;d<h.length;++d)this.pushBack(h[d])}return this.i}cut(a){if(a<0)return this.clear(),0;let{curNodeBucketIndex:l,curNodePointerIndex:c}=this.O(a);return this.R=l,this.N=c,this.i=a+1,this.i}eraseElementByPos(a){if(a<0||a>this.i-1)throw new RangeError;if(a===0)this.popFront();else if(a===this.i-1)this.popBack();else{let l=[];for(let h=a+1;h<this.i;++h)l.push(this.getElementByPos(h));this.cut(a),this.popBack();let c=this;l.forEach(function(h){c.pushBack(h)})}return this.i}eraseElementByValue(a){if(this.i===0)return 0;let l=[];for(let h=0;h<this.i;++h){let d=this.getElementByPos(h);d!==a&&l.push(d)}let c=l.length;for(let h=0;h<c;++h)this.setElementByPos(h,l[h]);return this.cut(c-1)}eraseElementByIterator(a){let l=a.o;return this.eraseElementByPos(l),a=a.next(),a}find(a){for(let l=0;l<this.i;++l)if(this.getElementByPos(l)===a)return new i(l,this);return this.end()}reverse(){let a=0,l=this.i-1;for(;a<l;){let c=this.getElementByPos(a);this.setElementByPos(a,this.getElementByPos(l)),this.setElementByPos(l,c),a+=1,l-=1}}unique(){if(this.i<=1)return this.i;let a=1,l=this.getElementByPos(0);for(let c=1;c<this.i;++c){let h=this.getElementByPos(c);h!==l&&(l=h,this.setElementByPos(a++,h))}for(;this.i>a;)this.popBack();return this.i}sort(a){let l=[];for(let c=0;c<this.i;++c)l.push(this.getElementByPos(c));l.sort(a);for(let c=0;c<this.i;++c)this.setElementByPos(c,l[c])}shrinkToFit(){if(this.i===0)return;let a=[];this.forEach(function(l){a.push(l)}),this.P=Math.max(Math.ceil(this.i/this.F),1),this.i=this.j=this.R=this.D=this.N=0,this.A=[];for(let l=0;l<this.P;++l)this.A.push(new Array(this.F));for(let l=0;l<a.length;++l)this.pushBack(a[l])}forEach(a){for(let l=0;l<this.i;++l)a(this.getElementByPos(l),l,this)}[Symbol.iterator](){return(function*(){for(let a=0;a<this.i;++a)yield this.getElementByPos(a)}).bind(this)()}},o=s;n.default=o}),$j=$e(n=>{Oe(),Ne(),Le(),Object.defineProperty(n,"t",{value:!0}),n.TreeNodeEnableIndex=n.TreeNode=void 0;var e=class{constructor(r,i){this.ee=1,this.u=void 0,this.l=void 0,this.U=void 0,this.W=void 0,this.tt=void 0,this.u=r,this.l=i}L(){let r=this;if(r.ee===1&&r.tt.tt===r)r=r.W;else if(r.U)for(r=r.U;r.W;)r=r.W;else{let i=r.tt;for(;i.U===r;)r=i,i=r.tt;r=i}return r}B(){let r=this;if(r.W){for(r=r.W;r.U;)r=r.U;return r}else{let i=r.tt;for(;i.W===r;)r=i,i=r.tt;return r.W!==i?i:r}}te(){let r=this.tt,i=this.W,s=i.U;return r.tt===this?r.tt=i:r.U===this?r.U=i:r.W=i,i.tt=r,i.U=this,this.tt=i,this.W=s,s&&(s.tt=this),i}se(){let r=this.tt,i=this.U,s=i.W;return r.tt===this?r.tt=i:r.U===this?r.U=i:r.W=i,i.tt=r,i.W=this,this.tt=i,this.U=s,s&&(s.tt=this),i}};n.TreeNode=e;var t=class extends e{constructor(){super(...arguments),this.rt=1}te(){let r=super.te();return this.ie(),r.ie(),r}se(){let r=super.se();return this.ie(),r.ie(),r}ie(){this.rt=1,this.U&&(this.rt+=this.U.rt),this.W&&(this.rt+=this.W.rt)}};n.TreeNodeEnableIndex=t}),l3=$e(n=>{Oe(),Ne(),Le(),Object.defineProperty(n,"t",{value:!0}),n.default=void 0;var e=$j(),t=Eo(),r=So(),i=class extends t.Container{constructor(o=function(l,c){return l<c?-1:l>c?1:0},a=!1){super(),this.Y=void 0,this.v=o,a?(this.re=e.TreeNodeEnableIndex,this.M=function(l,c,h){let d=this.ne(l,c,h);if(d){let p=d.tt;for(;p!==this.h;)p.rt+=1,p=p.tt;let g=this.he(d);if(g){let{parentNode:m,grandParent:E,curNode:y}=g;m.ie(),E.ie(),y.ie()}}return this.i},this.V=function(l){let c=this.fe(l);for(;c!==this.h;)c.rt-=1,c=c.tt}):(this.re=e.TreeNode,this.M=function(l,c,h){let d=this.ne(l,c,h);return d&&this.he(d),this.i},this.V=this.fe),this.h=new this.re}X(o,a){let l=this.h;for(;o;){let c=this.v(o.u,a);if(c<0)o=o.W;else if(c>0)l=o,o=o.U;else return o}return l}Z(o,a){let l=this.h;for(;o;)this.v(o.u,a)<=0?o=o.W:(l=o,o=o.U);return l}$(o,a){let l=this.h;for(;o;){let c=this.v(o.u,a);if(c<0)l=o,o=o.W;else if(c>0)o=o.U;else return o}return l}rr(o,a){let l=this.h;for(;o;)this.v(o.u,a)<0?(l=o,o=o.W):o=o.U;return l}ue(o){for(;;){let a=o.tt;if(a===this.h)return;if(o.ee===1){o.ee=0;return}if(o===a.U){let l=a.W;if(l.ee===1)l.ee=0,a.ee=1,a===this.Y?this.Y=a.te():a.te();else if(l.W&&l.W.ee===1){l.ee=a.ee,a.ee=0,l.W.ee=0,a===this.Y?this.Y=a.te():a.te();return}else l.U&&l.U.ee===1?(l.ee=1,l.U.ee=0,l.se()):(l.ee=1,o=a)}else{let l=a.U;if(l.ee===1)l.ee=0,a.ee=1,a===this.Y?this.Y=a.se():a.se();else if(l.U&&l.U.ee===1){l.ee=a.ee,a.ee=0,l.U.ee=0,a===this.Y?this.Y=a.se():a.se();return}else l.W&&l.W.ee===1?(l.ee=1,l.W.ee=0,l.te()):(l.ee=1,o=a)}}}fe(o){if(this.i===1)return this.clear(),this.h;let a=o;for(;a.U||a.W;){if(a.W)for(a=a.W;a.U;)a=a.U;else a=a.U;[o.u,a.u]=[a.u,o.u],[o.l,a.l]=[a.l,o.l],o=a}this.h.U===a?this.h.U=a.tt:this.h.W===a&&(this.h.W=a.tt),this.ue(a);let l=a.tt;return a===l.U?l.U=void 0:l.W=void 0,this.i-=1,this.Y.ee=0,l}oe(o,a){return o===void 0?!1:this.oe(o.U,a)||a(o)?!0:this.oe(o.W,a)}he(o){for(;;){let a=o.tt;if(a.ee===0)return;let l=a.tt;if(a===l.U){let c=l.W;if(c&&c.ee===1){if(c.ee=a.ee=0,l===this.Y)return;l.ee=1,o=l;continue}else if(o===a.W){if(o.ee=0,o.U&&(o.U.tt=a),o.W&&(o.W.tt=l),a.W=o.U,l.U=o.W,o.U=a,o.W=l,l===this.Y)this.Y=o,this.h.tt=o;else{let h=l.tt;h.U===l?h.U=o:h.W=o}return o.tt=l.tt,a.tt=o,l.tt=o,l.ee=1,{parentNode:a,grandParent:l,curNode:o}}else a.ee=0,l===this.Y?this.Y=l.se():l.se(),l.ee=1}else{let c=l.U;if(c&&c.ee===1){if(c.ee=a.ee=0,l===this.Y)return;l.ee=1,o=l;continue}else if(o===a.U){if(o.ee=0,o.U&&(o.U.tt=l),o.W&&(o.W.tt=a),l.W=o.U,a.U=o.W,o.U=l,o.W=a,l===this.Y)this.Y=o,this.h.tt=o;else{let h=l.tt;h.U===l?h.U=o:h.W=o}return o.tt=l.tt,a.tt=o,l.tt=o,l.ee=1,{parentNode:a,grandParent:l,curNode:o}}else a.ee=0,l===this.Y?this.Y=l.te():l.te(),l.ee=1}return}}ne(o,a,l){if(this.Y===void 0){this.i+=1,this.Y=new this.re(o,a),this.Y.ee=0,this.Y.tt=this.h,this.h.tt=this.Y,this.h.U=this.Y,this.h.W=this.Y;return}let c,h=this.h.U,d=this.v(h.u,o);if(d===0){h.l=a;return}else if(d>0)h.U=new this.re(o,a),h.U.tt=h,c=h.U,this.h.U=c;else{let p=this.h.W,g=this.v(p.u,o);if(g===0){p.l=a;return}else if(g<0)p.W=new this.re(o,a),p.W.tt=p,c=p.W,this.h.W=c;else{if(l!==void 0){let m=l.o;if(m!==this.h){let E=this.v(m.u,o);if(E===0){m.l=a;return}else if(E>0){let y=m.L(),S=this.v(y.u,o);if(S===0){y.l=a;return}else S<0&&(c=new this.re(o,a),y.W===void 0?(y.W=c,c.tt=y):(m.U=c,c.tt=m))}}}if(c===void 0)for(c=this.Y;;){let m=this.v(c.u,o);if(m>0){if(c.U===void 0){c.U=new this.re(o,a),c.U.tt=c,c=c.U;break}c=c.U}else if(m<0){if(c.W===void 0){c.W=new this.re(o,a),c.W.tt=c,c=c.W;break}c=c.W}else{c.l=a;return}}}}return this.i+=1,c}I(o,a){for(;o;){let l=this.v(o.u,a);if(l<0)o=o.W;else if(l>0)o=o.U;else return o}return o||this.h}clear(){this.i=0,this.Y=void 0,this.h.tt=void 0,this.h.U=this.h.W=void 0}updateKeyByIterator(o,a){let l=o.o;if(l===this.h&&(0,r.throwIteratorAccessError)(),this.i===1)return l.u=a,!0;if(l===this.h.U)return this.v(l.B().u,a)>0?(l.u=a,!0):!1;if(l===this.h.W)return this.v(l.L().u,a)<0?(l.u=a,!0):!1;let c=l.L().u;if(this.v(c,a)>=0)return!1;let h=l.B().u;return this.v(h,a)<=0?!1:(l.u=a,!0)}eraseElementByPos(o){if(o<0||o>this.i-1)throw new RangeError;let a=0,l=this;return this.oe(this.Y,function(c){return o===a?(l.V(c),!0):(a+=1,!1)}),this.i}eraseElementByKey(o){if(this.i===0)return!1;let a=this.I(this.Y,o);return a===this.h?!1:(this.V(a),!0)}eraseElementByIterator(o){let a=o.o;a===this.h&&(0,r.throwIteratorAccessError)();let l=a.W===void 0;return o.iteratorType===0?l&&o.next():(!l||a.U===void 0)&&o.next(),this.V(a),o}forEach(o){let a=0;for(let l of this)o(l,a++,this)}getElementByPos(o){if(o<0||o>this.i-1)throw new RangeError;let a,l=0;for(let c of this){if(l===o){a=c;break}l+=1}return a}getHeight(){if(this.i===0)return 0;let o=function(a){return a?Math.max(o(a.U),o(a.W))+1:0};return o(this.Y)}},s=i;n.default=s}),c3=$e(n=>{Oe(),Ne(),Le(),Object.defineProperty(n,"t",{value:!0}),n.default=void 0;var e=Eo(),t=So(),r=class extends e.ContainerIterator{constructor(s,o,a){super(a),this.o=s,this.h=o,this.iteratorType===0?(this.pre=function(){return this.o===this.h.U&&(0,t.throwIteratorAccessError)(),this.o=this.o.L(),this},this.next=function(){return this.o===this.h&&(0,t.throwIteratorAccessError)(),this.o=this.o.B(),this}):(this.pre=function(){return this.o===this.h.W&&(0,t.throwIteratorAccessError)(),this.o=this.o.B(),this},this.next=function(){return this.o===this.h&&(0,t.throwIteratorAccessError)(),this.o=this.o.L(),this})}get index(){let s=this.o,o=this.h.tt;if(s===this.h)return o?o.rt-1:0;let a=0;for(s.U&&(a+=s.U.rt);s!==o;){let l=s.tt;s===l.W&&(a+=1,l.U&&(a+=l.U.rt)),s=l}return a}},i=r;n.default=i}),Mj=$e(n=>{Oe(),Ne(),Le(),Object.defineProperty(n,"t",{value:!0}),n.default=void 0;var e=i(l3()),t=i(c3()),r=So();function i(l){return l&&l.t?l:{default:l}}var s=class u3 extends t.default{constructor(c,h,d,p){super(c,h,p),this.container=d}get pointer(){return this.o===this.h&&(0,r.throwIteratorAccessError)(),this.o.u}copy(){return new u3(this.o,this.h,this.container,this.iteratorType)}},o=class extends e.default{constructor(l=[],c,h){super(c,h);let d=this;l.forEach(function(p){d.insert(p)})}*K(l){l!==void 0&&(yield*this.K(l.U),yield l.u,yield*this.K(l.W))}begin(){return new s(this.h.U||this.h,this.h,this)}end(){return new s(this.h,this.h,this)}rBegin(){return new s(this.h.W||this.h,this.h,this,1)}rEnd(){return new s(this.h,this.h,this,1)}front(){return this.h.U?this.h.U.u:void 0}back(){return this.h.W?this.h.W.u:void 0}insert(l,c){return this.M(l,void 0,c)}find(l){let c=this.I(this.Y,l);return new s(c,this.h,this)}lowerBound(l){let c=this.X(this.Y,l);return new s(c,this.h,this)}upperBound(l){let c=this.Z(this.Y,l);return new s(c,this.h,this)}reverseLowerBound(l){let c=this.$(this.Y,l);return new s(c,this.h,this)}reverseUpperBound(l){let c=this.rr(this.Y,l);return new s(c,this.h,this)}union(l){let c=this;return l.forEach(function(h){c.insert(h)}),this.i}[Symbol.iterator](){return this.K(this.Y)}},a=o;n.default=a}),Bj=$e(n=>{Oe(),Ne(),Le(),Object.defineProperty(n,"t",{value:!0}),n.default=void 0;var e=i(l3()),t=i(c3()),r=So();function i(l){return l&&l.t?l:{default:l}}var s=class h3 extends t.default{constructor(c,h,d,p){super(c,h,p),this.container=d}get pointer(){this.o===this.h&&(0,r.throwIteratorAccessError)();let c=this;return new Proxy([],{get(h,d){if(d==="0")return c.o.u;if(d==="1")return c.o.l},set(h,d,p){if(d!=="1")throw new TypeError("props must be 1");return c.o.l=p,!0}})}copy(){return new h3(this.o,this.h,this.container,this.iteratorType)}},o=class extends e.default{constructor(l=[],c,h){super(c,h);let d=this;l.forEach(function(p){d.setElement(p[0],p[1])})}*K(l){l!==void 0&&(yield*this.K(l.U),yield[l.u,l.l],yield*this.K(l.W))}begin(){return new s(this.h.U||this.h,this.h,this)}end(){return new s(this.h,this.h,this)}rBegin(){return new s(this.h.W||this.h,this.h,this,1)}rEnd(){return new s(this.h,this.h,this,1)}front(){if(this.i===0)return;let l=this.h.U;return[l.u,l.l]}back(){if(this.i===0)return;let l=this.h.W;return[l.u,l.l]}lowerBound(l){let c=this.X(this.Y,l);return new s(c,this.h,this)}upperBound(l){let c=this.Z(this.Y,l);return new s(c,this.h,this)}reverseLowerBound(l){let c=this.$(this.Y,l);return new s(c,this.h,this)}reverseUpperBound(l){let c=this.rr(this.Y,l);return new s(c,this.h,this)}setElement(l,c,h){return this.M(l,c,h)}find(l){let c=this.I(this.Y,l);return new s(c,this.h,this)}getElementByKey(l){return this.I(this.Y,l).l}union(l){let c=this;return l.forEach(function(h){c.setElement(h[0],h[1])}),this.i}[Symbol.iterator](){return this.K(this.Y)}},a=o;n.default=a}),f3=$e(n=>{Oe(),Ne(),Le(),Object.defineProperty(n,"t",{value:!0}),n.default=e;function e(t){let r=typeof t;return r==="object"&&t!==null||r==="function"}}),d3=$e(n=>{Oe(),Ne(),Le(),Object.defineProperty(n,"t",{value:!0}),n.HashContainerIterator=n.HashContainer=void 0;var e=Eo(),t=i(f3()),r=So();function i(a){return a&&a.t?a:{default:a}}var s=class extends e.ContainerIterator{constructor(a,l,c){super(c),this.o=a,this.h=l,this.iteratorType===0?(this.pre=function(){return this.o.L===this.h&&(0,r.throwIteratorAccessError)(),this.o=this.o.L,this},this.next=function(){return this.o===this.h&&(0,r.throwIteratorAccessError)(),this.o=this.o.B,this}):(this.pre=function(){return this.o.B===this.h&&(0,r.throwIteratorAccessError)(),this.o=this.o.B,this},this.next=function(){return this.o===this.h&&(0,r.throwIteratorAccessError)(),this.o=this.o.L,this})}};n.HashContainerIterator=s;var o=class extends e.Container{constructor(){super(),this.H=[],this.g={},this.HASH_TAG=Symbol("@@HASH_TAG"),Object.setPrototypeOf(this.g,null),this.h={},this.h.L=this.h.B=this.p=this._=this.h}V(a){let{L:l,B:c}=a;l.B=c,c.L=l,a===this.p&&(this.p=c),a===this._&&(this._=l),this.i-=1}M(a,l,c){c===void 0&&(c=(0,t.default)(a));let h;if(c){let d=a[this.HASH_TAG];if(d!==void 0)return this.H[d].l=l,this.i;Object.defineProperty(a,this.HASH_TAG,{value:this.H.length,configurable:!0}),h={u:a,l,L:this._,B:this.h},this.H.push(h)}else{let d=this.g[a];if(d)return d.l=l,this.i;h={u:a,l,L:this._,B:this.h},this.g[a]=h}return this.i===0?(this.p=h,this.h.B=h):this._.B=h,this._=h,this.h.L=h,++this.i}I(a,l){if(l===void 0&&(l=(0,t.default)(a)),l){let c=a[this.HASH_TAG];return c===void 0?this.h:this.H[c]}else return this.g[a]||this.h}clear(){let a=this.HASH_TAG;this.H.forEach(function(l){delete l.u[a]}),this.H=[],this.g={},Object.setPrototypeOf(this.g,null),this.i=0,this.p=this._=this.h.L=this.h.B=this.h}eraseElementByKey(a,l){let c;if(l===void 0&&(l=(0,t.default)(a)),l){let h=a[this.HASH_TAG];if(h===void 0)return!1;delete a[this.HASH_TAG],c=this.H[h],delete this.H[h]}else{if(c=this.g[a],c===void 0)return!1;delete this.g[a]}return this.V(c),!0}eraseElementByIterator(a){let l=a.o;return l===this.h&&(0,r.throwIteratorAccessError)(),this.V(l),a.next()}eraseElementByPos(a){if(a<0||a>this.i-1)throw new RangeError;let l=this.p;for(;a--;)l=l.B;return this.V(l),this.i}};n.HashContainer=o}),Uj=$e(n=>{Oe(),Ne(),Le(),Object.defineProperty(n,"t",{value:!0}),n.default=void 0;var e=d3(),t=So(),r=class p3 extends e.HashContainerIterator{constructor(a,l,c,h){super(a,l,h),this.container=c}get pointer(){return this.o===this.h&&(0,t.throwIteratorAccessError)(),this.o.u}copy(){return new p3(this.o,this.h,this.container,this.iteratorType)}},i=class extends e.HashContainer{constructor(o=[]){super();let a=this;o.forEach(function(l){a.insert(l)})}begin(){return new r(this.p,this.h,this)}end(){return new r(this.h,this.h,this)}rBegin(){return new r(this._,this.h,this,1)}rEnd(){return new r(this.h,this.h,this,1)}front(){return this.p.u}back(){return this._.u}insert(o,a){return this.M(o,void 0,a)}getElementByPos(o){if(o<0||o>this.i-1)throw new RangeError;let a=this.p;for(;o--;)a=a.B;return a.u}find(o,a){let l=this.I(o,a);return new r(l,this.h,this)}forEach(o){let a=0,l=this.p;for(;l!==this.h;)o(l.u,a++,this),l=l.B}[Symbol.iterator](){return(function*(){let o=this.p;for(;o!==this.h;)yield o.u,o=o.B}).bind(this)()}},s=i;n.default=s}),Fj=$e(n=>{Oe(),Ne(),Le(),Object.defineProperty(n,"t",{value:!0}),n.default=void 0;var e=d3(),t=i(f3()),r=So();function i(l){return l&&l.t?l:{default:l}}var s=class g3 extends e.HashContainerIterator{constructor(c,h,d,p){super(c,h,p),this.container=d}get pointer(){this.o===this.h&&(0,r.throwIteratorAccessError)();let c=this;return new Proxy([],{get(h,d){if(d==="0")return c.o.u;if(d==="1")return c.o.l},set(h,d,p){if(d!=="1")throw new TypeError("props must be 1");return c.o.l=p,!0}})}copy(){return new g3(this.o,this.h,this.container,this.iteratorType)}},o=class extends e.HashContainer{constructor(l=[]){super();let c=this;l.forEach(function(h){c.setElement(h[0],h[1])})}begin(){return new s(this.p,this.h,this)}end(){return new s(this.h,this.h,this)}rBegin(){return new s(this._,this.h,this,1)}rEnd(){return new s(this.h,this.h,this,1)}front(){if(this.i!==0)return[this.p.u,this.p.l]}back(){if(this.i!==0)return[this._.u,this._.l]}setElement(l,c,h){return this.M(l,c,h)}getElementByKey(l,c){if(c===void 0&&(c=(0,t.default)(l)),c){let d=l[this.HASH_TAG];return d!==void 0?this.H[d].l:void 0}let h=this.g[l];return h?h.l:void 0}getElementByPos(l){if(l<0||l>this.i-1)throw new RangeError;let c=this.p;for(;l--;)c=c.B;return[c.u,c.l]}find(l,c){let h=this.I(l,c);return new s(h,this.h,this)}forEach(l){let c=0,h=this.p;for(;h!==this.h;)l([h.u,h.l],c++,this),h=h.B}[Symbol.iterator](){return(function*(){let l=this.p;for(;l!==this.h;)yield[l.u,l.l],l=l.B}).bind(this)()}},a=o;n.default=a}),jj=$e(n=>{Oe(),Ne(),Le(),Object.defineProperty(n,"t",{value:!0}),Object.defineProperty(n,"Deque",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(n,"HashMap",{enumerable:!0,get:function(){return h.default}}),Object.defineProperty(n,"HashSet",{enumerable:!0,get:function(){return c.default}}),Object.defineProperty(n,"LinkList",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(n,"OrderedMap",{enumerable:!0,get:function(){return l.default}}),Object.defineProperty(n,"OrderedSet",{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(n,"PriorityQueue",{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(n,"Queue",{enumerable:!0,get:function(){return t.default}}),Object.defineProperty(n,"Stack",{enumerable:!0,get:function(){return e.default}}),Object.defineProperty(n,"Vector",{enumerable:!0,get:function(){return i.default}});var e=d(Pj()),t=d(Rj()),r=d(Oj()),i=d(Lj()),s=d(Nj()),o=d(Dj()),a=d(Mj()),l=d(Bj()),c=d(Uj()),h=d(Fj());function d(p){return p&&p.t?p:{default:p}}}),qj=$e((n,e)=>{Oe(),Ne(),Le();var t=jj().OrderedSet,r=yo()("number-allocator:trace"),i=yo()("number-allocator:error");function s(a,l){this.low=a,this.high=l}s.prototype.equals=function(a){return this.low===a.low&&this.high===a.high},s.prototype.compare=function(a){return this.low<a.low&&this.high<a.low?-1:a.low<this.low&&a.high<this.low?1:0};function o(a,l){if(!(this instanceof o))return new o(a,l);this.min=a,this.max=l,this.ss=new t([],(c,h)=>c.compare(h)),r("Create"),this.clear()}o.prototype.firstVacant=function(){return this.ss.size()===0?null:this.ss.front().low},o.prototype.alloc=function(){if(this.ss.size()===0)return r("alloc():empty"),null;let a=this.ss.begin(),l=a.pointer.low,c=a.pointer.high,h=l;return h+1<=c?this.ss.updateKeyByIterator(a,new s(l+1,c)):this.ss.eraseElementByPos(0),r("alloc():"+h),h},o.prototype.use=function(a){let l=new s(a,a),c=this.ss.lowerBound(l);if(!c.equals(this.ss.end())){let h=c.pointer.low,d=c.pointer.high;return c.pointer.equals(l)?(this.ss.eraseElementByIterator(c),r("use():"+a),!0):h>a?!1:h===a?(this.ss.updateKeyByIterator(c,new s(h+1,d)),r("use():"+a),!0):d===a?(this.ss.updateKeyByIterator(c,new s(h,d-1)),r("use():"+a),!0):(this.ss.updateKeyByIterator(c,new s(a+1,d)),this.ss.insert(new s(h,a-1)),r("use():"+a),!0)}return r("use():failed"),!1},o.prototype.free=function(a){if(a<this.min||a>this.max){i("free():"+a+" is out of range");return}let l=new s(a,a),c=this.ss.upperBound(l);if(c.equals(this.ss.end())){if(c.equals(this.ss.begin())){this.ss.insert(l);return}c.pre();let h=c.pointer.high;c.pointer.high+1===a?this.ss.updateKeyByIterator(c,new s(h,a)):this.ss.insert(l)}else if(c.equals(this.ss.begin()))if(a+1===c.pointer.low){let h=c.pointer.high;this.ss.updateKeyByIterator(c,new s(a,h))}else this.ss.insert(l);else{let h=c.pointer.low,d=c.pointer.high;c.pre();let p=c.pointer.low;c.pointer.high+1===a?a+1===h?(this.ss.eraseElementByIterator(c),this.ss.updateKeyByIterator(c,new s(p,d))):this.ss.updateKeyByIterator(c,new s(p,a)):a+1===h?(this.ss.eraseElementByIterator(c.next()),this.ss.insert(new s(a,d))):this.ss.insert(l)}r("free():"+a)},o.prototype.clear=function(){r("clear()"),this.ss.clear(),this.ss.insert(new s(this.min,this.max))},o.prototype.intervalCount=function(){return this.ss.size()},o.prototype.dump=function(){console.log("length:"+this.ss.size());for(let a of this.ss)console.log(a)},e.exports=o}),m3=$e((n,e)=>{Oe(),Ne(),Le();var t=qj();e.exports.NumberAllocator=t}),Hj=$e(n=>{Oe(),Ne(),Le(),Object.defineProperty(n,"__esModule",{value:!0});var e=kj(),t=m3(),r=class{constructor(i){v(this,"aliasToTopic");v(this,"topicToAlias");v(this,"max");v(this,"numberAllocator");v(this,"length");i>0&&(this.aliasToTopic=new e.LRUCache({max:i}),this.topicToAlias={},this.numberAllocator=new t.NumberAllocator(1,i),this.max=i,this.length=0)}put(i,s){if(s===0||s>this.max)return!1;let o=this.aliasToTopic.get(s);return o&&delete this.topicToAlias[o],this.aliasToTopic.set(s,i),this.topicToAlias[i]=s,this.numberAllocator.use(s),this.length=this.aliasToTopic.size,!0}getTopicByAlias(i){return this.aliasToTopic.get(i)}getAliasByTopic(i){let s=this.topicToAlias[i];return typeof s<"u"&&this.aliasToTopic.get(s),s}clear(){this.aliasToTopic.clear(),this.topicToAlias={},this.numberAllocator.clear(),this.length=0}getLruAlias(){return this.numberAllocator.firstVacant()||[...this.aliasToTopic.keys()][this.aliasToTopic.size-1]}};n.default=r}),Wj=$e(n=>{Oe(),Ne(),Le();var e=n&&n.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(n,"__esModule",{value:!0});var t=Iy(),r=e(Hj()),i=Hu(),s=(o,a)=>{o.log("_handleConnack");let{options:l}=o,c=l.protocolVersion===5?a.reasonCode:a.returnCode;if(clearTimeout(o.connackTimer),delete o.topicAliasSend,a.properties){if(a.properties.topicAliasMaximum){if(a.properties.topicAliasMaximum>65535){o.emit("error",new Error("topicAliasMaximum from broker is out of range"));return}a.properties.topicAliasMaximum>0&&(o.topicAliasSend=new r.default(a.properties.topicAliasMaximum))}a.properties.serverKeepAlive&&l.keepalive&&(l.keepalive=a.properties.serverKeepAlive),a.properties.maximumPacketSize&&(l.properties||(l.properties={}),l.properties.maximumPacketSize=a.properties.maximumPacketSize)}if(c===0)o.reconnecting=!1,o._onConnect(a);else if(c>0){let h=new i.ErrorWithReasonCode(`Connection refused: ${t.ReasonCodes[c]}`,c);o.emit("error",h),o.options.reconnectOnConnackError&&o._cleanUp(!0)}};n.default=s}),zj=$e(n=>{Oe(),Ne(),Le(),Object.defineProperty(n,"__esModule",{value:!0});var e=(t,r,i)=>{t.log("handling pubrel packet");let s=typeof i<"u"?i:t.noop,{messageId:o}=r,a={cmd:"pubcomp",messageId:o};t.incomingStore.get(r,(l,c)=>{l?t._sendPacket(a,s):(t.emit("message",c.topic,c.payload,c),t.handleMessage(c,h=>{if(h)return s(h);t.incomingStore.del(c,t.noop),t._sendPacket(a,s)}))})};n.default=e}),Kj=$e(n=>{Oe(),Ne(),Le();var e=n&&n.__importDefault||function(l){return l&&l.__esModule?l:{default:l}};Object.defineProperty(n,"__esModule",{value:!0});var t=e(Ij()),r=e(Cj()),i=e(Wj()),s=e(Iy()),o=e(zj()),a=(l,c,h)=>{let{options:d}=l;if(d.protocolVersion===5&&d.properties&&d.properties.maximumPacketSize&&d.properties.maximumPacketSize<c.length)return l.emit("error",new Error(`exceeding packets size ${c.cmd}`)),l.end({reasonCode:149,properties:{reasonString:"Maximum packet size was exceeded"}}),l;switch(l.log("_handlePacket :: emitting packetreceive"),l.emit("packetreceive",c),c.cmd){case"publish":(0,t.default)(l,c,h);break;case"puback":case"pubrec":case"pubcomp":case"suback":case"unsuback":l.reschedulePing(),(0,s.default)(l,c),h();break;case"pubrel":l.reschedulePing(),(0,o.default)(l,c,h);break;case"connack":(0,i.default)(l,c),h();break;case"auth":l.reschedulePing(),(0,r.default)(l,c),h();break;case"pingresp":l.log("_handlePacket :: received pingresp"),l.reschedulePing(!0),h();break;case"disconnect":l.emit("disconnect",c),h();break;default:l.log("_handlePacket :: unknown command"),h();break}};n.default=a}),y3=$e(n=>{Oe(),Ne(),Le(),Object.defineProperty(n,"__esModule",{value:!0});var e=class{constructor(){v(this,"nextId");this.nextId=Math.max(1,Math.floor(Math.random()*65535))}allocate(){let t=this.nextId++;return this.nextId===65536&&(this.nextId=1),t}getLastAllocated(){return this.nextId===1?65535:this.nextId-1}register(t){return!0}deallocate(t){}clear(){}};n.default=e}),Vj=$e(n=>{Oe(),Ne(),Le(),Object.defineProperty(n,"__esModule",{value:!0});var e=class{constructor(t){v(this,"aliasToTopic");v(this,"max");v(this,"length");this.aliasToTopic={},this.max=t}put(t,r){return r===0||r>this.max?!1:(this.aliasToTopic[r]=t,this.length=Object.keys(this.aliasToTopic).length,!0)}getTopicByAlias(t){return this.aliasToTopic[t]}clear(){this.aliasToTopic={}}};n.default=e}),Gj=$e(n=>{Oe(),Ne(),Le();var e=n&&n.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(n,"__esModule",{value:!0}),n.TypedEventEmitter=void 0;var t=e((Kl(),nr(Aa))),r=Hu(),i=class{};n.TypedEventEmitter=i,(0,r.applyMixin)(i,t.default)}),Ty=$e((n,e)=>{Oe(),Ne(),Le();function t(r){"@babel/helpers - typeof";return e.exports=t=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},e.exports.__esModule=!0,e.exports.default=e.exports,t(r)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports}),Yj=$e((n,e)=>{Oe(),Ne(),Le();var t=Ty().default;function r(i,s){if(t(i)!="object"||!i)return i;var o=i[Symbol.toPrimitive];if(o!==void 0){var a=o.call(i,s||"default");if(t(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(i)}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports}),Xj=$e((n,e)=>{Oe(),Ne(),Le();var t=Ty().default,r=Yj();function i(s){var o=r(s,"string");return t(o)=="symbol"?o:o+""}e.exports=i,e.exports.__esModule=!0,e.exports.default=e.exports}),Zj=$e((n,e)=>{Oe(),Ne(),Le();var t=Xj();function r(i,s,o){return(s=t(s))in i?Object.defineProperty(i,s,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[s]=o,i}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports}),Qj=$e((n,e)=>{Oe(),Ne(),Le();function t(r){if(Array.isArray(r))return r}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports}),Jj=$e((n,e)=>{Oe(),Ne(),Le();function t(r,i){var s=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(s!=null){var o,a,l,c,h=[],d=!0,p=!1;try{if(l=(s=s.call(r)).next,i===0){if(Object(s)!==s)return;d=!1}else for(;!(d=(o=l.call(s)).done)&&(h.push(o.value),h.length!==i);d=!0);}catch(g){p=!0,a=g}finally{try{if(!d&&s.return!=null&&(c=s.return(),Object(c)!==c))return}finally{if(p)throw a}}return h}}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports}),eq=$e((n,e)=>{Oe(),Ne(),Le();function t(r,i){(i==null||i>r.length)&&(i=r.length);for(var s=0,o=Array(i);s<i;s++)o[s]=r[s];return o}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports}),tq=$e((n,e)=>{Oe(),Ne(),Le();var t=eq();function r(i,s){if(i){if(typeof i=="string")return t(i,s);var o={}.toString.call(i).slice(8,-1);return o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set"?Array.from(i):o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?t(i,s):void 0}}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports}),rq=$e((n,e)=>{Oe(),Ne(),Le();function t(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports}),nq=$e((n,e)=>{Oe(),Ne(),Le();var t=Qj(),r=Jj(),i=tq(),s=rq();function o(a,l){return t(a)||r(a,l)||i(a,l)||s()}e.exports=o,e.exports.__esModule=!0,e.exports.default=e.exports}),b3=$e((n,e)=>{Oe(),Ne(),Le(),function(t,r){typeof n=="object"&&typeof e<"u"?r(n):typeof define=="function"&&define.amd?define(["exports"],r):(t=typeof globalThis<"u"?globalThis:t||self,r(t.fastUniqueNumbers={}))}(n,function(t){var r=function(g){return function(m){var E=g(m);return m.add(E),E}},i=function(g){return function(m,E){return g.set(m,E),E}},s=Number.MAX_SAFE_INTEGER===void 0?9007199254740991:Number.MAX_SAFE_INTEGER,o=536870912,a=o*2,l=function(g,m){return function(E){var y=m.get(E),S=y===void 0?E.size:y<a?y+1:0;if(!E.has(S))return g(E,S);if(E.size<o){for(;E.has(S);)S=Math.floor(Math.random()*a);return g(E,S)}if(E.size>s)throw new Error("Congratulations, you created a collection of unique numbers which uses all available integers!");for(;E.has(S);)S=Math.floor(Math.random()*s);return g(E,S)}},c=new WeakMap,h=i(c),d=l(h,c),p=r(d);t.addUniqueNumber=p,t.generateUniqueNumber=d})}),iq=$e((n,e)=>{Oe(),Ne(),Le();function t(i,s,o,a,l,c,h){try{var d=i[c](h),p=d.value}catch(g){return void o(g)}d.done?s(p):Promise.resolve(p).then(a,l)}function r(i){return function(){var s=this,o=arguments;return new Promise(function(a,l){var c=i.apply(s,o);function h(p){t(c,a,l,h,d,"next",p)}function d(p){t(c,a,l,h,d,"throw",p)}h(void 0)})}}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports}),w3=$e((n,e)=>{Oe(),Ne(),Le();function t(r,i){this.v=r,this.k=i}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports}),v3=$e((n,e)=>{Oe(),Ne(),Le();function t(r,i,s,o){var a=Object.defineProperty;try{a({},"",{})}catch{a=0}e.exports=t=function(l,c,h,d){function p(g,m){t(l,g,function(E){return this._invoke(g,m,E)})}c?a?a(l,c,{value:h,enumerable:!d,configurable:!d,writable:!d}):l[c]=h:(p("next",0),p("throw",1),p("return",2))},e.exports.__esModule=!0,e.exports.default=e.exports,t(r,i,s,o)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports}),_3=$e((n,e)=>{Oe(),Ne(),Le();var t=v3();function r(){var i,s,o=typeof Symbol=="function"?Symbol:{},a=o.iterator||"@@iterator",l=o.toStringTag||"@@toStringTag";function c(S,b,_,I){var x=b&&b.prototype instanceof d?b:d,$=Object.create(x.prototype);return t($,"_invoke",function(U,O,P){var M,K,C,B=0,N=P||[],L=!1,V={p:0,n:0,v:i,a:W,f:W.bind(i,4),d:function(H,G){return M=H,K=0,C=i,V.n=G,h}};function W(H,G){for(K=H,C=G,s=0;!L&&B&&!z&&s<N.length;s++){var z,Z=N[s],F=V.p,ie=Z[2];H>3?(z=ie===G)&&(C=Z[(K=Z[4])?5:(K=3,3)],Z[4]=Z[5]=i):Z[0]<=F&&((z=H<2&&F<Z[1])?(K=0,V.v=G,V.n=Z[1]):F<ie&&(z=H<3||Z[0]>G||G>ie)&&(Z[4]=H,Z[5]=G,V.n=ie,K=0))}if(z||H>1)return h;throw L=!0,G}return function(H,G,z){if(B>1)throw TypeError("Generator is already running");for(L&&G===1&&W(G,z),K=G,C=z;(s=K<2?i:C)||!L;){M||(K?K<3?(K>1&&(V.n=-1),W(K,C)):V.n=C:V.v=C);try{if(B=2,M){if(K||(H="next"),s=M[H]){if(!(s=s.call(M,C)))throw TypeError("iterator result is not an object");if(!s.done)return s;C=s.value,K<2&&(K=0)}else K===1&&(s=M.return)&&s.call(M),K<2&&(C=TypeError("The iterator does not provide a '"+H+"' method"),K=1);M=i}else if((s=(L=V.n<0)?C:U.call(O,V))!==h)break}catch(Z){M=i,K=1,C=Z}finally{B=1}}return{value:s,done:L}}}(S,_,I),!0),$}var h={};function d(){}function p(){}function g(){}s=Object.getPrototypeOf;var m=[][a]?s(s([][a]())):(t(s={},a,function(){return this}),s),E=g.prototype=d.prototype=Object.create(m);function y(S){return Object.setPrototypeOf?Object.setPrototypeOf(S,g):(S.__proto__=g,t(S,l,"GeneratorFunction")),S.prototype=Object.create(E),S}return p.prototype=g,t(E,"constructor",g),t(g,"constructor",p),p.displayName="GeneratorFunction",t(g,l,"GeneratorFunction"),t(E),t(E,l,"Generator"),t(E,a,function(){return this}),t(E,"toString",function(){return"[object Generator]"}),(e.exports=r=function(){return{w:c,m:y}},e.exports.__esModule=!0,e.exports.default=e.exports)()}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports}),E3=$e((n,e)=>{Oe(),Ne(),Le();var t=w3(),r=v3();function i(s,o){function a(c,h,d,p){try{var g=s[c](h),m=g.value;return m instanceof t?o.resolve(m.v).then(function(E){a("next",E,d,p)},function(E){a("throw",E,d,p)}):o.resolve(m).then(function(E){g.value=E,d(g)},function(E){return a("throw",E,d,p)})}catch(E){p(E)}}var l;this.next||(r(i.prototype),r(i.prototype,typeof Symbol=="function"&&Symbol.asyncIterator||"@asyncIterator",function(){return this})),r(this,"_invoke",function(c,h,d){function p(){return new o(function(g,m){a(c,d,g,m)})}return l=l?l.then(p,p):p()},!0)}e.exports=i,e.exports.__esModule=!0,e.exports.default=e.exports}),S3=$e((n,e)=>{Oe(),Ne(),Le();var t=_3(),r=E3();function i(s,o,a,l,c){return new r(t().w(s,o,a,l),c||Promise)}e.exports=i,e.exports.__esModule=!0,e.exports.default=e.exports}),sq=$e((n,e)=>{Oe(),Ne(),Le();var t=S3();function r(i,s,o,a,l){var c=t(i,s,o,a,l);return c.next().then(function(h){return h.done?h.value:c.next()})}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports}),oq=$e((n,e)=>{Oe(),Ne(),Le();function t(r){var i=Object(r),s=[];for(var o in i)s.unshift(o);return function a(){for(;s.length;)if((o=s.pop())in i)return a.value=o,a.done=!1,a;return a.done=!0,a}}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports}),aq=$e((n,e)=>{Oe(),Ne(),Le();var t=Ty().default;function r(i){if(i!=null){var s=i[typeof Symbol=="function"&&Symbol.iterator||"@@iterator"],o=0;if(s)return s.call(i);if(typeof i.next=="function")return i;if(!isNaN(i.length))return{next:function(){return i&&o>=i.length&&(i=void 0),{value:i&&i[o++],done:!i}}}}throw new TypeError(t(i)+" is not iterable")}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports}),lq=$e((n,e)=>{Oe(),Ne(),Le();var t=w3(),r=_3(),i=sq(),s=S3(),o=E3(),a=oq(),l=aq();function c(){var h=r(),d=h.m(c),p=(Object.getPrototypeOf?Object.getPrototypeOf(d):d.__proto__).constructor;function g(y){var S=typeof y=="function"&&y.constructor;return!!S&&(S===p||(S.displayName||S.name)==="GeneratorFunction")}var m={throw:1,return:2,break:3,continue:3};function E(y){var S,b;return function(_){S||(S={stop:function(){return b(_.a,2)},catch:function(){return _.v},abrupt:function(I,x){return b(_.a,m[I],x)},delegateYield:function(I,x,$){return S.resultName=x,b(_.d,l(I),$)},finish:function(I){return b(_.f,I)}},b=function(I,x,$){_.p=S.prev,_.n=S.next;try{return I(x,$)}finally{S.next=_.n}}),S.resultName&&(S[S.resultName]=_.v,S.resultName=void 0),S.sent=_.v,S.next=_.n;try{return y.call(this,S)}finally{_.p=S.prev,_.n=S.next}}}return(e.exports=c=function(){return{wrap:function(y,S,b,_){return h.w(E(y),S,b,_&&_.reverse())},isGeneratorFunction:g,mark:h.m,awrap:function(y,S){return new t(y,S)},AsyncIterator:o,async:function(y,S,b,_,I){return(g(S)?s:i)(E(y),S,b,_,I)},keys:a,values:l}},e.exports.__esModule=!0,e.exports.default=e.exports)()}e.exports=c,e.exports.__esModule=!0,e.exports.default=e.exports}),cq=$e((n,e)=>{Oe(),Ne(),Le();var t=lq()();e.exports=t;try{regeneratorRuntime=t}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=t:Function("r","regeneratorRuntime = r")(t)}}),uq=$e((n,e)=>{Oe(),Ne(),Le(),function(t,r){typeof n=="object"&&typeof e<"u"?r(n,Zj(),nq(),b3(),iq(),cq()):typeof define=="function"&&define.amd?define(["exports","@babel/runtime/helpers/defineProperty","@babel/runtime/helpers/slicedToArray","fast-unique-numbers","@babel/runtime/helpers/asyncToGenerator","@babel/runtime/regenerator"],r):(t=typeof globalThis<"u"?globalThis:t||self,r(t.brokerFactory={},t._defineProperty,t._slicedToArray,t.fastUniqueNumbers,t._asyncToGenerator,t._regeneratorRuntime))}(n,function(t,r,i,s,o,a){var l=function(b){return typeof b.start=="function"},c=new WeakMap;function h(b,_){var I=Object.keys(b);if(Object.getOwnPropertySymbols){var x=Object.getOwnPropertySymbols(b);_&&(x=x.filter(function($){return Object.getOwnPropertyDescriptor(b,$).enumerable})),I.push.apply(I,x)}return I}function d(b){for(var _=1;_<arguments.length;_++){var I=arguments[_]!=null?arguments[_]:{};_%2?h(Object(I),!0).forEach(function(x){r(b,x,I[x])}):Object.getOwnPropertyDescriptors?Object.defineProperties(b,Object.getOwnPropertyDescriptors(I)):h(Object(I)).forEach(function(x){Object.defineProperty(b,x,Object.getOwnPropertyDescriptor(I,x))})}return b}var p=function(b){return d(d({},b),{},{connect:function(_){var I=_.call;return o(a.mark(function x(){var $,U,O,P;return a.wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return $=new MessageChannel,U=$.port1,O=$.port2,M.next=1,I("connect",{port:U},[U]);case 1:return P=M.sent,c.set(O,P),M.abrupt("return",O);case 2:case"end":return M.stop()}},x)}))},disconnect:function(_){var I=_.call;return function(){var x=o(a.mark(function $(U){var O;return a.wrap(function(P){for(;;)switch(P.prev=P.next){case 0:if(O=c.get(U),O!==void 0){P.next=1;break}throw new Error("The given port is not connected.");case 1:return P.next=2,I("disconnect",{portId:O});case 2:case"end":return P.stop()}},$)}));return function($){return x.apply(this,arguments)}}()},isSupported:function(_){var I=_.call;return function(){return I("isSupported")}}})};function g(b,_){var I=Object.keys(b);if(Object.getOwnPropertySymbols){var x=Object.getOwnPropertySymbols(b);_&&(x=x.filter(function($){return Object.getOwnPropertyDescriptor(b,$).enumerable})),I.push.apply(I,x)}return I}function m(b){for(var _=1;_<arguments.length;_++){var I=arguments[_]!=null?arguments[_]:{};_%2?g(Object(I),!0).forEach(function(x){r(b,x,I[x])}):Object.getOwnPropertyDescriptors?Object.defineProperties(b,Object.getOwnPropertyDescriptors(I)):g(Object(I)).forEach(function(x){Object.defineProperty(b,x,Object.getOwnPropertyDescriptor(I,x))})}return b}var E=new WeakMap,y=function(b){if(E.has(b))return E.get(b);var _=new Map;return E.set(b,_),_},S=function(b){var _=p(b);return function(I){var x=y(I);I.addEventListener("message",function(N){var L=N.data,V=L.id;if(V!==null&&x.has(V)){var W=x.get(V),H=W.reject,G=W.resolve;x.delete(V),L.error===void 0?G(L.result):H(new Error(L.error.message))}}),l(I)&&I.start();for(var $=function(N){var L=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,V=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[];return new Promise(function(W,H){var G=s.generateUniqueNumber(x);x.set(G,{reject:H,resolve:W}),L===null?I.postMessage({id:G,method:N},V):I.postMessage({id:G,method:N,params:L},V)})},U=function(N,L){var V=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[];I.postMessage({id:null,method:N,params:L},V)},O={},P=0,M=Object.entries(_);P<M.length;P++){var K=i(M[P],2),C=K[0],B=K[1];O=m(m({},O),{},r({},C,B({call:$,notify:U})))}return m({},O)}};t.createBroker=S})}),hq=$e((n,e)=>{Oe(),Ne(),Le(),function(t,r){typeof n=="object"&&typeof e<"u"?r(n,Ty(),uq(),b3()):typeof define=="function"&&define.amd?define(["exports","@babel/runtime/helpers/typeof","broker-factory","fast-unique-numbers"],r):(t=typeof globalThis<"u"?globalThis:t||self,r(t.workerTimersBroker={},t._typeof,t.brokerFactory,t.fastUniqueNumbers))}(n,function(t,r,i,s){var o=new Map([[0,null]]),a=new Map([[0,null]]),l=i.createBroker({clearInterval:function(h){var d=h.call;return function(p){r(o.get(p))==="symbol"&&(o.set(p,null),d("clear",{timerId:p,timerType:"interval"}).then(function(){o.delete(p)}))}},clearTimeout:function(h){var d=h.call;return function(p){r(a.get(p))==="symbol"&&(a.set(p,null),d("clear",{timerId:p,timerType:"timeout"}).then(function(){a.delete(p)}))}},setInterval:function(h){var d=h.call;return function(p){for(var g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,m=arguments.length,E=new Array(m>2?m-2:0),y=2;y<m;y++)E[y-2]=arguments[y];var S=Symbol(),b=s.generateUniqueNumber(o);o.set(b,S);var _=function(){return d("set",{delay:g,now:performance.timeOrigin+performance.now(),timerId:b,timerType:"interval"}).then(function(){var I=o.get(b);if(I===void 0)throw new Error("The timer is in an undefined state.");I===S&&(p.apply(void 0,E),o.get(b)===S&&_())})};return _(),b}},setTimeout:function(h){var d=h.call;return function(p){for(var g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,m=arguments.length,E=new Array(m>2?m-2:0),y=2;y<m;y++)E[y-2]=arguments[y];var S=Symbol(),b=s.generateUniqueNumber(a);return a.set(b,S),d("set",{delay:g,now:performance.timeOrigin+performance.now(),timerId:b,timerType:"timeout"}).then(function(){var _=a.get(b);if(_===void 0)throw new Error("The timer is in an undefined state.");_===S&&(a.delete(b),p.apply(void 0,E))}),b}}}),c=function(h){var d=new Worker(h);return l(d)};t.load=c,t.wrap=l})}),fq=$e((n,e)=>{Oe(),Ne(),Le(),function(t,r){typeof n=="object"&&typeof e<"u"?r(n,hq()):typeof define=="function"&&define.amd?define(["exports","worker-timers-broker"],r):(t=typeof globalThis<"u"?globalThis:t||self,r(t.workerTimers={},t.workerTimersBroker))}(n,function(t,r){var i=function(d,p){var g=null;return function(){if(g!==null)return g;var m=new Blob([p],{type:"application/javascript; charset=utf-8"}),E=URL.createObjectURL(m);return g=d(E),setTimeout(function(){return URL.revokeObjectURL(E)}),g}},s=`(()=>{var e={45:(e,t,r)=>{var n=r(738).default;e.exports=function(e,t){if("object"!=n(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,t||"default");if("object"!=n(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)},e.exports.__esModule=!0,e.exports.default=e.exports},79:e=>{e.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n},e.exports.__esModule=!0,e.exports.default=e.exports},122:(e,t,r)=>{var n=r(79);e.exports=function(e,t){if(e){if("string"==typeof e)return n(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(e,t):void 0}},e.exports.__esModule=!0,e.exports.default=e.exports},156:e=>{e.exports=function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,u,a,i=[],s=!0,c=!1;try{if(u=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;s=!1}else for(;!(s=(n=u.call(r)).done)&&(i.push(n.value),i.length!==t);s=!0);}catch(e){c=!0,o=e}finally{try{if(!s&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw o}}return i}},e.exports.__esModule=!0,e.exports.default=e.exports},172:e=>{e.exports=function(e,t){this.v=e,this.k=t},e.exports.__esModule=!0,e.exports.default=e.exports},293:e=>{function t(e,t,r,n,o,u,a){try{var i=e[u](a),s=i.value}catch(e){return void r(e)}i.done?t(s):Promise.resolve(s).then(n,o)}e.exports=function(e){return function(){var r=this,n=arguments;return new Promise((function(o,u){var a=e.apply(r,n);function i(e){t(a,o,u,i,s,"next",e)}function s(e){t(a,o,u,i,s,"throw",e)}i(void 0)}))}},e.exports.__esModule=!0,e.exports.default=e.exports},373:e=>{e.exports=function(e){var t=Object(e),r=[];for(var n in t)r.unshift(n);return function e(){for(;r.length;)if((n=r.pop())in t)return e.value=n,e.done=!1,e;return e.done=!0,e}},e.exports.__esModule=!0,e.exports.default=e.exports},389:function(e,t){!function(e){"use strict";var t=function(e){return function(t){var r=e(t);return t.add(r),r}},r=function(e){return function(t,r){return e.set(t,r),r}},n=void 0===Number.MAX_SAFE_INTEGER?9007199254740991:Number.MAX_SAFE_INTEGER,o=536870912,u=2*o,a=function(e,t){return function(r){var a=t.get(r),i=void 0===a?r.size:a<u?a+1:0;if(!r.has(i))return e(r,i);if(r.size<o){for(;r.has(i);)i=Math.floor(Math.random()*u);return e(r,i)}if(r.size>n)throw new Error("Congratulations, you created a collection of unique numbers which uses all available integers!");for(;r.has(i);)i=Math.floor(Math.random()*n);return e(r,i)}},i=new WeakMap,s=r(i),c=a(s,i),f=t(c);e.addUniqueNumber=f,e.generateUniqueNumber=c}(t)},472:function(e,t,r){!function(e,t,r,n){"use strict";var o=function(e,t){return function(r){var o=t.get(r);if(void 0===o)return Promise.resolve(!1);var u=n(o,2),a=u[0],i=u[1];return e(a),t.delete(r),i(!1),Promise.resolve(!0)}},u=function(e,t){var r=function(n,o,u,a){var i=n-e.now();i>0?o.set(a,[t(r,i,n,o,u,a),u]):(o.delete(a),u(!0))};return r},a=function(e,t,r,n){return function(o,u,a){var i=o+u-t.timeOrigin,s=i-t.now();return new Promise((function(t){e.set(a,[r(n,s,i,e,t,a),t])}))}},i=new Map,s=o(globalThis.clearTimeout,i),c=new Map,f=o(globalThis.clearTimeout,c),l=u(performance,globalThis.setTimeout),p=a(i,performance,globalThis.setTimeout,l),d=a(c,performance,globalThis.setTimeout,l);r.createWorker(self,{clear:function(){var r=e(t.mark((function e(r){var n,o,u;return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.timerId,o=r.timerType,e.next=1,"interval"===o?s(n):f(n);case 1:return u=e.sent,e.abrupt("return",{result:u});case 2:case"end":return e.stop()}}),e)})));function n(e){return r.apply(this,arguments)}return n}(),set:function(){var r=e(t.mark((function e(r){var n,o,u,a,i;return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.delay,o=r.now,u=r.timerId,a=r.timerType,e.next=1,("interval"===a?p:d)(n,o,u);case 1:return i=e.sent,e.abrupt("return",{result:i});case 2:case"end":return e.stop()}}),e)})));function n(e){return r.apply(this,arguments)}return n}()})}(r(293),r(756),r(623),r(715))},546:e=>{function t(r,n,o,u){var a=Object.defineProperty;try{a({},"",{})}catch(r){a=0}e.exports=t=function(e,r,n,o){if(r)a?a(e,r,{value:n,enumerable:!o,configurable:!o,writable:!o}):e[r]=n;else{var u=function(r,n){t(e,r,(function(e){return this._invoke(r,n,e)}))};u("next",0),u("throw",1),u("return",2)}},e.exports.__esModule=!0,e.exports.default=e.exports,t(r,n,o,u)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},579:(e,t,r)=>{var n=r(738).default;e.exports=function(e){if(null!=e){var t=e["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],r=0;if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length))return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}}throw new TypeError(n(e)+" is not iterable")},e.exports.__esModule=!0,e.exports.default=e.exports},623:function(e,t,r){!function(e,t,r,n,o){"use strict";var u={INTERNAL_ERROR:-32603,INVALID_PARAMS:-32602,METHOD_NOT_FOUND:-32601},a=function(e,t){return Object.assign(new Error(e),{status:t})},i=function(e){return a('The requested method called "'.concat(e,'" is not supported.'),u.METHOD_NOT_FOUND)},s=function(e){return a('The handler of the method called "'.concat(e,'" returned no required result.'),u.INTERNAL_ERROR)},c=function(e){return a('The handler of the method called "'.concat(e,'" returned an unexpected result.'),u.INTERNAL_ERROR)},f=function(e){return a('The specified parameter called "portId" with the given value "'.concat(e,'" does not identify a port connected to this worker.'),u.INVALID_PARAMS)},l=function(e,n){return function(){var o=t(r.mark((function t(o){var u,a,f,l,p,d,v,x,y,b,h,m,_,g,w;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(u=o.data,a=u.id,f=u.method,l=u.params,p=n[f],t.prev=1,void 0!==p){t.next=2;break}throw i(f);case 2:if(void 0!==(d=void 0===l?p():p(l))){t.next=3;break}throw s(f);case 3:if(!(d instanceof Promise)){t.next=5;break}return t.next=4,d;case 4:g=t.sent,t.next=6;break;case 5:g=d;case 6:if(v=g,null!==a){t.next=8;break}if(void 0===v.result){t.next=7;break}throw c(f);case 7:t.next=10;break;case 8:if(void 0!==v.result){t.next=9;break}throw c(f);case 9:x=v.result,y=v.transferables,b=void 0===y?[]:y,e.postMessage({id:a,result:x},b);case 10:t.next=12;break;case 11:t.prev=11,w=t.catch(1),h=w.message,m=w.status,_=void 0===m?-32603:m,e.postMessage({error:{code:_,message:h},id:a});case 12:case"end":return t.stop()}}),t,null,[[1,11]])})));return function(e){return o.apply(this,arguments)}}()},p=function(){return new Promise((function(e){var t=new ArrayBuffer(0),r=new MessageChannel,n=r.port1,o=r.port2;n.onmessage=function(t){var r=t.data;return e(null!==r)},o.postMessage(t,[t])}))};function d(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function v(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?d(Object(r),!0).forEach((function(t){n(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var x=new Map,y=function(e,n,u){return v(v({},n),{},{connect:function(t){var r=t.port;r.start();var u=e(r,n),a=o.generateUniqueNumber(x);return x.set(a,(function(){u(),r.close(),x.delete(a)})),{result:a}},disconnect:function(e){var t=e.portId,r=x.get(t);if(void 0===r)throw f(t);return r(),{result:null}},isSupported:function(){var e=t(r.mark((function e(){var t,n,o;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,p();case 1:if(!e.sent){e.next=5;break}if(!((t=u())instanceof Promise)){e.next=3;break}return e.next=2,t;case 2:o=e.sent,e.next=4;break;case 3:o=t;case 4:return n=o,e.abrupt("return",{result:n});case 5:return e.abrupt("return",{result:!1});case 6:case"end":return e.stop()}}),e)})));function n(){return e.apply(this,arguments)}return n}()})},b=function(e,t){var r=y(b,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){return!0}),n=l(e,r);return e.addEventListener("message",n),function(){return e.removeEventListener("message",n)}};e.createWorker=b,e.isSupported=p}(t,r(293),r(756),r(693),r(389))},633:(e,t,r)=>{var n=r(172),o=r(993),u=r(869),a=r(887),i=r(791),s=r(373),c=r(579);function f(){"use strict";var t=o(),r=t.m(f),l=(Object.getPrototypeOf?Object.getPrototypeOf(r):r.__proto__).constructor;function p(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===l||"GeneratorFunction"===(t.displayName||t.name))}var d={throw:1,return:2,break:3,continue:3};function v(e){var t,r;return function(n){t||(t={stop:function(){return r(n.a,2)},catch:function(){return n.v},abrupt:function(e,t){return r(n.a,d[e],t)},delegateYield:function(e,o,u){return t.resultName=o,r(n.d,c(e),u)},finish:function(e){return r(n.f,e)}},r=function(e,r,o){n.p=t.prev,n.n=t.next;try{return e(r,o)}finally{t.next=n.n}}),t.resultName&&(t[t.resultName]=n.v,t.resultName=void 0),t.sent=n.v,t.next=n.n;try{return e.call(this,t)}finally{n.p=t.prev,n.n=t.next}}}return(e.exports=f=function(){return{wrap:function(e,r,n,o){return t.w(v(e),r,n,o&&o.reverse())},isGeneratorFunction:p,mark:t.m,awrap:function(e,t){return new n(e,t)},AsyncIterator:i,async:function(e,t,r,n,o){return(p(t)?a:u)(v(e),t,r,n,o)},keys:s,values:c}},e.exports.__esModule=!0,e.exports.default=e.exports)()}e.exports=f,e.exports.__esModule=!0,e.exports.default=e.exports},693:(e,t,r)=>{var n=r(736);e.exports=function(e,t,r){return(t=n(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e},e.exports.__esModule=!0,e.exports.default=e.exports},715:(e,t,r)=>{var n=r(987),o=r(156),u=r(122),a=r(752);e.exports=function(e,t){return n(e)||o(e,t)||u(e,t)||a()},e.exports.__esModule=!0,e.exports.default=e.exports},736:(e,t,r)=>{var n=r(738).default,o=r(45);e.exports=function(e){var t=o(e,"string");return"symbol"==n(t)?t:t+""},e.exports.__esModule=!0,e.exports.default=e.exports},738:e=>{function t(r){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(r)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},752:e=>{e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.__esModule=!0,e.exports.default=e.exports},756:(e,t,r)=>{var n=r(633)();e.exports=n;try{regeneratorRuntime=n}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=n:Function("r","regeneratorRuntime = r")(n)}},791:(e,t,r)=>{var n=r(172),o=r(546);e.exports=function e(t,r){function u(e,o,a,i){try{var s=t[e](o),c=s.value;return c instanceof n?r.resolve(c.v).then((function(e){u("next",e,a,i)}),(function(e){u("throw",e,a,i)})):r.resolve(c).then((function(e){s.value=e,a(s)}),(function(e){return u("throw",e,a,i)}))}catch(e){i(e)}}var a;this.next||(o(e.prototype),o(e.prototype,"function"==typeof Symbol&&Symbol.asyncIterator||"@asyncIterator",(function(){return this}))),o(this,"_invoke",(function(e,t,n){function o(){return new r((function(t,r){u(e,n,t,r)}))}return a=a?a.then(o,o):o()}),!0)},e.exports.__esModule=!0,e.exports.default=e.exports},869:(e,t,r)=>{var n=r(887);e.exports=function(e,t,r,o,u){var a=n(e,t,r,o,u);return a.next().then((function(e){return e.done?e.value:a.next()}))},e.exports.__esModule=!0,e.exports.default=e.exports},887:(e,t,r)=>{var n=r(993),o=r(791);e.exports=function(e,t,r,u,a){return new o(n().w(e,t,r,u),a||Promise)},e.exports.__esModule=!0,e.exports.default=e.exports},987:e=>{e.exports=function(e){if(Array.isArray(e))return e},e.exports.__esModule=!0,e.exports.default=e.exports},993:(e,t,r)=>{var n=r(546);function o(){var t,r,u="function"==typeof Symbol?Symbol:{},a=u.iterator||"@@iterator",i=u.toStringTag||"@@toStringTag";function s(e,o,u,a){var i=o&&o.prototype instanceof f?o:f,s=Object.create(i.prototype);return n(s,"_invoke",function(e,n,o){var u,a,i,s=0,f=o||[],l=!1,p={p:0,n:0,v:t,a:d,f:d.bind(t,4),d:function(e,r){return u=e,a=0,i=t,p.n=r,c}};function d(e,n){for(a=e,i=n,r=0;!l&&s&&!o&&r<f.length;r++){var o,u=f[r],d=p.p,v=u[2];e>3?(o=v===n)&&(i=u[(a=u[4])?5:(a=3,3)],u[4]=u[5]=t):u[0]<=d&&((o=e<2&&d<u[1])?(a=0,p.v=n,p.n=u[1]):d<v&&(o=e<3||u[0]>n||n>v)&&(u[4]=e,u[5]=n,p.n=v,a=0))}if(o||e>1)return c;throw l=!0,n}return function(o,f,v){if(s>1)throw TypeError("Generator is already running");for(l&&1===f&&d(f,v),a=f,i=v;(r=a<2?t:i)||!l;){u||(a?a<3?(a>1&&(p.n=-1),d(a,i)):p.n=i:p.v=i);try{if(s=2,u){if(a||(o="next"),r=u[o]){if(!(r=r.call(u,i)))throw TypeError("iterator result is not an object");if(!r.done)return r;i=r.value,a<2&&(a=0)}else 1===a&&(r=u.return)&&r.call(u),a<2&&(i=TypeError("The iterator does not provide a '"+o+"' method"),a=1);u=t}else if((r=(l=p.n<0)?i:e.call(n,p))!==c)break}catch(e){u=t,a=1,i=e}finally{s=1}}return{value:r,done:l}}}(e,u,a),!0),s}var c={};function f(){}function l(){}function p(){}r=Object.getPrototypeOf;var d=[][a]?r(r([][a]())):(n(r={},a,(function(){return this})),r),v=p.prototype=f.prototype=Object.create(d);function x(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,n(e,i,"GeneratorFunction")),e.prototype=Object.create(v),e}return l.prototype=p,n(v,"constructor",p),n(p,"constructor",l),l.displayName="GeneratorFunction",n(p,i,"GeneratorFunction"),n(v),n(v,i,"Generator"),n(v,a,(function(){return this})),n(v,"toString",(function(){return"[object Generator]"})),(e.exports=o=function(){return{w:s,m:x}},e.exports.__esModule=!0,e.exports.default=e.exports)()}e.exports=o,e.exports.__esModule=!0,e.exports.default=e.exports}},t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var u=t[n]={exports:{}};return e[n].call(u.exports,u,u.exports,r),u.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";r(472)})()})();`,o=i(r.load,s),a=function(d){return o().clearInterval(d)},l=function(d){return o().clearTimeout(d)},c=function(){var d;return(d=o()).setInterval.apply(d,arguments)},h=function(){var d;return(d=o()).setTimeout.apply(d,arguments)};t.clearInterval=a,t.clearTimeout=l,t.setInterval=c,t.setTimeout=h})}),Cy=$e(n=>{Oe(),Ne(),Le(),Object.defineProperty(n,"__esModule",{value:!0}),n.isReactNativeBrowser=n.isWebWorker=void 0;var e=()=>{var s;return typeof window<"u"?typeof navigator<"u"&&((s=navigator.userAgent)==null?void 0:s.toLowerCase().indexOf(" electron/"))>-1&&(Ut!=null&&Ut.versions)?!Object.prototype.hasOwnProperty.call(Ut.versions,"electron"):typeof window.document<"u":!1},t=()=>{var s,o;return!!(typeof self=="object"&&((o=(s=self==null?void 0:self.constructor)==null?void 0:s.name)!=null&&o.includes("WorkerGlobalScope"))&&typeof Deno>"u")},r=()=>typeof navigator<"u"&&navigator.product==="ReactNative",i=e()||t()||r();n.isWebWorker=t(),n.isReactNativeBrowser=r(),n.default=i}),dq=$e(n=>{Oe(),Ne(),Le();var e=n&&n.__createBinding||(Object.create?function(c,h,d,p){p===void 0&&(p=d);var g=Object.getOwnPropertyDescriptor(h,d);(!g||("get"in g?!h.__esModule:g.writable||g.configurable))&&(g={enumerable:!0,get:function(){return h[d]}}),Object.defineProperty(c,p,g)}:function(c,h,d,p){p===void 0&&(p=d),c[p]=h[d]}),t=n&&n.__setModuleDefault||(Object.create?function(c,h){Object.defineProperty(c,"default",{enumerable:!0,value:h})}:function(c,h){c.default=h}),r=n&&n.__importStar||function(){var c=function(h){return c=Object.getOwnPropertyNames||function(d){var p=[];for(var g in d)Object.prototype.hasOwnProperty.call(d,g)&&(p[p.length]=g);return p},c(h)};return function(h){if(h&&h.__esModule)return h;var d={};if(h!=null)for(var p=c(h),g=0;g<p.length;g++)p[g]!=="default"&&e(d,h,p[g]);return t(d,h),d}}();Object.defineProperty(n,"__esModule",{value:!0});var i=fq(),s=r(Cy()),o={set:i.setInterval,clear:i.clearInterval},a={set:(c,h)=>setInterval(c,h),clear:c=>clearInterval(c)},l=c=>{switch(c){case"native":return a;case"worker":return o;case"auto":default:return s.default&&!s.isWebWorker&&!s.isReactNativeBrowser?o:a}};n.default=l}),A3=$e(n=>{Oe(),Ne(),Le();var e=n&&n.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(n,"__esModule",{value:!0});var t=e(dq()),r=class{constructor(i,s){v(this,"_keepalive");v(this,"timerId");v(this,"timer");v(this,"destroyed",!1);v(this,"counter");v(this,"client");v(this,"_keepaliveTimeoutTimestamp");v(this,"_intervalEvery");this.client=i,this.timer=typeof s=="object"&&"set"in s&&"clear"in s?s:(0,t.default)(s),this.setKeepalive(i.options.keepalive)}get keepaliveTimeoutTimestamp(){return this._keepaliveTimeoutTimestamp}get intervalEvery(){return this._intervalEvery}get keepalive(){return this._keepalive}clear(){this.timerId&&(this.timer.clear(this.timerId),this.timerId=null)}setKeepalive(i){if(i*=1e3,isNaN(i)||i<=0||i>2147483647)throw new Error(`Keepalive value must be an integer between 0 and 2147483647. Provided value is ${i}`);this._keepalive=i,this.reschedule(),this.client.log(`KeepaliveManager: set keepalive to ${i}ms`)}destroy(){this.clear(),this.destroyed=!0}reschedule(){if(this.destroyed)return;this.clear(),this.counter=0;let i=Math.ceil(this._keepalive*1.5);this._keepaliveTimeoutTimestamp=Date.now()+i,this._intervalEvery=Math.ceil(this._keepalive/2),this.timerId=this.timer.set(()=>{this.destroyed||(this.counter+=1,this.counter===2?this.client.sendPing():this.counter>2&&this.client.onKeepaliveTimeout())},this._intervalEvery)}};n.default=r}),I_=$e(n=>{var x;Oe(),Ne(),Le();var e=n&&n.__createBinding||(Object.create?function($,U,O,P){P===void 0&&(P=O);var M=Object.getOwnPropertyDescriptor(U,O);(!M||("get"in M?!U.__esModule:M.writable||M.configurable))&&(M={enumerable:!0,get:function(){return U[O]}}),Object.defineProperty($,P,M)}:function($,U,O,P){P===void 0&&(P=O),$[P]=U[O]}),t=n&&n.__setModuleDefault||(Object.create?function($,U){Object.defineProperty($,"default",{enumerable:!0,value:U})}:function($,U){$.default=U}),r=n&&n.__importStar||function(){var $=function(U){return $=Object.getOwnPropertyNames||function(O){var P=[];for(var M in O)Object.prototype.hasOwnProperty.call(O,M)&&(P[P.length]=M);return P},$(U)};return function(U){if(U&&U.__esModule)return U;var O={};if(U!=null)for(var P=$(U),M=0;M<P.length;M++)P[M]!=="default"&&e(O,U,P[M]);return t(O,U),O}}(),i=n&&n.__importDefault||function($){return $&&$.__esModule?$:{default:$}};Object.defineProperty(n,"__esModule",{value:!0});var s=i(Ej()),o=Gl(),a=i(Aj()),l=i(yo()),c=r(xj()),h=i(e3()),d=i(Kj()),p=i(y3()),g=i(Vj()),m=Hu(),E=Gj(),y=i(A3()),S=r(Cy()),b=globalThis.setImmediate||((...$)=>{let U=$.shift();(0,m.nextTick)(()=>{U(...$)})}),_={keepalive:60,reschedulePings:!0,protocolId:"MQTT",protocolVersion:4,reconnectPeriod:1e3,connectTimeout:30*1e3,clean:!0,resubscribe:!0,subscribeBatchSize:null,writeCache:!0,timerVariant:"auto"},I=(x=class extends E.TypedEventEmitter{constructor(O,P){super();v(this,"connected");v(this,"disconnecting");v(this,"disconnected");v(this,"reconnecting");v(this,"incomingStore");v(this,"outgoingStore");v(this,"options");v(this,"queueQoSZero");v(this,"_reconnectCount");v(this,"log");v(this,"messageIdProvider");v(this,"outgoing");v(this,"messageIdToTopic");v(this,"noop");v(this,"keepaliveManager");v(this,"stream");v(this,"queue");v(this,"streamBuilder");v(this,"_resubscribeTopics");v(this,"connackTimer");v(this,"reconnectTimer");v(this,"_storeProcessing");v(this,"_packetIdsDuringStoreProcessing");v(this,"_storeProcessingQueue");v(this,"_firstConnection");v(this,"topicAliasRecv");v(this,"topicAliasSend");v(this,"_deferredReconnect");v(this,"connackPacket");this.options=P||{};for(let M in _)typeof this.options[M]>"u"?this.options[M]=_[M]:this.options[M]=P[M];this.log=this.options.log||(0,l.default)("mqttjs:client"),this.noop=this._noop.bind(this),this.log("MqttClient :: version:",x.VERSION),S.isWebWorker?this.log("MqttClient :: environment","webworker"):this.log("MqttClient :: environment",S.default?"browser":"node"),this.log("MqttClient :: options.protocol",P.protocol),this.log("MqttClient :: options.protocolVersion",P.protocolVersion),this.log("MqttClient :: options.username",P.username),this.log("MqttClient :: options.keepalive",P.keepalive),this.log("MqttClient :: options.reconnectPeriod",P.reconnectPeriod),this.log("MqttClient :: options.rejectUnauthorized",P.rejectUnauthorized),this.log("MqttClient :: options.properties.topicAliasMaximum",P.properties?P.properties.topicAliasMaximum:void 0),this.options.clientId=typeof P.clientId=="string"?P.clientId:x.defaultId(),this.log("MqttClient :: clientId",this.options.clientId),this.options.customHandleAcks=P.protocolVersion===5&&P.customHandleAcks?P.customHandleAcks:(...M)=>{M[3](null,0)},this.options.writeCache||(s.default.writeToStream.cacheNumbers=!1),this.streamBuilder=O,this.messageIdProvider=typeof this.options.messageIdProvider>"u"?new p.default:this.options.messageIdProvider,this.outgoingStore=P.outgoingStore||new h.default,this.incomingStore=P.incomingStore||new h.default,this.queueQoSZero=P.queueQoSZero===void 0?!0:P.queueQoSZero,this._resubscribeTopics={},this.messageIdToTopic={},this.keepaliveManager=null,this.connected=!1,this.disconnecting=!1,this.reconnecting=!1,this.queue=[],this.connackTimer=null,this.reconnectTimer=null,this._storeProcessing=!1,this._packetIdsDuringStoreProcessing={},this._storeProcessingQueue=[],this.outgoing={},this._firstConnection=!0,P.properties&&P.properties.topicAliasMaximum>0&&(P.properties.topicAliasMaximum>65535?this.log("MqttClient :: options.properties.topicAliasMaximum is out of range"):this.topicAliasRecv=new g.default(P.properties.topicAliasMaximum)),this.on("connect",()=>{let{queue:M}=this,K=()=>{let C=M.shift();this.log("deliver :: entry %o",C);let B=null;if(!C){this._resubscribe();return}B=C.packet,this.log("deliver :: call _sendPacket for %o",B);let N=!0;B.messageId&&B.messageId!==0&&(this.messageIdProvider.register(B.messageId)||(N=!1)),N?this._sendPacket(B,L=>{C.cb&&C.cb(L),K()}):(this.log("messageId: %d has already used. The message is skipped and removed.",B.messageId),K())};this.log("connect :: sending queued packets"),K()}),this.on("close",()=>{this.log("close :: connected set to `false`"),this.connected=!1,this.log("close :: clearing connackTimer"),clearTimeout(this.connackTimer),this._destroyKeepaliveManager(),this.topicAliasRecv&&this.topicAliasRecv.clear(),this.log("close :: calling _setupReconnect"),this._setupReconnect()}),this.options.manualConnect||(this.log("MqttClient :: setting up stream"),this.connect())}static defaultId(){return`mqttjs_${Math.random().toString(16).substr(2,8)}`}handleAuth(O,P){P()}handleMessage(O,P){P()}_nextId(){return this.messageIdProvider.allocate()}getLastMessageId(){return this.messageIdProvider.getLastAllocated()}connect(){var V;let O=new o.Writable,P=s.default.parser(this.options),M=null,K=[];this.log("connect :: calling method to clear reconnect"),this._clearReconnect(),this.disconnected&&!this.reconnecting&&(this.incomingStore=this.options.incomingStore||new h.default,this.outgoingStore=this.options.outgoingStore||new h.default,this.disconnecting=!1,this.disconnected=!1),this.log("connect :: using streamBuilder provided to client to create stream"),this.stream=this.streamBuilder(this),P.on("packet",W=>{this.log("parser :: on packet push to packets array."),K.push(W)});let C=()=>{this.log("work :: getting next packet in queue");let W=K.shift();if(W)this.log("work :: packet pulled from queue"),(0,d.default)(this,W,B);else{this.log("work :: no packets in queue");let H=M;M=null,this.log("work :: done flag is %s",!!H),H&&H()}},B=()=>{if(K.length)(0,m.nextTick)(C);else{let W=M;M=null,W()}};O._write=(W,H,G)=>{M=G,this.log("writable stream :: parsing buffer"),P.parse(W),C()};let N=W=>{this.log("streamErrorHandler :: error",W.message),W.code?(this.log("streamErrorHandler :: emitting error"),this.emit("error",W)):this.noop(W)};this.log("connect :: pipe stream to writable stream"),this.stream.pipe(O),this.stream.on("error",N),this.stream.on("close",()=>{this.log("(%s)stream :: on close",this.options.clientId),this._flushVolatile(),this.log("stream: emit close to MqttClient"),this.emit("close")}),this.log("connect: sending packet `connect`");let L={cmd:"connect",protocolId:this.options.protocolId,protocolVersion:this.options.protocolVersion,clean:this.options.clean,clientId:this.options.clientId,keepalive:this.options.keepalive,username:this.options.username,password:this.options.password,properties:this.options.properties};if(this.options.will&&(L.will={...this.options.will,payload:(V=this.options.will)==null?void 0:V.payload}),this.topicAliasRecv&&(L.properties||(L.properties={}),this.topicAliasRecv&&(L.properties.topicAliasMaximum=this.topicAliasRecv.max)),this._writePacket(L),P.on("error",this.emit.bind(this,"error")),this.options.properties){if(!this.options.properties.authenticationMethod&&this.options.properties.authenticationData)return this.end(()=>this.emit("error",new Error("Packet has no Authentication Method"))),this;if(this.options.properties.authenticationMethod&&this.options.authPacket&&typeof this.options.authPacket=="object"){let W={cmd:"auth",reasonCode:0,...this.options.authPacket};this._writePacket(W)}}return this.stream.setMaxListeners(1e3),clearTimeout(this.connackTimer),this.connackTimer=setTimeout(()=>{this.log("!!connectTimeout hit!! Calling _cleanUp with force `true`"),this.emit("error",new Error("connack timeout")),this._cleanUp(!0)},this.options.connectTimeout),this}publish(O,P,M,K){this.log("publish :: message `%s` to topic `%s`",P,O);let{options:C}=this;typeof M=="function"&&(K=M,M=null),M=M||{},M={qos:0,retain:!1,dup:!1,...M};let{qos:B,retain:N,dup:L,properties:V,cbStorePut:W}=M;if(this._checkDisconnecting(K))return this;let H=()=>{let G=0;if((B===1||B===2)&&(G=this._nextId(),G===null))return this.log("No messageId left"),!1;let z={cmd:"publish",topic:O,payload:P,qos:B,retain:N,messageId:G,dup:L};switch(C.protocolVersion===5&&(z.properties=V),this.log("publish :: qos",B),B){case 1:case 2:this.outgoing[z.messageId]={volatile:!1,cb:K||this.noop},this.log("MqttClient:publish: packet cmd: %s",z.cmd),this._sendPacket(z,void 0,W);break;default:this.log("MqttClient:publish: packet cmd: %s",z.cmd),this._sendPacket(z,K,W);break}return!0};return(this._storeProcessing||this._storeProcessingQueue.length>0||!H())&&this._storeProcessingQueue.push({invoke:H,cbStorePut:M.cbStorePut,callback:K}),this}publishAsync(O,P,M){return new Promise((K,C)=>{this.publish(O,P,M,(B,N)=>{B?C(B):K(N)})})}subscribe(O,P,M){let K=this.options.protocolVersion;typeof P=="function"&&(M=P),M=M||this.noop;let C=!1,B=[];typeof O=="string"?(O=[O],B=O):Array.isArray(O)?B=O:typeof O=="object"&&(C=O.resubscribe,delete O.resubscribe,B=Object.keys(O));let N=c.validateTopics(B);if(N!==null)return b(M,new Error(`Invalid topic ${N}`)),this;if(this._checkDisconnecting(M))return this.log("subscribe: discconecting true"),this;let L={qos:0};K===5&&(L.nl=!1,L.rap=!1,L.rh=0),P={...L,...P};let{properties:V}=P,W=[],H=(Z,F)=>{if(F=F||P,!Object.prototype.hasOwnProperty.call(this._resubscribeTopics,Z)||this._resubscribeTopics[Z].qos<F.qos||C){let ie={topic:Z,qos:F.qos};K===5&&(ie.nl=F.nl,ie.rap=F.rap,ie.rh=F.rh,ie.properties=V),this.log("subscribe: pushing topic `%s` and qos `%s` to subs list",ie.topic,ie.qos),W.push(ie)}};if(Array.isArray(O)?O.forEach(Z=>{this.log("subscribe: array topic %s",Z),H(Z)}):Object.keys(O).forEach(Z=>{this.log("subscribe: object topic %s, %o",Z,O[Z]),H(Z,O[Z])}),!W.length)return M(null,[]),this;let G=(Z,F)=>{let ie={cmd:"subscribe",subscriptions:Z,messageId:F};if(V&&(ie.properties=V),this.options.resubscribe){this.log("subscribe :: resubscribe true");let J=[];Z.forEach(_e=>{if(this.options.reconnectPeriod>0){let oe={qos:_e.qos};K===5&&(oe.nl=_e.nl||!1,oe.rap=_e.rap||!1,oe.rh=_e.rh||0,oe.properties=_e.properties),this._resubscribeTopics[_e.topic]=oe,J.push(_e.topic)}}),this.messageIdToTopic[ie.messageId]=J}let fe=new Promise((J,_e)=>{this.outgoing[ie.messageId]={volatile:!0,cb(oe,ne){if(!oe){let{granted:de}=ne;for(let k=0;k<de.length;k+=1)Z[k].qos=de[k]}oe?_e(new m.ErrorWithSubackPacket(oe.message,ne)):J(ne)}}});return this.log("subscribe :: call _sendPacket"),this._sendPacket(ie),fe},z=()=>{let Z=this.options.subscribeBatchSize??W.length,F=[];for(let ie=0;ie<W.length;ie+=Z){let fe=W.slice(ie,ie+Z),J=this._nextId();if(J===null)return this.log("No messageId left"),!1;F.push(G(fe,J))}return Promise.all(F).then(ie=>{M(null,W,ie.at(-1))}).catch(ie=>{M(ie,W,ie.packet)}),!0};return(this._storeProcessing||this._storeProcessingQueue.length>0||!z())&&this._storeProcessingQueue.push({invoke:z,callback:M}),this}subscribeAsync(O,P){return new Promise((M,K)=>{this.subscribe(O,P,(C,B)=>{C?K(C):M(B)})})}unsubscribe(O,P,M){typeof O=="string"&&(O=[O]),typeof P=="function"&&(M=P),M=M||this.noop;let K=c.validateTopics(O);if(K!==null)return b(M,new Error(`Invalid topic ${K}`)),this;if(this._checkDisconnecting(M))return this;let C=()=>{let B=this._nextId();if(B===null)return this.log("No messageId left"),!1;let N={cmd:"unsubscribe",messageId:B,unsubscriptions:[]};return typeof O=="string"?N.unsubscriptions=[O]:Array.isArray(O)&&(N.unsubscriptions=O),this.options.resubscribe&&N.unsubscriptions.forEach(L=>{delete this._resubscribeTopics[L]}),typeof P=="object"&&P.properties&&(N.properties=P.properties),this.outgoing[N.messageId]={volatile:!0,cb:M},this.log("unsubscribe: call _sendPacket"),this._sendPacket(N),!0};return(this._storeProcessing||this._storeProcessingQueue.length>0||!C())&&this._storeProcessingQueue.push({invoke:C,callback:M}),this}unsubscribeAsync(O,P){return new Promise((M,K)=>{this.unsubscribe(O,P,(C,B)=>{C?K(C):M(B)})})}end(O,P,M){this.log("end :: (%s)",this.options.clientId),(O==null||typeof O!="boolean")&&(M=M||P,P=O,O=!1),typeof P!="object"&&(M=M||P,P=null),this.log("end :: cb? %s",!!M),(!M||typeof M!="function")&&(M=this.noop);let K=()=>{this.log("end :: closeStores: closing incoming and outgoing stores"),this.disconnected=!0,this.incomingStore.close(B=>{this.outgoingStore.close(N=>{if(this.log("end :: closeStores: emitting end"),this.emit("end"),M){let L=B||N;this.log("end :: closeStores: invoking callback with args"),M(L)}})}),this._deferredReconnect?this._deferredReconnect():(this.options.reconnectPeriod===0||this.options.manualConnect)&&(this.disconnecting=!1)},C=()=>{this.log("end :: (%s) :: finish :: calling _cleanUp with force %s",this.options.clientId,O),this._cleanUp(O,()=>{this.log("end :: finish :: calling process.nextTick on closeStores"),(0,m.nextTick)(K)},P)};return this.disconnecting?(M(),this):(this._clearReconnect(),this.disconnecting=!0,!O&&Object.keys(this.outgoing).length>0?(this.log("end :: (%s) :: calling finish in 10ms once outgoing is empty",this.options.clientId),this.once("outgoingEmpty",setTimeout.bind(null,C,10))):(this.log("end :: (%s) :: immediately calling finish",this.options.clientId),C()),this)}endAsync(O,P){return new Promise((M,K)=>{this.end(O,P,C=>{C?K(C):M()})})}removeOutgoingMessage(O){if(this.outgoing[O]){let{cb:P}=this.outgoing[O];this._removeOutgoingAndStoreMessage(O,()=>{P(new Error("Message removed"))})}return this}reconnect(O){this.log("client reconnect");let P=()=>{O?(this.options.incomingStore=O.incomingStore,this.options.outgoingStore=O.outgoingStore):(this.options.incomingStore=null,this.options.outgoingStore=null),this.incomingStore=this.options.incomingStore||new h.default,this.outgoingStore=this.options.outgoingStore||new h.default,this.disconnecting=!1,this.disconnected=!1,this._deferredReconnect=null,this._reconnect()};return this.disconnecting&&!this.disconnected?this._deferredReconnect=P:P(),this}_flushVolatile(){this.outgoing&&(this.log("_flushVolatile :: deleting volatile messages from the queue and setting their callbacks as error function"),Object.keys(this.outgoing).forEach(O=>{this.outgoing[O].volatile&&typeof this.outgoing[O].cb=="function"&&(this.outgoing[O].cb(new Error("Connection closed")),delete this.outgoing[O])}))}_flush(){this.outgoing&&(this.log("_flush: queue exists? %b",!!this.outgoing),Object.keys(this.outgoing).forEach(O=>{typeof this.outgoing[O].cb=="function"&&(this.outgoing[O].cb(new Error("Connection closed")),delete this.outgoing[O])}))}_removeTopicAliasAndRecoverTopicName(O){let P;O.properties&&(P=O.properties.topicAlias);let M=O.topic.toString();if(this.log("_removeTopicAliasAndRecoverTopicName :: alias %d, topic %o",P,M),M.length===0){if(typeof P>"u")return new Error("Unregistered Topic Alias");if(M=this.topicAliasSend.getTopicByAlias(P),typeof M>"u")return new Error("Unregistered Topic Alias");O.topic=M}P&&delete O.properties.topicAlias}_checkDisconnecting(O){return this.disconnecting&&(O&&O!==this.noop?O(new Error("client disconnecting")):this.emit("error",new Error("client disconnecting"))),this.disconnecting}_reconnect(){this.log("_reconnect: emitting reconnect to client"),this.emit("reconnect"),this.connected?(this.end(()=>{this.connect()}),this.log("client already connected. disconnecting first.")):(this.log("_reconnect: calling connect"),this.connect())}_setupReconnect(){!this.disconnecting&&!this.reconnectTimer&&this.options.reconnectPeriod>0?(this.reconnecting||(this.log("_setupReconnect :: emit `offline` state"),this.emit("offline"),this.log("_setupReconnect :: set `reconnecting` to `true`"),this.reconnecting=!0),this.log("_setupReconnect :: setting reconnectTimer for %d ms",this.options.reconnectPeriod),this.reconnectTimer=setInterval(()=>{this.log("reconnectTimer :: reconnect triggered!"),this._reconnect()},this.options.reconnectPeriod)):this.log("_setupReconnect :: doing nothing...")}_clearReconnect(){this.log("_clearReconnect : clearing reconnect timer"),this.reconnectTimer&&(clearInterval(this.reconnectTimer),this.reconnectTimer=null)}_cleanUp(O,P,M={}){if(P&&(this.log("_cleanUp :: done callback provided for on stream close"),this.stream.on("close",P)),this.log("_cleanUp :: forced? %s",O),O)this.options.reconnectPeriod===0&&this.options.clean&&this._flush(),this.log("_cleanUp :: (%s) :: destroying stream",this.options.clientId),this.stream.destroy();else{let K={cmd:"disconnect",...M};this.log("_cleanUp :: (%s) :: call _sendPacket with disconnect packet",this.options.clientId),this._sendPacket(K,()=>{this.log("_cleanUp :: (%s) :: destroying stream",this.options.clientId),b(()=>{this.stream.end(()=>{this.log("_cleanUp :: (%s) :: stream destroyed",this.options.clientId)})})})}!this.disconnecting&&!this.reconnecting&&(this.log("_cleanUp :: client not disconnecting/reconnecting. Clearing and resetting reconnect."),this._clearReconnect(),this._setupReconnect()),this._destroyKeepaliveManager(),P&&!this.connected&&(this.log("_cleanUp :: (%s) :: removing stream `done` callback `close` listener",this.options.clientId),this.stream.removeListener("close",P),P())}_storeAndSend(O,P,M){this.log("storeAndSend :: store packet with cmd %s to outgoingStore",O.cmd);let K=O,C;if(K.cmd==="publish"&&(K=(0,a.default)(O),C=this._removeTopicAliasAndRecoverTopicName(K),C))return P&&P(C);this.outgoingStore.put(K,B=>{if(B)return P&&P(B);M(),this._writePacket(O,P)})}_applyTopicAlias(O){if(this.options.protocolVersion===5&&O.cmd==="publish"){let P;O.properties&&(P=O.properties.topicAlias);let M=O.topic.toString();if(this.topicAliasSend)if(P){if(M.length!==0&&(this.log("applyTopicAlias :: register topic: %s - alias: %d",M,P),!this.topicAliasSend.put(M,P)))return this.log("applyTopicAlias :: error out of range. topic: %s - alias: %d",M,P),new Error("Sending Topic Alias out of range")}else M.length!==0&&(this.options.autoAssignTopicAlias?(P=this.topicAliasSend.getAliasByTopic(M),P?(O.topic="",O.properties={...O.properties,topicAlias:P},this.log("applyTopicAlias :: auto assign(use) topic: %s - alias: %d",M,P)):(P=this.topicAliasSend.getLruAlias(),this.topicAliasSend.put(M,P),O.properties={...O.properties,topicAlias:P},this.log("applyTopicAlias :: auto assign topic: %s - alias: %d",M,P))):this.options.autoUseTopicAlias&&(P=this.topicAliasSend.getAliasByTopic(M),P&&(O.topic="",O.properties={...O.properties,topicAlias:P},this.log("applyTopicAlias :: auto use topic: %s - alias: %d",M,P))));else if(P)return this.log("applyTopicAlias :: error out of range. topic: %s - alias: %d",M,P),new Error("Sending Topic Alias out of range")}}_noop(O){this.log("noop ::",O)}_writePacket(O,P){this.log("_writePacket :: packet: %O",O),this.log("_writePacket :: emitting `packetsend`"),this.emit("packetsend",O),this.log("_writePacket :: writing to stream");let M=s.default.writeToStream(O,this.stream,this.options);this.log("_writePacket :: writeToStream result %s",M),!M&&P&&P!==this.noop?(this.log("_writePacket :: handle events on `drain` once through callback."),this.stream.once("drain",P)):P&&(this.log("_writePacket :: invoking cb"),P())}_sendPacket(O,P,M,K){this.log("_sendPacket :: (%s) ::  start",this.options.clientId),M=M||this.noop,P=P||this.noop;let C=this._applyTopicAlias(O);if(C){P(C);return}if(!this.connected){if(O.cmd==="auth"){this._writePacket(O,P);return}this.log("_sendPacket :: client not connected. Storing packet offline."),this._storePacket(O,P,M);return}if(K){this._writePacket(O,P);return}switch(O.cmd){case"publish":break;case"pubrel":this._storeAndSend(O,P,M);return;default:this._writePacket(O,P);return}switch(O.qos){case 2:case 1:this._storeAndSend(O,P,M);break;case 0:default:this._writePacket(O,P);break}this.log("_sendPacket :: (%s) ::  end",this.options.clientId)}_storePacket(O,P,M){this.log("_storePacket :: packet: %o",O),this.log("_storePacket :: cb? %s",!!P),M=M||this.noop;let K=O;if(K.cmd==="publish"){K=(0,a.default)(O);let B=this._removeTopicAliasAndRecoverTopicName(K);if(B)return P&&P(B)}let C=K.qos||0;C===0&&this.queueQoSZero||K.cmd!=="publish"?this.queue.push({packet:K,cb:P}):C>0?(P=this.outgoing[K.messageId]?this.outgoing[K.messageId].cb:null,this.outgoingStore.put(K,B=>{if(B)return P&&P(B);M()})):P&&P(new Error("No connection to broker"))}_setupKeepaliveManager(){this.log("_setupKeepaliveManager :: keepalive %d (seconds)",this.options.keepalive),!this.keepaliveManager&&this.options.keepalive&&(this.keepaliveManager=new y.default(this,this.options.timerVariant))}_destroyKeepaliveManager(){this.keepaliveManager&&(this.log("_destroyKeepaliveManager :: destroying keepalive manager"),this.keepaliveManager.destroy(),this.keepaliveManager=null)}reschedulePing(O=!1){this.keepaliveManager&&this.options.keepalive&&(O||this.options.reschedulePings)&&this._reschedulePing()}_reschedulePing(){this.log("_reschedulePing :: rescheduling ping"),this.keepaliveManager.reschedule()}sendPing(){this.log("_sendPing :: sending pingreq"),this._sendPacket({cmd:"pingreq"})}onKeepaliveTimeout(){this.emit("error",new Error("Keepalive timeout")),this.log("onKeepaliveTimeout :: calling _cleanUp with force true"),this._cleanUp(!0)}_resubscribe(){this.log("_resubscribe");let O=Object.keys(this._resubscribeTopics);if(!this._firstConnection&&(this.options.clean||this.options.protocolVersion>=4&&!this.connackPacket.sessionPresent)&&O.length>0)if(this.options.resubscribe)if(this.options.protocolVersion===5){this.log("_resubscribe: protocolVersion 5");for(let P=0;P<O.length;P++){let M={};M[O[P]]=this._resubscribeTopics[O[P]],M.resubscribe=!0,this.subscribe(M,{properties:M[O[P]].properties})}}else this._resubscribeTopics.resubscribe=!0,this.subscribe(this._resubscribeTopics);else this._resubscribeTopics={};this._firstConnection=!1}_onConnect(O){if(this.disconnected){this.emit("connect",O);return}this.connackPacket=O,this.messageIdProvider.clear(),this._setupKeepaliveManager(),this.connected=!0;let P=()=>{let M=this.outgoingStore.createStream(),K=()=>{M.destroy(),M=null,this._flushStoreProcessingQueue(),C()},C=()=>{this._storeProcessing=!1,this._packetIdsDuringStoreProcessing={}};this.once("close",K),M.on("error",N=>{C(),this._flushStoreProcessingQueue(),this.removeListener("close",K),this.emit("error",N)});let B=()=>{if(!M)return;let N=M.read(1),L;if(!N){M.once("readable",B);return}if(this._storeProcessing=!0,this._packetIdsDuringStoreProcessing[N.messageId]){B();return}!this.disconnecting&&!this.reconnectTimer?(L=this.outgoing[N.messageId]?this.outgoing[N.messageId].cb:null,this.outgoing[N.messageId]={volatile:!1,cb(V,W){L&&L(V,W),B()}},this._packetIdsDuringStoreProcessing[N.messageId]=!0,this.messageIdProvider.register(N.messageId)?this._sendPacket(N,void 0,void 0,!0):this.log("messageId: %d has already used.",N.messageId)):M.destroy&&M.destroy()};M.on("end",()=>{let N=!0;for(let L in this._packetIdsDuringStoreProcessing)if(!this._packetIdsDuringStoreProcessing[L]){N=!1;break}this.removeListener("close",K),N?(C(),this._invokeAllStoreProcessingQueue(),this.emit("connect",O)):P()}),B()};P()}_invokeStoreProcessingQueue(){if(!this._storeProcessing&&this._storeProcessingQueue.length>0){let O=this._storeProcessingQueue[0];if(O&&O.invoke())return this._storeProcessingQueue.shift(),!0}return!1}_invokeAllStoreProcessingQueue(){for(;this._invokeStoreProcessingQueue(););}_flushStoreProcessingQueue(){for(let O of this._storeProcessingQueue)O.cbStorePut&&O.cbStorePut(new Error("Connection closed")),O.callback&&O.callback(new Error("Connection closed"));this._storeProcessingQueue.splice(0)}_removeOutgoingAndStoreMessage(O,P){delete this.outgoing[O],this.outgoingStore.del({messageId:O},(M,K)=>{P(M,K),this.messageIdProvider.deallocate(O),this._invokeStoreProcessingQueue()})}},v(x,"VERSION",m.MQTTJS_VERSION),x);n.default=I}),pq=$e(n=>{Oe(),Ne(),Le(),Object.defineProperty(n,"__esModule",{value:!0});var e=m3(),t=class{constructor(){v(this,"numberAllocator");v(this,"lastId");this.numberAllocator=new e.NumberAllocator(1,65535)}allocate(){return this.lastId=this.numberAllocator.alloc(),this.lastId}getLastAllocated(){return this.lastId}register(r){return this.numberAllocator.use(r)}deallocate(r){this.numberAllocator.free(r)}clear(){this.numberAllocator.clear()}};n.default=t});function gq(){if(T_)return eg;T_=!0;let n=2147483647,e=36,t=1,r=26,i=38,s=700,o=72,a=128,l="-",c=/^xn--/,h=/[^\0-\x7F]/,d=/[\x2E\u3002\uFF0E\uFF61]/g,p={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},g=e-t,m=Math.floor,E=String.fromCharCode;function y(M){throw new RangeError(p[M])}function S(M,K){let C=[],B=M.length;for(;B--;)C[B]=K(M[B]);return C}function b(M,K){let C=M.split("@"),B="";C.length>1&&(B=C[0]+"@",M=C[1]),M=M.replace(d,".");let N=M.split("."),L=S(N,K).join(".");return B+L}function _(M){let K=[],C=0,B=M.length;for(;C<B;){let N=M.charCodeAt(C++);if(N>=55296&&N<=56319&&C<B){let L=M.charCodeAt(C++);(L&64512)==56320?K.push(((N&1023)<<10)+(L&1023)+65536):(K.push(N),C--)}else K.push(N)}return K}let I=M=>String.fromCodePoint(...M),x=function(M){return M>=48&&M<58?26+(M-48):M>=65&&M<91?M-65:M>=97&&M<123?M-97:e},$=function(M,K){return M+22+75*(M<26)-((K!=0)<<5)},U=function(M,K,C){let B=0;for(M=C?m(M/s):M>>1,M+=m(M/K);M>g*r>>1;B+=e)M=m(M/g);return m(B+(g+1)*M/(M+i))},O=function(M){let K=[],C=M.length,B=0,N=a,L=o,V=M.lastIndexOf(l);V<0&&(V=0);for(let W=0;W<V;++W)M.charCodeAt(W)>=128&&y("not-basic"),K.push(M.charCodeAt(W));for(let W=V>0?V+1:0;W<C;){let H=B;for(let z=1,Z=e;;Z+=e){W>=C&&y("invalid-input");let F=x(M.charCodeAt(W++));F>=e&&y("invalid-input"),F>m((n-B)/z)&&y("overflow"),B+=F*z;let ie=Z<=L?t:Z>=L+r?r:Z-L;if(F<ie)break;let fe=e-ie;z>m(n/fe)&&y("overflow"),z*=fe}let G=K.length+1;L=U(B-H,G,H==0),m(B/G)>n-N&&y("overflow"),N+=m(B/G),B%=G,K.splice(B++,0,N)}return String.fromCodePoint(...K)},P=function(M){let K=[];M=_(M);let C=M.length,B=a,N=0,L=o;for(let H of M)H<128&&K.push(E(H));let V=K.length,W=V;for(V&&K.push(l);W<C;){let H=n;for(let z of M)z>=B&&z<H&&(H=z);let G=W+1;H-B>m((n-N)/G)&&y("overflow"),N+=(H-B)*G,B=H;for(let z of M)if(z<B&&++N>n&&y("overflow"),z===B){let Z=N;for(let F=e;;F+=e){let ie=F<=L?t:F>=L+r?r:F-L;if(Z<ie)break;let fe=Z-ie,J=e-ie;K.push(E($(ie+fe%J,0))),Z=m(fe/J)}K.push(E($(Z,0))),L=U(N,G,W===V),N=0,++W}++N,++B}return K.join("")};return eg={version:"2.3.1",ucs2:{decode:_,encode:I},decode:O,encode:P,toASCII:function(M){return b(M,function(K){return h.test(K)?"xn--"+P(K):K})},toUnicode:function(M){return b(M,function(K){return c.test(K)?O(K.slice(4).toLowerCase()):K})}},eg}var eg,T_,ea,mq=ii(()=>{Oe(),Ne(),Le(),eg={},T_=!1,ea=gq(),ea.decode,ea.encode,ea.toASCII,ea.toUnicode,ea.ucs2,ea.version});function yq(){return k_||(k_=!0,C_=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var n={},e=Symbol("test"),t=Object(e);if(typeof e=="string"||Object.prototype.toString.call(e)!=="[object Symbol]"||Object.prototype.toString.call(t)!=="[object Symbol]")return!1;var r=42;n[e]=r;for(e in n)return!1;if(typeof Object.keys=="function"&&Object.keys(n).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(n).length!==0)return!1;var i=Object.getOwnPropertySymbols(n);if(i.length!==1||i[0]!==e||!Object.prototype.propertyIsEnumerable.call(n,e))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var s=Object.getOwnPropertyDescriptor(n,e);if(s.value!==r||s.enumerable!==!0)return!1}return!0}),C_}function bq(){return R_||(R_=!0,P_=Error),P_}function wq(){return L_||(L_=!0,O_=EvalError),O_}function vq(){return D_||(D_=!0,N_=RangeError),N_}function _q(){return M_||(M_=!0,$_=ReferenceError),$_}function x3(){return U_||(U_=!0,B_=SyntaxError),B_}function Hf(){return j_||(j_=!0,F_=TypeError),F_}function Eq(){return H_||(H_=!0,q_=URIError),q_}function Sq(){if(W_)return tg;W_=!0;var n=typeof Symbol<"u"&&Symbol,e=yq();return tg=function(){return typeof n!="function"||typeof Symbol!="function"||typeof n("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:e()},tg}function Aq(){if(z_)return rg;z_=!0;var n={__proto__:null,foo:{}},e=Object;return rg=function(){return{__proto__:n}.foo===n.foo&&!(n instanceof e)},rg}function xq(){if(K_)return ng;K_=!0;var n="Function.prototype.bind called on incompatible ",e=Object.prototype.toString,t=Math.max,r="[object Function]",i=function(a,l){for(var c=[],h=0;h<a.length;h+=1)c[h]=a[h];for(var d=0;d<l.length;d+=1)c[d+a.length]=l[d];return c},s=function(a,l){for(var c=[],h=l,d=0;h<a.length;h+=1,d+=1)c[d]=a[h];return c},o=function(a,l){for(var c="",h=0;h<a.length;h+=1)c+=a[h],h+1<a.length&&(c+=l);return c};return ng=function(a){var l=this;if(typeof l!="function"||e.apply(l)!==r)throw new TypeError(n+l);for(var c=s(arguments,1),h,d=function(){if(this instanceof h){var y=l.apply(this,i(c,arguments));return Object(y)===y?y:this}return l.apply(a,i(c,arguments))},p=t(0,l.length-c.length),g=[],m=0;m<p;m++)g[m]="$"+m;if(h=Function("binder","return function ("+o(g,",")+"){ return binder.apply(this,arguments); }")(d),l.prototype){var E=function(){};E.prototype=l.prototype,h.prototype=new E,E.prototype=null}return h},ng}function XE(){if(V_)return ig;V_=!0;var n=xq();return ig=Function.prototype.bind||n,ig}function Iq(){if(G_)return sg;G_=!0;var n=Function.prototype.call,e=Object.prototype.hasOwnProperty,t=XE();return sg=t.call(n,e),sg}function Wu(){if(Y_)return og;Y_=!0;var n,e=bq(),t=wq(),r=vq(),i=_q(),s=x3(),o=Hf(),a=Eq(),l=Function,c=function(W){try{return l('"use strict"; return ('+W+").constructor;")()}catch{}},h=Object.getOwnPropertyDescriptor;if(h)try{h({},"")}catch{h=null}var d=function(){throw new o},p=h?function(){try{return arguments.callee,d}catch{try{return h(arguments,"callee").get}catch{return d}}}():d,g=Sq()(),m=Aq()(),E=Object.getPrototypeOf||(m?function(W){return W.__proto__}:null),y={},S=typeof Uint8Array>"u"||!E?n:E(Uint8Array),b={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?n:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?n:ArrayBuffer,"%ArrayIteratorPrototype%":g&&E?E([][Symbol.iterator]()):n,"%AsyncFromSyncIteratorPrototype%":n,"%AsyncFunction%":y,"%AsyncGenerator%":y,"%AsyncGeneratorFunction%":y,"%AsyncIteratorPrototype%":y,"%Atomics%":typeof Atomics>"u"?n:Atomics,"%BigInt%":typeof BigInt>"u"?n:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?n:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?n:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?n:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":e,"%eval%":eval,"%EvalError%":t,"%Float32Array%":typeof Float32Array>"u"?n:Float32Array,"%Float64Array%":typeof Float64Array>"u"?n:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?n:FinalizationRegistry,"%Function%":l,"%GeneratorFunction%":y,"%Int8Array%":typeof Int8Array>"u"?n:Int8Array,"%Int16Array%":typeof Int16Array>"u"?n:Int16Array,"%Int32Array%":typeof Int32Array>"u"?n:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":g&&E?E(E([][Symbol.iterator]())):n,"%JSON%":typeof JSON=="object"?JSON:n,"%Map%":typeof Map>"u"?n:Map,"%MapIteratorPrototype%":typeof Map>"u"||!g||!E?n:E(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?n:Promise,"%Proxy%":typeof Proxy>"u"?n:Proxy,"%RangeError%":r,"%ReferenceError%":i,"%Reflect%":typeof Reflect>"u"?n:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?n:Set,"%SetIteratorPrototype%":typeof Set>"u"||!g||!E?n:E(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?n:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":g&&E?E(""[Symbol.iterator]()):n,"%Symbol%":g?Symbol:n,"%SyntaxError%":s,"%ThrowTypeError%":p,"%TypedArray%":S,"%TypeError%":o,"%Uint8Array%":typeof Uint8Array>"u"?n:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?n:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?n:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?n:Uint32Array,"%URIError%":a,"%WeakMap%":typeof WeakMap>"u"?n:WeakMap,"%WeakRef%":typeof WeakRef>"u"?n:WeakRef,"%WeakSet%":typeof WeakSet>"u"?n:WeakSet};if(E)try{null.error}catch(W){var _=E(E(W));b["%Error.prototype%"]=_}var I=function W(H){var G;if(H==="%AsyncFunction%")G=c("async function () {}");else if(H==="%GeneratorFunction%")G=c("function* () {}");else if(H==="%AsyncGeneratorFunction%")G=c("async function* () {}");else if(H==="%AsyncGenerator%"){var z=W("%AsyncGeneratorFunction%");z&&(G=z.prototype)}else if(H==="%AsyncIteratorPrototype%"){var Z=W("%AsyncGenerator%");Z&&E&&(G=E(Z.prototype))}return b[H]=G,G},x={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},$=XE(),U=Iq(),O=$.call(Function.call,Array.prototype.concat),P=$.call(Function.apply,Array.prototype.splice),M=$.call(Function.call,String.prototype.replace),K=$.call(Function.call,String.prototype.slice),C=$.call(Function.call,RegExp.prototype.exec),B=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,N=/\\(\\)?/g,L=function(W){var H=K(W,0,1),G=K(W,-1);if(H==="%"&&G!=="%")throw new s("invalid intrinsic syntax, expected closing `%`");if(G==="%"&&H!=="%")throw new s("invalid intrinsic syntax, expected opening `%`");var z=[];return M(W,B,function(Z,F,ie,fe){z[z.length]=ie?M(fe,N,"$1"):F||Z}),z},V=function(W,H){var G=W,z;if(U(x,G)&&(z=x[G],G="%"+z[0]+"%"),U(b,G)){var Z=b[G];if(Z===y&&(Z=I(G)),typeof Z>"u"&&!H)throw new o("intrinsic "+W+" exists, but is not available. Please file an issue!");return{alias:z,name:G,value:Z}}throw new s("intrinsic "+W+" does not exist!")};return og=function(W,H){if(typeof W!="string"||W.length===0)throw new o("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof H!="boolean")throw new o('"allowMissing" argument must be a boolean');if(C(/^%?[^%]*%?$/,W)===null)throw new s("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var G=L(W),z=G.length>0?G[0]:"",Z=V("%"+z+"%",H),F=Z.name,ie=Z.value,fe=!1,J=Z.alias;J&&(z=J[0],P(G,O([0,1],J)));for(var _e=1,oe=!0;_e<G.length;_e+=1){var ne=G[_e],de=K(ne,0,1),k=K(ne,-1);if((de==='"'||de==="'"||de==="`"||k==='"'||k==="'"||k==="`")&&de!==k)throw new s("property names with quotes must have matching quotes");if((ne==="constructor"||!oe)&&(fe=!0),z+="."+ne,F="%"+z+"%",U(b,F))ie=b[F];else if(ie!=null){if(!(ne in ie)){if(!H)throw new o("base intrinsic for "+W+" exists, but the property is not available.");return}if(h&&_e+1>=G.length){var X=h(ie,ne);oe=!!X,oe&&"get"in X&&!("originalValue"in X.get)?ie=X.get:ie=ie[ne]}else oe=U(ie,ne),ie=ie[ne];oe&&!fe&&(b[F]=ie)}}return ie},og}function ZE(){if(X_)return ag;X_=!0;var n=Wu(),e=n("%Object.defineProperty%",!0)||!1;if(e)try{e({},"a",{value:1})}catch{e=!1}return ag=e,ag}function I3(){if(Z_)return lg;Z_=!0;var n=Wu(),e=n("%Object.getOwnPropertyDescriptor%",!0);if(e)try{e([],"length")}catch{e=null}return lg=e,lg}function Tq(){if(Q_)return cg;Q_=!0;var n=ZE(),e=x3(),t=Hf(),r=I3();return cg=function(i,s,o){if(!i||typeof i!="object"&&typeof i!="function")throw new t("`obj` must be an object or a function`");if(typeof s!="string"&&typeof s!="symbol")throw new t("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new t("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new t("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new t("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new t("`loose`, if provided, must be a boolean");var a=arguments.length>3?arguments[3]:null,l=arguments.length>4?arguments[4]:null,c=arguments.length>5?arguments[5]:null,h=arguments.length>6?arguments[6]:!1,d=!!r&&r(i,s);if(n)n(i,s,{configurable:c===null&&d?d.configurable:!c,enumerable:a===null&&d?d.enumerable:!a,value:o,writable:l===null&&d?d.writable:!l});else if(h||!a&&!l&&!c)i[s]=o;else throw new e("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},cg}function Cq(){if(J_)return ug;J_=!0;var n=ZE(),e=function(){return!!n};return e.hasArrayLengthDefineBug=function(){if(!n)return null;try{return n([],"length",{value:1}).length!==1}catch{return!0}},ug=e,ug}function kq(){if(e1)return hg;e1=!0;var n=Wu(),e=Tq(),t=Cq()(),r=I3(),i=Hf(),s=n("%Math.floor%");return hg=function(o,a){if(typeof o!="function")throw new i("`fn` is not a function");if(typeof a!="number"||a<0||a>4294967295||s(a)!==a)throw new i("`length` must be a positive 32-bit integer");var l=arguments.length>2&&!!arguments[2],c=!0,h=!0;if("length"in o&&r){var d=r(o,"length");d&&!d.configurable&&(c=!1),d&&!d.writable&&(h=!1)}return(c||h||!l)&&(t?e(o,"length",a,!0,!0):e(o,"length",a)),o},hg}function Pq(){if(t1)return Uc;t1=!0;var n=XE(),e=Wu(),t=kq(),r=Hf(),i=e("%Function.prototype.apply%"),s=e("%Function.prototype.call%"),o=e("%Reflect.apply%",!0)||n.call(s,i),a=ZE(),l=e("%Math.max%");Uc=function(h){if(typeof h!="function")throw new r("a function is required");var d=o(n,s,arguments);return t(d,1+l(0,h.length-(arguments.length-1)),!0)};var c=function(){return o(n,i,arguments)};return a?a(Uc,"apply",{value:c}):Uc.apply=c,Uc}function Rq(){if(r1)return fg;r1=!0;var n=Wu(),e=Pq(),t=e(n("String.prototype.indexOf"));return fg=function(r,i){var s=n(r,!!i);return typeof s=="function"&&t(r,".prototype.")>-1?e(s):s},fg}var C_,k_,P_,R_,O_,L_,N_,D_,$_,M_,B_,U_,F_,j_,q_,H_,tg,W_,rg,z_,ng,K_,ig,V_,sg,G_,og,Y_,ag,X_,lg,Z_,cg,Q_,ug,J_,hg,e1,Uc,t1,fg,r1,Oq=ii(()=>{Oe(),Ne(),Le(),C_={},k_=!1,P_={},R_=!1,O_={},L_=!1,N_={},D_=!1,$_={},M_=!1,B_={},U_=!1,F_={},j_=!1,q_={},H_=!1,tg={},W_=!1,rg={},z_=!1,ng={},K_=!1,ig={},V_=!1,sg={},G_=!1,og={},Y_=!1,ag={},X_=!1,lg={},Z_=!1,cg={},Q_=!1,ug={},J_=!1,hg={},e1=!1,Uc={},t1=!1,fg={},r1=!1});function QE(n){throw new Error("Node.js process "+n+" is not supported by JSPM core outside of Node.js")}function Lq(){!xl||!sl||(xl=!1,sl.length?As=sl.concat(As):zh=-1,As.length&&T3())}function T3(){if(!xl){var n=setTimeout(Lq,0);xl=!0;for(var e=As.length;e;){for(sl=As,As=[];++zh<e;)sl&&sl[zh].run();zh=-1,e=As.length}sl=null,xl=!1,clearTimeout(n)}}function Nq(n){var e=new Array(arguments.length-1);if(arguments.length>1)for(var t=1;t<arguments.length;t++)e[t-1]=arguments[t];As.push(new C3(n,e)),As.length===1&&!xl&&setTimeout(T3,0)}function C3(n,e){this.fun=n,this.array=e}function vn(){}function Dq(n){QE("_linkedBinding")}function $q(n){QE("dlopen")}function Mq(){return[]}function Bq(){return[]}function Uq(n,e){if(!n)throw new Error(e||"assertion error")}function Fq(){return!1}function jq(){return ro.now()/1e3}function O0(n){var e=Math.floor((Date.now()-ro.now())*.001),t=ro.now()*.001,r=Math.floor(t)+e,i=Math.floor(t%1*1e9);return n&&(r=r-n[0],i=i-n[1],i<0&&(r--,i+=dg)),[r,i]}function Lo(){return JE}function qq(n){return[]}var As,xl,sl,zh,RI,OI,LI,NI,DI,$I,MI,BI,UI,FI,jI,qI,HI,WI,zI,KI,VI,GI,YI,XI,ZI,Jd,QI,JI,eT,tT,rT,nT,iT,sT,oT,aT,lT,cT,uT,hT,fT,dT,pT,gT,mT,yT,bT,wT,vT,_T,ET,ro,L0,dg,ST,AT,xT,IT,TT,CT,kT,PT,RT,OT,LT,JE,k3=ii(()=>{Oe(),Ne(),Le(),As=[],xl=!1,zh=-1,C3.prototype.run=function(){this.fun.apply(null,this.array)},RI="browser",OI="x64",LI="browser",NI={PATH:"/usr/bin",LANG:navigator.language+".UTF-8",PWD:"/",HOME:"/home",TMP:"/tmp"},DI=["/usr/bin/node"],$I=[],MI="v16.8.0",BI={},UI=function(n,e){console.warn((e?e+": ":"")+n)},FI=function(n){QE("binding")},jI=function(n){return 0},qI=function(){return"/"},HI=function(n){},WI={name:"node",sourceUrl:"",headersUrl:"",libUrl:""},zI=vn,KI=[],VI={},GI=!1,YI={},XI=vn,ZI=vn,Jd=function(){return{}},QI=Jd,JI=Jd,eT=vn,tT=vn,rT=vn,nT={},iT={inspector:!1,debug:!1,uv:!1,ipv6:!1,tls_alpn:!1,tls_sni:!1,tls_ocsp:!1,tls:!1,cached_builtins:!0},sT=vn,oT=vn,aT=vn,lT=vn,cT=vn,uT=vn,hT=vn,fT=void 0,dT=void 0,pT=void 0,gT=vn,mT=2,yT=1,bT="/bin/usr/node",wT=9229,vT="node",_T=[],ET=vn,ro={now:typeof performance<"u"?performance.now.bind(performance):void 0,timing:typeof performance<"u"?performance.timing:void 0},ro.now===void 0&&(L0=Date.now(),ro.timing&&ro.timing.navigationStart&&(L0=ro.timing.navigationStart),ro.now=()=>Date.now()-L0),dg=1e9,O0.bigint=function(n){var e=O0(n);return typeof BigInt>"u"?e[0]*dg+e[1]:BigInt(e[0]*dg)+BigInt(e[1])},ST=10,AT={},xT=0,IT=Lo,TT=Lo,CT=Lo,kT=Lo,PT=Lo,RT=vn,OT=Lo,LT=Lo,JE={version:MI,versions:BI,arch:OI,platform:LI,release:WI,_rawDebug:zI,moduleLoadList:KI,binding:FI,_linkedBinding:Dq,_events:AT,_eventsCount:xT,_maxListeners:ST,on:Lo,addListener:IT,once:TT,off:CT,removeListener:kT,removeAllListeners:PT,emit:RT,prependListener:OT,prependOnceListener:LT,listeners:qq,domain:VI,_exiting:GI,config:YI,dlopen:$q,uptime:jq,_getActiveRequests:Mq,_getActiveHandles:Bq,reallyExit:XI,_kill:ZI,cpuUsage:Jd,resourceUsage:QI,memoryUsage:JI,kill:eT,exit:tT,openStdin:rT,allowedNodeEnvironmentFlags:nT,assert:Uq,features:iT,_fatalExceptions:sT,setUncaughtExceptionCaptureCallback:oT,hasUncaughtExceptionCaptureCallback:Fq,emitWarning:UI,nextTick:Nq,_tickCallback:aT,_debugProcess:lT,_debugEnd:cT,_startProfilerIdleNotifier:uT,_stopProfilerIdleNotifier:hT,stdout:fT,stdin:pT,stderr:dT,abort:gT,umask:jI,chdir:HI,cwd:qI,env:NI,title:RI,argv:DI,execArgv:$I,pid:mT,ppid:yT,execPath:bT,debugPort:wT,hrtime:O0,argv0:vT,_preload_modules:_T,setSourceMapsEnabled:ET}});function Hq(){if(n1)return pg;n1=!0;var n=JE;function e(s){if(typeof s!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(s))}function t(s,o){for(var a="",l=0,c=-1,h=0,d,p=0;p<=s.length;++p){if(p<s.length)d=s.charCodeAt(p);else{if(d===47)break;d=47}if(d===47){if(!(c===p-1||h===1))if(c!==p-1&&h===2){if(a.length<2||l!==2||a.charCodeAt(a.length-1)!==46||a.charCodeAt(a.length-2)!==46){if(a.length>2){var g=a.lastIndexOf("/");if(g!==a.length-1){g===-1?(a="",l=0):(a=a.slice(0,g),l=a.length-1-a.lastIndexOf("/")),c=p,h=0;continue}}else if(a.length===2||a.length===1){a="",l=0,c=p,h=0;continue}}o&&(a.length>0?a+="/..":a="..",l=2)}else a.length>0?a+="/"+s.slice(c+1,p):a=s.slice(c+1,p),l=p-c-1;c=p,h=0}else d===46&&h!==-1?++h:h=-1}return a}function r(s,o){var a=o.dir||o.root,l=o.base||(o.name||"")+(o.ext||"");return a?a===o.root?a+l:a+s+l:l}var i={resolve:function(){for(var s="",o=!1,a,l=arguments.length-1;l>=-1&&!o;l--){var c;l>=0?c=arguments[l]:(a===void 0&&(a=n.cwd()),c=a),e(c),c.length!==0&&(s=c+"/"+s,o=c.charCodeAt(0)===47)}return s=t(s,!o),o?s.length>0?"/"+s:"/":s.length>0?s:"."},normalize:function(s){if(e(s),s.length===0)return".";var o=s.charCodeAt(0)===47,a=s.charCodeAt(s.length-1)===47;return s=t(s,!o),s.length===0&&!o&&(s="."),s.length>0&&a&&(s+="/"),o?"/"+s:s},isAbsolute:function(s){return e(s),s.length>0&&s.charCodeAt(0)===47},join:function(){if(arguments.length===0)return".";for(var s,o=0;o<arguments.length;++o){var a=arguments[o];e(a),a.length>0&&(s===void 0?s=a:s+="/"+a)}return s===void 0?".":i.normalize(s)},relative:function(s,o){if(e(s),e(o),s===o||(s=i.resolve(s),o=i.resolve(o),s===o))return"";for(var a=1;a<s.length&&s.charCodeAt(a)===47;++a);for(var l=s.length,c=l-a,h=1;h<o.length&&o.charCodeAt(h)===47;++h);for(var d=o.length,p=d-h,g=c<p?c:p,m=-1,E=0;E<=g;++E){if(E===g){if(p>g){if(o.charCodeAt(h+E)===47)return o.slice(h+E+1);if(E===0)return o.slice(h+E)}else c>g&&(s.charCodeAt(a+E)===47?m=E:E===0&&(m=0));break}var y=s.charCodeAt(a+E),S=o.charCodeAt(h+E);if(y!==S)break;y===47&&(m=E)}var b="";for(E=a+m+1;E<=l;++E)(E===l||s.charCodeAt(E)===47)&&(b.length===0?b+="..":b+="/..");return b.length>0?b+o.slice(h+m):(h+=m,o.charCodeAt(h)===47&&++h,o.slice(h))},_makeLong:function(s){return s},dirname:function(s){if(e(s),s.length===0)return".";for(var o=s.charCodeAt(0),a=o===47,l=-1,c=!0,h=s.length-1;h>=1;--h)if(o=s.charCodeAt(h),o===47){if(!c){l=h;break}}else c=!1;return l===-1?a?"/":".":a&&l===1?"//":s.slice(0,l)},basename:function(s,o){if(o!==void 0&&typeof o!="string")throw new TypeError('"ext" argument must be a string');e(s);var a=0,l=-1,c=!0,h;if(o!==void 0&&o.length>0&&o.length<=s.length){if(o.length===s.length&&o===s)return"";var d=o.length-1,p=-1;for(h=s.length-1;h>=0;--h){var g=s.charCodeAt(h);if(g===47){if(!c){a=h+1;break}}else p===-1&&(c=!1,p=h+1),d>=0&&(g===o.charCodeAt(d)?--d===-1&&(l=h):(d=-1,l=p))}return a===l?l=p:l===-1&&(l=s.length),s.slice(a,l)}else{for(h=s.length-1;h>=0;--h)if(s.charCodeAt(h)===47){if(!c){a=h+1;break}}else l===-1&&(c=!1,l=h+1);return l===-1?"":s.slice(a,l)}},extname:function(s){e(s);for(var o=-1,a=0,l=-1,c=!0,h=0,d=s.length-1;d>=0;--d){var p=s.charCodeAt(d);if(p===47){if(!c){a=d+1;break}continue}l===-1&&(c=!1,l=d+1),p===46?o===-1?o=d:h!==1&&(h=1):o!==-1&&(h=-1)}return o===-1||l===-1||h===0||h===1&&o===l-1&&o===a+1?"":s.slice(o,l)},format:function(s){if(s===null||typeof s!="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof s);return r("/",s)},parse:function(s){e(s);var o={root:"",dir:"",base:"",ext:"",name:""};if(s.length===0)return o;var a=s.charCodeAt(0),l=a===47,c;l?(o.root="/",c=1):c=0;for(var h=-1,d=0,p=-1,g=!0,m=s.length-1,E=0;m>=c;--m){if(a=s.charCodeAt(m),a===47){if(!g){d=m+1;break}continue}p===-1&&(g=!1,p=m+1),a===46?h===-1?h=m:E!==1&&(E=1):h!==-1&&(E=-1)}return h===-1||p===-1||E===0||E===1&&h===p-1&&h===d+1?p!==-1&&(d===0&&l?o.base=o.name=s.slice(1,p):o.base=o.name=s.slice(d,p)):(d===0&&l?(o.name=s.slice(1,h),o.base=s.slice(1,p)):(o.name=s.slice(d,h),o.base=s.slice(d,p)),o.ext=s.slice(h,p)),d>0?o.dir=s.slice(0,d-1):l&&(o.dir="/"),o},sep:"/",delimiter:":",win32:null,posix:null};return i.posix=i,pg=i,pg}var pg,n1,i1,Wq=ii(()=>{Oe(),Ne(),Le(),k3(),pg={},n1=!1,i1=Hq()}),P3={};ju(P3,{URL:()=>F3,Url:()=>D3,default:()=>An,fileURLToPath:()=>O3,format:()=>$3,parse:()=>U3,pathToFileURL:()=>L3,resolve:()=>M3,resolveObject:()=>B3});function zq(){if(s1)return gg;s1=!0;var n=typeof Map=="function"&&Map.prototype,e=Object.getOwnPropertyDescriptor&&n?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,t=n&&e&&typeof e.get=="function"?e.get:null,r=n&&Map.prototype.forEach,i=typeof Set=="function"&&Set.prototype,s=Object.getOwnPropertyDescriptor&&i?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,o=i&&s&&typeof s.get=="function"?s.get:null,a=i&&Set.prototype.forEach,l=typeof WeakMap=="function"&&WeakMap.prototype,c=l?WeakMap.prototype.has:null,h=typeof WeakSet=="function"&&WeakSet.prototype,d=h?WeakSet.prototype.has:null,p=typeof WeakRef=="function"&&WeakRef.prototype,g=p?WeakRef.prototype.deref:null,m=Boolean.prototype.valueOf,E=Object.prototype.toString,y=Function.prototype.toString,S=String.prototype.match,b=String.prototype.slice,_=String.prototype.replace,I=String.prototype.toUpperCase,x=String.prototype.toLowerCase,$=RegExp.prototype.test,U=Array.prototype.concat,O=Array.prototype.join,P=Array.prototype.slice,M=Math.floor,K=typeof BigInt=="function"?BigInt.prototype.valueOf:null,C=Object.getOwnPropertySymbols,B=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,N=typeof Symbol=="function"&&typeof Symbol.iterator=="object",L=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===N||!0)?Symbol.toStringTag:null,V=Object.prototype.propertyIsEnumerable,W=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(ue){return ue.__proto__}:null);function H(ue,we){if(ue===1/0||ue===-1/0||ue!==ue||ue&&ue>-1e3&&ue<1e3||$.call(/e/,we))return we;var He=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof ue=="number"){var ze=ue<0?-M(-ue):M(ue);if(ze!==ue){var Ke=String(ze),it=b.call(we,Ke.length+1);return _.call(Ke,He,"$&_")+"."+_.call(_.call(it,/([0-9]{3})/g,"$&_"),/_$/,"")}}return _.call(we,He,"$&_")}var G=N3,z=G.custom,Z=X(z)?z:null;gg=function ue(we,He,ze,Ke){var it=He||{};if(be(it,"quoteStyle")&&it.quoteStyle!=="single"&&it.quoteStyle!=="double")throw new TypeError('option "quoteStyle" must be "single" or "double"');if(be(it,"maxStringLength")&&(typeof it.maxStringLength=="number"?it.maxStringLength<0&&it.maxStringLength!==1/0:it.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var Gt=be(it,"customInspect")?it.customInspect:!0;if(typeof Gt!="boolean"&&Gt!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(be(it,"indent")&&it.indent!==null&&it.indent!=="	"&&!(parseInt(it.indent,10)===it.indent&&it.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(be(it,"numericSeparator")&&typeof it.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var er=it.numericSeparator;if(typeof we>"u")return"undefined";if(we===null)return"null";if(typeof we=="boolean")return we?"true":"false";if(typeof we=="string")return Ce(we,it);if(typeof we=="number"){if(we===0)return 1/0/we>0?"0":"-0";var yt=String(we);return er?H(we,yt):yt}if(typeof we=="bigint"){var Rt=String(we)+"n";return er?H(we,Rt):Rt}var nt=typeof it.depth>"u"?5:it.depth;if(typeof ze>"u"&&(ze=0),ze>=nt&&nt>0&&typeof we=="object")return fe(we)?"[Array]":"[Object]";var St=ae(it,ze);if(typeof Ke>"u")Ke=[];else if(ge(Ke,we)>=0)return"[Circular]";function Ot(Gr,Rn,Hn){if(Rn&&(Ke=P.call(Ke),Ke.push(Rn)),Hn){var en={depth:it.depth};return be(it,"quoteStyle")&&(en.quoteStyle=it.quoteStyle),ue(Gr,en,ze+1,Ke)}return ue(Gr,it,ze+1,Ke)}if(typeof we=="function"&&!_e(we)){var Zt=le(we),ar=Ee(we,Ot);return"[Function"+(Zt?": "+Zt:" (anonymous)")+"]"+(ar.length>0?" { "+O.call(ar,", ")+" }":"")}if(X(we)){var Kr=N?_.call(String(we),/^(Symbol\(.*\))_[^)]*$/,"$1"):B.call(we);return typeof we=="object"&&!N?A(Kr):Kr}if(Fe(we)){for(var se="<"+x.call(String(we.nodeName)),ce=we.attributes||[],Ue=0;Ue<ce.length;Ue++)se+=" "+ce[Ue].name+"="+F(ie(ce[Ue].value),"double",it);return se+=">",we.childNodes&&we.childNodes.length&&(se+="..."),se+="</"+x.call(String(we.nodeName))+">",se}if(fe(we)){if(we.length===0)return"[]";var We=Ee(we,Ot);return St&&!Y(We)?"["+pe(We,St)+"]":"[ "+O.call(We,", ")+" ]"}if(oe(we)){var Ve=Ee(we,Ot);return!("cause"in Error.prototype)&&"cause"in we&&!V.call(we,"cause")?"{ ["+String(we)+"] "+O.call(U.call("[cause]: "+Ot(we.cause),Ve),", ")+" }":Ve.length===0?"["+String(we)+"]":"{ ["+String(we)+"] "+O.call(Ve,", ")+" }"}if(typeof we=="object"&&Gt){if(Z&&typeof we[Z]=="function"&&G)return G(we,{depth:nt-ze});if(Gt!=="symbol"&&typeof we.inspect=="function")return we.inspect()}if(Ie(we)){var lr=[];return r&&r.call(we,function(Gr,Rn){lr.push(Ot(Rn,we,!0)+" => "+Ot(Gr,we))}),D("Map",t.call(we),lr,St)}if(ye(we)){var Cr=[];return a&&a.call(we,function(Gr){Cr.push(Ot(Gr,we))}),D("Set",o.call(we),Cr,St)}if(Ae(we))return T("WeakMap");if(Re(we))return T("WeakSet");if(Te(we))return T("WeakRef");if(de(we))return A(Ot(Number(we)));if(ee(we))return A(Ot(K.call(we)));if(k(we))return A(m.call(we));if(ne(we))return A(Ot(String(we)));if(typeof window<"u"&&we===window)return"{ [object Window] }";if(typeof globalThis<"u"&&we===globalThis||typeof mg<"u"&&we===mg)return"{ [object globalThis] }";if(!J(we)&&!_e(we)){var Vr=Ee(we,Ot),xi=W?W(we)===Object.prototype:we instanceof Object||we.constructor===Object,Ii=we instanceof Object?"":"null prototype",Ti=!xi&&L&&Object(we)===we&&L in we?b.call(te(we),8,-1):Ii?"Object":"",Hi=xi||typeof we.constructor!="function"?"":we.constructor.name?we.constructor.name+" ":"",qn=Hi+(Ti||Ii?"["+O.call(U.call([],Ti||[],Ii||[]),": ")+"] ":"");return Vr.length===0?qn+"{}":St?qn+"{"+pe(Vr,St)+"}":qn+"{ "+O.call(Vr,", ")+" }"}return String(we)};function F(ue,we,He){var ze=(He.quoteStyle||we)==="double"?'"':"'";return ze+ue+ze}function ie(ue){return _.call(String(ue),/"/g,"&quot;")}function fe(ue){return te(ue)==="[object Array]"&&(!L||!(typeof ue=="object"&&L in ue))}function J(ue){return te(ue)==="[object Date]"&&(!L||!(typeof ue=="object"&&L in ue))}function _e(ue){return te(ue)==="[object RegExp]"&&(!L||!(typeof ue=="object"&&L in ue))}function oe(ue){return te(ue)==="[object Error]"&&(!L||!(typeof ue=="object"&&L in ue))}function ne(ue){return te(ue)==="[object String]"&&(!L||!(typeof ue=="object"&&L in ue))}function de(ue){return te(ue)==="[object Number]"&&(!L||!(typeof ue=="object"&&L in ue))}function k(ue){return te(ue)==="[object Boolean]"&&(!L||!(typeof ue=="object"&&L in ue))}function X(ue){if(N)return ue&&typeof ue=="object"&&ue instanceof Symbol;if(typeof ue=="symbol")return!0;if(!ue||typeof ue!="object"||!B)return!1;try{return B.call(ue),!0}catch{}return!1}function ee(ue){if(!ue||typeof ue!="object"||!K)return!1;try{return K.call(ue),!0}catch{}return!1}var me=Object.prototype.hasOwnProperty||function(ue){return ue in(this||mg)};function be(ue,we){return me.call(ue,we)}function te(ue){return E.call(ue)}function le(ue){if(ue.name)return ue.name;var we=S.call(y.call(ue),/^function\s*([\w$]+)/);return we?we[1]:null}function ge(ue,we){if(ue.indexOf)return ue.indexOf(we);for(var He=0,ze=ue.length;He<ze;He++)if(ue[He]===we)return He;return-1}function Ie(ue){if(!t||!ue||typeof ue!="object")return!1;try{t.call(ue);try{o.call(ue)}catch{return!0}return ue instanceof Map}catch{}return!1}function Ae(ue){if(!c||!ue||typeof ue!="object")return!1;try{c.call(ue,c);try{d.call(ue,d)}catch{return!0}return ue instanceof WeakMap}catch{}return!1}function Te(ue){if(!g||!ue||typeof ue!="object")return!1;try{return g.call(ue),!0}catch{}return!1}function ye(ue){if(!o||!ue||typeof ue!="object")return!1;try{o.call(ue);try{t.call(ue)}catch{return!0}return ue instanceof Set}catch{}return!1}function Re(ue){if(!d||!ue||typeof ue!="object")return!1;try{d.call(ue,d);try{c.call(ue,c)}catch{return!0}return ue instanceof WeakSet}catch{}return!1}function Fe(ue){return!ue||typeof ue!="object"?!1:typeof HTMLElement<"u"&&ue instanceof HTMLElement?!0:typeof ue.nodeName=="string"&&typeof ue.getAttribute=="function"}function Ce(ue,we){if(ue.length>we.maxStringLength){var He=ue.length-we.maxStringLength,ze="... "+He+" more character"+(He>1?"s":"");return Ce(b.call(ue,0,we.maxStringLength),we)+ze}var Ke=_.call(_.call(ue,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,et);return F(Ke,"single",we)}function et(ue){var we=ue.charCodeAt(0),He={8:"b",9:"t",10:"n",12:"f",13:"r"}[we];return He?"\\"+He:"\\x"+(we<16?"0":"")+I.call(we.toString(16))}function A(ue){return"Object("+ue+")"}function T(ue){return ue+" { ? }"}function D(ue,we,He,ze){var Ke=ze?pe(He,ze):O.call(He,", ");return ue+" ("+we+") {"+Ke+"}"}function Y(ue){for(var we=0;we<ue.length;we++)if(ge(ue[we],`
`)>=0)return!1;return!0}function ae(ue,we){var He;if(ue.indent==="	")He="	";else if(typeof ue.indent=="number"&&ue.indent>0)He=O.call(Array(ue.indent+1)," ");else return null;return{base:He,prev:O.call(Array(we+1),He)}}function pe(ue,we){if(ue.length===0)return"";var He=`
`+we.prev+we.base;return He+O.call(ue,","+He)+`
`+we.prev}function Ee(ue,we){var He=fe(ue),ze=[];if(He){ze.length=ue.length;for(var Ke=0;Ke<ue.length;Ke++)ze[Ke]=be(ue,Ke)?we(ue[Ke],ue):""}var it=typeof C=="function"?C(ue):[],Gt;if(N){Gt={};for(var er=0;er<it.length;er++)Gt["$"+it[er]]=it[er]}for(var yt in ue)be(ue,yt)&&(He&&String(Number(yt))===yt&&yt<ue.length||N&&Gt["$"+yt]instanceof Symbol||($.call(/[^\w$]/,yt)?ze.push(we(yt,ue)+": "+we(ue[yt],ue)):ze.push(yt+": "+we(ue[yt],ue))));if(typeof C=="function")for(var Rt=0;Rt<it.length;Rt++)V.call(ue,it[Rt])&&ze.push("["+we(it[Rt])+"]: "+we(ue[it[Rt]],ue));return ze}return gg}function Kq(){if(o1)return yg;o1=!0;var n=Wu(),e=Rq(),t=zq(),r=Hf(),i=n("%WeakMap%",!0),s=n("%Map%",!0),o=e("WeakMap.prototype.get",!0),a=e("WeakMap.prototype.set",!0),l=e("WeakMap.prototype.has",!0),c=e("Map.prototype.get",!0),h=e("Map.prototype.set",!0),d=e("Map.prototype.has",!0),p=function(y,S){for(var b=y,_;(_=b.next)!==null;b=_)if(_.key===S)return b.next=_.next,_.next=y.next,y.next=_,_},g=function(y,S){var b=p(y,S);return b&&b.value},m=function(y,S,b){var _=p(y,S);_?_.value=b:y.next={key:S,next:y.next,value:b}},E=function(y,S){return!!p(y,S)};return yg=function(){var y,S,b,_={assert:function(I){if(!_.has(I))throw new r("Side channel does not contain "+t(I))},get:function(I){if(i&&I&&(typeof I=="object"||typeof I=="function")){if(y)return o(y,I)}else if(s){if(S)return c(S,I)}else if(b)return g(b,I)},has:function(I){if(i&&I&&(typeof I=="object"||typeof I=="function")){if(y)return l(y,I)}else if(s){if(S)return d(S,I)}else if(b)return E(b,I);return!1},set:function(I,x){i&&I&&(typeof I=="object"||typeof I=="function")?(y||(y=new i),a(y,I,x)):s?(S||(S=new s),h(S,I,x)):(b||(b={key:{},next:null}),m(b,I,x))}};return _},yg}function eS(){if(a1)return bg;a1=!0;var n=String.prototype.replace,e=/%20/g,t={RFC1738:"RFC1738",RFC3986:"RFC3986"};return bg={default:t.RFC3986,formatters:{RFC1738:function(r){return n.call(r,e,"+")},RFC3986:function(r){return String(r)}},RFC1738:t.RFC1738,RFC3986:t.RFC3986},bg}function R3(){if(l1)return wg;l1=!0;var n=eS(),e=Object.prototype.hasOwnProperty,t=Array.isArray,r=function(){for(var y=[],S=0;S<256;++S)y.push("%"+((S<16?"0":"")+S.toString(16)).toUpperCase());return y}(),i=function(y){for(;y.length>1;){var S=y.pop(),b=S.obj[S.prop];if(t(b)){for(var _=[],I=0;I<b.length;++I)typeof b[I]<"u"&&_.push(b[I]);S.obj[S.prop]=_}}},s=function(y,S){for(var b=S&&S.plainObjects?Object.create(null):{},_=0;_<y.length;++_)typeof y[_]<"u"&&(b[_]=y[_]);return b},o=function y(S,b,_){if(!b)return S;if(typeof b!="object"){if(t(S))S.push(b);else if(S&&typeof S=="object")(_&&(_.plainObjects||_.allowPrototypes)||!e.call(Object.prototype,b))&&(S[b]=!0);else return[S,b];return S}if(!S||typeof S!="object")return[S].concat(b);var I=S;return t(S)&&!t(b)&&(I=s(S,_)),t(S)&&t(b)?(b.forEach(function(x,$){if(e.call(S,$)){var U=S[$];U&&typeof U=="object"&&x&&typeof x=="object"?S[$]=y(U,x,_):S.push(x)}else S[$]=x}),S):Object.keys(b).reduce(function(x,$){var U=b[$];return e.call(x,$)?x[$]=y(x[$],U,_):x[$]=U,x},I)},a=function(y,S){return Object.keys(S).reduce(function(b,_){return b[_]=S[_],b},y)},l=function(y,S,b){var _=y.replace(/\+/g," ");if(b==="iso-8859-1")return _.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(_)}catch{return _}},c=1024,h=function(y,S,b,_,I){if(y.length===0)return y;var x=y;if(typeof y=="symbol"?x=Symbol.prototype.toString.call(y):typeof y!="string"&&(x=String(y)),b==="iso-8859-1")return escape(x).replace(/%u[0-9a-f]{4}/gi,function(C){return"%26%23"+parseInt(C.slice(2),16)+"%3B"});for(var $="",U=0;U<x.length;U+=c){for(var O=x.length>=c?x.slice(U,U+c):x,P=[],M=0;M<O.length;++M){var K=O.charCodeAt(M);if(K===45||K===46||K===95||K===126||K>=48&&K<=57||K>=65&&K<=90||K>=97&&K<=122||I===n.RFC1738&&(K===40||K===41)){P[P.length]=O.charAt(M);continue}if(K<128){P[P.length]=r[K];continue}if(K<2048){P[P.length]=r[192|K>>6]+r[128|K&63];continue}if(K<55296||K>=57344){P[P.length]=r[224|K>>12]+r[128|K>>6&63]+r[128|K&63];continue}M+=1,K=65536+((K&1023)<<10|O.charCodeAt(M)&1023),P[P.length]=r[240|K>>18]+r[128|K>>12&63]+r[128|K>>6&63]+r[128|K&63]}$+=P.join("")}return $},d=function(y){for(var S=[{obj:{o:y},prop:"o"}],b=[],_=0;_<S.length;++_)for(var I=S[_],x=I.obj[I.prop],$=Object.keys(x),U=0;U<$.length;++U){var O=$[U],P=x[O];typeof P=="object"&&P!==null&&b.indexOf(P)===-1&&(S.push({obj:x,prop:O}),b.push(P))}return i(S),y},p=function(y){return Object.prototype.toString.call(y)==="[object RegExp]"},g=function(y){return!y||typeof y!="object"?!1:!!(y.constructor&&y.constructor.isBuffer&&y.constructor.isBuffer(y))},m=function(y,S){return[].concat(y,S)},E=function(y,S){if(t(y)){for(var b=[],_=0;_<y.length;_+=1)b.push(S(y[_]));return b}return S(y)};return wg={arrayToObject:s,assign:a,combine:m,compact:d,decode:l,encode:h,isBuffer:g,isRegExp:p,maybeMap:E,merge:o},wg}function Vq(){if(c1)return vg;c1=!0;var n=Kq(),e=R3(),t=eS(),r=Object.prototype.hasOwnProperty,i={brackets:function(E){return E+"[]"},comma:"comma",indices:function(E,y){return E+"["+y+"]"},repeat:function(E){return E}},s=Array.isArray,o=Array.prototype.push,a=function(E,y){o.apply(E,s(y)?y:[y])},l=Date.prototype.toISOString,c=t.default,h={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:e.encode,encodeValuesOnly:!1,format:c,formatter:t.formatters[c],indices:!1,serializeDate:function(E){return l.call(E)},skipNulls:!1,strictNullHandling:!1},d=function(E){return typeof E=="string"||typeof E=="number"||typeof E=="boolean"||typeof E=="symbol"||typeof E=="bigint"},p={},g=function E(y,S,b,_,I,x,$,U,O,P,M,K,C,B,N,L,V,W){for(var H=y,G=W,z=0,Z=!1;(G=G.get(p))!==void 0&&!Z;){var F=G.get(y);if(z+=1,typeof F<"u"){if(F===z)throw new RangeError("Cyclic object value");Z=!0}typeof G.get(p)>"u"&&(z=0)}if(typeof P=="function"?H=P(S,H):H instanceof Date?H=C(H):b==="comma"&&s(H)&&(H=e.maybeMap(H,function(te){return te instanceof Date?C(te):te})),H===null){if(x)return O&&!L?O(S,h.encoder,V,"key",B):S;H=""}if(d(H)||e.isBuffer(H)){if(O){var ie=L?S:O(S,h.encoder,V,"key",B);return[N(ie)+"="+N(O(H,h.encoder,V,"value",B))]}return[N(S)+"="+N(String(H))]}var fe=[];if(typeof H>"u")return fe;var J;if(b==="comma"&&s(H))L&&O&&(H=e.maybeMap(H,O)),J=[{value:H.length>0?H.join(",")||null:void 0}];else if(s(P))J=P;else{var _e=Object.keys(H);J=M?_e.sort(M):_e}var oe=U?S.replace(/\./g,"%2E"):S,ne=_&&s(H)&&H.length===1?oe+"[]":oe;if(I&&s(H)&&H.length===0)return ne+"[]";for(var de=0;de<J.length;++de){var k=J[de],X=typeof k=="object"&&typeof k.value<"u"?k.value:H[k];if(!($&&X===null)){var ee=K&&U?k.replace(/\./g,"%2E"):k,me=s(H)?typeof b=="function"?b(ne,ee):ne:ne+(K?"."+ee:"["+ee+"]");W.set(y,z);var be=n();be.set(p,W),a(fe,E(X,me,b,_,I,x,$,U,b==="comma"&&L&&s(H)?null:O,P,M,K,C,B,N,L,V,be))}}return fe},m=function(E){if(!E)return h;if(typeof E.allowEmptyArrays<"u"&&typeof E.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof E.encodeDotInKeys<"u"&&typeof E.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(E.encoder!==null&&typeof E.encoder<"u"&&typeof E.encoder!="function")throw new TypeError("Encoder has to be a function.");var y=E.charset||h.charset;if(typeof E.charset<"u"&&E.charset!=="utf-8"&&E.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var S=t.default;if(typeof E.format<"u"){if(!r.call(t.formatters,E.format))throw new TypeError("Unknown format option provided.");S=E.format}var b=t.formatters[S],_=h.filter;(typeof E.filter=="function"||s(E.filter))&&(_=E.filter);var I;if(E.arrayFormat in i?I=E.arrayFormat:"indices"in E?I=E.indices?"indices":"repeat":I=h.arrayFormat,"commaRoundTrip"in E&&typeof E.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var x=typeof E.allowDots>"u"?E.encodeDotInKeys===!0?!0:h.allowDots:!!E.allowDots;return{addQueryPrefix:typeof E.addQueryPrefix=="boolean"?E.addQueryPrefix:h.addQueryPrefix,allowDots:x,allowEmptyArrays:typeof E.allowEmptyArrays=="boolean"?!!E.allowEmptyArrays:h.allowEmptyArrays,arrayFormat:I,charset:y,charsetSentinel:typeof E.charsetSentinel=="boolean"?E.charsetSentinel:h.charsetSentinel,commaRoundTrip:E.commaRoundTrip,delimiter:typeof E.delimiter>"u"?h.delimiter:E.delimiter,encode:typeof E.encode=="boolean"?E.encode:h.encode,encodeDotInKeys:typeof E.encodeDotInKeys=="boolean"?E.encodeDotInKeys:h.encodeDotInKeys,encoder:typeof E.encoder=="function"?E.encoder:h.encoder,encodeValuesOnly:typeof E.encodeValuesOnly=="boolean"?E.encodeValuesOnly:h.encodeValuesOnly,filter:_,format:S,formatter:b,serializeDate:typeof E.serializeDate=="function"?E.serializeDate:h.serializeDate,skipNulls:typeof E.skipNulls=="boolean"?E.skipNulls:h.skipNulls,sort:typeof E.sort=="function"?E.sort:null,strictNullHandling:typeof E.strictNullHandling=="boolean"?E.strictNullHandling:h.strictNullHandling}};return vg=function(E,y){var S=E,b=m(y),_,I;typeof b.filter=="function"?(I=b.filter,S=I("",S)):s(b.filter)&&(I=b.filter,_=I);var x=[];if(typeof S!="object"||S===null)return"";var $=i[b.arrayFormat],U=$==="comma"&&b.commaRoundTrip;_||(_=Object.keys(S)),b.sort&&_.sort(b.sort);for(var O=n(),P=0;P<_.length;++P){var M=_[P];b.skipNulls&&S[M]===null||a(x,g(S[M],M,$,U,b.allowEmptyArrays,b.strictNullHandling,b.skipNulls,b.encodeDotInKeys,b.encode?b.encoder:null,b.filter,b.sort,b.allowDots,b.serializeDate,b.format,b.formatter,b.encodeValuesOnly,b.charset,O))}var K=x.join(b.delimiter),C=b.addQueryPrefix===!0?"?":"";return b.charsetSentinel&&(b.charset==="iso-8859-1"?C+="utf8=%26%2310003%3B&":C+="utf8=%E2%9C%93&"),K.length>0?C+K:""},vg}function Gq(){if(u1)return _g;u1=!0;var n=R3(),e=Object.prototype.hasOwnProperty,t=Array.isArray,r={allowDots:!1,allowEmptyArrays:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decodeDotInKeys:!1,decoder:n.decode,delimiter:"&",depth:5,duplicates:"combine",ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictDepth:!1,strictNullHandling:!1},i=function(p){return p.replace(/&#(\d+);/g,function(g,m){return String.fromCharCode(parseInt(m,10))})},s=function(p,g){return p&&typeof p=="string"&&g.comma&&p.indexOf(",")>-1?p.split(","):p},o="utf8=%26%2310003%3B",a="utf8=%E2%9C%93",l=function(p,g){var m={__proto__:null},E=g.ignoreQueryPrefix?p.replace(/^\?/,""):p;E=E.replace(/%5B/gi,"[").replace(/%5D/gi,"]");var y=g.parameterLimit===1/0?void 0:g.parameterLimit,S=E.split(g.delimiter,y),b=-1,_,I=g.charset;if(g.charsetSentinel)for(_=0;_<S.length;++_)S[_].indexOf("utf8=")===0&&(S[_]===a?I="utf-8":S[_]===o&&(I="iso-8859-1"),b=_,_=S.length);for(_=0;_<S.length;++_)if(_!==b){var x=S[_],$=x.indexOf("]="),U=$===-1?x.indexOf("="):$+1,O,P;U===-1?(O=g.decoder(x,r.decoder,I,"key"),P=g.strictNullHandling?null:""):(O=g.decoder(x.slice(0,U),r.decoder,I,"key"),P=n.maybeMap(s(x.slice(U+1),g),function(K){return g.decoder(K,r.decoder,I,"value")})),P&&g.interpretNumericEntities&&I==="iso-8859-1"&&(P=i(P)),x.indexOf("[]=")>-1&&(P=t(P)?[P]:P);var M=e.call(m,O);M&&g.duplicates==="combine"?m[O]=n.combine(m[O],P):(!M||g.duplicates==="last")&&(m[O]=P)}return m},c=function(p,g,m,E){for(var y=E?g:s(g,m),S=p.length-1;S>=0;--S){var b,_=p[S];if(_==="[]"&&m.parseArrays)b=m.allowEmptyArrays&&(y===""||m.strictNullHandling&&y===null)?[]:[].concat(y);else{b=m.plainObjects?Object.create(null):{};var I=_.charAt(0)==="["&&_.charAt(_.length-1)==="]"?_.slice(1,-1):_,x=m.decodeDotInKeys?I.replace(/%2E/g,"."):I,$=parseInt(x,10);!m.parseArrays&&x===""?b={0:y}:!isNaN($)&&_!==x&&String($)===x&&$>=0&&m.parseArrays&&$<=m.arrayLimit?(b=[],b[$]=y):x!=="__proto__"&&(b[x]=y)}y=b}return y},h=function(p,g,m,E){if(p){var y=m.allowDots?p.replace(/\.([^.[]+)/g,"[$1]"):p,S=/(\[[^[\]]*])/,b=/(\[[^[\]]*])/g,_=m.depth>0&&S.exec(y),I=_?y.slice(0,_.index):y,x=[];if(I){if(!m.plainObjects&&e.call(Object.prototype,I)&&!m.allowPrototypes)return;x.push(I)}for(var $=0;m.depth>0&&(_=b.exec(y))!==null&&$<m.depth;){if($+=1,!m.plainObjects&&e.call(Object.prototype,_[1].slice(1,-1))&&!m.allowPrototypes)return;x.push(_[1])}if(_){if(m.strictDepth===!0)throw new RangeError("Input depth exceeded depth option of "+m.depth+" and strictDepth is true");x.push("["+y.slice(_.index)+"]")}return c(x,g,m,E)}},d=function(p){if(!p)return r;if(typeof p.allowEmptyArrays<"u"&&typeof p.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof p.decodeDotInKeys<"u"&&typeof p.decodeDotInKeys!="boolean")throw new TypeError("`decodeDotInKeys` option can only be `true` or `false`, when provided");if(p.decoder!==null&&typeof p.decoder<"u"&&typeof p.decoder!="function")throw new TypeError("Decoder has to be a function.");if(typeof p.charset<"u"&&p.charset!=="utf-8"&&p.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var g=typeof p.charset>"u"?r.charset:p.charset,m=typeof p.duplicates>"u"?r.duplicates:p.duplicates;if(m!=="combine"&&m!=="first"&&m!=="last")throw new TypeError("The duplicates option must be either combine, first, or last");var E=typeof p.allowDots>"u"?p.decodeDotInKeys===!0?!0:r.allowDots:!!p.allowDots;return{allowDots:E,allowEmptyArrays:typeof p.allowEmptyArrays=="boolean"?!!p.allowEmptyArrays:r.allowEmptyArrays,allowPrototypes:typeof p.allowPrototypes=="boolean"?p.allowPrototypes:r.allowPrototypes,allowSparse:typeof p.allowSparse=="boolean"?p.allowSparse:r.allowSparse,arrayLimit:typeof p.arrayLimit=="number"?p.arrayLimit:r.arrayLimit,charset:g,charsetSentinel:typeof p.charsetSentinel=="boolean"?p.charsetSentinel:r.charsetSentinel,comma:typeof p.comma=="boolean"?p.comma:r.comma,decodeDotInKeys:typeof p.decodeDotInKeys=="boolean"?p.decodeDotInKeys:r.decodeDotInKeys,decoder:typeof p.decoder=="function"?p.decoder:r.decoder,delimiter:typeof p.delimiter=="string"||n.isRegExp(p.delimiter)?p.delimiter:r.delimiter,depth:typeof p.depth=="number"||p.depth===!1?+p.depth:r.depth,duplicates:m,ignoreQueryPrefix:p.ignoreQueryPrefix===!0,interpretNumericEntities:typeof p.interpretNumericEntities=="boolean"?p.interpretNumericEntities:r.interpretNumericEntities,parameterLimit:typeof p.parameterLimit=="number"?p.parameterLimit:r.parameterLimit,parseArrays:p.parseArrays!==!1,plainObjects:typeof p.plainObjects=="boolean"?p.plainObjects:r.plainObjects,strictDepth:typeof p.strictDepth=="boolean"?!!p.strictDepth:r.strictDepth,strictNullHandling:typeof p.strictNullHandling=="boolean"?p.strictNullHandling:r.strictNullHandling}};return _g=function(p,g){var m=d(g);if(p===""||p===null||typeof p>"u")return m.plainObjects?Object.create(null):{};for(var E=typeof p=="string"?l(p,m):p,y=m.plainObjects?Object.create(null):{},S=Object.keys(E),b=0;b<S.length;++b){var _=S[b],I=h(_,E[_],m,typeof p=="string");y=n.merge(y,I,m)}return m.allowSparse===!0?y:n.compact(y)},_g}function Yq(){if(h1)return Eg;h1=!0;var n=Vq(),e=Gq(),t=eS();return Eg={formats:t,parse:e,stringify:n},Eg}function Xq(){if(f1)return ta;f1=!0;var n=ea;function e(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var t=/^([a-z0-9.+-]+:)/i,r=/:[0-9]*$/,i=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,s=["<",">",'"',"`"," ","\r",`
`,"	"],o=["{","}","|","\\","^","`"].concat(s),a=["'"].concat(o),l=["%","/","?",";","#"].concat(a),c=["/","?","#"],h=255,d=/^[+a-z0-9A-Z_-]{0,63}$/,p=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,g={javascript:!0,"javascript:":!0},m={javascript:!0,"javascript:":!0},E={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},y=Yq();function S(x,$,U){if(x&&typeof x=="object"&&x instanceof e)return x;var O=new e;return O.parse(x,$,U),O}e.prototype.parse=function(x,$,U){if(typeof x!="string")throw new TypeError("Parameter 'url' must be a string, not "+typeof x);var O=x.indexOf("?"),P=O!==-1&&O<x.indexOf("#")?"?":"#",M=x.split(P),K=/\\/g;M[0]=M[0].replace(K,"/"),x=M.join(P);var C=x;if(C=C.trim(),!U&&x.split("#").length===1){var B=i.exec(C);if(B)return this.path=C,this.href=C,this.pathname=B[1],B[2]?(this.search=B[2],$?this.query=y.parse(this.search.substr(1)):this.query=this.search.substr(1)):$&&(this.search="",this.query={}),this}var N=t.exec(C);if(N){N=N[0];var L=N.toLowerCase();this.protocol=L,C=C.substr(N.length)}if(U||N||C.match(/^\/\/[^@/]+@[^@/]+/)){var V=C.substr(0,2)==="//";V&&!(N&&m[N])&&(C=C.substr(2),this.slashes=!0)}if(!m[N]&&(V||N&&!E[N])){for(var W=-1,H=0;H<c.length;H++){var G=C.indexOf(c[H]);G!==-1&&(W===-1||G<W)&&(W=G)}var z,Z;W===-1?Z=C.lastIndexOf("@"):Z=C.lastIndexOf("@",W),Z!==-1&&(z=C.slice(0,Z),C=C.slice(Z+1),this.auth=decodeURIComponent(z)),W=-1;for(var H=0;H<l.length;H++){var G=C.indexOf(l[H]);G!==-1&&(W===-1||G<W)&&(W=G)}W===-1&&(W=C.length),this.host=C.slice(0,W),C=C.slice(W),this.parseHost(),this.hostname=this.hostname||"";var F=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!F)for(var ie=this.hostname.split(/\./),H=0,fe=ie.length;H<fe;H++){var J=ie[H];if(J&&!J.match(d)){for(var _e="",oe=0,ne=J.length;oe<ne;oe++)J.charCodeAt(oe)>127?_e+="x":_e+=J[oe];if(!_e.match(d)){var de=ie.slice(0,H),k=ie.slice(H+1),X=J.match(p);X&&(de.push(X[1]),k.unshift(X[2])),k.length&&(C="/"+k.join(".")+C),this.hostname=de.join(".");break}}}this.hostname.length>h?this.hostname="":this.hostname=this.hostname.toLowerCase(),F||(this.hostname=n.toASCII(this.hostname));var ee=this.port?":"+this.port:"",me=this.hostname||"";this.host=me+ee,this.href+=this.host,F&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),C[0]!=="/"&&(C="/"+C))}if(!g[L])for(var H=0,fe=a.length;H<fe;H++){var be=a[H];if(C.indexOf(be)!==-1){var te=encodeURIComponent(be);te===be&&(te=escape(be)),C=C.split(be).join(te)}}var le=C.indexOf("#");le!==-1&&(this.hash=C.substr(le),C=C.slice(0,le));var ge=C.indexOf("?");if(ge!==-1?(this.search=C.substr(ge),this.query=C.substr(ge+1),$&&(this.query=y.parse(this.query)),C=C.slice(0,ge)):$&&(this.search="",this.query={}),C&&(this.pathname=C),E[L]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var ee=this.pathname||"",Ie=this.search||"";this.path=ee+Ie}return this.href=this.format(),this};function b(x){return typeof x=="string"&&(x=S(x)),x instanceof e?x.format():e.prototype.format.call(x)}e.prototype.format=function(){var x=this.auth||"";x&&(x=encodeURIComponent(x),x=x.replace(/%3A/i,":"),x+="@");var $=this.protocol||"",U=this.pathname||"",O=this.hash||"",P=!1,M="";this.host?P=x+this.host:this.hostname&&(P=x+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(P+=":"+this.port)),this.query&&typeof this.query=="object"&&Object.keys(this.query).length&&(M=y.stringify(this.query,{arrayFormat:"repeat",addQueryPrefix:!1}));var K=this.search||M&&"?"+M||"";return $&&$.substr(-1)!==":"&&($+=":"),this.slashes||(!$||E[$])&&P!==!1?(P="//"+(P||""),U&&U.charAt(0)!=="/"&&(U="/"+U)):P||(P=""),O&&O.charAt(0)!=="#"&&(O="#"+O),K&&K.charAt(0)!=="?"&&(K="?"+K),U=U.replace(/[?#]/g,function(C){return encodeURIComponent(C)}),K=K.replace("#","%23"),$+P+U+K+O};function _(x,$){return S(x,!1,!0).resolve($)}e.prototype.resolve=function(x){return this.resolveObject(S(x,!1,!0)).format()};function I(x,$){return x?S(x,!1,!0).resolveObject($):$}return e.prototype.resolveObject=function(x){if(typeof x=="string"){var $=new e;$.parse(x,!1,!0),x=$}for(var U=new e,O=Object.keys(this),P=0;P<O.length;P++){var M=O[P];U[M]=this[M]}if(U.hash=x.hash,x.href==="")return U.href=U.format(),U;if(x.slashes&&!x.protocol){for(var K=Object.keys(x),C=0;C<K.length;C++){var B=K[C];B!=="protocol"&&(U[B]=x[B])}return E[U.protocol]&&U.hostname&&!U.pathname&&(U.pathname="/",U.path=U.pathname),U.href=U.format(),U}if(x.protocol&&x.protocol!==U.protocol){if(!E[x.protocol]){for(var N=Object.keys(x),L=0;L<N.length;L++){var V=N[L];U[V]=x[V]}return U.href=U.format(),U}if(U.protocol=x.protocol,!x.host&&!m[x.protocol]){for(var fe=(x.pathname||"").split("/");fe.length&&!(x.host=fe.shift()););x.host||(x.host=""),x.hostname||(x.hostname=""),fe[0]!==""&&fe.unshift(""),fe.length<2&&fe.unshift(""),U.pathname=fe.join("/")}else U.pathname=x.pathname;if(U.search=x.search,U.query=x.query,U.host=x.host||"",U.auth=x.auth,U.hostname=x.hostname||x.host,U.port=x.port,U.pathname||U.search){var W=U.pathname||"",H=U.search||"";U.path=W+H}return U.slashes=U.slashes||x.slashes,U.href=U.format(),U}var G=U.pathname&&U.pathname.charAt(0)==="/",z=x.host||x.pathname&&x.pathname.charAt(0)==="/",Z=z||G||U.host&&x.pathname,F=Z,ie=U.pathname&&U.pathname.split("/")||[],fe=x.pathname&&x.pathname.split("/")||[],J=U.protocol&&!E[U.protocol];if(J&&(U.hostname="",U.port=null,U.host&&(ie[0]===""?ie[0]=U.host:ie.unshift(U.host)),U.host="",x.protocol&&(x.hostname=null,x.port=null,x.host&&(fe[0]===""?fe[0]=x.host:fe.unshift(x.host)),x.host=null),Z=Z&&(fe[0]===""||ie[0]==="")),z)U.host=x.host||x.host===""?x.host:U.host,U.hostname=x.hostname||x.hostname===""?x.hostname:U.hostname,U.search=x.search,U.query=x.query,ie=fe;else if(fe.length)ie||(ie=[]),ie.pop(),ie=ie.concat(fe),U.search=x.search,U.query=x.query;else if(x.search!=null){if(J){U.host=ie.shift(),U.hostname=U.host;var _e=U.host&&U.host.indexOf("@")>0?U.host.split("@"):!1;_e&&(U.auth=_e.shift(),U.hostname=_e.shift(),U.host=U.hostname)}return U.search=x.search,U.query=x.query,(U.pathname!==null||U.search!==null)&&(U.path=(U.pathname?U.pathname:"")+(U.search?U.search:"")),U.href=U.format(),U}if(!ie.length)return U.pathname=null,U.search?U.path="/"+U.search:U.path=null,U.href=U.format(),U;for(var oe=ie.slice(-1)[0],ne=(U.host||x.host||ie.length>1)&&(oe==="."||oe==="..")||oe==="",de=0,k=ie.length;k>=0;k--)oe=ie[k],oe==="."?ie.splice(k,1):oe===".."?(ie.splice(k,1),de++):de&&(ie.splice(k,1),de--);if(!Z&&!F)for(;de--;de)ie.unshift("..");Z&&ie[0]!==""&&(!ie[0]||ie[0].charAt(0)!=="/")&&ie.unshift(""),ne&&ie.join("/").substr(-1)!=="/"&&ie.push("");var X=ie[0]===""||ie[0]&&ie[0].charAt(0)==="/";if(J){U.hostname=X?"":ie.length?ie.shift():"",U.host=U.hostname;var _e=U.host&&U.host.indexOf("@")>0?U.host.split("@"):!1;_e&&(U.auth=_e.shift(),U.hostname=_e.shift(),U.host=U.hostname)}return Z=Z||U.host&&ie.length,Z&&!X&&ie.unshift(""),ie.length>0?U.pathname=ie.join("/"):(U.pathname=null,U.path=null),(U.pathname!==null||U.search!==null)&&(U.path=(U.pathname?U.pathname:"")+(U.search?U.search:"")),U.auth=x.auth||U.auth,U.slashes=U.slashes||x.slashes,U.href=U.format(),U},e.prototype.parseHost=function(){var x=this.host,$=r.exec(x);$&&($=$[0],$!==":"&&(this.port=$.substr(1)),x=x.substr(0,x.length-$.length)),x&&(this.hostname=x)},ta.parse=S,ta.resolve=_,ta.resolveObject=I,ta.format=b,ta.Url=e,ta}function O3(n){if(typeof n=="string")n=new URL(n);else if(!(n instanceof URL))throw new Deno.errors.InvalidData("invalid argument path , must be a string or URL");if(n.protocol!=="file:")throw new Deno.errors.InvalidData("invalid url scheme");return zg?Zq(n):Qq(n)}function Zq(n){let e=n.hostname,t=n.pathname;for(let r=0;r<t.length;r++)if(t[r]==="%"){let i=t.codePointAt(r+2)||32;if(t[r+1]==="2"&&i===102||t[r+1]==="5"&&i===99)throw new Deno.errors.InvalidData("must not include encoded \\ or / characters")}if(t=t.replace(z3,"\\"),t=decodeURIComponent(t),e!=="")return`\\\\${e}${t}`;{let r=t.codePointAt(1)|32,i=t[2];if(r<H3||r>W3||i!==":")throw new Deno.errors.InvalidData("file url path must be absolute");return t.slice(1)}}function Qq(n){if(n.hostname!=="")throw new Deno.errors.InvalidData("invalid file url hostname");let e=n.pathname;for(let t=0;t<e.length;t++)if(e[t]==="%"){let r=e.codePointAt(t+2)||32;if(e[t+1]==="2"&&r===102)throw new Deno.errors.InvalidData("must not include encoded / characters")}return decodeURIComponent(e)}function L3(n){let e=i1.resolve(n),t=n.charCodeAt(n.length-1);(t===q3||zg&&t===j3)&&e[e.length-1]!==i1.sep&&(e+="/");let r=new URL("file://");return e.includes("%")&&(e=e.replace(K3,"%25")),!zg&&e.includes("\\")&&(e=e.replace(V3,"%5C")),e.includes(`
`)&&(e=e.replace(G3,"%0A")),e.includes("\r")&&(e=e.replace(Y3,"%0D")),e.includes("	")&&(e=e.replace(X3,"%09")),r.pathname=e,r}var N3,gg,s1,mg,yg,o1,bg,a1,wg,l1,vg,c1,_g,u1,Eg,h1,ta,f1,An,NT,D3,$3,M3,B3,U3,F3,j3,q3,H3,W3,zg,z3,K3,V3,G3,Y3,X3,Jq=ii(()=>{Oe(),Ne(),Le(),mq(),Oq(),Wq(),k3(),N3=Object.freeze(Object.create(null)),gg={},s1=!1,mg=typeof globalThis<"u"?globalThis:typeof self<"u"?self:global,yg={},o1=!1,bg={},a1=!1,wg={},l1=!1,vg={},c1=!1,_g={},u1=!1,Eg={},h1=!1,ta={},f1=!1,An=Xq(),An.parse,An.resolve,An.resolveObject,An.format,An.Url,NT=typeof Deno<"u"?Deno.build.os==="windows"?"win32":Deno.build.os:void 0,An.URL=typeof URL<"u"?URL:null,An.pathToFileURL=L3,An.fileURLToPath=O3,D3=An.Url,$3=An.format,M3=An.resolve,B3=An.resolveObject,U3=An.parse,F3=An.URL,j3=92,q3=47,H3=97,W3=122,zg=NT==="win32",z3=/\//g,K3=/%/g,V3=/\\/g,G3=/\n/g,Y3=/\r/g,X3=/\t/g}),eH=$e((n,e)=>{Oe(),Ne(),Le(),e.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}}),tS=$e(n=>{Oe(),Ne(),Le(),Object.defineProperty(n,"__esModule",{value:!0}),n.BufferedDuplex=void 0,n.writev=r;var e=Gl(),t=(Jr(),nr(Qr));function r(s,o){let a=new Array(s.length);for(let l=0;l<s.length;l++)typeof s[l].chunk=="string"?a[l]=t.Buffer.from(s[l].chunk,"utf8"):a[l]=s[l].chunk;this._write(t.Buffer.concat(a),"binary",o)}var i=class extends e.Duplex{constructor(o,a,l){super({objectMode:!0});v(this,"socket");v(this,"proxy");v(this,"isSocketOpen");v(this,"writeQueue");this.proxy=a,this.socket=l,this.writeQueue=[],o.objectMode||(this._writev=r.bind(this)),this.isSocketOpen=!1,this.proxy.on("data",c=>{!this.destroyed&&this.readable&&this.push(c)})}_read(o){this.proxy.read(o)}_write(o,a,l){this.isSocketOpen?this.writeToProxy(o,a,l):this.writeQueue.push({chunk:o,encoding:a,cb:l})}_final(o){this.writeQueue=[],this.proxy.end(o)}_destroy(o,a){this.writeQueue=[],this.proxy.destroy(),a(o)}socketReady(){this.emit("connect"),this.isSocketOpen=!0,this.processWriteQueue()}writeToProxy(o,a,l){this.proxy.write(o,a)===!1?this.proxy.once("drain",l):l()}processWriteQueue(){for(;this.writeQueue.length>0;){let{chunk:o,encoding:a,cb:l}=this.writeQueue.shift();this.writeToProxy(o,a,l)}}};n.BufferedDuplex=i}),ep=$e(n=>{Oe(),Ne(),Le();var e=n&&n.__importDefault||function(S){return S&&S.__esModule?S:{default:S}};Object.defineProperty(n,"__esModule",{value:!0}),n.streamBuilder=n.browserStreamBuilder=void 0;var t=(Jr(),nr(Qr)),r=e(eH()),i=e(yo()),s=Gl(),o=e(Cy()),a=tS(),l=(0,i.default)("mqttjs:ws"),c=["rejectUnauthorized","ca","cert","key","pfx","passphrase"];function h(S,b){let _=`${S.protocol}://${S.hostname}:${S.port}${S.path}`;return typeof S.transformWsUrl=="function"&&(_=S.transformWsUrl(_,S,b)),_}function d(S){let b=S;return S.port||(S.protocol==="wss"?b.port=443:b.port=80),S.path||(b.path="/"),S.wsOptions||(b.wsOptions={}),!o.default&&!S.forceNativeWebSocket&&S.protocol==="wss"&&c.forEach(_=>{Object.prototype.hasOwnProperty.call(S,_)&&!Object.prototype.hasOwnProperty.call(S.wsOptions,_)&&(b.wsOptions[_]=S[_])}),b}function p(S){let b=d(S);if(b.hostname||(b.hostname=b.host),!b.hostname){if(typeof document>"u")throw new Error("Could not determine host. Specify host manually.");let _=new URL(document.URL);b.hostname=_.hostname,b.port||(b.port=Number(_.port))}return b.objectMode===void 0&&(b.objectMode=!(b.binary===!0||b.binary===void 0)),b}function g(S,b,_){l("createWebSocket"),l(`protocol: ${_.protocolId} ${_.protocolVersion}`);let I=_.protocolId==="MQIsdp"&&_.protocolVersion===3?"mqttv3.1":"mqtt";l(`creating new Websocket for url: ${b} and protocol: ${I}`);let x;return _.createWebsocket?x=_.createWebsocket(b,[I],_):x=new r.default(b,[I],_.wsOptions),x}function m(S,b){let _=b.protocolId==="MQIsdp"&&b.protocolVersion===3?"mqttv3.1":"mqtt",I=h(b,S),x;return b.createWebsocket?x=b.createWebsocket(I,[_],b):x=new WebSocket(I,[_]),x.binaryType="arraybuffer",x}var E=(S,b)=>{l("streamBuilder");let _=d(b);_.hostname=_.hostname||_.host||"localhost";let I=h(_,S),x=g(S,I,_),$=r.default.createWebSocketStream(x,_.wsOptions);return $.url=I,x.on("close",()=>{$.destroy()}),$};n.streamBuilder=E;var y=(S,b)=>{l("browserStreamBuilder");let _,I=p(b).browserBufferSize||1024*512,x=b.browserBufferTimeout||1e3,$=!b.objectMode,U=m(S,b),O=M(b,L,V);b.objectMode||(O._writev=a.writev.bind(O)),O.on("close",()=>{U.close()});let P=typeof U.addEventListener<"u";U.readyState===U.OPEN?(_=O,_.socket=U):(_=new a.BufferedDuplex(b,O,U),P?U.addEventListener("open",K):U.onopen=K),P?(U.addEventListener("close",C),U.addEventListener("error",B),U.addEventListener("message",N)):(U.onclose=C,U.onerror=B,U.onmessage=N);function M(W,H,G){let z=new s.Transform({objectMode:W.objectMode});return z._write=H,z._flush=G,z}function K(){l("WebSocket onOpen"),_ instanceof a.BufferedDuplex&&_.socketReady()}function C(W){l("WebSocket onClose",W),_.end(),_.destroy()}function B(W){l("WebSocket onError",W);let H=new Error("WebSocket error");H.event=W,_.destroy(H)}async function N(W){if(!O||!O.readable||!O.writable)return;let{data:H}=W;H instanceof ArrayBuffer?H=t.Buffer.from(H):H instanceof Blob?H=t.Buffer.from(await new Response(H).arrayBuffer()):H=t.Buffer.from(H,"utf8"),O.push(H)}function L(W,H,G){if(U.bufferedAmount>I){setTimeout(L,x,W,H,G);return}$&&typeof W=="string"&&(W=t.Buffer.from(W,"utf8"));try{U.send(W)}catch(z){return G(z)}G()}function V(W){U.close(),W()}return _};n.browserStreamBuilder=y}),rS={};ju(rS,{Server:()=>br,Socket:()=>br,Stream:()=>br,_createServerHandle:()=>br,_normalizeArgs:()=>br,_setSimultaneousAccepts:()=>br,connect:()=>br,createConnection:()=>br,createServer:()=>br,default:()=>Z3,isIP:()=>br,isIPv4:()=>br,isIPv6:()=>br});function br(){throw new Error("Node.js net module is not supported by JSPM core outside of Node.js")}var Z3,Q3=ii(()=>{Oe(),Ne(),Le(),Z3={_createServerHandle:br,_normalizeArgs:br,_setSimultaneousAccepts:br,connect:br,createConnection:br,createServer:br,isIP:br,isIPv4:br,isIPv6:br,Server:br,Socket:br,Stream:br}}),J3=$e((n,e)=>{Oe(),Ne(),Le(),e.exports={}}),DT=$e(n=>{Oe(),Ne(),Le();var e=n&&n.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(n,"__esModule",{value:!0});var t=e((Q3(),nr(rS))),r=e(yo()),i=e(J3()),s=(0,r.default)("mqttjs:tcp"),o=(a,l)=>{if(l.port=l.port||1883,l.hostname=l.hostname||l.host||"localhost",l.socksProxy)return(0,i.default)(l.hostname,l.port,l.socksProxy,{timeout:l.socksTimeout});let{port:c,path:h}=l,d=l.hostname;return s("port %d and host %s",c,d),t.default.createConnection({port:c,host:d,path:h})};n.default=o}),eL={};ju(eL,{default:()=>tL});var tL,tH=ii(()=>{Oe(),Ne(),Le(),tL={}}),$T=$e(n=>{Oe(),Ne(),Le();var e=n&&n.__importDefault||function(c){return c&&c.__esModule?c:{default:c}};Object.defineProperty(n,"__esModule",{value:!0});var t=(tH(),nr(eL)),r=e((Q3(),nr(rS))),i=e(yo()),s=e(J3()),o=(0,i.default)("mqttjs:tls");function a(c){let{host:h,port:d,socksProxy:p,...g}=c;if(p!==void 0){let m=(0,s.default)(h,d,p,{timeout:c.socksTimeout});return(0,t.connect)({...g,socket:m})}return(0,t.connect)(c)}var l=(c,h)=>{h.port=h.port||8883,h.host=h.hostname||h.host||"localhost",r.default.isIP(h.host)===0&&(h.servername=h.host),h.rejectUnauthorized=h.rejectUnauthorized!==!1,delete h.path,o("port %d host %s rejectUnauthorized %b",h.port,h.host,h.rejectUnauthorized);let d=a(h);d.on("secureConnect",()=>{h.rejectUnauthorized&&!d.authorized?d.emit("error",new Error("TLS not authorized")):d.removeListener("error",p)});function p(g){h.rejectUnauthorized&&c.emit("error",g),d.end()}return d.on("error",p),d};n.default=l}),MT=$e(n=>{Oe(),Ne(),Le(),Object.defineProperty(n,"__esModule",{value:!0});var e=(Jr(),nr(Qr)),t=Gl(),r=tS(),i,s,o;function a(){let p=new t.Transform;return p._write=(g,m,E)=>{i.send({data:g.buffer,success(){E()},fail(y){E(new Error(y))}})},p._flush=g=>{i.close({success(){g()}})},p}function l(p){p.hostname||(p.hostname="localhost"),p.path||(p.path="/"),p.wsOptions||(p.wsOptions={})}function c(p,g){let m=p.protocol==="wxs"?"wss":"ws",E=`${m}://${p.hostname}${p.path}`;return p.port&&p.port!==80&&p.port!==443&&(E=`${m}://${p.hostname}:${p.port}${p.path}`),typeof p.transformWsUrl=="function"&&(E=p.transformWsUrl(E,p,g)),E}function h(){i.onOpen(()=>{o.socketReady()}),i.onMessage(p=>{let{data:g}=p;g instanceof ArrayBuffer?g=e.Buffer.from(g):g=e.Buffer.from(g,"utf8"),s.push(g)}),i.onClose(()=>{o.emit("close"),o.end(),o.destroy()}),i.onError(p=>{let g=new Error(p.errMsg);o.destroy(g)})}var d=(p,g)=>{if(g.hostname=g.hostname||g.host,!g.hostname)throw new Error("Could not determine host. Specify host manually.");let m=g.protocolId==="MQIsdp"&&g.protocolVersion===3?"mqttv3.1":"mqtt";l(g);let E=c(g,p);i=wx.connectSocket({url:E,protocols:[m]}),s=a(),o=new r.BufferedDuplex(g,s,i),o._destroy=(S,b)=>{i.close({success(){b&&b(S)}})};let y=o.destroy;return o.destroy=(S,b)=>(o.destroy=y,setTimeout(()=>{i.close({fail(){o._destroy(S,b)}})},0),o),h(),o};n.default=d}),BT=$e(n=>{Oe(),Ne(),Le(),Object.defineProperty(n,"__esModule",{value:!0});var e=(Jr(),nr(Qr)),t=Gl(),r=tS(),i,s,o,a=!1;function l(){let g=new t.Transform;return g._write=(m,E,y)=>{i.sendSocketMessage({data:m.buffer,success(){y()},fail(){y(new Error)}})},g._flush=m=>{i.closeSocket({success(){m()}})},g}function c(g){g.hostname||(g.hostname="localhost"),g.path||(g.path="/"),g.wsOptions||(g.wsOptions={})}function h(g,m){let E=g.protocol==="alis"?"wss":"ws",y=`${E}://${g.hostname}${g.path}`;return g.port&&g.port!==80&&g.port!==443&&(y=`${E}://${g.hostname}:${g.port}${g.path}`),typeof g.transformWsUrl=="function"&&(y=g.transformWsUrl(y,g,m)),y}function d(){a||(a=!0,i.onSocketOpen(()=>{o.socketReady()}),i.onSocketMessage(g=>{if(typeof g.data=="string"){let m=e.Buffer.from(g.data,"base64");s.push(m)}else{let m=new FileReader;m.addEventListener("load",()=>{if(m.result instanceof ArrayBuffer){s.push(e.Buffer.from(m.result));return}s.push(e.Buffer.from(m.result,"utf-8"))}),m.readAsArrayBuffer(g.data)}}),i.onSocketClose(()=>{o.end(),o.destroy()}),i.onSocketError(g=>{o.destroy(g)}))}var p=(g,m)=>{if(m.hostname=m.hostname||m.host,!m.hostname)throw new Error("Could not determine host. Specify host manually.");let E=m.protocolId==="MQIsdp"&&m.protocolVersion===3?"mqttv3.1":"mqtt";c(m);let y=h(m,g);return i=m.my,i.connectSocket({url:y,protocols:E}),s=l(),o=new r.BufferedDuplex(m,s,i),d(),o};n.default=p}),rH=$e(n=>{Oe(),Ne(),Le();var e=n&&n.__importDefault||function(d){return d&&d.__esModule?d:{default:d}};Object.defineProperty(n,"__esModule",{value:!0}),n.connectAsync=h;var t=e(yo()),r=e((Jq(),nr(P3))),i=e(I_()),s=e(Cy());typeof(Ut==null?void 0:Ut.nextTick)!="function"&&(Ut.nextTick=setImmediate);var o=(0,t.default)("mqttjs"),a=null;function l(d){let p;if(d.auth)if(p=d.auth.match(/^(.+):(.+)$/),p){let[,g,m]=p;d.username=g,d.password=m}else d.username=d.auth}function c(d,p){var E,y,S;if(o("connecting to an MQTT broker..."),typeof d=="object"&&!p&&(p=d,d=""),p=p||{},d&&typeof d=="string"){let b=r.default.parse(d,!0),_={};if(b.port!=null&&(_.port=Number(b.port)),_.host=b.hostname,_.query=b.query,_.auth=b.auth,_.protocol=b.protocol,_.path=b.path,p={..._,...p},!p.protocol)throw new Error("Missing protocol");p.protocol=p.protocol.replace(/:$/,"")}if(p.unixSocket=p.unixSocket||((E=p.protocol)==null?void 0:E.includes("+unix")),p.unixSocket?p.protocol=p.protocol.replace("+unix",""):!((y=p.protocol)!=null&&y.startsWith("ws"))&&!((S=p.protocol)!=null&&S.startsWith("wx"))&&delete p.path,l(p),p.query&&typeof p.query.clientId=="string"&&(p.clientId=p.query.clientId),s.default||p.unixSocket?p.socksProxy=void 0:p.socksProxy===void 0&&typeof Ut<"u"&&(p.socksProxy=Ut.env.MQTTJS_SOCKS_PROXY),p.cert&&p.key)if(p.protocol){if(["mqtts","wss","wxs","alis"].indexOf(p.protocol)===-1)switch(p.protocol){case"mqtt":p.protocol="mqtts";break;case"ws":p.protocol="wss";break;case"wx":p.protocol="wxs";break;case"ali":p.protocol="alis";break;default:throw new Error(`Unknown protocol for secure connection: "${p.protocol}"!`)}}else throw new Error("Missing secure protocol key");if(a||(a={},!s.default&&!p.forceNativeWebSocket?(a.ws=ep().streamBuilder,a.wss=ep().streamBuilder,a.mqtt=DT().default,a.tcp=DT().default,a.ssl=$T().default,a.tls=a.ssl,a.mqtts=$T().default):(a.ws=ep().browserStreamBuilder,a.wss=ep().browserStreamBuilder,a.wx=MT().default,a.wxs=MT().default,a.ali=BT().default,a.alis=BT().default)),!a[p.protocol]){let b=["mqtts","wss"].indexOf(p.protocol)!==-1;p.protocol=["mqtt","mqtts","ws","wss","wx","wxs","ali","alis"].filter((_,I)=>b&&I%2===0?!1:typeof a[_]=="function")[0]}if(p.clean===!1&&!p.clientId)throw new Error("Missing clientId for unclean clients");p.protocol&&(p.defaultProtocol=p.protocol);function g(b){return p.servers&&((!b._reconnectCount||b._reconnectCount===p.servers.length)&&(b._reconnectCount=0),p.host=p.servers[b._reconnectCount].host,p.port=p.servers[b._reconnectCount].port,p.protocol=p.servers[b._reconnectCount].protocol?p.servers[b._reconnectCount].protocol:p.defaultProtocol,p.hostname=p.host,b._reconnectCount++),o("calling streambuilder for",p.protocol),a[p.protocol](b,p)}let m=new i.default(g,p);return m.on("error",()=>{}),m}function h(d,p,g=!0){return new Promise((m,E)=>{let y=c(d,p),S={connect:_=>{b(),m(y)},end:()=>{b(),m(y)},error:_=>{b(),y.end(),E(_)}};g===!1&&(S.close=()=>{S.error(new Error("Couldn't connect to server"))});function b(){Object.keys(S).forEach(_=>{y.off(_,S[_])})}Object.keys(S).forEach(_=>{y.on(_,S[_])})})}n.default=c}),UT=$e(n=>{Oe(),Ne(),Le();var e=n&&n.__createBinding||(Object.create?function(g,m,E,y){y===void 0&&(y=E);var S=Object.getOwnPropertyDescriptor(m,E);(!S||("get"in S?!m.__esModule:S.writable||S.configurable))&&(S={enumerable:!0,get:function(){return m[E]}}),Object.defineProperty(g,y,S)}:function(g,m,E,y){y===void 0&&(y=E),g[y]=m[E]}),t=n&&n.__setModuleDefault||(Object.create?function(g,m){Object.defineProperty(g,"default",{enumerable:!0,value:m})}:function(g,m){g.default=m}),r=n&&n.__importStar||function(){var g=function(m){return g=Object.getOwnPropertyNames||function(E){var y=[];for(var S in E)Object.prototype.hasOwnProperty.call(E,S)&&(y[y.length]=S);return y},g(m)};return function(m){if(m&&m.__esModule)return m;var E={};if(m!=null)for(var y=g(m),S=0;S<y.length;S++)y[S]!=="default"&&e(E,m,y[S]);return t(E,m),E}}(),i=n&&n.__exportStar||function(g,m){for(var E in g)E!=="default"&&!Object.prototype.hasOwnProperty.call(m,E)&&e(m,g,E)},s=n&&n.__importDefault||function(g){return g&&g.__esModule?g:{default:g}};Object.defineProperty(n,"__esModule",{value:!0}),n.ReasonCodes=n.KeepaliveManager=n.UniqueMessageIdProvider=n.DefaultMessageIdProvider=n.Store=n.MqttClient=n.connectAsync=n.connect=n.Client=void 0;var o=s(I_());n.MqttClient=o.default;var a=s(y3());n.DefaultMessageIdProvider=a.default;var l=s(pq());n.UniqueMessageIdProvider=l.default;var c=s(e3());n.Store=c.default;var h=r(rH());n.connect=h.default,Object.defineProperty(n,"connectAsync",{enumerable:!0,get:function(){return h.connectAsync}});var d=s(A3());n.KeepaliveManager=d.default,n.Client=o.default,i(I_(),n),i(Hu(),n);var p=Iy();Object.defineProperty(n,"ReasonCodes",{enumerable:!0,get:function(){return p.ReasonCodes}})}),nH=$e(n=>{Oe(),Ne(),Le();var e=n&&n.__createBinding||(Object.create?function(o,a,l,c){c===void 0&&(c=l);var h=Object.getOwnPropertyDescriptor(a,l);(!h||("get"in h?!a.__esModule:h.writable||h.configurable))&&(h={enumerable:!0,get:function(){return a[l]}}),Object.defineProperty(o,c,h)}:function(o,a,l,c){c===void 0&&(c=l),o[c]=a[l]}),t=n&&n.__setModuleDefault||(Object.create?function(o,a){Object.defineProperty(o,"default",{enumerable:!0,value:a})}:function(o,a){o.default=a}),r=n&&n.__importStar||function(){var o=function(a){return o=Object.getOwnPropertyNames||function(l){var c=[];for(var h in l)Object.prototype.hasOwnProperty.call(l,h)&&(c[c.length]=h);return c},o(a)};return function(a){if(a&&a.__esModule)return a;var l={};if(a!=null)for(var c=o(a),h=0;h<c.length;h++)c[h]!=="default"&&e(l,a,c[h]);return t(l,a),l}}(),i=n&&n.__exportStar||function(o,a){for(var l in o)l!=="default"&&!Object.prototype.hasOwnProperty.call(a,l)&&e(a,o,l)};Object.defineProperty(n,"__esModule",{value:!0});var s=r(UT());n.default=s,i(UT(),n)});const iH=nH();/*! Bundled license information:

@jspm/core/nodelibs/browser/chunk-DtuTasat.js:
  (*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> *)

safe-buffer/index.js:
  (*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> *)

@babel/runtime/helpers/regenerator.js:
  (*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE *)
*/const sH=4,vc={},FT=({options:n})=>n.host+n.path,oH=Ey({init:n=>vO(n,aH,sH).map(e=>{const t=iH.connect(e),r=FT(t);return t.stream.socket,vc[r]={},t.on("message",(i,s)=>{var o,a;return(a=(o=vc[r])[i])==null?void 0:a.call(o,i,s.toString())}).on("error",i=>console.error(i)),new Promise(i=>t.on("connect",()=>i(t)))}),subscribe:(n,e,t,r)=>{const i=FT(n);return vc[i][e]=vc[i][t]=(s,o)=>r(s,o,n.publish.bind(n)),n.subscribe(e),n.subscribe(t),()=>{n.unsubscribe(e),n.unsubscribe(t),delete vc[i][e],delete vc[i][t]}},announce:(n,e)=>n.publish(e,Ll({peerId:bi}))}),aH=["test.mosquitto.org:8081/mqtt","broker.emqx.io:8084/mqtt","broker.hivemq.com:8884/mqtt"].map(n=>"wss://"+n);function Je(n=0){return new Uint8Array(n)}function Ei(n=0){return new Uint8Array(n)}const lH=Math.pow(2,7),cH=Math.pow(2,14),uH=Math.pow(2,21),nS=Math.pow(2,28),iS=Math.pow(2,35),sS=Math.pow(2,42),oS=Math.pow(2,49),Xt=128,Tn=127;function un(n){if(n<lH)return 1;if(n<cH)return 2;if(n<uH)return 3;if(n<nS)return 4;if(n<iS)return 5;if(n<sS)return 6;if(n<oS)return 7;if(Number.MAX_SAFE_INTEGER!=null&&n>Number.MAX_SAFE_INTEGER)throw new RangeError("Could not encode varint");return 8}function Kg(n,e,t=0){switch(un(n)){case 8:e[t++]=n&255|Xt,n/=128;case 7:e[t++]=n&255|Xt,n/=128;case 6:e[t++]=n&255|Xt,n/=128;case 5:e[t++]=n&255|Xt,n/=128;case 4:e[t++]=n&255|Xt,n>>>=7;case 3:e[t++]=n&255|Xt,n>>>=7;case 2:e[t++]=n&255|Xt,n>>>=7;case 1:{e[t++]=n&255,n>>>=7;break}default:throw new Error("unreachable")}return e}function hH(n,e,t=0){switch(un(n)){case 8:e.set(t++,n&255|Xt),n/=128;case 7:e.set(t++,n&255|Xt),n/=128;case 6:e.set(t++,n&255|Xt),n/=128;case 5:e.set(t++,n&255|Xt),n/=128;case 4:e.set(t++,n&255|Xt),n>>>=7;case 3:e.set(t++,n&255|Xt),n>>>=7;case 2:e.set(t++,n&255|Xt),n>>>=7;case 1:{e.set(t++,n&255),n>>>=7;break}default:throw new Error("unreachable")}return e}function rL(n,e){let t=n[e],r=0;if(r+=t&Tn,t<Xt||(t=n[e+1],r+=(t&Tn)<<7,t<Xt)||(t=n[e+2],r+=(t&Tn)<<14,t<Xt)||(t=n[e+3],r+=(t&Tn)<<21,t<Xt)||(t=n[e+4],r+=(t&Tn)*nS,t<Xt)||(t=n[e+5],r+=(t&Tn)*iS,t<Xt)||(t=n[e+6],r+=(t&Tn)*sS,t<Xt)||(t=n[e+7],r+=(t&Tn)*oS,t<Xt))return r;throw new RangeError("Could not decode varint")}function fH(n,e){let t=n.get(e),r=0;if(r+=t&Tn,t<Xt||(t=n.get(e+1),r+=(t&Tn)<<7,t<Xt)||(t=n.get(e+2),r+=(t&Tn)<<14,t<Xt)||(t=n.get(e+3),r+=(t&Tn)<<21,t<Xt)||(t=n.get(e+4),r+=(t&Tn)*nS,t<Xt)||(t=n.get(e+5),r+=(t&Tn)*iS,t<Xt)||(t=n.get(e+6),r+=(t&Tn)*sS,t<Xt)||(t=n.get(e+7),r+=(t&Tn)*oS,t<Xt))return r;throw new RangeError("Could not decode varint")}function Ts(n,e,t=0){return e==null&&(e=Ei(un(n))),e instanceof Uint8Array?Kg(n,e,t):hH(n,e,t)}function Wf(n,e=0){return n instanceof Uint8Array?rL(n,e):fH(n,e)}const aS=new Float32Array([-0]),fa=new Uint8Array(aS.buffer);function dH(n,e,t){aS[0]=n,e[t]=fa[0],e[t+1]=fa[1],e[t+2]=fa[2],e[t+3]=fa[3]}function pH(n,e){return fa[0]=n[e],fa[1]=n[e+1],fa[2]=n[e+2],fa[3]=n[e+3],aS[0]}const lS=new Float64Array([-0]),Cn=new Uint8Array(lS.buffer);function gH(n,e,t){lS[0]=n,e[t]=Cn[0],e[t+1]=Cn[1],e[t+2]=Cn[2],e[t+3]=Cn[3],e[t+4]=Cn[4],e[t+5]=Cn[5],e[t+6]=Cn[6],e[t+7]=Cn[7]}function mH(n,e){return Cn[0]=n[e],Cn[1]=n[e+1],Cn[2]=n[e+2],Cn[3]=n[e+3],Cn[4]=n[e+4],Cn[5]=n[e+5],Cn[6]=n[e+6],Cn[7]=n[e+7],lS[0]}const yH=BigInt(Number.MAX_SAFE_INTEGER),bH=BigInt(Number.MIN_SAFE_INTEGER);class kn{constructor(e,t){v(this,"lo");v(this,"hi");this.lo=e|0,this.hi=t|0}toNumber(e=!1){if(!e&&this.hi>>>31>0){const t=~this.lo+1>>>0;let r=~this.hi>>>0;return t===0&&(r=r+1>>>0),-(t+r*4294967296)}return this.lo+this.hi*4294967296}toBigInt(e=!1){if(e)return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n);if(this.hi>>>31){const t=~this.lo+1>>>0;let r=~this.hi>>>0;return t===0&&(r=r+1>>>0),-(BigInt(t)+(BigInt(r)<<32n))}return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n)}toString(e=!1){return this.toBigInt(e).toString()}zzEncode(){const e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this}zzDecode(){const e=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this}length(){const e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,r=this.hi>>>24;return r===0?t===0?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:r<128?9:10}static fromBigInt(e){if(e===0n)return Il;if(e<yH&&e>bH)return this.fromNumber(Number(e));const t=e<0n;t&&(e=-e);let r=e>>32n,i=e-(r<<32n);return t&&(r=~r|0n,i=~i|0n,++i>jT&&(i=0n,++r>jT&&(r=0n))),new kn(Number(i),Number(r))}static fromNumber(e){if(e===0)return Il;const t=e<0;t&&(e=-e);let r=e>>>0,i=(e-r)/4294967296>>>0;return t&&(i=~i>>>0,r=~r>>>0,++r>4294967295&&(r=0,++i>4294967295&&(i=0))),new kn(r,i)}static from(e){return typeof e=="number"?kn.fromNumber(e):typeof e=="bigint"?kn.fromBigInt(e):typeof e=="string"?kn.fromBigInt(BigInt(e)):e.low!=null||e.high!=null?new kn(e.low>>>0,e.high>>>0):Il}}const Il=new kn(0,0);Il.toBigInt=function(){return 0n};Il.zzEncode=Il.zzDecode=function(){return this};Il.length=function(){return 1};const jT=4294967296n;function wH(n){let e=0,t=0;for(let r=0;r<n.length;++r)t=n.charCodeAt(r),t<128?e+=1:t<2048?e+=2:(t&64512)===55296&&(n.charCodeAt(r+1)&64512)===56320?(++r,e+=4):e+=3;return e}function vH(n,e,t){if(t-e<1)return"";let i;const s=[];let o=0,a;for(;e<t;)a=n[e++],a<128?s[o++]=a:a>191&&a<224?s[o++]=(a&31)<<6|n[e++]&63:a>239&&a<365?(a=((a&7)<<18|(n[e++]&63)<<12|(n[e++]&63)<<6|n[e++]&63)-65536,s[o++]=55296+(a>>10),s[o++]=56320+(a&1023)):s[o++]=(a&15)<<12|(n[e++]&63)<<6|n[e++]&63,o>8191&&((i??(i=[])).push(String.fromCharCode.apply(String,s)),o=0);return i!=null?(o>0&&i.push(String.fromCharCode.apply(String,s.slice(0,o))),i.join("")):String.fromCharCode.apply(String,s.slice(0,o))}function nL(n,e,t){const r=t;let i,s;for(let o=0;o<n.length;++o)i=n.charCodeAt(o),i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):(i&64512)===55296&&((s=n.charCodeAt(o+1))&64512)===56320?(i=65536+((i&1023)<<10)+(s&1023),++o,e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128);return t-r}function Yi(n,e){return RangeError(`index out of range: ${n.pos} + ${e??1} > ${n.len}`)}function tp(n,e){return(n[e-4]|n[e-3]<<8|n[e-2]<<16|n[e-1]<<24)>>>0}class _H{constructor(e){v(this,"buf");v(this,"pos");v(this,"len");v(this,"_slice",Uint8Array.prototype.subarray);this.buf=e,this.pos=0,this.len=e.length}uint32(){let e=4294967295;if(e=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(e=(e|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,Yi(this,10);return e}int32(){return this.uint32()|0}sint32(){const e=this.uint32();return e>>>1^-(e&1)|0}bool(){return this.uint32()!==0}fixed32(){if(this.pos+4>this.len)throw Yi(this,4);return tp(this.buf,this.pos+=4)}sfixed32(){if(this.pos+4>this.len)throw Yi(this,4);return tp(this.buf,this.pos+=4)|0}float(){if(this.pos+4>this.len)throw Yi(this,4);const e=pH(this.buf,this.pos);return this.pos+=4,e}double(){if(this.pos+8>this.len)throw Yi(this,4);const e=mH(this.buf,this.pos);return this.pos+=8,e}bytes(){const e=this.uint32(),t=this.pos,r=this.pos+e;if(r>this.len)throw Yi(this,e);return this.pos+=e,t===r?new Uint8Array(0):this.buf.subarray(t,r)}string(){const e=this.bytes();return vH(e,0,e.length)}skip(e){if(typeof e=="number"){if(this.pos+e>this.len)throw Yi(this,e);this.pos+=e}else do if(this.pos>=this.len)throw Yi(this);while(this.buf[this.pos++]&128);return this}skipType(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(e=this.uint32()&7)!==4;)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error(`invalid wire type ${e} at offset ${this.pos}`)}return this}readLongVarint(){const e=new kn(0,0);let t=0;if(this.len-this.pos>4){for(;t<4;++t)if(e.lo=(e.lo|(this.buf[this.pos]&127)<<t*7)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(this.buf[this.pos]&127)<<28)>>>0,e.hi=(e.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return e;t=0}else{for(;t<3;++t){if(this.pos>=this.len)throw Yi(this);if(e.lo=(e.lo|(this.buf[this.pos]&127)<<t*7)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(this.buf[this.pos++]&127)<<t*7)>>>0,e}if(this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(this.buf[this.pos]&127)<<t*7+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw Yi(this);if(e.hi=(e.hi|(this.buf[this.pos]&127)<<t*7+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}readFixed64(){if(this.pos+8>this.len)throw Yi(this,8);const e=tp(this.buf,this.pos+=4),t=tp(this.buf,this.pos+=4);return new kn(e,t)}int64(){return this.readLongVarint().toBigInt()}int64Number(){return this.readLongVarint().toNumber()}int64String(){return this.readLongVarint().toString()}uint64(){return this.readLongVarint().toBigInt(!0)}uint64Number(){const e=rL(this.buf,this.pos);return this.pos+=un(e),e}uint64String(){return this.readLongVarint().toString(!0)}sint64(){return this.readLongVarint().zzDecode().toBigInt()}sint64Number(){return this.readLongVarint().zzDecode().toNumber()}sint64String(){return this.readLongVarint().zzDecode().toString()}fixed64(){return this.readFixed64().toBigInt()}fixed64Number(){return this.readFixed64().toNumber()}fixed64String(){return this.readFixed64().toString()}sfixed64(){return this.readFixed64().toBigInt()}sfixed64Number(){return this.readFixed64().toNumber()}sfixed64String(){return this.readFixed64().toString()}}function EH(n){return new _H(n instanceof Uint8Array?n:n.subarray())}function ft(n,e,t){const r=EH(n);return e.decode(r,void 0,t)}function SH(n,e){if(n===e)return!0;if(n.byteLength!==e.byteLength)return!1;for(let t=0;t<n.byteLength;t++)if(n[t]!==e[t])return!1;return!0}function ky(n){if(n instanceof Uint8Array&&n.constructor.name==="Uint8Array")return n;if(n instanceof ArrayBuffer)return new Uint8Array(n);if(ArrayBuffer.isView(n))return new Uint8Array(n.buffer,n.byteOffset,n.byteLength);throw new Error("Unknown type, must be binary type")}function AH(n){return new TextEncoder().encode(n)}function xH(n){return new TextDecoder().decode(n)}function IH(n,e){if(n.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),r=0;r<t.length;r++)t[r]=255;for(var i=0;i<n.length;i++){var s=n.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=n.length,l=n.charAt(0),c=Math.log(a)/Math.log(256),h=Math.log(256)/Math.log(a);function d(m){if(m instanceof Uint8Array||(ArrayBuffer.isView(m)?m=new Uint8Array(m.buffer,m.byteOffset,m.byteLength):Array.isArray(m)&&(m=Uint8Array.from(m))),!(m instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(m.length===0)return"";for(var E=0,y=0,S=0,b=m.length;S!==b&&m[S]===0;)S++,E++;for(var _=(b-S)*h+1>>>0,I=new Uint8Array(_);S!==b;){for(var x=m[S],$=0,U=_-1;(x!==0||$<y)&&U!==-1;U--,$++)x+=256*I[U]>>>0,I[U]=x%a>>>0,x=x/a>>>0;if(x!==0)throw new Error("Non-zero carry");y=$,S++}for(var O=_-y;O!==_&&I[O]===0;)O++;for(var P=l.repeat(E);O<_;++O)P+=n.charAt(I[O]);return P}function p(m){if(typeof m!="string")throw new TypeError("Expected String");if(m.length===0)return new Uint8Array;var E=0;if(m[E]!==" "){for(var y=0,S=0;m[E]===l;)y++,E++;for(var b=(m.length-E)*c+1>>>0,_=new Uint8Array(b);m[E];){var I=t[m.charCodeAt(E)];if(I===255)return;for(var x=0,$=b-1;(I!==0||x<S)&&$!==-1;$--,x++)I+=a*_[$]>>>0,_[$]=I%256>>>0,I=I/256>>>0;if(I!==0)throw new Error("Non-zero carry");S=x,E++}if(m[E]!==" "){for(var U=b-S;U!==b&&_[U]===0;)U++;for(var O=new Uint8Array(y+(b-U)),P=y;U!==b;)O[P++]=_[U++];return O}}}function g(m){var E=p(m);if(E)return E;throw new Error(`Non-${e} character`)}return{encode:d,decodeUnsafe:p,decode:g}}var TH=IH,CH=TH;let kH=class{constructor(e,t,r){v(this,"name");v(this,"prefix");v(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},PH=class{constructor(e,t,r){v(this,"name");v(this,"prefix");v(this,"baseDecode");v(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=r}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return iL(this,e)}};class RH{constructor(e){v(this,"decoders");this.decoders=e}or(e){return iL(this,e)}decode(e){const t=e[0],r=this.decoders[t];if(r!=null)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}function iL(n,e){return new RH({...n.decoders??{[n.prefix]:n},...e.decoders??{[e.prefix]:e}})}class OH{constructor(e,t,r,i){v(this,"name");v(this,"prefix");v(this,"baseEncode");v(this,"baseDecode");v(this,"encoder");v(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=i,this.encoder=new kH(e,t,r),this.decoder=new PH(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}function Py({name:n,prefix:e,encode:t,decode:r}){return new OH(n,e,t,r)}function zf({name:n,prefix:e,alphabet:t}){const{encode:r,decode:i}=CH(t,n);return Py({prefix:e,name:n,encode:r,decode:s=>ky(i(s))})}function LH(n,e,t,r){let i=n.length;for(;n[i-1]==="=";)--i;const s=new Uint8Array(i*t/8|0);let o=0,a=0,l=0;for(let c=0;c<i;++c){const h=e[n[c]];if(h===void 0)throw new SyntaxError(`Non-${r} character`);a=a<<t|h,o+=t,o>=8&&(o-=8,s[l++]=255&a>>o)}if(o>=t||255&a<<8-o)throw new SyntaxError("Unexpected end of data");return s}function NH(n,e,t){const r=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let l=0;l<n.length;++l)for(a=a<<8|n[l],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),r)for(;s.length*t&7;)s+="=";return s}function DH(n){const e={};for(let t=0;t<n.length;++t)e[n[t]]=t;return e}function gn({name:n,prefix:e,bitsPerChar:t,alphabet:r}){const i=DH(r);return Py({prefix:e,name:n,encode(s){return NH(s,r,t)},decode(s){return LH(s,i,t,n)}})}const $H=zf({prefix:"9",name:"base10",alphabet:"0123456789"}),MH=Object.freeze(Object.defineProperty({__proto__:null,base10:$H},Symbol.toStringTag,{value:"Module"})),BH=gn({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),UH=gn({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),FH=Object.freeze(Object.defineProperty({__proto__:null,base16:BH,base16upper:UH},Symbol.toStringTag,{value:"Module"})),jH=gn({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),qH=Object.freeze(Object.defineProperty({__proto__:null,base2:jH},Symbol.toStringTag,{value:"Module"})),sL=Array.from(""),HH=sL.reduce((n,e,t)=>(n[t]=e,n),[]),WH=sL.reduce((n,e,t)=>{const r=e.codePointAt(0);if(r==null)throw new Error(`Invalid character: ${e}`);return n[r]=t,n},[]);function zH(n){return n.reduce((e,t)=>(e+=HH[t],e),"")}function KH(n){const e=[];for(const t of n){const r=t.codePointAt(0);if(r==null)throw new Error(`Invalid character: ${t}`);const i=WH[r];if(i==null)throw new Error(`Non-base256emoji character: ${t}`);e.push(i)}return new Uint8Array(e)}const VH=Py({prefix:"",name:"base256emoji",encode:zH,decode:KH}),GH=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:VH},Symbol.toStringTag,{value:"Module"})),ba=gn({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),YH=gn({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),XH=gn({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),ZH=gn({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),QH=gn({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),JH=gn({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),eW=gn({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),tW=gn({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),rW=gn({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),nW=Object.freeze(Object.defineProperty({__proto__:null,base32:ba,base32hex:QH,base32hexpad:eW,base32hexpadupper:tW,base32hexupper:JH,base32pad:XH,base32padupper:ZH,base32upper:YH,base32z:rW},Symbol.toStringTag,{value:"Module"})),Sg=zf({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),iW=zf({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),sW=Object.freeze(Object.defineProperty({__proto__:null,base36:Sg,base36upper:iW},Symbol.toStringTag,{value:"Module"})),_r=zf({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),oW=zf({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),aW=Object.freeze(Object.defineProperty({__proto__:null,base58btc:_r,base58flickr:oW},Symbol.toStringTag,{value:"Module"})),oL=gn({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),lW=gn({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),cS=gn({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),cW=gn({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),uW=Object.freeze(Object.defineProperty({__proto__:null,base64:oL,base64pad:lW,base64url:cS,base64urlpad:cW},Symbol.toStringTag,{value:"Module"})),hW=gn({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),fW=Object.freeze(Object.defineProperty({__proto__:null,base8:hW},Symbol.toStringTag,{value:"Module"})),dW=Py({prefix:"\0",name:"identity",encode:n=>xH(n),decode:n=>AH(n)}),pW=Object.freeze(Object.defineProperty({__proto__:null,identity:dW},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;var gW=aL,qT=128,mW=-128,yW=Math.pow(2,31);function aL(n,e,t){e=e||[],t=t||0;for(var r=t;n>=yW;)e[t++]=n&255|qT,n/=128;for(;n&mW;)e[t++]=n&255|qT,n>>>=7;return e[t]=n|0,aL.bytes=t-r+1,e}var bW=d1,wW=128,HT=127;function d1(n,r){var t=0,r=r||0,i=0,s=r,o,a=n.length;do{if(s>=a)throw d1.bytes=0,new RangeError("Could not decode varint");o=n[s++],t+=i<28?(o&HT)<<i:(o&HT)*Math.pow(2,i),i+=7}while(o>=wW);return d1.bytes=s-r,t}var vW=Math.pow(2,7),_W=Math.pow(2,14),EW=Math.pow(2,21),SW=Math.pow(2,28),AW=Math.pow(2,35),xW=Math.pow(2,42),IW=Math.pow(2,49),TW=Math.pow(2,56),CW=Math.pow(2,63),kW=function(n){return n<vW?1:n<_W?2:n<EW?3:n<SW?4:n<AW?5:n<xW?6:n<IW?7:n<TW?8:n<CW?9:10},PW={encode:gW,decode:bW,encodingLength:kW},Vg=PW;function p1(n,e=0){return[Vg.decode(n,e),Vg.decode.bytes]}function Gg(n,e,t=0){return Vg.encode(n,e,t),e}function Yg(n){return Vg.encodingLength(n)}function Kf(n,e){const t=e.byteLength,r=Yg(n),i=r+Yg(t),s=new Uint8Array(i+t);return Gg(n,s,0),Gg(t,s,r),s.set(e,i),new uS(n,t,e,s)}function Ry(n){const e=ky(n),[t,r]=p1(e),[i,s]=p1(e.subarray(r)),o=e.subarray(r+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new uS(t,i,o,e)}function RW(n,e){if(n===e)return!0;{const t=e;return n.code===t.code&&n.size===t.size&&t.bytes instanceof Uint8Array&&SH(n.bytes,t.bytes)}}class uS{constructor(e,t,r,i){v(this,"code");v(this,"size");v(this,"digest");v(this,"bytes");this.code=e,this.size=t,this.digest=r,this.bytes=i}}const lL=0,OW="identity",cL=ky;function LW(n,e){if((e==null?void 0:e.truncate)!=null&&e.truncate!==n.byteLength){if(e.truncate<0||e.truncate>n.byteLength)throw new Error(`Invalid truncate option, must be less than or equal to ${n.byteLength}`);n=n.subarray(0,e.truncate)}return Kf(lL,cL(n))}const Ia={code:lL,name:OW,encode:cL,digest:LW},NW=20;function DW({name:n,code:e,encode:t,minDigestLength:r,maxDigestLength:i}){return new $W(n,e,t,r,i)}class $W{constructor(e,t,r,i,s){v(this,"name");v(this,"code");v(this,"encode");v(this,"minDigestLength");v(this,"maxDigestLength");this.name=e,this.code=t,this.encode=r,this.minDigestLength=i??NW,this.maxDigestLength=s}digest(e,t){if((t==null?void 0:t.truncate)!=null){if(t.truncate<this.minDigestLength)throw new Error(`Invalid truncate option, must be greater than or equal to ${this.minDigestLength}`);if(this.maxDigestLength!=null&&t.truncate>this.maxDigestLength)throw new Error(`Invalid truncate option, must be less than or equal to ${this.maxDigestLength}`)}if(e instanceof Uint8Array){const r=this.encode(e);return r instanceof Uint8Array?WT(r,this.code,t==null?void 0:t.truncate):r.then(i=>WT(i,this.code,t==null?void 0:t.truncate))}else throw Error("Unknown type, must be binary type")}}function WT(n,e,t){if(t!=null&&t!==n.byteLength){if(t>n.byteLength)throw new Error(`Invalid truncate option, must be less than or equal to ${n.byteLength}`);n=n.subarray(0,t)}return Kf(e,n)}function MW(n){return async e=>new Uint8Array(await crypto.subtle.digest(n,e))}const hS=DW({name:"sha2-256",code:18,encode:MW("SHA-256")});function zT(n,e){const{bytes:t,version:r}=n;switch(r){case 0:return UW(t,g1(n),e??_r.encoder);default:return FW(t,g1(n),e??ba.encoder)}}const KT=new WeakMap;function g1(n){const e=KT.get(n);if(e==null){const t=new Map;return KT.set(n,t),t}return e}var TR;class zt{constructor(e,t,r,i){v(this,"code");v(this,"version");v(this,"multihash");v(this,"bytes");v(this,"/");v(this,TR,"CID");this.code=t,this.version=e,this.multihash=r,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==mh)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==jW)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return zt.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,r=Kf(e,t);return zt.createV1(this.code,r)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return zt.equals(this,e)}static equals(e,t){const r=t;return r!=null&&e.code===r.code&&e.version===r.version&&RW(e.multihash,r.multihash)}toString(e){return zT(this,e)}toJSON(){return{"/":zT(this)}}link(){return this}[(TR=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof zt)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:r,code:i,multihash:s,bytes:o}=t;return new zt(r,i,s,o??VT(r,i,s.bytes))}else if(t[qW]===!0){const{version:r,multihash:i,code:s}=t,o=Ry(i);return zt.create(r,s,o)}else return null}static create(e,t,r){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(r.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==mh)throw new Error(`Version 0 CID must use dag-pb (code: ${mh}) block encoding`);return new zt(e,t,r,r.bytes)}case 1:{const i=VT(e,t,r.bytes);return new zt(e,t,r,i)}default:throw new Error("Invalid version")}}static createV0(e){return zt.create(0,mh,e)}static createV1(e,t){return zt.create(1,e,t)}static decode(e){const[t,r]=zt.decodeFirst(e);if(r.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=zt.inspectBytes(e),r=t.size-t.multihashSize,i=ky(e.subarray(r,r+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=i.subarray(t.multihashSize-t.digestSize),o=new uS(t.multihashCode,t.digestSize,s,i);return[t.version===0?zt.createV0(o):zt.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const r=()=>{const[d,p]=p1(e.subarray(t));return t+=p,d};let i=r(),s=mh;if(i===18?(i=0,t=0):s=r(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);const o=t,a=r(),l=r(),c=t+l,h=c-o;return{version:i,codec:s,multihashCode:a,digestSize:l,multihashSize:h,size:c}}static parse(e,t){const[r,i]=BW(e,t),s=zt.decode(i);if(s.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return g1(s).set(r,e),s}}function BW(n,e){switch(n[0]){case"Q":{const t=e??_r;return[_r.prefix,t.decode(`${_r.prefix}${n}`)]}case _r.prefix:{const t=e??_r;return[_r.prefix,t.decode(n)]}case ba.prefix:{const t=e??ba;return[ba.prefix,t.decode(n)]}case Sg.prefix:{const t=e??Sg;return[Sg.prefix,t.decode(n)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[n[0],e.decode(n)]}}}function UW(n,e,t){const{prefix:r}=t;if(r!==_r.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const i=e.get(r);if(i==null){const s=t.encode(n).slice(1);return e.set(r,s),s}else return i}function FW(n,e,t){const{prefix:r}=t,i=e.get(r);if(i==null){const s=t.encode(n);return e.set(r,s),s}else return i}const mh=112,jW=18;function VT(n,e,t){const r=Yg(n),i=r+Yg(e),s=new Uint8Array(i+t.byteLength);return Gg(n,s,0),Gg(e,s,r),s.set(t,i),s}const qW=Symbol.for("@ipld/js-cid/CID"),m1={...pW,...qH,...fW,...MH,...FH,...nW,...sW,...aW,...uW,...GH};function uL(n,e,t,r){return{name:n,prefix:e,encoder:{name:n,prefix:e,encode:t},decoder:{decode:r}}}const GT=uL("utf8","u",n=>"u"+new TextDecoder("utf8").decode(n),n=>new TextEncoder().encode(n.substring(1))),N0=uL("ascii","a",n=>{let e="a";for(let t=0;t<n.length;t++)e+=String.fromCharCode(n[t]);return e},n=>{n=n.substring(1);const e=Ei(n.length);for(let t=0;t<n.length;t++)e[t]=n.charCodeAt(t);return e}),hL={utf8:GT,"utf-8":GT,hex:m1.base16,latin1:N0,ascii:N0,binary:N0,...m1};function at(n,e="utf8"){const t=hL[e];if(t==null)throw new Error(`Unsupported encoding "${e}"`);return t.decoder.decode(`${t.prefix}${n}`)}function HW(n){let r,i=8192;return function(o){if(o<1||o>4096)return Ei(o);i+o>8192&&(r=Ei(8192),i=0);const a=r.subarray(i,i+=o);return i&7&&(i=(i|7)+1),a}}class Rh{constructor(e,t,r){v(this,"fn");v(this,"len");v(this,"next");v(this,"val");this.fn=e,this.len=t,this.next=void 0,this.val=r}}function D0(){}class WW{constructor(e){v(this,"head");v(this,"tail");v(this,"len");v(this,"next");this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}}const zW=HW();function KW(n){return globalThis.Buffer!=null?Ei(n):zW(n)}class y1{constructor(){v(this,"len");v(this,"head");v(this,"tail");v(this,"states");this.len=0,this.head=new Rh(D0,0,0),this.tail=this.head,this.states=null}_push(e,t,r){return this.tail=this.tail.next=new Rh(e,t,r),this.len+=t,this}uint32(e){return this.len+=(this.tail=this.tail.next=new GW((e=e>>>0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this}int32(e){return e<0?this._push(rp,10,kn.fromNumber(e)):this.uint32(e)}sint32(e){return this.uint32((e<<1^e>>31)>>>0)}uint64(e){const t=kn.fromBigInt(e);return this._push(rp,t.length(),t)}uint64Number(e){return this._push(Kg,un(e),e)}uint64String(e){return this.uint64(BigInt(e))}int64(e){return this.uint64(e)}int64Number(e){return this.uint64Number(e)}int64String(e){return this.uint64String(e)}sint64(e){const t=kn.fromBigInt(e).zzEncode();return this._push(rp,t.length(),t)}sint64Number(e){const t=kn.fromNumber(e).zzEncode();return this._push(rp,t.length(),t)}sint64String(e){return this.sint64(BigInt(e))}bool(e){return this._push($0,1,e?1:0)}fixed32(e){return this._push(yh,4,e>>>0)}sfixed32(e){return this.fixed32(e)}fixed64(e){const t=kn.fromBigInt(e);return this._push(yh,4,t.lo)._push(yh,4,t.hi)}fixed64Number(e){const t=kn.fromNumber(e);return this._push(yh,4,t.lo)._push(yh,4,t.hi)}fixed64String(e){return this.fixed64(BigInt(e))}sfixed64(e){return this.fixed64(e)}sfixed64Number(e){return this.fixed64Number(e)}sfixed64String(e){return this.fixed64String(e)}float(e){return this._push(dH,4,e)}double(e){return this._push(gH,8,e)}bytes(e){const t=e.length>>>0;return t===0?this._push($0,1,0):this.uint32(t)._push(YW,t,e)}string(e){const t=wH(e);return t!==0?this.uint32(t)._push(nL,t,e):this._push($0,1,0)}fork(){return this.states=new WW(this),this.head=this.tail=new Rh(D0,0,0),this.len=0,this}reset(){return this.states!=null?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Rh(D0,0,0),this.len=0),this}ldelim(){const e=this.head,t=this.tail,r=this.len;return this.reset().uint32(r),r!==0&&(this.tail.next=e.next,this.tail=t,this.len+=r),this}finish(){let e=this.head.next;const t=KW(this.len);let r=0;for(;e!=null;)e.fn(e.val,t,r),r+=e.len,e=e.next;return t}}function $0(n,e,t){e[t]=n&255}function VW(n,e,t){for(;n>127;)e[t++]=n&127|128,n>>>=7;e[t]=n}class GW extends Rh{constructor(t,r){super(VW,t,r);v(this,"next");this.next=void 0}}function rp(n,e,t){for(;n.hi!==0;)e[t++]=n.lo&127|128,n.lo=(n.lo>>>7|n.hi<<25)>>>0,n.hi>>>=7;for(;n.lo>127;)e[t++]=n.lo&127|128,n.lo=n.lo>>>7;e[t++]=n.lo}function yh(n,e,t){e[t]=n&255,e[t+1]=n>>>8&255,e[t+2]=n>>>16&255,e[t+3]=n>>>24}function YW(n,e,t){e.set(n,t)}globalThis.Buffer!=null&&(y1.prototype.bytes=function(n){const e=n.length>>>0;return this.uint32(e),e>0&&this._push(XW,e,n),this},y1.prototype.string=function(n){const e=globalThis.Buffer.byteLength(n);return this.uint32(e),e>0&&this._push(ZW,e,n),this});function XW(n,e,t){e.set(n,t)}function ZW(n,e,t){n.length<40?nL(n,e,t):e.utf8Write!=null?e.utf8Write(n,t):e.set(at(n),t)}function QW(){return new y1}function dt(n,e){const t=QW();return e.encode(n,t,{lengthDelimited:!1}),t.finish()}var Xg;(function(n){n[n.VARINT=0]="VARINT",n[n.BIT64=1]="BIT64",n[n.LENGTH_DELIMITED=2]="LENGTH_DELIMITED",n[n.START_GROUP=3]="START_GROUP",n[n.END_GROUP=4]="END_GROUP",n[n.BIT32=5]="BIT32"})(Xg||(Xg={}));function fL(n,e,t,r){return{name:n,type:e,encode:t,decode:r}}function fS(n){function e(i){if(n[i.toString()]==null)throw new Error("Invalid enum value");return n[i]}const t=function(s,o){const a=e(s);o.int32(a)},r=function(s){const o=s.int32();return e(o)};return fL("enum",Xg.VARINT,t,r)}function pt(n,e){return fL("message",Xg.LENGTH_DELIMITED,n,e)}class dn extends Error{constructor(){super(...arguments);v(this,"code","ERR_MAX_LENGTH");v(this,"name","MaxLengthError")}}class YT extends Error{constructor(){super(...arguments);v(this,"code","ERR_MAX_SIZE");v(this,"name","MaxSizeError")}}var Zg;(function(n){let e;n.codec=()=>(e==null&&(e=pt((t,r,i={})=>{i.lengthDelimited!==!1&&r.fork(),t.proof!=null&&t.proof.byteLength>0&&(r.uint32(10),r.bytes(t.proof)),t.merkleRoot!=null&&t.merkleRoot.byteLength>0&&(r.uint32(18),r.bytes(t.merkleRoot)),t.epoch!=null&&t.epoch.byteLength>0&&(r.uint32(26),r.bytes(t.epoch)),t.shareX!=null&&t.shareX.byteLength>0&&(r.uint32(34),r.bytes(t.shareX)),t.shareY!=null&&t.shareY.byteLength>0&&(r.uint32(42),r.bytes(t.shareY)),t.nullifier!=null&&t.nullifier.byteLength>0&&(r.uint32(50),r.bytes(t.nullifier)),t.rlnIdentifier!=null&&t.rlnIdentifier.byteLength>0&&(r.uint32(58),r.bytes(t.rlnIdentifier)),i.lengthDelimited!==!1&&r.ldelim()},(t,r,i={})=>{const s={proof:Je(0),merkleRoot:Je(0),epoch:Je(0),shareX:Je(0),shareY:Je(0),nullifier:Je(0),rlnIdentifier:Je(0)},o=r==null?t.len:t.pos+r;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.proof=t.bytes();break}case 2:{s.merkleRoot=t.bytes();break}case 3:{s.epoch=t.bytes();break}case 4:{s.shareX=t.bytes();break}case 5:{s.shareY=t.bytes();break}case 6:{s.nullifier=t.bytes();break}case 7:{s.rlnIdentifier=t.bytes();break}default:{t.skipType(a&7);break}}}return s})),e),n.encode=t=>dt(t,n.codec()),n.decode=(t,r)=>ft(t,n.codec(),r)})(Zg||(Zg={}));var Qg;(function(n){let e;n.codec=()=>(e==null&&(e=pt((t,r,i={})=>{i.lengthDelimited!==!1&&r.fork(),t.payload!=null&&t.payload.byteLength>0&&(r.uint32(10),r.bytes(t.payload)),t.contentTopic!=null&&t.contentTopic!==""&&(r.uint32(18),r.string(t.contentTopic)),t.version!=null&&(r.uint32(24),r.uint32(t.version)),t.timestamp!=null&&(r.uint32(80),r.sint64(t.timestamp)),t.meta!=null&&(r.uint32(90),r.bytes(t.meta)),t.rateLimitProof!=null&&(r.uint32(170),Zg.codec().encode(t.rateLimitProof,r)),t.ephemeral!=null&&(r.uint32(248),r.bool(t.ephemeral)),i.lengthDelimited!==!1&&r.ldelim()},(t,r,i={})=>{var a;const s={payload:Je(0),contentTopic:""},o=r==null?t.len:t.pos+r;for(;t.pos<o;){const l=t.uint32();switch(l>>>3){case 1:{s.payload=t.bytes();break}case 2:{s.contentTopic=t.string();break}case 3:{s.version=t.uint32();break}case 10:{s.timestamp=t.sint64();break}case 11:{s.meta=t.bytes();break}case 21:{s.rateLimitProof=Zg.codec().decode(t,t.uint32(),{limits:(a=i.limits)==null?void 0:a.rateLimitProof});break}case 31:{s.ephemeral=t.bool();break}default:{t.skipType(l&7);break}}}return s})),e),n.encode=t=>dt(t,n.codec()),n.decode=(t,r)=>ft(t,n.codec(),r)})(Qg||(Qg={}));var Jg;(function(n){(function(t){let r;t.codec=()=>(r==null&&(r=pt((i,s,o={})=>{o.lengthDelimited!==!1&&s.fork(),i.contentTopic!=null&&i.contentTopic!==""&&(s.uint32(10),s.string(i.contentTopic)),o.lengthDelimited!==!1&&s.ldelim()},(i,s,o={})=>{const a={contentTopic:""},l=s==null?i.len:i.pos+s;for(;i.pos<l;){const c=i.uint32();switch(c>>>3){case 1:{a.contentTopic=i.string();break}default:{i.skipType(c&7);break}}}return a})),r),t.encode=i=>dt(i,t.codec()),t.decode=(i,s)=>ft(i,t.codec(),s)})(n.ContentFilter||(n.ContentFilter={}));let e;n.codec=()=>(e==null&&(e=pt((t,r,i={})=>{if(i.lengthDelimited!==!1&&r.fork(),t.subscribe!=null&&t.subscribe!==!1&&(r.uint32(8),r.bool(t.subscribe)),t.topic!=null&&t.topic!==""&&(r.uint32(18),r.string(t.topic)),t.contentFilters!=null)for(const s of t.contentFilters)r.uint32(26),n.ContentFilter.codec().encode(s,r);i.lengthDelimited!==!1&&r.ldelim()},(t,r,i={})=>{var a,l;const s={subscribe:!1,topic:"",contentFilters:[]},o=r==null?t.len:t.pos+r;for(;t.pos<o;){const c=t.uint32();switch(c>>>3){case 1:{s.subscribe=t.bool();break}case 2:{s.topic=t.string();break}case 3:{if(((a=i.limits)==null?void 0:a.contentFilters)!=null&&s.contentFilters.length===i.limits.contentFilters)throw new dn('Decode error - map field "contentFilters" had too many elements');s.contentFilters.push(n.ContentFilter.codec().decode(t,t.uint32(),{limits:(l=i.limits)==null?void 0:l.contentFilters$}));break}default:{t.skipType(c&7);break}}}return s})),e),n.encode=t=>dt(t,n.codec()),n.decode=(t,r)=>ft(t,n.codec(),r)})(Jg||(Jg={}));var em;(function(n){let e;n.codec=()=>(e==null&&(e=pt((t,r,i={})=>{if(i.lengthDelimited!==!1&&r.fork(),t.messages!=null)for(const s of t.messages)r.uint32(10),rm.codec().encode(s,r);i.lengthDelimited!==!1&&r.ldelim()},(t,r,i={})=>{var a,l;const s={messages:[]},o=r==null?t.len:t.pos+r;for(;t.pos<o;){const c=t.uint32();switch(c>>>3){case 1:{if(((a=i.limits)==null?void 0:a.messages)!=null&&s.messages.length===i.limits.messages)throw new dn('Decode error - map field "messages" had too many elements');s.messages.push(rm.codec().decode(t,t.uint32(),{limits:(l=i.limits)==null?void 0:l.messages$}));break}default:{t.skipType(c&7);break}}}return s})),e),n.encode=t=>dt(t,n.codec()),n.decode=(t,r)=>ft(t,n.codec(),r)})(em||(em={}));var XT;(function(n){let e;n.codec=()=>(e==null&&(e=pt((t,r,i={})=>{i.lengthDelimited!==!1&&r.fork(),t.requestId!=null&&t.requestId!==""&&(r.uint32(10),r.string(t.requestId)),t.request!=null&&(r.uint32(18),Jg.codec().encode(t.request,r)),t.push!=null&&(r.uint32(26),em.codec().encode(t.push,r)),i.lengthDelimited!==!1&&r.ldelim()},(t,r,i={})=>{var a,l;const s={requestId:""},o=r==null?t.len:t.pos+r;for(;t.pos<o;){const c=t.uint32();switch(c>>>3){case 1:{s.requestId=t.string();break}case 2:{s.request=Jg.codec().decode(t,t.uint32(),{limits:(a=i.limits)==null?void 0:a.request});break}case 3:{s.push=em.codec().decode(t,t.uint32(),{limits:(l=i.limits)==null?void 0:l.push});break}default:{t.skipType(c&7);break}}}return s})),e),n.encode=t=>dt(t,n.codec()),n.decode=(t,r)=>ft(t,n.codec(),r)})(XT||(XT={}));var tm;(function(n){let e;n.codec=()=>(e==null&&(e=pt((t,r,i={})=>{i.lengthDelimited!==!1&&r.fork(),t.proof!=null&&t.proof.byteLength>0&&(r.uint32(10),r.bytes(t.proof)),t.merkleRoot!=null&&t.merkleRoot.byteLength>0&&(r.uint32(18),r.bytes(t.merkleRoot)),t.epoch!=null&&t.epoch.byteLength>0&&(r.uint32(26),r.bytes(t.epoch)),t.shareX!=null&&t.shareX.byteLength>0&&(r.uint32(34),r.bytes(t.shareX)),t.shareY!=null&&t.shareY.byteLength>0&&(r.uint32(42),r.bytes(t.shareY)),t.nullifier!=null&&t.nullifier.byteLength>0&&(r.uint32(50),r.bytes(t.nullifier)),t.rlnIdentifier!=null&&t.rlnIdentifier.byteLength>0&&(r.uint32(58),r.bytes(t.rlnIdentifier)),i.lengthDelimited!==!1&&r.ldelim()},(t,r,i={})=>{const s={proof:Je(0),merkleRoot:Je(0),epoch:Je(0),shareX:Je(0),shareY:Je(0),nullifier:Je(0),rlnIdentifier:Je(0)},o=r==null?t.len:t.pos+r;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.proof=t.bytes();break}case 2:{s.merkleRoot=t.bytes();break}case 3:{s.epoch=t.bytes();break}case 4:{s.shareX=t.bytes();break}case 5:{s.shareY=t.bytes();break}case 6:{s.nullifier=t.bytes();break}case 7:{s.rlnIdentifier=t.bytes();break}default:{t.skipType(a&7);break}}}return s})),e),n.encode=t=>dt(t,n.codec()),n.decode=(t,r)=>ft(t,n.codec(),r)})(tm||(tm={}));var rm;(function(n){let e;n.codec=()=>(e==null&&(e=pt((t,r,i={})=>{i.lengthDelimited!==!1&&r.fork(),t.payload!=null&&t.payload.byteLength>0&&(r.uint32(10),r.bytes(t.payload)),t.contentTopic!=null&&t.contentTopic!==""&&(r.uint32(18),r.string(t.contentTopic)),t.version!=null&&(r.uint32(24),r.uint32(t.version)),t.timestamp!=null&&(r.uint32(80),r.sint64(t.timestamp)),t.meta!=null&&(r.uint32(90),r.bytes(t.meta)),t.rateLimitProof!=null&&(r.uint32(170),tm.codec().encode(t.rateLimitProof,r)),t.ephemeral!=null&&(r.uint32(248),r.bool(t.ephemeral)),i.lengthDelimited!==!1&&r.ldelim()},(t,r,i={})=>{var a;const s={payload:Je(0),contentTopic:""},o=r==null?t.len:t.pos+r;for(;t.pos<o;){const l=t.uint32();switch(l>>>3){case 1:{s.payload=t.bytes();break}case 2:{s.contentTopic=t.string();break}case 3:{s.version=t.uint32();break}case 10:{s.timestamp=t.sint64();break}case 11:{s.meta=t.bytes();break}case 21:{s.rateLimitProof=tm.codec().decode(t,t.uint32(),{limits:(a=i.limits)==null?void 0:a.rateLimitProof});break}case 31:{s.ephemeral=t.bool();break}default:{t.skipType(l&7);break}}}return s})),e),n.encode=t=>dt(t,n.codec()),n.decode=(t,r)=>ft(t,n.codec(),r)})(rm||(rm={}));var ZT;(function(n){let e;n.codec=()=>(e==null&&(e=pt((t,r,i={})=>{i.lengthDelimited!==!1&&r.fork(),t.contentTopic!=null&&t.contentTopic!==""&&(r.uint32(18),r.string(t.contentTopic)),i.lengthDelimited!==!1&&r.ldelim()},(t,r,i={})=>{const s={contentTopic:""},o=r==null?t.len:t.pos+r;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 2:{s.contentTopic=t.string();break}default:{t.skipType(a&7);break}}}return s})),e),n.encode=t=>dt(t,n.codec()),n.decode=(t,r)=>ft(t,n.codec(),r)})(ZT||(ZT={}));var ra;(function(n){let e;(function(i){i.SUBSCRIBER_PING="SUBSCRIBER_PING",i.SUBSCRIBE="SUBSCRIBE",i.UNSUBSCRIBE="UNSUBSCRIBE",i.UNSUBSCRIBE_ALL="UNSUBSCRIBE_ALL"})(e=n.FilterSubscribeType||(n.FilterSubscribeType={}));let t;(function(i){i[i.SUBSCRIBER_PING=0]="SUBSCRIBER_PING",i[i.SUBSCRIBE=1]="SUBSCRIBE",i[i.UNSUBSCRIBE=2]="UNSUBSCRIBE",i[i.UNSUBSCRIBE_ALL=3]="UNSUBSCRIBE_ALL"})(t||(t={})),function(i){i.codec=()=>fS(t)}(e=n.FilterSubscribeType||(n.FilterSubscribeType={}));let r;n.codec=()=>(r==null&&(r=pt((i,s,o={})=>{if(o.lengthDelimited!==!1&&s.fork(),i.requestId!=null&&i.requestId!==""&&(s.uint32(10),s.string(i.requestId)),i.filterSubscribeType!=null&&t[i.filterSubscribeType]!==0&&(s.uint32(16),n.FilterSubscribeType.codec().encode(i.filterSubscribeType,s)),i.pubsubTopic!=null&&(s.uint32(82),s.string(i.pubsubTopic)),i.contentTopics!=null)for(const a of i.contentTopics)s.uint32(90),s.string(a);o.lengthDelimited!==!1&&s.ldelim()},(i,s,o={})=>{var c;const a={requestId:"",filterSubscribeType:e.SUBSCRIBER_PING,contentTopics:[]},l=s==null?i.len:i.pos+s;for(;i.pos<l;){const h=i.uint32();switch(h>>>3){case 1:{a.requestId=i.string();break}case 2:{a.filterSubscribeType=n.FilterSubscribeType.codec().decode(i);break}case 10:{a.pubsubTopic=i.string();break}case 11:{if(((c=o.limits)==null?void 0:c.contentTopics)!=null&&a.contentTopics.length===o.limits.contentTopics)throw new dn('Decode error - map field "contentTopics" had too many elements');a.contentTopics.push(i.string());break}default:{i.skipType(h&7);break}}}return a})),r),n.encode=i=>dt(i,n.codec()),n.decode=(i,s)=>ft(i,n.codec(),s)})(ra||(ra={}));var nm;(function(n){let e;n.codec=()=>(e==null&&(e=pt((t,r,i={})=>{i.lengthDelimited!==!1&&r.fork(),t.requestId!=null&&t.requestId!==""&&(r.uint32(10),r.string(t.requestId)),t.statusCode!=null&&t.statusCode!==0&&(r.uint32(80),r.uint32(t.statusCode)),t.statusDesc!=null&&(r.uint32(90),r.string(t.statusDesc)),i.lengthDelimited!==!1&&r.ldelim()},(t,r,i={})=>{const s={requestId:"",statusCode:0},o=r==null?t.len:t.pos+r;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.requestId=t.string();break}case 10:{s.statusCode=t.uint32();break}case 11:{s.statusDesc=t.string();break}default:{t.skipType(a&7);break}}}return s})),e),n.encode=t=>dt(t,n.codec()),n.decode=(t,r)=>ft(t,n.codec(),r)})(nm||(nm={}));var im;(function(n){let e;n.codec=()=>(e==null&&(e=pt((t,r,i={})=>{i.lengthDelimited!==!1&&r.fork(),t.wakuMessage!=null&&(r.uint32(10),om.codec().encode(t.wakuMessage,r)),t.pubsubTopic!=null&&(r.uint32(18),r.string(t.pubsubTopic)),i.lengthDelimited!==!1&&r.ldelim()},(t,r,i={})=>{var a;const s={},o=r==null?t.len:t.pos+r;for(;t.pos<o;){const l=t.uint32();switch(l>>>3){case 1:{s.wakuMessage=om.codec().decode(t,t.uint32(),{limits:(a=i.limits)==null?void 0:a.wakuMessage});break}case 2:{s.pubsubTopic=t.string();break}default:{t.skipType(l&7);break}}}return s})),e),n.encode=t=>dt(t,n.codec()),n.decode=(t,r)=>ft(t,n.codec(),r)})(im||(im={}));var sm;(function(n){let e;n.codec=()=>(e==null&&(e=pt((t,r,i={})=>{i.lengthDelimited!==!1&&r.fork(),t.proof!=null&&t.proof.byteLength>0&&(r.uint32(10),r.bytes(t.proof)),t.merkleRoot!=null&&t.merkleRoot.byteLength>0&&(r.uint32(18),r.bytes(t.merkleRoot)),t.epoch!=null&&t.epoch.byteLength>0&&(r.uint32(26),r.bytes(t.epoch)),t.shareX!=null&&t.shareX.byteLength>0&&(r.uint32(34),r.bytes(t.shareX)),t.shareY!=null&&t.shareY.byteLength>0&&(r.uint32(42),r.bytes(t.shareY)),t.nullifier!=null&&t.nullifier.byteLength>0&&(r.uint32(50),r.bytes(t.nullifier)),t.rlnIdentifier!=null&&t.rlnIdentifier.byteLength>0&&(r.uint32(58),r.bytes(t.rlnIdentifier)),i.lengthDelimited!==!1&&r.ldelim()},(t,r,i={})=>{const s={proof:Je(0),merkleRoot:Je(0),epoch:Je(0),shareX:Je(0),shareY:Je(0),nullifier:Je(0),rlnIdentifier:Je(0)},o=r==null?t.len:t.pos+r;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.proof=t.bytes();break}case 2:{s.merkleRoot=t.bytes();break}case 3:{s.epoch=t.bytes();break}case 4:{s.shareX=t.bytes();break}case 5:{s.shareY=t.bytes();break}case 6:{s.nullifier=t.bytes();break}case 7:{s.rlnIdentifier=t.bytes();break}default:{t.skipType(a&7);break}}}return s})),e),n.encode=t=>dt(t,n.codec()),n.decode=(t,r)=>ft(t,n.codec(),r)})(sm||(sm={}));var om;(function(n){let e;n.codec=()=>(e==null&&(e=pt((t,r,i={})=>{i.lengthDelimited!==!1&&r.fork(),t.payload!=null&&t.payload.byteLength>0&&(r.uint32(10),r.bytes(t.payload)),t.contentTopic!=null&&t.contentTopic!==""&&(r.uint32(18),r.string(t.contentTopic)),t.version!=null&&(r.uint32(24),r.uint32(t.version)),t.timestamp!=null&&(r.uint32(80),r.sint64(t.timestamp)),t.meta!=null&&(r.uint32(90),r.bytes(t.meta)),t.rateLimitProof!=null&&(r.uint32(170),sm.codec().encode(t.rateLimitProof,r)),t.ephemeral!=null&&(r.uint32(248),r.bool(t.ephemeral)),i.lengthDelimited!==!1&&r.ldelim()},(t,r,i={})=>{var a;const s={payload:Je(0),contentTopic:""},o=r==null?t.len:t.pos+r;for(;t.pos<o;){const l=t.uint32();switch(l>>>3){case 1:{s.payload=t.bytes();break}case 2:{s.contentTopic=t.string();break}case 3:{s.version=t.uint32();break}case 10:{s.timestamp=t.sint64();break}case 11:{s.meta=t.bytes();break}case 21:{s.rateLimitProof=sm.codec().decode(t,t.uint32(),{limits:(a=i.limits)==null?void 0:a.rateLimitProof});break}case 31:{s.ephemeral=t.bool();break}default:{t.skipType(l&7);break}}}return s})),e),n.encode=t=>dt(t,n.codec()),n.decode=(t,r)=>ft(t,n.codec(),r)})(om||(om={}));var am;(function(n){let e;n.codec=()=>(e==null&&(e=pt((t,r,i={})=>{i.lengthDelimited!==!1&&r.fork(),t.pubsubTopic!=null&&t.pubsubTopic!==""&&(r.uint32(10),r.string(t.pubsubTopic)),t.message!=null&&(r.uint32(18),gu.codec().encode(t.message,r)),i.lengthDelimited!==!1&&r.ldelim()},(t,r,i={})=>{var a;const s={pubsubTopic:""},o=r==null?t.len:t.pos+r;for(;t.pos<o;){const l=t.uint32();switch(l>>>3){case 1:{s.pubsubTopic=t.string();break}case 2:{s.message=gu.codec().decode(t,t.uint32(),{limits:(a=i.limits)==null?void 0:a.message});break}default:{t.skipType(l&7);break}}}return s})),e),n.encode=t=>dt(t,n.codec()),n.decode=(t,r)=>ft(t,n.codec(),r)})(am||(am={}));var lm;(function(n){let e;n.codec=()=>(e==null&&(e=pt((t,r,i={})=>{i.lengthDelimited!==!1&&r.fork(),t.isSuccess!=null&&t.isSuccess!==!1&&(r.uint32(8),r.bool(t.isSuccess)),t.info!=null&&(r.uint32(18),r.string(t.info)),t.statusCode!=null&&(r.uint32(80),r.uint32(t.statusCode)),t.statusDesc!=null&&(r.uint32(90),r.string(t.statusDesc)),t.relayPeerCount!=null&&(r.uint32(96),r.uint32(t.relayPeerCount)),i.lengthDelimited!==!1&&r.ldelim()},(t,r,i={})=>{const s={isSuccess:!1},o=r==null?t.len:t.pos+r;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.isSuccess=t.bool();break}case 2:{s.info=t.string();break}case 10:{s.statusCode=t.uint32();break}case 11:{s.statusDesc=t.string();break}case 12:{s.relayPeerCount=t.uint32();break}default:{t.skipType(a&7);break}}}return s})),e),n.encode=t=>dt(t,n.codec()),n.decode=(t,r)=>ft(t,n.codec(),r)})(lm||(lm={}));var cm;(function(n){let e;n.codec=()=>(e==null&&(e=pt((t,r,i={})=>{i.lengthDelimited!==!1&&r.fork(),t.requestId!=null&&t.requestId!==""&&(r.uint32(10),r.string(t.requestId)),t.request!=null&&(r.uint32(18),am.codec().encode(t.request,r)),t.response!=null&&(r.uint32(26),lm.codec().encode(t.response,r)),i.lengthDelimited!==!1&&r.ldelim()},(t,r,i={})=>{var a,l;const s={requestId:""},o=r==null?t.len:t.pos+r;for(;t.pos<o;){const c=t.uint32();switch(c>>>3){case 1:{s.requestId=t.string();break}case 2:{s.request=am.codec().decode(t,t.uint32(),{limits:(a=i.limits)==null?void 0:a.request});break}case 3:{s.response=lm.codec().decode(t,t.uint32(),{limits:(l=i.limits)==null?void 0:l.response});break}default:{t.skipType(c&7);break}}}return s})),e),n.encode=t=>dt(t,n.codec()),n.decode=(t,r)=>ft(t,n.codec(),r)})(cm||(cm={}));var um;(function(n){let e;n.codec=()=>(e==null&&(e=pt((t,r,i={})=>{i.lengthDelimited!==!1&&r.fork(),t.requestId!=null&&t.requestId!==""&&(r.uint32(10),r.string(t.requestId)),t.pubsubTopic!=null&&(r.uint32(162),r.string(t.pubsubTopic)),t.message!=null&&(r.uint32(170),gu.codec().encode(t.message,r)),i.lengthDelimited!==!1&&r.ldelim()},(t,r,i={})=>{var a;const s={requestId:""},o=r==null?t.len:t.pos+r;for(;t.pos<o;){const l=t.uint32();switch(l>>>3){case 1:{s.requestId=t.string();break}case 20:{s.pubsubTopic=t.string();break}case 21:{s.message=gu.codec().decode(t,t.uint32(),{limits:(a=i.limits)==null?void 0:a.message});break}default:{t.skipType(l&7);break}}}return s})),e),n.encode=t=>dt(t,n.codec()),n.decode=(t,r)=>ft(t,n.codec(),r)})(um||(um={}));var hm;(function(n){let e;n.codec=()=>(e==null&&(e=pt((t,r,i={})=>{i.lengthDelimited!==!1&&r.fork(),t.requestId!=null&&t.requestId!==""&&(r.uint32(10),r.string(t.requestId)),t.statusCode!=null&&t.statusCode!==0&&(r.uint32(80),r.uint32(t.statusCode)),t.statusDesc!=null&&(r.uint32(90),r.string(t.statusDesc)),t.relayPeerCount!=null&&(r.uint32(96),r.uint32(t.relayPeerCount)),i.lengthDelimited!==!1&&r.ldelim()},(t,r,i={})=>{const s={requestId:"",statusCode:0},o=r==null?t.len:t.pos+r;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.requestId=t.string();break}case 10:{s.statusCode=t.uint32();break}case 11:{s.statusDesc=t.string();break}case 12:{s.relayPeerCount=t.uint32();break}default:{t.skipType(a&7);break}}}return s})),e),n.encode=t=>dt(t,n.codec()),n.decode=(t,r)=>ft(t,n.codec(),r)})(hm||(hm={}));var fm;(function(n){let e;n.codec=()=>(e==null&&(e=pt((t,r,i={})=>{i.lengthDelimited!==!1&&r.fork(),t.proof!=null&&t.proof.byteLength>0&&(r.uint32(10),r.bytes(t.proof)),t.merkleRoot!=null&&t.merkleRoot.byteLength>0&&(r.uint32(18),r.bytes(t.merkleRoot)),t.epoch!=null&&t.epoch.byteLength>0&&(r.uint32(26),r.bytes(t.epoch)),t.shareX!=null&&t.shareX.byteLength>0&&(r.uint32(34),r.bytes(t.shareX)),t.shareY!=null&&t.shareY.byteLength>0&&(r.uint32(42),r.bytes(t.shareY)),t.nullifier!=null&&t.nullifier.byteLength>0&&(r.uint32(50),r.bytes(t.nullifier)),t.rlnIdentifier!=null&&t.rlnIdentifier.byteLength>0&&(r.uint32(58),r.bytes(t.rlnIdentifier)),i.lengthDelimited!==!1&&r.ldelim()},(t,r,i={})=>{const s={proof:Je(0),merkleRoot:Je(0),epoch:Je(0),shareX:Je(0),shareY:Je(0),nullifier:Je(0),rlnIdentifier:Je(0)},o=r==null?t.len:t.pos+r;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.proof=t.bytes();break}case 2:{s.merkleRoot=t.bytes();break}case 3:{s.epoch=t.bytes();break}case 4:{s.shareX=t.bytes();break}case 5:{s.shareY=t.bytes();break}case 6:{s.nullifier=t.bytes();break}case 7:{s.rlnIdentifier=t.bytes();break}default:{t.skipType(a&7);break}}}return s})),e),n.encode=t=>dt(t,n.codec()),n.decode=(t,r)=>ft(t,n.codec(),r)})(fm||(fm={}));var gu;(function(n){let e;n.codec=()=>(e==null&&(e=pt((t,r,i={})=>{i.lengthDelimited!==!1&&r.fork(),t.payload!=null&&t.payload.byteLength>0&&(r.uint32(10),r.bytes(t.payload)),t.contentTopic!=null&&t.contentTopic!==""&&(r.uint32(18),r.string(t.contentTopic)),t.version!=null&&(r.uint32(24),r.uint32(t.version)),t.timestamp!=null&&(r.uint32(80),r.sint64(t.timestamp)),t.meta!=null&&(r.uint32(90),r.bytes(t.meta)),t.rateLimitProof!=null&&(r.uint32(170),fm.codec().encode(t.rateLimitProof,r)),t.ephemeral!=null&&(r.uint32(248),r.bool(t.ephemeral)),i.lengthDelimited!==!1&&r.ldelim()},(t,r,i={})=>{var a;const s={payload:Je(0),contentTopic:""},o=r==null?t.len:t.pos+r;for(;t.pos<o;){const l=t.uint32();switch(l>>>3){case 1:{s.payload=t.bytes();break}case 2:{s.contentTopic=t.string();break}case 3:{s.version=t.uint32();break}case 10:{s.timestamp=t.sint64();break}case 11:{s.meta=t.bytes();break}case 21:{s.rateLimitProof=fm.codec().decode(t,t.uint32(),{limits:(a=i.limits)==null?void 0:a.rateLimitProof});break}case 31:{s.ephemeral=t.bool();break}default:{t.skipType(l&7);break}}}return s})),e),n.encode=t=>dt(t,n.codec()),n.decode=(t,r)=>ft(t,n.codec(),r)})(gu||(gu={}));var dm;(function(n){let e;n.codec=()=>(e==null&&(e=pt((t,r,i={})=>{i.lengthDelimited!==!1&&r.fork(),t.messageHash!=null&&(r.uint32(10),r.bytes(t.messageHash)),t.message!=null&&(r.uint32(18),ym.codec().encode(t.message,r)),t.pubsubTopic!=null&&(r.uint32(26),r.string(t.pubsubTopic)),i.lengthDelimited!==!1&&r.ldelim()},(t,r,i={})=>{var a;const s={},o=r==null?t.len:t.pos+r;for(;t.pos<o;){const l=t.uint32();switch(l>>>3){case 1:{s.messageHash=t.bytes();break}case 2:{s.message=ym.codec().decode(t,t.uint32(),{limits:(a=i.limits)==null?void 0:a.message});break}case 3:{s.pubsubTopic=t.string();break}default:{t.skipType(l&7);break}}}return s})),e),n.encode=t=>dt(t,n.codec()),n.decode=(t,r)=>ft(t,n.codec(),r)})(dm||(dm={}));var pm;(function(n){let e;n.codec=()=>(e==null&&(e=pt((t,r,i={})=>{if(i.lengthDelimited!==!1&&r.fork(),t.requestId!=null&&t.requestId!==""&&(r.uint32(10),r.string(t.requestId)),t.includeData!=null&&t.includeData!==!1&&(r.uint32(16),r.bool(t.includeData)),t.pubsubTopic!=null&&(r.uint32(82),r.string(t.pubsubTopic)),t.contentTopics!=null)for(const s of t.contentTopics)r.uint32(90),r.string(s);if(t.timeStart!=null&&(r.uint32(96),r.sint64(t.timeStart)),t.timeEnd!=null&&(r.uint32(104),r.sint64(t.timeEnd)),t.messageHashes!=null)for(const s of t.messageHashes)r.uint32(162),r.bytes(s);t.paginationCursor!=null&&(r.uint32(410),r.bytes(t.paginationCursor)),t.paginationForward!=null&&t.paginationForward!==!1&&(r.uint32(416),r.bool(t.paginationForward)),t.paginationLimit!=null&&(r.uint32(424),r.uint64(t.paginationLimit)),i.lengthDelimited!==!1&&r.ldelim()},(t,r,i={})=>{var a,l;const s={requestId:"",includeData:!1,contentTopics:[],messageHashes:[],paginationForward:!1},o=r==null?t.len:t.pos+r;for(;t.pos<o;){const c=t.uint32();switch(c>>>3){case 1:{s.requestId=t.string();break}case 2:{s.includeData=t.bool();break}case 10:{s.pubsubTopic=t.string();break}case 11:{if(((a=i.limits)==null?void 0:a.contentTopics)!=null&&s.contentTopics.length===i.limits.contentTopics)throw new dn('Decode error - map field "contentTopics" had too many elements');s.contentTopics.push(t.string());break}case 12:{s.timeStart=t.sint64();break}case 13:{s.timeEnd=t.sint64();break}case 20:{if(((l=i.limits)==null?void 0:l.messageHashes)!=null&&s.messageHashes.length===i.limits.messageHashes)throw new dn('Decode error - map field "messageHashes" had too many elements');s.messageHashes.push(t.bytes());break}case 51:{s.paginationCursor=t.bytes();break}case 52:{s.paginationForward=t.bool();break}case 53:{s.paginationLimit=t.uint64();break}default:{t.skipType(c&7);break}}}return s})),e),n.encode=t=>dt(t,n.codec()),n.decode=(t,r)=>ft(t,n.codec(),r)})(pm||(pm={}));var gm;(function(n){let e;n.codec=()=>(e==null&&(e=pt((t,r,i={})=>{if(i.lengthDelimited!==!1&&r.fork(),t.requestId!=null&&t.requestId!==""&&(r.uint32(10),r.string(t.requestId)),t.statusCode!=null&&(r.uint32(80),r.uint32(t.statusCode)),t.statusDesc!=null&&(r.uint32(90),r.string(t.statusDesc)),t.messages!=null)for(const s of t.messages)r.uint32(162),dm.codec().encode(s,r);t.paginationCursor!=null&&(r.uint32(410),r.bytes(t.paginationCursor)),i.lengthDelimited!==!1&&r.ldelim()},(t,r,i={})=>{var a,l;const s={requestId:"",messages:[]},o=r==null?t.len:t.pos+r;for(;t.pos<o;){const c=t.uint32();switch(c>>>3){case 1:{s.requestId=t.string();break}case 10:{s.statusCode=t.uint32();break}case 11:{s.statusDesc=t.string();break}case 20:{if(((a=i.limits)==null?void 0:a.messages)!=null&&s.messages.length===i.limits.messages)throw new dn('Decode error - map field "messages" had too many elements');s.messages.push(dm.codec().decode(t,t.uint32(),{limits:(l=i.limits)==null?void 0:l.messages$}));break}case 51:{s.paginationCursor=t.bytes();break}default:{t.skipType(c&7);break}}}return s})),e),n.encode=t=>dt(t,n.codec()),n.decode=(t,r)=>ft(t,n.codec(),r)})(gm||(gm={}));var mm;(function(n){let e;n.codec=()=>(e==null&&(e=pt((t,r,i={})=>{i.lengthDelimited!==!1&&r.fork(),t.proof!=null&&t.proof.byteLength>0&&(r.uint32(10),r.bytes(t.proof)),t.merkleRoot!=null&&t.merkleRoot.byteLength>0&&(r.uint32(18),r.bytes(t.merkleRoot)),t.epoch!=null&&t.epoch.byteLength>0&&(r.uint32(26),r.bytes(t.epoch)),t.shareX!=null&&t.shareX.byteLength>0&&(r.uint32(34),r.bytes(t.shareX)),t.shareY!=null&&t.shareY.byteLength>0&&(r.uint32(42),r.bytes(t.shareY)),t.nullifier!=null&&t.nullifier.byteLength>0&&(r.uint32(50),r.bytes(t.nullifier)),t.rlnIdentifier!=null&&t.rlnIdentifier.byteLength>0&&(r.uint32(58),r.bytes(t.rlnIdentifier)),i.lengthDelimited!==!1&&r.ldelim()},(t,r,i={})=>{const s={proof:Je(0),merkleRoot:Je(0),epoch:Je(0),shareX:Je(0),shareY:Je(0),nullifier:Je(0),rlnIdentifier:Je(0)},o=r==null?t.len:t.pos+r;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.proof=t.bytes();break}case 2:{s.merkleRoot=t.bytes();break}case 3:{s.epoch=t.bytes();break}case 4:{s.shareX=t.bytes();break}case 5:{s.shareY=t.bytes();break}case 6:{s.nullifier=t.bytes();break}case 7:{s.rlnIdentifier=t.bytes();break}default:{t.skipType(a&7);break}}}return s})),e),n.encode=t=>dt(t,n.codec()),n.decode=(t,r)=>ft(t,n.codec(),r)})(mm||(mm={}));var ym;(function(n){let e;n.codec=()=>(e==null&&(e=pt((t,r,i={})=>{i.lengthDelimited!==!1&&r.fork(),t.payload!=null&&t.payload.byteLength>0&&(r.uint32(10),r.bytes(t.payload)),t.contentTopic!=null&&t.contentTopic!==""&&(r.uint32(18),r.string(t.contentTopic)),t.version!=null&&(r.uint32(24),r.uint32(t.version)),t.timestamp!=null&&(r.uint32(80),r.sint64(t.timestamp)),t.meta!=null&&(r.uint32(90),r.bytes(t.meta)),t.rateLimitProof!=null&&(r.uint32(170),mm.codec().encode(t.rateLimitProof,r)),t.ephemeral!=null&&(r.uint32(248),r.bool(t.ephemeral)),i.lengthDelimited!==!1&&r.ldelim()},(t,r,i={})=>{var a;const s={payload:Je(0),contentTopic:""},o=r==null?t.len:t.pos+r;for(;t.pos<o;){const l=t.uint32();switch(l>>>3){case 1:{s.payload=t.bytes();break}case 2:{s.contentTopic=t.string();break}case 3:{s.version=t.uint32();break}case 10:{s.timestamp=t.sint64();break}case 11:{s.meta=t.bytes();break}case 21:{s.rateLimitProof=mm.codec().decode(t,t.uint32(),{limits:(a=i.limits)==null?void 0:a.rateLimitProof});break}case 31:{s.ephemeral=t.bool();break}default:{t.skipType(l&7);break}}}return s})),e),n.encode=t=>dt(t,n.codec()),n.decode=(t,r)=>ft(t,n.codec(),r)})(ym||(ym={}));var bm;(function(n){let e;n.codec=()=>(e==null&&(e=pt((t,r,i={})=>{i.lengthDelimited!==!1&&r.fork(),t.enr!=null&&(r.uint32(10),r.bytes(t.enr)),i.lengthDelimited!==!1&&r.ldelim()},(t,r,i={})=>{const s={},o=r==null?t.len:t.pos+r;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.enr=t.bytes();break}default:{t.skipType(a&7);break}}}return s})),e),n.encode=t=>dt(t,n.codec()),n.decode=(t,r)=>ft(t,n.codec(),r)})(bm||(bm={}));var wm;(function(n){let e;n.codec=()=>(e==null&&(e=pt((t,r,i={})=>{i.lengthDelimited!==!1&&r.fork(),t.numPeers!=null&&(r.uint32(8),r.uint64(t.numPeers)),i.lengthDelimited!==!1&&r.ldelim()},(t,r,i={})=>{const s={},o=r==null?t.len:t.pos+r;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.numPeers=t.uint64();break}default:{t.skipType(a&7);break}}}return s})),e),n.encode=t=>dt(t,n.codec()),n.decode=(t,r)=>ft(t,n.codec(),r)})(wm||(wm={}));var vm;(function(n){let e;n.codec=()=>(e==null&&(e=pt((t,r,i={})=>{if(i.lengthDelimited!==!1&&r.fork(),t.peerInfos!=null)for(const s of t.peerInfos)r.uint32(10),bm.codec().encode(s,r);i.lengthDelimited!==!1&&r.ldelim()},(t,r,i={})=>{var a,l;const s={peerInfos:[]},o=r==null?t.len:t.pos+r;for(;t.pos<o;){const c=t.uint32();switch(c>>>3){case 1:{if(((a=i.limits)==null?void 0:a.peerInfos)!=null&&s.peerInfos.length===i.limits.peerInfos)throw new dn('Decode error - map field "peerInfos" had too many elements');s.peerInfos.push(bm.codec().decode(t,t.uint32(),{limits:(l=i.limits)==null?void 0:l.peerInfos$}));break}default:{t.skipType(c&7);break}}}return s})),e),n.encode=t=>dt(t,n.codec()),n.decode=(t,r)=>ft(t,n.codec(),r)})(vm||(vm={}));var _m;(function(n){let e;n.codec=()=>(e==null&&(e=pt((t,r,i={})=>{i.lengthDelimited!==!1&&r.fork(),t.query!=null&&(r.uint32(10),wm.codec().encode(t.query,r)),t.response!=null&&(r.uint32(18),vm.codec().encode(t.response,r)),i.lengthDelimited!==!1&&r.ldelim()},(t,r,i={})=>{var a,l;const s={},o=r==null?t.len:t.pos+r;for(;t.pos<o;){const c=t.uint32();switch(c>>>3){case 1:{s.query=wm.codec().decode(t,t.uint32(),{limits:(a=i.limits)==null?void 0:a.query});break}case 2:{s.response=vm.codec().decode(t,t.uint32(),{limits:(l=i.limits)==null?void 0:l.response});break}default:{t.skipType(c&7);break}}}return s})),e),n.encode=t=>dt(t,n.codec()),n.decode=(t,r)=>ft(t,n.codec(),r)})(_m||(_m={}));var b1;(function(n){let e;n.codec=()=>(e==null&&(e=pt((t,r,i={})=>{if(i.lengthDelimited!==!1&&r.fork(),t.clusterId!=null&&(r.uint32(8),r.uint32(t.clusterId)),t.shards!=null)for(const s of t.shards)r.uint32(16),r.uint32(s);i.lengthDelimited!==!1&&r.ldelim()},(t,r,i={})=>{var a;const s={shards:[]},o=r==null?t.len:t.pos+r;for(;t.pos<o;){const l=t.uint32();switch(l>>>3){case 1:{s.clusterId=t.uint32();break}case 2:{if(((a=i.limits)==null?void 0:a.shards)!=null&&s.shards.length===i.limits.shards)throw new dn('Decode error - map field "shards" had too many elements');s.shards.push(t.uint32());break}default:{t.skipType(l&7);break}}}return s})),e),n.encode=t=>dt(t,n.codec()),n.decode=(t,r)=>ft(t,n.codec(),r)})(b1||(b1={}));var Em;(function(n){let e;n.codec=()=>(e==null&&(e=pt((t,r,i={})=>{if(i.lengthDelimited!==!1&&r.fork(),t.clusterId!=null&&(r.uint32(8),r.uint32(t.clusterId)),t.shards!=null)for(const s of t.shards)r.uint32(16),r.uint32(s);i.lengthDelimited!==!1&&r.ldelim()},(t,r,i={})=>{var a;const s={shards:[]},o=r==null?t.len:t.pos+r;for(;t.pos<o;){const l=t.uint32();switch(l>>>3){case 1:{s.clusterId=t.uint32();break}case 2:{if(((a=i.limits)==null?void 0:a.shards)!=null&&s.shards.length===i.limits.shards)throw new dn('Decode error - map field "shards" had too many elements');s.shards.push(t.uint32());break}default:{t.skipType(l&7);break}}}return s})),e),n.encode=t=>dt(t,n.codec()),n.decode=(t,r)=>ft(t,n.codec(),r)})(Em||(Em={}));var Sm;(function(n){let e;n.codec=()=>(e==null&&(e=pt((t,r,i={})=>{i.lengthDelimited!==!1&&r.fork(),t.messageId!=null&&t.messageId!==""&&(r.uint32(10),r.string(t.messageId)),t.retrievalHint!=null&&(r.uint32(18),r.bytes(t.retrievalHint)),i.lengthDelimited!==!1&&r.ldelim()},(t,r,i={})=>{const s={messageId:""},o=r==null?t.len:t.pos+r;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.messageId=t.string();break}case 2:{s.retrievalHint=t.bytes();break}default:{t.skipType(a&7);break}}}return s})),e),n.encode=t=>dt(t,n.codec()),n.decode=(t,r)=>ft(t,n.codec(),r)})(Sm||(Sm={}));var QT;(function(n){let e;n.codec=()=>(e==null&&(e=pt((t,r,i={})=>{if(i.lengthDelimited!==!1&&r.fork(),t.senderId!=null&&t.senderId!==""&&(r.uint32(10),r.string(t.senderId)),t.messageId!=null&&t.messageId!==""&&(r.uint32(18),r.string(t.messageId)),t.channelId!=null&&t.channelId!==""&&(r.uint32(26),r.string(t.channelId)),t.lamportTimestamp!=null&&(r.uint32(80),r.int32(t.lamportTimestamp)),t.causalHistory!=null)for(const s of t.causalHistory)r.uint32(90),Sm.codec().encode(s,r);t.bloomFilter!=null&&(r.uint32(98),r.bytes(t.bloomFilter)),t.content!=null&&(r.uint32(162),r.bytes(t.content)),i.lengthDelimited!==!1&&r.ldelim()},(t,r,i={})=>{var a,l;const s={senderId:"",messageId:"",channelId:"",causalHistory:[]},o=r==null?t.len:t.pos+r;for(;t.pos<o;){const c=t.uint32();switch(c>>>3){case 1:{s.senderId=t.string();break}case 2:{s.messageId=t.string();break}case 3:{s.channelId=t.string();break}case 10:{s.lamportTimestamp=t.int32();break}case 11:{if(((a=i.limits)==null?void 0:a.causalHistory)!=null&&s.causalHistory.length===i.limits.causalHistory)throw new dn('Decode error - map field "causalHistory" had too many elements');s.causalHistory.push(Sm.codec().decode(t,t.uint32(),{limits:(l=i.limits)==null?void 0:l.causalHistory$}));break}case 12:{s.bloomFilter=t.bytes();break}case 20:{s.content=t.bytes();break}default:{t.skipType(c&7);break}}}return s})),e),n.encode=t=>dt(t,n.codec()),n.decode=(t,r)=>ft(t,n.codec(),r)})(QT||(QT={}));function dS(n){return!!n}function JW(n){if(n.length<=1)return n;const e=()=>Math.floor(Math.random()*Math.floor(n.length));for(let t=0;t<n.length;t++){const r=e(),i=n[t];n[t]=n[r],n[r]=i}return n}const ez=1024**2,tz=1;async function rz(n,e){const t=await n.toWire(e);return t?nz(t):!1}const nz=n=>n.length/ez<=tz;function iz(n){return"clusterId"in n&&"numShardsInCluster"in n}const _c=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Vf(n){return n instanceof Uint8Array||ArrayBuffer.isView(n)&&n.constructor.name==="Uint8Array"}function Am(n){if(!Number.isSafeInteger(n)||n<0)throw new Error("positive integer expected, got "+n)}function Ta(n,...e){if(!Vf(n))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(n.length))throw new Error("Uint8Array expected of length "+e+", got length="+n.length)}function Oy(n){if(typeof n!="function"||typeof n.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");Am(n.outputLen),Am(n.blockLen)}function xm(n,e=!0){if(n.destroyed)throw new Error("Hash instance has been destroyed");if(e&&n.finished)throw new Error("Hash#digest() has already been called")}function sz(n,e){Ta(n);const t=e.outputLen;if(n.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}function Nl(...n){for(let e=0;e<n.length;e++)n[e].fill(0)}function M0(n){return new DataView(n.buffer,n.byteOffset,n.byteLength)}function fs(n,e){return n<<32-e|n>>>e}const dL=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",oz=Array.from({length:256},(n,e)=>e.toString(16).padStart(2,"0"));function Tl(n){if(Ta(n),dL)return n.toHex();let e="";for(let t=0;t<n.length;t++)e+=oz[n[t]];return e}const qs={_0:48,_9:57,A:65,F:70,a:97,f:102};function JT(n){if(n>=qs._0&&n<=qs._9)return n-qs._0;if(n>=qs.A&&n<=qs.F)return n-(qs.A-10);if(n>=qs.a&&n<=qs.f)return n-(qs.a-10)}function Im(n){if(typeof n!="string")throw new Error("hex string expected, got "+typeof n);if(dL)return Uint8Array.fromHex(n);const e=n.length,t=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const r=new Uint8Array(t);for(let i=0,s=0;i<t;i++,s+=2){const o=JT(n.charCodeAt(s)),a=JT(n.charCodeAt(s+1));if(o===void 0||a===void 0){const l=n[s]+n[s+1];throw new Error('hex string expected, got non-hex character "'+l+'" at index '+s)}r[i]=o*16+a}return r}function az(n){if(typeof n!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(n))}function cf(n){return typeof n=="string"&&(n=az(n)),Ta(n),n}function _s(...n){let e=0;for(let r=0;r<n.length;r++){const i=n[r];Ta(i),e+=i.length}const t=new Uint8Array(e);for(let r=0,i=0;r<n.length;r++){const s=n[r];t.set(s,i),i+=s.length}return t}class pL{}function gL(n){const e=r=>n().update(cf(r)).digest(),t=n();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>n(),e}function Ly(n=32){if(_c&&typeof _c.getRandomValues=="function")return _c.getRandomValues(new Uint8Array(n));if(_c&&typeof _c.randomBytes=="function")return Uint8Array.from(_c.randomBytes(n));throw new Error("crypto.getRandomValues must be defined")}function lz(n,e,t,r){if(typeof n.setBigUint64=="function")return n.setBigUint64(e,t,r);const i=BigInt(32),s=BigInt(4294967295),o=Number(t>>i&s),a=Number(t&s),l=r?4:0,c=r?0:4;n.setUint32(e+l,o,r),n.setUint32(e+c,a,r)}function cz(n,e,t){return n&e^~n&t}function uz(n,e,t){return n&e^n&t^e&t}let mL=class extends pL{constructor(e,t,r,i){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=t,this.padOffset=r,this.isLE=i,this.buffer=new Uint8Array(e),this.view=M0(this.buffer)}update(e){xm(this),e=cf(e),Ta(e);const{view:t,buffer:r,blockLen:i}=this,s=e.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const l=M0(e);for(;i<=s-o;o+=i)this.process(l,o);continue}r.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){xm(this),sz(e,this),this.finished=!0;const{buffer:t,view:r,blockLen:i,isLE:s}=this;let{pos:o}=this;t[o++]=128,Nl(this.buffer.subarray(o)),this.padOffset>i-o&&(this.process(r,0),o=0);for(let d=o;d<i;d++)t[d]=0;lz(r,i-8,BigInt(this.length*8),s),this.process(r,0);const a=M0(e),l=this.outputLen;if(l%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=l/4,h=this.get();if(c>h.length)throw new Error("_sha2: outputLen bigger than state");for(let d=0;d<c;d++)a.setUint32(4*d,h[d],s)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const r=e.slice(0,t);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:r,length:i,finished:s,destroyed:o,pos:a}=this;return e.destroyed=o,e.finished=s,e.length=i,e.pos=a,i%t&&e.buffer.set(r),e}clone(){return this._cloneInto()}};const No=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),_n=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),np=BigInt(2**32-1),eC=BigInt(32);function hz(n,e=!1){return e?{h:Number(n&np),l:Number(n>>eC&np)}:{h:Number(n>>eC&np)|0,l:Number(n&np)|0}}function fz(n,e=!1){const t=n.length;let r=new Uint32Array(t),i=new Uint32Array(t);for(let s=0;s<t;s++){const{h:o,l:a}=hz(n[s],e);[r[s],i[s]]=[o,a]}return[r,i]}const tC=(n,e,t)=>n>>>t,rC=(n,e,t)=>n<<32-t|e>>>t,Ec=(n,e,t)=>n>>>t|e<<32-t,Sc=(n,e,t)=>n<<32-t|e>>>t,ip=(n,e,t)=>n<<64-t|e>>>t-32,sp=(n,e,t)=>n>>>t-32|e<<64-t;function Hs(n,e,t,r){const i=(e>>>0)+(r>>>0);return{h:n+t+(i/2**32|0)|0,l:i|0}}const dz=(n,e,t)=>(n>>>0)+(e>>>0)+(t>>>0),pz=(n,e,t,r)=>e+t+r+(n/2**32|0)|0,gz=(n,e,t,r)=>(n>>>0)+(e>>>0)+(t>>>0)+(r>>>0),mz=(n,e,t,r,i)=>e+t+r+i+(n/2**32|0)|0,yz=(n,e,t,r,i)=>(n>>>0)+(e>>>0)+(t>>>0)+(r>>>0)+(i>>>0),bz=(n,e,t,r,i,s)=>e+t+r+i+s+(n/2**32|0)|0,wz=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Do=new Uint32Array(64);class vz extends mL{constructor(e=32){super(64,e,8,!1),this.A=No[0]|0,this.B=No[1]|0,this.C=No[2]|0,this.D=No[3]|0,this.E=No[4]|0,this.F=No[5]|0,this.G=No[6]|0,this.H=No[7]|0}get(){const{A:e,B:t,C:r,D:i,E:s,F:o,G:a,H:l}=this;return[e,t,r,i,s,o,a,l]}set(e,t,r,i,s,o,a,l){this.A=e|0,this.B=t|0,this.C=r|0,this.D=i|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=l|0}process(e,t){for(let d=0;d<16;d++,t+=4)Do[d]=e.getUint32(t,!1);for(let d=16;d<64;d++){const p=Do[d-15],g=Do[d-2],m=fs(p,7)^fs(p,18)^p>>>3,E=fs(g,17)^fs(g,19)^g>>>10;Do[d]=E+Do[d-7]+m+Do[d-16]|0}let{A:r,B:i,C:s,D:o,E:a,F:l,G:c,H:h}=this;for(let d=0;d<64;d++){const p=fs(a,6)^fs(a,11)^fs(a,25),g=h+p+cz(a,l,c)+wz[d]+Do[d]|0,E=(fs(r,2)^fs(r,13)^fs(r,22))+uz(r,i,s)|0;h=c,c=l,l=a,a=o+g|0,o=s,s=i,i=r,r=g+E|0}r=r+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,l=l+this.F|0,c=c+this.G|0,h=h+this.H|0,this.set(r,i,s,o,a,l,c,h)}roundClean(){Nl(Do)}destroy(){this.set(0,0,0,0,0,0,0,0),Nl(this.buffer)}}const yL=fz(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(n=>BigInt(n))),_z=yL[0],Ez=yL[1],$o=new Uint32Array(80),Mo=new Uint32Array(80);class Sz extends mL{constructor(e=64){super(128,e,16,!1),this.Ah=_n[0]|0,this.Al=_n[1]|0,this.Bh=_n[2]|0,this.Bl=_n[3]|0,this.Ch=_n[4]|0,this.Cl=_n[5]|0,this.Dh=_n[6]|0,this.Dl=_n[7]|0,this.Eh=_n[8]|0,this.El=_n[9]|0,this.Fh=_n[10]|0,this.Fl=_n[11]|0,this.Gh=_n[12]|0,this.Gl=_n[13]|0,this.Hh=_n[14]|0,this.Hl=_n[15]|0}get(){const{Ah:e,Al:t,Bh:r,Bl:i,Ch:s,Cl:o,Dh:a,Dl:l,Eh:c,El:h,Fh:d,Fl:p,Gh:g,Gl:m,Hh:E,Hl:y}=this;return[e,t,r,i,s,o,a,l,c,h,d,p,g,m,E,y]}set(e,t,r,i,s,o,a,l,c,h,d,p,g,m,E,y){this.Ah=e|0,this.Al=t|0,this.Bh=r|0,this.Bl=i|0,this.Ch=s|0,this.Cl=o|0,this.Dh=a|0,this.Dl=l|0,this.Eh=c|0,this.El=h|0,this.Fh=d|0,this.Fl=p|0,this.Gh=g|0,this.Gl=m|0,this.Hh=E|0,this.Hl=y|0}process(e,t){for(let _=0;_<16;_++,t+=4)$o[_]=e.getUint32(t),Mo[_]=e.getUint32(t+=4);for(let _=16;_<80;_++){const I=$o[_-15]|0,x=Mo[_-15]|0,$=Ec(I,x,1)^Ec(I,x,8)^tC(I,x,7),U=Sc(I,x,1)^Sc(I,x,8)^rC(I,x,7),O=$o[_-2]|0,P=Mo[_-2]|0,M=Ec(O,P,19)^ip(O,P,61)^tC(O,P,6),K=Sc(O,P,19)^sp(O,P,61)^rC(O,P,6),C=gz(U,K,Mo[_-7],Mo[_-16]),B=mz(C,$,M,$o[_-7],$o[_-16]);$o[_]=B|0,Mo[_]=C|0}let{Ah:r,Al:i,Bh:s,Bl:o,Ch:a,Cl:l,Dh:c,Dl:h,Eh:d,El:p,Fh:g,Fl:m,Gh:E,Gl:y,Hh:S,Hl:b}=this;for(let _=0;_<80;_++){const I=Ec(d,p,14)^Ec(d,p,18)^ip(d,p,41),x=Sc(d,p,14)^Sc(d,p,18)^sp(d,p,41),$=d&g^~d&E,U=p&m^~p&y,O=yz(b,x,U,Ez[_],Mo[_]),P=bz(O,S,I,$,_z[_],$o[_]),M=O|0,K=Ec(r,i,28)^ip(r,i,34)^ip(r,i,39),C=Sc(r,i,28)^sp(r,i,34)^sp(r,i,39),B=r&s^r&a^s&a,N=i&o^i&l^o&l;S=E|0,b=y|0,E=g|0,y=m|0,g=d|0,m=p|0,{h:d,l:p}=Hs(c|0,h|0,P|0,M|0),c=a|0,h=l|0,a=s|0,l=o|0,s=r|0,o=i|0;const L=dz(M,C,N);r=pz(L,P,K,B),i=L|0}({h:r,l:i}=Hs(this.Ah|0,this.Al|0,r|0,i|0)),{h:s,l:o}=Hs(this.Bh|0,this.Bl|0,s|0,o|0),{h:a,l}=Hs(this.Ch|0,this.Cl|0,a|0,l|0),{h:c,l:h}=Hs(this.Dh|0,this.Dl|0,c|0,h|0),{h:d,l:p}=Hs(this.Eh|0,this.El|0,d|0,p|0),{h:g,l:m}=Hs(this.Fh|0,this.Fl|0,g|0,m|0),{h:E,l:y}=Hs(this.Gh|0,this.Gl|0,E|0,y|0),{h:S,l:b}=Hs(this.Hh|0,this.Hl|0,S|0,b|0),this.set(r,i,s,o,a,l,c,h,d,p,g,m,E,y,S,b)}roundClean(){Nl($o,Mo)}destroy(){Nl(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const bL=gL(()=>new vz),Az=gL(()=>new Sz),Kc=bL;function mt(n,e="utf8"){const t=hL[e];if(t==null)throw new Error(`Unsupported encoding "${e}"`);return t.encoder.encode(n).substring(1)}function wL(n){if(typeof n=="string"){const e=n.replace(/^0x/i,"");return at(e.toLowerCase(),"base16")}return n}function vL(n){const e=new ArrayBuffer(8),t=new DataView(e);return typeof n=="number"?t.setFloat64(0,n,!1):t.setBigInt64(0,n,!1),new Uint8Array(e)}const Ny=n=>mt(n,"base16"),uf=n=>mt(n,"utf8"),mu=n=>at(n,"utf8");function _L(n,e){const t=n.reduce((s,o)=>s+o.length,0),r=new Uint8Array(t);let i=0;for(const s of n)r.set(s,i),i+=s.length;return r}const EL=(n,e)=>`/waku/2/rs/${n}/${e}`,SL=n=>{const e=n.split("/");if(e.length!=6||e[1]!=="waku"||e[2]!=="2"||e[3]!=="rs")throw new Error("Invalid pubsub topic");const t=parseInt(e[4]),r=parseInt(e[5]);if(isNaN(t)||isNaN(r))throw new Error("Invalid clusterId or shard");return{clusterId:t,shard:r}};function AL(n){const e=n.split("/");if(e.length<5||e.length>6)throw Error(`Content topic format is invalid: ${n}`);let t=0;if(e.length==6){if(t=parseInt(e[1]),isNaN(t))throw new Error(`Invalid generation field in content topic: ${n}`);if(t>0)throw new Error(`Generation greater than 0 is not supported: ${n}`)}const r=e.splice(-4);if(r[0].length==0)throw new Error(`Application field cannot be empty: ${n}`);if(r[1].length==0)throw new Error(`Version field cannot be empty: ${n}`);if(r[2].length==0)throw new Error(`Topic name field cannot be empty: ${n}`);if(r[3].length==0)throw new Error(`Encoding field cannot be empty: ${n}`);return{generation:t,application:r[0],version:r[1],topicName:r[2],encoding:r[3]}}function xz(n,e){const{application:t,version:r}=AL(n),i=Kc(_L([mu(t),mu(r)])),s=new DataView(i.buffer.slice(-8));return Number(s.getBigUint64(0,!1)%BigInt(e))}class xL{constructor(e,t,r){v(this,"networkConfig");v(this,"pubsubTopic");v(this,"shardId");this.networkConfig=e,this.pubsubTopic=t,this.shardId=r}}class pS extends xL{constructor(t,r,i,s){super(t,r,i);v(this,"networkConfig");v(this,"pubsubTopic");v(this,"shardId");v(this,"contentTopic");this.networkConfig=t,this.pubsubTopic=r,this.shardId=i,this.contentTopic=s}static fromContentTopic(t,r){AL(t);const i=xz(t,r.numShardsInCluster),s=EL(r.clusterId,i);return new pS(r,s,i,t)}get clusterId(){return this.networkConfig.clusterId}get isAutoSharding(){return!0}get isStaticSharding(){return!1}}class hf extends xL{constructor(t,r,i){super(t,r,i);v(this,"networkConfig");v(this,"pubsubTopic");v(this,"shardId");this.networkConfig=t,this.pubsubTopic=r,this.shardId=i}static fromShard(t,r){const i=EL(r.clusterId,t);return new hf(r,i,t)}static fromPubsubTopic(t,r){const{clusterId:i,shard:s}=SL(t);if(i!=r.clusterId)throw"Pubsub topic does not match network config's cluster id";return new hf(r,t,s)}get clusterId(){return this.networkConfig.clusterId}get isAutoSharding(){return!1}get isStaticSharding(){return!0}}function IL(n,e){if(iz(n)){if(e.contentTopic)return pS.fromContentTopic(e.contentTopic,n);throw new Error("AutoSharding requires contentTopic")}else{if(e.shardId!==void 0)return hf.fromShard(e.shardId,n);if(e.pubsubTopic)return hf.fromPubsubTopic(e.pubsubTopic,n);throw new Error("StaticSharding requires shardId or pubsubTopic")}}const w1=n=>{if(n=new Uint8Array(n),n.length<3)throw new Error("Insufficient data");const e=new DataView(n.buffer),t=e.getUint16(0),r=[];if(n.length===130)for(let i=0;i<1024;i++){const s=Math.floor(i/8)+2,o=7-i%8;e.getUint8(s)&1<<o&&r.push(i)}else{const i=e.getUint8(2);for(let s=0,o=3;s<i;s++,o+=2){if(o+1>=n.length)throw new Error("Unexpected end of data");r.push(e.getUint16(o))}}return{clusterId:t,shards:r}},gS=n=>{const{clusterId:e,shards:t}=n,r=t.length>=64?130:3+2*t.length,i=new ArrayBuffer(r),s=new DataView(i);if(s.setUint16(0,e),t.length>=64)for(const o of t){const a=Math.floor(o/8)+2,l=7-o%8;s.setUint8(a,s.getUint8(a)|1<<l)}else{s.setUint8(2,t.length);for(let o=0,a=3;o<t.length;o++,a+=2)s.setUint16(a,t[o])}return new Uint8Array(i)},Iz=Symbol.for("@libp2p/connection"),nC=Symbol.for("@libp2p/content-routing"),ff=Symbol.for("@libp2p/peer-discovery"),Dy=Symbol.for("@libp2p/peer-id");function Cl(n){return!!(n!=null&&n[Dy])}const iC=Symbol.for("@libp2p/peer-routing"),TL="keep-alive",Tz=Symbol.for("@libp2p/transport");var df;(function(n){n[n.FATAL_ALL=0]="FATAL_ALL",n[n.NO_FATAL=1]="NO_FATAL"})(df||(df={}));var ev;let yu=(ev=class extends Error{constructor(e="The operation was aborted"){super(e),this.name="AbortError"}},v(ev,"name","AbortError"),ev);class CL extends Error{constructor(e="Unexpected Peer"){super(e),this.name="UnexpectedPeerError"}}v(CL,"name","UnexpectedPeerError");var tv;let Cz=(tv=class extends Error{constructor(e="Invalid crypto exchange"){super(e),this.name="InvalidCryptoExchangeError"}},v(tv,"name","InvalidCryptoExchangeError"),tv);var rv;let rr=(rv=class extends Error{constructor(e="Invalid parameters"){super(e),this.name="InvalidParametersError"}},v(rv,"name","InvalidParametersError"),rv);var nv;let kz=(nv=class extends Error{constructor(e="Invalid public key"){super(e),this.name="InvalidPublicKeyError"}},v(nv,"name","InvalidPublicKeyError"),nv);class kL extends Error{constructor(e="The connection is closing"){super(e),this.name="ConnectionClosingError"}}v(kL,"name","ConnectionClosingError");class mS extends Error{constructor(e="The connection is closed"){super(e),this.name="ConnectionClosedError"}}v(mS,"name","ConnectionClosedError");class PL extends Error{constructor(e="Connection failed"){super(e),this.name="ConnectionFailedError"}}v(PL,"name","ConnectionFailedError");class RL extends Error{constructor(e="The muxer is closed"){super(e),this.name="MuxerClosedError"}}v(RL,"name","MuxerClosedError");class OL extends Error{constructor(e="The stream has been reset"){super(e),this.name="StreamResetError"}}v(OL,"name","StreamResetError");class LL extends Error{constructor(e="The stream is in an invalid state"){super(e),this.name="StreamStateError"}}v(LL,"name","StreamStateError");var iv;let v1=(iv=class extends Error{constructor(e="Not found"){super(e),this.name="NotFoundError"}},v(iv,"name","NotFoundError"),iv);class yS extends Error{constructor(e="Invalid PeerID"){super(e),this.name="InvalidPeerIdError"}}v(yS,"name","InvalidPeerIdError");var sv;let bS=(sv=class extends Error{constructor(e="Invalid multiaddr"){super(e),this.name="InvalidMultiaddrError"}},v(sv,"name","InvalidMultiaddrError"),sv);class NL extends Error{constructor(e="Invalid CID"){super(e),this.name="InvalidCIDError"}}v(NL,"name","InvalidCIDError");class DL extends Error{constructor(e="Invalid Multihash"){super(e),this.name="InvalidMultihashError"}}v(DL,"name","InvalidMultihashError");class $y extends Error{constructor(e="Unsupported protocol error"){super(e),this.name="UnsupportedProtocolError"}}v($y,"name","UnsupportedProtocolError");class is extends Error{constructor(e="Invalid message"){super(e),this.name="InvalidMessageError"}}v(is,"name","InvalidMessageError");var ov;let Pz=(ov=class extends Error{constructor(e="Protocol error"){super(e),this.name="ProtocolError"}},v(ov,"name","ProtocolError"),ov);var av;let $L=(av=class extends Error{constructor(e="Timed out"){super(e),this.name="TimeoutError"}},v(av,"name","TimeoutError"),av);class pf extends Error{constructor(e="Not started"){super(e),this.name="NotStartedError"}}v(pf,"name","NotStartedError");class Ag extends Error{constructor(e="Dial error"){super(e),this.name="DialError"}}v(Ag,"name","DialError");class wS extends Error{constructor(e="Limited connection"){super(e),this.name="LimitedConnectionError"}}v(wS,"name","LimitedConnectionError");class ML extends Error{constructor(e="Too many inbound protocol streams"){super(e),this.name="TooManyInboundProtocolStreamsError"}}v(ML,"name","TooManyInboundProtocolStreamsError");class vS extends Error{constructor(e="Too many outbound protocol streams"){super(e),this.name="TooManyOutboundProtocolStreamsError"}}v(vS,"name","TooManyOutboundProtocolStreamsError");var lv;let BL=(lv=class extends Error{constructor(e="Unsupported key type"){super(e),this.name="UnsupportedKeyTypeError"}},v(lv,"name","UnsupportedKeyTypeError"),lv);var ms;class Si extends EventTarget{constructor(){super();Qe(this,ms,new Map)}listenerCount(t){const r=q(this,ms).get(t);return r==null?0:r.length}addEventListener(t,r,i){super.addEventListener(t,r,i);let s=q(this,ms).get(t);s==null&&(s=[],q(this,ms).set(t,s)),s.push({callback:r,once:(i!==!0&&i!==!1&&(i==null?void 0:i.once))??!1})}removeEventListener(t,r,i){super.removeEventListener(t.toString(),r??null,i);let s=q(this,ms).get(t);s!=null&&(s=s.filter(({callback:o})=>o!==r),q(this,ms).set(t,s))}dispatchEvent(t){const r=super.dispatchEvent(t);let i=q(this,ms).get(t.type);return i==null||(i=i.filter(({once:s})=>!s),q(this,ms).set(t.type,i)),r}safeDispatchEvent(t,r={}){return this.dispatchEvent(new CustomEvent(t,r))}}ms=new WeakMap;function _S(n){return n!=null&&typeof n.start=="function"&&typeof n.stop=="function"}async function Rz(...n){const e=[];for(const t of n)_S(t)&&e.push(t);await Promise.all(e.map(async t=>{t.beforeStart!=null&&await t.beforeStart()})),await Promise.all(e.map(async t=>{await t.start()})),await Promise.all(e.map(async t=>{t.afterStart!=null&&await t.afterStart()}))}async function Oz(...n){const e=[];for(const t of n)_S(t)&&e.push(t);await Promise.all(e.map(async t=>{t.beforeStop!=null&&await t.beforeStop()})),await Promise.all(e.map(async t=>{await t.stop()})),await Promise.all(e.map(async t=>{t.afterStop!=null&&await t.afterStop()}))}const bo=Symbol.for("@libp2p/service-capabilities"),sC=Symbol.for("@libp2p/service-dependencies");var Ui=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Yl(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function Lz(n){if(n.__esModule)return n;var e=n.default;if(typeof e=="function"){var t=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(r){var i=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(t,r,i.get?i:{enumerable:!0,get:function(){return n[r]}})}),t}var _1={exports:{}},B0,oC;function Nz(){if(oC)return B0;oC=1;var n=1e3,e=n*60,t=e*60,r=t*24,i=r*7,s=r*365.25;B0=function(h,d){d=d||{};var p=typeof h;if(p==="string"&&h.length>0)return o(h);if(p==="number"&&isFinite(h))return d.long?l(h):a(h);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(h))};function o(h){if(h=String(h),!(h.length>100)){var d=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(h);if(d){var p=parseFloat(d[1]),g=(d[2]||"ms").toLowerCase();switch(g){case"years":case"year":case"yrs":case"yr":case"y":return p*s;case"weeks":case"week":case"w":return p*i;case"days":case"day":case"d":return p*r;case"hours":case"hour":case"hrs":case"hr":case"h":return p*t;case"minutes":case"minute":case"mins":case"min":case"m":return p*e;case"seconds":case"second":case"secs":case"sec":case"s":return p*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return p;default:return}}}}function a(h){var d=Math.abs(h);return d>=r?Math.round(h/r)+"d":d>=t?Math.round(h/t)+"h":d>=e?Math.round(h/e)+"m":d>=n?Math.round(h/n)+"s":h+"ms"}function l(h){var d=Math.abs(h);return d>=r?c(h,d,r,"day"):d>=t?c(h,d,t,"hour"):d>=e?c(h,d,e,"minute"):d>=n?c(h,d,n,"second"):h+" ms"}function c(h,d,p,g){var m=d>=p*1.5;return Math.round(h/p)+" "+g+(m?"s":"")}return B0}function Dz(n){t.debug=t,t.default=t,t.coerce=l,t.disable=o,t.enable=i,t.enabled=a,t.humanize=Nz(),t.destroy=c,Object.keys(n).forEach(h=>{t[h]=n[h]}),t.names=[],t.skips=[],t.formatters={};function e(h){let d=0;for(let p=0;p<h.length;p++)d=(d<<5)-d+h.charCodeAt(p),d|=0;return t.colors[Math.abs(d)%t.colors.length]}t.selectColor=e;function t(h){let d,p=null,g,m;function E(...y){if(!E.enabled)return;const S=E,b=Number(new Date),_=b-(d||b);S.diff=_,S.prev=d,S.curr=b,d=b,y[0]=t.coerce(y[0]),typeof y[0]!="string"&&y.unshift("%O");let I=0;y[0]=y[0].replace(/%([a-zA-Z%])/g,($,U)=>{if($==="%%")return"%";I++;const O=t.formatters[U];if(typeof O=="function"){const P=y[I];$=O.call(S,P),y.splice(I,1),I--}return $}),t.formatArgs.call(S,y),(S.log||t.log).apply(S,y)}return E.namespace=h,E.useColors=t.useColors(),E.color=t.selectColor(h),E.extend=r,E.destroy=t.destroy,Object.defineProperty(E,"enabled",{enumerable:!0,configurable:!1,get:()=>p!==null?p:(g!==t.namespaces&&(g=t.namespaces,m=t.enabled(h)),m),set:y=>{p=y}}),typeof t.init=="function"&&t.init(E),E}function r(h,d){const p=t(this.namespace+(typeof d>"u"?":":d)+h);return p.log=this.log,p}function i(h){t.save(h),t.namespaces=h,t.names=[],t.skips=[];const d=(typeof h=="string"?h:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(const p of d)p[0]==="-"?t.skips.push(p.slice(1)):t.names.push(p)}function s(h,d){let p=0,g=0,m=-1,E=0;for(;p<h.length;)if(g<d.length&&(d[g]===h[p]||d[g]==="*"))d[g]==="*"?(m=g,E=p,g++):(p++,g++);else if(m!==-1)g=m+1,E++,p=E;else return!1;for(;g<d.length&&d[g]==="*";)g++;return g===d.length}function o(){const h=[...t.names,...t.skips.map(d=>"-"+d)].join(",");return t.enable(""),h}function a(h){for(const d of t.skips)if(s(h,d))return!1;for(const d of t.names)if(s(h,d))return!0;return!1}function l(h){return h instanceof Error?h.stack||h.message:h}function c(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}var $z=Dz;(function(n,e){var t={};e.formatArgs=i,e.save=s,e.load=o,e.useColors=r,e.storage=a(),e.destroy=(()=>{let c=!1;return()=>{c||(c=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function r(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let c;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(c=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(c[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function i(c){if(c[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+c[0]+(this.useColors?"%c ":" ")+"+"+n.exports.humanize(this.diff),!this.useColors)return;const h="color: "+this.color;c.splice(1,0,h,"color: inherit");let d=0,p=0;c[0].replace(/%[a-zA-Z%]/g,g=>{g!=="%%"&&(d++,g==="%c"&&(p=d))}),c.splice(p,0,h)}e.log=console.debug||console.log||(()=>{});function s(c){try{c?e.storage.setItem("debug",c):e.storage.removeItem("debug")}catch{}}function o(){let c;try{c=e.storage.getItem("debug")||e.storage.getItem("DEBUG")}catch{}return!c&&typeof process<"u"&&"env"in process&&(c=t.DEBUG),c}function a(){try{return localStorage}catch{}}n.exports=$z(e);const{formatters:l}=n.exports;l.j=function(c){try{return JSON.stringify(c)}catch(h){return"[UnexpectedJSONParseError]: "+h.message}}})(_1,_1.exports);var Mz=_1.exports;const U0=Yl(Mz),aC="waku";let Ct=class xg{constructor(e){v(this,"_info");v(this,"_warn");v(this,"_error");this._info=U0(xg.createDebugNamespace("info",e)),this._warn=U0(xg.createDebugNamespace("warn",e)),this._error=U0(xg.createDebugNamespace("error",e))}static createDebugNamespace(e,t){return t?`${aC}:${t}:${e}`:`${aC}:${e}`}get info(){return this._info}get warn(){return this._warn}get error(){return this._error}log(e,...t){(this[e]||this.log)(...t)}};function ES(n,e){const t=mu(n),r=mu(e.contentTopic),i=Bz(e.timestamp),s=_L([t,e.payload,r,e.meta,i].filter(dS));return Kc(s)}function Bz(n){if(!n)return;let e;return typeof n=="bigint"?e=n:e=BigInt(n.valueOf())*1000000n,vL(e)}function Uz(n,e){const t=ES(n,e);return Ny(t)}const Fz=new Ct("message:version-0"),UL=BigInt(1e6),Tm=0;class jz{constructor(e,t){v(this,"pubsubTopic");v(this,"proto");v(this,"_hash");v(this,"_hashStr");this.pubsubTopic=e,this.proto=t}get ephemeral(){return!!this.proto.ephemeral}get payload(){return this.proto.payload}get contentTopic(){return this.proto.contentTopic}get hash(){return this._hash===void 0&&(this._hash=ES(this.pubsubTopic,this.proto)),this._hash}get hashStr(){return this._hashStr===void 0&&(this._hashStr=Ny(this.hash)),this._hashStr}get timestamp(){try{if(this.proto.timestamp){const e=this.proto.timestamp/UL;return new Date(Number(e))}return}catch{return}}get meta(){return this.proto.meta}get version(){return this.proto.version??Tm}get rateLimitProof(){return this.proto.rateLimitProof}}let qz=class{constructor(e,t=!1,r,i){v(this,"contentTopic");v(this,"ephemeral");v(this,"routingInfo");v(this,"metaSetter");if(this.contentTopic=e,this.ephemeral=t,this.routingInfo=r,this.metaSetter=i,!e||e==="")throw new Error("Content topic must be specified")}get pubsubTopic(){return this.routingInfo.pubsubTopic}async toWire(e){return Qg.encode(await this.toProtoObj(e))}async toProtoObj(e){const t=e.timestamp??new Date,r={payload:e.payload,version:Tm,contentTopic:this.contentTopic,timestamp:BigInt(t.valueOf())*UL,meta:void 0,rateLimitProof:e.rateLimitProof,ephemeral:this.ephemeral};if(this.metaSetter){const i=this.metaSetter(r);return{...r,meta:i}}return r}};function FL({contentTopic:n,routingInfo:e,ephemeral:t,metaSetter:r}){return new qz(n,t,e,r)}let Hz=class{constructor(e,t){v(this,"contentTopic");v(this,"routingInfo");if(this.contentTopic=e,this.routingInfo=t,!e||e==="")throw new Error("Content topic must be specified")}get pubsubTopic(){return this.routingInfo.pubsubTopic}fromWireToProtoObj(e){const t=Qg.decode(e);return Promise.resolve({payload:t.payload,contentTopic:t.contentTopic,version:t.version??void 0,timestamp:t.timestamp??void 0,meta:t.meta??void 0,rateLimitProof:t.rateLimitProof??void 0,ephemeral:t.ephemeral??!1})}async fromProtoObj(e,t){return t.version??Tm!==0?(Fz.error("Failed to decode due to incorrect version, expected:",Tm,", actual:",t.version),Promise.resolve(void 0)):new jz(e,t)}};function Wz(n,e){return new Hz(n,e)}var mi;(function(n){n[n.SUCCESS=200]="SUCCESS",n[n.BAD_REQUEST=400]="BAD_REQUEST",n[n.PAYLOAD_TOO_LARGE=413]="PAYLOAD_TOO_LARGE",n[n.INVALID_MESSAGE=420]="INVALID_MESSAGE",n[n.UNSUPPORTED_TOPIC=421]="UNSUPPORTED_TOPIC",n[n.TOO_MANY_REQUESTS=429]="TOO_MANY_REQUESTS",n[n.INTERNAL_ERROR=500]="INTERNAL_ERROR",n[n.UNAVAILABLE=503]="UNAVAILABLE",n[n.NO_RLN_PROOF=504]="NO_RLN_PROOF",n[n.NO_PEERS=505]="NO_PEERS"})(mi||(mi={}));mi.SUCCESS+"",mi.BAD_REQUEST+"",mi.PAYLOAD_TOO_LARGE+"",mi.INVALID_MESSAGE+"",mi.UNSUPPORTED_TOPIC+"",mi.TOO_MANY_REQUESTS+"",mi.INTERNAL_ERROR+"",mi.UNAVAILABLE+"",mi.NO_RLN_PROOF+"",mi.NO_PEERS+"";var It;(function(n){n.Relay="relay",n.Store="store",n.LightPush="lightpush",n.Filter="filter"})(It||(It={}));var hr;(function(n){n.GENERIC_FAIL="Generic error",n.DECODE_FAILED="Failed to decode",n.NO_PEER_AVAILABLE="No peer available",n.NO_STREAM_AVAILABLE="No stream available",n.NO_RESPONSE="No response received",n.STREAM_ABORTED="Stream aborted",n.ENCODE_FAILED="Failed to encode",n.EMPTY_PAYLOAD="Payload is empty",n.SIZE_TOO_BIG="Size is too big",n.TOPIC_NOT_CONFIGURED="Topic not configured",n.RLN_PROOF_GENERATION="Proof generation failed",n.REMOTE_PEER_REJECTED="Remote peer rejected",n.BAD_REQUEST="Bad request format",n.PAYLOAD_TOO_LARGE="Message payload exceeds maximum size",n.INVALID_MESSAGE="Message validation failed",n.UNSUPPORTED_TOPIC="Unsupported pubsub topic",n.TOO_MANY_REQUESTS="Rate limit exceeded",n.INTERNAL_ERROR="Internal server error",n.UNAVAILABLE="Service temporarily unavailable",n.NO_RLN_PROOF="RLN proof generation failed",n.NO_PEERS="No relay peers available"})(hr||(hr={}));var Gn;(function(n){n.GENERIC_FAIL="Generic error",n.DECODE_FAILED="Failed to decode",n.NO_PEER_AVAILABLE="No peer available",n.NO_STREAM_AVAILABLE="No stream available",n.NO_RESPONSE="No response received",n.STREAM_ABORTED="Stream aborted",n.REMOTE_PEER_REJECTED="Remote peer rejected",n.TOPIC_NOT_CONFIGURED="Topic not configured",n.SUBSCRIPTION_FAILED="Subscription failed",n.UNSUBSCRIBE_FAILED="Unsubscribe failed",n.PING_FAILED="Ping failed",n.TOPIC_DECODER_MISMATCH="Topic decoder mismatch",n.INVALID_DECODER_TOPICS="Invalid decoder topics",n.SUBSCRIPTION_LIMIT_EXCEEDED="Subscription limit exceeded",n.INVALID_CONTENT_TOPIC="Invalid content topic",n.PUSH_MESSAGE_FAILED="Push message failed",n.EMPTY_MESSAGE="Empty message received",n.MISSING_PUBSUB_TOPIC="Pubsub topic missing from push message"})(Gn||(Gn={}));var oo;(function(n){n.GENERIC_FAIL="Generic error",n.REMOTE_PEER_REJECTED="Remote peer rejected",n.DECODE_FAILED="Failed to decode",n.NO_PEER_AVAILABLE="No peer available",n.NO_STREAM_AVAILABLE="No stream available",n.NO_RESPONSE="No response received",n.ENCODE_FAILED="Failed to encode",n.EMPTY_PAYLOAD="Payload is empty",n.SIZE_TOO_BIG="Size is too big",n.TOPIC_NOT_CONFIGURED="Topic not configured",n.STREAM_ABORTED="Stream aborted",n.RLN_PROOF_GENERATION="Proof generation failed",n.TOPIC_DECODER_MISMATCH="Topic decoder mismatch",n.INVALID_DECODER_TOPICS="Invalid decoder topics"})(oo||(oo={}));var bu;(function(n){n.Connection="waku:connection",n.Health="waku:health"})(bu||(bu={}));var Yn;(function(n){n.BOOTSTRAP="bootstrap",n.PEER_EXCHANGE="peer-exchange",n.PEER_CACHE="peer-cache"})(Yn||(Yn={}));const E1="locked",zz="@waku/bootstrap",jL=1,Kz=8,qL={clusterId:jL,numShardsInCluster:Kz};var Ya;(function(n){n.Unhealthy="Unhealthy",n.MinimallyHealthy="MinimallyHealthy",n.SufficientlyHealthy="SufficientlyHealthy"})(Ya||(Ya={}));function Vz(n){return n[Symbol.asyncIterator]!=null}function as(n){if(Vz(n))return(async()=>{const t=[];for await(const r of n)t.push(r);return t})();const e=[];for(const t of n)e.push(t);return e}function Dl(n,e){e==null&&(e=n.reduce((i,s)=>i+s.length,0));const t=Ei(e);let r=0;for(const i of n)t.set(i,r),r+=i.length;return t}function Or(n,e){if(n===e)return!0;if(n.byteLength!==e.byteLength)return!1;for(let t=0;t<n.byteLength;t++)if(n[t]!==e[t])return!1;return!0}const HL=Symbol.for("@achingbrain/uint8arraylist");function lC(n,e){if(e==null||e<0)throw new RangeError("index is out of bounds");let t=0;for(const r of n){const i=t+r.byteLength;if(e<i)return{buf:r,index:e-t};t=i}throw new RangeError("index is out of bounds")}function op(n){return!!(n!=null&&n[HL])}var CR;class bt{constructor(...e){v(this,"bufs");v(this,"length");v(this,CR,!0);this.bufs=[],this.length=0,e.length>0&&this.appendAll(e)}*[(CR=HL,Symbol.iterator)](){yield*this.bufs}get byteLength(){return this.length}append(...e){this.appendAll(e)}appendAll(e){let t=0;for(const r of e)if(r instanceof Uint8Array)t+=r.byteLength,this.bufs.push(r);else if(op(r))t+=r.byteLength,this.bufs.push(...r.bufs);else throw new Error("Could not append value, must be an Uint8Array or a Uint8ArrayList");this.length+=t}prepend(...e){this.prependAll(e)}prependAll(e){let t=0;for(const r of e.reverse())if(r instanceof Uint8Array)t+=r.byteLength,this.bufs.unshift(r);else if(op(r))t+=r.byteLength,this.bufs.unshift(...r.bufs);else throw new Error("Could not prepend value, must be an Uint8Array or a Uint8ArrayList");this.length+=t}get(e){const t=lC(this.bufs,e);return t.buf[t.index]}set(e,t){const r=lC(this.bufs,e);r.buf[r.index]=t}write(e,t=0){if(e instanceof Uint8Array)for(let r=0;r<e.length;r++)this.set(t+r,e[r]);else if(op(e))for(let r=0;r<e.length;r++)this.set(t+r,e.get(r));else throw new Error("Could not write value, must be an Uint8Array or a Uint8ArrayList")}consume(e){if(e=Math.trunc(e),!(Number.isNaN(e)||e<=0)){if(e===this.byteLength){this.bufs=[],this.length=0;return}for(;this.bufs.length>0;)if(e>=this.bufs[0].byteLength)e-=this.bufs[0].byteLength,this.length-=this.bufs[0].byteLength,this.bufs.shift();else{this.bufs[0]=this.bufs[0].subarray(e),this.length-=e;break}}}slice(e,t){const{bufs:r,length:i}=this._subList(e,t);return Dl(r,i)}subarray(e,t){const{bufs:r,length:i}=this._subList(e,t);return r.length===1?r[0]:Dl(r,i)}sublist(e,t){const{bufs:r,length:i}=this._subList(e,t),s=new bt;return s.length=i,s.bufs=[...r],s}_subList(e,t){if(e=e??0,t=t??this.length,e<0&&(e=this.length+e),t<0&&(t=this.length+t),e<0||t>this.length)throw new RangeError("index is out of bounds");if(e===t)return{bufs:[],length:0};if(e===0&&t===this.length)return{bufs:this.bufs,length:this.length};const r=[];let i=0;for(let s=0;s<this.bufs.length;s++){const o=this.bufs[s],a=i,l=a+o.byteLength;if(i=l,e>=l)continue;const c=e>=a&&e<l,h=t>a&&t<=l;if(c&&h){if(e===a&&t===l){r.push(o);break}const d=e-a;r.push(o.subarray(d,d+(t-e)));break}if(c){if(e===0){r.push(o);continue}r.push(o.subarray(e-a));continue}if(h){if(t===l){r.push(o);break}r.push(o.subarray(0,t-a));break}r.push(o)}return{bufs:r,length:t-e}}indexOf(e,t=0){if(!op(e)&&!(e instanceof Uint8Array))throw new TypeError('The "value" argument must be a Uint8ArrayList or Uint8Array');const r=e instanceof Uint8Array?e:e.subarray();if(t=Number(t??0),isNaN(t)&&(t=0),t<0&&(t=this.length+t),t<0&&(t=0),e.length===0)return t>this.length?this.length:t;const i=r.byteLength;if(i===0)throw new TypeError("search must be at least 1 byte long");const s=256,o=new Int32Array(s);for(let d=0;d<s;d++)o[d]=-1;for(let d=0;d<i;d++)o[r[d]]=d;const a=o,l=this.byteLength-r.byteLength,c=r.byteLength-1;let h;for(let d=t;d<=l;d+=h){h=0;for(let p=c;p>=0;p--){const g=this.get(d+p);if(r[p]!==g){h=Math.max(1,p-a[g]);break}}if(h===0)return d}return-1}getInt8(e){const t=this.subarray(e,e+1);return new DataView(t.buffer,t.byteOffset,t.byteLength).getInt8(0)}setInt8(e,t){const r=Ei(1);new DataView(r.buffer,r.byteOffset,r.byteLength).setInt8(0,t),this.write(r,e)}getInt16(e,t){const r=this.subarray(e,e+2);return new DataView(r.buffer,r.byteOffset,r.byteLength).getInt16(0,t)}setInt16(e,t,r){const i=Je(2);new DataView(i.buffer,i.byteOffset,i.byteLength).setInt16(0,t,r),this.write(i,e)}getInt32(e,t){const r=this.subarray(e,e+4);return new DataView(r.buffer,r.byteOffset,r.byteLength).getInt32(0,t)}setInt32(e,t,r){const i=Je(4);new DataView(i.buffer,i.byteOffset,i.byteLength).setInt32(0,t,r),this.write(i,e)}getBigInt64(e,t){const r=this.subarray(e,e+8);return new DataView(r.buffer,r.byteOffset,r.byteLength).getBigInt64(0,t)}setBigInt64(e,t,r){const i=Je(8);new DataView(i.buffer,i.byteOffset,i.byteLength).setBigInt64(0,t,r),this.write(i,e)}getUint8(e){const t=this.subarray(e,e+1);return new DataView(t.buffer,t.byteOffset,t.byteLength).getUint8(0)}setUint8(e,t){const r=Ei(1);new DataView(r.buffer,r.byteOffset,r.byteLength).setUint8(0,t),this.write(r,e)}getUint16(e,t){const r=this.subarray(e,e+2);return new DataView(r.buffer,r.byteOffset,r.byteLength).getUint16(0,t)}setUint16(e,t,r){const i=Je(2);new DataView(i.buffer,i.byteOffset,i.byteLength).setUint16(0,t,r),this.write(i,e)}getUint32(e,t){const r=this.subarray(e,e+4);return new DataView(r.buffer,r.byteOffset,r.byteLength).getUint32(0,t)}setUint32(e,t,r){const i=Je(4);new DataView(i.buffer,i.byteOffset,i.byteLength).setUint32(0,t,r),this.write(i,e)}getBigUint64(e,t){const r=this.subarray(e,e+8);return new DataView(r.buffer,r.byteOffset,r.byteLength).getBigUint64(0,t)}setBigUint64(e,t,r){const i=Je(8);new DataView(i.buffer,i.byteOffset,i.byteLength).setBigUint64(0,t,r),this.write(i,e)}getFloat32(e,t){const r=this.subarray(e,e+4);return new DataView(r.buffer,r.byteOffset,r.byteLength).getFloat32(0,t)}setFloat32(e,t,r){const i=Je(4);new DataView(i.buffer,i.byteOffset,i.byteLength).setFloat32(0,t,r),this.write(i,e)}getFloat64(e,t){const r=this.subarray(e,e+8);return new DataView(r.buffer,r.byteOffset,r.byteLength).getFloat64(0,t)}setFloat64(e,t,r){const i=Je(8);new DataView(i.buffer,i.byteOffset,i.byteLength).setFloat64(0,t,r),this.write(i,e)}equals(e){if(e==null||!(e instanceof bt)||e.bufs.length!==this.bufs.length)return!1;for(let t=0;t<this.bufs.length;t++)if(!Or(this.bufs[t],e.bufs[t]))return!1;return!0}static fromUint8Arrays(e,t){const r=new bt;return r.bufs=e,t==null&&(t=e.reduce((i,s)=>i+s.byteLength,0)),r.length=t,r}}function WL(n){return n[Symbol.asyncIterator]!=null}const My=n=>{const e=un(n),t=Ei(e);return Ts(n,t),My.bytes=e,t};My.bytes=0;function ao(n,e){e=e??{};const t=e.lengthEncoder??My;function*r(i){const s=t(i.byteLength);s instanceof Uint8Array?yield s:yield*s,i instanceof Uint8Array?yield i:yield*i}return WL(n)?async function*(){for await(const i of n)yield*r(i)}():function*(){for(const i of n)yield*r(i)}()}ao.single=(n,e)=>{e=e??{};const t=e.lengthEncoder??My;return new bt(t(n.byteLength),n)};let Gz=class extends Error{constructor(){super(...arguments);v(this,"name","InvalidMessageLengthError");v(this,"code","ERR_INVALID_MSG_LENGTH")}},Yz=class extends Error{constructor(){super(...arguments);v(this,"name","InvalidDataLengthError");v(this,"code","ERR_MSG_DATA_TOO_LONG")}},Xz=class extends Error{constructor(){super(...arguments);v(this,"name","InvalidDataLengthLengthError");v(this,"code","ERR_MSG_LENGTH_TOO_LONG")}},cC=class extends Error{constructor(){super(...arguments);v(this,"name","UnexpectedEOFError");v(this,"code","ERR_UNEXPECTED_EOF")}};const Zz=8,Qz=1024*1024*4;var Xa;(function(n){n[n.LENGTH=0]="LENGTH",n[n.DATA=1]="DATA"})(Xa||(Xa={}));const SS=n=>{const e=Wf(n);return SS.bytes=un(e),e};SS.bytes=0;function xs(n,e){const t=new bt;let r=Xa.LENGTH,i=-1;const s=(e==null?void 0:e.lengthDecoder)??SS,o=(e==null?void 0:e.maxLengthLength)??Zz,a=(e==null?void 0:e.maxDataLength)??Qz;function*l(){for(;t.byteLength>0;){if(r===Xa.LENGTH)try{if(i=s(t),i<0)throw new Gz("Invalid message length");if(i>a)throw new Yz("Message length too long");const c=s.bytes;t.consume(c),(e==null?void 0:e.onLength)!=null&&e.onLength(i),r=Xa.DATA}catch(c){if(c instanceof RangeError){if(t.byteLength>o)throw new Xz("Message length length too long");break}throw c}if(r===Xa.DATA){if(t.byteLength<i)break;const c=t.sublist(0,i);t.consume(i),(e==null?void 0:e.onData)!=null&&e.onData(c),yield c,r=Xa.LENGTH}}}return WL(n)?async function*(){for await(const c of n)t.append(c),yield*l();if(t.byteLength>0)throw new cC("Unexpected end of input")}():function*(){for(const c of n)t.append(c),yield*l();if(t.byteLength>0)throw new cC("Unexpected end of input")}()}xs.fromReader=(n,e)=>{let t=1;const r=async function*(){for(;;)try{const{done:s,value:o}=await n.next(t);if(s===!0)return;o!=null&&(yield o)}catch(s){if(s.code==="ERR_UNDER_READ")return{done:!0,value:null};throw s}finally{t=1}}();return xs(r,{...e??{},onLength:s=>{t=s}})};function qr(){const n={};return n.promise=new Promise((e,t)=>{n.resolve=e,n.reject=t}),n}class uC{constructor(e){v(this,"buffer");v(this,"mask");v(this,"top");v(this,"btm");v(this,"next");if(!(e>0)||e-1&e)throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}push(e){return this.buffer[this.top]!==void 0?!1:(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){const e=this.buffer[this.btm];if(e!==void 0)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}isEmpty(){return this.buffer[this.btm]===void 0}}class F0{constructor(e={}){v(this,"size");v(this,"hwm");v(this,"head");v(this,"tail");this.hwm=e.splitLimit??16,this.head=new uC(this.hwm),this.tail=this.head,this.size=0}calculateSize(e){return(e==null?void 0:e.byteLength)!=null?e.byteLength:1}push(e){if((e==null?void 0:e.value)!=null&&(this.size+=this.calculateSize(e.value)),!this.head.push(e)){const t=this.head;this.head=t.next=new uC(2*this.head.buffer.length),this.head.push(e)}}shift(){let e=this.tail.shift();if(e===void 0&&this.tail.next!=null){const t=this.tail.next;this.tail.next=null,this.tail=t,e=this.tail.shift()}return(e==null?void 0:e.value)!=null&&(this.size-=this.calculateSize(e.value)),e}isEmpty(){return this.head.isEmpty()}}let Jz=class extends Error{constructor(t,r){super(t??"The operation was aborted");v(this,"type");v(this,"code");this.type="aborted",this.code=r??"ABORT_ERR"}};function Gf(n={}){return eK(t=>{const r=t.shift();if(r==null)return{done:!0};if(r.error!=null)throw r.error;return{done:r.done===!0,value:r.value}},n)}function eK(n,e){e=e??{};let t=e.onEnd,r=new F0,i,s,o,a=qr();const l=async()=>{try{return r.isEmpty()?o?{done:!0}:await new Promise((y,S)=>{s=b=>{s=null,r.push(b);try{y(n(r))}catch(_){S(_)}return i}}):n(r)}finally{r.isEmpty()&&queueMicrotask(()=>{a.resolve(),a=qr()})}},c=y=>s!=null?s(y):(r.push(y),i),h=y=>(r=new F0,s!=null?s({error:y}):(r.push({error:y}),i)),d=y=>{if(o)return i;if((e==null?void 0:e.objectMode)!==!0&&(y==null?void 0:y.byteLength)==null)throw new Error("objectMode was not true but tried to push non-Uint8Array value");return c({done:!1,value:y})},p=y=>o?i:(o=!0,y!=null?h(y):c({done:!0})),g=()=>(r=new F0,p(),{done:!0}),m=y=>(p(y),{done:!0});if(i={[Symbol.asyncIterator](){return this},next:l,return:g,throw:m,push:d,end:p,get readableLength(){return r.size},onEmpty:async y=>{const S=y==null?void 0:y.signal;if(S==null||S.throwIfAborted(),r.isEmpty())return;let b,_;S!=null&&(b=new Promise((I,x)=>{_=()=>{x(new Jz)},S.addEventListener("abort",_)}));try{await Promise.race([a.promise,b])}finally{_!=null&&S!=null&&(S==null||S.removeEventListener("abort",_))}}},t==null)return i;const E=i;return i={[Symbol.asyncIterator](){return this},next(){return E.next()},throw(y){return E.throw(y),t!=null&&(t(y),t=void 0),{done:!0}},return(){return E.return(),t!=null&&(t(),t=void 0),{done:!0}},push:d,end(y){return E.end(y),t!=null&&(t(y),t=void 0),i},get readableLength(){return E.readableLength},onEmpty:y=>E.onEmpty(y)},i}let hC=class extends Error{constructor(t,r,i){super(t??"The operation was aborted");v(this,"type");v(this,"code");this.type="aborted",this.name=i??"AbortError",this.code=r??"ABORT_ERR"}};async function Un(n,e,t){if(e==null)return n;if(e.aborted)return n.catch(()=>{}),Promise.reject(new hC(t==null?void 0:t.errorMessage,t==null?void 0:t.errorCode,t==null?void 0:t.errorName));let r;const i=new hC(t==null?void 0:t.errorMessage,t==null?void 0:t.errorCode,t==null?void 0:t.errorName);try{return await Promise.race([n,new Promise((s,o)=>{r=()=>{o(i)},e.addEventListener("abort",r)})])}finally{r!=null&&e.removeEventListener("abort",r)}}class tK{constructor(){v(this,"readNext");v(this,"haveNext");v(this,"ended");v(this,"nextResult");v(this,"error");this.ended=!1,this.readNext=qr(),this.haveNext=qr()}[Symbol.asyncIterator](){return this}async next(){if(this.nextResult==null&&await this.haveNext.promise,this.nextResult==null)throw new Error("HaveNext promise resolved but nextResult was undefined");const e=this.nextResult;return this.nextResult=void 0,this.readNext.resolve(),this.readNext=qr(),e}async throw(e){return this.ended=!0,this.error=e,e!=null&&(this.haveNext.promise.catch(()=>{}),this.haveNext.reject(e)),{done:!0,value:void 0}}async return(){const e={done:!0,value:void 0};return this.ended=!0,this.nextResult=e,this.haveNext.resolve(),e}async push(e,t){await this._push(e,t)}async end(e,t){e!=null?await this.throw(e):await this._push(void 0,t)}async _push(e,t){if(e!=null&&this.ended)throw this.error??new Error("Cannot push value onto an ended pushable");for(;this.nextResult!=null;)await this.readNext.promise;e!=null?this.nextResult={done:!1,value:e}:(this.ended=!0,this.nextResult={done:!0,value:void 0}),this.haveNext.resolve(),this.haveNext=qr(),await Un(this.readNext.promise,t==null?void 0:t.signal,t)}}function zL(){return new tK}function rK(n){return n[Symbol.asyncIterator]!=null}async function nK(n,e,t){try{await Promise.all(n.map(async r=>{for await(const i of r)await e.push(i,{signal:t}),t.throwIfAborted()})),await e.end(void 0,{signal:t})}catch(r){await e.end(r,{signal:t}).catch(()=>{})}}async function*iK(n){const e=new AbortController,t=zL();nK(n,t,e.signal).catch(()=>{});try{yield*t}finally{e.abort()}}function*sK(n){for(const e of n)yield*e}function Cm(...n){const e=[];for(const t of n)rK(t)||e.push(t);return e.length===n.length?sK(e):iK(n)}function Fi(n,...e){if(n==null)throw new Error("Empty pipeline");if(j0(n)){const r=n;n=()=>r.source}else if(VL(n)||KL(n)){const r=n;n=()=>r}const t=[n,...e];if(t.length>1&&j0(t[t.length-1])&&(t[t.length-1]=t[t.length-1].sink),t.length>2)for(let r=1;r<t.length-1;r++)j0(t[r])&&(t[r]=aK(t[r]));return oK(...t)}const oK=(...n)=>{let e;for(;n.length>0;)e=n.shift()(e);return e},KL=n=>(n==null?void 0:n[Symbol.asyncIterator])!=null,VL=n=>(n==null?void 0:n[Symbol.iterator])!=null,j0=n=>n==null?!1:n.sink!=null&&n.source!=null,aK=n=>e=>{const t=n.sink(e);if((t==null?void 0:t.then)!=null){const r=Gf({objectMode:!0});t.then(()=>{r.end()},o=>{r.end(o)});let i;const s=n.source;if(KL(s))i=async function*(){yield*s,r.end()};else if(VL(s))i=function*(){yield*s,r.end()};else throw new Error("Unknown duplex source type - must be Iterable or AsyncIterable");return Cm(r,i())}return n.source};function fC(n){return n.filter(e=>e.status==="open").sort((e,t)=>t.timeline.open-e.timeline.open).at(0)}const dC="consumed";class wu{constructor(e,t){v(this,"multicodec");v(this,"libp2p");v(this,"log");v(this,"ongoingCreation",new Set);v(this,"streamPool",new Map);v(this,"handlePeerUpdateStreamPool",e=>{const{peer:t}=e.detail;!t.protocols.includes(this.multicodec)||this.getOpenStreamForCodec(t.id)||this.scheduleNewStream(t)});this.multicodec=e,this.libp2p=t,this.log=new Ct(`stream-manager:${e}`),this.libp2p.events.addEventListener("peer:update",this.handlePeerUpdateStreamPool)}async getStream(e){try{const t=e.toString(),r=this.streamPool.get(t);r&&(this.streamPool.delete(t),await r);const i=this.getOpenStreamForCodec(e)||await this.createStream(e);return i?(this.log.info(`Using stream for peerId=${t} multicodec=${this.multicodec}`),this.lockStream(t,i),i):void 0}catch(t){this.log.error("Failed to getStream:",t);return}}async createStream(e,t=0){const r=this.libp2p.connectionManager.getConnections(e),i=fC(r);if(!i){this.log.error(`Failed to get a connection to the peer peerId=${e.toString()} multicodec=${this.multicodec}`);return}let s,o;for(let a=0;a<t+1;a++)try{this.log.info(`Attempting to create a stream for peerId=${e.toString()} multicodec=${this.multicodec}`),o=await i.newStream(this.multicodec),this.log.info(`Created stream for peerId=${e.toString()} multicodec=${this.multicodec}`);break}catch(l){s=l}if(!o){this.log.error(`Failed to create a new stream for ${e.toString()} -- `+s);return}return o}async createStreamWithLock(e){const t=e.id.toString();if(this.ongoingCreation.has(t)){this.log.info(`Skipping creation of a stream due to lock for peerId=${t} multicodec=${this.multicodec}`);return}try{this.ongoingCreation.add(t),await this.createStream(e.id)}catch(r){this.log.error("Failed to createStreamWithLock:",r)}finally{this.ongoingCreation.delete(t)}}scheduleNewStream(e){this.log.info(`Scheduling creation of a stream for peerId=${e.id.toString()} multicodec=${this.multicodec}`),this.streamPool.has(e.id.toString())&&this.streamPool.delete(e.id.toString()),this.streamPool.set(e.id.toString(),this.createStreamWithLock(e))}getOpenStreamForCodec(e){const t=this.libp2p.connectionManager.getConnections(e),r=fC(t);if(!r){this.log.info(`No open connection found for peerId=${e.toString()} multicodec=${this.multicodec}`);return}const i=r.streams.find(o=>o.protocol===this.multicodec);if(!i){this.log.info(`No open stream found for peerId=${e.toString()} multicodec=${this.multicodec}`);return}if(["done","closed","closing"].includes(i.writeStatus||"")||this.isStreamLocked(i)){this.log.info(`Stream for peerId=${e.toString()} multicodec=${this.multicodec} is unusable`);return}return this.log.info(`Found open stream for peerId=${e.toString()} multicodec=${this.multicodec}`),i}lockStream(e,t){this.log.info(`Locking stream for peerId:${e}	streamId:${t.id}`),t.metadata[dC]=!0}isStreamLocked(e){return!!e.metadata[dC]}}let ap;const lK=new Uint8Array(16);function cK(){if(!ap&&(ap=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!ap))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return ap(lK)}const an=[];for(let n=0;n<256;++n)an.push((n+256).toString(16).slice(1));function uK(n,e=0){return an[n[e+0]]+an[n[e+1]]+an[n[e+2]]+an[n[e+3]]+"-"+an[n[e+4]]+an[n[e+5]]+"-"+an[n[e+6]]+an[n[e+7]]+"-"+an[n[e+8]]+an[n[e+9]]+"-"+an[n[e+10]]+an[n[e+11]]+an[n[e+12]]+an[n[e+13]]+an[n[e+14]]+an[n[e+15]]}const hK=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),pC={randomUUID:hK};function ol(n,e,t){if(pC.randomUUID&&!n)return pC.randomUUID();n=n||{};const r=n.random||(n.rng||cK)();return r[6]=r[6]&15|64,r[8]=r[8]&63|128,uK(r)}class AS{constructor(e){v(this,"proto");this.proto=e}static decode(e){const t=im.decode(e);return new AS(t)}encode(){return im.encode(this.proto)}get wakuMessage(){return this.proto.wakuMessage}get pubsubTopic(){return this.proto.pubsubTopic}}class Es{constructor(e){v(this,"proto");this.proto=e}static createSubscribeRequest(e,t){return new Es({requestId:ol(),filterSubscribeType:ra.FilterSubscribeType.SUBSCRIBE,pubsubTopic:e,contentTopics:t})}static createUnsubscribeRequest(e,t){return new Es({requestId:ol(),filterSubscribeType:ra.FilterSubscribeType.UNSUBSCRIBE,pubsubTopic:e,contentTopics:t})}static createUnsubscribeAllRequest(e){return new Es({requestId:ol(),filterSubscribeType:ra.FilterSubscribeType.UNSUBSCRIBE_ALL,pubsubTopic:e,contentTopics:[]})}static createSubscriberPingRequest(){return new Es({requestId:ol(),filterSubscribeType:ra.FilterSubscribeType.SUBSCRIBER_PING,pubsubTopic:"",contentTopics:[]})}static decode(e){const t=ra.decode(e);return new Es(t)}encode(){return ra.encode(this.proto)}get filterSubscribeType(){return this.proto.filterSubscribeType}get requestId(){return this.proto.requestId}get pubsubTopic(){return this.proto.pubsubTopic}get contentTopics(){return this.proto.contentTopics}}class Kh{constructor(e){v(this,"proto");this.proto=e}static decode(e){const t=nm.decode(e);return new Kh(t)}encode(){return nm.encode(this.proto)}get statusCode(){return this.proto.statusCode}get statusDesc(){return this.proto.statusDesc}get requestId(){return this.proto.requestId}}const nn=new Ct("filter-core"),ws={SUBSCRIBE:"/vac/waku/filter-subscribe/2.0.0-beta1",PUSH:"/vac/waku/filter-push/2.0.0-beta1"};class fK{constructor(e,t){v(this,"handleIncomingMessage");v(this,"libp2p");v(this,"streamManager");v(this,"multicodec",ws.SUBSCRIBE);this.handleIncomingMessage=e,this.libp2p=t,this.streamManager=new wu(ws.SUBSCRIBE,t.components)}async start(){try{await this.libp2p.handle(ws.PUSH,this.onRequest.bind(this),{maxInboundStreams:100})}catch(e){nn.error("Failed to register ",ws.PUSH,e)}}async stop(){try{await this.libp2p.unhandle(ws.PUSH)}catch(e){nn.error("Failed to unregister ",ws.PUSH,e)}}async subscribe(e,t,r){const i=await this.streamManager.getStream(t);if(!i)return{success:null,failure:{error:Gn.NO_STREAM_AVAILABLE,peerId:t}};const s=Es.createSubscribeRequest(e,r);let o;try{if(o=await Fi([s.encode()],ao,i,xs,async h=>await as(h)),!(o!=null&&o.length))throw Error("Received no response from subscription request.")}catch(h){return nn.error("Failed to send subscribe request",h),{success:null,failure:{error:Gn.GENERIC_FAIL,peerId:t}}}const{statusCode:a,requestId:l,statusDesc:c}=Kh.decode(o[0].slice());return a<200||a>=300?(nn.error(`Filter subscribe request ${l} failed with status code ${a}: ${c}`),{failure:{error:Gn.REMOTE_PEER_REJECTED,peerId:t},success:null}):{failure:null,success:t}}async unsubscribe(e,t,r){const i=await this.streamManager.getStream(t);if(!i)return nn.error(`Failed to get a stream for remote peer:${t.toString()}`),{success:null,failure:{error:Gn.NO_STREAM_AVAILABLE,peerId:t}};const s=Es.createUnsubscribeRequest(e,r);try{await Fi([s.encode()],ao,i.sink)}catch(o){return nn.error("Failed to send unsubscribe request",o),{success:null,failure:{error:Gn.GENERIC_FAIL,peerId:t}}}return{success:t,failure:null}}async unsubscribeAll(e,t){const r=await this.streamManager.getStream(t);if(!r)return nn.error(`Failed to get a stream for remote peer:${t.toString()}`),{success:null,failure:{error:Gn.NO_STREAM_AVAILABLE,peerId:t}};const i=Es.createUnsubscribeAllRequest(e),s=await Fi([i.encode()],ao,r,xs,async c=>await as(c));if(!s||!s.length)return{failure:{error:Gn.NO_RESPONSE,peerId:t},success:null};const{statusCode:o,requestId:a,statusDesc:l}=Kh.decode(s[0].slice());return o<200||o>=300?(nn.error(`Filter unsubscribe all request ${a} failed with status code ${o}: ${l}`),{failure:{error:Gn.REMOTE_PEER_REJECTED,peerId:t},success:null}):{failure:null,success:t}}async ping(e){const t=await this.streamManager.getStream(e);if(!t)return nn.error(`Failed to get a stream for remote peer:${e.toString()}`),{success:null,failure:{error:Gn.NO_STREAM_AVAILABLE,peerId:e}};const r=Es.createSubscriberPingRequest();let i;try{i=await Fi([r.encode()],ao,t,xs,async l=>await as(l))}catch(l){return nn.error("Failed to send ping request",l),{success:null,failure:{error:Gn.GENERIC_FAIL,peerId:e}}}if(!i||!i.length)return{success:null,failure:{error:Gn.NO_RESPONSE,peerId:e}};const{statusCode:s,requestId:o,statusDesc:a}=Kh.decode(i[0].slice());return s<200||s>=300?(nn.error(`Filter ping request ${o} failed with status code ${s}: ${a}`),{success:null,failure:{error:Gn.REMOTE_PEER_REJECTED,peerId:e}}):{success:e,failure:null}}onRequest(e){const{connection:t,stream:r}=e,{remotePeer:i}=t;nn.info(`Received message from ${i.toString()}`);try{Fi(r,xs,async s=>{for await(const o of s){const a=AS.decode(o.slice()),{pubsubTopic:l,wakuMessage:c}=a;if(!c){nn.error("Received empty message");return}if(!l){nn.error("Pubsub topic missing from push message");return}await this.handleIncomingMessage(l,c,t.remotePeer.toString())}}).then(()=>{nn.info("Receiving pipe closed.")},async s=>{nn.error(`Error with receiving pipe on peer:${t.remotePeer.toString()} -- stream:${r.id} -- protocol:${r.protocol}: `,s)})}catch(s){nn.error("Error decoding message",s)}}}const Dn={v2:"/vac/waku/lightpush/2.0.0-beta1",v3:"/vac/waku/lightpush/3.0.0"},xS=Dn.v2,By=Dn.v3;class gf{constructor(e){v(this,"proto");this.proto=e}static createRequest(e,t){return new gf({requestId:ol(),request:{message:e,pubsubTopic:t},response:void 0})}static decode(e){const t=cm.decode(e);return new gf(t)}encode(){return cm.encode(this.proto)}get query(){return this.proto.request}get response(){return this.proto.response}}class al{constructor(e){v(this,"proto");this.proto=e}static createRequest(e,t){return new al({requestId:ol(),pubsubTopic:t,message:e})}static createResponse(e,t,r,i){return new al({requestId:e,statusCode:t,statusDesc:r,relayPeerCount:i})}static decodeRequest(e){const t=um.decode(e);return new al(t)}static decodeResponse(e){const t=hm.decode(e);return new al(t)}encode(){return this.isRequest()?um.encode(this.proto):hm.encode(this.proto)}get request(){return this.isRequest()?this.proto:void 0}get response(){return this.isResponse()?this.proto:void 0}get requestId(){return this.proto.requestId}get pubsubTopic(){return this.isRequest()?this.proto.pubsubTopic:void 0}get message(){return this.isRequest()?this.proto.message:void 0}get statusCode(){return this.isResponse()?this.proto.statusCode:void 0}get statusDesc(){return this.isResponse()?this.proto.statusDesc:void 0}get relayPeerCount(){return this.isResponse()?this.proto.relayPeerCount:void 0}isRequest(){return"pubsubTopic"in this.proto&&"message"in this.proto}isResponse(){return"statusCode"in this.proto}}const dK="could not generate rln proof",pK="could not get new message id to generate an rln proof",gK="RLN validation failed",mK=n=>n?n.includes(dK)||n.includes(pK)||n.includes(gK):!1,ds=new Ct("light-push:protocol-handler");class ll{static async preparePushMessage(e,t,r){try{if(!t.payload||t.payload.length===0)return ds.error("Failed to send waku light push: payload is empty"),{rpc:null,error:hr.EMPTY_PAYLOAD};if(!await rz(e,t))return ds.error("Failed to send waku light push: message is bigger than 1MB"),{rpc:null,error:hr.SIZE_TOO_BIG};const i=await e.toProtoObj(t);return i?r===Dn.v3?(ds.info("Creating v3 RPC message"),{rpc:ll.createV3Rpc(i,e.pubsubTopic),error:null}):(ds.info("Creating v2 RPC message"),{rpc:ll.createV2Rpc(i,e.pubsubTopic),error:null}):(ds.error("Failed to encode to protoMessage, aborting push"),{rpc:null,error:hr.ENCODE_FAILED})}catch(i){return ds.error("Failed to prepare push message",i),{rpc:null,error:hr.GENERIC_FAIL}}}static handleResponse(e,t,r){return t===Dn.v3?ll.handleV3Response(e,r):ll.handleV2Response(e,r)}static handleV3Response(e,t){try{const r=al.decodeResponse(e),i=r.statusCode,s=r.statusDesc;if(i!==mi.SUCCESS){const o=hr.REMOTE_PEER_REJECTED;return ds.error(`Remote peer rejected with v3 status code ${i}: ${s}`),{success:null,failure:{error:o,peerId:t}}}return r.relayPeerCount!==void 0&&ds.info(`Message relayed to ${r.relayPeerCount} peers`),{success:t,failure:null}}catch{return{success:null,failure:{error:hr.DECODE_FAILED,peerId:t}}}}static handleV2Response(e,t){let r;try{r=gf.decode(e).response}catch{return{success:null,failure:{error:hr.DECODE_FAILED,peerId:t}}}return r?mK(r.info)?(ds.error("Remote peer fault: RLN generation"),{success:null,failure:{error:hr.RLN_PROOF_GENERATION,peerId:t}}):r.isSuccess?{success:t,failure:null}:(ds.error("Remote peer rejected the message: ",r.info),{success:null,failure:{error:hr.REMOTE_PEER_REJECTED,peerId:t}}):{success:null,failure:{error:hr.NO_RESPONSE,peerId:t}}}static createV2Rpc(e,t){const r=gf.createRequest(e,t);return Object.assign(r,{version:"v2"})}static createV3Rpc(e,t){e.timestamp||(e.timestamp=BigInt(Date.now())*BigInt(1e6));const r=al.createRequest(e,t);return Object.assign(r,{version:"v3"})}}const lp=new Ct("light-push");class yK{constructor(e){v(this,"libp2p");v(this,"streamManager");v(this,"streamManagerV2");v(this,"multicodec",[Dn.v3,Dn.v2]);this.libp2p=e,this.streamManagerV2=new wu(Dn.v2,e.components),this.streamManager=new wu(Dn.v3,e.components)}async send(e,t,r,i=!1){const s=await this.getProtocol(r,i);if(lp.info(`Sending light push request to peer:${r.toString()}, protocol:${s}`),!s)return{success:null,failure:{error:hr.GENERIC_FAIL,peerId:r}};const{rpc:o,error:a}=await ll.preparePushMessage(e,t,s);if(a)return{success:null,failure:{error:a,peerId:r}};const l=await this.getStream(r,s);if(!l)return lp.error(`Failed to get a stream for remote peer:${r.toString()}`),{success:null,failure:{error:hr.NO_STREAM_AVAILABLE,peerId:r}};let c;try{c=await Fi([o.encode()],ao,l,xs,async d=>await as(d))}catch(d){return lp.error("Failed to send waku light push request",d),{success:null,failure:{error:hr.STREAM_ABORTED,peerId:r}}}const h=new bt;return c.forEach(d=>h.append(d)),h.length===0?{success:null,failure:{error:hr.NO_RESPONSE,peerId:r}}:ll.handleResponse(h,s,r)}async getProtocol(e,t){try{const r=await this.libp2p.peerStore.get(e);if(t||!r.protocols.includes(Dn.v3)&&r.protocols.includes(Dn.v2))return Dn.v2;if(r.protocols.includes(Dn.v3))return Dn.v3;throw new Error("No supported protocol found")}catch(r){lp.error("Failed to get protocol",r);return}}async getStream(e,t){switch(t){case Dn.v2:return this.streamManagerV2.getStream(e);case Dn.v3:return this.streamManager.getStream(e);default:return}}}const bK={payload:new Uint8Array,contentTopic:"",version:void 0,timestamp:void 0,meta:void 0,rateLimitProof:void 0,ephemeral:void 0};function wK(n){return{...bK,...n}}const vK=20,_K=100,gC=24*60*60*1e3,mC=1e6;class km{constructor(e){v(this,"proto");this.proto=e}static create(e){const t=new km({...e,contentTopics:e.contentTopics||[],requestId:ol(),timeStart:e.timeStart?BigInt(e.timeStart.getTime()*mC):void 0,timeEnd:e.timeEnd?BigInt(e.timeEnd.getTime()*mC):void 0,messageHashes:e.messageHashes||[],paginationLimit:e.paginationLimit?BigInt(e.paginationLimit):void 0}),r=e.messageHashes&&e.messageHashes.length>0,i=e.contentTopics&&e.contentTopics.length>0,s=e.timeStart||e.timeEnd;if(r){if(i||s)throw new Error("Message hash lookup queries cannot include content filter criteria (contentTopics, timeStart, or timeEnd)")}else if(e.pubsubTopic&&(!e.contentTopics||e.contentTopics.length===0)||!e.pubsubTopic&&e.contentTopics&&e.contentTopics.length>0)throw new Error("Both pubsubTopic and contentTopics must be set together for content-filtered queries");return t}static decode(e){const t=pm.decode(e);return new km(t)}encode(){return pm.encode(this.proto)}}class IS{constructor(e){v(this,"proto");this.proto=e}static decode(e){const t=gm.decode(e);return new IS(t)}encode(){return gm.encode(this.proto)}get statusCode(){return this.proto.statusCode}get statusDesc(){return this.proto.statusDesc}get messages(){return this.proto.messages}get paginationCursor(){return this.proto.paginationCursor}}const bh=new Ct("store"),mf="/vac/waku/store-query/3.0.0";class EK{constructor(e){v(this,"streamManager");v(this,"multicodec",mf);this.streamManager=new wu(mf,e.components)}get maxTimeLimit(){return gC}async*queryPerPage(e,t,r){var o,a;if(e.timeStart&&e.timeEnd&&e.timeEnd.getTime()-e.timeStart.getTime()>gC)throw new Error("Time range bigger than 24h");if(!(e.messageHashes&&e.messageHashes.length>0)&&e.contentTopics&&e.contentTopics.toString()!==Array.from(t.keys()).toString())throw new Error("Internal error, the decoders should match the query's content topics");let s=e.paginationCursor;for(;;){const l=km.create({...e,paginationCursor:s});bh.info("Sending store query request:",{hasMessageHashes:!!((o=e.messageHashes)!=null&&o.length),messageHashCount:(a=e.messageHashes)==null?void 0:a.length,pubsubTopic:e.pubsubTopic,contentTopics:e.contentTopics});const c=await this.streamManager.getStream(r);if(!c){bh.error(`Failed to get a stream for remote peer:${r.toString()}`);break}const h=await Fi([l.encode()],ao,c,xs,async m=>await as(m)),d=new bt;h.forEach(m=>{d.append(m)});const p=IS.decode(d);if(!p.statusCode||p.statusCode>=300){const m=`Store query failed with status code: ${p.statusCode}, description: ${p.statusDesc}`;throw bh.error(m),new Error(m)}if(!p.messages||!p.messages.length){bh.warn("Stopping pagination due to empty messages in response");break}if(bh.info(`${p.messages.length} messages retrieved from store`),yield p.messages.map(m=>{if(!m.message)return Promise.resolve(void 0);const E=m.message.contentTopic;if(E){const y=t.get(E);if(y)return y.fromProtoObj(m.pubsubTopic||"",wK(m.message))}return Promise.resolve(void 0)}),e.paginationForward?s=p.messages[p.messages.length-1].messageHash:s=p.messages[0].messageHash,p.messages.length>_K&&p.messages.length<(e.paginationLimit||vK))break}}}var cv;let Yf=(cv=class extends Error{constructor(e="Invalid parameters"){super(e),this.name="InvalidParametersError"}},v(cv,"name","InvalidParametersError"),cv);class TS extends Error{constructor(e="Invalid public key"){super(e),this.name="InvalidPublicKeyError"}}v(TS,"name","InvalidPublicKeyError");class CS extends Error{constructor(e="Unsupported key type"){super(e),this.name="UnsupportedKeyTypeError"}}v(CS,"name","UnsupportedKeyTypeError");const SK=parseInt("11111",2),S1=parseInt("10000000",2),AK=parseInt("01111111",2),yC={0:wh,1:wh,2:xK,3:CK,4:kK,5:TK,6:IK,16:wh,22:wh,48:wh};function Uy(n,e={offset:0}){const t=n[e.offset]&SK;if(e.offset++,yC[t]!=null)return yC[t](n,e);throw new Error("No decoder for tag "+t)}function Xf(n,e){let t=0;if((n[e.offset]&S1)===S1){const r=n[e.offset]&AK;let i="0x";e.offset++;for(let s=0;s<r;s++,e.offset++)i+=n[e.offset].toString(16).padStart(2,"0");t=parseInt(i,16)}else t=n[e.offset],e.offset++;return t}function wh(n,e){Xf(n,e);const t=[];for(;!(e.offset>=n.byteLength);){const r=Uy(n,e);if(r===null)break;t.push(r)}return t}function xK(n,e){const t=Xf(n,e),r=e.offset,i=e.offset+t,s=[];for(let o=r;o<i;o++)o===r&&n[o]===0||s.push(n[o]);return e.offset+=t,Uint8Array.from(s)}function IK(n,e){const t=Xf(n,e),r=e.offset+t,i=n[e.offset];e.offset++;let s=0,o=0;i<40?(s=0,o=i):i<80?(s=1,o=i-40):(s=2,o=i-80);let a=`${s}.${o}`,l=[];for(;e.offset<r;){const c=n[e.offset];if(e.offset++,l.push(c&127),c<128){l.reverse();let h=0;for(let d=0;d<l.length;d++)h+=l[d]<<d*7;a+=`.${h}`,l=[]}}return a}function TK(n,e){return e.offset++,null}function CK(n,e){const t=Xf(n,e),r=n[e.offset];e.offset++;const i=n.subarray(e.offset,e.offset+t-1);if(e.offset+=t,r!==0)throw new Error("Unused bits in bit string is unimplemented");return i}function kK(n,e){const t=Xf(n,e),r=n.subarray(e.offset,e.offset+t);return e.offset+=t,r}function PK(n){let e=n.toString(16);e.length%2===1&&(e="0"+e);const t=new bt;for(let r=0;r<e.length;r+=2)t.append(Uint8Array.from([parseInt(`${e[r]}${e[r+1]}`,16)]));return t}function kS(n){if(n.byteLength<128)return Uint8Array.from([n.byteLength]);const e=PK(n.byteLength);return new bt(Uint8Array.from([e.byteLength|S1]),e)}function A1(n){const e=new bt,t=128;return(n.subarray()[0]&t)===t&&e.append(Uint8Array.from([0])),e.append(n),new bt(Uint8Array.from([2]),kS(e),e)}function GL(n){const e=Uint8Array.from([0]),t=new bt(e,n);return new bt(Uint8Array.from([3]),kS(t),t)}function Vh(n,e=48){const t=new bt;for(const r of n)t.append(r);return new bt(Uint8Array.from([e]),kS(t),t)}async function RK(n,e,t,r){var o,a;const i=await crypto.subtle.importKey("jwk",n,{name:"ECDSA",namedCurve:n.crv??"P-256"},!1,["verify"]);(o=r==null?void 0:r.signal)==null||o.throwIfAborted();const s=await crypto.subtle.verify({name:"ECDSA",hash:{name:"SHA-256"}},i,e,t.subarray());return(a=r==null?void 0:r.signal)==null||a.throwIfAborted(),s}const OK=Uint8Array.from([6,8,42,134,72,206,61,3,1,7]),LK=Uint8Array.from([6,5,43,129,4,0,34]),NK=Uint8Array.from([6,5,43,129,4,0,35]),DK={ext:!0,kty:"EC",crv:"P-256"},$K={ext:!0,kty:"EC",crv:"P-384"},MK={ext:!0,kty:"EC",crv:"P-521"},q0=32,H0=48,W0=66;function YL(n){const e=Uy(n);return BK(e)}function BK(n){const e=n[1][1][0],t=1;let r,i;if(e.byteLength===q0*2+1)return r=mt(e.subarray(t,t+q0),"base64url"),i=mt(e.subarray(t+q0),"base64url"),new z0({...DK,key_ops:["verify"],x:r,y:i});if(e.byteLength===H0*2+1)return r=mt(e.subarray(t,t+H0),"base64url"),i=mt(e.subarray(t+H0),"base64url"),new z0({...$K,key_ops:["verify"],x:r,y:i});if(e.byteLength===W0*2+1)return r=mt(e.subarray(t,t+W0),"base64url"),i=mt(e.subarray(t+W0),"base64url"),new z0({...MK,key_ops:["verify"],x:r,y:i});throw new Yf(`coordinates were wrong length, got ${e.byteLength}, expected 65, 97 or 133`)}function UK(n){return Vh([A1(Uint8Array.from([1])),Vh([FK(n.crv)],160),Vh([GL(new bt(Uint8Array.from([4]),at(n.x??"","base64url"),at(n.y??"","base64url")))],161)]).subarray()}function FK(n){if(n==="P-256")return OK;if(n==="P-384")return LK;if(n==="P-521")return NK;throw new Yf(`Invalid curve ${n}`)}let z0=class{constructor(e){v(this,"type","ECDSA");v(this,"jwk");v(this,"_raw");this.jwk=e}get raw(){return this._raw==null&&(this._raw=UK(this.jwk)),this._raw}toMultihash(){return Ia.digest(ho(this))}toCID(){return zt.createV1(114,this.toMultihash())}toString(){return _r.encode(this.toMultihash().bytes).substring(1)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:Or(this.raw,e.raw)}async verify(e,t,r){return RK(this.jwk,t,e,r)}};/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Fy(n){return n instanceof Uint8Array||ArrayBuffer.isView(n)&&n.constructor.name==="Uint8Array"}function $l(n,e=""){if(!Number.isSafeInteger(n)||n<0){const t=e&&`"${e}" `;throw new Error(`${t}expected integer >= 0, got ${n}`)}}function jt(n,e,t=""){const r=Fy(n),i=n==null?void 0:n.length,s=e!==void 0;if(!r||s&&i!==e){const o=t&&`"${t}" `,a=s?` of length ${e}`:"",l=r?`length=${i}`:`type=${typeof n}`;throw new Error(o+"expected Uint8Array"+a+", got "+l)}return n}function XL(n){if(typeof n!="function"||typeof n.create!="function")throw new Error("Hash must wrapped by utils.createHasher");$l(n.outputLen),$l(n.blockLen)}function Pm(n,e=!0){if(n.destroyed)throw new Error("Hash instance has been destroyed");if(e&&n.finished)throw new Error("Hash#digest() has already been called")}function jK(n,e){jt(n,void 0,"digestInto() output");const t=e.outputLen;if(n.length<t)throw new Error('"digestInto() output" expected to be of length >='+t)}function vu(...n){for(let e=0;e<n.length;e++)n[e].fill(0)}function K0(n){return new DataView(n.buffer,n.byteOffset,n.byteLength)}function ps(n,e){return n<<32-e|n>>>e}const ZL=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",qK=Array.from({length:256},(n,e)=>e.toString(16).padStart(2,"0"));function Zf(n){if(jt(n),ZL)return n.toHex();let e="";for(let t=0;t<n.length;t++)e+=qK[n[t]];return e}const Ws={_0:48,_9:57,A:65,F:70,a:97,f:102};function bC(n){if(n>=Ws._0&&n<=Ws._9)return n-Ws._0;if(n>=Ws.A&&n<=Ws.F)return n-(Ws.A-10);if(n>=Ws.a&&n<=Ws.f)return n-(Ws.a-10)}function yf(n){if(typeof n!="string")throw new Error("hex string expected, got "+typeof n);if(ZL)return Uint8Array.fromHex(n);const e=n.length,t=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const r=new Uint8Array(t);for(let i=0,s=0;i<t;i++,s+=2){const o=bC(n.charCodeAt(s)),a=bC(n.charCodeAt(s+1));if(o===void 0||a===void 0){const l=n[s]+n[s+1];throw new Error('hex string expected, got non-hex character "'+l+'" at index '+s)}r[i]=o*16+a}return r}function Is(...n){let e=0;for(let r=0;r<n.length;r++){const i=n[r];jt(i),e+=i.length}const t=new Uint8Array(e);for(let r=0,i=0;r<n.length;r++){const s=n[r];t.set(s,i),i+=s.length}return t}function QL(n,e={}){const t=(i,s)=>n(s).update(i).digest(),r=n(void 0);return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=i=>n(i),Object.assign(t,e),Object.freeze(t)}function jy(n=32){const e=typeof globalThis=="object"?globalThis.crypto:null;if(typeof(e==null?void 0:e.getRandomValues)!="function")throw new Error("crypto.getRandomValues must be defined");return e.getRandomValues(new Uint8Array(n))}const JL=n=>({oid:Uint8Array.from([6,9,96,134,72,1,101,3,4,2,n])});function HK(n,e,t){return n&e^~n&t}function WK(n,e,t){return n&e^n&t^e&t}class eN{constructor(e,t,r,i){v(this,"blockLen");v(this,"outputLen");v(this,"padOffset");v(this,"isLE");v(this,"buffer");v(this,"view");v(this,"finished",!1);v(this,"length",0);v(this,"pos",0);v(this,"destroyed",!1);this.blockLen=e,this.outputLen=t,this.padOffset=r,this.isLE=i,this.buffer=new Uint8Array(e),this.view=K0(this.buffer)}update(e){Pm(this),jt(e);const{view:t,buffer:r,blockLen:i}=this,s=e.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const l=K0(e);for(;i<=s-o;o+=i)this.process(l,o);continue}r.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Pm(this),jK(e,this),this.finished=!0;const{buffer:t,view:r,blockLen:i,isLE:s}=this;let{pos:o}=this;t[o++]=128,vu(this.buffer.subarray(o)),this.padOffset>i-o&&(this.process(r,0),o=0);for(let d=o;d<i;d++)t[d]=0;r.setBigUint64(i-8,BigInt(this.length*8),s),this.process(r,0);const a=K0(e),l=this.outputLen;if(l%4)throw new Error("_sha2: outputLen must be aligned to 32bit");const c=l/4,h=this.get();if(c>h.length)throw new Error("_sha2: outputLen bigger than state");for(let d=0;d<c;d++)a.setUint32(4*d,h[d],s)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const r=e.slice(0,t);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:r,length:i,finished:s,destroyed:o,pos:a}=this;return e.destroyed=o,e.finished=s,e.length=i,e.pos=a,i%t&&e.buffer.set(r),e}clone(){return this._cloneInto()}}const Bo=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),En=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),cp=BigInt(2**32-1),wC=BigInt(32);function zK(n,e=!1){return e?{h:Number(n&cp),l:Number(n>>wC&cp)}:{h:Number(n>>wC&cp)|0,l:Number(n&cp)|0}}function KK(n,e=!1){const t=n.length;let r=new Uint32Array(t),i=new Uint32Array(t);for(let s=0;s<t;s++){const{h:o,l:a}=zK(n[s],e);[r[s],i[s]]=[o,a]}return[r,i]}const vC=(n,e,t)=>n>>>t,_C=(n,e,t)=>n<<32-t|e>>>t,Ac=(n,e,t)=>n>>>t|e<<32-t,xc=(n,e,t)=>n<<32-t|e>>>t,up=(n,e,t)=>n<<64-t|e>>>t-32,hp=(n,e,t)=>n>>>t-32|e<<64-t;function zs(n,e,t,r){const i=(e>>>0)+(r>>>0);return{h:n+t+(i/2**32|0)|0,l:i|0}}const VK=(n,e,t)=>(n>>>0)+(e>>>0)+(t>>>0),GK=(n,e,t,r)=>e+t+r+(n/2**32|0)|0,YK=(n,e,t,r)=>(n>>>0)+(e>>>0)+(t>>>0)+(r>>>0),XK=(n,e,t,r,i)=>e+t+r+i+(n/2**32|0)|0,ZK=(n,e,t,r,i)=>(n>>>0)+(e>>>0)+(t>>>0)+(r>>>0)+(i>>>0),QK=(n,e,t,r,i,s)=>e+t+r+i+s+(n/2**32|0)|0,JK=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Uo=new Uint32Array(64);class eV extends eN{constructor(e){super(64,e,8,!1)}get(){const{A:e,B:t,C:r,D:i,E:s,F:o,G:a,H:l}=this;return[e,t,r,i,s,o,a,l]}set(e,t,r,i,s,o,a,l){this.A=e|0,this.B=t|0,this.C=r|0,this.D=i|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=l|0}process(e,t){for(let d=0;d<16;d++,t+=4)Uo[d]=e.getUint32(t,!1);for(let d=16;d<64;d++){const p=Uo[d-15],g=Uo[d-2],m=ps(p,7)^ps(p,18)^p>>>3,E=ps(g,17)^ps(g,19)^g>>>10;Uo[d]=E+Uo[d-7]+m+Uo[d-16]|0}let{A:r,B:i,C:s,D:o,E:a,F:l,G:c,H:h}=this;for(let d=0;d<64;d++){const p=ps(a,6)^ps(a,11)^ps(a,25),g=h+p+HK(a,l,c)+JK[d]+Uo[d]|0,E=(ps(r,2)^ps(r,13)^ps(r,22))+WK(r,i,s)|0;h=c,c=l,l=a,a=o+g|0,o=s,s=i,i=r,r=g+E|0}r=r+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,l=l+this.F|0,c=c+this.G|0,h=h+this.H|0,this.set(r,i,s,o,a,l,c,h)}roundClean(){vu(Uo)}destroy(){this.set(0,0,0,0,0,0,0,0),vu(this.buffer)}}class tV extends eV{constructor(){super(32);v(this,"A",Bo[0]|0);v(this,"B",Bo[1]|0);v(this,"C",Bo[2]|0);v(this,"D",Bo[3]|0);v(this,"E",Bo[4]|0);v(this,"F",Bo[5]|0);v(this,"G",Bo[6]|0);v(this,"H",Bo[7]|0)}}const tN=KK(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(n=>BigInt(n))),rV=tN[0],nV=tN[1],Fo=new Uint32Array(80),jo=new Uint32Array(80);class iV extends eN{constructor(e){super(128,e,16,!1)}get(){const{Ah:e,Al:t,Bh:r,Bl:i,Ch:s,Cl:o,Dh:a,Dl:l,Eh:c,El:h,Fh:d,Fl:p,Gh:g,Gl:m,Hh:E,Hl:y}=this;return[e,t,r,i,s,o,a,l,c,h,d,p,g,m,E,y]}set(e,t,r,i,s,o,a,l,c,h,d,p,g,m,E,y){this.Ah=e|0,this.Al=t|0,this.Bh=r|0,this.Bl=i|0,this.Ch=s|0,this.Cl=o|0,this.Dh=a|0,this.Dl=l|0,this.Eh=c|0,this.El=h|0,this.Fh=d|0,this.Fl=p|0,this.Gh=g|0,this.Gl=m|0,this.Hh=E|0,this.Hl=y|0}process(e,t){for(let _=0;_<16;_++,t+=4)Fo[_]=e.getUint32(t),jo[_]=e.getUint32(t+=4);for(let _=16;_<80;_++){const I=Fo[_-15]|0,x=jo[_-15]|0,$=Ac(I,x,1)^Ac(I,x,8)^vC(I,x,7),U=xc(I,x,1)^xc(I,x,8)^_C(I,x,7),O=Fo[_-2]|0,P=jo[_-2]|0,M=Ac(O,P,19)^up(O,P,61)^vC(O,P,6),K=xc(O,P,19)^hp(O,P,61)^_C(O,P,6),C=YK(U,K,jo[_-7],jo[_-16]),B=XK(C,$,M,Fo[_-7],Fo[_-16]);Fo[_]=B|0,jo[_]=C|0}let{Ah:r,Al:i,Bh:s,Bl:o,Ch:a,Cl:l,Dh:c,Dl:h,Eh:d,El:p,Fh:g,Fl:m,Gh:E,Gl:y,Hh:S,Hl:b}=this;for(let _=0;_<80;_++){const I=Ac(d,p,14)^Ac(d,p,18)^up(d,p,41),x=xc(d,p,14)^xc(d,p,18)^hp(d,p,41),$=d&g^~d&E,U=p&m^~p&y,O=ZK(b,x,U,nV[_],jo[_]),P=QK(O,S,I,$,rV[_],Fo[_]),M=O|0,K=Ac(r,i,28)^up(r,i,34)^up(r,i,39),C=xc(r,i,28)^hp(r,i,34)^hp(r,i,39),B=r&s^r&a^s&a,N=i&o^i&l^o&l;S=E|0,b=y|0,E=g|0,y=m|0,g=d|0,m=p|0,{h:d,l:p}=zs(c|0,h|0,P|0,M|0),c=a|0,h=l|0,a=s|0,l=o|0,s=r|0,o=i|0;const L=VK(M,C,N);r=GK(L,P,K,B),i=L|0}({h:r,l:i}=zs(this.Ah|0,this.Al|0,r|0,i|0)),{h:s,l:o}=zs(this.Bh|0,this.Bl|0,s|0,o|0),{h:a,l}=zs(this.Ch|0,this.Cl|0,a|0,l|0),{h:c,l:h}=zs(this.Dh|0,this.Dl|0,c|0,h|0),{h:d,l:p}=zs(this.Eh|0,this.El|0,d|0,p|0),{h:g,l:m}=zs(this.Fh|0,this.Fl|0,g|0,m|0),{h:E,l:y}=zs(this.Gh|0,this.Gl|0,E|0,y|0),{h:S,l:b}=zs(this.Hh|0,this.Hl|0,S|0,b|0),this.set(r,i,s,o,a,l,c,h,d,p,g,m,E,y,S,b)}roundClean(){vu(Fo,jo)}destroy(){vu(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}class sV extends iV{constructor(){super(64);v(this,"Ah",En[0]|0);v(this,"Al",En[1]|0);v(this,"Bh",En[2]|0);v(this,"Bl",En[3]|0);v(this,"Ch",En[4]|0);v(this,"Cl",En[5]|0);v(this,"Dh",En[6]|0);v(this,"Dl",En[7]|0);v(this,"Eh",En[8]|0);v(this,"El",En[9]|0);v(this,"Fh",En[10]|0);v(this,"Fl",En[11]|0);v(this,"Gh",En[12]|0);v(this,"Gl",En[13]|0);v(this,"Hh",En[14]|0);v(this,"Hl",En[15]|0)}}const rN=QL(()=>new tV,JL(1)),oV=QL(()=>new sV,JL(3));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const PS=BigInt(0),x1=BigInt(1);function Ml(n,e=""){if(typeof n!="boolean"){const t=e&&`"${e}" `;throw new Error(t+"expected boolean, got type="+typeof n)}return n}function nN(n){if(typeof n=="bigint"){if(!Ig(n))throw new Error("positive bigint expected, got "+n)}else $l(n);return n}function fp(n){const e=nN(n).toString(16);return e.length&1?"0"+e:e}function iN(n){if(typeof n!="string")throw new Error("hex string expected, got "+typeof n);return n===""?PS:BigInt("0x"+n)}function qy(n){return iN(Zf(n))}function bf(n){return iN(Zf(I1(jt(n)).reverse()))}function RS(n,e){$l(e),n=nN(n);const t=yf(n.toString(16).padStart(e*2,"0"));if(t.length!==e)throw new Error("number too large");return t}function sN(n,e){return RS(n,e).reverse()}function I1(n){return Uint8Array.from(n)}const Ig=n=>typeof n=="bigint"&&PS<=n;function aV(n,e,t){return Ig(n)&&Ig(e)&&Ig(t)&&e<=n&&n<t}function T1(n,e,t,r){if(!aV(e,t,r))throw new Error("expected valid "+n+": "+t+" <= n < "+r+", got "+e)}function lV(n){let e;for(e=0;n>PS;n>>=x1,e+=1);return e}const OS=n=>(x1<<BigInt(n))-x1;function cV(n,e,t){if($l(n,"hashLen"),$l(e,"qByteLen"),typeof t!="function")throw new Error("hmacFn must be a function");const r=y=>new Uint8Array(y),i=Uint8Array.of(),s=Uint8Array.of(0),o=Uint8Array.of(1),a=1e3;let l=r(n),c=r(n),h=0;const d=()=>{l.fill(1),c.fill(0),h=0},p=(...y)=>t(c,Is(l,...y)),g=(y=i)=>{c=p(s,y),l=p(),y.length!==0&&(c=p(o,y),l=p())},m=()=>{if(h++>=a)throw new Error("drbg: tried max amount of iterations");let y=0;const S=[];for(;y<e;){l=p();const b=l.slice();S.push(b),y+=l.length}return Is(...S)};return(y,S)=>{d(),g(y);let b;for(;!(b=S(m()));)g();return d(),b}}function Qf(n,e={},t={}){if(!n||typeof n!="object")throw new Error("expected valid options object");function r(s,o,a){const l=n[s];if(a&&l===void 0)return;const c=typeof l;if(c!==o||l===null)throw new Error(`param "${s}" is invalid: expected ${o}, got ${c}`)}const i=(s,o)=>Object.entries(s).forEach(([a,l])=>r(a,l,o));i(e,!1),i(t,!0)}function Rm(n){const e=new WeakMap;return(t,...r)=>{const i=e.get(t);if(i!==void 0)return i;const s=n(t,...r);return e.set(t,s),s}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const ei=BigInt(0),hn=BigInt(1),cl=BigInt(2),oN=BigInt(3),aN=BigInt(4),lN=BigInt(5),uV=BigInt(7),cN=BigInt(8),hV=BigInt(9),uN=BigInt(16);function Fr(n,e){const t=n%e;return t>=ei?t:e+t}function Pr(n,e,t){let r=n;for(;e-- >ei;)r*=r,r%=t;return r}function EC(n,e){if(n===ei)throw new Error("invert: expected non-zero number");if(e<=ei)throw new Error("invert: expected positive modulus, got "+e);let t=Fr(n,e),r=e,i=ei,s=hn;for(;t!==ei;){const a=r/t,l=r%t,c=i-s*a;r=t,t=l,i=s,s=c}if(r!==hn)throw new Error("invert: does not exist");return Fr(i,e)}function LS(n,e,t){if(!n.eql(n.sqr(e),t))throw new Error("Cannot find square root")}function hN(n,e){const t=(n.ORDER+hn)/aN,r=n.pow(e,t);return LS(n,r,e),r}function fV(n,e){const t=(n.ORDER-lN)/cN,r=n.mul(e,cl),i=n.pow(r,t),s=n.mul(e,i),o=n.mul(n.mul(s,cl),i),a=n.mul(s,n.sub(o,n.ONE));return LS(n,a,e),a}function dV(n){const e=Hy(n),t=fN(n),r=t(e,e.neg(e.ONE)),i=t(e,r),s=t(e,e.neg(r)),o=(n+uV)/uN;return(a,l)=>{let c=a.pow(l,o),h=a.mul(c,r);const d=a.mul(c,i),p=a.mul(c,s),g=a.eql(a.sqr(h),l),m=a.eql(a.sqr(d),l);c=a.cmov(c,h,g),h=a.cmov(p,d,m);const E=a.eql(a.sqr(h),l),y=a.cmov(c,h,E);return LS(a,y,l),y}}function fN(n){if(n<oN)throw new Error("sqrt is not defined for small field");let e=n-hn,t=0;for(;e%cl===ei;)e/=cl,t++;let r=cl;const i=Hy(n);for(;SC(i,r)===1;)if(r++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(t===1)return hN;let s=i.pow(r,e);const o=(e+hn)/cl;return function(l,c){if(l.is0(c))return c;if(SC(l,c)!==1)throw new Error("Cannot find square root");let h=t,d=l.mul(l.ONE,s),p=l.pow(c,e),g=l.pow(c,o);for(;!l.eql(p,l.ONE);){if(l.is0(p))return l.ZERO;let m=1,E=l.sqr(p);for(;!l.eql(E,l.ONE);)if(m++,E=l.sqr(E),m===h)throw new Error("Cannot find square root");const y=hn<<BigInt(h-m-1),S=l.pow(d,y);h=m,d=l.sqr(S),p=l.mul(p,d),g=l.mul(g,S)}return g}}function pV(n){return n%aN===oN?hN:n%cN===lN?fV:n%uN===hV?dV(n):fN(n)}const gV=(n,e)=>(Fr(n,e)&hn)===hn,mV=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function yV(n){const e={ORDER:"bigint",BYTES:"number",BITS:"number"},t=mV.reduce((r,i)=>(r[i]="function",r),e);return Qf(n,t),n}function bV(n,e,t){if(t<ei)throw new Error("invalid exponent, negatives unsupported");if(t===ei)return n.ONE;if(t===hn)return e;let r=n.ONE,i=e;for(;t>ei;)t&hn&&(r=n.mul(r,i)),i=n.sqr(i),t>>=hn;return r}function dN(n,e,t=!1){const r=new Array(e.length).fill(t?n.ZERO:void 0),i=e.reduce((o,a,l)=>n.is0(a)?o:(r[l]=o,n.mul(o,a)),n.ONE),s=n.inv(i);return e.reduceRight((o,a,l)=>n.is0(a)?o:(r[l]=n.mul(o,r[l]),n.mul(o,a)),s),r}function SC(n,e){const t=(n.ORDER-hn)/cl,r=n.pow(e,t),i=n.eql(r,n.ONE),s=n.eql(r,n.ZERO),o=n.eql(r,n.neg(n.ONE));if(!i&&!s&&!o)throw new Error("invalid Legendre symbol result");return i?1:s?0:-1}function wV(n,e){e!==void 0&&$l(e);const t=e!==void 0?e:n.toString(2).length,r=Math.ceil(t/8);return{nBitLength:t,nByteLength:r}}class vV{constructor(e,t={}){v(this,"ORDER");v(this,"BITS");v(this,"BYTES");v(this,"isLE");v(this,"ZERO",ei);v(this,"ONE",hn);v(this,"_lengths");v(this,"_sqrt");v(this,"_mod");var o;if(e<=ei)throw new Error("invalid field: expected ORDER > 0, got "+e);let r;this.isLE=!1,t!=null&&typeof t=="object"&&(typeof t.BITS=="number"&&(r=t.BITS),typeof t.sqrt=="function"&&(this.sqrt=t.sqrt),typeof t.isLE=="boolean"&&(this.isLE=t.isLE),t.allowedLengths&&(this._lengths=(o=t.allowedLengths)==null?void 0:o.slice()),typeof t.modFromBytes=="boolean"&&(this._mod=t.modFromBytes));const{nBitLength:i,nByteLength:s}=wV(e,r);if(s>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");this.ORDER=e,this.BITS=i,this.BYTES=s,this._sqrt=void 0,Object.preventExtensions(this)}create(e){return Fr(e,this.ORDER)}isValid(e){if(typeof e!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof e);return ei<=e&&e<this.ORDER}is0(e){return e===ei}isValidNot0(e){return!this.is0(e)&&this.isValid(e)}isOdd(e){return(e&hn)===hn}neg(e){return Fr(-e,this.ORDER)}eql(e,t){return e===t}sqr(e){return Fr(e*e,this.ORDER)}add(e,t){return Fr(e+t,this.ORDER)}sub(e,t){return Fr(e-t,this.ORDER)}mul(e,t){return Fr(e*t,this.ORDER)}pow(e,t){return bV(this,e,t)}div(e,t){return Fr(e*EC(t,this.ORDER),this.ORDER)}sqrN(e){return e*e}addN(e,t){return e+t}subN(e,t){return e-t}mulN(e,t){return e*t}inv(e){return EC(e,this.ORDER)}sqrt(e){return this._sqrt||(this._sqrt=pV(this.ORDER)),this._sqrt(this,e)}toBytes(e){return this.isLE?sN(e,this.BYTES):RS(e,this.BYTES)}fromBytes(e,t=!1){jt(e);const{_lengths:r,BYTES:i,isLE:s,ORDER:o,_mod:a}=this;if(r){if(!r.includes(e.length)||e.length>i)throw new Error("Field.fromBytes: expected "+r+" bytes, got "+e.length);const c=new Uint8Array(i);c.set(e,s?0:c.length-e.length),e=c}if(e.length!==i)throw new Error("Field.fromBytes: expected "+i+" bytes, got "+e.length);let l=s?bf(e):qy(e);if(a&&(l=Fr(l,o)),!t&&!this.isValid(l))throw new Error("invalid field element: outside of range 0..ORDER");return l}invertBatch(e){return dN(this,e)}cmov(e,t,r){return r?t:e}}function Hy(n,e={}){return new vV(n,e)}function pN(n){if(typeof n!="bigint")throw new Error("field order must be bigint");const e=n.toString(2).length;return Math.ceil(e/8)}function gN(n){const e=pN(n);return e+Math.ceil(e/2)}function _V(n,e,t=!1){jt(n);const r=n.length,i=pN(e),s=gN(e);if(r<16||r<s||r>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+r);const o=t?bf(n):qy(n),a=Fr(o,e-hn)+hn;return t?sN(a,i):RS(a,i)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _u=BigInt(0),ul=BigInt(1);function Om(n,e){const t=e.negate();return n?t:e}function Gh(n,e){const t=dN(n.Fp,e.map(r=>r.Z));return e.map((r,i)=>n.fromAffine(r.toAffine(t[i])))}function mN(n,e){if(!Number.isSafeInteger(n)||n<=0||n>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+n)}function V0(n,e){mN(n,e);const t=Math.ceil(e/n)+1,r=2**(n-1),i=2**n,s=OS(n),o=BigInt(n);return{windows:t,windowSize:r,mask:s,maxNumber:i,shiftBy:o}}function AC(n,e,t){const{windowSize:r,mask:i,maxNumber:s,shiftBy:o}=t;let a=Number(n&i),l=n>>o;a>r&&(a-=s,l+=ul);const c=e*r,h=c+Math.abs(a)-1,d=a===0,p=a<0,g=e%2!==0;return{nextN:l,offset:h,isZero:d,isNeg:p,isNegF:g,offsetF:c}}const G0=new WeakMap,yN=new WeakMap;function Y0(n){return yN.get(n)||1}function xC(n){if(n!==_u)throw new Error("invalid wNAF")}let bN=class{constructor(e,t){v(this,"BASE");v(this,"ZERO");v(this,"Fn");v(this,"bits");this.BASE=e.BASE,this.ZERO=e.ZERO,this.Fn=e.Fn,this.bits=t}_unsafeLadder(e,t,r=this.ZERO){let i=e;for(;t>_u;)t&ul&&(r=r.add(i)),i=i.double(),t>>=ul;return r}precomputeWindow(e,t){const{windows:r,windowSize:i}=V0(t,this.bits),s=[];let o=e,a=o;for(let l=0;l<r;l++){a=o,s.push(a);for(let c=1;c<i;c++)a=a.add(o),s.push(a);o=a.double()}return s}wNAF(e,t,r){if(!this.Fn.isValid(r))throw new Error("invalid scalar");let i=this.ZERO,s=this.BASE;const o=V0(e,this.bits);for(let a=0;a<o.windows;a++){const{nextN:l,offset:c,isZero:h,isNeg:d,isNegF:p,offsetF:g}=AC(r,a,o);r=l,h?s=s.add(Om(p,t[g])):i=i.add(Om(d,t[c]))}return xC(r),{p:i,f:s}}wNAFUnsafe(e,t,r,i=this.ZERO){const s=V0(e,this.bits);for(let o=0;o<s.windows&&r!==_u;o++){const{nextN:a,offset:l,isZero:c,isNeg:h}=AC(r,o,s);if(r=a,!c){const d=t[l];i=i.add(h?d.negate():d)}}return xC(r),i}getPrecomputes(e,t,r){let i=G0.get(t);return i||(i=this.precomputeWindow(t,e),e!==1&&(typeof r=="function"&&(i=r(i)),G0.set(t,i))),i}cached(e,t,r){const i=Y0(e);return this.wNAF(i,this.getPrecomputes(i,e,r),t)}unsafe(e,t,r,i){const s=Y0(e);return s===1?this._unsafeLadder(e,t,i):this.wNAFUnsafe(s,this.getPrecomputes(s,e,r),t,i)}createCache(e,t){mN(t,this.bits),yN.set(e,t),G0.delete(e)}hasCache(e){return Y0(e)!==1}};function EV(n,e,t,r){let i=e,s=n.ZERO,o=n.ZERO;for(;t>_u||r>_u;)t&ul&&(s=s.add(i)),r&ul&&(o=o.add(i)),i=i.double(),t>>=ul,r>>=ul;return{p1:s,p2:o}}function IC(n,e,t){if(e){if(e.ORDER!==n)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return yV(e),e}else return Hy(n,{isLE:t})}function wN(n,e,t={},r){if(r===void 0&&(r=n==="edwards"),!e||typeof e!="object")throw new Error(`expected valid ${n} CURVE object`);for(const l of["p","n","h"]){const c=e[l];if(!(typeof c=="bigint"&&c>_u))throw new Error(`CURVE.${l} must be positive bigint`)}const i=IC(e.p,t.Fp,r),s=IC(e.n,t.Fn,r),a=["Gx","Gy","a",n==="weierstrass"?"b":"d"];for(const l of a)if(!i.isValid(e[l]))throw new Error(`CURVE.${l} must be valid field element of CURVE.Fp`);return e=Object.freeze(Object.assign({},e)),{CURVE:e,Fp:i,Fn:s}}function vN(n,e){return function(r){const i=n(r);return{secretKey:i,publicKey:e(i)}}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const qo=BigInt(0),Xr=BigInt(1),X0=BigInt(2),SV=BigInt(8);function AV(n,e,t,r){const i=n.sqr(t),s=n.sqr(r),o=n.add(n.mul(e.a,i),s),a=n.add(n.ONE,n.mul(e.d,n.mul(i,s)));return n.eql(o,a)}function xV(n,e={}){const t=wN("edwards",n,e,e.FpFnLE),{Fp:r,Fn:i}=t;let s=t.CURVE;const{h:o}=s;Qf(e,{},{uvRatio:"function"});const a=X0<<BigInt(i.BYTES*8)-Xr,l=S=>r.create(S),c=e.uvRatio||((S,b)=>{try{return{isValid:!0,value:r.sqrt(r.div(S,b))}}catch{return{isValid:!1,value:qo}}});if(!AV(r,s,s.Gx,s.Gy))throw new Error("bad curve params: generator point");function h(S,b,_=!1){const I=_?Xr:qo;return T1("coordinate "+S,b,I,a),b}function d(S){if(!(S instanceof m))throw new Error("EdwardsPoint expected")}const p=Rm((S,b)=>{const{X:_,Y:I,Z:x}=S,$=S.is0();b==null&&(b=$?SV:r.inv(x));const U=l(_*b),O=l(I*b),P=r.mul(x,b);if($)return{x:qo,y:Xr};if(P!==Xr)throw new Error("invZ was invalid");return{x:U,y:O}}),g=Rm(S=>{const{a:b,d:_}=s;if(S.is0())throw new Error("bad point: ZERO");const{X:I,Y:x,Z:$,T:U}=S,O=l(I*I),P=l(x*x),M=l($*$),K=l(M*M),C=l(O*b),B=l(M*l(C+P)),N=l(K+l(_*l(O*P)));if(B!==N)throw new Error("bad point: equation left != right (1)");const L=l(I*x),V=l($*U);if(L!==V)throw new Error("bad point: equation left != right (2)");return!0}),y=class y{constructor(b,_,I,x){v(this,"X");v(this,"Y");v(this,"Z");v(this,"T");this.X=h("x",b),this.Y=h("y",_),this.Z=h("z",I,!0),this.T=h("t",x),Object.freeze(this)}static CURVE(){return s}static fromAffine(b){if(b instanceof y)throw new Error("extended point not allowed");const{x:_,y:I}=b||{};return h("x",_),h("y",I),new y(_,I,Xr,l(_*I))}static fromBytes(b,_=!1){const I=r.BYTES,{a:x,d:$}=s;b=I1(jt(b,I,"point")),Ml(_,"zip215");const U=I1(b),O=b[I-1];U[I-1]=O&-129;const P=bf(U),M=_?a:r.ORDER;T1("point.y",P,qo,M);const K=l(P*P),C=l(K-Xr),B=l($*K-x);let{isValid:N,value:L}=c(C,B);if(!N)throw new Error("bad point: invalid y coordinate");const V=(L&Xr)===Xr,W=(O&128)!==0;if(!_&&L===qo&&W)throw new Error("bad point: x=0 and x_0=1");return W!==V&&(L=l(-L)),y.fromAffine({x:L,y:P})}static fromHex(b,_=!1){return y.fromBytes(yf(b),_)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(b=8,_=!0){return E.createCache(this,b),_||this.multiply(X0),this}assertValidity(){g(this)}equals(b){d(b);const{X:_,Y:I,Z:x}=this,{X:$,Y:U,Z:O}=b,P=l(_*O),M=l($*x),K=l(I*O),C=l(U*x);return P===M&&K===C}is0(){return this.equals(y.ZERO)}negate(){return new y(l(-this.X),this.Y,this.Z,l(-this.T))}double(){const{a:b}=s,{X:_,Y:I,Z:x}=this,$=l(_*_),U=l(I*I),O=l(X0*l(x*x)),P=l(b*$),M=_+I,K=l(l(M*M)-$-U),C=P+U,B=C-O,N=P-U,L=l(K*B),V=l(C*N),W=l(K*N),H=l(B*C);return new y(L,V,H,W)}add(b){d(b);const{a:_,d:I}=s,{X:x,Y:$,Z:U,T:O}=this,{X:P,Y:M,Z:K,T:C}=b,B=l(x*P),N=l($*M),L=l(O*I*C),V=l(U*K),W=l((x+$)*(P+M)-B-N),H=V-L,G=V+L,z=l(N-_*B),Z=l(W*H),F=l(G*z),ie=l(W*z),fe=l(H*G);return new y(Z,F,fe,ie)}subtract(b){return this.add(b.negate())}multiply(b){if(!i.isValidNot0(b))throw new Error("invalid scalar: expected 1 <= sc < curve.n");const{p:_,f:I}=E.cached(this,b,x=>Gh(y,x));return Gh(y,[_,I])[0]}multiplyUnsafe(b,_=y.ZERO){if(!i.isValid(b))throw new Error("invalid scalar: expected 0 <= sc < curve.n");return b===qo?y.ZERO:this.is0()||b===Xr?this:E.unsafe(this,b,I=>Gh(y,I),_)}isSmallOrder(){return this.multiplyUnsafe(o).is0()}isTorsionFree(){return E.unsafe(this,s.n).is0()}toAffine(b){return p(this,b)}clearCofactor(){return o===Xr?this:this.multiplyUnsafe(o)}toBytes(){const{x:b,y:_}=this.toAffine(),I=r.toBytes(_);return I[I.length-1]|=b&Xr?128:0,I}toHex(){return Zf(this.toBytes())}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}};v(y,"BASE",new y(s.Gx,s.Gy,Xr,l(s.Gx*s.Gy))),v(y,"ZERO",new y(qo,Xr,Xr,qo)),v(y,"Fp",r),v(y,"Fn",i);let m=y;const E=new bN(m,i.BITS);return m.BASE.precompute(8),m}function IV(n,e,t={}){if(typeof e!="function")throw new Error('"hash" function param is required');Qf(t,{},{adjustScalarBytes:"function",randomBytes:"function",domain:"function",prehash:"function",mapToCurve:"function"});const{prehash:r}=t,{BASE:i,Fp:s,Fn:o}=n,a=t.randomBytes||jy,l=t.adjustScalarBytes||(O=>O),c=t.domain||((O,P,M)=>{if(Ml(M,"phflag"),P.length||M)throw new Error("Contexts/pre-hash are not supported");return O});function h(O){return o.create(bf(O))}function d(O){const P=_.secretKey;jt(O,_.secretKey,"secretKey");const M=jt(e(O),2*P,"hashedSecretKey"),K=l(M.slice(0,P)),C=M.slice(P,2*P),B=h(K);return{head:K,prefix:C,scalar:B}}function p(O){const{head:P,prefix:M,scalar:K}=d(O),C=i.multiply(K),B=C.toBytes();return{head:P,prefix:M,scalar:K,point:C,pointBytes:B}}function g(O){return p(O).pointBytes}function m(O=Uint8Array.of(),...P){const M=Is(...P);return h(e(c(M,jt(O,void 0,"context"),!!r)))}function E(O,P,M={}){O=jt(O,void 0,"message"),r&&(O=r(O));const{prefix:K,scalar:C,pointBytes:B}=p(P),N=m(M.context,K,O),L=i.multiply(N).toBytes(),V=m(M.context,L,B,O),W=o.create(N+V*C);if(!o.isValid(W))throw new Error("sign failed: invalid s");const H=Is(L,o.toBytes(W));return jt(H,_.signature,"result")}const y={zip215:!0};function S(O,P,M,K=y){const{context:C,zip215:B}=K,N=_.signature;O=jt(O,N,"signature"),P=jt(P,void 0,"message"),M=jt(M,_.publicKey,"publicKey"),B!==void 0&&Ml(B,"zip215"),r&&(P=r(P));const L=N/2,V=O.subarray(0,L),W=bf(O.subarray(L,N));let H,G,z;try{H=n.fromBytes(M,B),G=n.fromBytes(V,B),z=i.multiplyUnsafe(W)}catch{return!1}if(!B&&H.isSmallOrder())return!1;const Z=m(C,G.toBytes(),H.toBytes(),P);return G.add(H.multiplyUnsafe(Z)).subtract(z).clearCofactor().is0()}const b=s.BYTES,_={secretKey:b,publicKey:b,signature:2*b,seed:b};function I(O=a(_.seed)){return jt(O,_.seed,"seed")}function x(O){return Fy(O)&&O.length===o.BYTES}function $(O,P){try{return!!n.fromBytes(O,P)}catch{return!1}}const U={getExtendedPublicKey:p,randomSecretKey:I,isValidSecretKey:x,isValidPublicKey:$,toMontgomery(O){const{y:P}=n.fromBytes(O),M=_.publicKey,K=M===32;if(!K&&M!==57)throw new Error("only defined for 25519 and 448");const C=K?s.div(Xr+P,Xr-P):s.div(P-Xr,P+Xr);return s.toBytes(C)},toMontgomerySecret(O){const P=_.secretKey;jt(O,P);const M=e(O.subarray(0,P));return l(M).subarray(0,P)}};return Object.freeze({keygen:vN(I,g),getPublicKey:g,sign:E,verify:S,utils:U,Point:n,lengths:_})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const TV=BigInt(1),TC=BigInt(2),CV=BigInt(5),kV=BigInt(8),NS=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),PV={p:NS,n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),h:kV,a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")};function RV(n){const e=BigInt(10),t=BigInt(20),r=BigInt(40),i=BigInt(80),s=NS,a=n*n%s*n%s,l=Pr(a,TC,s)*a%s,c=Pr(l,TV,s)*n%s,h=Pr(c,CV,s)*c%s,d=Pr(h,e,s)*h%s,p=Pr(d,t,s)*d%s,g=Pr(p,r,s)*p%s,m=Pr(g,i,s)*g%s,E=Pr(m,i,s)*g%s,y=Pr(E,e,s)*h%s;return{pow_p_5_8:Pr(y,TC,s)*n%s,b2:a}}function OV(n){return n[0]&=248,n[31]&=127,n[31]|=64,n}const CC=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");function LV(n,e){const t=NS,r=Fr(e*e*e,t),i=Fr(r*r*e,t),s=RV(n*i).pow_p_5_8;let o=Fr(n*r*s,t);const a=Fr(e*o*o,t),l=o,c=Fr(o*CC,t),h=a===n,d=a===Fr(-n,t),p=a===Fr(-n*CC,t);return h&&(o=l),(d||p)&&(o=c),gV(o,t)&&(o=Fr(-o,t)),{isValid:h||d,value:o}}const NV=xV(PV,{uvRatio:LV});function DV(n){return IV(NV,oV,Object.assign({adjustScalarBytes:OV},n))}const Lm=DV({});let kC=class extends Error{constructor(e="An error occurred while verifying a message"){super(e),this.name="VerificationError"}},$V=class extends Error{constructor(e="Missing Web Crypto API"){super(e),this.name="WebCryptoMissingError"}};const Bl={get(n=globalThis){const e=n.crypto;if((e==null?void 0:e.subtle)==null)throw new $V("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p/blob/main/packages/crypto/README.md#web-crypto-api");return e}},_N=32,DS=64,C1=32;let Vc;const EN=(async()=>{try{return await Bl.get().subtle.generateKey({name:"Ed25519"},!0,["sign","verify"]),!0}catch{return!1}})();function MV(){const n=Lm.utils.randomSecretKey(),e=Lm.getPublicKey(n);return{privateKey:WV(n,e),publicKey:e}}async function BV(n,e){let t;n.length===DS?t=n.subarray(0,32):t=n;const r={crv:"Ed25519",kty:"OKP",x:mt(n.subarray(32),"base64url"),d:mt(t,"base64url"),ext:!0,key_ops:["sign"]},i=await Bl.get().subtle.importKey("jwk",r,{name:"Ed25519"},!0,["sign"]),s=await Bl.get().subtle.sign({name:"Ed25519"},i,e instanceof Uint8Array?e:e.subarray());return new Uint8Array(s,0,s.byteLength)}function UV(n,e){const t=n.subarray(0,C1);return Lm.sign(e instanceof Uint8Array?e:e.subarray(),t)}async function FV(n,e){return Vc==null&&(Vc=await EN),Vc?BV(n,e):UV(n,e)}async function jV(n,e,t){if(n.buffer instanceof ArrayBuffer){const r=await Bl.get().subtle.importKey("raw",n.buffer,{name:"Ed25519"},!1,["verify"]);return await Bl.get().subtle.verify({name:"Ed25519"},r,e,t instanceof Uint8Array?t:t.subarray())}throw new TypeError("WebCrypto does not support SharedArrayBuffer for Ed25519 keys")}function qV(n,e,t){return Lm.verify(e,t instanceof Uint8Array?t:t.subarray(),n)}async function HV(n,e,t){return Vc==null&&(Vc=await EN),Vc?jV(n,e,t):qV(n,e,t)}function WV(n,e){const t=new Uint8Array(DS);for(let r=0;r<C1;r++)t[r]=n[r],t[C1+r]=e[r];return t}function $S(n){return n==null?!1:typeof n.then=="function"&&typeof n.catch=="function"&&typeof n.finally=="function"}let SN=class{constructor(e){v(this,"type","Ed25519");v(this,"raw");this.raw=MS(e,_N)}toMultihash(){return Ia.digest(ho(this))}toCID(){return zt.createV1(114,this.toMultihash())}toString(){return _r.encode(this.toMultihash().bytes).substring(1)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:Or(this.raw,e.raw)}verify(e,t,r){var s;(s=r==null?void 0:r.signal)==null||s.throwIfAborted();const i=HV(this.raw,t,e);return $S(i)?i.then(o=>{var a;return(a=r==null?void 0:r.signal)==null||a.throwIfAborted(),o}):i}};class zV{constructor(e,t){v(this,"type","Ed25519");v(this,"raw");v(this,"publicKey");this.raw=MS(e,DS),this.publicKey=new SN(t)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:Or(this.raw,e.raw)}sign(e,t){var i,s;(i=t==null?void 0:t.signal)==null||i.throwIfAborted();const r=FV(this.raw,e);return $S(r)?r.then(o=>{var a;return(a=t==null?void 0:t.signal)==null||a.throwIfAborted(),o}):((s=t==null?void 0:t.signal)==null||s.throwIfAborted(),r)}}function AN(n){return n=MS(n,_N),new SN(n)}async function KV(){const{privateKey:n,publicKey:e}=MV();return new zV(n,e)}function MS(n,e){if(n=Uint8Array.from(n??[]),n.length!==e)throw new Yf(`Key must be a Uint8Array of length ${e}, got ${n.length}`);return n}var cn;(function(n){n.RSA="RSA",n.Ed25519="Ed25519",n.secp256k1="secp256k1",n.ECDSA="ECDSA"})(cn||(cn={}));var k1;(function(n){n[n.RSA=0]="RSA",n[n.Ed25519=1]="Ed25519",n[n.secp256k1=2]="secp256k1",n[n.ECDSA=3]="ECDSA"})(k1||(k1={}));(function(n){n.codec=()=>fS(k1)})(cn||(cn={}));var Eu;(function(n){let e;n.codec=()=>(e==null&&(e=pt((t,r,i={})=>{i.lengthDelimited!==!1&&r.fork(),t.Type!=null&&(r.uint32(8),cn.codec().encode(t.Type,r)),t.Data!=null&&(r.uint32(18),r.bytes(t.Data)),i.lengthDelimited!==!1&&r.ldelim()},(t,r,i={})=>{const s={},o=r==null?t.len:t.pos+r;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.Type=cn.codec().decode(t);break}case 2:{s.Data=t.bytes();break}default:{t.skipType(a&7);break}}}return s})),e),n.encode=t=>dt(t,n.codec()),n.decode=(t,r)=>ft(t,n.codec(),r)})(Eu||(Eu={}));var PC;(function(n){let e;n.codec=()=>(e==null&&(e=pt((t,r,i={})=>{i.lengthDelimited!==!1&&r.fork(),t.Type!=null&&(r.uint32(8),cn.codec().encode(t.Type,r)),t.Data!=null&&(r.uint32(18),r.bytes(t.Data)),i.lengthDelimited!==!1&&r.ldelim()},(t,r,i={})=>{const s={},o=r==null?t.len:t.pos+r;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.Type=cn.codec().decode(t);break}case 2:{s.Data=t.bytes();break}default:{t.skipType(a&7);break}}}return s})),e),n.encode=t=>dt(t,n.codec()),n.decode=(t,r)=>ft(t,n.codec(),r)})(PC||(PC={}));function BS(n){if(isNaN(n)||n<=0)throw new Yf("random bytes length must be a Number bigger than 0");return jy(n)}let VV=class{constructor(e,t){v(this,"type","RSA");v(this,"jwk");v(this,"_raw");v(this,"_multihash");this.jwk=e,this._multihash=t}get raw(){return this._raw==null&&(this._raw=QV(this.jwk)),this._raw}toMultihash(){return this._multihash}toCID(){return zt.createV1(114,this._multihash)}toString(){return _r.encode(this.toMultihash().bytes).substring(1)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:Or(this.raw,e.raw)}verify(e,t,r){return tG(this.jwk,t,e,r)}};const GV=18,YV=1062,XV=Uint8Array.from([48,13,6,9,42,134,72,134,247,13,1,1,1,5,0]);function ZV(n){const e=Uy(n[1],{offset:0});return{kty:"RSA",n:mt(e[0],"base64url"),e:mt(e[1],"base64url")}}function QV(n){if(n.n==null||n.e==null)throw new Yf("JWK was missing components");return Vh([XV,GL(Vh([A1(at(n.n,"base64url")),A1(at(n.e,"base64url"))]))]).subarray()}function JV(n,e){if(n.byteLength>=YV)throw new TS("Key size is too large");const t=Uy(n,{offset:0});return eG(t,n,e)}function eG(n,e,t){const r=ZV(n);if(t==null){const i=rN(Eu.encode({Type:cn.RSA,Data:e}));t=Kf(GV,i)}return new VV(r,t)}async function tG(n,e,t,r){var o,a;const i=await Bl.get().subtle.importKey("jwk",n,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);(o=r==null?void 0:r.signal)==null||o.throwIfAborted();const s=await Bl.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},i,e,t instanceof Uint8Array?t:t.subarray());return(a=r==null?void 0:r.signal)==null||a.throwIfAborted(),s}class xN{constructor(e,t){v(this,"oHash");v(this,"iHash");v(this,"blockLen");v(this,"outputLen");v(this,"finished",!1);v(this,"destroyed",!1);if(XL(e),jt(t,void 0,"key"),this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const r=this.blockLen,i=new Uint8Array(r);i.set(t.length>r?e.create().update(t).digest():t);for(let s=0;s<i.length;s++)i[s]^=54;this.iHash.update(i),this.oHash=e.create();for(let s=0;s<i.length;s++)i[s]^=106;this.oHash.update(i),vu(i)}update(e){return Pm(this),this.iHash.update(e),this}digestInto(e){Pm(this),jt(e,this.outputLen,"output"),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:r,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return e=e,e.finished=i,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=t._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const IN=(n,e,t)=>new xN(n,e).update(t).digest();IN.create=(n,e)=>new xN(n,e);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const RC=(n,e)=>(n+(n>=0?e:-e)/TN)/e;function rG(n,e,t){const[[r,i],[s,o]]=e,a=RC(o*n,t),l=RC(-i*n,t);let c=n-a*r-l*s,h=-a*i-l*o;const d=c<lo,p=h<lo;d&&(c=-c),p&&(h=-h);const g=OS(Math.ceil(lV(t)/2))+Gc;if(c<lo||c>=g||h<lo||h>=g)throw new Error("splitScalar (endomorphism): failed, k="+n);return{k1neg:d,k1:c,k2neg:p,k2:h}}function P1(n){if(!["compact","recovered","der"].includes(n))throw new Error('Signature format must be "compact", "recovered", or "der"');return n}function Z0(n,e){const t={};for(let r of Object.keys(e))t[r]=n[r]===void 0?e[r]:n[r];return Ml(t.lowS,"lowS"),Ml(t.prehash,"prehash"),t.format!==void 0&&P1(t.format),t}let nG=class extends Error{constructor(e=""){super(e)}};const na={Err:nG,_tlv:{encode:(n,e)=>{const{Err:t}=na;if(n<0||n>256)throw new t("tlv.encode: wrong tag");if(e.length&1)throw new t("tlv.encode: unpadded data");const r=e.length/2,i=fp(r);if(i.length/2&128)throw new t("tlv.encode: long form length too big");const s=r>127?fp(i.length/2|128):"";return fp(n)+s+i+e},decode(n,e){const{Err:t}=na;let r=0;if(n<0||n>256)throw new t("tlv.encode: wrong tag");if(e.length<2||e[r++]!==n)throw new t("tlv.decode: wrong tlv");const i=e[r++],s=!!(i&128);let o=0;if(!s)o=i;else{const l=i&127;if(!l)throw new t("tlv.decode(long): indefinite length not supported");if(l>4)throw new t("tlv.decode(long): byte length is too big");const c=e.subarray(r,r+l);if(c.length!==l)throw new t("tlv.decode: length bytes not complete");if(c[0]===0)throw new t("tlv.decode(long): zero leftmost byte");for(const h of c)o=o<<8|h;if(r+=l,o<128)throw new t("tlv.decode(long): not minimal encoding")}const a=e.subarray(r,r+o);if(a.length!==o)throw new t("tlv.decode: wrong value length");return{v:a,l:e.subarray(r+o)}}},_int:{encode(n){const{Err:e}=na;if(n<lo)throw new e("integer: negative integers are not allowed");let t=fp(n);if(Number.parseInt(t[0],16)&8&&(t="00"+t),t.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return t},decode(n){const{Err:e}=na;if(n[0]&128)throw new e("invalid signature integer: negative");if(n[0]===0&&!(n[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return qy(n)}},toSig(n){const{Err:e,_int:t,_tlv:r}=na,i=jt(n,void 0,"signature"),{v:s,l:o}=r.decode(48,i);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l}=r.decode(2,s),{v:c,l:h}=r.decode(2,l);if(h.length)throw new e("invalid signature: left bytes after parsing");return{r:t.decode(a),s:t.decode(c)}},hexFromSig(n){const{_tlv:e,_int:t}=na,r=e.encode(2,t.encode(n.r)),i=e.encode(2,t.encode(n.s)),s=r+i;return e.encode(48,s)}},lo=BigInt(0),Gc=BigInt(1),TN=BigInt(2),dp=BigInt(3),iG=BigInt(4);function sG(n,e={}){const t=wN("weierstrass",n,e),{Fp:r,Fn:i}=t;let s=t.CURVE;const{h:o,n:a}=s;Qf(e,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object"});const{endo:l}=e;if(l&&(!r.is0(s.a)||typeof l.beta!="bigint"||!Array.isArray(l.basises)))throw new Error('invalid endo: expected "beta": bigint and "basises": array');const c=kN(r,i);function h(){if(!r.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function d(B,N,L){const{x:V,y:W}=N.toAffine(),H=r.toBytes(V);if(Ml(L,"isCompressed"),L){h();const G=!r.isOdd(W);return Is(CN(G),H)}else return Is(Uint8Array.of(4),H,r.toBytes(W))}function p(B){jt(B,void 0,"Point");const{publicKey:N,publicKeyUncompressed:L}=c,V=B.length,W=B[0],H=B.subarray(1);if(V===N&&(W===2||W===3)){const G=r.fromBytes(H);if(!r.isValid(G))throw new Error("bad point: is not on curve, wrong x");const z=E(G);let Z;try{Z=r.sqrt(z)}catch(fe){const J=fe instanceof Error?": "+fe.message:"";throw new Error("bad point: is not on curve, sqrt error"+J)}h();const F=r.isOdd(Z);return(W&1)===1!==F&&(Z=r.neg(Z)),{x:G,y:Z}}else if(V===L&&W===4){const G=r.BYTES,z=r.fromBytes(H.subarray(0,G)),Z=r.fromBytes(H.subarray(G,G*2));if(!y(z,Z))throw new Error("bad point: is not on curve");return{x:z,y:Z}}else throw new Error(`bad point: got length ${V}, expected compressed=${N} or uncompressed=${L}`)}const g=e.toBytes||d,m=e.fromBytes||p;function E(B){const N=r.sqr(B),L=r.mul(N,B);return r.add(r.add(L,r.mul(B,s.a)),s.b)}function y(B,N){const L=r.sqr(N),V=E(B);return r.eql(L,V)}if(!y(s.Gx,s.Gy))throw new Error("bad curve params: generator point");const S=r.mul(r.pow(s.a,dp),iG),b=r.mul(r.sqr(s.b),BigInt(27));if(r.is0(r.add(S,b)))throw new Error("bad curve params: a or b");function _(B,N,L=!1){if(!r.isValid(N)||L&&r.is0(N))throw new Error(`bad point coordinate ${B}`);return N}function I(B){if(!(B instanceof P))throw new Error("Weierstrass Point expected")}function x(B){if(!l||!l.basises)throw new Error("no endo");return rG(B,l.basises,i.ORDER)}const $=Rm((B,N)=>{const{X:L,Y:V,Z:W}=B;if(r.eql(W,r.ONE))return{x:L,y:V};const H=B.is0();N==null&&(N=H?r.ONE:r.inv(W));const G=r.mul(L,N),z=r.mul(V,N),Z=r.mul(W,N);if(H)return{x:r.ZERO,y:r.ZERO};if(!r.eql(Z,r.ONE))throw new Error("invZ was invalid");return{x:G,y:z}}),U=Rm(B=>{if(B.is0()){if(e.allowInfinityPoint&&!r.is0(B.Y))return;throw new Error("bad point: ZERO")}const{x:N,y:L}=B.toAffine();if(!r.isValid(N)||!r.isValid(L))throw new Error("bad point: x or y not field elements");if(!y(N,L))throw new Error("bad point: equation left != right");if(!B.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function O(B,N,L,V,W){return L=new P(r.mul(L.X,B),L.Y,L.Z),N=Om(V,N),L=Om(W,L),N.add(L)}const C=class C{constructor(N,L,V){v(this,"X");v(this,"Y");v(this,"Z");this.X=_("x",N),this.Y=_("y",L,!0),this.Z=_("z",V),Object.freeze(this)}static CURVE(){return s}static fromAffine(N){const{x:L,y:V}=N||{};if(!N||!r.isValid(L)||!r.isValid(V))throw new Error("invalid affine point");if(N instanceof C)throw new Error("projective point not allowed");return r.is0(L)&&r.is0(V)?C.ZERO:new C(L,V,r.ONE)}static fromBytes(N){const L=C.fromAffine(m(jt(N,void 0,"point")));return L.assertValidity(),L}static fromHex(N){return C.fromBytes(yf(N))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(N=8,L=!0){return K.createCache(this,N),L||this.multiply(dp),this}assertValidity(){U(this)}hasEvenY(){const{y:N}=this.toAffine();if(!r.isOdd)throw new Error("Field doesn't support isOdd");return!r.isOdd(N)}equals(N){I(N);const{X:L,Y:V,Z:W}=this,{X:H,Y:G,Z:z}=N,Z=r.eql(r.mul(L,z),r.mul(H,W)),F=r.eql(r.mul(V,z),r.mul(G,W));return Z&&F}negate(){return new C(this.X,r.neg(this.Y),this.Z)}double(){const{a:N,b:L}=s,V=r.mul(L,dp),{X:W,Y:H,Z:G}=this;let z=r.ZERO,Z=r.ZERO,F=r.ZERO,ie=r.mul(W,W),fe=r.mul(H,H),J=r.mul(G,G),_e=r.mul(W,H);return _e=r.add(_e,_e),F=r.mul(W,G),F=r.add(F,F),z=r.mul(N,F),Z=r.mul(V,J),Z=r.add(z,Z),z=r.sub(fe,Z),Z=r.add(fe,Z),Z=r.mul(z,Z),z=r.mul(_e,z),F=r.mul(V,F),J=r.mul(N,J),_e=r.sub(ie,J),_e=r.mul(N,_e),_e=r.add(_e,F),F=r.add(ie,ie),ie=r.add(F,ie),ie=r.add(ie,J),ie=r.mul(ie,_e),Z=r.add(Z,ie),J=r.mul(H,G),J=r.add(J,J),ie=r.mul(J,_e),z=r.sub(z,ie),F=r.mul(J,fe),F=r.add(F,F),F=r.add(F,F),new C(z,Z,F)}add(N){I(N);const{X:L,Y:V,Z:W}=this,{X:H,Y:G,Z:z}=N;let Z=r.ZERO,F=r.ZERO,ie=r.ZERO;const fe=s.a,J=r.mul(s.b,dp);let _e=r.mul(L,H),oe=r.mul(V,G),ne=r.mul(W,z),de=r.add(L,V),k=r.add(H,G);de=r.mul(de,k),k=r.add(_e,oe),de=r.sub(de,k),k=r.add(L,W);let X=r.add(H,z);return k=r.mul(k,X),X=r.add(_e,ne),k=r.sub(k,X),X=r.add(V,W),Z=r.add(G,z),X=r.mul(X,Z),Z=r.add(oe,ne),X=r.sub(X,Z),ie=r.mul(fe,k),Z=r.mul(J,ne),ie=r.add(Z,ie),Z=r.sub(oe,ie),ie=r.add(oe,ie),F=r.mul(Z,ie),oe=r.add(_e,_e),oe=r.add(oe,_e),ne=r.mul(fe,ne),k=r.mul(J,k),oe=r.add(oe,ne),ne=r.sub(_e,ne),ne=r.mul(fe,ne),k=r.add(k,ne),_e=r.mul(oe,k),F=r.add(F,_e),_e=r.mul(X,k),Z=r.mul(de,Z),Z=r.sub(Z,_e),_e=r.mul(de,oe),ie=r.mul(X,ie),ie=r.add(ie,_e),new C(Z,F,ie)}subtract(N){return this.add(N.negate())}is0(){return this.equals(C.ZERO)}multiply(N){const{endo:L}=e;if(!i.isValidNot0(N))throw new Error("invalid scalar: out of range");let V,W;const H=G=>K.cached(this,G,z=>Gh(C,z));if(L){const{k1neg:G,k1:z,k2neg:Z,k2:F}=x(N),{p:ie,f:fe}=H(z),{p:J,f:_e}=H(F);W=fe.add(_e),V=O(L.beta,ie,J,G,Z)}else{const{p:G,f:z}=H(N);V=G,W=z}return Gh(C,[V,W])[0]}multiplyUnsafe(N){const{endo:L}=e,V=this;if(!i.isValid(N))throw new Error("invalid scalar: out of range");if(N===lo||V.is0())return C.ZERO;if(N===Gc)return V;if(K.hasCache(this))return this.multiply(N);if(L){const{k1neg:W,k1:H,k2neg:G,k2:z}=x(N),{p1:Z,p2:F}=EV(C,V,H,z);return O(L.beta,Z,F,W,G)}else return K.unsafe(V,N)}toAffine(N){return $(this,N)}isTorsionFree(){const{isTorsionFree:N}=e;return o===Gc?!0:N?N(C,this):K.unsafe(this,a).is0()}clearCofactor(){const{clearCofactor:N}=e;return o===Gc?this:N?N(C,this):this.multiplyUnsafe(o)}isSmallOrder(){return this.multiplyUnsafe(o).is0()}toBytes(N=!0){return Ml(N,"isCompressed"),this.assertValidity(),g(C,this,N)}toHex(N=!0){return Zf(this.toBytes(N))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}};v(C,"BASE",new C(s.Gx,s.Gy,r.ONE)),v(C,"ZERO",new C(r.ZERO,r.ONE,r.ZERO)),v(C,"Fp",r),v(C,"Fn",i);let P=C;const M=i.BITS,K=new bN(P,e.endo?Math.ceil(M/2):M);return P.BASE.precompute(8),P}function CN(n){return Uint8Array.of(n?2:3)}function kN(n,e){return{secretKey:e.BYTES,publicKey:1+n.BYTES,publicKeyUncompressed:1+2*n.BYTES,publicKeyHasPrefix:!0,signature:2*e.BYTES}}function oG(n,e={}){const{Fn:t}=n,r=e.randomBytes||jy,i=Object.assign(kN(n.Fp,t),{seed:gN(t.ORDER)});function s(g){try{const m=t.fromBytes(g);return t.isValidNot0(m)}catch{return!1}}function o(g,m){const{publicKey:E,publicKeyUncompressed:y}=i;try{const S=g.length;return m===!0&&S!==E||m===!1&&S!==y?!1:!!n.fromBytes(g)}catch{return!1}}function a(g=r(i.seed)){return _V(jt(g,i.seed,"seed"),t.ORDER)}function l(g,m=!0){return n.BASE.multiply(t.fromBytes(g)).toBytes(m)}function c(g){const{secretKey:m,publicKey:E,publicKeyUncompressed:y}=i;if(!Fy(g)||"_lengths"in t&&t._lengths||m===E)return;const S=jt(g,void 0,"key").length;return S===E||S===y}function h(g,m,E=!0){if(c(g)===!0)throw new Error("first arg must be private key");if(c(m)===!1)throw new Error("second arg must be public key");const y=t.fromBytes(g);return n.fromBytes(m).multiply(y).toBytes(E)}const d={isValidSecretKey:s,isValidPublicKey:o,randomSecretKey:a},p=vN(a,l);return Object.freeze({getPublicKey:l,getSharedSecret:h,keygen:p,Point:n,utils:d,lengths:i})}function aG(n,e,t={}){XL(e),Qf(t,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"}),t=Object.assign({},t);const r=t.randomBytes||jy,i=t.hmac||((N,L)=>IN(e,N,L)),{Fp:s,Fn:o}=n,{ORDER:a,BITS:l}=o,{keygen:c,getPublicKey:h,getSharedSecret:d,utils:p,lengths:g}=oG(n,t),m={prehash:!0,lowS:typeof t.lowS=="boolean"?t.lowS:!0,format:"compact",extraEntropy:!1},E=a*TN<s.ORDER;function y(N){const L=a>>Gc;return N>L}function S(N,L){if(!o.isValidNot0(L))throw new Error(`invalid signature ${N}: out of range 1..Point.Fn.ORDER`);return L}function b(){if(E)throw new Error('"recovered" sig type is not supported for cofactor >2 curves')}function _(N,L){P1(L);const V=g.signature,W=L==="compact"?V:L==="recovered"?V+1:void 0;return jt(N,W)}class I{constructor(L,V,W){v(this,"r");v(this,"s");v(this,"recovery");if(this.r=S("r",L),this.s=S("s",V),W!=null){if(b(),![0,1,2,3].includes(W))throw new Error("invalid recovery id");this.recovery=W}Object.freeze(this)}static fromBytes(L,V=m.format){_(L,V);let W;if(V==="der"){const{r:Z,s:F}=na.toSig(jt(L));return new I(Z,F)}V==="recovered"&&(W=L[0],V="compact",L=L.subarray(1));const H=g.signature/2,G=L.subarray(0,H),z=L.subarray(H,H*2);return new I(o.fromBytes(G),o.fromBytes(z),W)}static fromHex(L,V){return this.fromBytes(yf(L),V)}assertRecovery(){const{recovery:L}=this;if(L==null)throw new Error("invalid recovery id: must be present");return L}addRecoveryBit(L){return new I(this.r,this.s,L)}recoverPublicKey(L){const{r:V,s:W}=this,H=this.assertRecovery(),G=H===2||H===3?V+a:V;if(!s.isValid(G))throw new Error("invalid recovery id: sig.r+curve.n != R.x");const z=s.toBytes(G),Z=n.fromBytes(Is(CN((H&1)===0),z)),F=o.inv(G),ie=$(jt(L,void 0,"msgHash")),fe=o.create(-ie*F),J=o.create(W*F),_e=n.BASE.multiplyUnsafe(fe).add(Z.multiplyUnsafe(J));if(_e.is0())throw new Error("invalid recovery: point at infinify");return _e.assertValidity(),_e}hasHighS(){return y(this.s)}toBytes(L=m.format){if(P1(L),L==="der")return yf(na.hexFromSig(this));const{r:V,s:W}=this,H=o.toBytes(V),G=o.toBytes(W);return L==="recovered"?(b(),Is(Uint8Array.of(this.assertRecovery()),H,G)):Is(H,G)}toHex(L){return Zf(this.toBytes(L))}}const x=t.bits2int||function(L){if(L.length>8192)throw new Error("input is too large");const V=qy(L),W=L.length*8-l;return W>0?V>>BigInt(W):V},$=t.bits2int_modN||function(L){return o.create(x(L))},U=OS(l);function O(N){return T1("num < 2^"+l,N,lo,U),o.toBytes(N)}function P(N,L){return jt(N,void 0,"message"),L?jt(e(N),void 0,"prehashed message"):N}function M(N,L,V){const{lowS:W,prehash:H,extraEntropy:G}=Z0(V,m);N=P(N,H);const z=$(N),Z=o.fromBytes(L);if(!o.isValidNot0(Z))throw new Error("invalid private key");const F=[O(Z),O(z)];if(G!=null&&G!==!1){const _e=G===!0?r(g.secretKey):G;F.push(jt(_e,void 0,"extraEntropy"))}const ie=Is(...F),fe=z;function J(_e){const oe=x(_e);if(!o.isValidNot0(oe))return;const ne=o.inv(oe),de=n.BASE.multiply(oe).toAffine(),k=o.create(de.x);if(k===lo)return;const X=o.create(ne*o.create(fe+k*Z));if(X===lo)return;let ee=(de.x===k?0:2)|Number(de.y&Gc),me=X;return W&&y(X)&&(me=o.neg(X),ee^=1),new I(k,me,E?void 0:ee)}return{seed:ie,k2sig:J}}function K(N,L,V={}){const{seed:W,k2sig:H}=M(N,L,V);return cV(e.outputLen,o.BYTES,i)(W,H).toBytes(V.format)}function C(N,L,V,W={}){const{lowS:H,prehash:G,format:z}=Z0(W,m);if(V=jt(V,void 0,"publicKey"),L=P(L,G),!Fy(N)){const Z=N instanceof I?", use sig.toBytes()":"";throw new Error("verify expects Uint8Array signature"+Z)}_(N,z);try{const Z=I.fromBytes(N,z),F=n.fromBytes(V);if(H&&Z.hasHighS())return!1;const{r:ie,s:fe}=Z,J=$(L),_e=o.inv(fe),oe=o.create(J*_e),ne=o.create(ie*_e),de=n.BASE.multiplyUnsafe(oe).add(F.multiplyUnsafe(ne));return de.is0()?!1:o.create(de.x)===ie}catch{return!1}}function B(N,L,V={}){const{prehash:W}=Z0(V,m);return L=P(L,W),I.fromBytes(N,"recovered").recoverPublicKey(L).toBytes()}return Object.freeze({keygen:c,getPublicKey:h,getSharedSecret:d,utils:p,lengths:g,Point:n,sign:K,verify:C,recoverPublicKey:B,Signature:I,hash:e})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const US={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),n:BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),h:BigInt(1),a:BigInt(0),b:BigInt(7),Gx:BigInt("0x79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798"),Gy:BigInt("0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8")},lG={beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),basises:[[BigInt("0x3086d221a7d46bcde86c90e49284eb15"),-BigInt("0xe4437ed6010e88286f547fa90abfe4c3")],[BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),BigInt("0x3086d221a7d46bcde86c90e49284eb15")]]},OC=BigInt(2);function cG(n){const e=US.p,t=BigInt(3),r=BigInt(6),i=BigInt(11),s=BigInt(22),o=BigInt(23),a=BigInt(44),l=BigInt(88),c=n*n*n%e,h=c*c*n%e,d=Pr(h,t,e)*h%e,p=Pr(d,t,e)*h%e,g=Pr(p,OC,e)*c%e,m=Pr(g,i,e)*g%e,E=Pr(m,s,e)*m%e,y=Pr(E,a,e)*E%e,S=Pr(y,l,e)*y%e,b=Pr(S,a,e)*E%e,_=Pr(b,t,e)*h%e,I=Pr(_,o,e)*m%e,x=Pr(I,r,e)*c%e,$=Pr(x,OC,e);if(!R1.eql(R1.sqr($),n))throw new Error("Cannot find square root");return $}const R1=Hy(US.p,{sqrt:cG}),uG=sG(US,{Fp:R1,endo:lG}),Nm=aG(uG,rN);function hG(n,e,t,r){var s;const i=hS.digest(t instanceof Uint8Array?t:t.subarray());if($S(i))return i.then(({digest:o})=>{var a;return(a=r==null?void 0:r.signal)==null||a.throwIfAborted(),Nm.verify(e,o,n,{prehash:!1,format:"der"})}).catch(o=>{throw o.name==="AbortError"?o:new kC(String(o))});try{return(s=r==null?void 0:r.signal)==null||s.throwIfAborted(),Nm.verify(e,i.digest,n,{prehash:!1,format:"der"})}catch(o){throw new kC(String(o))}}let fG=class{constructor(e){v(this,"type","secp256k1");v(this,"raw");v(this,"_key");this._key=pG(e),this.raw=dG(this._key)}toMultihash(){return Ia.digest(ho(this))}toCID(){return zt.createV1(114,this.toMultihash())}toString(){return _r.encode(this.toMultihash().bytes).substring(1)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:Or(this.raw,e.raw)}verify(e,t,r){return hG(this._key,t,e,r)}};function PN(n){return new fG(n)}function dG(n){return Nm.Point.fromBytes(n).toBytes()}function pG(n){try{return Nm.Point.fromBytes(n),n}catch(e){throw new TS(String(e))}}async function gG(n,e){return KV()}function Ea(n,e){const{Type:t,Data:r}=Eu.decode(n),i=r??new Uint8Array;switch(t){case cn.RSA:return JV(i,e);case cn.Ed25519:return AN(i);case cn.secp256k1:return PN(i);case cn.ECDSA:return YL(i);default:throw new CS}}function mG(n){const{Type:e,Data:t}=Eu.decode(n.digest),r=t??new Uint8Array;switch(e){case cn.Ed25519:return AN(r);case cn.secp256k1:return PN(r);case cn.ECDSA:return YL(r);default:throw new CS}}function ho(n){return Eu.encode({Type:cn[n.type],Data:n.raw})}const RN=Symbol.for("nodejs.util.inspect.custom"),yG=114;var kR;let FS=class{constructor(e){v(this,"type");v(this,"multihash");v(this,"publicKey");v(this,"string");v(this,kR,!0);this.type=e.type,this.multihash=e.multihash,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return`PeerId(${this.toString()})`}toString(){return this.string==null&&(this.string=_r.encode(this.multihash.bytes).slice(1)),this.string}toMultihash(){return this.multihash}toCID(){return zt.createV1(yG,this.multihash)}toJSON(){return this.toString()}equals(e){var t;if(e==null)return!1;if(e instanceof Uint8Array)return Or(this.multihash.bytes,e);if(typeof e=="string")return this.toString()===e;if(((t=e==null?void 0:e.toMultihash())==null?void 0:t.bytes)!=null)return Or(this.multihash.bytes,e.toMultihash().bytes);throw new Error("not valid Id")}[(kR=Dy,RN)](){return`PeerId(${this.toString()})`}},ON=class extends FS{constructor(t){super({...t,type:"RSA"});v(this,"type","RSA");v(this,"publicKey");this.publicKey=t.publicKey}},LN=class extends FS{constructor(t){super({...t,type:"Ed25519"});v(this,"type","Ed25519");v(this,"publicKey");this.publicKey=t.publicKey}},NN=class extends FS{constructor(t){super({...t,type:"secp256k1"});v(this,"type","secp256k1");v(this,"publicKey");this.publicKey=t.publicKey}};const bG=2336;var PR,RR;class DN{constructor(e){v(this,"type","url");v(this,"multihash");v(this,"publicKey");v(this,"url");v(this,PR,!0);this.url=e.toString(),this.multihash=Ia.digest(at(this.url))}[(RR=RN,PR=Dy,RR)](){return`PeerId(${this.url})`}toString(){return this.toCID().toString()}toMultihash(){return this.multihash}toCID(){return zt.createV1(bG,this.toMultihash())}toJSON(){return this.toString()}equals(e){return e==null?!1:(e instanceof Uint8Array&&(e=mt(e)),e.toString()===this.toString())}}const wG=114,LC=2336;function Cs(n,e){let t;if(n.charAt(0)==="1"||n.charAt(0)==="Q")t=Ry(_r.decode(`z${n}`));else{if(n.startsWith("k51qzi5uqu5")||n.startsWith("kzwfwjn5ji4")||n.startsWith("k2k4r8")||n.startsWith("bafz"))return Jf(zt.parse(n));throw new rr('Please pass a multibase decoder for strings that do not start with "1" or "Q"')}return Wy(t)}function wf(n){if(n.type==="Ed25519")return new LN({multihash:n.toCID().multihash,publicKey:n});if(n.type==="secp256k1")return new NN({multihash:n.toCID().multihash,publicKey:n});if(n.type==="RSA")return new ON({multihash:n.toCID().multihash,publicKey:n});throw new BL}function vG(n){return wf(n.publicKey)}function Wy(n){if(EG(n))return new ON({multihash:n});if(_G(n))try{const e=mG(n);if(e.type==="Ed25519")return new LN({multihash:n,publicKey:e});if(e.type==="secp256k1")return new NN({multihash:n,publicKey:e})}catch{const t=mt(n.digest);return new DN(new URL(t))}throw new DL("Supplied PeerID Multihash is invalid")}function Jf(n){if((n==null?void 0:n.multihash)==null||n.version==null||n.version===1&&n.code!==wG&&n.code!==LC)throw new NL("Supplied PeerID CID is invalid");if(n.code===LC){const e=mt(n.multihash.digest);return new DN(new URL(e))}return Wy(n.multihash)}function _G(n){return n.code===Ia.code}function EG(n){return n.code===hS.code}class _i extends Error{constructor(){super(...arguments);v(this,"name","InvalidMultiaddrError")}}v(_i,"name","InvalidMultiaddrError");class Su extends Error{constructor(){super(...arguments);v(this,"name","ValidationError")}}v(Su,"name","ValidationError");class $N extends Error{constructor(){super(...arguments);v(this,"name","InvalidParametersError")}}v($N,"name","InvalidParametersError");class MN extends Error{constructor(){super(...arguments);v(this,"name","UnknownProtocolError")}}v(MN,"name","UnknownProtocolError");class SG{constructor(){v(this,"index",0);v(this,"input","")}new(e){return this.index=0,this.input=e,this}readAtomically(e){const t=this.index,r=e();return r===void 0&&(this.index=t),r}parseWith(e){const t=e();if(this.index===this.input.length)return t}peekChar(){if(!(this.index>=this.input.length))return this.input[this.index]}readChar(){if(!(this.index>=this.input.length))return this.input[this.index++]}readGivenChar(e){return this.readAtomically(()=>{const t=this.readChar();if(t===e)return t})}readSeparator(e,t,r){return this.readAtomically(()=>{if(!(t>0&&this.readGivenChar(e)===void 0))return r()})}readNumber(e,t,r,i){return this.readAtomically(()=>{let s=0,o=0;const a=this.peekChar();if(a===void 0)return;const l=a==="0",c=2**(8*i)-1;for(;;){const h=this.readAtomically(()=>{const d=this.readChar();if(d===void 0)return;const p=Number.parseInt(d,e);if(!Number.isNaN(p))return p});if(h===void 0)break;if(s*=e,s+=h,s>c||(o+=1,t!==void 0&&o>t))return}if(o!==0)return!r&&l&&o>1?void 0:s})}readIPv4Addr(){return this.readAtomically(()=>{const e=new Uint8Array(4);for(let t=0;t<e.length;t++){const r=this.readSeparator(".",t,()=>this.readNumber(10,3,!1,1));if(r===void 0)return;e[t]=r}return e})}readIPv6Addr(){const e=t=>{for(let r=0;r<t.length/2;r++){const i=r*2;if(r<t.length-3){const o=this.readSeparator(":",r,()=>this.readIPv4Addr());if(o!==void 0)return t[i]=o[0],t[i+1]=o[1],t[i+2]=o[2],t[i+3]=o[3],[i+4,!0]}const s=this.readSeparator(":",r,()=>this.readNumber(16,4,!0,2));if(s===void 0)return[i,!1];t[i]=s>>8,t[i+1]=s&255}return[t.length,!1]};return this.readAtomically(()=>{const t=new Uint8Array(16),[r,i]=e(t);if(r===16)return t;if(i||this.readGivenChar(":")===void 0||this.readGivenChar(":")===void 0)return;const s=new Uint8Array(14),o=16-(r+2),[a]=e(s.subarray(0,o));return t.set(s.subarray(0,a),16-a),t})}readIPAddr(){return this.readIPv4Addr()??this.readIPv6Addr()}}const BN=45,AG=15,Au=new SG;function UN(n){if(!(n.length>AG))return Au.new(n).parseWith(()=>Au.readIPv4Addr())}function FN(n){if(n.includes("%")&&(n=n.split("%")[0]),!(n.length>BN))return Au.new(n).parseWith(()=>Au.readIPv6Addr())}function O1(n,e=!1){if(n.includes("%")&&(n=n.split("%")[0]),n.length>BN)return;const t=Au.new(n).parseWith(()=>Au.readIPAddr());if(t)return e&&t.length===4?Uint8Array.from([0,0,0,0,0,0,0,0,0,0,255,255,t[0],t[1],t[2],t[3]]):t}function Ul(n){return!!UN(n)}function jS(n){return!!FN(n)}const xu=4,Dm=6,L1=273,xG=33,ls=41,zu=42,IG=43,zy=53,Ky=54,ed=55,Vy=56,TG=132,CG=301,kG=302,PG=400,jN=421,RG=444,OG=445,LG=446,NG=447,qN=448,DG=449,$G=454,MG=460,BG=461,UG=465,FG=466,jG=480,qG=481,HG=443,WG=477,zG=478,KG=479,VG=277,GG=275,YG=276,XG=280,ZG=281,HN=290,QG=777;function NC(n){return e=>mt(e,n)}function DC(n){return e=>at(e,n)}function Oh(n){return new DataView(n.buffer).getUint16(n.byteOffset).toString()}function qc(n){const e=new ArrayBuffer(2);return new DataView(e).setUint16(0,typeof n=="string"?parseInt(n):n),new Uint8Array(e)}function JG(n){const e=n.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==16)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion address.`);const t=at(e[0],"base32"),r=parseInt(e[1],10);if(r<1||r>65536)throw new Error("Port number is not in range(1, 65536)");const i=qc(r);return Dl([t,i],t.length+i.length)}function eY(n){const e=n.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==56)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion3 address.`);const t=ba.decode(`b${e[0]}`),r=parseInt(e[1],10);if(r<1||r>65536)throw new Error("Port number is not in range(1, 65536)");const i=qc(r);return Dl([t,i],t.length+i.length)}function $C(n){const e=n.subarray(0,n.length-2),t=n.subarray(n.length-2),r=mt(e,"base32"),i=Oh(t);return`${r}:${i}`}const WN=function(n){n=n.toString().trim();const e=new Uint8Array(4);return n.split(/\./g).forEach((t,r)=>{const i=parseInt(t,10);if(isNaN(i)||i<0||i>255)throw new _i("Invalid byte value in IP address");e[r]=i}),e},tY=function(n){let e=0;n=n.toString().trim();const t=n.split(":",8);let r;for(r=0;r<t.length;r++){const s=Ul(t[r]);let o;s&&(o=WN(t[r]),t[r]=mt(o.subarray(0,2),"base16")),o!=null&&++r<8&&t.splice(r,0,mt(o.subarray(2,4),"base16"))}if(t[0]==="")for(;t.length<8;)t.unshift("0");else if(t[t.length-1]==="")for(;t.length<8;)t.push("0");else if(t.length<8){for(r=0;r<t.length&&t[r]!=="";r++);const s=[r,1];for(r=9-t.length;r>0;r--)s.push("0");t.splice.apply(t,s)}const i=new Uint8Array(e+16);for(r=0;r<t.length;r++){t[r]===""&&(t[r]="0");const s=parseInt(t[r],16);if(isNaN(s)||s<0||s>65535)throw new _i("Invalid byte value in IP address");i[e++]=s>>8&255,i[e++]=s&255}return i},rY=function(n){if(n.byteLength!==4)throw new _i("IPv4 address was incorrect length");const e=[];for(let t=0;t<n.byteLength;t++)e.push(n[t]);return e.join(".")},nY=function(n){if(n.byteLength!==16)throw new _i("IPv6 address was incorrect length");const e=[];for(let r=0;r<n.byteLength;r+=2){const i=n[r],s=n[r+1],o=`${i.toString(16).padStart(2,"0")}${s.toString(16).padStart(2,"0")}`;e.push(o)}const t=e.join(":");try{const r=new URL(`http://[${t}]`);return r.hostname.substring(1,r.hostname.length-1)}catch{throw new _i(`Invalid IPv6 address "${t}"`)}};function iY(n){try{const e=new URL(`http://[${n}]`);return e.hostname.substring(1,e.hostname.length-1)}catch{throw new _i(`Invalid IPv6 address "${n}"`)}}const Q0=Object.values(m1).map(n=>n.decoder),sY=function(){let n=Q0[0].or(Q0[1]);return Q0.slice(2).forEach(e=>n=n.or(e)),n}();function oY(n){return sY.decode(n)}function aY(n){return e=>n.encoder.encode(e)}function lY(n){if(parseInt(n).toString()!==n)throw new Su("Value must be an integer")}function cY(n){if(n<0)throw new Su("Value must be a positive integer, or zero")}function uY(n){return e=>{if(e>n)throw new Su(`Value must be smaller than or equal to ${n}`)}}function hY(...n){return e=>{for(const t of n)t(e)}}const pp=hY(lY,cY,uY(65535)),xn=-1;class fY{constructor(){v(this,"protocolsByCode",new Map);v(this,"protocolsByName",new Map)}getProtocol(e){let t;if(typeof e=="string"?t=this.protocolsByName.get(e):t=this.protocolsByCode.get(e),t==null)throw new MN(`Protocol ${e} was unknown`);return t}addProtocol(e){var t;this.protocolsByCode.set(e.code,e),this.protocolsByName.set(e.name,e),(t=e.aliases)==null||t.forEach(r=>{this.protocolsByName.set(r,e)})}removeProtocol(e){var r;const t=this.protocolsByCode.get(e);t!=null&&(this.protocolsByCode.delete(t.code),this.protocolsByName.delete(t.name),(r=t.aliases)==null||r.forEach(i=>{this.protocolsByName.delete(i)}))}}const ji=new fY,dY=[{code:xu,name:"ip4",size:32,valueToBytes:WN,bytesToValue:rY,validate:n=>{if(!Ul(n))throw new Su(`Invalid IPv4 address "${n}"`)}},{code:Dm,name:"tcp",size:16,valueToBytes:qc,bytesToValue:Oh,validate:pp},{code:L1,name:"udp",size:16,valueToBytes:qc,bytesToValue:Oh,validate:pp},{code:xG,name:"dccp",size:16,valueToBytes:qc,bytesToValue:Oh,validate:pp},{code:ls,name:"ip6",size:128,valueToBytes:tY,bytesToValue:nY,stringToValue:iY,validate:n=>{if(!jS(n))throw new Su(`Invalid IPv6 address "${n}"`)}},{code:zu,name:"ip6zone",size:xn},{code:IG,name:"ipcidr",size:8,bytesToValue:NC("base10"),valueToBytes:DC("base10")},{code:zy,name:"dns",size:xn,resolvable:!0},{code:Ky,name:"dns4",size:xn,resolvable:!0},{code:ed,name:"dns6",size:xn,resolvable:!0},{code:Vy,name:"dnsaddr",size:xn,resolvable:!0},{code:TG,name:"sctp",size:16,valueToBytes:qc,bytesToValue:Oh,validate:pp},{code:CG,name:"udt"},{code:kG,name:"utp"},{code:PG,name:"unix",size:xn,path:!0,stringToValue:n=>decodeURIComponent(n),valueToString:n=>encodeURIComponent(n)},{code:jN,name:"p2p",aliases:["ipfs"],size:xn,bytesToValue:NC("base58btc"),valueToBytes:n=>n.startsWith("Q")||n.startsWith("1")?DC("base58btc")(n):zt.parse(n).multihash.bytes},{code:RG,name:"onion",size:96,bytesToValue:$C,valueToBytes:JG},{code:OG,name:"onion3",size:296,bytesToValue:$C,valueToBytes:eY},{code:LG,name:"garlic64",size:xn},{code:NG,name:"garlic32",size:xn},{code:qN,name:"tls"},{code:DG,name:"sni",size:xn},{code:$G,name:"noise"},{code:MG,name:"quic"},{code:BG,name:"quic-v1"},{code:UG,name:"webtransport"},{code:FG,name:"certhash",size:xn,bytesToValue:aY(cS),valueToBytes:oY},{code:jG,name:"http"},{code:qG,name:"http-path",size:xn,stringToValue:n=>`/${decodeURIComponent(n)}`,valueToString:n=>encodeURIComponent(n.substring(1))},{code:HG,name:"https"},{code:WG,name:"ws"},{code:zG,name:"wss"},{code:KG,name:"p2p-websocket-star"},{code:VG,name:"p2p-stardust"},{code:GG,name:"p2p-webrtc-star"},{code:YG,name:"p2p-webrtc-direct"},{code:XG,name:"webrtc-direct"},{code:ZG,name:"webrtc"},{code:HN,name:"p2p-circuit"},{code:QG,name:"memory",size:xn}];dY.forEach(n=>{ji.addProtocol(n)});function pY(n){var r;const e=[];let t=0;for(;t<n.length;){const i=Wf(n,t),s=ji.getProtocol(i),o=un(i),a=bY(s,n,t+o);let l=0;a>0&&s.size===xn&&(l=un(a));const c=o+l+a,h={code:i,name:s.name,bytes:n.subarray(t,t+c)};if(a>0){const d=t+o+l,p=n.subarray(d,d+a);h.value=((r=s.bytesToValue)==null?void 0:r.call(s,p))??mt(p)}e.push(h),t+=c}return e}function gY(n){var r;let e=0;const t=[];for(const i of n){if(i.bytes==null){const s=ji.getProtocol(i.code),o=un(i.code);let a,l=0,c=0;i.value!=null&&(a=((r=s.valueToBytes)==null?void 0:r.call(s,i.value))??at(i.value),l=a.byteLength,s.size===xn&&(c=un(l)));const h=new Uint8Array(o+c+l);let d=0;Kg(i.code,h,d),d+=o,a!=null&&(s.size===xn&&(Kg(l,h,d),d+=c),h.set(a,d)),i.bytes=h}t.push(i.bytes),e+=i.bytes.byteLength}return Dl(t,e)}function mY(n){var s;if(n.charAt(0)!=="/")throw new _i('String multiaddr must start with "/"');const e=[];let t="protocol",r="",i="";for(let o=1;o<n.length;o++){const a=n.charAt(o);a!=="/"&&(t==="protocol"?i+=n.charAt(o):r+=n.charAt(o));const l=o===n.length-1;if(a==="/"||l){const c=ji.getProtocol(i);if(t==="protocol"){if(c.size==null||c.size===0){e.push({code:c.code,name:c.name}),r="",i="",t="protocol";continue}else if(l)throw new _i(`Component ${i} was missing value`);t="value"}else if(t==="value"){const h={code:c.code,name:c.name};if(c.size!=null&&c.size!==0){if(r==="")throw new _i(`Component ${i} was missing value`);h.value=((s=c.stringToValue)==null?void 0:s.call(c,r))??r}e.push(h),r="",i="",t="protocol"}}}if(i!==""&&r!=="")throw new _i("Incomplete multiaddr");return e}function yY(n){return`/${n.flatMap(e=>{var r;if(e.value==null)return e.name;const t=ji.getProtocol(e.code);if(t==null)throw new _i(`Unknown protocol code ${e.code}`);return[e.name,((r=t.valueToString)==null?void 0:r.call(t,e.value))??e.value]}).join("/")}`}function bY(n,e,t){return n.size==null||n.size===0?0:n.size>0?n.size/8:Wf(e,t)}const wY=Symbol.for("nodejs.util.inspect.custom"),zN=Symbol.for("@multiformats/multiaddr"),vY=[zy,Ky,ed,Vy];class _Y extends Error{constructor(e="No available resolver"){super(e),this.name="NoAvailableResolverError"}}function EY(n){if(n==null&&(n="/"),Gy(n))return n.getComponents();if(n instanceof Uint8Array)return pY(n);if(typeof n=="string")return n=n.replace(/\/(\/)+/,"/").replace(/(\/)+$/,""),n===""&&(n="/"),mY(n);if(Array.isArray(n))return n;throw new _i("Must be a string, Uint8Array, Component[], or another Multiaddr")}var OR,mr,iu,su;const Wc=class Wc{constructor(e="/",t={}){v(this,OR,!0);Qe(this,mr);Qe(this,iu);Qe(this,su);qe(this,mr,EY(e)),t.validate!==!1&&SY(this)}get bytes(){return q(this,su)==null&&qe(this,su,gY(q(this,mr))),q(this,su)}toString(){return q(this,iu)==null&&qe(this,iu,yY(q(this,mr))),q(this,iu)}toJSON(){return this.toString()}toOptions(){let e,t,r,i,s="";for(const{code:a,name:l,value:c}of q(this,mr))a===zu&&(s=`%${c??""}`),vY.includes(a)&&(t="tcp",i=443,r=`${c??""}${s}`,e=a===ed?6:4),(a===Dm||a===L1)&&(t=l==="tcp"?"tcp":"udp",i=parseInt(c??"")),(a===xu||a===ls)&&(t="tcp",r=`${c??""}${s}`,e=a===ls?6:4);if(e==null||t==null||r==null||i==null)throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6, dnsaddr}/{address}/{tcp, udp}/{port}".');return{family:e,host:r,transport:t,port:i}}getComponents(){return[...q(this,mr)]}protos(){return q(this,mr).map(({code:e,value:t})=>{const r=ji.getProtocol(e);return{code:e,size:r.size??0,name:r.name,resolvable:!!r.resolvable,path:!!r.path}})}protoCodes(){return q(this,mr).map(({code:e})=>e)}protoNames(){return q(this,mr).map(({name:e})=>e)}tuples(){return q(this,mr).map(({code:e,value:t})=>{var s;if(t==null)return[e];const r=ji.getProtocol(e),i=[e];return t!=null&&i.push(((s=r.valueToBytes)==null?void 0:s.call(r,t))??at(t)),i})}stringTuples(){return q(this,mr).map(({code:e,value:t})=>t==null?[e]:[e,t])}encapsulate(e){const t=new Wc(e);return new Wc([...q(this,mr),...t.getComponents()],{validate:!1})}decapsulate(e){const t=e.toString(),r=this.toString(),i=r.lastIndexOf(t);if(i<0)throw new $N(`Address ${this.toString()} does not contain subaddress: ${e.toString()}`);return new Wc(r.slice(0,i),{validate:!1})}decapsulateCode(e){let t;for(let r=q(this,mr).length-1;r>-1;r--)if(q(this,mr)[r].code===e){t=r;break}return new Wc(q(this,mr).slice(0,t),{validate:!1})}getPeerId(){try{let e=[];q(this,mr).forEach(({code:r,value:i})=>{r===jN&&e.push([r,i]),r===HN&&(e=[])});const t=e.pop();if((t==null?void 0:t[1])!=null){const r=t[1];return r[0]==="Q"||r[0]==="1"?mt(_r.decode(`z${r}`),"base58btc"):mt(zt.parse(r).multihash.bytes,"base58btc")}return null}catch{return null}}getPath(){for(const e of q(this,mr))if(ji.getProtocol(e.code).path)return e.value??null;return null}equals(e){return Or(this.bytes,e.bytes)}async resolve(e){const t=this.protos().find(s=>s.resolvable);if(t==null)return[this];const r=qS.get(t.name);if(r==null)throw new _Y(`no available resolver for ${t.name}`);return(await r(this,e)).map(s=>Nt(s))}nodeAddress(){const e=this.toOptions();if(e.transport!=="tcp"&&e.transport!=="udp")throw new Error(`multiaddr must have a valid format - no protocol with name: "${e.transport}". Must have a valid transport protocol: "{tcp, udp}"`);return{family:e.family,address:e.host,port:e.port}}isThinWaistAddress(){return!(q(this,mr).length!==2||q(this,mr)[0].code!==xu&&q(this,mr)[0].code!==ls||q(this,mr)[1].code!==Dm&&q(this,mr)[1].code!==L1)}[(OR=zN,wY)](){return`Multiaddr(${this.toString()})`}};mr=new WeakMap,iu=new WeakMap,su=new WeakMap;let N1=Wc;function SY(n){n.getComponents().forEach(e=>{var r;const t=ji.getProtocol(e.code);e.value!=null&&((r=t.validate)==null||r.call(t,e.value))})}function AY(n,e,t){let r=0;for(const i of n)if(!(r<e)){if(r>t)break;if(i!==255)return!1;r++}return!0}function xY(n,e,t,r){let i=0;for(const s of n)if(!(i<t)){if(i>r)break;if(s!==e[i])return!1;i++}return!0}function IY(n){switch(n.length){case vf:return n.join(".");case _f:{const e=[];for(let t=0;t<n.length;t++)t%2===0&&e.push(n[t].toString(16).padStart(2,"0")+n[t+1].toString(16).padStart(2,"0"));return e.join(":")}default:throw new Error("Invalid ip length")}}function TY(n){let e=0;for(let[t,r]of n.entries()){if(r===255){e+=8;continue}for(;r&128;)e++,r=r<<1;if(r&128)return-1;for(let i=t+1;i<n.length;i++)if(n[i]!=0)return-1;break}return e}function CY(n){let e="0x";for(const t of n)e+=(t>>4).toString(16)+(t&15).toString(16);return e}const vf=4,_f=16,kY=new Uint8Array([0,0,0,0,0,0,0,0,0,0,255,255]);function KN(n,e){e.length===_f&&n.length===vf&&AY(e,0,11)&&(e=e.slice(12)),e.length===vf&&n.length===_f&&xY(n,kY,0,11)&&(n=n.slice(12));const t=n.length;if(t!=e.length)throw new Error("Failed to mask ip");const r=new Uint8Array(t);for(let i=0;i<t;i++)r[i]=n[i]&e[i];return r}function PY(n,e){if(typeof e=="string"&&(e=O1(e)),e==null)throw new Error("Invalid ip");if(e.length!==n.network.length)return!1;for(let t=0;t<e.length;t++)if((n.network[t]&n.mask[t])!==(e[t]&n.mask[t]))return!1;return!0}function RY(n){const[e,t]=n.split("/");if(!e||!t)throw new Error("Failed to parse given CIDR: "+n);let r=vf,i=UN(e);if(i==null&&(r=_f,i=FN(e),i==null))throw new Error("Failed to parse given CIDR: "+n);const s=parseInt(t,10);if(Number.isNaN(s)||String(s).length!==t.length||s<0||s>r*8)throw new Error("Failed to parse given CIDR: "+n);const o=VN(s,8*r);return{network:KN(i,o),mask:o}}function VN(n,e){if(e!==8*vf&&e!==8*_f)throw new Error("Invalid CIDR mask");if(n<0||n>e)throw new Error("Invalid CIDR mask");const t=e/8,r=new Uint8Array(t);for(let i=0;i<t;i++){if(n>=8){r[i]=255,n-=8;continue}r[i]=255-(255>>n),n=0}return r}class GN{constructor(e,t){if(t==null)({network:this.network,mask:this.mask}=RY(e));else{const r=O1(e);if(r==null)throw new Error("Failed to parse network");t=String(t);const i=parseInt(t,10);if(Number.isNaN(i)||String(i).length!==t.length||i<0||i>r.length*8){const s=O1(t);if(s==null)throw new Error("Failed to parse mask");this.mask=s}else this.mask=VN(i,8*r.length);this.network=KN(r,this.mask)}}contains(e){return PY({network:this.network,mask:this.mask},e)}toString(){const e=TY(this.mask),t=e!==-1?String(e):CY(this.mask);return IY(this.network)+"/"+t}}function OY(n,e){return new GN(n).contains(e)}function LY(n){let e,t;if(n.getComponents().forEach(r=>{(r.name==="ip4"||r.name==="ip6")&&(t=r.value),r.name==="ipcidr"&&(e=r.value)}),e==null||t==null)throw new Error("Invalid multiaddr");return new GN(t,e)}function $m(n,e){var r;const t=ji.getProtocol(n);return((r=t.bytesToValue)==null?void 0:r.call(t,e))??mt(e,"base16")}function NY(n,e){var r;const t=ji.getProtocol(n);return((r=t.valueToBytes)==null?void 0:r.call(t,e))??at(e,"base16")}const qS=new Map;function Gy(n){return!!(n!=null&&n[zN])}function Nt(n){return new N1(n)}function HS(n){const e=ji.getProtocol(n);return{code:e.code,size:e.size??0,name:e.name,resolvable:!!e.resolvable,path:!!e.path}}const MC=n=>{if(!n)return-1;try{const e=n.metadata.get("ping");return e?Number(uf(e)):-1}catch{return-1}},DY=n=>Cl(n)?n:Nt(n),$Y=n=>Cl(n)?n:Cs(Nt(n).getPeerId()),MY=(n,e)=>{var r,i;const t=((i=(r=n==null?void 0:n.components)==null?void 0:r.transportManager)==null?void 0:i.getTransports())||[];return t.length===0?!1:t.map(s=>s.dialFilter(e)).some(s=>s.length>0)},tr=new Ct("connection-limiter"),BY=5*1e3;class UY{constructor(e){v(this,"libp2p");v(this,"events");v(this,"networkMonitor");v(this,"dialer");v(this,"connectionMonitorInterval",null);v(this,"options");this.libp2p=e.libp2p,this.events=e.events,this.networkMonitor=e.networkMonitor,this.dialer=e.dialer,this.options=e.options,this.onWakuConnectionEvent=this.onWakuConnectionEvent.bind(this),this.onDisconnectedEvent=this.onDisconnectedEvent.bind(this)}start(){this.dialPeersFromStore(),this.options.enableAutoRecovery&&this.connectionMonitorInterval===null&&(this.connectionMonitorInterval=setInterval(()=>void this.maintainConnections(),BY)),this.events.addEventListener(bu.Connection,this.onWakuConnectionEvent),this.libp2p.addEventListener("peer:disconnect",this.onDisconnectedEvent)}stop(){this.events.removeEventListener(bu.Connection,this.onWakuConnectionEvent),this.libp2p.removeEventListener("peer:disconnect",this.onDisconnectedEvent),this.connectionMonitorInterval&&(clearInterval(this.connectionMonitorInterval),this.connectionMonitorInterval=null)}onWakuConnectionEvent(){if(!this.options.enableAutoRecovery){tr.info("Auto recovery is disabled, skipping");return}this.networkMonitor.isBrowserConnected()&&this.dialPeersFromStore()}async maintainConnections(){await this.maintainConnectionsCount(),await this.maintainBootstrapConnections(),await this.maintainTTLConnectedPeers()}async onDisconnectedEvent(){this.libp2p.getConnections().length===0&&(tr.info("No connections, dialing peers from store"),await this.dialPeersFromStore())}async maintainConnectionsCount(){tr.info("Maintaining connections count");const e=this.libp2p.getConnections();if(e.length<=this.options.maxConnections){tr.info(`Node has less than max connections ${this.options.maxConnections}, trying to dial more peers`);const t=await this.getPrioritizedPeers();if(t.length===0){tr.info("No peers to dial, skipping"),await this.triggerBootstrap();return}const r=t.slice(0,this.options.maxConnections-e.length).map(i=>this.dialer.dial(i.id));await Promise.all(r);return}tr.info(`Node has more than max connections ${this.options.maxConnections}, dropping connections`);try{const t=e.filter(i=>!i.tags.includes(E1)).slice(this.options.maxConnections);if(t.length===0){tr.info("No connections to drop, skipping");return}const r=t.map(i=>this.libp2p.hangUp(i.remotePeer));await Promise.all(r),tr.info(`Dropped ${t.length} connections`)}catch(t){tr.error("Unexpected error while maintaining connections",t)}}async maintainBootstrapConnections(){tr.info("Maintaining bootstrap connections");const e=await this.getBootstrapPeers();if(!(e.length<=this.options.maxBootstrapPeers))try{const t=e.slice(this.options.maxBootstrapPeers);tr.info(`Dropping ${t.length} bootstrap connections because node has more than max bootstrap connections ${this.options.maxBootstrapPeers}`);const r=t.map(i=>this.libp2p.hangUp(i.id));await Promise.all(r),tr.info(`Dropped ${t.length} bootstrap connections`)}catch(t){tr.error("Unexpected error while maintaining bootstrap connections",t)}}async maintainTTLConnectedPeers(){tr.info("Maintaining TTL connected peers");const e=this.libp2p.getConnections().map(async t=>{try{await this.libp2p.peerStore.merge(t.remotePeer,{metadata:{ttl:vL(Date.now())}}),tr.info(`TTL updated for connected peer ${t.remotePeer.toString()}`)}catch(r){tr.error("Unexpected error while maintaining TTL connected peer",r)}});await Promise.all(e)}async dialPeersFromStore(){tr.info("Dialing peers from store");try{const e=await this.getPrioritizedPeers();if(e.length===0){tr.info("No peers to dial, skipping"),await this.triggerBootstrap();return}const t=e.map(r=>this.dialer.dial(r.id));tr.info(`Dialing ${e.length} peers from store`),await Promise.all(t),tr.info(`Dialed ${t.length} peers from store`)}catch(e){tr.error("Unexpected error while dialing peer store peers",e)}}async getPrioritizedPeers(){const e=await this.libp2p.peerStore.all(),t=this.libp2p.getConnections();tr.info(`Found ${e.length} peers in store, and found ${t.length} connections`);const r=e.filter(l=>!t.some(c=>c.remotePeer.equals(l.id))&&MY(this.libp2p,l.addresses.map(c=>c.multiaddr))),i=r.filter(l=>l.tags.has(Yn.BOOTSTRAP)),s=r.filter(l=>l.tags.has(Yn.PEER_EXCHANGE)),o=r.filter(l=>l.tags.has(Yn.PEER_CACHE)),a=r.filter(l=>!l.tags.has(Yn.BOOTSTRAP)&&!l.tags.has(Yn.PEER_EXCHANGE)&&!l.tags.has(Yn.PEER_CACHE));return[...i,...s,...o,...a]}async getBootstrapPeers(){return(await Promise.all(this.libp2p.getConnections().map(t=>t.remotePeer).map(t=>this.getPeer(t)))).filter(t=>t&&t.tags.has(Yn.BOOTSTRAP))}async getPeer(e){try{return await this.libp2p.peerStore.get(e)}catch(t){return tr.error(`Failed to get peer ${e}, error: ${t}`),null}}async triggerBootstrap(){tr.info("Triggering bootstrap discovery");const e=Object.values(this.libp2p.components.components).filter(r=>!!r).filter(r=>[`@waku/${Yn.BOOTSTRAP}`,`@waku/${Yn.PEER_CACHE}`].includes(r==null?void 0:r[Symbol.toStringTag]));if(e.length===0){tr.warn("No bootstrap components found to trigger");return}tr.info(`Found ${e.length} bootstrap components, starting them`);const t=e.map(async r=>{var i,s;try{await((i=r==null?void 0:r.stop)==null?void 0:i.call(r)),await((s=r==null?void 0:r.start)==null?void 0:s.call(r)),tr.info("Successfully started bootstrap component")}catch(o){tr.error("Failed to start bootstrap component",o)}});await Promise.all(t)}}const Sn=new Ct("dialer");class FY{constructor(e){v(this,"libp2p");v(this,"shardReader");v(this,"options");v(this,"dialingQueue",[]);v(this,"dialHistory",new Map);v(this,"failedDials",new Map);v(this,"dialingInterval",null);v(this,"isProcessing",!1);v(this,"isImmediateDialing",!1);this.libp2p=e.libp2p,this.shardReader=e.shardReader,this.options=e.options}start(){Sn.info("Starting dialer"),this.dialingInterval||(this.dialingInterval=setInterval(()=>{this.processQueue()},500)),this.dialHistory.clear(),this.failedDials.clear()}stop(){Sn.info("Stopping dialer"),this.dialingInterval&&(clearInterval(this.dialingInterval),this.dialingInterval=null),this.dialHistory.clear(),this.failedDials.clear()}async dial(e){if(await this.shouldSkipPeer(e)){Sn.info(`Skipping peer: ${e}`);return}const r=this.dialingQueue.length===0,i=!this.isProcessing&&!this.isImmediateDialing;r&&i?(this.isImmediateDialing=!0,Sn.info("Dialed peer immediately"),await this.dialPeer(e),this.isImmediateDialing=!1,Sn.info("Released immediate dial lock")):(this.dialingQueue.push(e),Sn.info(`Added peer to dialing queue, queue size: ${this.dialingQueue.length}`))}async processQueue(){if(!(this.dialingQueue.length===0||this.isProcessing)){this.isProcessing=!0;try{const e=this.dialingQueue.slice(0,this.options.maxDialingPeers);this.dialingQueue=this.dialingQueue.slice(e.length),Sn.info(`Processing dial queue: dialing ${e.length} peers, ${this.dialingQueue.length} remaining in queue`),await Promise.all(e.map(t=>this.dialPeer(t)))}finally{this.isProcessing=!1}}}async dialPeer(e){try{Sn.info(`Dialing peer from queue: ${e}`),await this.libp2p.dial(e),this.dialHistory.set(e.toString(),Date.now()),this.failedDials.delete(e.toString()),Sn.info(`Successfully dialed peer from queue: ${e}`)}catch(t){Sn.error(`Error dialing peer ${e}`,t),this.failedDials.set(e.toString(),Date.now())}}async shouldSkipPeer(e){if(this.libp2p.getPeers().some(r=>r.equals(e)))return Sn.info(`Skipping peer ${e} - already connected`),!0;if(this.isRecentlyDialed(e))return Sn.info(`Skipping peer ${e} - already dialed in the last 10 seconds`),!0;if(this.isRecentlyFailed(e))return Sn.info(`Skipping peer ${e} - recently failed to dial`),!0;try{return await this.shardReader.hasShardInfo(e)?await this.shardReader.isPeerOnCluster(e)?!1:(Sn.info(`Skipping peer ${e} - not on same cluster`),!0):(Sn.info(`Skipping peer ${e} - no shard info`),!1)}catch(r){return Sn.error(`Error checking shard info for peer ${e}`,r),!0}}isRecentlyDialed(e){const t=this.dialHistory.get(e.toString());return!!(t&&Date.now()-t<this.options.dialCooldown*1e3)}isRecentlyFailed(e){const t=this.failedDials.get(e.toString());return!!(t&&Date.now()-t<this.options.failedDialCooldown*1e3)}}const Ho=new Ct("discovery-dialer");class jY{constructor(e){v(this,"libp2p");v(this,"dialer");this.libp2p=e.libp2p,this.dialer=e.dialer,this.onPeerDiscovery=this.onPeerDiscovery.bind(this)}start(){this.libp2p.addEventListener("peer:discovery",this.onPeerDiscovery)}stop(){this.libp2p.removeEventListener("peer:discovery",this.onPeerDiscovery)}async onPeerDiscovery(e){const t=e.detail.id;Ho.info(`Discovered new peer: ${t}`);try{await this.updatePeerStore(t,e.detail.multiaddrs),await this.dialer.dial(t)}catch(r){Ho.error(`Error dialing peer ${t}`,r)}}async updatePeerStore(e,t){try{Ho.info(`Updating peer store for ${e}`);const r=await this.getPeer(e);if(!r){Ho.info(`Peer ${e} not found in store, saving`),await this.libp2p.peerStore.save(e,{multiaddrs:t});return}if(t.every(s=>r.addresses.some(o=>o.multiaddr.equals(s)))){Ho.info(`Peer ${e} has same addresses in peer store, skipping`);return}Ho.info(`Merging peer ${e} addresses in peer store`),await this.libp2p.peerStore.merge(e,{multiaddrs:t})}catch(r){Ho.error(`Error updating peer store for ${e}`,r)}}async getPeer(e){try{return await this.libp2p.peerStore.get(e)}catch(t){Ho.error(`Error getting peer info for ${e}`,t);return}}}const BC="/relay-ping/1/ping/null",hi=new Ct("keep-alive");class qY{constructor({options:e,relay:t,networkConfig:r,libp2p:i}){v(this,"relay");v(this,"networkConfig");v(this,"libp2p");v(this,"options");v(this,"pingKeepAliveTimers",new Map);v(this,"relayKeepAliveTimers",new Map);this.options=e,this.relay=t,this.networkConfig=r,this.libp2p=i,this.onPeerConnect=this.onPeerConnect.bind(this),this.onPeerDisconnect=this.onPeerDisconnect.bind(this)}start(){this.libp2p.addEventListener("peer:connect",this.onPeerConnect),this.libp2p.addEventListener("peer:disconnect",this.onPeerDisconnect)}stop(){this.libp2p.removeEventListener("peer:connect",this.onPeerConnect),this.libp2p.removeEventListener("peer:disconnect",this.onPeerDisconnect);for(const e of this.pingKeepAliveTimers.values())clearInterval(e);for(const e of this.relayKeepAliveTimers.values())for(const t of e)clearInterval(t);this.pingKeepAliveTimers.clear(),this.relayKeepAliveTimers.clear()}onPeerConnect(e){const t=e.detail;this.startPingForPeer(t)}onPeerDisconnect(e){const t=e.detail;this.stopPingForPeer(t)}startPingForPeer(e){this.stopPingForPeer(e),this.startLibp2pPing(e),this.startRelayPing(e)}stopPingForPeer(e){this.stopLibp2pPing(e),this.stopRelayPing(e)}startLibp2pPing(e){if(this.options.pingKeepAlive===0){hi.warn(`Ping keep alive is disabled pingKeepAlive:${this.options.pingKeepAlive}, skipping start for libp2p ping`);return}const t=e.toString();if(this.pingKeepAliveTimers.has(t)){hi.warn(`Ping already started for peer: ${t}, skipping start for libp2p ping`);return}const r=setInterval(()=>{this.pingLibp2p(e)},this.options.pingKeepAlive*1e3);this.pingKeepAliveTimers.set(t,r)}stopLibp2pPing(e){const t=e.toString();if(!this.pingKeepAliveTimers.has(t)){hi.warn(`Ping not started for peer: ${t}, skipping stop for ping`);return}clearInterval(this.pingKeepAliveTimers.get(t)),this.pingKeepAliveTimers.delete(t)}startRelayPing(e){if(!this.relay)return;if(this.options.relayKeepAlive===0){hi.warn(`Relay keep alive is disabled relayKeepAlive:${this.options.relayKeepAlive}, skipping start for relay ping`);return}if(this.relayKeepAliveTimers.has(e.toString())){hi.warn(`Relay ping already started for peer: ${e.toString()}, skipping start for relay ping`);return}const t=[];for(const r of this.relay.pubsubTopics){if(!this.relay.getMeshPeers(r).includes(e.toString())){hi.warn(`Peer: ${e.toString()} is not in the mesh for topic: ${r}, skipping start for relay ping`);continue}const s=IL(this.networkConfig,{contentTopic:BC,pubsubTopic:r}),o=FL({routingInfo:s,contentTopic:BC,ephemeral:!0}),a=setInterval(()=>{this.pingRelay(o)},this.options.relayKeepAlive*1e3);t.push(a)}this.relayKeepAliveTimers.set(e.toString(),t)}stopRelayPing(e){var r;if(!this.relay)return;const t=e.toString();if(!this.relayKeepAliveTimers.has(t)){hi.warn(`Relay ping not started for peer: ${t}, skipping stop for relay ping`);return}(r=this.relayKeepAliveTimers.get(t))==null||r.map(clearInterval),this.relayKeepAliveTimers.delete(t)}async pingRelay(e){try{hi.info("Sending Waku Relay ping message"),await this.relay.send(e,{payload:new Uint8Array([1])})}catch(t){hi.error("Failed to send relay ping",t)}}async pingLibp2p(e){try{hi.info(`Pinging libp2p peer (${e.toString()})`);const t=await this.libp2p.services.ping.ping(e);hi.info(`Ping succeeded (${e.toString()})`,t),await this.libp2p.peerStore.merge(e,{metadata:{ping:mu(t.toString())}}),hi.info(`Ping updated for peer (${e.toString()})`)}catch(t){hi.error(`Ping failed for peer (${e.toString()})`,t)}}}class HY{constructor(e){v(this,"libp2p");v(this,"events");v(this,"isNetworkConnected",!1);this.libp2p=e.libp2p,this.events=e.events,this.onConnectedEvent=this.onConnectedEvent.bind(this),this.onDisconnectedEvent=this.onDisconnectedEvent.bind(this),this.dispatchNetworkEvent=this.dispatchNetworkEvent.bind(this)}start(){this.libp2p.addEventListener("peer:connect",this.onConnectedEvent),this.libp2p.addEventListener("peer:disconnect",this.onDisconnectedEvent);try{globalThis.addEventListener("online",this.dispatchNetworkEvent),globalThis.addEventListener("offline",this.dispatchNetworkEvent)}catch{}}stop(){this.libp2p.removeEventListener("peer:connect",this.onConnectedEvent),this.libp2p.removeEventListener("peer:disconnect",this.onDisconnectedEvent);try{globalThis.removeEventListener("online",this.dispatchNetworkEvent),globalThis.removeEventListener("offline",this.dispatchNetworkEvent)}catch{}}isConnected(){return this.isBrowserConnected()?this.isP2PConnected():!1}isP2PConnected(){return this.isNetworkConnected}isBrowserConnected(){var e;try{if(globalThis!=null&&globalThis.navigator&&!((e=globalThis==null?void 0:globalThis.navigator)!=null&&e.onLine))return!1}catch{}return!0}onConnectedEvent(){this.isNetworkConnected||(this.isNetworkConnected=!0,this.dispatchNetworkEvent())}onDisconnectedEvent(){this.isNetworkConnected&&this.libp2p.getConnections().length===0&&(this.isNetworkConnected=!1,this.dispatchNetworkEvent())}dispatchNetworkEvent(){this.events.dispatchEvent(new CustomEvent(bu.Connection,{detail:this.isConnected()}))}}const J0=new Ct("shard-reader");class WY{constructor(e){v(this,"libp2p");v(this,"clusterId");this.libp2p=e.libp2p,this.clusterId=e.networkConfig.clusterId}async isPeerOnCluster(e){const t=await this.getRelayShards(e);return t?t.clusterId===this.clusterId:!1}async hasShardInfo(e){return!!await this.getRelayShards(e)}async isPeerOnTopic(e,t){try{const{clusterId:r,shard:i}=SL(t);return r!==this.clusterId?!1:await this.isPeerOnShard(e,i)}catch(r){return J0.error(`Error comparing pubsub topic ${t} with shard info for ${e}`,r),!1}}async isPeerOnShard(e,t){const r=await this.getRelayShards(e);return J0.info(`Checking if peer on same shard: this { clusterId: ${this.clusterId}, shardId: ${t} },${e} { clusterId: ${r==null?void 0:r.clusterId}, shards: ${r==null?void 0:r.shards} }`),r?r.clusterId===this.clusterId&&r.shards.includes(t):!1}async getRelayShards(e){try{const r=(await this.libp2p.peerStore.get(e)).metadata.get("shardInfo");return r?w1(r):void 0}catch(t){J0.error(`Error getting shard info for ${e}`,t);return}}}const Wo=new Ct("connection-manager"),zY=3,KY=5*60,VY=5*60,GY=!0,YY=10,XY=3,ZY=60,QY=10;class JY{constructor(e){v(this,"keepAliveManager");v(this,"discoveryDialer");v(this,"dialer");v(this,"shardReader");v(this,"networkMonitor");v(this,"connectionLimiter");v(this,"options");v(this,"libp2p");this.libp2p=e.libp2p,this.options={maxBootstrapPeers:zY,maxConnections:YY,pingKeepAlive:KY,relayKeepAlive:VY,enableAutoRecovery:GY,maxDialingPeers:XY,failedDialCooldown:ZY,dialCooldown:QY,...e.config},this.keepAliveManager=new qY({relay:e.relay,libp2p:e.libp2p,networkConfig:e.networkConfig,options:{pingKeepAlive:this.options.pingKeepAlive,relayKeepAlive:this.options.relayKeepAlive}}),this.shardReader=new WY({libp2p:e.libp2p,networkConfig:e.networkConfig}),this.dialer=new FY({libp2p:e.libp2p,shardReader:this.shardReader,options:this.options}),this.discoveryDialer=new jY({libp2p:e.libp2p,dialer:this.dialer}),this.networkMonitor=new HY({libp2p:e.libp2p,events:e.events}),this.connectionLimiter=new UY({libp2p:e.libp2p,events:e.events,networkMonitor:this.networkMonitor,dialer:this.dialer,options:this.options})}start(){this.dialer.start(),this.networkMonitor.start(),this.discoveryDialer.start(),this.keepAliveManager.start(),this.connectionLimiter.start()}stop(){this.dialer.stop(),this.networkMonitor.stop(),this.discoveryDialer.stop(),this.keepAliveManager.stop(),this.connectionLimiter.stop()}isConnected(){return this.networkMonitor.isConnected()}async dial(e,t){const r=DY(e);Wo.info(`Dialing peer ${r.toString()} with protocols ${t}`);const i=await this.libp2p.dialProtocol(r,t);return Wo.info(`Dialed peer ${r.toString()} with protocols ${t}`),i}async hangUp(e){const t=$Y(e);try{return Wo.info(`Dropping connection with peer ${t.toString()}`),await this.libp2p.hangUp(t),Wo.info(`Dropped connection with peer ${t.toString()}`),!0}catch(r){return Wo.error(`Error dropping connection with peer ${t.toString()} - ${r}`),!1}}async getConnectedPeers(e){const t=this.libp2p.getPeers();if(Wo.info(`Getting connected peers for codec ${e}`),t.length===0)return Wo.info("No connected peers"),[];const i=(await Promise.all(t.map(async s=>{try{return await this.libp2p.peerStore.get(s)}catch{return null}}))).filter(s=>!!s).filter(s=>e?s.protocols.includes(e):!0).sort((s,o)=>MC(s)-MC(o));return Wo.info(`Found ${i.length} connected peers for codec ${e}`),i}async hasShardInfo(e){return this.shardReader.hasShardInfo(e)}async isPeerOnTopic(e,t){return this.shardReader.isPeerOnTopic(e,t)}async isPeerOnShard(e,t){return this.shardReader.isPeerOnShard(e,t)}}const ew=new Ct("metadata"),tw="/vac/waku/metadata/1.0.0";class eX{constructor(e,t){v(this,"clusterId");v(this,"streamManager");v(this,"libp2pComponents");v(this,"handshakesConfirmed",new Map);v(this,"multicodec",tw);this.clusterId=e,this.streamManager=new wu(tw,t),this.libp2pComponents=t,t.registrar.handle(tw,r=>{this.onRequest(r)})}async query(e){const t=b1.encode({clusterId:this.clusterId,shards:[]});if(!await this.libp2pComponents.peerStore.get(e))return{shardInfo:null,error:oo.NO_PEER_AVAILABLE};const i=await this.streamManager.getStream(e);if(!i)return ew.error(`Failed to get a stream for remote peer:${e.toString()}`),{shardInfo:null,error:oo.NO_STREAM_AVAILABLE};const s=await Fi([t],ao,i,xs,async l=>await as(l)),{error:o,shardInfo:a}=this.decodeMetadataResponse(s);return o?{shardInfo:null,error:o}:(await this.savePeerShardInfo(e,a),{shardInfo:a,error:null})}async confirmOrAttemptHandshake(e){const t=this.handshakesConfirmed.get(e.toString());return t?{shardInfo:t,error:null}:await this.query(e)}async onRequest(e){try{const{stream:t,connection:r}=e,i=Em.encode({clusterId:this.clusterId,shards:[]}),s=await Fi([i],ao,t,xs,async l=>await as(l)),{error:o,shardInfo:a}=this.decodeMetadataResponse(s);if(o)return;await this.savePeerShardInfo(r.remotePeer,a)}catch(t){ew.error("Error handling metadata request",t)}}decodeMetadataResponse(e){const t=new bt;e.forEach(i=>{t.append(i)});const r=Em.decode(t);return r?{shardInfo:r,error:null}:(ew.error("Error decoding metadata response"),{shardInfo:null,error:oo.DECODE_FAILED})}async savePeerShardInfo(e,t){await this.libp2pComponents.peerStore.merge(e,{metadata:{shardInfo:gS(t)}}),this.handshakesConfirmed.set(e.toString(),t)}}function tX(n){return e=>new eX(n,e)}const fi=new Ct("peer-manager"),rX=2;var co;(function(n){n.FilterConnect="filter:connect",n.FilterDisconnect="filter:disconnect",n.StoreConnect="store:connect"})(co||(co={}));class nX{constructor(e){v(this,"events",new Si);v(this,"numPeersToUse");v(this,"libp2p");v(this,"connectionManager");v(this,"lockedPeers",new Set);v(this,"unlockedPeers",new Map);var t;this.onConnected=this.onConnected.bind(this),this.onDisconnected=this.onDisconnected.bind(this),this.numPeersToUse=((t=e==null?void 0:e.config)==null?void 0:t.numPeersToUse)||rX,this.libp2p=e.libp2p,this.connectionManager=e.connectionManager}start(){this.libp2p.addEventListener("peer:identify",this.onConnected),this.libp2p.addEventListener("peer:disconnect",this.onDisconnected)}stop(){this.libp2p.removeEventListener("peer:identify",this.onConnected),this.libp2p.removeEventListener("peer:disconnect",this.onDisconnected)}async getPeers(e){fi.info(`Getting peers for protocol: ${e.protocol}, pubsubTopic: ${e.pubsubTopic}`);const t=await this.connectionManager.getConnectedPeers();fi.info(`Found ${t.length} connected peers`);let r=[];for(const a of t){const l=this.hasPeerProtocol(a,e.protocol),c=await this.isPeerOnPubsub(a.id,e.pubsubTopic),h=this.isPeerAvailableForUse(a.id);l&&c&&h&&(r.push(a),fi.info(`Peer ${a.id} qualifies for protocol ${e.protocol}`))}const i=r.filter(a=>this.isPeerLocked(a.id));if(fi.info(`Found ${i.length} locked peers out of ${r.length} qualifying peers`),i.length>=this.numPeersToUse){const a=i.slice(0,this.numPeersToUse).map(l=>l.id);return fi.info(`Using ${a.length} locked peers: ${a.map(l=>l.toString())}`),a}const s=r.filter(a=>!this.isPeerLocked(a.id));fi.info(`Found ${s.length} unlocked peers, need ${this.numPeersToUse-i.length} more`),r=[...i,...s].slice(0,this.numPeersToUse).map(a=>(this.lockPeer(a.id),a));const o=r.map(a=>a.id);return fi.info(`Selected ${o.length} peers: ${o.map(a=>a.toString())}`),o}async renewPeer(e,t){fi.info(`Renewing peer ${e} for protocol: ${t.protocol}, pubsubTopic: ${t.pubsubTopic}`);const i=(await this.connectionManager.getConnectedPeers()).find(s=>s.id.equals(e));if(!i){fi.warn(`Cannot renew peer:${e}, no connection to the peer.`);return}fi.info(`Found peer ${e} in connected peers, unlocking and getting new peers`),this.unlockPeer(i.id),await this.getPeers(t)}async isPeerOnPubsub(e,t){return await this.connectionManager.hasShardInfo(e)?this.connectionManager.isPeerOnTopic(e,t):!0}async onConnected(e){const t=e.detail,r=t.protocols.includes(this.getProtocolCodecs(It.Filter)),i=t.protocols.includes(this.getProtocolCodecs(It.Store));r&&this.dispatchFilterPeerConnect(t.peerId),i&&this.dispatchStorePeerConnect(t.peerId)}async onDisconnected(e){const t=e.detail;try{const r=await this.libp2p.peerStore.get(t);this.hasPeerProtocol(r,It.Filter)&&this.dispatchFilterPeerDisconnect(r.id)}catch(r){fi.error(`Failed to dispatch Filter disconnect event:${r}`)}}hasPeerProtocol(e,t){return e.protocols.includes(this.getProtocolCodecs(t))}lockPeer(e){fi.info(`Locking peer ${e}`),this.lockedPeers.add(e.toString()),this.libp2p.getConnections().filter(t=>t.remotePeer.equals(e)).forEach(t=>t.tags.push(E1)),this.unlockedPeers.delete(e.toString())}isPeerLocked(e){return this.lockedPeers.has(e.toString())}unlockPeer(e){fi.info(`Unlocking peer ${e}`),this.lockedPeers.delete(e.toString()),this.libp2p.getConnections().filter(t=>t.remotePeer.equals(e)).forEach(t=>{t.tags=t.tags.filter(r=>r!==E1)}),this.unlockedPeers.set(e.toString(),Date.now())}isPeerAvailableForUse(e){const t=this.unlockedPeers.get(e.toString());if(!t)return!0;const r=new Date(t).getTime();return Date.now()-r>=1e4}dispatchFilterPeerConnect(e){this.events.dispatchEvent(new CustomEvent(co.FilterConnect,{detail:e}))}dispatchStorePeerConnect(e){this.events.dispatchEvent(new CustomEvent(co.StoreConnect,{detail:e}))}dispatchFilterPeerDisconnect(e){this.events.dispatchEvent(new CustomEvent(co.FilterDisconnect,{detail:e}))}getProtocolCodecs(e){if(e===It.Relay)throw new Error("Relay protocol is not supported");return{[It.Filter]:ws.SUBSCRIBE,[It.LightPush]:By,[It.Store]:mf,"light-push-v2":xS}[e]}}class iX{constructor(e,t=5e3){v(this,"ttlMs");v(this,"cleanupIntervalId",null);v(this,"entryTimestamps",new Map);this.ttlMs=e,this.startCleanupInterval(t)}dispose(){this.cleanupIntervalId!==null&&(clearInterval(this.cleanupIntervalId),this.cleanupIntervalId=null),this.entryTimestamps.clear()}add(e){return this.entryTimestamps.set(e,Date.now()),this}has(e){return this.entryTimestamps.has(e)}startCleanupInterval(e){this.cleanupIntervalId=setInterval(()=>{this.removeExpiredEntries()},e)}removeExpiredEntries(){const e=Date.now();for(const[t,r]of this.entryTimestamps.entries())e-r>this.ttlMs&&this.entryTimestamps.delete(t)}}const wt=new Ct("sdk:filter-subscription");class sX{constructor(e){v(this,"pubsubTopic");v(this,"protocol");v(this,"peerManager");v(this,"config");v(this,"isStarted",!1);v(this,"inProgress",!1);v(this,"peers",new Map);v(this,"peerFailures",new Map);v(this,"receivedMessages",new iX(6e4));v(this,"callbacks",new Map);v(this,"messageEmitter",new Si);v(this,"toSubscribeContentTopics",new Set);v(this,"toUnsubscribeContentTopics",new Set);v(this,"subscribeIntervalId",null);v(this,"keepAliveIntervalId",null);this.config=e.config,this.pubsubTopic=e.pubsubTopic,this.protocol=e.protocol,this.peerManager=e.peerManager,this.onPeerConnected=this.onPeerConnected.bind(this),this.onPeerDisconnected=this.onPeerDisconnected.bind(this)}get contentTopics(){const e=Array.from(this.callbacks.keys()).map(r=>r.contentTopic),t=new Set(e).values();return Array.from(t)}start(){if(wt.info(`Starting subscription for pubsubTopic: ${this.pubsubTopic}`),this.isStarted||this.inProgress){wt.info("Subscription already started or in progress, skipping start");return}this.inProgress=!0,this.attemptSubscribe({useNewContentTopics:!1}),this.setupSubscriptionInterval(),this.setupKeepAliveInterval(),this.setupEventListeners(),this.isStarted=!0,this.inProgress=!1,wt.info(`Subscription started for pubsubTopic: ${this.pubsubTopic}`)}stop(){if(wt.info(`Stopping subscription for pubsubTopic: ${this.pubsubTopic}`),!this.isStarted||this.inProgress){wt.info("Subscription not started or stop in progress, skipping stop");return}this.inProgress=!0,this.disposeEventListeners(),this.disposeIntervals(),this.disposePeers(),this.disposeHandlers(),this.receivedMessages.dispose(),this.inProgress=!1,this.isStarted=!1,wt.info(`Subscription stopped for pubsubTopic: ${this.pubsubTopic}`)}isEmpty(){return this.callbacks.size===0}async add(e,t){const r=Array.isArray(e)?e:[e];for(const i of r)this.addSingle(i,t);return this.toSubscribeContentTopics.size>0?await this.attemptSubscribe({useNewContentTopics:!0}):!0}async remove(e){const t=Array.isArray(e)?e:[e];for(const r of t)this.removeSingle(r);return this.toUnsubscribeContentTopics.size>0?await this.attemptUnsubscribe({useNewContentTopics:!0}):!0}invoke(e,t){if(this.isMessageReceived(e)){wt.info(`Skipping invoking callbacks for already received message: pubsubTopic:${this.pubsubTopic}, peerId:${t.toString()}, contentTopic:${e.contentTopic}`);return}wt.info(`Invoking message for contentTopic: ${e.contentTopic}`),this.messageEmitter.dispatchEvent(new CustomEvent(e.contentTopic,{detail:e}))}addSingle(e,t){wt.info(`Adding subscription for contentTopic: ${e.contentTopic}`);const r=!this.contentTopics.includes(e.contentTopic);if(r&&this.toSubscribeContentTopics.add(e.contentTopic),this.callbacks.has(e)){wt.warn(`Replacing callback associated associated with decoder with pubsubTopic:${e.pubsubTopic} and contentTopic:${e.contentTopic}`);const s=this.callbacks.get(e);this.callbacks.delete(e),this.messageEmitter.removeEventListener(e.contentTopic,s)}const i=s=>{(async()=>{try{const o=await e.fromProtoObj(e.pubsubTopic,s.detail);t(o)}catch(o){wt.error("Error decoding message",o)}})()};this.callbacks.set(e,i),this.messageEmitter.addEventListener(e.contentTopic,i),wt.info(`Subscription added for contentTopic: ${e.contentTopic}, isNewContentTopic: ${r}`)}removeSingle(e){wt.info(`Removing subscription for contentTopic: ${e.contentTopic}`);const t=this.callbacks.get(e);t||wt.warn(`No callback associated with decoder with pubsubTopic:${e.pubsubTopic} and contentTopic:${e.contentTopic}`),this.callbacks.delete(e),this.messageEmitter.removeEventListener(e.contentTopic,t);const r=!this.contentTopics.includes(e.contentTopic);r&&this.toUnsubscribeContentTopics.add(e.contentTopic),wt.info(`Subscription removed for contentTopic: ${e.contentTopic}, isCompletelyRemoved: ${r}`)}isMessageReceived(e){try{const t=Uz(this.pubsubTopic,e);if(this.receivedMessages.has(t))return!0;this.receivedMessages.add(t)}catch{}return!1}setupSubscriptionInterval(){wt.info("Setting up subscription interval with period 1000ms"),this.subscribeIntervalId=setInterval(()=>{(async()=>{this.toSubscribeContentTopics.size>0&&(wt.info(`Subscription interval: ${this.toSubscribeContentTopics.size} topics to subscribe`),await this.attemptSubscribe({useNewContentTopics:!0})),this.toUnsubscribeContentTopics.size>0&&(wt.info(`Subscription interval: ${this.toUnsubscribeContentTopics.size} topics to unsubscribe`),await this.attemptUnsubscribe({useNewContentTopics:!0}))})()},1e3)}setupKeepAliveInterval(){wt.info(`Setting up keep-alive interval with period ${this.config.keepAliveIntervalMs}ms`),this.keepAliveIntervalId=setInterval(()=>{(async()=>{wt.info(`Keep-alive interval running for ${this.peers.size} peers`);let t=await Promise.all(Array.from(this.peers.values()).map(async r=>{if((await this.protocol.ping(r)).success){wt.info(`Ping successful for peer: ${r.toString()}`),this.peerFailures.set(r.toString(),0);return}let s=this.peerFailures.get(r.toString())||0;if(s+=1,this.peerFailures.set(r.toString(),s),wt.warn(`Ping failed for peer: ${r.toString()}, failures: ${s}/${this.config.pingsBeforePeerRenewed}`),!(s<this.config.pingsBeforePeerRenewed))return wt.info(`Peer ${r.toString()} exceeded max failures (${this.config.pingsBeforePeerRenewed}), will be replaced`),r}));t=t.filter(r=>!!r),await Promise.all(t.map(r=>(this.peers.delete(r==null?void 0:r.toString()),this.peerFailures.delete(r==null?void 0:r.toString()),this.requestUnsubscribe(r,this.contentTopics)))),t.length>0&&(wt.info(`Replacing ${t.length} failed peers`),await this.attemptSubscribe({useNewContentTopics:!1,useOnlyNewPeers:!0}))})()},this.config.keepAliveIntervalMs)}setupEventListeners(){this.peerManager.events.addEventListener(co.FilterConnect,this.onPeerConnected),this.peerManager.events.addEventListener(co.FilterDisconnect,this.onPeerDisconnected)}disposeIntervals(){this.subscribeIntervalId&&clearInterval(this.subscribeIntervalId),this.keepAliveIntervalId&&clearInterval(this.keepAliveIntervalId)}disposeHandlers(){for(const[e,t]of this.callbacks.entries())this.messageEmitter.removeEventListener(e.contentTopic,t);this.callbacks.clear()}async disposePeers(){await this.attemptUnsubscribe({useNewContentTopics:!1}),this.peers.clear(),this.peerFailures=new Map}disposeEventListeners(){this.peerManager.events.removeEventListener(co.FilterConnect,this.onPeerConnected),this.peerManager.events.removeEventListener(co.FilterDisconnect,this.onPeerDisconnected)}async onPeerConnected(e){var i;const t=(i=e.detail)==null?void 0:i.toString();if(wt.info(`Peer connected: ${t}`),!await this.peerManager.isPeerOnPubsub(e.detail,this.pubsubTopic)){wt.info(`Peer ${t} doesn't support pubsubTopic:${this.pubsubTopic}`);return}if(this.peers.has(t)){wt.info(`Peer ${t} already subscribed, skipping`);return}await this.attemptSubscribe({useNewContentTopics:!1,useOnlyNewPeers:!0})}async onPeerDisconnected(e){var i;const t=(i=e.detail)==null?void 0:i.toString();if(wt.info(`Peer disconnected: ${t}`),!await this.peerManager.isPeerOnPubsub(e.detail,this.pubsubTopic)){wt.info(`Peer ${t} doesn't support pubsubTopic:${this.pubsubTopic}`);return}if(!this.peers.has(t)){wt.info(`Disconnected peer ${t} not in use, ignoring`);return}wt.info(`Active peer ${t} disconnected, removing from peers list`),this.peers.delete(t),this.attemptSubscribe({useNewContentTopics:!1,useOnlyNewPeers:!0})}async attemptSubscribe(e){const{useNewContentTopics:t,useOnlyNewPeers:r=!1}=e,i=t?Array.from(this.toSubscribeContentTopics):this.contentTopics;if(wt.info(`Attempting to subscribe: useNewContentTopics=${t}, useOnlyNewPeers=${r}, contentTopics=${i.length}`),!i.length)return wt.warn("Requested content topics is an empty array, skipping"),!1;const s=new Set(this.peers.keys()),o=await this.peerManager.getPeers({protocol:It.Filter,pubsubTopic:this.pubsubTopic});for(const h of o){if(this.peers.size>=this.config.numPeersToUse)break;this.peers.set(h.toString(),h)}const a=r?Array.from(this.peers.values()).filter(h=>!s.has(h.toString())):Array.from(this.peers.values());if(wt.info(`Subscribing with ${a.length} peers for ${i.length} content topics`),r&&a.length===0)return wt.warn("Requested to use only new peers, but no peers found, skipping"),!1;const l=await Promise.all(a.map(h=>this.requestSubscribe(h,i))),c=l.filter(h=>h).length;return wt.info(`Subscribe attempts completed: ${c}/${l.length} successful`),t&&(this.toSubscribeContentTopics=new Set),l.some(h=>h)}async requestSubscribe(e,t){if(wt.info(`requestSubscribe: pubsubTopic:${this.pubsubTopic}	contentTopics:${t.join(",")}`),!t.length||!this.pubsubTopic)return wt.warn("requestSubscribe: no contentTopics or pubsubTopic provided, not sending subscribe request"),!1;const r=await this.protocol.subscribe(this.pubsubTopic,e,t);return r.failure?(wt.warn(`requestSubscribe: Failed to subscribe ${this.pubsubTopic} to ${e.toString()} with error:${r.failure.error} for contentTopics:${t}`),!1):(wt.info(`requestSubscribe: Subscribed ${this.pubsubTopic} to ${e.toString()} for contentTopics:${t}`),!0)}async attemptUnsubscribe(e){const{useNewContentTopics:t}=e,r=t?Array.from(this.toUnsubscribeContentTopics):this.contentTopics;if(wt.info(`Attempting to unsubscribe: useNewContentTopics=${t}, contentTopics=${r.length}`),!r.length)return wt.warn("Requested content topics is an empty array, skipping"),!1;const i=Array.from(this.peers.values()),s=await Promise.all(i.map(a=>this.requestUnsubscribe(a,t?r:void 0))),o=s.filter(a=>a).length;return wt.info(`Unsubscribe attempts completed: ${o}/${s.length} successful`),t&&(this.toUnsubscribeContentTopics=new Set),s.some(a=>a)}async requestUnsubscribe(e,t){var i;const r=t?await this.protocol.unsubscribe(this.pubsubTopic,e,t):await this.protocol.unsubscribeAll(this.pubsubTopic,e);return r.failure?(wt.warn(`requestUnsubscribe: Failed to unsubscribe for pubsubTopic:${this.pubsubTopic} from peerId:${e.toString()} with error:${(i=r.failure)==null?void 0:i.error} for contentTopics:${t}`),!1):(wt.info(`requestUnsubscribe: Unsubscribed pubsubTopic:${this.pubsubTopic} from peerId:${e.toString()} for contentTopics:${t}`),!0)}}const zo=new Ct("sdk:filter");class oX{constructor(e){v(this,"protocol");v(this,"peerManager");v(this,"config");v(this,"subscriptions",new Map);this.config={numPeersToUse:2,pingsBeforePeerRenewed:3,keepAliveIntervalMs:6e4,...e.options},this.peerManager=e.peerManager,this.protocol=new fK(this.onIncomingMessage.bind(this),e.libp2p)}get multicodec(){return this.protocol.multicodec}async start(){await this.protocol.start()}async stop(){await this.protocol.stop()}unsubscribeAll(){for(const e of this.subscriptions.values())e.stop();this.subscriptions.clear()}async subscribe(e,t){const r=Array.isArray(e)?e:[e];if(r.length===0)throw Error("Cannot subscribe with 0 decoders.");const i=r.map(c=>c.pubsubTopic),s=i[0],o=r.map(c=>c.contentTopic);zo.info(`Subscribing to contentTopics: ${o}, pubsubTopic: ${s}`),this.throwIfTopicNotSame(i);let a=this.subscriptions.get(s);a||(a=new sX({pubsubTopic:s,protocol:this.protocol,config:this.config,peerManager:this.peerManager}),a.start());const l=await a.add(r,t);return this.subscriptions.set(s,a),zo.info(`Subscription ${l?"successful":"failed"} for content topic: ${o}`),l}async unsubscribe(e){const t=Array.isArray(e)?e:[e];if(t.length===0)throw Error("Cannot unsubscribe with 0 decoders.");const r=t.map(l=>l.pubsubTopic),i=r[0],s=t.map(l=>l.contentTopic);zo.info(`Unsubscribing from contentTopics: ${s}, pubsubTopic: ${i}`),this.throwIfTopicNotSame(r);const o=this.subscriptions.get(i);if(!o)return zo.warn("No subscriptions associated with the decoder."),!1;const a=await o.remove(t);return o.isEmpty()&&(zo.warn("Subscription has no decoders anymore, terminating it."),o.stop(),this.subscriptions.delete(i)),zo.info(`Unsubscribing ${a?"successful":"failed"} for content topic: ${s}`),a}async onIncomingMessage(e,t,r){zo.info(`Received message for pubsubTopic:${e}, contentTopic:${t.contentTopic}, peerId:${r.toString()}`);const i=this.subscriptions.get(e);if(!i){zo.error(`No subscription locally registered for topic ${e}`);return}i.invoke(t,r)}throwIfTopicNotSame(e){const t=e[0];if(!e.every(i=>i===t))throw Error(`Cannot subscribe to more than one pubsub topic at the same time, got pubsubTopics:${e}`)}}var aX="Expected a function",UC=NaN,lX="[object Symbol]",cX=/^\s+|\s+$/g,uX=/^[-+]0x[0-9a-f]+$/i,hX=/^0b[01]+$/i,fX=/^0o[0-7]+$/i,dX=parseInt,pX=typeof Ui=="object"&&Ui&&Ui.Object===Object&&Ui,gX=typeof self=="object"&&self&&self.Object===Object&&self,mX=pX||gX||Function("return this")(),yX=Object.prototype,bX=yX.toString,wX=Math.max,vX=Math.min,rw=function(){return mX.Date.now()};function _X(n,e,t){var r,i,s,o,a,l,c=0,h=!1,d=!1,p=!0;if(typeof n!="function")throw new TypeError(aX);e=FC(e)||0,D1(t)&&(h=!!t.leading,d="maxWait"in t,s=d?wX(FC(t.maxWait)||0,e):s,p="trailing"in t?!!t.trailing:p);function g($){var U=r,O=i;return r=i=void 0,c=$,o=n.apply(O,U),o}function m($){return c=$,a=setTimeout(S,e),h?g($):o}function E($){var U=$-l,O=$-c,P=e-U;return d?vX(P,s-O):P}function y($){var U=$-l,O=$-c;return l===void 0||U>=e||U<0||d&&O>=s}function S(){var $=rw();if(y($))return b($);a=setTimeout(S,E($))}function b($){return a=void 0,p&&r?g($):(r=i=void 0,o)}function _(){a!==void 0&&clearTimeout(a),c=0,r=l=i=a=void 0}function I(){return a===void 0?o:b(rw())}function x(){var $=rw(),U=y($);if(r=arguments,i=this,l=$,U){if(a===void 0)return m(l);if(d)return a=setTimeout(S,e),g(l)}return a===void 0&&(a=setTimeout(S,e)),o}return x.cancel=_,x.flush=I,x}function D1(n){var e=typeof n;return!!n&&(e=="object"||e=="function")}function EX(n){return!!n&&typeof n=="object"}function SX(n){return typeof n=="symbol"||EX(n)&&bX.call(n)==lX}function FC(n){if(typeof n=="number")return n;if(SX(n))return UC;if(D1(n)){var e=typeof n.valueOf=="function"?n.valueOf():n;n=D1(e)?e+"":e}if(typeof n!="string")return n===0?n:+n;n=n.replace(cX,"");var t=hX.test(n);return t||fX.test(n)?dX(n.slice(2),t?2:8):uX.test(n)?UC:+n}var AX=_X;const xX=Yl(AX),Ko=new Ct("health-indicator");class IX{constructor(e){v(this,"isStarted",!1);v(this,"libp2p");v(this,"events");v(this,"value",Ya.Unhealthy);v(this,"debouncedAssessHealth");this.libp2p=e.libp2p,this.events=e.events,this.onPeerIdentify=this.onPeerIdentify.bind(this),this.onPeerDisconnected=this.onPeerDisconnected.bind(this),this.debouncedAssessHealth=xX(()=>{this.assessHealth()},100)}start(){this.isStarted||(this.isStarted=!0,Ko.info("start: adding listeners to libp2p"),this.libp2p.addEventListener("peer:identify",this.onPeerIdentify),this.libp2p.addEventListener("peer:disconnect",this.onPeerDisconnected),this.debouncedAssessHealth())}stop(){this.isStarted&&(this.isStarted=!1,Ko.info("stop: removing listeners to libp2p"),this.libp2p.removeEventListener("peer:identify",this.onPeerIdentify),this.libp2p.removeEventListener("peer:disconnect",this.onPeerDisconnected),this.debouncedAssessHealth.cancel())}toValue(){return this.value}onPeerDisconnected(e){Ko.info("onPeerDisconnected: received libp2p event"),this.debouncedAssessHealth()}onPeerIdentify(e){Ko.info("onPeerIdentify: received libp2p event"),this.debouncedAssessHealth()}async assessHealth(){const e=this.libp2p.getConnections();if(e.length===0){Ko.info("assessHealth: no connections, setting to Unhealthy"),this.updateAndDispatchHealthEvent(Ya.Unhealthy);return}const t=await Promise.all(e.map(async o=>{try{return await this.libp2p.peerStore.get(o.remotePeer)}catch{return Ko.warn(`assessHealth: failed to get peer ${o.remotePeer}, skipping`),null}})),r=t.filter(o=>o==null?void 0:o.protocols.includes(ws.SUBSCRIBE)).length,i=t.filter(o=>o==null?void 0:o.protocols.includes(By)).length;let s;r===0||i===0?s=Ya.Unhealthy:r>=2&&i>=2?s=Ya.SufficientlyHealthy:r===1&&i===1?s=Ya.MinimallyHealthy:(Ko.error(`assessHealth: unexpected state, cannot identify health status of the node: Filter:${r}; LightPush:${i}`),s=this.value),Ko.info(`assessHealth: node identified as ${s} Filter:${r}; LightPush:${i}`),this.updateAndDispatchHealthEvent(s)}updateAndDispatchHealthEvent(e){this.value!==e&&(this.value=e,this.events.dispatchEvent(new CustomEvent(bu.Health,{detail:this.value})))}}const TX=n=>n===hr.REMOTE_PEER_REJECTED||n===hr.NO_RESPONSE||n===hr.RLN_PROOF_GENERATION||n===hr.NO_PEER_AVAILABLE,CX=n=>new Promise((e,t)=>setTimeout(()=>t(new Error("Task timeout")),n)),kX=5,PX=1e4,Ic=new Ct("sdk:retry-manager");class RX{constructor(e){v(this,"intervalID",null);v(this,"retryIntervalMs");v(this,"inProgress",0);v(this,"queue",[]);v(this,"peerManager");this.peerManager=e.peerManager,this.retryIntervalMs=e.retryIntervalMs||1e3}start(){this.intervalID=setInterval(()=>{this.processQueue()},this.retryIntervalMs)}stop(){this.intervalID&&(clearInterval(this.intervalID),this.intervalID=null)}push(e,t,r){this.queue.push({maxAttempts:t,callback:e,routingInfo:r})}processQueue(){if(this.queue.length!==0)for(;this.queue.length&&this.inProgress<kX;){const e=this.queue.shift();e&&this.scheduleTask(e)}}scheduleTask(e){setTimeout(async()=>this.taskExecutor(e),100)}async taskExecutor(e){if(e.maxAttempts<=0){Ic.warn("scheduleTask: max attempts has reached, removing from queue");return}const t=(await this.peerManager.getPeers({protocol:It.LightPush,pubsubTopic:e.routingInfo.pubsubTopic}))[0];if(!t){Ic.warn("scheduleTask: no peers, putting back to queue"),this.queue.push({...e,maxAttempts:e.maxAttempts-1});return}try{this.inProgress+=1;const r=await Promise.race([CX(PX),e.callback(t)]);if(r===void 0)throw new Error("Task timeout");if(r.failure)throw Error(r.failure.error);if(Ic.info("scheduleTask: executed successfully"),e.maxAttempts===0){Ic.warn("scheduleTask: discarded a task due to limit of max attempts");return}this.queue.push({...e,maxAttempts:e.maxAttempts-1})}catch(r){const i=r;if(Ic.error("scheduleTask: task execution failed with error:",i),TX(i.message)&&await this.peerManager.renewPeer(t,{protocol:It.LightPush,pubsubTopic:e.routingInfo.pubsubTopic}),e.maxAttempts===0){Ic.warn("scheduleTask: discarded a task due to limit of max attempts");return}this.queue.push({...e,maxAttempts:e.maxAttempts-1})}finally{this.inProgress-=1}}}const OX=new Ct("sdk:light-push"),YN=3,LX={autoRetry:!0,retryIntervalMs:1e3,maxAttempts:YN,numPeersToUse:1};class NX{constructor(e){v(this,"config");v(this,"retryManager");v(this,"peerManager");v(this,"protocol");this.config={...LX,...e.options||{}},this.peerManager=e.peerManager,this.protocol=new yK(e.libp2p),this.retryManager=new RX({peerManager:e.peerManager,retryIntervalMs:this.config.retryIntervalMs})}get multicodec(){return this.protocol.multicodec}start(){this.retryManager.start()}stop(){this.retryManager.stop()}async send(e,t,r={}){r={useLegacy:!1,...this.config,...r};const{pubsubTopic:i}=e;OX.info("send: attempting to send a message to pubsubTopic:",i);const s=await this.peerManager.getPeers({protocol:r.useLegacy?"light-push-v2":It.LightPush,pubsubTopic:e.pubsubTopic}),o=(s==null?void 0:s.length)>0?await Promise.all(s.map(l=>this.protocol.send(e,t,l,r.useLegacy).catch(c=>({success:null,failure:{error:hr.GENERIC_FAIL}})))):[],a=o.length?{successes:o.filter(l=>l.success).map(l=>l.success),failures:o.filter(l=>l.failure).map(l=>l.failure)}:{successes:[],failures:[{error:hr.NO_PEER_AVAILABLE}]};if(r.autoRetry&&a.successes.length===0){const l=c=>this.protocol.send(e,t,c,r.useLegacy);this.retryManager.push(l.bind(this),r.maxAttempts||YN,e.routingInfo)}return a}}const di=new Ct("store-sdk");class DX{constructor(e){v(this,"options");v(this,"libp2p");v(this,"peerManager");v(this,"protocol");this.options=e.options||{},this.peerManager=e.peerManager,this.libp2p=e.libp2p,this.protocol=new EK(e.libp2p)}get multicodec(){return this.protocol.multicodec}async*queryGenerator(e,t){const{decodersAsMap:r,queryOptions:i}=this.buildQueryParams(e,t);for(const s of i){const o=(t==null?void 0:t.peerId)??await this.getPeerToUse(s.pubsubTopic);if(!o)throw di.error("No peers available to query"),new Error("No peers available to query");di.info(`Querying store with options: ${JSON.stringify(s)}`);const a=this.protocol.queryPerPage(s,r,o);for await(const l of a)yield l}}async queryWithOrderedCallback(e,t,r){di.info("Querying store with ordered callback");for await(const i of this.queryGenerator(e,r))if(await this.processMessages(i,t))break}async queryWithPromiseCallback(e,t,r){di.info("Querying store with promise callback");let i=!1;for await(const s of this.queryGenerator(e,r)){const o=s.map(async a=>{i||(i=!!await t(a))});if(await Promise.all(o),i)break}}async processMessages(e,t){let r=!1;const s=(await Promise.all(e)).filter(dS);return await Promise.all(s.map(async o=>{o&&!r&&(r=!!await t(o))})),r}createCursor(e){return ES(e.pubsubTopic,e)}validateDecodersAndPubsubTopic(e){if(e.length===0)throw di.error("No decoders provided"),new Error("No decoders provided");const t=Array.from(new Set(e.map(o=>o.pubsubTopic)));if(t.length>1)throw di.error("API does not support querying multiple pubsub topics at once"),new Error("API does not support querying multiple pubsub topics at once");const r=t[0],i=new Map;e.forEach(o=>{if(i.has(o.contentTopic))throw di.error("API does not support different decoder per content topic"),new Error("API does not support different decoder per content topic");i.set(o.contentTopic,o)});const s=e.filter(o=>o.pubsubTopic===r).map(o=>o.contentTopic);if(s.length===0)throw di.error(`No decoders found for topic ${r}`),new Error("No decoders found for topic "+r);return{pubsubTopic:r,contentTopics:s,decodersAsMap:i}}async getPeerToUse(e){const t=await this.peerManager.getPeers({protocol:It.Store,pubsubTopic:e});return this.options.peers?await this.getPeerFromConfigurationOrFirst(t,this.options.peers):t[0]}async getPeerFromConfigurationOrFirst(e,t){const r=t.map(Nt),i=[];for(const s of r){const o=e.find(a=>{var l;return a.toString()===((l=s.getPeerId())==null?void 0:l.toString())});if(o)return o;i.push(s)}for(;i.length;){const s=i.pop();if(!s)return;try{if(await this.libp2p.dial(s))return Cs(s.getPeerId())}catch(o){di.warn(`Failed to dial peer from options.peers list for Store protocol. Peer:${s.getPeerId()}, error:${o}`)}}return di.warn(`Passed node to use for Store not found: ${t.toString()}. Attempting to use first available peers.`),e[0]}buildQueryParams(e,t){var l;const r=(t==null?void 0:t.messageHashes)&&t.messageHashes.length>0;let i,s,o;if(r)i=t.pubsubTopic||((l=e[0])==null?void 0:l.pubsubTopic)||"",s=[],o=new Map,e.forEach(c=>{o.set(c.contentTopic,c)});else{const c=this.validateDecodersAndPubsubTopic(e);i=c.pubsubTopic,s=c.contentTopics,o=c.decodersAsMap}const a=[];if(t!=null&&t.timeStart&&(t!=null&&t.timeEnd)){let c=t.timeStart;const h=t.timeEnd;for(;h.getTime()-c.getTime()>this.protocol.maxTimeLimit;){const d=new Date(c.getTime()+this.protocol.maxTimeLimit);a.push([c,d]),c=d}a.length===0&&(di.info("Using single time range"),a.push([c,h]))}return a.length===0?(di.info("No sub time ranges"),{decodersAsMap:o,queryOptions:[{pubsubTopic:i,contentTopics:s,includeData:!0,paginationForward:!0,...t}]}):(di.info(`Building ${a.length} sub time ranges`),{decodersAsMap:o,queryOptions:a.map(([c,h])=>({pubsubTopic:i,contentTopics:s,includeData:!0,paginationForward:!0,...t,timeStart:c,timeEnd:h}))})}}const Yc=new Ct("wait-for-remote-peer");async function $X(n,e,t){e=e!=null&&e.length?e:qX(n);const r=n.libp2p.getConnections();if(!n.isStarted())throw Error("Waku node is not started");for(const s of e)switch(s){case It.Relay:if(!n.relay)throw Error("Cannot wait for Relay peer: protocol not mounted");break;case It.LightPush:if(!n.lightPush)throw Error("Cannot wait for LightPush peer: protocol not mounted");break;case It.Store:if(!n.store)throw Error("Cannot wait for Store peer: protocol not mounted");break;case It.Filter:if(!n.filter)throw Error("Cannot wait for Filter peer: protocol not mounted");break}const i=[MX(n,e)];r.length>0&&!e.includes(It.Relay)&&i.push(UX(n,e)),t?await jX(Promise.any(i),t,"Timed out waiting for a remote peer."):await Promise.any(i)}function nw(n,e){return n.map(t=>BX(t,e))}async function MX(n,e){const t=[];if(n.relay&&e.includes(It.Relay)&&t.push(n.relay.waitForPeers()),n.store&&e.includes(It.Store)&&t.push(...nw([mf],n.libp2p)),n.lightPush&&e.includes(It.LightPush)){const r=nw([By,xS],n.libp2p);t.push(Promise.any(r))}return n.filter&&e.includes(It.Filter)&&t.push(...nw([ws.SUBSCRIBE],n.libp2p)),Promise.all(t)}async function BX(n,e){Yc.info(`Waiting for ${n} peer.`),await new Promise(t=>{const r=async i=>{var s,o;if((o=(s=i.detail)==null?void 0:s.protocols)!=null&&o.includes(n)){const a=e.services.metadata;if(!a){e.removeEventListener("peer:identify",r),t();return}try{await a.confirmOrAttemptHandshake(i.detail.peerId),e.removeEventListener("peer:identify",r),t()}catch(l){l.code==="ERR_CONNECTION_BEING_CLOSED"&&Yc.error("Connection closed. Some peers can be on different shard."),Yc.error(`Error waiting for metadata: ${l}`)}}};e.addEventListener("peer:identify",r)})}async function UX(n,e){const t=n.libp2p.getPeers(),r=n.libp2p.services.metadata,i=HX(e);if(!t.length||!r){Yc.info(`Skipping waitForMetadata due to missing connections:${t.length} or metadataService:${!!r}`);return}for(const s of t)try{const o=await n.libp2p.peerStore.get(s);if(o.protocols.some(l=>i.has(l))&&!(await r.confirmOrAttemptHandshake(s)).error&&(o.protocols.forEach(h=>{i.has(h)&&i.set(h,!0)}),Array.from(i.values()).every(h=>h)))return}catch(o){o.code==="ERR_CONNECTION_BEING_CLOSED"&&Yc.error("Connection closed. Some peers can be on different shard."),Yc.error(`Error while iterating through peers: ${o}`);continue}}const FX=(n,e)=>new Promise((t,r)=>setTimeout(()=>r(Error(e)),n));async function jX(n,e,t){await Promise.race([n,FX(e,t)])}function qX(n){const e=[];return n.relay&&e.push(It.Relay),n.filter&&e.push(It.Filter),n.store&&e.push(It.Store),n.lightPush&&e.push(It.LightPush),e}function HX(n){const e=new Map,t={[It.Filter]:[ws.SUBSCRIBE],[It.LightPush]:[By,xS],[It.Store]:[mf]};for(const r of n)t[r]&&t[r].forEach(i=>{e.set(i,!1)});return e}const Ha=new Ct("sdk:waku");class WX{constructor(e,t,r,i){v(this,"libp2p");v(this,"relay");v(this,"store");v(this,"filter");v(this,"lightPush");v(this,"events",new Si);v(this,"networkConfig");v(this,"_nodeStateLock",!1);v(this,"_nodeStarted",!1);v(this,"connectionManager");v(this,"peerManager");v(this,"healthIndicator");this.relay=i,this.libp2p=t,this.networkConfig=e.networkConfig||qL,r={filter:!1,lightpush:!1,store:!1,...r};const s=this.libp2p.peerId.toString();this.connectionManager=new JY({libp2p:t,relay:this.relay,events:this.events,networkConfig:this.networkConfig,config:e==null?void 0:e.connectionManager}),this.peerManager=new nX({libp2p:t,config:{numPeersToUse:e.numPeersToUse},connectionManager:this.connectionManager}),this.healthIndicator=new IX({libp2p:t,events:this.events}),r.store&&(this.store=new DX({libp2p:t,peerManager:this.peerManager,options:e==null?void 0:e.store})),r.lightpush&&(this.lightPush=new NX({libp2p:t,peerManager:this.peerManager,options:e==null?void 0:e.lightPush})),r.filter&&(this.filter=new oX({libp2p:t,peerManager:this.peerManager,options:e.filter})),Ha.info("Waku node created",s,`relay: ${!!this.relay}, store: ${!!this.store}, light push: ${!!this.lightPush}, filter: ${!!this.filter}`)}get peerId(){return this.libp2p.peerId}get protocols(){return this.libp2p.getProtocols()}get health(){return this.healthIndicator.toValue()}async dial(e,t){const r=t??[];typeof t>"u"&&(this.relay&&r.push(It.Relay),this.store&&r.push(It.Store),this.filter&&r.push(It.Filter),this.lightPush&&r.push(It.LightPush));const i=[];return r.includes(It.Relay)&&(this.relay?this.relay.gossipSub.multicodecs.forEach(s=>i.push(s)):Ha.error("Relay codec not included in dial codec: protocol not mounted locally")),r.includes(It.Store)&&(this.store?i.push(this.store.multicodec):Ha.error("Store codec not included in dial codec: protocol not mounted locally")),r.includes(It.LightPush)&&(this.lightPush?i.push(...this.lightPush.multicodec):Ha.error("Light Push codec not included in dial codec: protocol not mounted locally")),r.includes(It.Filter)&&(this.filter?i.push(this.filter.multicodec):Ha.error("Filter codec not included in dial codec: protocol not mounted locally")),Ha.info(`Dialing to ${e==null?void 0:e.toString()} with protocols ${r}`),await this.connectionManager.dial(e,i)}async hangUp(e){return Ha.info(`Hanging up peer:${e==null?void 0:e.toString()}.`),this.connectionManager.hangUp(e)}async start(){var e,t;this._nodeStateLock||this.isStarted()||(this._nodeStateLock=!0,await this.libp2p.start(),await((e=this.filter)==null?void 0:e.start()),this.connectionManager.start(),this.peerManager.start(),this.healthIndicator.start(),(t=this.lightPush)==null||t.start(),this._nodeStateLock=!1,this._nodeStarted=!0)}async stop(){var e,t;this._nodeStateLock||!this.isStarted()||(this._nodeStateLock=!0,(e=this.lightPush)==null||e.stop(),await((t=this.filter)==null?void 0:t.stop()),this.healthIndicator.stop(),this.peerManager.stop(),this.connectionManager.stop(),await this.libp2p.stop(),this._nodeStateLock=!1,this._nodeStarted=!1)}async getConnectedPeers(){return this.connectionManager.getConnectedPeers()}async waitForPeers(e,t){return $X(this,e,t)}isStarted(){return this._nodeStarted&&this.libp2p.status==="started"}isConnected(){return this.connectionManager.isConnected()}createDecoder(e){const t=this.createRoutingInfo(e.contentTopic,e.shardId);return Wz(e.contentTopic,t)}createEncoder(e){const t=this.createRoutingInfo(e.contentTopic,e.shardId);return FL({contentTopic:e.contentTopic,ephemeral:e.ephemeral,routingInfo:t})}createRoutingInfo(e,t){return IL(this.networkConfig,{contentTopic:e,shardId:t})}}const zX=8,WS=1024*1024*4;let KX=class extends Error{constructor(){super(...arguments);v(this,"name","InvalidMessageLengthError");v(this,"code","ERR_INVALID_MSG_LENGTH")}},XN=class extends Error{constructor(){super(...arguments);v(this,"name","InvalidDataLengthError");v(this,"code","ERR_MSG_DATA_TOO_LONG")}},VX=class extends Error{constructor(){super(...arguments);v(this,"name","InvalidDataLengthLengthError");v(this,"code","ERR_MSG_LENGTH_TOO_LONG")}},jC=class extends Error{constructor(){super(...arguments);v(this,"name","UnexpectedEOFError");v(this,"code","ERR_UNEXPECTED_EOF")}};function ZN(n){return n[Symbol.asyncIterator]!=null}function QN(n,e){if(n.byteLength>e)throw new XN("Message length too long")}const Yy=n=>{const e=un(n),t=Ei(e);return Ts(n,t),Yy.bytes=e,t};Yy.bytes=0;function zS(n,e){e=e??{};const t=e.lengthEncoder??Yy,r=(e==null?void 0:e.maxDataLength)??WS;function*i(s){QN(s,r);const o=t(s.byteLength);o instanceof Uint8Array?yield o:yield*o,s instanceof Uint8Array?yield s:yield*s}return ZN(n)?async function*(){for await(const s of n)yield*i(s)}():function*(){for(const s of n)yield*i(s)}()}zS.single=(n,e)=>{e=e??{};const t=e.lengthEncoder??Yy,r=(e==null?void 0:e.maxDataLength)??WS;return QN(n,r),new bt(t(n.byteLength),n)};var Za;(function(n){n[n.LENGTH=0]="LENGTH",n[n.DATA=1]="DATA"})(Za||(Za={}));const KS=n=>{const e=Wf(n);return KS.bytes=un(e),e};KS.bytes=0;function Mm(n,e){const t=new bt;let r=Za.LENGTH,i=-1;const s=(e==null?void 0:e.lengthDecoder)??KS,o=(e==null?void 0:e.maxLengthLength)??zX,a=(e==null?void 0:e.maxDataLength)??WS;function*l(){for(;t.byteLength>0;){if(r===Za.LENGTH)try{if(i=s(t),i<0)throw new KX("Invalid message length");if(i>a)throw new XN("Message length too long");const c=s.bytes;t.consume(c),(e==null?void 0:e.onLength)!=null&&e.onLength(i),r=Za.DATA}catch(c){if(c instanceof RangeError){if(t.byteLength>o)throw new VX("Message length length too long");break}throw c}if(r===Za.DATA){if(t.byteLength<i)break;const c=t.sublist(0,i);t.consume(i),(e==null?void 0:e.onData)!=null&&e.onData(c),yield c,r=Za.LENGTH}}}return ZN(n)?async function*(){for await(const c of n)t.append(c),yield*l();if(t.byteLength>0)throw new jC("Unexpected end of input")}():function*(){for(const c of n)t.append(c),yield*l();if(t.byteLength>0)throw new jC("Unexpected end of input")}()}Mm.fromReader=(n,e)=>{let t=1;const r=async function*(){for(;;)try{const{done:s,value:o}=await n.next(t);if(s===!0)return;o!=null&&(yield o)}catch(s){if(s.code==="ERR_UNDER_READ")return{done:!0,value:null};throw s}finally{t=1}}();return Mm(r,{...e??{},onLength:s=>{t=s}})};class GX extends Error{constructor(){super(...arguments);v(this,"name","UnexpectedEOFError");v(this,"code","ERR_UNEXPECTED_EOF")}}function Bm(n,e){const t=zL();n.sink(t).catch(async o=>{await t.end(o)}),n.sink=async o=>{for await(const a of o)await t.push(a);await t.end()};let r=n.source;n.source[Symbol.iterator]!=null?r=n.source[Symbol.iterator]():n.source[Symbol.asyncIterator]!=null&&(r=n.source[Symbol.asyncIterator]());const i=new bt;return{read:async o=>{var l;if((l=o==null?void 0:o.signal)==null||l.throwIfAborted(),(o==null?void 0:o.bytes)==null){const{done:c,value:h}=await Un(r.next(),o==null?void 0:o.signal);return c===!0?null:h}for(;i.byteLength<o.bytes;){const{value:c,done:h}=await Un(r.next(),o==null?void 0:o.signal);if(h===!0)throw new GX("unexpected end of input");i.append(c)}const a=i.sublist(0,o.bytes);return i.consume(o.bytes),a},write:async(o,a)=>{var l;(l=a==null?void 0:a.signal)==null||l.throwIfAborted(),o instanceof Uint8Array?await t.push(o,a):await t.push(o.subarray(),a)},unwrap:()=>{if(i.byteLength>0){const o=n.source;n.source=async function*(){(e==null?void 0:e.yieldBytes)===!1?yield i:yield*i,yield*o}()}return n}}}class YX extends Error{constructor(){super(...arguments);v(this,"name","InvalidMessageLengthError");v(this,"code","ERR_INVALID_MSG_LENGTH")}}class XX extends Error{constructor(){super(...arguments);v(this,"name","InvalidDataLengthError");v(this,"code","ERR_MSG_DATA_TOO_LONG")}}class ZX extends Error{constructor(){super(...arguments);v(this,"name","InvalidDataLengthLengthError");v(this,"code","ERR_MSG_LENGTH_TOO_LONG")}}function Iu(n,e={}){const t=Bm(n,e);e.maxDataLength!=null&&e.maxLengthLength==null&&(e.maxLengthLength=un(e.maxDataLength));const r=(e==null?void 0:e.lengthDecoder)??Wf,i=(e==null?void 0:e.lengthEncoder)??Ts;return{read:async o=>{let a=-1;const l=new bt;for(;;){l.append(await t.read({...o,bytes:1}));try{a=r(l)}catch(c){if(c instanceof RangeError)continue;throw c}if(a<0)throw new YX("Invalid message length");if((e==null?void 0:e.maxLengthLength)!=null&&l.byteLength>e.maxLengthLength)throw new ZX("message length length too long");if(a>-1)break}if((e==null?void 0:e.maxDataLength)!=null&&a>e.maxDataLength)throw new XX("message length too long");return t.read({...o,bytes:a})},write:async(o,a)=>{await t.write(new bt(i(o.byteLength),o),a)},writeV:async(o,a)=>{const l=new bt(...o.flatMap(c=>[i(c.byteLength),c]));await t.write(l,a)},unwrap:()=>t.unwrap()}}function qC(){const n=qr();let e=!1;return{sink:async t=>{if(e)throw new Error("already piped");e=!0,n.resolve(t)},source:async function*(){yield*await n.promise}()}}function QX(){const n=qC(),e=qC();return[{source:n.source,sink:e.sink},{source:e.source,sink:n.sink}]}const Ef=65535,HC=Ef-16;var LR,NR;const td=!!((NR=(LR=globalThis.process)==null?void 0:LR.env)!=null&&NR.DUMP_SESSION_KEYS);/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */function JN(n){return n instanceof Uint8Array||ArrayBuffer.isView(n)&&n.constructor.name==="Uint8Array"}function $1(n){if(typeof n!="boolean")throw new Error(`boolean expected, not ${n}`)}function iw(n){if(!Number.isSafeInteger(n)||n<0)throw new Error("positive integer expected, got "+n)}function Xn(n,...e){if(!JN(n))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(n.length))throw new Error("Uint8Array expected of length "+e+", got length="+n.length)}function WC(n,e=!0){if(n.destroyed)throw new Error("Hash instance has been destroyed");if(e&&n.finished)throw new Error("Hash#digest() has already been called")}function JX(n,e){Xn(n);const t=e.outputLen;if(n.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}function wa(n){return new Uint32Array(n.buffer,n.byteOffset,Math.floor(n.byteLength/4))}function Tu(...n){for(let e=0;e<n.length;e++)n[e].fill(0)}function eZ(n){return new DataView(n.buffer,n.byteOffset,n.byteLength)}const tZ=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function rZ(n){if(typeof n!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(n))}function M1(n){if(typeof n=="string")n=rZ(n);else if(JN(n))n=B1(n);else throw new Error("Uint8Array expected, got "+typeof n);return n}function nZ(n,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(n,e)}function iZ(n,e){if(n.length!==e.length)return!1;let t=0;for(let r=0;r<n.length;r++)t|=n[r]^e[r];return t===0}const sZ=(n,e)=>{function t(r,...i){if(Xn(r),!tZ)throw new Error("Non little-endian hardware is not yet supported");if(n.nonceLength!==void 0){const h=i[0];if(!h)throw new Error("nonce / iv required");n.varSizeNonce?Xn(h):Xn(h,n.nonceLength)}const s=n.tagLength;s&&i[1]!==void 0&&Xn(i[1]);const o=e(r,...i),a=(h,d)=>{if(d!==void 0){if(h!==2)throw new Error("cipher output not supported");Xn(d)}};let l=!1;return{encrypt(h,d){if(l)throw new Error("cannot encrypt() twice with same key + nonce");return l=!0,Xn(h),a(o.encrypt.length,d),o.encrypt(h,d)},decrypt(h,d){if(Xn(h),s&&h.length<s)throw new Error("invalid ciphertext length: smaller than tagLength="+s);return a(o.decrypt.length,d),o.decrypt(h,d)}}}return Object.assign(t,n),t};function zC(n,e,t=!0){if(e===void 0)return new Uint8Array(n);if(e.length!==n)throw new Error("invalid output length, expected "+n+", got: "+e.length);if(t&&!aZ(e))throw new Error("invalid output, must be aligned");return e}function KC(n,e,t,r){if(typeof n.setBigUint64=="function")return n.setBigUint64(e,t,r);const i=BigInt(32),s=BigInt(4294967295),o=Number(t>>i&s),a=Number(t&s),l=4,c=0;n.setUint32(e+l,o,r),n.setUint32(e+c,a,r)}function oZ(n,e,t){$1(t);const r=new Uint8Array(16),i=eZ(r);return KC(i,0,BigInt(e),t),KC(i,8,BigInt(n),t),r}function aZ(n){return n.byteOffset%4===0}function B1(n){return Uint8Array.from(n)}const eD=n=>Uint8Array.from(n.split("").map(e=>e.charCodeAt(0))),lZ=eD("expand 16-byte k"),cZ=eD("expand 32-byte k"),uZ=wa(lZ),hZ=wa(cZ);function Bt(n,e){return n<<e|n>>>32-e}function U1(n){return n.byteOffset%4===0}const gp=64,fZ=16,tD=2**32-1,VC=new Uint32Array;function dZ(n,e,t,r,i,s,o,a){const l=i.length,c=new Uint8Array(gp),h=wa(c),d=U1(i)&&U1(s),p=d?wa(i):VC,g=d?wa(s):VC;for(let m=0;m<l;o++){if(n(e,t,r,h,o,a),o>=tD)throw new Error("arx: counter overflow");const E=Math.min(gp,l-m);if(d&&E===gp){const y=m/4;if(m%4!==0)throw new Error("arx: invalid block position");for(let S=0,b;S<fZ;S++)b=y+S,g[b]=p[b]^h[S];m+=gp;continue}for(let y=0,S;y<E;y++)S=m+y,s[S]=i[S]^c[y];m+=E}}function pZ(n,e){const{allowShortKeys:t,extendNonceFn:r,counterLength:i,counterRight:s,rounds:o}=nZ({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof n!="function")throw new Error("core must be a function");return iw(i),iw(o),$1(s),$1(t),(a,l,c,h,d=0)=>{Xn(a),Xn(l),Xn(c);const p=c.length;if(h===void 0&&(h=new Uint8Array(p)),Xn(h),iw(d),d<0||d>=tD)throw new Error("arx: counter overflow");if(h.length<p)throw new Error(`arx: output (${h.length}) is shorter than data (${p})`);const g=[];let m=a.length,E,y;if(m===32)g.push(E=B1(a)),y=hZ;else if(m===16&&t)E=new Uint8Array(32),E.set(a),E.set(a,16),y=uZ,g.push(E);else throw new Error(`arx: invalid 32-byte key, got length=${m}`);U1(l)||g.push(l=B1(l));const S=wa(E);if(r){if(l.length!==24)throw new Error("arx: extended nonce must be 24 bytes");r(y,S,wa(l.subarray(0,16)),S),l=l.subarray(16)}const b=16-i;if(b!==l.length)throw new Error(`arx: nonce must be ${b} or 16 bytes`);if(b!==12){const I=new Uint8Array(12);I.set(l,s?0:12-l.length),l=I,g.push(l)}const _=wa(l);return dZ(n,y,S,_,c,h,d,o),Tu(...g),h}}const sn=(n,e)=>n[e++]&255|(n[e++]&255)<<8;class gZ{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=M1(e),Xn(e,32);const t=sn(e,0),r=sn(e,2),i=sn(e,4),s=sn(e,6),o=sn(e,8),a=sn(e,10),l=sn(e,12),c=sn(e,14);this.r[0]=t&8191,this.r[1]=(t>>>13|r<<3)&8191,this.r[2]=(r>>>10|i<<6)&7939,this.r[3]=(i>>>7|s<<9)&8191,this.r[4]=(s>>>4|o<<12)&255,this.r[5]=o>>>1&8190,this.r[6]=(o>>>14|a<<2)&8191,this.r[7]=(a>>>11|l<<5)&8065,this.r[8]=(l>>>8|c<<8)&8191,this.r[9]=c>>>5&127;for(let h=0;h<8;h++)this.pad[h]=sn(e,16+2*h)}process(e,t,r=!1){const i=r?0:2048,{h:s,r:o}=this,a=o[0],l=o[1],c=o[2],h=o[3],d=o[4],p=o[5],g=o[6],m=o[7],E=o[8],y=o[9],S=sn(e,t+0),b=sn(e,t+2),_=sn(e,t+4),I=sn(e,t+6),x=sn(e,t+8),$=sn(e,t+10),U=sn(e,t+12),O=sn(e,t+14);let P=s[0]+(S&8191),M=s[1]+((S>>>13|b<<3)&8191),K=s[2]+((b>>>10|_<<6)&8191),C=s[3]+((_>>>7|I<<9)&8191),B=s[4]+((I>>>4|x<<12)&8191),N=s[5]+(x>>>1&8191),L=s[6]+((x>>>14|$<<2)&8191),V=s[7]+(($>>>11|U<<5)&8191),W=s[8]+((U>>>8|O<<8)&8191),H=s[9]+(O>>>5|i),G=0,z=G+P*a+M*(5*y)+K*(5*E)+C*(5*m)+B*(5*g);G=z>>>13,z&=8191,z+=N*(5*p)+L*(5*d)+V*(5*h)+W*(5*c)+H*(5*l),G+=z>>>13,z&=8191;let Z=G+P*l+M*a+K*(5*y)+C*(5*E)+B*(5*m);G=Z>>>13,Z&=8191,Z+=N*(5*g)+L*(5*p)+V*(5*d)+W*(5*h)+H*(5*c),G+=Z>>>13,Z&=8191;let F=G+P*c+M*l+K*a+C*(5*y)+B*(5*E);G=F>>>13,F&=8191,F+=N*(5*m)+L*(5*g)+V*(5*p)+W*(5*d)+H*(5*h),G+=F>>>13,F&=8191;let ie=G+P*h+M*c+K*l+C*a+B*(5*y);G=ie>>>13,ie&=8191,ie+=N*(5*E)+L*(5*m)+V*(5*g)+W*(5*p)+H*(5*d),G+=ie>>>13,ie&=8191;let fe=G+P*d+M*h+K*c+C*l+B*a;G=fe>>>13,fe&=8191,fe+=N*(5*y)+L*(5*E)+V*(5*m)+W*(5*g)+H*(5*p),G+=fe>>>13,fe&=8191;let J=G+P*p+M*d+K*h+C*c+B*l;G=J>>>13,J&=8191,J+=N*a+L*(5*y)+V*(5*E)+W*(5*m)+H*(5*g),G+=J>>>13,J&=8191;let _e=G+P*g+M*p+K*d+C*h+B*c;G=_e>>>13,_e&=8191,_e+=N*l+L*a+V*(5*y)+W*(5*E)+H*(5*m),G+=_e>>>13,_e&=8191;let oe=G+P*m+M*g+K*p+C*d+B*h;G=oe>>>13,oe&=8191,oe+=N*c+L*l+V*a+W*(5*y)+H*(5*E),G+=oe>>>13,oe&=8191;let ne=G+P*E+M*m+K*g+C*p+B*d;G=ne>>>13,ne&=8191,ne+=N*h+L*c+V*l+W*a+H*(5*y),G+=ne>>>13,ne&=8191;let de=G+P*y+M*E+K*m+C*g+B*p;G=de>>>13,de&=8191,de+=N*d+L*h+V*c+W*l+H*a,G+=de>>>13,de&=8191,G=(G<<2)+G|0,G=G+z|0,z=G&8191,G=G>>>13,Z+=G,s[0]=z,s[1]=Z,s[2]=F,s[3]=ie,s[4]=fe,s[5]=J,s[6]=_e,s[7]=oe,s[8]=ne,s[9]=de}finalize(){const{h:e,pad:t}=this,r=new Uint16Array(10);let i=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=i,i=e[a]>>>13,e[a]&=8191;e[0]+=i*5,i=e[0]>>>13,e[0]&=8191,e[1]+=i,i=e[1]>>>13,e[1]&=8191,e[2]+=i,r[0]=e[0]+5,i=r[0]>>>13,r[0]&=8191;for(let a=1;a<10;a++)r[a]=e[a]+i,i=r[a]>>>13,r[a]&=8191;r[9]-=8192;let s=(i^1)-1;for(let a=0;a<10;a++)r[a]&=s;s=~s;for(let a=0;a<10;a++)e[a]=e[a]&s|r[a];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let o=e[0]+t[0];e[0]=o&65535;for(let a=1;a<8;a++)o=(e[a]+t[a]|0)+(o>>>16)|0,e[a]=o&65535;Tu(r)}update(e){WC(this),e=M1(e),Xn(e);const{buffer:t,blockLen:r}=this,i=e.length;for(let s=0;s<i;){const o=Math.min(r-this.pos,i-s);if(o===r){for(;r<=i-s;s+=r)this.process(e,s);continue}t.set(e.subarray(s,s+o),this.pos),this.pos+=o,s+=o,this.pos===r&&(this.process(t,0,!1),this.pos=0)}return this}destroy(){Tu(this.h,this.r,this.buffer,this.pad)}digestInto(e){WC(this),JX(e,this),this.finished=!0;const{buffer:t,h:r}=this;let{pos:i}=this;if(i){for(t[i++]=1;i<16;i++)t[i]=0;this.process(t,0,!0)}this.finalize();let s=0;for(let o=0;o<8;o++)e[s++]=r[o]>>>0,e[s++]=r[o]>>>8;return e}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const r=e.slice(0,t);return this.destroy(),r}}function mZ(n){const e=(r,i)=>n(i).update(M1(r)).digest(),t=n(new Uint8Array(32));return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=r=>n(r),e}const yZ=mZ(n=>new gZ(n));function bZ(n,e,t,r,i,s=20){let o=n[0],a=n[1],l=n[2],c=n[3],h=e[0],d=e[1],p=e[2],g=e[3],m=e[4],E=e[5],y=e[6],S=e[7],b=i,_=t[0],I=t[1],x=t[2],$=o,U=a,O=l,P=c,M=h,K=d,C=p,B=g,N=m,L=E,V=y,W=S,H=b,G=_,z=I,Z=x;for(let ie=0;ie<s;ie+=2)$=$+M|0,H=Bt(H^$,16),N=N+H|0,M=Bt(M^N,12),$=$+M|0,H=Bt(H^$,8),N=N+H|0,M=Bt(M^N,7),U=U+K|0,G=Bt(G^U,16),L=L+G|0,K=Bt(K^L,12),U=U+K|0,G=Bt(G^U,8),L=L+G|0,K=Bt(K^L,7),O=O+C|0,z=Bt(z^O,16),V=V+z|0,C=Bt(C^V,12),O=O+C|0,z=Bt(z^O,8),V=V+z|0,C=Bt(C^V,7),P=P+B|0,Z=Bt(Z^P,16),W=W+Z|0,B=Bt(B^W,12),P=P+B|0,Z=Bt(Z^P,8),W=W+Z|0,B=Bt(B^W,7),$=$+K|0,Z=Bt(Z^$,16),V=V+Z|0,K=Bt(K^V,12),$=$+K|0,Z=Bt(Z^$,8),V=V+Z|0,K=Bt(K^V,7),U=U+C|0,H=Bt(H^U,16),W=W+H|0,C=Bt(C^W,12),U=U+C|0,H=Bt(H^U,8),W=W+H|0,C=Bt(C^W,7),O=O+B|0,G=Bt(G^O,16),N=N+G|0,B=Bt(B^N,12),O=O+B|0,G=Bt(G^O,8),N=N+G|0,B=Bt(B^N,7),P=P+M|0,z=Bt(z^P,16),L=L+z|0,M=Bt(M^L,12),P=P+M|0,z=Bt(z^P,8),L=L+z|0,M=Bt(M^L,7);let F=0;r[F++]=o+$|0,r[F++]=a+U|0,r[F++]=l+O|0,r[F++]=c+P|0,r[F++]=h+M|0,r[F++]=d+K|0,r[F++]=p+C|0,r[F++]=g+B|0,r[F++]=m+N|0,r[F++]=E+L|0,r[F++]=y+V|0,r[F++]=S+W|0,r[F++]=b+H|0,r[F++]=_+G|0,r[F++]=I+z|0,r[F++]=x+Z|0}const wZ=pZ(bZ,{counterRight:!1,counterLength:4,allowShortKeys:!1}),vZ=new Uint8Array(16),GC=(n,e)=>{n.update(e);const t=e.length%16;t&&n.update(vZ.subarray(t))},_Z=new Uint8Array(32);function YC(n,e,t,r,i){const s=n(e,t,_Z),o=yZ.create(s);i&&GC(o,i),GC(o,r);const a=oZ(r.length,i?i.length:0,!0);o.update(a);const l=o.digest();return Tu(s,a),l}const EZ=n=>(e,t,r)=>({encrypt(s,o){const a=s.length;o=zC(a+16,o,!1),o.set(s);const l=o.subarray(0,-16);n(e,t,l,l,1);const c=YC(n,e,t,l,r);return o.set(c,a),Tu(c),o},decrypt(s,o){o=zC(s.length-16,o,!1);const a=s.subarray(0,-16),l=s.subarray(-16),c=YC(n,e,t,a,r);if(!iZ(l,c))throw new Error("invalid tag");return o.set(s.subarray(0,-16)),n(e,t,o,o,1),Tu(c),o}}),XC=sZ({blockSize:64,nonceLength:12,tagLength:16},EZ(wZ));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const VS=BigInt(0),F1=BigInt(1);function Fl(n,e=""){if(typeof n!="boolean"){const t=e&&`"${e}"`;throw new Error(t+"expected boolean, got type="+typeof n)}return n}function ss(n,e,t=""){const r=Vf(n),i=n==null?void 0:n.length,s=e!==void 0;if(!r||s&&i!==e){const o=t&&`"${t}" `,a=s?` of length ${e}`:"",l=r?`length=${i}`:`type=${typeof n}`;throw new Error(o+"expected Uint8Array"+a+", got "+l)}return n}function mp(n){const e=n.toString(16);return e.length&1?"0"+e:e}function rD(n){if(typeof n!="string")throw new Error("hex string expected, got "+typeof n);return n===""?VS:BigInt("0x"+n)}function Xy(n){return rD(Tl(n))}function jl(n){return Ta(n),rD(Tl(Uint8Array.from(n).reverse()))}function GS(n,e){return Im(n.toString(16).padStart(e*2,"0"))}function YS(n,e){return GS(n,e).reverse()}function wr(n,e,t){let r;if(typeof e=="string")try{r=Im(e)}catch(s){throw new Error(n+" must be hex string or Uint8Array, cause: "+s)}else if(Vf(e))r=Uint8Array.from(e);else throw new Error(n+" must be hex string or Uint8Array");const i=r.length;if(typeof t=="number"&&i!==t)throw new Error(n+" of length "+t+" expected, got "+i);return r}function ZC(n){return Uint8Array.from(n)}const sw=n=>typeof n=="bigint"&&VS<=n;function SZ(n,e,t){return sw(n)&&sw(e)&&sw(t)&&e<=n&&n<t}function Sf(n,e,t,r){if(!SZ(e,t,r))throw new Error("expected valid "+n+": "+t+" <= n < "+r+", got "+e)}function nD(n){let e;for(e=0;n>VS;n>>=F1,e+=1);return e}const rd=n=>(F1<<BigInt(n))-F1;function AZ(n,e,t){if(typeof n!="number"||n<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof t!="function")throw new Error("hmacFn must be a function");const r=g=>new Uint8Array(g),i=g=>Uint8Array.of(g);let s=r(n),o=r(n),a=0;const l=()=>{s.fill(1),o.fill(0),a=0},c=(...g)=>t(o,s,...g),h=(g=r(0))=>{o=c(i(0),g),s=c(),g.length!==0&&(o=c(i(1),g),s=c())},d=()=>{if(a++>=1e3)throw new Error("drbg: tried 1000 values");let g=0;const m=[];for(;g<e;){s=c();const E=s.slice();m.push(E),g+=s.length}return _s(...m)};return(g,m)=>{l(),h(g);let E;for(;!(E=m(d()));)h();return l(),E}}function Ku(n,e,t={}){if(!n||typeof n!="object")throw new Error("expected valid options object");function r(i,s,o){const a=n[i];if(o&&a===void 0)return;const l=typeof a;if(l!==s||a===null)throw new Error(`param "${i}" is invalid: expected ${s}, got ${l}`)}Object.entries(e).forEach(([i,s])=>r(i,s,!1)),Object.entries(t).forEach(([i,s])=>r(i,s,!0))}function Um(n){const e=new WeakMap;return(t,...r)=>{const i=e.get(t);if(i!==void 0)return i;const s=n(t,...r);return e.set(t,s),s}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const ti=BigInt(0),fn=BigInt(1),hl=BigInt(2),iD=BigInt(3),sD=BigInt(4),oD=BigInt(5),xZ=BigInt(7),aD=BigInt(8),IZ=BigInt(9),lD=BigInt(16);function Rr(n,e){const t=n%e;return t>=ti?t:e+t}function Ar(n,e,t){let r=n;for(;e-- >ti;)r*=r,r%=t;return r}function QC(n,e){if(n===ti)throw new Error("invert: expected non-zero number");if(e<=ti)throw new Error("invert: expected positive modulus, got "+e);let t=Rr(n,e),r=e,i=ti,s=fn;for(;t!==ti;){const a=r/t,l=r%t,c=i-s*a;r=t,t=l,i=s,s=c}if(r!==fn)throw new Error("invert: does not exist");return Rr(i,e)}function XS(n,e,t){if(!n.eql(n.sqr(e),t))throw new Error("Cannot find square root")}function cD(n,e){const t=(n.ORDER+fn)/sD,r=n.pow(e,t);return XS(n,r,e),r}function TZ(n,e){const t=(n.ORDER-oD)/aD,r=n.mul(e,hl),i=n.pow(r,t),s=n.mul(e,i),o=n.mul(n.mul(s,hl),i),a=n.mul(s,n.sub(o,n.ONE));return XS(n,a,e),a}function CZ(n){const e=Xl(n),t=uD(n),r=t(e,e.neg(e.ONE)),i=t(e,r),s=t(e,e.neg(r)),o=(n+xZ)/lD;return(a,l)=>{let c=a.pow(l,o),h=a.mul(c,r);const d=a.mul(c,i),p=a.mul(c,s),g=a.eql(a.sqr(h),l),m=a.eql(a.sqr(d),l);c=a.cmov(c,h,g),h=a.cmov(p,d,m);const E=a.eql(a.sqr(h),l),y=a.cmov(c,h,E);return XS(a,y,l),y}}function uD(n){if(n<iD)throw new Error("sqrt is not defined for small field");let e=n-fn,t=0;for(;e%hl===ti;)e/=hl,t++;let r=hl;const i=Xl(n);for(;JC(i,r)===1;)if(r++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(t===1)return cD;let s=i.pow(r,e);const o=(e+fn)/hl;return function(l,c){if(l.is0(c))return c;if(JC(l,c)!==1)throw new Error("Cannot find square root");let h=t,d=l.mul(l.ONE,s),p=l.pow(c,e),g=l.pow(c,o);for(;!l.eql(p,l.ONE);){if(l.is0(p))return l.ZERO;let m=1,E=l.sqr(p);for(;!l.eql(E,l.ONE);)if(m++,E=l.sqr(E),m===h)throw new Error("Cannot find square root");const y=fn<<BigInt(h-m-1),S=l.pow(d,y);h=m,d=l.sqr(S),p=l.mul(p,d),g=l.mul(g,S)}return g}}function kZ(n){return n%sD===iD?cD:n%aD===oD?TZ:n%lD===IZ?CZ(n):uD(n)}const PZ=(n,e)=>(Rr(n,e)&fn)===fn,RZ=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function OZ(n){const e={ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"},t=RZ.reduce((r,i)=>(r[i]="function",r),e);return Ku(n,t),n}function LZ(n,e,t){if(t<ti)throw new Error("invalid exponent, negatives unsupported");if(t===ti)return n.ONE;if(t===fn)return e;let r=n.ONE,i=e;for(;t>ti;)t&fn&&(r=n.mul(r,i)),i=n.sqr(i),t>>=fn;return r}function hD(n,e,t=!1){const r=new Array(e.length).fill(t?n.ZERO:void 0),i=e.reduce((o,a,l)=>n.is0(a)?o:(r[l]=o,n.mul(o,a)),n.ONE),s=n.inv(i);return e.reduceRight((o,a,l)=>n.is0(a)?o:(r[l]=n.mul(o,r[l]),n.mul(o,a)),s),r}function JC(n,e){const t=(n.ORDER-fn)/hl,r=n.pow(e,t),i=n.eql(r,n.ONE),s=n.eql(r,n.ZERO),o=n.eql(r,n.neg(n.ONE));if(!i&&!s&&!o)throw new Error("invalid Legendre symbol result");return i?1:s?0:-1}function fD(n,e){e!==void 0&&Am(e);const t=e!==void 0?e:n.toString(2).length,r=Math.ceil(t/8);return{nBitLength:t,nByteLength:r}}function Xl(n,e,t=!1,r={}){if(n<=ti)throw new Error("invalid field: expected ORDER > 0, got "+n);let i,s,o=!1,a;if(typeof e=="object"&&e!=null){if(r.sqrt||t)throw new Error("cannot specify opts in two arguments");const p=e;p.BITS&&(i=p.BITS),p.sqrt&&(s=p.sqrt),typeof p.isLE=="boolean"&&(t=p.isLE),typeof p.modFromBytes=="boolean"&&(o=p.modFromBytes),a=p.allowedLengths}else typeof e=="number"&&(i=e),r.sqrt&&(s=r.sqrt);const{nBitLength:l,nByteLength:c}=fD(n,i);if(c>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let h;const d=Object.freeze({ORDER:n,isLE:t,BITS:l,BYTES:c,MASK:rd(l),ZERO:ti,ONE:fn,allowedLengths:a,create:p=>Rr(p,n),isValid:p=>{if(typeof p!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof p);return ti<=p&&p<n},is0:p=>p===ti,isValidNot0:p=>!d.is0(p)&&d.isValid(p),isOdd:p=>(p&fn)===fn,neg:p=>Rr(-p,n),eql:(p,g)=>p===g,sqr:p=>Rr(p*p,n),add:(p,g)=>Rr(p+g,n),sub:(p,g)=>Rr(p-g,n),mul:(p,g)=>Rr(p*g,n),pow:(p,g)=>LZ(d,p,g),div:(p,g)=>Rr(p*QC(g,n),n),sqrN:p=>p*p,addN:(p,g)=>p+g,subN:(p,g)=>p-g,mulN:(p,g)=>p*g,inv:p=>QC(p,n),sqrt:s||(p=>(h||(h=kZ(n)),h(d,p))),toBytes:p=>t?YS(p,c):GS(p,c),fromBytes:(p,g=!0)=>{if(a){if(!a.includes(p.length)||p.length>c)throw new Error("Field.fromBytes: expected "+a+" bytes, got "+p.length);const E=new Uint8Array(c);E.set(p,t?0:E.length-p.length),p=E}if(p.length!==c)throw new Error("Field.fromBytes: expected "+c+" bytes, got "+p.length);let m=t?jl(p):Xy(p);if(o&&(m=Rr(m,n)),!g&&!d.isValid(m))throw new Error("invalid field element: outside of range 0..ORDER");return m},invertBatch:p=>hD(d,p),cmov:(p,g,m)=>m?g:p});return Object.freeze(d)}function dD(n){if(typeof n!="bigint")throw new Error("field order must be bigint");const e=n.toString(2).length;return Math.ceil(e/8)}function pD(n){const e=dD(n);return e+Math.ceil(e/2)}function NZ(n,e,t=!1){const r=n.length,i=dD(e),s=pD(e);if(r<16||r<s||r>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+r);const o=t?jl(n):Xy(n),a=Rr(o,e-fn)+fn;return t?YS(a,i):GS(a,i)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Cu=BigInt(0),fl=BigInt(1);function Fm(n,e){const t=e.negate();return n?t:e}function dl(n,e){const t=hD(n.Fp,e.map(r=>r.Z));return e.map((r,i)=>n.fromAffine(r.toAffine(t[i])))}function gD(n,e){if(!Number.isSafeInteger(n)||n<=0||n>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+n)}function ow(n,e){gD(n,e);const t=Math.ceil(e/n)+1,r=2**(n-1),i=2**n,s=rd(n),o=BigInt(n);return{windows:t,windowSize:r,mask:s,maxNumber:i,shiftBy:o}}function ek(n,e,t){const{windowSize:r,mask:i,maxNumber:s,shiftBy:o}=t;let a=Number(n&i),l=n>>o;a>r&&(a-=s,l+=fl);const c=e*r,h=c+Math.abs(a)-1,d=a===0,p=a<0,g=e%2!==0;return{nextN:l,offset:h,isZero:d,isNeg:p,isNegF:g,offsetF:c}}function DZ(n,e){if(!Array.isArray(n))throw new Error("array expected");n.forEach((t,r)=>{if(!(t instanceof e))throw new Error("invalid point at index "+r)})}function $Z(n,e){if(!Array.isArray(n))throw new Error("array of scalars expected");n.forEach((t,r)=>{if(!e.isValid(t))throw new Error("invalid scalar at index "+r)})}const aw=new WeakMap,mD=new WeakMap;function lw(n){return mD.get(n)||1}function tk(n){if(n!==Cu)throw new Error("invalid wNAF")}class yD{constructor(e,t){this.BASE=e.BASE,this.ZERO=e.ZERO,this.Fn=e.Fn,this.bits=t}_unsafeLadder(e,t,r=this.ZERO){let i=e;for(;t>Cu;)t&fl&&(r=r.add(i)),i=i.double(),t>>=fl;return r}precomputeWindow(e,t){const{windows:r,windowSize:i}=ow(t,this.bits),s=[];let o=e,a=o;for(let l=0;l<r;l++){a=o,s.push(a);for(let c=1;c<i;c++)a=a.add(o),s.push(a);o=a.double()}return s}wNAF(e,t,r){if(!this.Fn.isValid(r))throw new Error("invalid scalar");let i=this.ZERO,s=this.BASE;const o=ow(e,this.bits);for(let a=0;a<o.windows;a++){const{nextN:l,offset:c,isZero:h,isNeg:d,isNegF:p,offsetF:g}=ek(r,a,o);r=l,h?s=s.add(Fm(p,t[g])):i=i.add(Fm(d,t[c]))}return tk(r),{p:i,f:s}}wNAFUnsafe(e,t,r,i=this.ZERO){const s=ow(e,this.bits);for(let o=0;o<s.windows&&r!==Cu;o++){const{nextN:a,offset:l,isZero:c,isNeg:h}=ek(r,o,s);if(r=a,!c){const d=t[l];i=i.add(h?d.negate():d)}}return tk(r),i}getPrecomputes(e,t,r){let i=aw.get(t);return i||(i=this.precomputeWindow(t,e),e!==1&&(typeof r=="function"&&(i=r(i)),aw.set(t,i))),i}cached(e,t,r){const i=lw(e);return this.wNAF(i,this.getPrecomputes(i,e,r),t)}unsafe(e,t,r,i){const s=lw(e);return s===1?this._unsafeLadder(e,t,i):this.wNAFUnsafe(s,this.getPrecomputes(s,e,r),t,i)}createCache(e,t){gD(t,this.bits),mD.set(e,t),aw.delete(e)}hasCache(e){return lw(e)!==1}}function MZ(n,e,t,r){let i=e,s=n.ZERO,o=n.ZERO;for(;t>Cu||r>Cu;)t&fl&&(s=s.add(i)),r&fl&&(o=o.add(i)),i=i.double(),t>>=fl,r>>=fl;return{p1:s,p2:o}}function bD(n,e,t,r){DZ(t,n),$Z(r,e);const i=t.length,s=r.length;if(i!==s)throw new Error("arrays of points and scalars must have equal length");const o=n.ZERO,a=nD(BigInt(i));let l=1;a>12?l=a-3:a>4?l=a-2:a>0&&(l=2);const c=rd(l),h=new Array(Number(c)+1).fill(o),d=Math.floor((e.BITS-1)/l)*l;let p=o;for(let g=d;g>=0;g-=l){h.fill(o);for(let E=0;E<s;E++){const y=r[E],S=Number(y>>BigInt(g)&c);h[S]=h[S].add(t[E])}let m=o;for(let E=h.length-1,y=o;E>0;E--)y=y.add(h[E]),m=m.add(y);if(p=p.add(m),g!==0)for(let E=0;E<l;E++)p=p.double()}return p}function rk(n,e,t){if(e){if(e.ORDER!==n)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return OZ(e),e}else return Xl(n,{isLE:t})}function wD(n,e,t={},r){if(r===void 0&&(r=n==="edwards"),!e||typeof e!="object")throw new Error(`expected valid ${n} CURVE object`);for(const l of["p","n","h"]){const c=e[l];if(!(typeof c=="bigint"&&c>Cu))throw new Error(`CURVE.${l} must be positive bigint`)}const i=rk(e.p,t.Fp,r),s=rk(e.n,t.Fn,r),a=["Gx","Gy","a",n==="weierstrass"?"b":"d"];for(const l of a)if(!i.isValid(e[l]))throw new Error(`CURVE.${l} must be valid field element of CURVE.Fp`);return e=Object.freeze(Object.assign({},e)),{CURVE:e,Fp:i,Fn:s}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Vo=BigInt(0),Zr=BigInt(1),cw=BigInt(2),BZ=BigInt(8);function UZ(n,e,t,r){const i=n.sqr(t),s=n.sqr(r),o=n.add(n.mul(e.a,i),s),a=n.add(n.ONE,n.mul(e.d,n.mul(i,s)));return n.eql(o,a)}function FZ(n,e={}){const t=wD("edwards",n,e,e.FpFnLE),{Fp:r,Fn:i}=t;let s=t.CURVE;const{h:o}=s;Ku(e,{},{uvRatio:"function"});const a=cw<<BigInt(i.BYTES*8)-Zr,l=y=>r.create(y),c=e.uvRatio||((y,S)=>{try{return{isValid:!0,value:r.sqrt(r.div(y,S))}}catch{return{isValid:!1,value:Vo}}});if(!UZ(r,s,s.Gx,s.Gy))throw new Error("bad curve params: generator point");function h(y,S,b=!1){const _=b?Zr:Vo;return Sf("coordinate "+y,S,_,a),S}function d(y){if(!(y instanceof m))throw new Error("ExtendedPoint expected")}const p=Um((y,S)=>{const{X:b,Y:_,Z:I}=y,x=y.is0();S==null&&(S=x?BZ:r.inv(I));const $=l(b*S),U=l(_*S),O=r.mul(I,S);if(x)return{x:Vo,y:Zr};if(O!==Zr)throw new Error("invZ was invalid");return{x:$,y:U}}),g=Um(y=>{const{a:S,d:b}=s;if(y.is0())throw new Error("bad point: ZERO");const{X:_,Y:I,Z:x,T:$}=y,U=l(_*_),O=l(I*I),P=l(x*x),M=l(P*P),K=l(U*S),C=l(P*l(K+O)),B=l(M+l(b*l(U*O)));if(C!==B)throw new Error("bad point: equation left != right (1)");const N=l(_*I),L=l(x*$);if(N!==L)throw new Error("bad point: equation left != right (2)");return!0});class m{constructor(S,b,_,I){this.X=h("x",S),this.Y=h("y",b),this.Z=h("z",_,!0),this.T=h("t",I),Object.freeze(this)}static CURVE(){return s}static fromAffine(S){if(S instanceof m)throw new Error("extended point not allowed");const{x:b,y:_}=S||{};return h("x",b),h("y",_),new m(b,_,Zr,l(b*_))}static fromBytes(S,b=!1){const _=r.BYTES,{a:I,d:x}=s;S=ZC(ss(S,_,"point")),Fl(b,"zip215");const $=ZC(S),U=S[_-1];$[_-1]=U&-129;const O=jl($),P=b?a:r.ORDER;Sf("point.y",O,Vo,P);const M=l(O*O),K=l(M-Zr),C=l(x*M-I);let{isValid:B,value:N}=c(K,C);if(!B)throw new Error("bad point: invalid y coordinate");const L=(N&Zr)===Zr,V=(U&128)!==0;if(!b&&N===Vo&&V)throw new Error("bad point: x=0 and x_0=1");return V!==L&&(N=l(-N)),m.fromAffine({x:N,y:O})}static fromHex(S,b=!1){return m.fromBytes(wr("point",S),b)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(S=8,b=!0){return E.createCache(this,S),b||this.multiply(cw),this}assertValidity(){g(this)}equals(S){d(S);const{X:b,Y:_,Z:I}=this,{X:x,Y:$,Z:U}=S,O=l(b*U),P=l(x*I),M=l(_*U),K=l($*I);return O===P&&M===K}is0(){return this.equals(m.ZERO)}negate(){return new m(l(-this.X),this.Y,this.Z,l(-this.T))}double(){const{a:S}=s,{X:b,Y:_,Z:I}=this,x=l(b*b),$=l(_*_),U=l(cw*l(I*I)),O=l(S*x),P=b+_,M=l(l(P*P)-x-$),K=O+$,C=K-U,B=O-$,N=l(M*C),L=l(K*B),V=l(M*B),W=l(C*K);return new m(N,L,W,V)}add(S){d(S);const{a:b,d:_}=s,{X:I,Y:x,Z:$,T:U}=this,{X:O,Y:P,Z:M,T:K}=S,C=l(I*O),B=l(x*P),N=l(U*_*K),L=l($*M),V=l((I+x)*(O+P)-C-B),W=L-N,H=L+N,G=l(B-b*C),z=l(V*W),Z=l(H*G),F=l(V*G),ie=l(W*H);return new m(z,Z,ie,F)}subtract(S){return this.add(S.negate())}multiply(S){if(!i.isValidNot0(S))throw new Error("invalid scalar: expected 1 <= sc < curve.n");const{p:b,f:_}=E.cached(this,S,I=>dl(m,I));return dl(m,[b,_])[0]}multiplyUnsafe(S,b=m.ZERO){if(!i.isValid(S))throw new Error("invalid scalar: expected 0 <= sc < curve.n");return S===Vo?m.ZERO:this.is0()||S===Zr?this:E.unsafe(this,S,_=>dl(m,_),b)}isSmallOrder(){return this.multiplyUnsafe(o).is0()}isTorsionFree(){return E.unsafe(this,s.n).is0()}toAffine(S){return p(this,S)}clearCofactor(){return o===Zr?this:this.multiplyUnsafe(o)}toBytes(){const{x:S,y:b}=this.toAffine(),_=r.toBytes(b);return _[_.length-1]|=S&Zr?128:0,_}toHex(){return Tl(this.toBytes())}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get ex(){return this.X}get ey(){return this.Y}get ez(){return this.Z}get et(){return this.T}static normalizeZ(S){return dl(m,S)}static msm(S,b){return bD(m,i,S,b)}_setWindowSize(S){this.precompute(S)}toRawBytes(){return this.toBytes()}}m.BASE=new m(s.Gx,s.Gy,Zr,l(s.Gx*s.Gy)),m.ZERO=new m(Vo,Zr,Zr,Vo),m.Fp=r,m.Fn=i;const E=new yD(m,i.BITS);return m.BASE.precompute(8),m}function jZ(n,e,t={}){if(typeof e!="function")throw new Error('"hash" function param is required');Ku(t,{},{adjustScalarBytes:"function",randomBytes:"function",domain:"function",prehash:"function",mapToCurve:"function"});const{prehash:r}=t,{BASE:i,Fp:s,Fn:o}=n,a=t.randomBytes||Ly,l=t.adjustScalarBytes||(P=>P),c=t.domain||((P,M,K)=>{if(Fl(K,"phflag"),M.length||K)throw new Error("Contexts/pre-hash are not supported");return P});function h(P){return o.create(jl(P))}function d(P){const M=_.secretKey;P=wr("private key",P,M);const K=wr("hashed private key",e(P),2*M),C=l(K.slice(0,M)),B=K.slice(M,2*M),N=h(C);return{head:C,prefix:B,scalar:N}}function p(P){const{head:M,prefix:K,scalar:C}=d(P),B=i.multiply(C),N=B.toBytes();return{head:M,prefix:K,scalar:C,point:B,pointBytes:N}}function g(P){return p(P).pointBytes}function m(P=Uint8Array.of(),...M){const K=_s(...M);return h(e(c(K,wr("context",P),!!r)))}function E(P,M,K={}){P=wr("message",P),r&&(P=r(P));const{prefix:C,scalar:B,pointBytes:N}=p(M),L=m(K.context,C,P),V=i.multiply(L).toBytes(),W=m(K.context,V,N,P),H=o.create(L+W*B);if(!o.isValid(H))throw new Error("sign failed: invalid s");const G=_s(V,o.toBytes(H));return ss(G,_.signature,"result")}const y={zip215:!0};function S(P,M,K,C=y){const{context:B,zip215:N}=C,L=_.signature;P=wr("signature",P,L),M=wr("message",M),K=wr("publicKey",K,_.publicKey),N!==void 0&&Fl(N,"zip215"),r&&(M=r(M));const V=L/2,W=P.subarray(0,V),H=jl(P.subarray(V,L));let G,z,Z;try{G=n.fromBytes(K,N),z=n.fromBytes(W,N),Z=i.multiplyUnsafe(H)}catch{return!1}if(!N&&G.isSmallOrder())return!1;const F=m(B,z.toBytes(),G.toBytes(),M);return z.add(G.multiplyUnsafe(F)).subtract(Z).clearCofactor().is0()}const b=s.BYTES,_={secretKey:b,publicKey:b,signature:2*b,seed:b};function I(P=a(_.seed)){return ss(P,_.seed,"seed")}function x(P){const M=O.randomSecretKey(P);return{secretKey:M,publicKey:g(M)}}function $(P){return Vf(P)&&P.length===o.BYTES}function U(P,M){try{return!!n.fromBytes(P,M)}catch{return!1}}const O={getExtendedPublicKey:p,randomSecretKey:I,isValidSecretKey:$,isValidPublicKey:U,toMontgomery(P){const{y:M}=n.fromBytes(P),K=_.publicKey,C=K===32;if(!C&&K!==57)throw new Error("only defined for 25519 and 448");const B=C?s.div(Zr+M,Zr-M):s.div(M-Zr,M+Zr);return s.toBytes(B)},toMontgomerySecret(P){const M=_.secretKey;ss(P,M);const K=e(P.subarray(0,M));return l(K).subarray(0,M)},randomPrivateKey:I,precompute(P=8,M=n.BASE){return M.precompute(P,!1)}};return Object.freeze({keygen:x,getPublicKey:g,sign:E,verify:S,utils:O,Point:n,lengths:_})}function qZ(n){const e={a:n.a,d:n.d,p:n.Fp.ORDER,n:n.n,h:n.h,Gx:n.Gx,Gy:n.Gy},t=n.Fp,r=Xl(e.n,n.nBitLength,!0),i={Fp:t,Fn:r,uvRatio:n.uvRatio},s={randomBytes:n.randomBytes,adjustScalarBytes:n.adjustScalarBytes,domain:n.domain,prehash:n.prehash,mapToCurve:n.mapToCurve};return{CURVE:e,curveOpts:i,hash:n.hash,eddsaOpts:s}}function HZ(n,e){const t=e.Point;return Object.assign({},e,{ExtendedPoint:t,CURVE:n,nBitLength:t.Fn.BITS,nByteLength:t.Fn.BYTES})}function WZ(n){const{CURVE:e,curveOpts:t,hash:r,eddsaOpts:i}=qZ(n),s=FZ(e,t),o=jZ(s,r,i);return HZ(n,o)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const vh=BigInt(0),Tc=BigInt(1),yp=BigInt(2);function zZ(n){return Ku(n,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze({...n})}function KZ(n){const e=zZ(n),{P:t,type:r,adjustScalarBytes:i,powPminus2:s,randomBytes:o}=e,a=r==="x25519";if(!a&&r!=="x448")throw new Error("invalid type");const l=o||Ly,c=a?255:448,h=a?32:56,d=BigInt(a?9:5),p=BigInt(a?121665:39081),g=a?yp**BigInt(254):yp**BigInt(447),m=a?BigInt(8)*yp**BigInt(251)-Tc:BigInt(4)*yp**BigInt(445)-Tc,E=g+m+Tc,y=B=>Rr(B,t),S=b(d);function b(B){return YS(y(B),h)}function _(B){const N=wr("u coordinate",B,h);return a&&(N[31]&=127),y(jl(N))}function I(B){return jl(i(wr("scalar",B,h)))}function x(B,N){const L=O(_(N),I(B));if(L===vh)throw new Error("invalid private or public key received");return b(L)}function $(B){return x(B,S)}function U(B,N,L){const V=y(B*(N-L));return N=y(N-V),L=y(L+V),{x_2:N,x_3:L}}function O(B,N){Sf("u",B,vh,t),Sf("scalar",N,g,E);const L=N,V=B;let W=Tc,H=vh,G=B,z=Tc,Z=vh;for(let ie=BigInt(c-1);ie>=vh;ie--){const fe=L>>ie&Tc;Z^=fe,{x_2:W,x_3:G}=U(Z,W,G),{x_2:H,x_3:z}=U(Z,H,z),Z=fe;const J=W+H,_e=y(J*J),oe=W-H,ne=y(oe*oe),de=_e-ne,k=G+z,X=G-z,ee=y(X*J),me=y(k*oe),be=ee+me,te=ee-me;G=y(be*be),z=y(V*y(te*te)),W=y(_e*ne),H=y(de*(_e+y(p*de)))}({x_2:W,x_3:G}=U(Z,W,G)),{x_2:H,x_3:z}=U(Z,H,z);const F=s(H);return y(W*F)}const P={secretKey:h,publicKey:h,seed:h},M=(B=l(h))=>(Ta(B,P.seed),B);function K(B){const N=M(B);return{secretKey:N,publicKey:$(N)}}return{keygen:K,getSharedSecret:(B,N)=>x(B,N),getPublicKey:B=>$(B),scalarMult:x,scalarMultBase:$,utils:{randomSecretKey:M,randomPrivateKey:M},GuBytes:S.slice(),lengths:P}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const VZ=BigInt(1),nk=BigInt(2),GZ=BigInt(3),YZ=BigInt(5),XZ=BigInt(8),ZS=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),vD={p:ZS,n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),h:XZ,a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")};function _D(n){const e=BigInt(10),t=BigInt(20),r=BigInt(40),i=BigInt(80),s=ZS,a=n*n%s*n%s,l=Ar(a,nk,s)*a%s,c=Ar(l,VZ,s)*n%s,h=Ar(c,YZ,s)*c%s,d=Ar(h,e,s)*h%s,p=Ar(d,t,s)*d%s,g=Ar(p,r,s)*p%s,m=Ar(g,i,s)*g%s,E=Ar(m,i,s)*g%s,y=Ar(E,e,s)*h%s;return{pow_p_5_8:Ar(y,nk,s)*n%s,b2:a}}function ED(n){return n[0]&=248,n[31]&=127,n[31]|=64,n}const ik=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");function ZZ(n,e){const t=ZS,r=Rr(e*e*e,t),i=Rr(r*r*e,t),s=_D(n*i).pow_p_5_8;let o=Rr(n*r*s,t);const a=Rr(e*o*o,t),l=o,c=Rr(o*ik,t),h=a===n,d=a===Rr(-n,t),p=a===Rr(-n*ik,t);return h&&(o=l),(d||p)&&(o=c),PZ(o,t)&&(o=Rr(-o,t)),{isValid:h||d,value:o}}const SD=Xl(vD.p,{isLE:!0}),QZ={...vD,Fp:SD,hash:Az,adjustScalarBytes:ED,uvRatio:ZZ},JZ=WZ(QZ),bp=(()=>{const n=SD.ORDER;return KZ({P:n,type:"x25519",powPminus2:e=>{const{pow_p_5_8:t,b2:r}=_D(e);return Rr(Ar(t,GZ,n)*r,n)},adjustScalarBytes:ED})})();class AD extends pL{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,Oy(e);const r=cf(t);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(r.length>i?e.create().update(r).digest():r);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),Nl(s)}update(e){return xm(this),this.iHash.update(e),this}digestInto(e){xm(this),Ta(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:r,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return e=e,e.finished=i,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=t._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const Zy=(n,e,t)=>new AD(n,e).update(t).digest();Zy.create=(n,e)=>new AD(n,e);function eQ(n,e,t){return Oy(n),t===void 0&&(t=new Uint8Array(n.outputLen)),Zy(n,cf(t),cf(e))}const uw=Uint8Array.from([0]),sk=Uint8Array.of();function tQ(n,e,t,r=32){Oy(n),Am(r);const i=n.outputLen;if(r>255*i)throw new Error("Length should be <= 255*HashLen");const s=Math.ceil(r/i);t===void 0&&(t=sk);const o=new Uint8Array(s*i),a=Zy.create(n,e),l=a._cloneInto(),c=new Uint8Array(a.outputLen);for(let h=0;h<s;h++)uw[0]=h+1,l.update(h===0?sk:c).update(t).update(uw).digestInto(c),o.set(c,i*h),a._cloneInto(l);return a.destroy(),l.destroy(),Nl(c,uw),o.slice(0,r)}const rQ={hashSHA256(n){return Kc(n.subarray())},getHKDF(n,e){const t=eQ(Kc,e,n),i=tQ(Kc,t,void 0,96),s=i.subarray(0,32),o=i.subarray(32,64),a=i.subarray(64,96);return[s,o,a]},generateX25519KeyPair(){const n=bp.utils.randomPrivateKey();return{publicKey:bp.getPublicKey(n),privateKey:n}},generateX25519KeyPairFromSeed(n){return{publicKey:bp.getPublicKey(n),privateKey:n}},generateX25519SharedKey(n,e){return bp.getSharedSecret(n.subarray(),e.subarray())},chaCha20Poly1305Encrypt(n,e,t,r){return XC(r,e,t).encrypt(n.subarray())},chaCha20Poly1305Decrypt(n,e,t,r,i){return XC(r,e,t).decrypt(n.subarray(),i)}},nQ=rQ;function iQ(n){return{generateKeypair:n.generateX25519KeyPair,dh:(e,t)=>n.generateX25519SharedKey(e.privateKey,t).subarray(0,32),encrypt:n.chaCha20Poly1305Encrypt,decrypt:n.chaCha20Poly1305Decrypt,hash:n.hashSHA256,hkdf:n.getHKDF}}const jm=n=>{const e=Ei(2);return e[0]=n>>8,e[1]=n,e};jm.bytes=2;const Tg=n=>{if(n.length<2)throw RangeError("Could not decode int16BE");if(n instanceof Uint8Array){let e=0;return e+=n[0]<<8,e+=n[1],e}return n.getUint16(0)};Tg.bytes=2;function sQ(n){return{xxHandshakeSuccesses:n.registerCounter("libp2p_noise_xxhandshake_successes_total",{help:"Total count of noise xxHandshakes successes_"}),xxHandshakeErrors:n.registerCounter("libp2p_noise_xxhandshake_error_total",{help:"Total count of noise xxHandshakes errors"}),encryptedPackets:n.registerCounter("libp2p_noise_encrypted_packets_total",{help:"Total count of noise encrypted packets successfully"}),decryptedPackets:n.registerCounter("libp2p_noise_decrypted_packets_total",{help:"Total count of noise decrypted packets"}),decryptErrors:n.registerCounter("libp2p_noise_decrypt_errors_total",{help:"Total count of noise decrypt errors"})}}function xD(n,e){!e.enabled||!td||(n?(e(`LOCAL_STATIC_PUBLIC_KEY ${mt(n.publicKey,"hex")}`),e(`LOCAL_STATIC_PRIVATE_KEY ${mt(n.privateKey,"hex")}`)):e("Missing local static keys."))}function ID(n,e){!e.enabled||!td||(n?(e(`LOCAL_PUBLIC_EPHEMERAL_KEY ${mt(n.publicKey,"hex")}`),e(`LOCAL_PRIVATE_EPHEMERAL_KEY ${mt(n.privateKey,"hex")}`)):e("Missing local ephemeral keys."))}function oQ(n,e){!e.enabled||!td||e(n?`REMOTE_STATIC_PUBLIC_KEY ${mt(n.subarray(),"hex")}`:"Missing remote static public key.")}function TD(n,e){!e.enabled||!td||e(n?`REMOTE_EPHEMERAL_PUBLIC_KEY ${mt(n.subarray(),"hex")}`:"Missing remote ephemeral keys.")}function CD(n,e,t){!t.enabled||!td||(t(`CIPHER_STATE_1 ${n.n.getUint64()} ${n.k&&mt(n.k,"hex")}`),t(`CIPHER_STATE_2 ${e.n.getUint64()} ${e.k&&mt(e.k,"hex")}`))}const gy=class gy extends Error{constructor(t="Invalid crypto exchange"){super(t);v(this,"code");this.code=gy.code}};v(gy,"code","ERR_INVALID_CRYPTO_EXCHANGE");let Yh=gy;const aQ=0,lQ=4294967295,cQ="Cipherstate has reached maximum n, a new handshake must be performed";class uQ{constructor(e=aQ){v(this,"n");v(this,"bytes");v(this,"view");this.n=e,this.bytes=Je(12),this.view=new DataView(this.bytes.buffer,this.bytes.byteOffset,this.bytes.byteLength),this.view.setUint32(4,e,!0)}increment(){this.n++,this.view.setUint32(4,this.n,!0)}getBytes(){return this.bytes}getUint64(){return this.n}assertValue(){if(this.n>lQ)throw new Error(cQ)}}const Xc=Je(0);class wp{constructor(e,t=void 0,r=0){v(this,"k");v(this,"n");v(this,"crypto");this.crypto=e,this.k=t,this.n=new uQ(r)}hasKey(){return!!this.k}encryptWithAd(e,t){if(!this.hasKey())return t;this.n.assertValue();const r=this.crypto.encrypt(t,this.n.getBytes(),e,this.k);return this.n.increment(),r}decryptWithAd(e,t,r){if(!this.hasKey())return t;this.n.assertValue();const i=this.crypto.decrypt(t,this.n.getBytes(),e,this.k,r);return this.n.increment(),i}}class hQ{constructor(e,t){v(this,"cs");v(this,"ck");v(this,"h");v(this,"crypto");this.crypto=e;const r=at(t,"utf-8");this.h=dQ(e,r),this.ck=this.h,this.cs=new wp(e)}mixKey(e){const[t,r]=this.crypto.hkdf(this.ck,e);this.ck=t,this.cs=new wp(this.crypto,r)}mixHash(e){this.h=this.crypto.hash(new bt(this.h,e))}encryptAndHash(e){const t=this.cs.encryptWithAd(this.h,e);return this.mixHash(t),t}decryptAndHash(e){const t=this.cs.decryptWithAd(this.h,e);return this.mixHash(e),t}split(){const[e,t]=this.crypto.hkdf(this.ck,Xc);return[new wp(this.crypto,e),new wp(this.crypto,t)]}}class fQ{constructor(e){v(this,"ss");v(this,"s");v(this,"e");v(this,"rs");v(this,"re");v(this,"initiator");v(this,"crypto");const{crypto:t,protocolName:r,prologue:i,initiator:s,s:o,e:a,rs:l,re:c}=e;this.crypto=t,this.ss=new hQ(t,r),this.ss.mixHash(i),this.initiator=s,this.s=o,this.e=a,this.rs=l,this.re=c}writeE(){if(this.e)throw new Error("ephemeral keypair is already set");const e=this.crypto.generateKeypair();return this.ss.mixHash(e.publicKey),this.e=e,e.publicKey}writeS(){if(!this.s)throw new Error("static keypair is not set");return this.ss.encryptAndHash(this.s.publicKey)}writeEE(){if(!this.e)throw new Error("ephemeral keypair is not set");if(!this.re)throw new Error("remote ephemeral public key is not set");this.ss.mixKey(this.crypto.dh(this.e,this.re))}writeES(){if(this.initiator){if(!this.e)throw new Error("ephemeral keypair is not set");if(!this.rs)throw new Error("remote static public key is not set");this.ss.mixKey(this.crypto.dh(this.e,this.rs))}else{if(!this.s)throw new Error("static keypair is not set");if(!this.re)throw new Error("remote ephemeral public key is not set");this.ss.mixKey(this.crypto.dh(this.s,this.re))}}writeSE(){if(this.initiator){if(!this.s)throw new Error("static keypair is not set");if(!this.re)throw new Error("remote ephemeral public key is not set");this.ss.mixKey(this.crypto.dh(this.s,this.re))}else{if(!this.e)throw new Error("ephemeral keypair is not set");if(!this.rs)throw new Error("remote static public key is not set");this.ss.mixKey(this.crypto.dh(this.e,this.rs))}}readE(e,t=0){if(this.re)throw new Error("remote ephemeral public key is already set");if(e.byteLength<t+32)throw new Error("message is not long enough");this.re=e.sublist(t,t+32),this.ss.mixHash(this.re)}readS(e,t=0){if(this.rs)throw new Error("remote static public key is already set");const r=32+(this.ss.cs.hasKey()?16:0);if(e.byteLength<t+r)throw new Error("message is not long enough");const i=e.sublist(t,t+r);return this.rs=this.ss.decryptAndHash(i),r}readEE(){this.writeEE()}readES(){this.writeES()}readSE(){this.writeSE()}}class kD extends fQ{writeMessageA(e){return new bt(this.writeE(),this.ss.encryptAndHash(e))}writeMessageB(e){const t=this.writeE();this.writeEE();const r=this.writeS();return this.writeES(),new bt(t,r,this.ss.encryptAndHash(e))}writeMessageC(e){const t=this.writeS();return this.writeSE(),new bt(t,this.ss.encryptAndHash(e))}readMessageA(e){try{return this.readE(e),this.ss.decryptAndHash(e.sublist(32))}catch(t){throw new Yh(`handshake stage 0 validation fail: ${t.message}`)}}readMessageB(e){try{this.readE(e),this.readEE();const t=this.readS(e,32);return this.readES(),this.ss.decryptAndHash(e.sublist(32+t))}catch(t){throw new Yh(`handshake stage 1 validation fail: ${t.message}`)}}readMessageC(e){try{const t=this.readS(e);return this.readSE(),this.ss.decryptAndHash(e.sublist(t))}catch(t){throw new Yh(`handshake stage 2 validation fail: ${t.message}`)}}}function dQ(n,e){if(e.length<=32){const t=Je(32);return t.set(e),t}else return n.hash(e)}var qm;(function(n){let e;n.codec=()=>(e==null&&(e=pt((t,r,i={})=>{if(i.lengthDelimited!==!1&&r.fork(),t.webtransportCerthashes!=null)for(const s of t.webtransportCerthashes)r.uint32(10),r.bytes(s);if(t.streamMuxers!=null)for(const s of t.streamMuxers)r.uint32(18),r.string(s);i.lengthDelimited!==!1&&r.ldelim()},(t,r,i={})=>{var a,l;const s={webtransportCerthashes:[],streamMuxers:[]},o=r==null?t.len:t.pos+r;for(;t.pos<o;){const c=t.uint32();switch(c>>>3){case 1:{if(((a=i.limits)==null?void 0:a.webtransportCerthashes)!=null&&s.webtransportCerthashes.length===i.limits.webtransportCerthashes)throw new dn('Decode error - map field "webtransportCerthashes" had too many elements');s.webtransportCerthashes.push(t.bytes());break}case 2:{if(((l=i.limits)==null?void 0:l.streamMuxers)!=null&&s.streamMuxers.length===i.limits.streamMuxers)throw new dn('Decode error - map field "streamMuxers" had too many elements');s.streamMuxers.push(t.string());break}default:{t.skipType(c&7);break}}}return s})),e),n.encode=t=>dt(t,n.codec()),n.decode=(t,r)=>ft(t,n.codec(),r)})(qm||(qm={}));var Hm;(function(n){let e;n.codec=()=>(e==null&&(e=pt((t,r,i={})=>{i.lengthDelimited!==!1&&r.fork(),t.identityKey!=null&&t.identityKey.byteLength>0&&(r.uint32(10),r.bytes(t.identityKey)),t.identitySig!=null&&t.identitySig.byteLength>0&&(r.uint32(18),r.bytes(t.identitySig)),t.extensions!=null&&(r.uint32(34),qm.codec().encode(t.extensions,r)),i.lengthDelimited!==!1&&r.ldelim()},(t,r,i={})=>{var a;const s={identityKey:Je(0),identitySig:Je(0)},o=r==null?t.len:t.pos+r;for(;t.pos<o;){const l=t.uint32();switch(l>>>3){case 1:{s.identityKey=t.bytes();break}case 2:{s.identitySig=t.bytes();break}case 4:{s.extensions=qm.codec().decode(t,t.uint32(),{limits:(a=i.limits)==null?void 0:a.extensions});break}default:{t.skipType(l&7);break}}}return s})),e),n.encode=t=>dt(t,n.codec()),n.decode=(t,r)=>ft(t,n.codec(),r)})(Hm||(Hm={}));async function PD(n,e,t){const r=await n.sign(OD(e));return Hm.encode({identityKey:ho(n.publicKey),identitySig:r,extensions:t})}async function RD(n,e,t){try{const r=Hm.decode(n),i=Ea(r.identityKey);if((t==null?void 0:t.equals(i))===!1)throw new Error(`Payload identity key ${i} does not match expected remote identity key ${t}`);if(!e)throw new Error("Remote static does not exist");const s=OD(e);if(!await i.verify(s,r.identitySig))throw new Error("Invalid payload signature");return r}catch(r){throw new CL(r.message)}}function OD(n){const e=at("noise-libp2p-static-key:");return n instanceof Uint8Array?Dl([e,n],e.length+n.length):(n.prepend(e),n)}async function pQ(n,e){const{log:t,connection:r,crypto:i,privateKey:s,prologue:o,s:a,remoteIdentityKey:l,extensions:c}=n,h=await PD(s,a.publicKey,c),d=new kD({crypto:i,protocolName:"Noise_XX_25519_ChaChaPoly_SHA256",initiator:!0,prologue:o,s:a});xD(d.s,t),t.trace("Stage 0 - Initiator starting to send first message."),await r.write(d.writeMessageA(Xc),e),t.trace("Stage 0 - Initiator finished sending first message."),ID(d.e,t),t.trace("Stage 1 - Initiator waiting to receive first message from responder...");const p=d.readMessageB(await r.read(e));t.trace("Stage 1 - Initiator received the message."),TD(d.re,t),oQ(d.rs,t),t.trace("Initiator going to check remote's signature...");const g=await RD(p,d.rs,l);t.trace("All good with the signature!"),t.trace("Stage 2 - Initiator sending third handshake message."),await r.write(d.writeMessageC(h),e),t.trace("Stage 2 - Initiator sent message with signed payload.");const[m,E]=d.ss.split();return CD(m,E,t),{payload:g,encrypt:y=>m.encryptWithAd(Xc,y),decrypt:(y,S)=>E.decryptWithAd(Xc,y,S)}}async function gQ(n,e){const{log:t,connection:r,crypto:i,privateKey:s,prologue:o,s:a,remoteIdentityKey:l,extensions:c}=n,h=await PD(s,a.publicKey,c),d=new kD({crypto:i,protocolName:"Noise_XX_25519_ChaChaPoly_SHA256",initiator:!1,prologue:o,s:a});xD(d.s,t),t.trace("Stage 0 - Responder waiting to receive first message."),d.readMessageA(await r.read(e)),t.trace("Stage 0 - Responder received first message."),TD(d.re,t),t.trace("Stage 1 - Responder sending out first message with signed payload and static key."),await r.write(d.writeMessageB(h),e),t.trace("Stage 1 - Responder sent the second handshake message with signed payload."),ID(d.e,t),t.trace("Stage 2 - Responder waiting for third handshake message...");const p=d.readMessageC(await r.read(e));t.trace("Stage 2 - Responder received the message, finished handshake.");const g=await RD(p,d.rs,l),[m,E]=d.ss.split();return CD(m,E,t),{payload:g,encrypt:y=>E.encryptWithAd(Xc,y),decrypt:(y,S)=>m.decryptWithAd(Xc,y,S)}}const ok=16;function mQ(n,e){return async function*(t){for await(const r of t)for(let i=0;i<r.length;i+=HC){let s=i+HC;s>r.length&&(s=r.length);let o;r instanceof Uint8Array?o=n.encrypt(r.subarray(i,s)):o=n.encrypt(r.sublist(i,s)),e==null||e.encryptedPackets.increment(),yield new bt(jm(o.byteLength),o)}}}function yQ(n,e){return async function*(t){for await(const r of t)for(let i=0;i<r.length;i+=Ef){let s=i+Ef;if(s>r.length&&(s=r.length),s-ok<i)throw new Error("Invalid chunk");const o=r.sublist(i,s),a=r.subarray(i,s-ok);try{const l=n.decrypt(o,a);e==null||e.decryptedPackets.increment(),yield l}catch(l){throw e==null||e.decryptErrors.increment(),l}}}}var DR,$R;$R=Symbol.toStringTag,DR=bo;class bQ{constructor(e,t={}){v(this,"protocol","/noise");v(this,"crypto");v(this,"prologue");v(this,"staticKey");v(this,"extensions");v(this,"metrics");v(this,"components");v(this,$R,"@chainsafe/libp2p-noise");v(this,DR,["@libp2p/connection-encryption","@chainsafe/libp2p-noise"]);const{staticNoiseKey:r,extensions:i,crypto:s,prologueBytes:o}=t,{metrics:a}=e;this.components=e;const l=s??nQ;this.crypto=iQ(l),this.extensions={webtransportCerthashes:[],...i},this.metrics=a?sQ(a):void 0,r?this.staticKey=l.generateX25519KeyPairFromSeed(r):this.staticKey=l.generateX25519KeyPair(),this.prologue=o??Je(0)}async secureOutbound(e,t){var a,l;const r=Iu(e,{lengthEncoder:jm,lengthDecoder:Tg,maxDataLength:Ef}),i=await this.performHandshakeInitiator(r,this.components.privateKey,(a=t==null?void 0:t.remotePeer)==null?void 0:a.publicKey,t),s=await this.createSecureConnection(r,i);e.source=s.source,e.sink=s.sink;const o=Ea(i.payload.identityKey);return{conn:e,remoteExtensions:i.payload.extensions,remotePeer:wf(o),streamMuxer:(t==null?void 0:t.skipStreamMuxerNegotiation)===!0?void 0:this.getStreamMuxer((l=i.payload.extensions)==null?void 0:l.streamMuxers)}}getStreamMuxer(e){if(e==null||e.length===0)return;const t=this.components.upgrader.getStreamMuxers();if(t!=null)for(const r of e){const i=t.get(r);if(i!=null)return i}if(e.length)throw new Cz("Early muxer negotiation was requested but the initiator and responder had no common muxers")}async secureInbound(e,t){var a,l;const r=Iu(e,{lengthEncoder:jm,lengthDecoder:Tg,maxDataLength:Ef}),i=await this.performHandshakeResponder(r,this.components.privateKey,(a=t==null?void 0:t.remotePeer)==null?void 0:a.publicKey,t),s=await this.createSecureConnection(r,i);e.source=s.source,e.sink=s.sink;const o=Ea(i.payload.identityKey);return{conn:e,remoteExtensions:i.payload.extensions,remotePeer:wf(o),streamMuxer:(t==null?void 0:t.skipStreamMuxerNegotiation)===!0?void 0:this.getStreamMuxer((l=i.payload.extensions)==null?void 0:l.streamMuxers)}}async performHandshakeInitiator(e,t,r,i){var a,l;let s;const o=(i==null?void 0:i.skipStreamMuxerNegotiation)===!0?[]:[...this.components.upgrader.getStreamMuxers().keys()];try{s=await pQ({connection:e,privateKey:t,remoteIdentityKey:r,log:this.components.logger.forComponent("libp2p:noise:xxhandshake"),crypto:this.crypto,prologue:this.prologue,s:this.staticKey,extensions:{streamMuxers:o,webtransportCerthashes:[],...this.extensions}},i),(a=this.metrics)==null||a.xxHandshakeSuccesses.increment()}catch(c){throw(l=this.metrics)==null||l.xxHandshakeErrors.increment(),c}return s}async performHandshakeResponder(e,t,r,i){var a,l;let s;const o=(i==null?void 0:i.skipStreamMuxerNegotiation)===!0?[]:[...this.components.upgrader.getStreamMuxers().keys()];try{s=await gQ({connection:e,privateKey:t,remoteIdentityKey:r,log:this.components.logger.forComponent("libp2p:noise:xxhandshake"),crypto:this.crypto,prologue:this.prologue,s:this.staticKey,extensions:{streamMuxers:o,webtransportCerthashes:[],...this.extensions}},i),(a=this.metrics)==null||a.xxHandshakeSuccesses.increment()}catch(c){throw(l=this.metrics)==null||l.xxHandshakeErrors.increment(),c}return s}async createSecureConnection(e,t){const[r,i]=QX(),s=e.unwrap();return await Fi(r,mQ(t,this.metrics),s,o=>Mm(o,{lengthDecoder:Tg}),yQ(t,this.metrics),r),i}}function wQ(n={}){return e=>new bQ(e,n)}const vQ=Ye("dns4"),_Q=Ye("dns6"),EQ=Ye("dnsaddr"),ql=$r(Ye("dns"),EQ,vQ,_Q),Qy=$r(Ye("ip4"),Ye("ip6")),ku=$r(lt(Qy,Ye("tcp")),lt(ql,Ye("tcp"))),Jy=lt(Qy,Ye("udp")),SQ=lt(Jy,Ye("utp")),AQ=lt(Jy,Ye("quic")),xQ=lt(Jy,Ye("quic-v1")),j1=$r(lt(ku,Ye("ws")),lt(ql,Ye("ws"))),Wm=$r(lt(j1,Ye("p2p")),j1),q1=$r(lt(ku,Ye("wss")),lt(ql,Ye("wss")),lt(ku,Ye("tls"),Ye("ws")),lt(ql,Ye("tls"),Ye("ws"))),zm=$r(lt(q1,Ye("p2p")),q1),H1=$r(lt(ku,Ye("http")),lt(Qy,Ye("http")),lt(ql,Ye("http"))),W1=$r(lt(ku,Ye("https")),lt(Qy,Ye("https")),lt(ql,Ye("https"))),ak=lt(Jy,Ye("webrtc-direct"),Ye("certhash")),LD=$r(lt(ak,Ye("p2p")),ak),lk=lt(xQ,Ye("webtransport"),Ye("certhash"),Ye("certhash")),ND=$r(lt(lk,Ye("p2p")),lk),DD=$r(lt(Wm,Ye("p2p-webrtc-star"),Ye("p2p")),lt(zm,Ye("p2p-webrtc-star"),Ye("p2p")),lt(Wm,Ye("p2p-webrtc-star")),lt(zm,Ye("p2p-webrtc-star")));$r(lt(Wm,Ye("p2p-websocket-star"),Ye("p2p")),lt(zm,Ye("p2p-websocket-star"),Ye("p2p")),lt(Wm,Ye("p2p-websocket-star")),lt(zm,Ye("p2p-websocket-star")));const $D=$r(lt(H1,Ye("p2p-webrtc-direct"),Ye("p2p")),lt(W1,Ye("p2p-webrtc-direct"),Ye("p2p")),lt(H1,Ye("p2p-webrtc-direct")),lt(W1,Ye("p2p-webrtc-direct"))),Hl=$r(j1,q1,H1,W1,DD,$D,ku,SQ,AQ,ql,LD,ND);$r(lt(Hl,Ye("p2p-stardust"),Ye("p2p")),lt(Hl,Ye("p2p-stardust")));const da=$r(lt(Hl,Ye("p2p")),DD,$D,LD,ND,Ye("p2p")),ck=$r(lt(da,Ye("p2p-circuit"),da),lt(da,Ye("p2p-circuit")),lt(Ye("p2p-circuit"),da),lt(Hl,Ye("p2p-circuit")),lt(Ye("p2p-circuit"),Hl),Ye("p2p-circuit")),MD=()=>$r(lt(ck,MD),ck),Qa=MD(),IQ=$r(lt(Qa,da,Qa),lt(da,Qa),lt(Qa,da),Qa,da);$r(lt(Qa,Ye("webrtc"),Ye("p2p")),lt(Qa,Ye("webrtc")),lt(Hl,Ye("webrtc"),Ye("p2p")),lt(Hl,Ye("webrtc")),Ye("webrtc"));function BD(n){function e(t){let r;try{r=Nt(t)}catch{return!1}const i=n(r.protoNames());return i===null?!1:i===!0||i===!1?i:i.length===0}return e}function lt(...n){function e(t){if(t.length<n.length)return null;let r=t;return n.some(i=>(r=typeof i=="function"?i().partialMatch(t):i.partialMatch(t),Array.isArray(r)&&(t=r),r===null)),r}return{toString:function(){return"{ "+n.join(" ")+" }"},input:n,matches:BD(e),partialMatch:e}}function $r(...n){function e(r){let i=null;return n.some(s=>{const o=typeof s=="function"?s().partialMatch(r):s.partialMatch(r);return o!=null?(i=o,!0):!1}),i}return{toString:function(){return"{ "+n.join(" ")+" }"},input:n,matches:BD(e),partialMatch:e}}function Ye(n){const e=n;function t(i){let s;try{s=Nt(i)}catch{return!1}const o=s.protoNames();return o.length===1&&o[0]===e}function r(i){return i.length===0?null:i[0]===e?i.slice(1):null}return{toString:function(){return e},matches:t,partialMatch:r}}const TQ="bootstrap",CQ=50,kQ=1e3;var MR,BR,UR,FR;class UD extends(FR=Si,UR=ff,BR=Symbol.toStringTag,MR=bo,FR){constructor(t,r={list:[]}){if(r.list==null||r.list.length===0)throw new Error("Bootstrap requires a list of peer addresses");super();v(this,"log");v(this,"timer");v(this,"list");v(this,"timeout");v(this,"components");v(this,"_init");v(this,UR,this);v(this,BR,"@libp2p/bootstrap");v(this,MR,["@libp2p/peer-discovery"]);this.components=t,this.log=t.logger.forComponent("libp2p:bootstrap"),this.timeout=r.timeout??kQ,this.list=[];for(const i of r.list){if(!IQ.matches(i)){this.log.error("Invalid multiaddr");continue}const s=Nt(i),o=s.getPeerId();if(o==null){this.log.error("Invalid bootstrap multiaddr without peer id");continue}const a={id:Cs(o),multiaddrs:[s]};this.list.push(a)}this._init=r}isStarted(){return!!this.timer}start(){this.isStarted()||(this.log("Starting bootstrap node discovery, discovering peers after %s ms",this.timeout),this.timer=setTimeout(()=>{this._discoverBootstrapPeers().catch(t=>{this.log.error(t)})},this.timeout))}async _discoverBootstrapPeers(){if(this.timer!=null)for(const t of this.list){if(await this.components.peerStore.merge(t.id,{tags:{[this._init.tagName??TQ]:{value:this._init.tagValue??CQ,ttl:this._init.tagTTL}},multiaddrs:t.multiaddrs}),this.timer==null)return;this.safeDispatchEvent("peer",{detail:t}),this.components.connectionManager.openConnection(t.id).catch(r=>{this.log.error("could not dial bootstrap peer %p",t.id,r)})}}stop(){this.timer!=null&&clearTimeout(this.timer),this.timer=void 0}}v(UD,"tag","bootstrap");function PQ(n){return e=>new UD(e,n)}var Km;(function(n){let e;n.codec=()=>(e==null&&(e=pt((t,r,i={})=>{i.lengthDelimited!==!1&&r.fork(),t.publicKey!=null&&t.publicKey.byteLength>0&&(r.uint32(10),r.bytes(t.publicKey)),t.payloadType!=null&&t.payloadType.byteLength>0&&(r.uint32(18),r.bytes(t.payloadType)),t.payload!=null&&t.payload.byteLength>0&&(r.uint32(26),r.bytes(t.payload)),t.signature!=null&&t.signature.byteLength>0&&(r.uint32(42),r.bytes(t.signature)),i.lengthDelimited!==!1&&r.ldelim()},(t,r,i={})=>{const s={publicKey:Je(0),payloadType:Je(0),payload:Je(0),signature:Je(0)},o=r==null?t.len:t.pos+r;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.publicKey=t.bytes();break}case 2:{s.payloadType=t.bytes();break}case 3:{s.payload=t.bytes();break}case 5:{s.signature=t.bytes();break}default:{t.skipType(a&7);break}}}return s})),e),n.encode=t=>dt(t,n.codec()),n.decode=(t,r)=>ft(t,n.codec(),r)})(Km||(Km={}));class RQ extends Error{constructor(e="Invalid signature"){super(e),this.name="InvalidSignatureError"}}const ia=class ia{constructor(e){v(this,"publicKey");v(this,"payloadType");v(this,"payload");v(this,"signature");v(this,"marshaled");const{publicKey:t,payloadType:r,payload:i,signature:s}=e;this.publicKey=t,this.payloadType=r,this.payload=i,this.signature=s}marshal(){return this.marshaled==null&&(this.marshaled=Km.encode({publicKey:ho(this.publicKey),payloadType:this.payloadType,payload:this.payload.subarray(),signature:this.signature})),this.marshaled}equals(e){return e==null?!1:Or(this.marshal(),e.marshal())}async validate(e,t){const r=uk(e,this.payloadType,this.payload);return this.publicKey.verify(r.subarray(),this.signature,t)}};v(ia,"createFromProtobuf",e=>{const t=Km.decode(e),r=Ea(t.publicKey);return new ia({publicKey:r,payloadType:t.payloadType,payload:t.payload,signature:t.signature})}),v(ia,"seal",async(e,t,r)=>{if(t==null)throw new Error("Missing private key");const i=e.domain,s=e.codec,o=e.marshal(),a=uk(i,s,o),l=await t.sign(a.subarray(),r);return new ia({publicKey:t.publicKey,payloadType:s,payload:o,signature:l})}),v(ia,"openAndCertify",async(e,t,r)=>{const i=ia.createFromProtobuf(e);if(!await i.validate(t,r))throw new RQ("Envelope signature is not valid for the given domain");return i});let Wl=ia;const uk=(n,e,t)=>{const r=at(n),i=Ts(r.byteLength),s=Ts(e.length),o=Ts(t.length);return new bt(i,r,s,e,o,t)};function OQ(n,e){const t=(r,i)=>r.toString().localeCompare(i.toString());return n.length!==e.length?!1:(e.sort(t),n.sort(t).every((r,i)=>e[i].equals(r)))}const LQ="libp2p-peer-record",NQ=Uint8Array.from([3,1]);var Vm;(function(n){(function(t){let r;t.codec=()=>(r==null&&(r=pt((i,s,o={})=>{o.lengthDelimited!==!1&&s.fork(),i.multiaddr!=null&&i.multiaddr.byteLength>0&&(s.uint32(10),s.bytes(i.multiaddr)),o.lengthDelimited!==!1&&s.ldelim()},(i,s,o={})=>{const a={multiaddr:Je(0)},l=s==null?i.len:i.pos+s;for(;i.pos<l;){const c=i.uint32();switch(c>>>3){case 1:{a.multiaddr=i.bytes();break}default:{i.skipType(c&7);break}}}return a})),r),t.encode=i=>dt(i,t.codec()),t.decode=(i,s)=>ft(i,t.codec(),s)})(n.AddressInfo||(n.AddressInfo={}));let e;n.codec=()=>(e==null&&(e=pt((t,r,i={})=>{if(i.lengthDelimited!==!1&&r.fork(),t.peerId!=null&&t.peerId.byteLength>0&&(r.uint32(10),r.bytes(t.peerId)),t.seq!=null&&t.seq!==0n&&(r.uint32(16),r.uint64(t.seq)),t.addresses!=null)for(const s of t.addresses)r.uint32(26),n.AddressInfo.codec().encode(s,r);i.lengthDelimited!==!1&&r.ldelim()},(t,r,i={})=>{var a,l;const s={peerId:Je(0),seq:0n,addresses:[]},o=r==null?t.len:t.pos+r;for(;t.pos<o;){const c=t.uint32();switch(c>>>3){case 1:{s.peerId=t.bytes();break}case 2:{s.seq=t.uint64();break}case 3:{if(((a=i.limits)==null?void 0:a.addresses)!=null&&s.addresses.length===i.limits.addresses)throw new dn('Decode error - map field "addresses" had too many elements');s.addresses.push(n.AddressInfo.codec().decode(t,t.uint32(),{limits:(l=i.limits)==null?void 0:l.addresses$}));break}default:{t.skipType(c&7);break}}}return s})),e),n.encode=t=>dt(t,n.codec()),n.decode=(t,r)=>ft(t,n.codec(),r)})(Vm||(Vm={}));const Qs=class Qs{constructor(e){v(this,"peerId");v(this,"multiaddrs");v(this,"seqNumber");v(this,"domain",Qs.DOMAIN);v(this,"codec",Qs.CODEC);v(this,"marshaled");const{peerId:t,multiaddrs:r,seqNumber:i}=e;this.peerId=t,this.multiaddrs=r??[],this.seqNumber=i??BigInt(Date.now())}marshal(){return this.marshaled==null&&(this.marshaled=Vm.encode({peerId:this.peerId.toMultihash().bytes,seq:BigInt(this.seqNumber),addresses:this.multiaddrs.map(e=>({multiaddr:e.bytes}))})),this.marshaled}equals(e){return!(!(e instanceof Qs)||!this.peerId.equals(e.peerId)||this.seqNumber!==e.seqNumber||!OQ(this.multiaddrs,e.multiaddrs))}};v(Qs,"createFromProtobuf",e=>{const t=Vm.decode(e),r=Wy(Ry(t.peerId)),i=(t.addresses??[]).map(o=>Nt(o.multiaddr)),s=t.seq;return new Qs({peerId:r,multiaddrs:i,seqNumber:s})}),v(Qs,"DOMAIN",LQ),v(Qs,"CODEC",NQ);let fo=Qs;function z1(n,e){let t;const r=function(){const i=function(){t=void 0,n()};clearTimeout(t),t=setTimeout(i,e)};return r.start=()=>{},r.stop=()=>{clearTimeout(t)},r}function DQ(n){return n[Symbol.asyncIterator]!=null}function hk(n){if(DQ(n))return(async()=>{for await(const e of n);})();for(const e of n);}const vp=globalThis.CustomEvent??Event;async function*$Q(n,e={}){let t=e.concurrency??1/0;t<1&&(t=1/0);const r=e.ordered??!1,i=new EventTarget,s=[];let o=qr(),a=qr(),l=!1,c,h=!1;i.addEventListener("task-complete",()=>{a.resolve()}),Promise.resolve().then(async()=>{try{for await(const m of n){if(s.length===t&&(o=qr(),await o.promise),h)break;const E={done:!1};s.push(E),m().then(y=>{E.done=!0,E.ok=!0,E.value=y,i.dispatchEvent(new vp("task-complete"))},y=>{E.done=!0,E.err=y,i.dispatchEvent(new vp("task-complete"))})}l=!0,i.dispatchEvent(new vp("task-complete"))}catch(m){c=m,i.dispatchEvent(new vp("task-complete"))}});function d(){var m;return r?(m=s[0])==null?void 0:m.done:!!s.find(E=>E.done)}function*p(){for(;s.length>0&&s[0].done;){const m=s[0];if(s.shift(),m.ok)yield m.value;else throw h=!0,o.resolve(),m.err;o.resolve()}}function*g(){for(;d();)for(let m=0;m<s.length;m++)if(s[m].done){const E=s[m];if(s.splice(m,1),m--,E.ok)yield E.value;else throw h=!0,o.resolve(),E.err;o.resolve()}}for(;;){if(d()||(a=qr(),await a.promise),c!=null||(r?yield*p():yield*g(),c!=null))throw c;if(l&&s.length===0)break}}function fk(n,e){const t=Iu(n,e),r={read:async(i,s)=>{const o=await t.read(s);return i.decode(o)},write:async(i,s,o)=>{await t.write(s.encode(i),o)},writeV:async(i,s,o)=>{await t.writeV(i.map(a=>s.encode(a)),o)},pb:i=>({read:async s=>r.read(i,s),write:async(s,o)=>r.write(s,i,o),writeV:async(s,o)=>r.writeV(s,i,o),unwrap:()=>r}),unwrap:()=>t.unwrap()};return r}const MQ="0.1.0",BQ="id",UQ="1.0.0",FQ=1024*8;var Gm;(function(n){let e;n.codec=()=>(e==null&&(e=pt((t,r,i={})=>{if(i.lengthDelimited!==!1&&r.fork(),t.protocolVersion!=null&&(r.uint32(42),r.string(t.protocolVersion)),t.agentVersion!=null&&(r.uint32(50),r.string(t.agentVersion)),t.publicKey!=null&&(r.uint32(10),r.bytes(t.publicKey)),t.listenAddrs!=null)for(const s of t.listenAddrs)r.uint32(18),r.bytes(s);if(t.observedAddr!=null&&(r.uint32(34),r.bytes(t.observedAddr)),t.protocols!=null)for(const s of t.protocols)r.uint32(26),r.string(s);t.signedPeerRecord!=null&&(r.uint32(66),r.bytes(t.signedPeerRecord)),i.lengthDelimited!==!1&&r.ldelim()},(t,r,i={})=>{var a,l;const s={listenAddrs:[],protocols:[]},o=r==null?t.len:t.pos+r;for(;t.pos<o;){const c=t.uint32();switch(c>>>3){case 5:{s.protocolVersion=t.string();break}case 6:{s.agentVersion=t.string();break}case 1:{s.publicKey=t.bytes();break}case 2:{if(((a=i.limits)==null?void 0:a.listenAddrs)!=null&&s.listenAddrs.length===i.limits.listenAddrs)throw new dn('Decode error - map field "listenAddrs" had too many elements');s.listenAddrs.push(t.bytes());break}case 4:{s.observedAddr=t.bytes();break}case 3:{if(((l=i.limits)==null?void 0:l.protocols)!=null&&s.protocols.length===i.limits.protocols)throw new dn('Decode error - map field "protocols" had too many elements');s.protocols.push(t.string());break}case 8:{s.signedPeerRecord=t.bytes();break}default:{t.skipType(c&7);break}}}return s})),e),n.encode=t=>dt(t,n.codec()),n.decode=(t,r)=>ft(t,n.codec(),r)})(Gm||(Gm={}));const Xs={protocolPrefix:"ipfs",timeout:5e3,maxInboundStreams:1,maxOutboundStreams:1,maxObservedAddresses:10,maxMessageSize:FQ,runOnConnectionOpen:!0,runOnLimitedConnection:!0};function jQ(n){if(n!=null&&n.length>0)try{return Nt(n)}catch{}}function qQ(n,e){return e??n.userAgent}async function HQ(n,e,t,r,i){if(t("received identify from %p",r.remotePeer),i==null)throw new is("message was null or undefined");const s={};if(i.listenAddrs.length>0&&(s.addresses=i.listenAddrs.map(l=>({isCertified:!1,multiaddr:Nt(l)}))),i.protocols.length>0&&(s.protocols=i.protocols),i.publicKey!=null){const l=Ea(i.publicKey);if(!wf(l).equals(r.remotePeer))throw new is("public key did not match remote PeerId");s.publicKey=l}let o;if(i.signedPeerRecord!=null){t.trace("received signedPeerRecord from %p",r.remotePeer);let l=i.signedPeerRecord;const c=await Wl.openAndCertify(l,fo.DOMAIN);let h=fo.createFromProtobuf(c.payload);const d=Jf(c.publicKey.toCID());if(!h.peerId.equals(d))throw new is("signing key does not match PeerId in the PeerRecord");if(!r.remotePeer.equals(h.peerId))throw new is("signing key does not match remote PeerId");let p;try{p=await n.get(h.peerId)}catch(g){if(g.name!=="NotFoundError")throw g}if(p!=null&&(s.metadata=p.metadata,p.peerRecordEnvelope!=null)){const g=Wl.createFromProtobuf(p.peerRecordEnvelope),m=fo.createFromProtobuf(g.payload);m.seqNumber>=h.seqNumber&&(t("sequence number was lower or equal to existing sequence number - stored: %d received: %d",m.seqNumber,h.seqNumber),h=m,l=p.peerRecordEnvelope)}s.peerRecordEnvelope=l,s.addresses=h.multiaddrs.map(g=>({isCertified:!0,multiaddr:g})),o={seq:h.seqNumber,addresses:h.multiaddrs}}else t("%p did not send a signed peer record",r.remotePeer);if(t.trace("patching %p with",r.remotePeer,s),await n.patch(r.remotePeer,s),i.agentVersion!=null||i.protocolVersion!=null){const l={};i.agentVersion!=null&&(l.AgentVersion=at(i.agentVersion)),i.protocolVersion!=null&&(l.ProtocolVersion=at(i.protocolVersion)),t.trace("merging %p metadata",r.remotePeer,l),await n.merge(r.remotePeer,{metadata:l})}const a={peerId:r.remotePeer,protocolVersion:i.protocolVersion,agentVersion:i.agentVersion,publicKey:i.publicKey,listenAddrs:i.listenAddrs.map(l=>Nt(l)),observedAddr:i.observedAddr==null?void 0:Nt(i.observedAddr),protocols:i.protocols,signedPeerRecord:o,connection:r};return e.safeDispatchEvent("peer:identify",{detail:a}),a}class WQ{constructor(e,t){v(this,"host");v(this,"protocol");v(this,"started");v(this,"timeout");v(this,"peerId");v(this,"privateKey");v(this,"peerStore");v(this,"registrar");v(this,"addressManager");v(this,"maxInboundStreams");v(this,"maxOutboundStreams");v(this,"maxMessageSize");v(this,"maxObservedAddresses");v(this,"events");v(this,"runOnLimitedConnection");v(this,"log");this.protocol=t.protocol,this.started=!1,this.peerId=e.peerId,this.privateKey=e.privateKey,this.peerStore=e.peerStore,this.registrar=e.registrar,this.addressManager=e.addressManager,this.events=e.events,this.log=t.log,this.timeout=t.timeout??Xs.timeout,this.maxInboundStreams=t.maxInboundStreams??Xs.maxInboundStreams,this.maxOutboundStreams=t.maxOutboundStreams??Xs.maxOutboundStreams,this.maxMessageSize=t.maxMessageSize??Xs.maxMessageSize,this.maxObservedAddresses=t.maxObservedAddresses??Xs.maxObservedAddresses,this.runOnLimitedConnection=t.runOnLimitedConnection??Xs.runOnLimitedConnection,this.host={protocolVersion:`${t.protocolPrefix??Xs.protocolPrefix}/${MQ}`,agentVersion:qQ(e.nodeInfo,t.agentVersion)}}isStarted(){return this.started}async start(){this.started||(await this.peerStore.merge(this.peerId,{metadata:{AgentVersion:at(this.host.agentVersion),ProtocolVersion:at(this.host.protocolVersion)}}),await this.registrar.handle(this.protocol,e=>{this.handleProtocol(e).catch(t=>{this.log.error(t)})},{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams,runOnLimitedConnection:this.runOnLimitedConnection}),this.started=!0)}async stop(){await this.registrar.unhandle(this.protocol),this.started=!1}}function zQ(n){try{for(const{code:e,value:t}of n.getComponents())if(t!=null&&e===ls)return OY("2000::/3",t)}catch{}return!1}var FD;(function(){var n,e,t,r,i,s,o,a;a=function(l){var c,h,d,p;return c=(l&255<<24)>>>24,h=(l&255<<16)>>>16,d=(l&65280)>>>8,p=l&255,[c,h,d,p].join(".")},o=function(l){var c,h,d,p,g,m;for(c=[],d=p=0;p<=3&&l.length!==0;d=++p){if(d>0){if(l[0]!==".")throw new Error("Invalid IP");l=l.substring(1)}m=e(l),g=m[0],h=m[1],l=l.substring(h),c.push(g)}if(l.length!==0)throw new Error("Invalid IP");switch(c.length){case 1:if(c[0]>4294967295)throw new Error("Invalid IP");return c[0]>>>0;case 2:if(c[0]>255||c[1]>16777215)throw new Error("Invalid IP");return(c[0]<<24|c[1])>>>0;case 3:if(c[0]>255||c[1]>255||c[2]>65535)throw new Error("Invalid IP");return(c[0]<<24|c[1]<<16|c[2])>>>0;case 4:if(c[0]>255||c[1]>255||c[2]>255||c[3]>255)throw new Error("Invalid IP");return(c[0]<<24|c[1]<<16|c[2]<<8|c[3])>>>0;default:throw new Error("Invalid IP")}},t=function(l){return l.charCodeAt(0)},r=t("0"),s=t("a"),i=t("A"),e=function(l){var c,h,d,p,g;for(p=0,c=10,h="9",d=0,l.length>1&&l[d]==="0"&&(l[d+1]==="x"||l[d+1]==="X"?(d+=2,c=16):"0"<=l[d+1]&&l[d+1]<="9"&&(d++,c=8,h="7")),g=d;d<l.length;){if("0"<=l[d]&&l[d]<=h)p=p*c+(t(l[d])-r)>>>0;else if(c===16)if("a"<=l[d]&&l[d]<="f")p=p*c+(10+t(l[d])-s)>>>0;else if("A"<=l[d]&&l[d]<="F")p=p*c+(10+t(l[d])-i)>>>0;else break;else break;if(p>4294967295)throw new Error("too large");d++}if(d===g)throw new Error("empty octet");return[p,d]},n=function(){function l(c,h){var d,p,g;if(typeof c!="string")throw new Error("Missing `net' parameter");if(h||(g=c.split("/",2),c=g[0],h=g[1]),h||(h=32),typeof h=="string"&&h.indexOf(".")>-1){try{this.maskLong=o(h)}catch{throw new Error("Invalid mask: "+h)}for(d=p=32;p>=0;d=--p)if(this.maskLong===4294967295<<32-d>>>0){this.bitmask=d;break}}else if(h||h===0)this.bitmask=parseInt(h,10),this.maskLong=0,this.bitmask>0&&(this.maskLong=4294967295<<32-this.bitmask>>>0);else throw new Error("Invalid mask: empty");try{this.netLong=(o(c)&this.maskLong)>>>0}catch{throw new Error("Invalid net address: "+c)}if(!(this.bitmask<=32))throw new Error("Invalid mask for ip4: "+h);this.size=Math.pow(2,32-this.bitmask),this.base=a(this.netLong),this.mask=a(this.maskLong),this.hostmask=a(~this.maskLong),this.first=this.bitmask<=30?a(this.netLong+1):this.base,this.last=this.bitmask<=30?a(this.netLong+this.size-2):a(this.netLong+this.size-1),this.broadcast=this.bitmask<=30?a(this.netLong+this.size-1):void 0}return l.prototype.contains=function(c){return typeof c=="string"&&(c.indexOf("/")>0||c.split(".").length!==4)&&(c=new l(c)),c instanceof l?this.contains(c.base)&&this.contains(c.broadcast||c.last):(o(c)&this.maskLong)>>>0===(this.netLong&this.maskLong)>>>0},l.prototype.next=function(c){return c==null&&(c=1),new l(a(this.netLong+this.size*c),this.mask)},l.prototype.forEach=function(c){var h,d,p;for(p=o(this.first),d=o(this.last),h=0;p<=d;)c(a(p),p,h),h++,p++},l.prototype.toString=function(){return this.base+"/"+this.bitmask},l}(),FD=n}).call(Ui);const KQ=["0.0.0.0/8","10.0.0.0/8","100.64.0.0/10","127.0.0.0/8","169.254.0.0/16","172.16.0.0/12","192.0.0.0/24","192.0.0.0/29","192.0.0.8/32","192.0.0.9/32","192.0.0.10/32","192.0.0.170/32","192.0.0.171/32","192.0.2.0/24","192.31.196.0/24","192.52.193.0/24","192.88.99.0/24","192.168.0.0/16","192.175.48.0/24","198.18.0.0/15","198.51.100.0/24","203.0.113.0/24","240.0.0.0/4","255.255.255.255/32"],VQ=KQ.map(n=>new FD(n));function QS(n){for(const e of VQ)if(e.contains(n))return!0;return!1}function GQ(n){return/^::ffff:([0-9a-fA-F]{1,4}):([0-9a-fA-F]{1,4})$/.test(n)}function YQ(n){const e=n.split(":");if(e.length<2)return!1;const t=e[e.length-1].padStart(4,"0"),r=e[e.length-2].padStart(4,"0"),i=`${parseInt(r.substring(0,2),16)}.${parseInt(r.substring(2),16)}.${parseInt(t.substring(0,2),16)}.${parseInt(t.substring(2),16)}`;return QS(i)}function XQ(n){return/^::ffff:([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(n)}function ZQ(n){const e=n.split(":"),t=e[e.length-1];return QS(t)}function QQ(n){return/^::$/.test(n)||/^::1$/.test(n)||/^64:ff9b::([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(n)||/^100::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(n)||/^2001::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(n)||/^2001:2[0-9a-fA-F]:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(n)||/^2001:db8:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(n)||/^2002:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(n)||/^f[c-d]([0-9a-fA-F]{2,2}):/i.test(n)||/^fe[8-9a-bA-B][0-9a-fA-F]:/i.test(n)||/^ff([0-9a-fA-F]{2,2}):/i.test(n)}function eb(n){if(Ul(n))return QS(n);if(GQ(n))return YQ(n);if(XQ(n))return ZQ(n);if(jS(n))return QQ(n)}function jD(n){try{for(const{code:e}of n.getComponents())if(e!==zu)return e===xu||e===ls}catch{}return!1}function Af(n){try{if(!jD(n))return!1;const[[,e]]=n.stringTuples();return e==null?!1:eb(e)??!1}catch{}return!0}const JQ=n=>n.toString().split("/").slice(1),nd=n=>({match:e=>e.length<1?!1:n(e[0])?e.slice(1):!1,pattern:"fn"}),Pt=n=>({match:e=>nd(t=>t===n).match(e),pattern:n}),Zl=()=>({match:n=>nd(e=>typeof e=="string").match(n),pattern:"{string}"}),xf=()=>({match:n=>nd(e=>!isNaN(parseInt(e))).match(n),pattern:"{number}"}),Jt=()=>({match:n=>{if(n.length<2||n[0]!=="p2p"&&n[0]!=="ipfs")return!1;if(n[1].startsWith("Q")||n[1].startsWith("1"))try{_r.decode(`z${n[1]}`)}catch{return!1}else return!1;return n.slice(2)},pattern:"/p2p/{peerid}"}),Ym=()=>({match:n=>{if(n.length<2||n[0]!=="certhash")return!1;try{cS.decode(n[1])}catch{return!1}return n.slice(2)},pattern:"/certhash/{certhash}"}),Kt=n=>({match:e=>{const t=n.match(e);return t===!1?e:t},pattern:`optional(${n.pattern})`}),Pn=(...n)=>({match:e=>{let t;for(const r of n){const i=r.match(e);i!==!1&&(t==null||i.length<t.length)&&(t=i)}return t??!1},pattern:`or(${n.map(e=>e.pattern).join(", ")})`}),Dt=(...n)=>({match:e=>{for(const t of n){const r=t.match(e);if(r===!1)return!1;e=r}return e},pattern:`and(${n.map(e=>e.pattern).join(", ")})`});function Er(...n){function e(i){let s=JQ(i);for(const o of n){const a=o.match(s);if(a===!1)return!1;s=a}return s}function t(i){return e(i)!==!1}function r(i){const s=e(i);return s===!1?!1:s.length===0}return{matchers:n,matches:t,exactMatch:r}}const eJ=Jt(),tJ=Er(eJ),tb=Dt(Pt("dns4"),Zl()),rb=Dt(Pt("dns6"),Zl()),nb=Dt(Pt("dnsaddr"),Zl()),JS=Dt(Pt("dns"),Zl());Er(tb,Kt(Jt()));Er(rb,Kt(Jt()));Er(nb,Kt(Jt()));Er(Pn(JS,nb,tb,rb),Kt(Jt()));const qD=Dt(Pt("ip4"),nd(Ul)),HD=Dt(Pt("ip6"),nd(jS)),eA=Pn(qD,HD),po=Pn(eA,JS,tb,rb,nb),rJ=Er(Pn(eA,Dt(Pn(JS,nb,tb,rb),Kt(Jt())))),dk=Er(qD),pk=Er(HD);Er(eA);const tA=Dt(po,Pt("tcp"),xf()),id=Dt(po,Pt("udp"),xf()),Xm=Er(Dt(tA,Kt(Jt())));Er(id);const rA=Dt(id,Pt("quic"),Kt(Jt())),ib=Dt(id,Pt("quic-v1"),Kt(Jt())),nJ=Pn(rA,ib);Er(rA);const iJ=Er(ib),K1=Pn(po,tA,id,rA,ib),WD=Pn(Dt(K1,Pt("ws"),Kt(Jt()))),If=Er(WD),zD=Pn(Dt(K1,Pt("wss"),Kt(Jt())),Dt(K1,Pt("tls"),Kt(Dt(Pt("sni"),Zl())),Pt("ws"),Kt(Jt()))),Tf=Er(zD),KD=Dt(id,Pt("webrtc-direct"),Kt(Ym()),Kt(Ym()),Kt(Jt())),gk=Er(KD),VD=Dt(ib,Pt("webtransport"),Kt(Ym()),Kt(Ym()),Kt(Jt())),mk=Er(VD),Zm=Pn(WD,zD,Dt(tA,Kt(Jt())),Dt(nJ,Kt(Jt())),Dt(po,Kt(Jt())),KD,VD,Jt());Er(Zm);const sJ=Dt(Zm,Pt("p2p-circuit"),Jt()),V1=Er(sJ),oJ=Pn(Dt(Zm,Pt("p2p-circuit"),Pt("webrtc"),Kt(Jt())),Dt(Zm,Pt("webrtc"),Kt(Jt())),Dt(Pt("webrtc"),Kt(Jt()))),yk=Er(oJ),aJ=Pn(Dt(po,Pt("tcp"),xf(),Pt("http"),Kt(Jt())),Dt(po,Pt("http"),Kt(Jt())));Er(aJ);const lJ=Pn(Dt(po,Pt("tcp"),Pn(Dt(Pt("443"),Pt("http")),Dt(xf(),Pt("https")),Dt(xf(),Pt("tls"),Pt("http"))),Kt(Jt())),Dt(po,Pt("tls"),Pt("http"),Kt(Jt())),Dt(po,Pt("https"),Kt(Jt())));Er(lJ);const cJ=Pn(Dt(Pt("memory"),Zl(),Kt(Jt())));Er(cJ);const uJ=Pn(Dt(Pt("unix"),Zl(),Kt(Jt())));Er(uJ);var jR,qR;class hJ extends(qR=WQ,jR=bo,qR){constructor(t,r={}){super(t,{...r,protocol:`/${r.protocolPrefix??Xs.protocolPrefix}/${BQ}/${UQ}`,log:t.logger.forComponent("libp2p:identify")});v(this,jR,["@libp2p/identify"]);(r.runOnConnectionOpen??Xs.runOnConnectionOpen)&&t.events.addEventListener("connection:open",i=>{const s=i.detail;this.identify(s).catch(o=>{o.name!==$y.name&&this.log.error("error during identify trigged by connection:open",o)})})}async _identify(t,r={}){let i;if(r.signal==null){const s=AbortSignal.timeout(this.timeout);r={...r,signal:s}}try{i=await t.newStream(this.protocol,{...r,runOnLimitedConnection:this.runOnLimitedConnection});const o=await fk(i,{maxDataLength:this.maxMessageSize}).pb(Gm).read(r);return await i.close(r),o}catch(s){throw i==null||i.abort(s),s}}async identify(t,r={}){const i=await this._identify(t,r),{publicKey:s,protocols:o,observedAddr:a}=i;if(s==null)throw new is("public key was missing from identify message");const l=Ea(s),c=Jf(l.toCID());if(!t.remotePeer.equals(c))throw new is("identified peer does not match the expected peer");if(this.peerId.equals(c))throw new is("identified peer is our own peer id?");return this.maybeAddObservedAddress(a),this.log("identify completed for peer %p and protocols %o",c,o),HQ(this.peerStore,this.events,this.log,t,i)}maybeAddObservedAddress(t){const r=jQ(t);if(r==null)return;if(this.log.trace("our observed address was %a",r),Af(r)){this.log.trace("our observed address was private");return}const i=r.getComponents();if((i[0].code===ls||i[0].code===zu&&i[1].code===ls)&&!zQ(r)){this.log.trace("our observed address was IPv6 but not a global unicast address");return}Xm.exactMatch(r)||(this.log.trace("storing the observed address"),this.addressManager.addObservedAddr(r))}async handleProtocol(t){const{connection:r,stream:i}=t,s=AbortSignal.timeout(this.timeout);try{const o=await this.peerStore.get(this.peerId),a=this.addressManager.getAddresses().map(d=>d.decapsulateCode(HS("p2p").code));let l=o.peerRecordEnvelope;if(a.length>0&&l==null){const d=new fo({peerId:this.peerId,multiaddrs:a});l=(await Wl.seal(d,this.privateKey)).marshal().subarray()}let c=r.remoteAddr.bytes;rJ.matches(r.remoteAddr)||(c=void 0),await fk(i).pb(Gm).write({protocolVersion:this.host.protocolVersion,agentVersion:this.host.agentVersion,publicKey:ho(this.privateKey.publicKey),listenAddrs:a.map(d=>d.bytes),signedPeerRecord:l,observedAddr:c,protocols:o.protocols},{signal:s}),await i.close({signal:s})}catch(o){this.log.error("could not respond to identify request",o),i.abort(o)}}}function fJ(n={}){return e=>new hJ(e,n)}function dJ(n){if(n!=null){if(typeof n[Symbol.iterator]=="function")return n[Symbol.iterator]();if(typeof n[Symbol.asyncIterator]=="function")return n[Symbol.asyncIterator]();if(typeof n.next=="function")return n}throw new Error("argument is not an iterator or iterable")}function pJ(n){return n==null?!1:typeof n.then=="function"&&typeof n.catch=="function"&&typeof n.finally=="function"}function GD(n,e){var r,i;const t=(i=(r=dJ(n)).return)==null?void 0:i.call(r);pJ(t)&&t.catch(s=>{e.error("could not cause iterator to return",s)})}const bk=()=>{const n=new Error("Delay aborted");return n.name="AbortError",n},gJ=new WeakMap;function mJ({clearTimeout:n,setTimeout:e}={}){return(t,{value:r,signal:i}={})=>{if(i!=null&&i.aborted)return Promise.reject(bk());let s,o,a;const l=n??clearTimeout,c=()=>{l(s),a(bk())},h=()=>{i&&i.removeEventListener("abort",c)},d=new Promise((p,g)=>{o=()=>{h(),p(r)},a=g,s=(e??setTimeout)(o,t)});return i&&i.addEventListener("abort",c,{once:!0}),gJ.set(d,()=>{l(s),s=null,o()}),d}}const yJ=mJ();class bJ extends Error{constructor(t="Rate limit exceeded",r){super(t);v(this,"remainingPoints");v(this,"msBeforeNext");v(this,"consumedPoints");v(this,"isFirstInDuration");this.name="RateLimitError",this.remainingPoints=r.remainingPoints,this.msBeforeNext=r.msBeforeNext,this.consumedPoints=r.consumedPoints,this.isFirstInDuration=r.isFirstInDuration}}var uv;let wJ=(uv=class extends Error{constructor(e="The queue was full"){super(e),this.name="QueueFullError"}},v(uv,"name","QueueFullError"),uv);class YD{constructor(e={}){v(this,"memoryStorage");v(this,"points");v(this,"duration");v(this,"blockDuration");v(this,"execEvenly");v(this,"execEvenlyMinDelayMs");v(this,"keyPrefix");this.points=e.points??4,this.duration=e.duration??1,this.blockDuration=e.blockDuration??0,this.execEvenly=e.execEvenly??!1,this.execEvenlyMinDelayMs=e.execEvenlyMinDelayMs??this.duration*1e3/this.points,this.keyPrefix=e.keyPrefix??"rlflx",this.memoryStorage=new vJ}async consume(e,t=1,r={}){const i=this.getKey(e),s=this._getKeySecDuration(r);let o=this.memoryStorage.incrby(i,t,s);if(o.remainingPoints=Math.max(this.points-o.consumedPoints,0),o.consumedPoints>this.points)throw this.blockDuration>0&&o.consumedPoints<=this.points+t&&(o=this.memoryStorage.set(i,o.consumedPoints,this.blockDuration)),new bJ("Rate limit exceeded",o);if(this.execEvenly&&o.msBeforeNext>0&&!o.isFirstInDuration){let a=Math.ceil(o.msBeforeNext/(o.remainingPoints+2));a<this.execEvenlyMinDelayMs&&(a=o.consumedPoints*this.execEvenlyMinDelayMs),await yJ(a)}return o}penalty(e,t=1,r={}){const i=this.getKey(e),s=this._getKeySecDuration(r),o=this.memoryStorage.incrby(i,t,s);return o.remainingPoints=Math.max(this.points-o.consumedPoints,0),o}reward(e,t=1,r={}){const i=this.getKey(e),s=this._getKeySecDuration(r),o=this.memoryStorage.incrby(i,-t,s);return o.remainingPoints=Math.max(this.points-o.consumedPoints,0),o}block(e,t){const r=t*1e3,i=this.points+1;return this.memoryStorage.set(this.getKey(e),i,t),{remainingPoints:0,msBeforeNext:r===0?-1:r,consumedPoints:i,isFirstInDuration:!1}}set(e,t,r=0){const i=(r>=0?r:this.duration)*1e3;return this.memoryStorage.set(this.getKey(e),t,r),{remainingPoints:0,msBeforeNext:i===0?-1:i,consumedPoints:t,isFirstInDuration:!1}}get(e){const t=this.memoryStorage.get(this.getKey(e));return t!=null&&(t.remainingPoints=Math.max(this.points-t.consumedPoints,0)),t}delete(e){this.memoryStorage.delete(this.getKey(e))}_getKeySecDuration(e){return(e==null?void 0:e.customDuration)!=null&&e.customDuration>=0?e.customDuration:this.duration}getKey(e){return this.keyPrefix.length>0?`${this.keyPrefix}:${e}`:e}parseKey(e){return e.substring(this.keyPrefix.length)}}class vJ{constructor(){v(this,"storage");this.storage=new Map}incrby(e,t,r){const i=this.storage.get(e);if(i!=null){const s=i.expiresAt!=null?i.expiresAt.getTime()-new Date().getTime():-1;return i.expiresAt==null||s>0?(i.value+=t,{remainingPoints:0,msBeforeNext:s,consumedPoints:i.value,isFirstInDuration:!1}):this.set(e,t,r)}return this.set(e,t,r)}set(e,t,r){const i=r*1e3,s=this.storage.get(e);s!=null&&clearTimeout(s.timeoutId);const o={value:t,expiresAt:i>0?new Date(Date.now()+i):void 0};return this.storage.set(e,o),i>0&&(o.timeoutId=setTimeout(()=>{this.storage.delete(e)},i),o.timeoutId.unref!=null&&o.timeoutId.unref()),{remainingPoints:0,msBeforeNext:i===0?-1:i,consumedPoints:o.value,isFirstInDuration:!0}}get(e){const t=this.storage.get(e);if(t!=null)return{remainingPoints:0,msBeforeNext:t.expiresAt!=null?t.expiresAt.getTime()-new Date().getTime():-1,consumedPoints:t.value,isFirstInDuration:!1}}delete(e){const t=this.storage.get(e);return t!=null?(t.timeoutId!=null&&clearTimeout(t.timeoutId),this.storage.delete(e),!0):!1}}var Ft;(function(n){n[n.NEW_STREAM=0]="NEW_STREAM",n[n.MESSAGE_RECEIVER=1]="MESSAGE_RECEIVER",n[n.MESSAGE_INITIATOR=2]="MESSAGE_INITIATOR",n[n.CLOSE_RECEIVER=3]="CLOSE_RECEIVER",n[n.CLOSE_INITIATOR=4]="CLOSE_INITIATOR",n[n.RESET_RECEIVER=5]="RESET_RECEIVER",n[n.RESET_INITIATOR=6]="RESET_INITIATOR"})(Ft||(Ft={}));const nA=Object.freeze({0:"NEW_STREAM",1:"MESSAGE_RECEIVER",2:"MESSAGE_INITIATOR",3:"CLOSE_RECEIVER",4:"CLOSE_INITIATOR",5:"RESET_RECEIVER",6:"RESET_INITIATOR"}),wk=Object.freeze({NEW_STREAM:Ft.NEW_STREAM,MESSAGE:Ft.MESSAGE_INITIATOR,CLOSE:Ft.CLOSE_INITIATOR,RESET:Ft.RESET_INITIATOR}),_J=Object.freeze({MESSAGE:Ft.MESSAGE_RECEIVER,CLOSE:Ft.CLOSE_RECEIVER,RESET:Ft.RESET_RECEIVER}),XD=1<<20,EJ=4<<20;class SJ{constructor(e=XD,t=EJ){v(this,"_buffer");v(this,"_headerInfo");v(this,"_maxMessageSize");v(this,"_maxUnprocessedMessageQueueSize");this._buffer=new bt,this._headerInfo=null,this._maxMessageSize=e,this._maxUnprocessedMessageQueueSize=t}write(e){if(e==null||e.length===0)return[];if(this._buffer.append(e),this._buffer.byteLength>this._maxUnprocessedMessageQueueSize)throw new is("Unprocessed message queue size too large!");const t=[];for(;this._buffer.length!==0;){if(this._headerInfo==null)try{this._headerInfo=this._decodeHeader(this._buffer)}catch(c){if(c.name==="InvalidMessageError")throw c;break}const{id:r,type:i,length:s,offset:o}=this._headerInfo;if(this._buffer.length-o<s)break;const l={id:r,type:i};(i===Ft.NEW_STREAM||i===Ft.MESSAGE_INITIATOR||i===Ft.MESSAGE_RECEIVER)&&(l.data=this._buffer.sublist(o,o+s)),t.push(l),this._buffer.consume(o+s),this._headerInfo=null}return t}_decodeHeader(e){const{value:t,offset:r}=_k(e),{value:i,offset:s}=_k(e,r),o=t&7;if(nA[o]==null)throw new Error(`Invalid type received: ${o}`);if(i>this._maxMessageSize)throw new is("Message size too large");return{id:t>>3,type:o,offset:r+s,length:i}}}const AJ=128,vk=127;function _k(n,e=0){let t=0,r=0,i=e,s;const o=n.length;do{if(i>=o||r>49)throw e=0,new RangeError("Could not decode varint");s=n.get(i++),t+=r<28?(s&vk)<<r:(s&vk)*Math.pow(2,r),r+=7}while(s>=AJ);return e=i-e,{value:t,offset:e}}const hw=10*1024;class xJ{constructor(){v(this,"_pool");v(this,"_poolOffset");this._pool=Ei(hw),this._poolOffset=0}write(e,t){const r=this._pool;let i=this._poolOffset;Ts(e.id<<3|e.type,r,i),i+=un(e.id<<3|e.type),(e.type===Ft.NEW_STREAM||e.type===Ft.MESSAGE_INITIATOR||e.type===Ft.MESSAGE_RECEIVER)&&e.data!=null?(Ts(e.data.length,r,i),i+=un(e.data.length)):(Ts(0,r,i),i+=un(0));const s=r.subarray(this._poolOffset,i);hw-i<100?(this._pool=Ei(hw),this._poolOffset=0):this._poolOffset=i,t.append(s),(e.type===Ft.NEW_STREAM||e.type===Ft.MESSAGE_INITIATOR||e.type===Ft.MESSAGE_RECEIVER)&&e.data!=null&&t.append(e.data)}}const IJ=new xJ;async function*TJ(n){for await(const e of n){const t=new bt;IJ.write(e,t),yield t}}class CJ extends Error{constructor(e="Stream input buffer error"){super(e),this.name="StreamInputBufferError"}}const kJ=5e3;function fw(n){return n==null?!1:typeof n.then=="function"&&typeof n.catch=="function"&&typeof n.finally=="function"}class PJ{constructor(e){v(this,"id");v(this,"direction");v(this,"timeline");v(this,"protocol");v(this,"metadata");v(this,"source");v(this,"status");v(this,"readStatus");v(this,"writeStatus");v(this,"log");v(this,"sinkController");v(this,"sinkEnd");v(this,"closed");v(this,"endErr");v(this,"streamSource");v(this,"onEnd");v(this,"onCloseRead");v(this,"onCloseWrite");v(this,"onReset");v(this,"onAbort");v(this,"sendCloseWriteTimeout");v(this,"sendingData");this.sinkController=new AbortController,this.sinkEnd=qr(),this.closed=qr(),this.log=e.log,this.status="open",this.readStatus="ready",this.writeStatus="ready",this.id=e.id,this.metadata=e.metadata??{},this.direction=e.direction,this.timeline={open:Date.now()},this.sendCloseWriteTimeout=e.sendCloseWriteTimeout??kJ,this.onEnd=e.onEnd,this.onCloseRead=e.onCloseRead,this.onCloseWrite=e.onCloseWrite,this.onReset=e.onReset,this.onAbort=e.onAbort,this.source=this.streamSource=Gf({onEnd:t=>{t!=null?this.log.trace("source ended with error",t):this.log.trace("source ended"),this.onSourceEnd(t)}}),this.sink=this.sink.bind(this)}async sink(e){if(this.writeStatus!=="ready")throw new LL(`writable end state is "${this.writeStatus}" not "ready"`);try{this.writeStatus="writing";const t={signal:this.sinkController.signal};if(this.direction==="outbound"){const i=this.sendNewStream(t);fw(i)&&await i}const r=()=>{GD(e,this.log)};try{this.sinkController.signal.addEventListener("abort",r),this.log.trace("sink reading from source");for await(let i of e){i=i instanceof Uint8Array?new bt(i):i;const s=this.sendData(i,t);fw(s)&&(this.sendingData=qr(),await s,this.sendingData.resolve(),this.sendingData=void 0)}}finally{this.sinkController.signal.removeEventListener("abort",r)}this.log.trace('sink finished reading from source, write status is "%s"',this.writeStatus),this.writeStatus==="writing"&&(this.writeStatus="closing",this.log.trace("send close write to remote"),await this.sendCloseWrite({signal:AbortSignal.timeout(this.sendCloseWriteTimeout)}),this.writeStatus="closed"),this.onSinkEnd()}catch(t){throw this.log.trace("sink ended with error, calling abort with error",t),this.abort(t),t}finally{this.log.trace("resolve sink end"),this.sinkEnd.resolve()}}onSourceEnd(e){var t;this.timeline.closeRead==null&&(this.timeline.closeRead=Date.now(),this.readStatus="closed",e!=null&&this.endErr==null&&(this.endErr=e),(t=this.onCloseRead)==null||t.call(this),this.timeline.closeWrite!=null?(this.log.trace("source and sink ended"),this.timeline.close=Date.now(),this.status!=="aborted"&&this.status!=="reset"&&(this.status="closed"),this.onEnd!=null&&this.onEnd(this.endErr),this.closed.resolve()):this.log.trace("source ended, waiting for sink to end"))}onSinkEnd(e){var t;this.timeline.closeWrite==null&&(this.timeline.closeWrite=Date.now(),this.writeStatus="closed",e!=null&&this.endErr==null&&(this.endErr=e),(t=this.onCloseWrite)==null||t.call(this),this.timeline.closeRead!=null?(this.log.trace("sink and source ended"),this.timeline.close=Date.now(),this.status!=="aborted"&&this.status!=="reset"&&(this.status="closed"),this.onEnd!=null&&this.onEnd(this.endErr),this.closed.resolve()):this.log.trace("sink ended, waiting for source to end"))}async close(e){this.status==="open"&&(this.log.trace("closing gracefully"),this.status="closing",await Un(Promise.all([this.closeWrite(e),this.closeRead(e),this.closed.promise]),e==null?void 0:e.signal),this.status="closed",this.log.trace("closed gracefully"))}async closeRead(e={}){if(this.readStatus==="closing"||this.readStatus==="closed")return;this.log.trace('closing readable end of stream with starting read status "%s"',this.readStatus);const t=this.readStatus;this.readStatus="closing",this.status!=="reset"&&this.status!=="aborted"&&this.timeline.closeRead==null&&(this.log.trace("send close read to remote"),await this.sendCloseRead(e)),t==="ready"&&(this.log.trace("ending internal source queue with %d queued bytes",this.streamSource.readableLength),this.streamSource.end()),this.log.trace("closed readable end of stream")}async closeWrite(e={}){this.writeStatus==="closing"||this.writeStatus==="closed"||(this.log.trace('closing writable end of stream with starting write status "%s"',this.writeStatus),this.writeStatus==="ready"&&(this.log.trace("sink was never sunk, sink an empty array"),await Un(this.sink([]),e.signal)),this.writeStatus==="writing"&&(this.sendingData!=null&&await Un(this.sendingData.promise,e.signal),this.log.trace("aborting source passed to .sink"),this.sinkController.abort(),await Un(this.sinkEnd.promise,e.signal)),this.writeStatus="closed",this.log.trace("closed writable end of stream"))}abort(e){var r;if(this.status==="closed"||this.status==="aborted"||this.status==="reset")return;this.log("abort with error",e),this.log("try to send reset to remote");const t=this.sendReset();fw(t)&&t.catch(i=>{this.log.error("error sending reset message",i)}),this.status="aborted",this.timeline.abort=Date.now(),this._closeSinkAndSource(e),(r=this.onAbort)==null||r.call(this,e)}reset(){var t;if(this.status==="closed"||this.status==="aborted"||this.status==="reset")return;const e=new OL("stream reset");this.status="reset",this.timeline.reset=Date.now(),this._closeSinkAndSource(e),(t=this.onReset)==null||t.call(this)}_closeSinkAndSource(e){this._closeSink(e),this._closeSource(e)}_closeSink(e){this.writeStatus==="writing"&&(this.log.trace("end sink source"),this.sinkController.abort()),this.onSinkEnd(e)}_closeSource(e){this.readStatus!=="closing"&&this.readStatus!=="closed"&&(this.log.trace("ending source with %d bytes to be read by consumer",this.streamSource.readableLength),this.readStatus="closing",this.streamSource.end(e))}remoteCloseWrite(){if(this.readStatus==="closing"||this.readStatus==="closed"){this.log("received remote close write but local source is already closed");return}this.log.trace("remote close write"),this._closeSource()}remoteCloseRead(){if(this.writeStatus==="closing"||this.writeStatus==="closed"){this.log("received remote close read but local sink is already closed");return}this.log.trace("remote close read"),this._closeSink()}destroy(){if(this.status==="closed"||this.status==="aborted"||this.status==="reset"){this.log("received destroy but we are already closed");return}this.log.trace("stream destroyed"),this._closeSinkAndSource()}sourcePush(e){this.streamSource.push(e)}sourceReadableLength(){return this.streamSource.readableLength}}class RJ extends PJ{constructor(t){super(t);v(this,"name");v(this,"streamId");v(this,"send");v(this,"types");v(this,"maxDataSize");this.types=t.direction==="outbound"?wk:_J,this.send=t.send,this.name=t.name,this.streamId=t.streamId,this.maxDataSize=t.maxDataSize}async sendNewStream(){await this.send({id:this.streamId,type:wk.NEW_STREAM,data:new bt(at(this.name))})}async sendData(t){for(t=t.sublist();t.byteLength>0;){const r=Math.min(t.byteLength,this.maxDataSize);await this.send({id:this.streamId,type:this.types.MESSAGE,data:t.sublist(0,r)}),t.consume(r)}}async sendReset(){await this.send({id:this.streamId,type:this.types.RESET})}async sendCloseWrite(){await this.send({id:this.streamId,type:this.types.CLOSE})}async sendCloseRead(){}}function OJ(n){const{id:e,name:t,send:r,onEnd:i,type:s="initiator",maxMsgSize:o=XD}=n;return new RJ({id:s==="initiator"?`i${e}`:`r${e}`,streamId:e,name:`${t??e}`,direction:s==="initiator"?"outbound":"inbound",maxDataSize:o,onEnd:i,send:r,log:n.logger.forComponent(`libp2p:mplex:stream:${s}:${e}`)})}const LJ=1024,NJ=1024,DJ=1024*1024*4,$J=5,MJ=500;function Ek(n){const e={...n,type:`${nA[n.type]} (${n.type})`};return n.type===Ft.NEW_STREAM&&(e.data=mt(n.data instanceof Uint8Array?n.data:n.data.subarray())),(n.type===Ft.MESSAGE_INITIATOR||n.type===Ft.MESSAGE_RECEIVER)&&(e.data=mt(n.data instanceof Uint8Array?n.data:n.data.subarray(),"base16")),e}class BJ{constructor(e,t){v(this,"protocol","/mplex/6.7.0");v(this,"sink");v(this,"source");v(this,"log");v(this,"_streamId");v(this,"_streams");v(this,"_init");v(this,"_source");v(this,"closeController");v(this,"rateLimiter");v(this,"closeTimeout");v(this,"logger");t=t??{},this.log=e.logger.forComponent("libp2p:mplex"),this.logger=e.logger,this._streamId=0,this._streams={initiators:new Map,receivers:new Map},this._init=t,this.closeTimeout=t.closeTimeout??MJ,this.sink=this._createSink(),this._source=Gf({objectMode:!0,onEnd:()=>{for(const r of this._streams.initiators.values())r.destroy();for(const r of this._streams.receivers.values())r.destroy()}}),this.source=Fi(this._source,r=>TJ(r)),this.closeController=new AbortController,this.rateLimiter=new YD({points:t.disconnectThreshold??$J,duration:1})}get streams(){const e=[];for(const t of this._streams.initiators.values())e.push(t);for(const t of this._streams.receivers.values())e.push(t);return e}newStream(e){if(this.closeController.signal.aborted)throw new RL("Muxer already closed");const t=this._streamId++;e=e==null?t.toString():e.toString();const r=this._streams.initiators;return this._newStream({id:t,name:e,type:"initiator",registry:r})}async close(e){if(this.closeController.signal.aborted)return;const t=(e==null?void 0:e.signal)??AbortSignal.timeout(this.closeTimeout);try{await Promise.all(this.streams.map(async r=>r.close({signal:t}))),this._source.end(),await this._source.onEmpty({signal:t}),this.closeController.abort()}catch(r){this.abort(r)}}abort(e){this.closeController.signal.aborted||(this.streams.forEach(t=>{t.abort(e)}),this.closeController.abort(e))}_newReceiverStream(e){const{id:t,name:r}=e,i=this._streams.receivers;return this._newStream({id:t,name:r,type:"receiver",registry:i})}_newStream(e){const{id:t,name:r,type:i,registry:s}=e;if(this.log("new %s stream %s",i,t),i==="initiator"&&this._streams.initiators.size===(this._init.maxOutboundStreams??NJ))throw new vS("Too many outbound streams open");if(s.has(t))throw new Error(`${i} stream ${t} already exists!`);const l=OJ({id:t,name:r,send:async c=>{this.log.enabled&&this.log.trace("%s stream %s send",i,t,Ek(c)),this._source.push(c)},type:i,onEnd:()=>{this.log("%s stream with id %s and protocol %s ended",i,t,l.protocol),s.delete(t),this._init.onStreamEnd!=null&&this._init.onStreamEnd(l)},maxMsgSize:this._init.maxMsgSize,logger:this.logger});return s.set(t,l),l}_createSink(){return async t=>{const r=()=>{GD(t,this.log)};this.closeController.signal.addEventListener("abort",r);try{const i=new SJ(this._init.maxMsgSize,this._init.maxUnprocessedMessageQueueSize);for await(const s of t)for(const o of i.write(s))await this._handleIncoming(o);this._source.end()}catch(i){this.log("error in sink",i),this._source.end(i)}finally{this.closeController.signal.removeEventListener("abort",r)}}}async _handleIncoming(e){const{id:t,type:r}=e;if(this.log.enabled&&this.log.trace("incoming message",Ek(e)),e.type===Ft.NEW_STREAM){if(this._streams.receivers.size===(this._init.maxInboundStreams??LJ)){this.log("too many inbound streams open"),this._source.push({id:t,type:Ft.RESET_RECEIVER});try{await this.rateLimiter.consume("new-stream",1)}catch{this.log("rate limit hit when opening too many new streams over the inbound stream limit - closing remote connection"),this.abort(new Error("Too many open streams"));return}return}const a=this._newReceiverStream({id:t,name:mt(e.data instanceof Uint8Array?e.data:e.data.subarray())});this._init.onIncomingStream!=null&&this._init.onIncomingStream(a);return}const s=((r&1)===1?this._streams.initiators:this._streams.receivers).get(t);if(s==null){this.log("missing stream %s for message type %s",t,nA[r]);try{await this.rateLimiter.consume("missing-stream",1)}catch{this.log("rate limit hit when receiving messages for streams that do not exist - closing remote connection"),this.abort(new Error("Too many messages for missing streams"));return}return}const o=this._init.maxStreamBufferSize??DJ;try{switch(r){case Ft.MESSAGE_INITIATOR:case Ft.MESSAGE_RECEIVER:if(s.sourceReadableLength()>o)throw this._source.push({id:e.id,type:r===Ft.MESSAGE_INITIATOR?Ft.RESET_RECEIVER:Ft.RESET_INITIATOR}),new CJ("Input buffer full - increase Mplex maxBufferSize to accommodate slow consumers");s.sourcePush(e.data);break;case Ft.CLOSE_INITIATOR:case Ft.CLOSE_RECEIVER:s.remoteCloseWrite();break;case Ft.RESET_INITIATOR:case Ft.RESET_RECEIVER:s.reset();break;default:this.log("unknown message type %s",r)}}catch(a){this.log.error("error while processing message",a),s.abort(a)}}}var HR,WR;WR=Symbol.toStringTag,HR=bo;class UJ{constructor(e,t={}){v(this,"protocol","/mplex/6.7.0");v(this,"_init");v(this,"components");v(this,WR,"@libp2p/mplex");v(this,HR,["@libp2p/stream-multiplexing"]);this.components=e,this._init=t}createStreamMuxer(e={}){return new BJ(this.components,{...e,...this._init})}}function FJ(n={}){return e=>new UJ(e,n)}const dw=32,jJ="1.0.0",qJ="ping",HJ="ipfs",WJ=1e4,zJ=2,KJ=1;var zR,KR;KR=Symbol.toStringTag,zR=bo;class VJ{constructor(e,t={}){v(this,"protocol");v(this,"components");v(this,"started");v(this,"timeout");v(this,"maxInboundStreams");v(this,"maxOutboundStreams");v(this,"runOnLimitedConnection");v(this,"log");v(this,KR,"@libp2p/ping");v(this,zR,["@libp2p/ping"]);this.components=e,this.log=e.logger.forComponent("libp2p:ping"),this.started=!1,this.protocol=`/${t.protocolPrefix??HJ}/${qJ}/${jJ}`,this.timeout=t.timeout??WJ,this.maxInboundStreams=t.maxInboundStreams??zJ,this.maxOutboundStreams=t.maxOutboundStreams??KJ,this.runOnLimitedConnection=t.runOnLimitedConnection??!0,this.handleMessage=this.handleMessage.bind(this)}async start(){await this.components.registrar.handle(this.protocol,this.handleMessage,{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams,runOnLimitedConnection:this.runOnLimitedConnection}),this.started=!0}async stop(){await this.components.registrar.unhandle(this.protocol),this.started=!1}isStarted(){return this.started}handleMessage(e){this.log("incoming ping from %p",e.connection.remotePeer);const{stream:t}=e,r=Date.now(),i=Bm(t);let s=!1;Promise.resolve().then(async()=>{for(;;){const o=AbortSignal.timeout(this.timeout);o.addEventListener("abort",()=>{t==null||t.abort(new $L("ping timeout"))});const a=await i.read({bytes:dw,signal:o});await i.write(a,{signal:o}),s=!0}}).catch(o=>{s&&o.name==="UnexpectedEOFError"&&t.readStatus!=="ready"||(this.log.error("incoming ping from %p failed with error - %e",e.connection.remotePeer,o),t==null||t.abort(o))}).finally(()=>{const o=Date.now()-r;this.log("incoming ping from %p complete in %dms",e.connection.remotePeer,o);const a=AbortSignal.timeout(this.timeout);t.close({signal:a}).catch(l=>{this.log.error("error closing ping stream from %p - %e",e.connection.remotePeer,l),t==null||t.abort(l)})})}async ping(e,t={}){this.log("pinging %p",e);const r=Date.now(),i=BS(dw),s=await this.components.connectionManager.openConnection(e,t);let o;if(t.signal==null){const a=AbortSignal.timeout(this.timeout);t={...t,signal:a}}try{o=await s.newStream(this.protocol,{...t,runOnLimitedConnection:this.runOnLimitedConnection});const a=Bm(o),[,l]=await Promise.all([a.write(i,t),a.read({...t,bytes:dw})]),c=Date.now()-r;if(!Or(i,l.subarray()))throw new Pz(`Received wrong ping ack after ${c}ms`);return this.log("ping %p complete in %dms",s.remotePeer,c),c}catch(a){throw this.log.error("error while pinging %p",s.remotePeer,a),o==null||o.abort(a),a}finally{o!=null&&await o.close(t)}}}function GJ(n={}){return e=>new VJ(e,n)}const YJ=[Dm,zy,Vy,Ky,ed];function Sk(n){var e;return(e=ZD("sni",n))==null?void 0:e.value}function Ak(n){var t;const e=(t=ZD("tcp",n))==null?void 0:t.value;return e==null?"":`:${e}`}function ZD(n,e){return e.find(t=>t.name===n)}function xk(n){return n.some(({code:e})=>e===qN)}function Xi(n,e){const t=QD[n.name];if(t==null)throw new Error(`Can't interpret protocol ${n.name}`);const r=t(n,e);return n.code===ls?`[${r}]`:r}const QD={ip4:(n,e)=>n.value,ip6:(n,e)=>e.length===0?n.value:`[${n.value}]`,tcp:(n,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");return`tcp://${Xi(t,e)}:${n.value}`},udp:(n,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");return`udp://${Xi(t,e)}:${n.value}`},dnsaddr:(n,e)=>n.value,dns4:(n,e)=>n.value,dns6:(n,e)=>n.value,dns:(n,e)=>n.value,ipfs:(n,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");return`${Xi(t,e)}`},p2p:(n,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");return`${Xi(t,e)}`},http:(n,e)=>{const t=xk(e),r=Sk(e),i=Ak(e);if(t&&r!=null)return`https://${r}${i}`;const s=t?"https://":"http://",o=e.pop();if(o==null)throw new Error("Unexpected end of multiaddr");let a=Xi(o,e);return a=a==null?void 0:a.replace("tcp://",""),`${s}${a}`},"http-path":(n,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");const r=Xi(t,e),i=decodeURIComponent(n.value??"");return`${r}${i}`},tls:(n,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");return Xi(t,e)},sni:(n,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");return Xi(t,e)},https:(n,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");let r=Xi(t,e);return r=r==null?void 0:r.replace("tcp://",""),`https://${r}`},ws:(n,e)=>{const t=xk(e),r=Sk(e),i=Ak(e);if(t&&r!=null)return`wss://${r}${i}`;const s=t?"wss://":"ws://",o=e.pop();if(o==null)throw new Error("Unexpected end of multiaddr");let a=Xi(o,e);return a=a==null?void 0:a.replace("tcp://",""),`${s}${a}`},wss:(n,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");let r=Xi(t,e);return r=r==null?void 0:r.replace("tcp://",""),`wss://${r}`}};function XJ(n,e){const r=Nt(n).getComponents(),i=r.pop();if(i==null)throw new Error("Unexpected end of multiaddr");const s=QD[i.name];if(s==null)throw new Error(`No interpreter found for ${i.name}`);let o=s(i,r)??"";return YJ.includes(i.code)&&(o=o.replace(/^.*:\/\//,""),i.value==="443"?o=`https://${o}`:o=`http://${o}`),(o.startsWith("http://")||o.startsWith("https://")||o.startsWith("ws://")||o.startsWith("wss://"))&&(o=new URL(o).toString(),o.endsWith("/")&&(o=o.substring(0,o.length-1))),o}const ZJ=async n=>{if(n.readyState>=2)throw new Error("socket closed");n.readyState!==1&&await new Promise((e,t)=>{function r(){n.removeEventListener("open",i),n.removeEventListener("error",s)}function i(){r(),e()}function s(o){r(),t(o.error??new Error(`connect ECONNREFUSED ${n.url}`))}n.addEventListener("open",i),n.addEventListener("error",s)})},QJ=(n,e)=>(e=e??{},e.closeOnEnd=e.closeOnEnd!==!1,async r=>{for await(const i of r){try{await ZJ(n)}catch(s){if(s.message==="socket closed")break;throw s}if(n.readyState===n.CLOSING||n.readyState===n.CLOSED)break;n.send(i)}e.closeOnEnd!=null&&n.readyState<=1&&await new Promise((i,s)=>{n.addEventListener("close",o=>{if(o.wasClean||o.code===1006)i();else{const a=Object.assign(new Error("ws error"),{event:o});s(a)}}),setTimeout(()=>{n.close()})})});var sb={},ob={};Object.defineProperty(ob,"__esModule",{value:!0});class JJ{constructor(){this.pullQueue=[],this.pushQueue=[],this.eventHandlers={},this.isPaused=!1,this.isStopped=!1}push(e){if(this.isStopped)return;const t={value:e,done:!1};if(this.pullQueue.length){const r=this.pullQueue.shift();r&&r.resolve(t)}else this.pushQueue.push(Promise.resolve(t)),this.highWaterMark!==void 0&&this.pushQueue.length>=this.highWaterMark&&!this.isPaused&&(this.isPaused=!0,this.eventHandlers.highWater?this.eventHandlers.highWater():console&&console.warn(`EventIterator queue reached ${this.pushQueue.length} items`))}stop(){if(!this.isStopped){this.isStopped=!0,this.remove();for(const e of this.pullQueue)e.resolve({value:void 0,done:!0});this.pullQueue.length=0}}fail(e){if(!this.isStopped)if(this.isStopped=!0,this.remove(),this.pullQueue.length){for(const t of this.pullQueue)t.reject(e);this.pullQueue.length=0}else{const t=Promise.reject(e);t.catch(()=>{}),this.pushQueue.push(t)}}remove(){Promise.resolve().then(()=>{this.removeCallback&&this.removeCallback()})}[Symbol.asyncIterator](){return{next:e=>{const t=this.pushQueue.shift();return t?(this.lowWaterMark!==void 0&&this.pushQueue.length<=this.lowWaterMark&&this.isPaused&&(this.isPaused=!1,this.eventHandlers.lowWater&&this.eventHandlers.lowWater()),t):this.isStopped?Promise.resolve({value:void 0,done:!0}):new Promise((r,i)=>{this.pullQueue.push({resolve:r,reject:i})})},return:()=>(this.isStopped=!0,this.pushQueue.length=0,this.remove(),Promise.resolve({value:void 0,done:!0}))}}}let JD=class{constructor(e,{highWaterMark:t=100,lowWaterMark:r=1}={}){const i=new JJ;i.highWaterMark=t,i.lowWaterMark=r,i.removeCallback=e({push:s=>i.push(s),stop:()=>i.stop(),fail:s=>i.fail(s),on:(s,o)=>{i.eventHandlers[s]=o}})||(()=>{}),this[Symbol.asyncIterator]=()=>i[Symbol.asyncIterator](),Object.freeze(this)}};ob.EventIterator=JD;ob.default=JD;Object.defineProperty(sb,"__esModule",{value:!0});const iA=ob;var eee=sb.EventIterator=iA.EventIterator;function tee(n,e,t){return new iA.EventIterator(({push:r})=>(this.addEventListener(n,r,e),()=>this.removeEventListener(n,r,e)),t)}sb.subscribe=tee;sb.default=iA.EventIterator;function Ik(n){var e;return n instanceof ArrayBuffer||((e=n==null?void 0:n.constructor)==null?void 0:e.name)==="ArrayBuffer"&&typeof(n==null?void 0:n.byteLength)=="number"}const ree=n=>{n.binaryType="arraybuffer";const e=async()=>{await new Promise((s,o)=>{if(r){s();return}if(i!=null){o(i);return}const a=h=>{n.removeEventListener("open",l),n.removeEventListener("error",c),h()},l=()=>{a(s)},c=h=>{a(()=>{o(h.error??new Error(`connect ECONNREFUSED ${n.url}`))})};n.addEventListener("open",l),n.addEventListener("error",c)})},t=async function*(){const s=new eee(({push:o,stop:a,fail:l})=>{const c=d=>{let p=null;typeof d.data=="string"&&(p=at(d.data)),Ik(d.data)&&(p=new Uint8Array(d.data)),d.data instanceof Uint8Array&&(p=d.data),p!=null&&o(p)},h=d=>{l(d.error??new Error("Socket error"))};return n.addEventListener("message",c),n.addEventListener("error",h),n.addEventListener("close",a),()=>{n.removeEventListener("message",c),n.removeEventListener("error",h),n.removeEventListener("close",a)}},{highWaterMark:1/0});await e();for await(const o of s)yield Ik(o)?new Uint8Array(o):o}();let r=n.readyState===1,i;return n.addEventListener("open",()=>{r=!0,i=null}),n.addEventListener("close",()=>{r=!1,i=null}),n.addEventListener("error",s=>{r||(i=s.error??new Error(`connect ECONNREFUSED ${n.url}`))}),Object.assign(t,{connected:e})},nee=(n,e)=>{e=e??{};const t=ree(n);let r=e.remoteAddress,i=e.remotePort;if(n.url!=null)try{const o=new URL(n.url);r=o.hostname,i=parseInt(o.port,10)}catch{}if(r==null||i==null)throw new Error("Remote connection did not have address and/or port");return{sink:QJ(n,e),source:t,connected:async()=>{await t.connected()},close:async()=>{(n.readyState===n.CONNECTING||n.readyState===n.OPEN)&&await new Promise(o=>{n.addEventListener("close",()=>{o()}),n.close()})},destroy:()=>{n.terminate!=null?n.terminate():n.close()},remoteAddress:r,remotePort:i,socket:n}},iee=WebSocket,see={"http:":"ws:","https:":"wss:"},Tk="ws:",oee=(n,e)=>{if(n.startsWith("//")&&(n=`${(e==null?void 0:e.protocol)??Tk}${n}`),n.startsWith("/")&&e!=null){const r=e.protocol??Tk,i=e.host,s=e.port!=null&&(i==null?void 0:i.endsWith(`:${e.port}`))!==!0?`:${e.port}`:"";n=`${r}//${i}${s}${n}`}const t=new URL(n);for(const[r,i]of Object.entries(see))t.protocol===r&&(t.protocol=i);return t};function aee(n,e){const t=typeof window>"u"?void 0:window.location;e=e??{};const r=oee(n,t),i=new iee(r.toString(),e.websocket);return nee(i,e)}class Jn extends Event{constructor(t,r){super(t);v(this,"type");v(this,"detail");this.type=t,this.detail=r}}function e$(n){return n.filter(e=>Tf.exactMatch(e)||If.exactMatch(e))}function lee(n){return n.filter(e=>Tf.exactMatch(e))}function cee(){throw new Error("WebSocket Servers can not be created in the browser!")}const uee=500;function hee(n,e,t){const r=t.logger.forComponent("libp2p:websockets:maconn"),i=t.metrics,s=t.metricPrefix??"",o={log:r,async sink(a){try{await n.sink(async function*(){for await(const l of a)l instanceof Uint8Array?yield l:yield l.subarray()}())}catch(l){l.type!=="aborted"&&r.error(l)}},source:n.source,remoteAddr:e,timeline:{open:Date.now()},async close(a={}){var h,d;const l=Date.now();if(a.signal==null){const p=AbortSignal.timeout(uee);a={...a,signal:p}}const c=()=>{const{host:p,port:g}=o.remoteAddr.toOptions();r("timeout closing stream to %s:%s after %dms, destroying it manually",p,g,Date.now()-l),this.abort(new yu("Socket close timeout"))};(h=a.signal)==null||h.addEventListener("abort",c);try{await n.close()}catch(p){r.error("error closing WebSocket gracefully",p),this.abort(p)}finally{(d=a.signal)==null||d.removeEventListener("abort",c),o.timeline.close=Date.now()}},abort(a){const{host:l,port:c}=o.remoteAddr.toOptions();r("timeout closing stream to %s:%s due to error",l,c,a),n.destroy(),o.timeline.close=Date.now(),i==null||i.increment({[`${s}error`]:!0})}};return n.socket.addEventListener("close",()=>{i==null||i.increment({[`${s}close`]:!0}),o.timeline.close==null&&(o.timeline.close=Date.now())},{once:!0}),o}var VR,GR,YR;YR=Tz,GR=Symbol.toStringTag,VR=bo;class fee{constructor(e,t={}){v(this,"log");v(this,"init");v(this,"logger");v(this,"metrics");v(this,"components");v(this,YR,!0);v(this,GR,"@libp2p/websockets");v(this,VR,["@libp2p/transport"]);this.log=e.logger.forComponent("libp2p:websockets"),this.logger=e.logger,this.components=e,this.init=t,e.metrics!=null&&(this.metrics={dialerEvents:e.metrics.registerCounterGroup("libp2p_websockets_dialer_events_total",{label:"event",help:"Total count of WebSockets dialer events by type"})})}async dial(e,t){var o;this.log("dialing %s",e),t=t??{};const r=await this._connect(e,t),i=hee(r,e,{logger:this.logger,metrics:(o=this.metrics)==null?void 0:o.dialerEvents});this.log("new outbound connection %s",i.remoteAddr);const s=await t.upgrader.upgradeOutbound(i,t);return this.log("outbound connection %s upgraded",i.remoteAddr),s}async _connect(e,t){var o,a,l,c,h;(o=t==null?void 0:t.signal)==null||o.throwIfAborted();const r=e.toOptions();this.log("dialing %s:%s",r.host,r.port);const i=qr(),s=aee(XJ(e),this.init);s.socket.addEventListener("error",()=>{var p;const d=new PL(`Could not connect to ${e.toString()}`);this.log.error("connection error:",d),(p=this.metrics)==null||p.dialerEvents.increment({error:!0}),i.reject(d)});try{(a=t.onProgress)==null||a.call(t,new Jn("websockets:open-connection")),await Un(Promise.race([s.connected(),i.promise]),t.signal)}catch(d){throw(l=t.signal)!=null&&l.aborted&&((c=this.metrics)==null||c.dialerEvents.increment({abort:!0})),s.close().catch(p=>{this.log.error("error closing raw socket",p)}),d}return this.log("connected %s",e),(h=this.metrics)==null||h.dialerEvents.increment({connect:!0}),s}createListener(e){return cee({logger:this.logger,events:this.components.events,metrics:this.components.metrics},{...this.init,...e})}listenFilter(e){var t,r;return e=Array.isArray(e)?e:[e],((t=this.init)==null?void 0:t.filter)!=null?(r=this.init)==null?void 0:r.filter(e):e$(e)}dialFilter(e){return this.listenFilter(e)}}function dee(n={}){return e=>new fee(e,n)}function Qm(n){if(typeof n!="object"||n===null)return!1;const e=Object.getPrototypeOf(n);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)}const{hasOwnProperty:t$}=Object.prototype,{propertyIsEnumerable:pee}=Object,Pu=(n,e,t)=>{Object.defineProperty(n,e,{value:t,writable:!0,enumerable:!0,configurable:!0})},gee=void 0,Ck={concatArrays:!1,ignoreUndefined:!1},ab=n=>{const e=[];for(const t in n)t$.call(n,t)&&e.push(t);if(Object.getOwnPropertySymbols){const t=Object.getOwnPropertySymbols(n);for(const r of t)pee.call(n,r)&&e.push(r)}return e};function Vu(n){return Array.isArray(n)?mee(n):Qm(n)?yee(n):n}function mee(n){const e=n.slice(0,0);return ab(n).forEach(t=>{Pu(e,t,Vu(n[t]))}),e}function yee(n){const e=Object.getPrototypeOf(n)===null?Object.create(null):{};return ab(n).forEach(t=>{Pu(e,t,Vu(n[t]))}),e}const r$=(n,e,t,r)=>(t.forEach(i=>{typeof e[i]>"u"&&r.ignoreUndefined||(i in n&&n[i]!==Object.getPrototypeOf(n)?Pu(n,i,G1(n[i],e[i],r)):Pu(n,i,Vu(e[i])))}),n),bee=(n,e,t)=>{let r=n.slice(0,0),i=0;return[n,e].forEach(s=>{const o=[];for(let a=0;a<s.length;a++)t$.call(s,a)&&(o.push(String(a)),s===n?Pu(r,i++,s[a]):Pu(r,i++,Vu(s[a])));r=r$(r,s,ab(s).filter(a=>!o.includes(a)),t)}),r};function G1(n,e,t){return t.concatArrays&&Array.isArray(n)&&Array.isArray(e)?bee(n,e,t):!Qm(e)||!Qm(n)?Vu(e):r$(n,e,ab(e),t)}function n$(...n){const e=G1(Vu(Ck),this!==gee&&this||{},Ck);let t={_:{}};for(const r of n)if(r!==void 0){if(!Qm(r))throw new TypeError("`"+r+"` is not an Option Object");t=G1(t,{_:r},e)}return t._}var i$={exports:{}};(function(n){var e=Object.prototype.hasOwnProperty,t="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(t=!1));function i(l,c,h){this.fn=l,this.context=c,this.once=h||!1}function s(l,c,h,d,p){if(typeof h!="function")throw new TypeError("The listener must be a function");var g=new i(h,d||l,p),m=t?t+c:c;return l._events[m]?l._events[m].fn?l._events[m]=[l._events[m],g]:l._events[m].push(g):(l._events[m]=g,l._eventsCount++),l}function o(l,c){--l._eventsCount===0?l._events=new r:delete l._events[c]}function a(){this._events=new r,this._eventsCount=0}a.prototype.eventNames=function(){var c=[],h,d;if(this._eventsCount===0)return c;for(d in h=this._events)e.call(h,d)&&c.push(t?d.slice(1):d);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(h)):c},a.prototype.listeners=function(c){var h=t?t+c:c,d=this._events[h];if(!d)return[];if(d.fn)return[d.fn];for(var p=0,g=d.length,m=new Array(g);p<g;p++)m[p]=d[p].fn;return m},a.prototype.listenerCount=function(c){var h=t?t+c:c,d=this._events[h];return d?d.fn?1:d.length:0},a.prototype.emit=function(c,h,d,p,g,m){var E=t?t+c:c;if(!this._events[E])return!1;var y=this._events[E],S=arguments.length,b,_;if(y.fn){switch(y.once&&this.removeListener(c,y.fn,void 0,!0),S){case 1:return y.fn.call(y.context),!0;case 2:return y.fn.call(y.context,h),!0;case 3:return y.fn.call(y.context,h,d),!0;case 4:return y.fn.call(y.context,h,d,p),!0;case 5:return y.fn.call(y.context,h,d,p,g),!0;case 6:return y.fn.call(y.context,h,d,p,g,m),!0}for(_=1,b=new Array(S-1);_<S;_++)b[_-1]=arguments[_];y.fn.apply(y.context,b)}else{var I=y.length,x;for(_=0;_<I;_++)switch(y[_].once&&this.removeListener(c,y[_].fn,void 0,!0),S){case 1:y[_].fn.call(y[_].context);break;case 2:y[_].fn.call(y[_].context,h);break;case 3:y[_].fn.call(y[_].context,h,d);break;case 4:y[_].fn.call(y[_].context,h,d,p);break;default:if(!b)for(x=1,b=new Array(S-1);x<S;x++)b[x-1]=arguments[x];y[_].fn.apply(y[_].context,b)}}return!0},a.prototype.on=function(c,h,d){return s(this,c,h,d,!1)},a.prototype.once=function(c,h,d){return s(this,c,h,d,!0)},a.prototype.removeListener=function(c,h,d,p){var g=t?t+c:c;if(!this._events[g])return this;if(!h)return o(this,g),this;var m=this._events[g];if(m.fn)m.fn===h&&(!p||m.once)&&(!d||m.context===d)&&o(this,g);else{for(var E=0,y=[],S=m.length;E<S;E++)(m[E].fn!==h||p&&!m[E].once||d&&m[E].context!==d)&&y.push(m[E]);y.length?this._events[g]=y.length===1?y[0]:y:o(this,g)}return this},a.prototype.removeAllListeners=function(c){var h;return c?(h=t?t+c:c,this._events[h]&&o(this,h)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=t,a.EventEmitter=a,n.exports=a})(i$);var wee=i$.exports;const vee=Yl(wee);class sA extends Error{constructor(t,r){var i;super(t,r);v(this,"name","TimeoutError");(i=Error.captureStackTrace)==null||i.call(Error,this,sA)}}const kk=n=>n.reason??new DOMException("This operation was aborted.","AbortError");function _ee(n,e){const{milliseconds:t,fallback:r,message:i,customTimers:s={setTimeout,clearTimeout},signal:o}=e;let a,l;const h=new Promise((d,p)=>{if(typeof t!="number"||Math.sign(t)!==1)throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${t}\``);if(o!=null&&o.aborted){p(kk(o));return}if(o&&(l=()=>{p(kk(o))},o.addEventListener("abort",l,{once:!0})),n.then(d,p),t===Number.POSITIVE_INFINITY)return;const g=new sA;a=s.setTimeout.call(void 0,()=>{if(r){try{d(r())}catch(m){p(m)}return}typeof n.cancel=="function"&&n.cancel(),i===!1?d():i instanceof Error?p(i):(g.message=i??`Promise timed out after ${t} milliseconds`,p(g))},t)}).finally(()=>{h.clear(),l&&o&&o.removeEventListener("abort",l)});return h.clear=()=>{s.clearTimeout.call(void 0,a),a=void 0},h}function Eee(n,e,t){let r=0,i=n.length;for(;i>0;){const s=Math.trunc(i/2);let o=r+s;t(n[o],e)<=0?(r=++o,i-=s+1):i=s}return r}var Mi,XR;let See=(XR=class{constructor(){Qe(this,Mi,[])}enqueue(e,t){const{priority:r=0,id:i}=t??{},s={priority:r,id:i,run:e};if(this.size===0||q(this,Mi)[this.size-1].priority>=r){q(this,Mi).push(s);return}const o=Eee(q(this,Mi),s,(a,l)=>l.priority-a.priority);q(this,Mi).splice(o,0,s)}setPriority(e,t){const r=q(this,Mi).findIndex(s=>s.id===e);if(r===-1)throw new ReferenceError(`No promise function with the id "${e}" exists in the queue.`);const[i]=q(this,Mi).splice(r,1);this.enqueue(i.run,{priority:t,id:e})}dequeue(){const e=q(this,Mi).shift();return e==null?void 0:e.run}filter(e){return q(this,Mi).filter(t=>t.priority===e.priority).map(t=>t.run)}get size(){return q(this,Mi).length}},Mi=new WeakMap,XR);var ou,ns,ys,au,lu,cu,ca,Bf,uu,bs,io,Br,Uf,In,wl,so,my,vl,ot,s$,o$,a$,l$,c$,Y1,X1,u$,Cg,Z1,Q1,kg,h$,Va,f$,Lh,J1;class Aee extends vee{constructor(t){var r,i;super();Qe(this,ot);Qe(this,ou);Qe(this,ns);Qe(this,ys,0);Qe(this,au);Qe(this,lu,!1);Qe(this,cu,!1);Qe(this,ca);Qe(this,Bf,0);Qe(this,uu,0);Qe(this,bs);Qe(this,io);Qe(this,Br);Qe(this,Uf);Qe(this,In,0);Qe(this,wl);Qe(this,so);Qe(this,my,1n);Qe(this,vl,new Map);v(this,"timeout");if(t={carryoverIntervalCount:!1,intervalCap:Number.POSITIVE_INFINITY,interval:0,concurrency:Number.POSITIVE_INFINITY,autoStart:!0,queueClass:See,...t},!(typeof t.intervalCap=="number"&&t.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${((r=t.intervalCap)==null?void 0:r.toString())??""}\` (${typeof t.intervalCap})`);if(t.interval===void 0||!(Number.isFinite(t.interval)&&t.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${((i=t.interval)==null?void 0:i.toString())??""}\` (${typeof t.interval})`);if(qe(this,ou,t.carryoverIntervalCount??t.carryoverConcurrencyCount??!1),qe(this,ns,t.intervalCap===Number.POSITIVE_INFINITY||t.interval===0),qe(this,au,t.intervalCap),qe(this,ca,t.interval),qe(this,Br,new t.queueClass),qe(this,Uf,t.queueClass),this.concurrency=t.concurrency,t.timeout!==void 0&&!(Number.isFinite(t.timeout)&&t.timeout>0))throw new TypeError(`Expected \`timeout\` to be a positive finite number, got \`${t.timeout}\` (${typeof t.timeout})`);this.timeout=t.timeout,qe(this,so,t.autoStart===!1),Pe(this,ot,f$).call(this)}get concurrency(){return q(this,wl)}set concurrency(t){if(!(typeof t=="number"&&t>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${t}\` (${typeof t})`);qe(this,wl,t),Pe(this,ot,kg).call(this)}setPriority(t,r){if(typeof r!="number"||!Number.isFinite(r))throw new TypeError(`Expected \`priority\` to be a finite number, got \`${r}\` (${typeof r})`);q(this,Br).setPriority(t,r)}async add(t,r={}){return r.id??(r.id=(Gi(this,my)._++).toString()),r={timeout:this.timeout,...r},new Promise((i,s)=>{const o=Symbol(`task-${r.id}`);q(this,Br).enqueue(async()=>{var a;Gi(this,In)._++,q(this,vl).set(o,{id:r.id,priority:r.priority??0,startTime:Date.now(),timeout:r.timeout});try{try{(a=r.signal)==null||a.throwIfAborted()}catch(h){throw q(this,ns)||Gi(this,ys)._--,q(this,vl).delete(o),h}let l=t({signal:r.signal});r.timeout&&(l=_ee(Promise.resolve(l),{milliseconds:r.timeout,message:`Task timed out after ${r.timeout}ms (queue has ${q(this,In)} running, ${q(this,Br).size} waiting)`})),r.signal&&(l=Promise.race([l,Pe(this,ot,h$).call(this,r.signal)]));const c=await l;i(c),this.emit("completed",c)}catch(l){s(l),this.emit("error",l)}finally{q(this,vl).delete(o),queueMicrotask(()=>{Pe(this,ot,a$).call(this)})}},r),this.emit("add"),Pe(this,ot,Cg).call(this)})}async addAll(t,r){return Promise.all(t.map(async i=>this.add(i,r)))}start(){return q(this,so)?(qe(this,so,!1),Pe(this,ot,kg).call(this),this):this}pause(){qe(this,so,!0)}clear(){qe(this,Br,new(q(this,Uf))),Pe(this,ot,J1).call(this)}async onEmpty(){q(this,Br).size!==0&&await Pe(this,ot,Va).call(this,"empty")}async onSizeLessThan(t){q(this,Br).size<t||await Pe(this,ot,Va).call(this,"next",()=>q(this,Br).size<t)}async onIdle(){q(this,In)===0&&q(this,Br).size===0||await Pe(this,ot,Va).call(this,"idle")}async onPendingZero(){q(this,In)!==0&&await Pe(this,ot,Va).call(this,"pendingZero")}async onRateLimit(){this.isRateLimited||await Pe(this,ot,Va).call(this,"rateLimit")}async onRateLimitCleared(){this.isRateLimited&&await Pe(this,ot,Va).call(this,"rateLimitCleared")}async onError(){return new Promise((t,r)=>{const i=s=>{this.off("error",i),r(s)};this.on("error",i)})}get size(){return q(this,Br).size}sizeBy(t){return q(this,Br).filter(t).length}get pending(){return q(this,In)}get isPaused(){return q(this,so)}get isRateLimited(){return q(this,lu)}get isSaturated(){return q(this,In)===q(this,wl)&&q(this,Br).size>0||this.isRateLimited&&q(this,Br).size>0}get runningTasks(){return[...q(this,vl).values()].map(t=>({...t}))}}ou=new WeakMap,ns=new WeakMap,ys=new WeakMap,au=new WeakMap,lu=new WeakMap,cu=new WeakMap,ca=new WeakMap,Bf=new WeakMap,uu=new WeakMap,bs=new WeakMap,io=new WeakMap,Br=new WeakMap,Uf=new WeakMap,In=new WeakMap,wl=new WeakMap,so=new WeakMap,my=new WeakMap,vl=new WeakMap,ot=new WeakSet,s$=function(){return q(this,ns)||q(this,ys)<q(this,au)},o$=function(){return q(this,In)<q(this,wl)},a$=function(){Gi(this,In)._--,q(this,In)===0&&this.emit("pendingZero"),Pe(this,ot,Cg).call(this),this.emit("next")},l$=function(){Pe(this,ot,Q1).call(this),Pe(this,ot,Z1).call(this),qe(this,io,void 0)},c$=function(){const t=Date.now();if(q(this,bs)===void 0){const r=q(this,Bf)-t;if(r<0){if(q(this,uu)>0){const i=t-q(this,uu);if(i<q(this,ca))return Pe(this,ot,Y1).call(this,q(this,ca)-i),!0}qe(this,ys,q(this,ou)?q(this,In):0)}else return Pe(this,ot,Y1).call(this,r),!0}return!1},Y1=function(t){q(this,io)===void 0&&qe(this,io,setTimeout(()=>{Pe(this,ot,l$).call(this)},t))},X1=function(){q(this,bs)&&(clearInterval(q(this,bs)),qe(this,bs,void 0))},u$=function(){q(this,io)&&(clearTimeout(q(this,io)),qe(this,io,void 0))},Cg=function(){if(q(this,Br).size===0)return Pe(this,ot,X1).call(this),this.emit("empty"),q(this,In)===0&&(Pe(this,ot,u$).call(this),this.emit("idle")),!1;let t=!1;if(!q(this,so)){const r=!q(this,ot,c$);if(q(this,ot,s$)&&q(this,ot,o$)){const i=q(this,Br).dequeue();q(this,ns)||(Gi(this,ys)._++,Pe(this,ot,Lh).call(this)),this.emit("active"),qe(this,uu,Date.now()),i(),r&&Pe(this,ot,Z1).call(this),t=!0}}return t},Z1=function(){q(this,ns)||q(this,bs)!==void 0||(qe(this,bs,setInterval(()=>{Pe(this,ot,Q1).call(this)},q(this,ca))),qe(this,Bf,Date.now()+q(this,ca)))},Q1=function(){q(this,ys)===0&&q(this,In)===0&&q(this,bs)&&Pe(this,ot,X1).call(this),qe(this,ys,q(this,ou)?q(this,In):0),Pe(this,ot,kg).call(this),Pe(this,ot,Lh).call(this)},kg=function(){for(;Pe(this,ot,Cg).call(this););},h$=async function(t){return new Promise((r,i)=>{t.addEventListener("abort",()=>{i(t.reason)},{once:!0})})},Va=async function(t,r){return new Promise(i=>{const s=()=>{r&&!r()||(this.off(t,s),i())};this.on(t,s)})},f$=function(){q(this,ns)||(this.on("add",()=>{q(this,Br).size>0&&Pe(this,ot,Lh).call(this)}),this.on("next",()=>{Pe(this,ot,Lh).call(this)}))},Lh=function(){q(this,ns)||q(this,cu)||(qe(this,cu,!0),queueMicrotask(()=>{qe(this,cu,!1),Pe(this,ot,J1).call(this)}))},J1=function(){const t=q(this,lu),r=!q(this,ns)&&q(this,ys)>=q(this,au)&&q(this,Br).size>0;r!==t&&(qe(this,lu,r),this.emit(r?"rateLimit":"rateLimitCleared"))};function d$(n){const e=[Sa.A];return n==null?e:Array.isArray(n)?n.length===0?e:n:[n]}const p$=60;function g$(n){return{Status:n.Status??0,TC:n.TC??n.flag_tc??!1,RD:n.RD??n.flag_rd??!1,RA:n.RA??n.flag_ra??!1,AD:n.AD??n.flag_ad??!1,CD:n.CD??n.flag_cd??!1,Question:(n.Question??n.questions??[]).map(e=>({name:e.name,type:Sa[e.type]})),Answer:(n.Answer??n.answers??[]).map(e=>({name:e.name,type:Sa[e.type],TTL:e.TTL??e.ttl??p$,data:e.data instanceof Uint8Array?mt(e.data):e.data}))}}const xee=4;function Pk(n,e={}){const t=new Aee({concurrency:e.queryConcurrency??xee});return async(r,i={})=>{var a;const s=new URLSearchParams;s.set("name",r),d$(i.types).forEach(l=>{s.append("type",Sa[l])}),(a=i.onProgress)==null||a.call(i,new Jn("dns:query",r));const o=await t.add(async()=>{var h;const l=await fetch(`${n}?${s}`,{headers:{accept:"application/dns-json"},signal:i==null?void 0:i.signal});if(l.status!==200)throw new Error(`Unexpected HTTP status: ${l.status} - ${l.statusText}`);const c=g$(await l.json());return(h=i.onProgress)==null||h.call(i,new Jn("dns:response",c)),c},{signal:i.signal});if(o==null)throw new Error("No DNS response received");return o}}function Iee(){return[Pk("https://cloudflare-dns.com/dns-query"),Pk("https://dns.google/resolve")]}var Tee=function(n){if(!n)throw Error("hashlru must have a max value, of type number, greater than 0");var e=0,t=Object.create(null),r=Object.create(null);function i(s,o){t[s]=o,e++,e>=n&&(e=0,r=t,t=Object.create(null))}return{has:function(s){return t[s]!==void 0||r[s]!==void 0},remove:function(s){t[s]!==void 0&&(t[s]=void 0),r[s]!==void 0&&(r[s]=void 0)},get:function(s){var o=t[s];if(o!==void 0)return o;if((o=r[s])!==void 0)return i(s,o),o},set:function(s,o){t[s]!==void 0?t[s]=o:i(s,o)},clear:function(){t=Object.create(null),r=Object.create(null)}}};const Cee=Yl(Tee);class kee{constructor(e){v(this,"lru");this.lru=Cee(e)}get(e,t){let r=!0;const i=[];for(const s of t){const o=this.getAnswers(e,s);if(o.length===0){r=!1;break}i.push(...o)}if(r)return g$({answers:i})}getAnswers(e,t){const r=`${e.toLowerCase()}-${t}`,i=this.lru.get(r);if(i!=null){const s=i.filter(o=>o.expires>Date.now()).map(({expires:o,value:a})=>({...a,TTL:Math.round((o-Date.now())/1e3),type:Sa[a.type]}));return s.length===0&&this.lru.remove(r),s}return[]}add(e,t){const r=`${e.toLowerCase()}-${t.type}`,i=this.lru.get(r)??[];i.push({expires:Date.now()+(t.TTL??p$)*1e3,value:t}),this.lru.set(r,i)}remove(e,t){const r=`${e.toLowerCase()}-${t}`;this.lru.remove(r)}clear(){this.lru.clear()}}function Pee(n){return new kee(n)}const Ree=1e3;class Oee{constructor(e){v(this,"resolvers");v(this,"cache");this.resolvers={},this.cache=Pee(e.cacheSize??Ree),Object.entries(e.resolvers??{}).forEach(([t,r])=>{Array.isArray(r)||(r=[r]),t.endsWith(".")||(t=`${t}.`),this.resolvers[t]=r}),this.resolvers["."]==null&&(this.resolvers["."]=Iee())}async query(e,t={}){var l,c,h;const r=d$(t.types),i=t.cached!==!1?this.cache.get(e,r):void 0;if(i!=null)return(l=t.onProgress)==null||l.call(t,new Jn("dns:cache",i)),i;const s=`${e.split(".").pop()}.`,o=(this.resolvers[s]??this.resolvers["."]).sort(()=>Math.random()>.5?-1:1),a=[];for(const d of o){if(((c=t.signal)==null?void 0:c.aborted)===!0)break;try{const p=await d(e,{...t,types:r});for(const g of p.Answer)this.cache.add(e,g);return p}catch(p){a.push(p),(h=t.onProgress)==null||h.call(t,new Jn("dns:error",p))}}throw a.length===1?a[0]:new AggregateError(a,`DNS lookup of ${e} ${r} failed`)}}var Sa;(function(n){n[n.A=1]="A",n[n.CNAME=5]="CNAME",n[n.TXT=16]="TXT",n[n.AAAA=28]="AAAA"})(Sa||(Sa={}));function Lee(n={}){return new Oee(n)}const pi=-1,eE={},Nee={},Dee=[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,pi,"ip6zone"],[43,8,"ipcidr"],[53,pi,"dns",!0],[54,pi,"dns4",!0],[55,pi,"dns6",!0],[56,pi,"dnsaddr",!0],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[280,0,"webrtc-direct"],[281,0,"webrtc"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,pi,"unix",!1,!0],[421,pi,"ipfs"],[421,pi,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,pi,"garlic64"],[448,0,"tls"],[449,pi,"sni"],[460,0,"quic"],[461,0,"quic-v1"],[465,0,"webtransport"],[466,pi,"certhash"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[481,pi,"http-path"],[777,pi,"memory"]];Dee.forEach(n=>{const e=$ee(...n);Nee[e.code]=e,eE[e.name]=e});function $ee(n,e,t,r,i){return{code:n,size:e,name:t,resolvable:!!r,path:!!i}}function Mee(n){{if(eE[n]!=null)return eE[n];throw new Error(`no protocol with name: ${n}`)}}const Bee=32,{code:Uee}=Mee("dnsaddr");class Fee extends Error{constructor(e="Max recursive depth reached"){super(e),this.name="RecursionLimitError"}}const m$=async function(e,t={}){const r=t.maxRecursiveDepth??Bee;if(r===0)throw new Fee("Max recursive depth reached");const[,i]=e.stringTuples().find(([c])=>c===Uee)??[],o=await((t==null?void 0:t.dns)??Lee()).query(`_dnsaddr.${i}`,{signal:t==null?void 0:t.signal,types:[Sa.TXT]}),a=e.getPeerId(),l=[];for(const c of o.Answer){const h=c.data.replace(/["']/g,"").trim().split("=")[1];if(h==null||a!=null&&!h.includes(a))continue;const d=Nt(h);if(h.startsWith("/dnsaddr")){const p=await d.resolve({...t,maxRecursiveDepth:r-1});l.push(...p.map(g=>g.toString()))}else l.push(d.toString())}return l},jee={addresses:{listen:[],announce:[],noAnnounce:[],announceFilter:n=>n},connectionManager:{resolvers:{dnsaddr:m$}},transportManager:{faultTolerance:df.FATAL_ALL}};async function qee(n){var t,r;const e=n$(jee,n);if(e.connectionProtector===null&&((r=(t=globalThis.process)==null?void 0:t.env)==null?void 0:r.LIBP2P_FORCE_PNET)!=null)throw new rr("Private network is enforced, but no protector was provided");return e}const Ru=1e3,Ou=Ru*60,Lu=Ou*60,zl=Lu*24,Cf=zl*7,Nu=zl*365.25,kf=Nu/12;function Hee(n,e){if(typeof n=="string")return Wee(n);if(typeof n=="number")return Vee(n,e);throw Error(`Value provided to ms() must be a string or number. value=${JSON.stringify(n)}`)}var y$=Hee;function Wee(n){if(typeof n!="string"||n.length===0||n.length>100)throw Error(`Value provided to ms.parse() must be a string with length between 1 and 99. value=${JSON.stringify(n)}`);let e=/^(?<value>-?\d*\.?\d+) *(?<unit>milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|months?|mo|years?|yrs?|y)?$/i.exec(n);if(!(e!=null&&e.groups))return NaN;let{value:t,unit:r="ms"}=e.groups,i=parseFloat(t),s=r.toLowerCase();switch(s){case"years":case"year":case"yrs":case"yr":case"y":return i*Nu;case"months":case"month":case"mo":return i*kf;case"weeks":case"week":case"w":return i*Cf;case"days":case"day":case"d":return i*zl;case"hours":case"hour":case"hrs":case"hr":case"h":return i*Lu;case"minutes":case"minute":case"mins":case"min":case"m":return i*Ou;case"seconds":case"second":case"secs":case"sec":case"s":return i*Ru;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return i;default:throw Error(`Unknown unit "${s}" provided to ms.parse(). value=${JSON.stringify(n)}`)}}function zee(n){let e=Math.abs(n);return e>=Nu?`${Math.round(n/Nu)}y`:e>=kf?`${Math.round(n/kf)}mo`:e>=Cf?`${Math.round(n/Cf)}w`:e>=zl?`${Math.round(n/zl)}d`:e>=Lu?`${Math.round(n/Lu)}h`:e>=Ou?`${Math.round(n/Ou)}m`:e>=Ru?`${Math.round(n/Ru)}s`:`${n}ms`}function Kee(n){let e=Math.abs(n);return e>=Nu?Wa(n,e,Nu,"year"):e>=kf?Wa(n,e,kf,"month"):e>=Cf?Wa(n,e,Cf,"week"):e>=zl?Wa(n,e,zl,"day"):e>=Lu?Wa(n,e,Lu,"hour"):e>=Ou?Wa(n,e,Ou,"minute"):e>=Ru?Wa(n,e,Ru,"second"):`${n} ms`}function Vee(n,e){if(typeof n!="number"||!Number.isFinite(n))throw Error("Value provided to ms.format() must be of type number.");return e!=null&&e.long?Kee(n):zee(n)}function Wa(n,e,t,r){let i=e>=t*1.5;return`${Math.round(n/t)} ${r}${i?"s":""}`}function Gee(n){t.debug=t,t.default=t,t.coerce=l,t.disable=s,t.enable=i,t.enabled=o,t.humanize=y$,t.destroy=c,Object.keys(n).forEach(h=>{t[h]=n[h]}),t.names=[],t.skips=[],t.formatters={};function e(h){let d=0;for(let p=0;p<h.length;p++)d=(d<<5)-d+h.charCodeAt(p),d|=0;return t.colors[Math.abs(d)%t.colors.length]}t.selectColor=e;function t(h,d){let p,g=null,m,E;function y(...S){if(!y.enabled)return;const b=y,_=Number(new Date),I=_-(p||_);b.diff=I,b.prev=p,b.curr=_,p=_,S[0]=t.coerce(S[0]),typeof S[0]!="string"&&S.unshift("%O");let x=0;S[0]=S[0].replace(/%([a-zA-Z%])/g,(U,O)=>{if(U==="%%")return"%";x++;const P=t.formatters[O];if(typeof P=="function"){const M=S[x];U=P.call(b,M),S.splice(x,1),x--}return U}),t.formatArgs.call(b,S),(d==null?void 0:d.onLog)!=null&&d.onLog(...S),(b.log||t.log).apply(b,S)}return y.namespace=h,y.useColors=t.useColors(),y.color=t.selectColor(h),y.extend=r,y.destroy=t.destroy,Object.defineProperty(y,"enabled",{enumerable:!0,configurable:!1,get:()=>g!==null?g:(m!==t.namespaces&&(m=t.namespaces,E=t.enabled(h)),E),set:S=>{g=S}}),typeof t.init=="function"&&t.init(y),y}function r(h,d){const p=t(this.namespace+(typeof d>"u"?":":d)+h);return p.log=this.log,p}function i(h){t.save(h),t.namespaces=h,t.names=[],t.skips=[];let d;const p=(typeof h=="string"?h:"").split(/[\s,]+/),g=p.length;for(d=0;d<g;d++)p[d]&&(h=p[d].replace(/\*/g,".*?"),h[0]==="-"?t.skips.push(new RegExp("^"+h.substr(1)+"$")):t.names.push(new RegExp("^"+h+"$")))}function s(){const h=[...t.names.map(a),...t.skips.map(a).map(d=>"-"+d)].join(",");return t.enable(""),h}function o(h){if(h[h.length-1]==="*")return!0;let d,p;for(d=0,p=t.skips.length;d<p;d++)if(t.skips[d].test(h))return!1;for(d=0,p=t.names.length;d<p;d++)if(t.names[d].test(h))return!0;return!1}function a(h){return h.toString().substring(2,h.toString().length-2).replace(/\.\*\?$/,"*")}function l(h){return h instanceof Error?h.stack??h.message:h}function c(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.setupFormatters(t.formatters),t.enable(t.load()),t}var Yee={};const vs=rte(),Xee=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function Zee(){var n,e,t,r,i;return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&((n=navigator.userAgent)==null?void 0:n.toLowerCase().match(/(edge|trident)\/(\d+)/))!=null?!1:typeof document<"u"&&((t=(e=document.documentElement)==null?void 0:e.style)==null?void 0:t.WebkitAppearance)||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&((r=navigator.userAgent)==null?void 0:r.toLowerCase().match(/firefox\/(\d+)/))!=null&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&((i=navigator.userAgent)==null?void 0:i.toLowerCase().match(/applewebkit\/(\d+)/))}function Qee(n){if(n[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+n[0]+(this.useColors?"%c ":" ")+"+"+y$(this.diff),!this.useColors)return;const e="color: "+this.color;n.splice(1,0,e,"color: inherit");let t=0,r=0;n[0].replace(/%[a-zA-Z%]/g,i=>{i!=="%%"&&(t++,i==="%c"&&(r=t))}),n.splice(r,0,e)}const Jee=console.debug??console.log??(()=>{});function ete(n){try{n?vs==null||vs.setItem("debug",n):vs==null||vs.removeItem("debug")}catch{}}function tte(){let n;try{n=vs==null?void 0:vs.getItem("debug")}catch{}return!n&&typeof globalThis.process<"u"&&"env"in globalThis.process&&(n=Yee.DEBUG),n}function rte(){try{return localStorage}catch{}}function nte(n){n.j=function(e){try{return JSON.stringify(e)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}}}const Bn=Gee({formatArgs:Qee,save:ete,load:tte,useColors:Zee,setupFormatters:nte,colors:Xee,storage:vs,log:Jee});Bn.formatters.b=n=>n==null?"undefined":_r.baseEncode(n);Bn.formatters.t=n=>n==null?"undefined":ba.baseEncode(n);Bn.formatters.m=n=>n==null?"undefined":oL.baseEncode(n);Bn.formatters.p=n=>n==null?"undefined":n.toString();Bn.formatters.c=n=>n==null?"undefined":n.toString();Bn.formatters.k=n=>n==null?"undefined":n.toString();Bn.formatters.a=n=>n==null?"undefined":n.toString();Bn.formatters.e=n=>n==null?"undefined":Rk(n.stack)??Rk(n.message)??n.toString();function ite(n){const e=()=>{};return e.enabled=!1,e.color="",e.diff=0,e.log=()=>{},e.namespace=n,e.destroy=()=>!0,e.extend=()=>e,e}function b$(){return{forComponent(n){return w$(n)}}}function w$(n){let e=ite(`${n}:trace`);return Bn.enabled(`${n}:trace`)&&Bn.names.map(t=>t.toString()).find(t=>t.includes(":trace"))!=null&&(e=Bn(`${n}:trace`)),Object.assign(Bn(n),{error:Bn(`${n}:error`),trace:e,newScope:t=>w$(`${n}:${t}`)})}function Rk(n){if(n!=null&&(n=n.trim(),n.length!==0))return n}function Xh(n,e){const t={[Symbol.iterator]:()=>t,next:()=>{const r=n.next(),i=r.value;return r.done===!0||i==null?{done:!0,value:void 0}:{done:!1,value:e(i)}}};return t}function pw(n){const e=Ry(_r.decode(`z${n}`));return Wy(e)}class sd{constructor(e){v(this,"map");if(this.map=new Map,e!=null)for(const[t,r]of e.entries())this.map.set(t.toString(),{key:t,value:r})}[Symbol.iterator](){return this.entries()}clear(){this.map.clear()}delete(e){return this.map.delete(e.toString())}entries(){return Xh(this.map.entries(),e=>[e[1].key,e[1].value])}forEach(e){this.map.forEach((t,r)=>{e(t.value,t.key,this)})}get(e){var t;return(t=this.map.get(e.toString()))==null?void 0:t.value}has(e){return this.map.has(e.toString())}set(e,t){this.map.set(e.toString(),{key:e,value:t})}keys(){return Xh(this.map.values(),e=>e.key)}values(){return Xh(this.map.values(),e=>e.value)}get size(){return this.map.size}}class Zc{constructor(e){v(this,"set");if(this.set=new Set,e!=null)for(const t of e)this.set.add(t.toString())}get size(){return this.set.size}[Symbol.iterator](){return this.values()}add(e){this.set.add(e.toString())}clear(){this.set.clear()}delete(e){this.set.delete(e.toString())}entries(){return Xh(this.set.entries(),e=>{const t=pw(e[0]);return[t,t]})}forEach(e){this.set.forEach(t=>{const r=pw(t);e(r,r,this)})}has(e){return this.set.has(e.toString())}values(){return Xh(this.set.values(),e=>pw(e))}intersection(e){const t=new Zc;for(const r of e)this.has(r)&&t.add(r);return t}difference(e){const t=new Zc;for(const r of this)e.has(r)||t.add(r);return t}union(e){const t=new Zc;for(const r of e)t.add(r);for(const r of this)t.add(r);return t}}const oA={32:16777619n,64:1099511628211n,128:309485009821345068724781371n,256:374144419156711147060143317175368453031918731002211n,512:35835915874844867368919076489095108449946327955754392558399825615420669938882575126094039892345713852759n,1024:5016456510113118655434598811035278955030765345404790744303017523831112055108147451509157692220295382716162651878526895249385292291816524375083746691371804094271873160484737966720260389217684476157468082573n},v$={32:2166136261n,64:14695981039346656037n,128:144066263297769815596495629667062367629n,256:100029257958052580907070968620625704837092796014241193945225284501741471925557n,512:9659303129496669498009435400716310466090418745672637896108374329434462657994582932197716438449813051892206539805784495328239340083876191928701583869517785n,1024:14197795064947621068722070641403218320880622795441933960878474914617582723252296732303717722150864096521202355549365628174669108571814760471015076148029755969804077320157692458563003215304957150157403644460363550505412711285966361610267868082893823963790439336411086884584107735010676915n},_$=new globalThis.TextEncoder;function ste(n,e){const t=oA[e];let r=v$[e];for(let i=0;i<n.length;i++)r^=BigInt(n[i]),r=BigInt.asUintN(e,r*t);return r}function ote(n,e,t){if(t.length===0)throw new Error("The `utf8Buffer` option must have a length greater than zero");const r=oA[e];let i=v$[e],s=n;for(;s.length>0;){const o=_$.encodeInto(s,t);s=s.slice(o.read);for(let a=0;a<o.written;a++)i^=BigInt(t[a]),i=BigInt.asUintN(e,i*r)}return i}function ate(n,{size:e=32,utf8Buffer:t}={}){if(!oA[e])throw new Error("The `size` option must be one of 32, 64, 128, 256, 512, or 1024");if(typeof n=="string"){if(t)return ote(n,e,t);n=_$.encode(n)}return ste(n,e)}const aA={hash:n=>Number(ate(n,{size:32})),hashV:(n,e)=>lte(aA.hash(n,e))};function lte(n){let e=n.toString(16);return e.length%2===1&&(e=`0${e}`),at(e,"base16")}const E$=64;class pl{constructor(e,t,r,i=2){v(this,"fp");v(this,"h");v(this,"seed");if(i>E$)throw new TypeError("Invalid Fingerprint Size");const s=t.hashV(e,r),o=Je(i);for(let a=0;a<o.length;a++)o[a]=s[a];o.length===0&&(o[0]=7),this.fp=o,this.h=t,this.seed=r}hash(){return this.h.hash(this.fp,this.seed)}equals(e){return(e==null?void 0:e.fp)instanceof Uint8Array?Or(this.fp,e.fp):!1}}function Jm(n,e){return Math.floor(Math.random()*(e-n))+n}class _p{constructor(e){v(this,"contents");this.contents=new Array(e).fill(null)}has(e){if(!(e instanceof pl))throw new TypeError("Invalid Fingerprint");return this.contents.some(t=>e.equals(t))}add(e){if(!(e instanceof pl))throw new TypeError("Invalid Fingerprint");for(let t=0;t<this.contents.length;t++)if(this.contents[t]==null)return this.contents[t]=e,!0;return!0}swap(e){if(!(e instanceof pl))throw new TypeError("Invalid Fingerprint");const t=Jm(0,this.contents.length-1),r=this.contents[t];return this.contents[t]=e,r}remove(e){if(!(e instanceof pl))throw new TypeError("Invalid Fingerprint");const t=this.contents.findIndex(r=>e.equals(r));return t>-1?(this.contents[t]=null,!0):!1}}const cte=500;class Ok{constructor(e){v(this,"bucketSize");v(this,"filterSize");v(this,"fingerprintSize");v(this,"buckets");v(this,"count");v(this,"hash");v(this,"seed");this.filterSize=e.filterSize,this.bucketSize=e.bucketSize??4,this.fingerprintSize=e.fingerprintSize??2,this.count=0,this.buckets=[],this.hash=e.hash??aA,this.seed=e.seed??Jm(0,Math.pow(2,10))}add(e){typeof e=="string"&&(e=at(e));const t=new pl(e,this.hash,this.seed,this.fingerprintSize),r=this.hash.hash(e,this.seed)%this.filterSize,i=(r^t.hash())%this.filterSize;if(this.buckets[r]==null&&(this.buckets[r]=new _p(this.bucketSize)),this.buckets[i]==null&&(this.buckets[i]=new _p(this.bucketSize)),this.buckets[r].add(t)||this.buckets[i].add(t))return this.count++,!0;const s=[r,i];let o=s[Jm(0,s.length-1)];this.buckets[o]==null&&(this.buckets[o]=new _p(this.bucketSize));for(let a=0;a<cte;a++){const l=this.buckets[o].swap(t);if(l!=null&&(o=(o^l.hash())%this.filterSize,this.buckets[o]==null&&(this.buckets[o]=new _p(this.bucketSize)),this.buckets[o].add(l)))return this.count++,!0}return!1}has(e){var o,a;typeof e=="string"&&(e=at(e));const t=new pl(e,this.hash,this.seed,this.fingerprintSize),r=this.hash.hash(e,this.seed)%this.filterSize,i=((o=this.buckets[r])==null?void 0:o.has(t))??!1;if(i)return i;const s=(r^t.hash())%this.filterSize;return((a=this.buckets[s])==null?void 0:a.has(t))??!1}remove(e){var a,l;typeof e=="string"&&(e=at(e));const t=new pl(e,this.hash,this.seed,this.fingerprintSize),r=this.hash.hash(e,this.seed)%this.filterSize,i=((a=this.buckets[r])==null?void 0:a.remove(t))??!1;if(i)return this.count--,i;const s=(r^t.hash())%this.filterSize,o=((l=this.buckets[s])==null?void 0:l.remove(t))??!1;return o&&this.count--,o}get reliable(){return Math.floor(100*(this.count/this.filterSize))<=90}}const ute={1:.5,2:.84,4:.95,8:.98};function hte(n=.001){return n>.002?2:n>1e-5?4:8}function fte(n,e=.001){const t=hte(e),r=ute[t],i=Math.round(n/r),s=Math.min(Math.ceil(Math.log2(1/e)+Math.log2(2*t)),E$);return{filterSize:i,bucketSize:t,fingerprintSize:s}}class dte{constructor(e){v(this,"filterSize");v(this,"bucketSize");v(this,"fingerprintSize");v(this,"scale");v(this,"filterSeries");v(this,"hash");v(this,"seed");this.bucketSize=e.bucketSize??4,this.filterSize=e.filterSize??(1<<18)/this.bucketSize,this.fingerprintSize=e.fingerprintSize??2,this.scale=e.scale??2,this.hash=e.hash??aA,this.seed=e.seed??Jm(0,Math.pow(2,10)),this.filterSeries=[new Ok({filterSize:this.filterSize,bucketSize:this.bucketSize,fingerprintSize:this.fingerprintSize,hash:this.hash,seed:this.seed})]}add(e){if(typeof e=="string"&&(e=at(e)),this.has(e))return!0;let t=this.filterSeries.find(r=>r.reliable);if(t==null){const r=this.filterSize*Math.pow(this.scale,this.filterSeries.length);t=new Ok({filterSize:r,bucketSize:this.bucketSize,fingerprintSize:this.fingerprintSize,hash:this.hash,seed:this.seed}),this.filterSeries.push(t)}return t.add(e)}has(e){typeof e=="string"&&(e=at(e));for(let t=0;t<this.filterSeries.length;t++)if(this.filterSeries[t].has(e))return!0;return!1}remove(e){typeof e=="string"&&(e=at(e));for(let t=0;t<this.filterSeries.length;t++)if(this.filterSeries[t].remove(e))return!0;return!1}get count(){return this.filterSeries.reduce((e,t)=>e+t.count,0)}}function S$(n,e=.001,t){return new dte({...fte(n,e)})}class pte extends sd{constructor(t){super();v(this,"metric");const{name:r,metrics:i}=t;this.metric=i.registerMetric(r),this.updateComponentMetric()}set(t,r){return super.set(t,r),this.updateComponentMetric(),this}delete(t){const r=super.delete(t);return this.updateComponentMetric(),r}clear(){super.clear(),this.updateComponentMetric()}updateComponentMetric(){this.metric.update(this.size)}}function gte(n){const{name:e,metrics:t}=n;let r;return t!=null?r=new pte({name:e,metrics:t}):r=new sd,r}var hv;let Du=(hv=class extends Error{constructor(t="The operation was aborted",...r){super(t,...r);v(this,"name","AbortError")}},v(hv,"name","AbortError"),hv);async function kl(n,e,t,r){const i=new Du(r==null?void 0:r.errorMessage);(r==null?void 0:r.errorCode)!=null&&(i.code=r.errorCode);const s=(r==null?void 0:r.errorEvent)??"error";return(t==null?void 0:t.aborted)===!0?Promise.reject(i):new Promise((o,a)=>{function l(){mw(t,"abort",d),mw(n,e,c),mw(n,s,h)}const c=p=>{var g;try{if(((g=r==null?void 0:r.filter)==null?void 0:g.call(r,p))===!1)return}catch(m){l(),a(m);return}l(),o(p)},h=p=>{if(l(),p instanceof Error){a(p);return}a(p.detail??(r==null?void 0:r.error)??new Error(`The "${r==null?void 0:r.errorEvent}" event was emitted but the event had no '.detail' field. Pass an 'error' option to race-event to change this message.`))},d=()=>{l(),a(i)};gw(t,"abort",d),gw(n,e,c),gw(n,s,h)})}function gw(n,e,t){n!=null&&(A$(n)?n.addEventListener(e,t):n.addListener(e,t))}function mw(n,e,t){n!=null&&(A$(n)?n.removeEventListener(e,t):n.removeListener(e,t))}function A$(n){return typeof n.addEventListener=="function"&&typeof n.removeEventListener=="function"}class x$ extends Error{constructor(e="The queue was full"){super(e),this.name="QueueFullError"}}v(x$,"name","QueueFullError");let mte=class{constructor(e){v(this,"deferred");v(this,"signal");var t;this.signal=e,this.deferred=Promise.withResolvers(),this.onAbort=this.onAbort.bind(this),(t=this.signal)==null||t.addEventListener("abort",this.onAbort)}onAbort(){var e;this.deferred.reject(((e=this.signal)==null?void 0:e.reason)??new Du)}cleanup(){var e;(e=this.signal)==null||e.removeEventListener("abort",this.onAbort)}};function yte(){return`${parseInt(String(Math.random()*1e9),10).toString()}${Date.now()}`}let bte=class{constructor(e,t){v(this,"id");v(this,"fn");v(this,"options");v(this,"recipients");v(this,"status");v(this,"timeline");v(this,"controller");this.id=yte(),this.status="queued",this.fn=e,this.options=t,this.recipients=[],this.timeline={created:Date.now()},this.controller=new AbortController,this.controller.signal,this.onAbort=this.onAbort.bind(this)}abort(e){this.controller.abort(e)}onAbort(){this.recipients.reduce((t,r)=>{var i;return t&&((i=r.signal)==null?void 0:i.aborted)===!0},!0)&&(this.controller.abort(new Du),this.cleanup())}async join(e={}){var r;const t=new mte(e.signal);return this.recipients.push(t),(r=e.signal)==null||r.addEventListener("abort",this.onAbort),t.deferred.promise}async run(){this.status="running",this.timeline.started=Date.now();try{this.controller.signal.throwIfAborted();const e=await Un(this.fn({...this.options??{},signal:this.controller.signal}),this.controller.signal);this.recipients.forEach(t=>{t.deferred.resolve(e)}),this.status="complete"}catch(e){this.recipients.forEach(t=>{t.deferred.reject(e)}),this.status="errored"}finally{this.timeline.finished=Date.now(),this.cleanup()}}cleanup(){this.recipients.forEach(e=>{var t;e.cleanup(),(t=e.signal)==null||t.removeEventListener("abort",this.onAbort)})}};function Lk(n,e){let t;const r=function(){const i=function(){t=void 0,n()};clearTimeout(t),t=setTimeout(i,e)};return r.start=()=>{},r.stop=()=>{clearTimeout(t)},r}let Nk=class extends Si{constructor(t={}){super();v(this,"concurrency");v(this,"maxSize");v(this,"queue");v(this,"pending");v(this,"sort");v(this,"autoStart");this.concurrency=t.concurrency??Number.POSITIVE_INFINITY,this.maxSize=t.maxSize??Number.POSITIVE_INFINITY,this.pending=0,this.autoStart=t.autoStart??!0,this.sort=t.sort,this.queue=[],this.emitEmpty=Lk(this.emitEmpty.bind(this),1),this.emitIdle=Lk(this.emitIdle.bind(this),1)}[Symbol.asyncIterator](){return this.toGenerator()}emitEmpty(){this.size===0&&this.safeDispatchEvent("empty")}emitIdle(){this.running===0&&this.safeDispatchEvent("idle")}tryToStartAnother(){if(this.size===0)return this.emitEmpty(),this.running===0&&this.emitIdle(),!1;if(this.pending<this.concurrency){let t;for(const r of this.queue)if(r.status==="queued"){t=r;break}return t==null?!1:(this.safeDispatchEvent("active"),this.pending++,t.run().finally(()=>{for(let r=0;r<this.queue.length;r++)if(this.queue[r]===t){this.queue.splice(r,1);break}this.pending--,this.safeDispatchEvent("next"),this.autoStart&&this.tryToStartAnother()}),!0)}return!1}enqueue(t){this.queue.push(t),this.sort!=null&&this.queue.sort(this.sort)}start(){this.autoStart===!1&&(this.autoStart=!0,this.tryToStartAnother())}pause(){this.autoStart=!1}async add(t,r){var s;if((s=r==null?void 0:r.signal)==null||s.throwIfAborted(),this.size===this.maxSize)throw new x$;const i=new bte(t,r);return this.enqueue(i),this.safeDispatchEvent("add"),this.autoStart&&this.tryToStartAnother(),i.join(r).then(o=>(this.safeDispatchEvent("success",{detail:{job:i,result:o}}),o)).catch(o=>{if(i.status==="queued"){for(let a=0;a<this.queue.length;a++)if(this.queue[a]===i){this.queue.splice(a,1);break}}throw this.safeDispatchEvent("failure",{detail:{job:i,error:o}}),o})}clear(){this.queue.splice(0,this.queue.length)}abort(){this.queue.forEach(t=>{t.abort(new Du)}),this.clear()}async onEmpty(t){this.size!==0&&await kl(this,"empty",t==null?void 0:t.signal)}async onSizeLessThan(t,r){this.size<t||await kl(this,"next",r==null?void 0:r.signal,{filter:()=>this.size<t})}async onIdle(t){this.pending===0&&this.size===0||await kl(this,"idle",t==null?void 0:t.signal)}get size(){return this.queue.length}get queued(){return this.queue.length-this.pending}get running(){return this.pending}async*toGenerator(t){var c,h,d;(c=t==null?void 0:t.signal)==null||c.throwIfAborted();const r=Gf({objectMode:!0}),i=p=>{p!=null?this.abort():this.clear(),r.end(p)},s=p=>{p.detail!=null&&r.push(p.detail.result)},o=p=>{i(p.detail.error)},a=()=>{i()},l=()=>{i(new Du("Queue aborted"))};this.addEventListener("success",s),this.addEventListener("failure",o),this.addEventListener("idle",a),(h=t==null?void 0:t.signal)==null||h.addEventListener("abort",l);try{yield*r}finally{this.removeEventListener("success",s),this.removeEventListener("failure",o),this.removeEventListener("idle",a),(d=t==null?void 0:t.signal)==null||d.removeEventListener("abort",l),i()}}};const I$="lock:worker:request-read",T$="lock:worker:abort-read-request",C$="lock:worker:release-read",k$="lock:master:grant-read",P$="lock:master:error-read",R$="lock:worker:request-write",O$="lock:worker:abort-write-request",L$="lock:worker:release-write",N$="lock:master:grant-write",D$="lock:master:error-write",$$="lock:worker:finalize",M$="mortice",wte={singleProcess:!1},Dk=(n,e,t,r,i,s,o,a,l)=>c=>{if(c.data==null)return;const h={type:c.data.type,name:c.data.name,identifier:c.data.identifier};h.type===i&&n.safeDispatchEvent(t,{detail:{name:h.name,identifier:h.identifier,handler:async()=>{e.postMessage({type:l,name:h.name,identifier:h.identifier}),await new Promise(d=>{const p=g=>{if((g==null?void 0:g.data)==null)return;const m={type:g.data.type,name:g.data.name,identifier:g.data.identifier};m.type===a&&m.identifier===h.identifier&&(e.removeEventListener("message",p),d())};e.addEventListener("message",p)})},onError:d=>{e.postMessage({type:o,name:h.name,identifier:h.identifier,error:{message:d.message,name:d.name,stack:d.stack}})}}}),h.type===s&&n.safeDispatchEvent(r,{detail:{name:h.name,identifier:h.identifier}}),h.type===$$&&n.safeDispatchEvent("finalizeRequest",{detail:{name:h.name}})},vte=(n=10)=>Math.random().toString().substring(2,n+2);class _te{constructor(e){v(this,"name");v(this,"channel");this.name=e,this.channel=new BroadcastChannel(M$)}readLock(e){return this.sendRequest(I$,T$,k$,P$,C$,e)}writeLock(e){return this.sendRequest(R$,O$,N$,D$,L$,e)}finalize(){this.channel.postMessage({type:$$,name:this.name}),this.channel.close()}async sendRequest(e,t,r,i,s,o){var l;(l=o==null?void 0:o.signal)==null||l.throwIfAborted();const a=vte();return this.channel.postMessage({type:e,identifier:a,name:this.name}),new Promise((c,h)=>{var g;const d=()=>{this.channel.postMessage({type:t,identifier:a,name:this.name})};(g=o==null?void 0:o.signal)==null||g.addEventListener("abort",d,{once:!0});const p=m=>{var E,y,S,b;if(((E=m.data)==null?void 0:E.identifier)===a&&(((y=m.data)==null?void 0:y.type)===r&&(this.channel.removeEventListener("message",p),(S=o==null?void 0:o.signal)==null||S.removeEventListener("abort",d),c(()=>{this.channel.postMessage({type:s,identifier:a,name:this.name})})),m.data.type===i)){this.channel.removeEventListener("message",p),(b=o==null?void 0:o.signal)==null||b.removeEventListener("abort",d);const _=new Error;m.data.error!=null&&(_.message=m.data.error.message,_.name=m.data.error.name,_.stack=m.data.error.stack),h(_)}};this.channel.addEventListener("message",p)})}}const Ete=n=>{if(n=Object.assign({},wte,n),!!globalThis.document||n.singleProcess){const t=new BroadcastChannel(M$),r=new Si;return t.addEventListener("message",Dk(r,t,"requestReadLock","abortReadLockRequest",I$,T$,P$,C$,k$)),t.addEventListener("message",Dk(r,t,"requestWriteLock","abortWriteLockRequest",R$,O$,D$,L$,N$)),r}return new _te(n.name)},gl=new Map;let _h;function B$(n){return typeof(n==null?void 0:n.readLock)=="function"&&typeof(n==null?void 0:n.writeLock)=="function"}function Ste(n){if(_h==null&&(_h=Ete(n),!B$(_h))){const e=_h;e.addEventListener("requestReadLock",t=>{const r=t.detail.name,i=t.detail.identifier,s=gl.get(r);if(s==null)return;const o=new AbortController,a=l=>{l.detail.name!==r||l.detail.identifier!==i||o.abort()};e.addEventListener("abortReadLockRequest",a),s.readLock({signal:o.signal}).then(async l=>{await t.detail.handler().finally(()=>{l()})}).catch(l=>{t.detail.onError(l)}).finally(()=>{e.removeEventListener("abortReadLockRequest",a)})}),e.addEventListener("requestWriteLock",t=>{const r=t.detail.name,i=t.detail.identifier,s=gl.get(r);if(s==null)return;const o=new AbortController,a=l=>{l.detail.name!==r||l.detail.identifier!==i||o.abort()};e.addEventListener("abortWriteLockRequest",a),s.writeLock({signal:o.signal}).then(async l=>{await t.detail.handler().finally(()=>{l()})}).catch(l=>{t.detail.onError(l)}).finally(()=>{e.removeEventListener("abortWriteLockRequest",a)})}),e.addEventListener("finalizeRequest",t=>{const r=t.detail.name,i=gl.get(r);i!=null&&i.finalize()})}return _h}async function yw(n,e){var o;let t,r;const i=new Promise((a,l)=>{t=a,r=l}),s=()=>{r(new Du)};return(o=e==null?void 0:e.signal)==null||o.addEventListener("abort",s,{once:!0}),n.add(async()=>{await new Promise(a=>{t(()=>{var l;(l=e==null?void 0:e.signal)==null||l.removeEventListener("abort",s),a()})})},{signal:e==null?void 0:e.signal}).catch(a=>{r(a)}),i}const Ate=(n,e)=>{let t=gl.get(n);if(t!=null)return t;const r=Ste(e);if(B$(r))return t=r,gl.set(n,t),t;const i=new Nk({concurrency:1});let s;return t={async readLock(o){if(s!=null)return yw(s,o);s=new Nk({concurrency:e.concurrency,autoStart:!1});const a=s,l=yw(s,o);return i.add(async()=>{a.start(),await a.onIdle().then(()=>{s===a&&(s=null)})}),l},async writeLock(o){return s=null,yw(i,o)},finalize:()=>{gl.delete(n)},queue:i},gl.set(n,t),e.autoFinalize===!0&&i.addEventListener("idle",()=>{t.finalize()},{once:!0}),t},xte={name:"lock",concurrency:1/0,singleProcess:!1,autoFinalize:!1};function Ite(n){const e=Object.assign({},xte,n);return Ate(e.name,e)}const Tte=36e5,Cte=216e5;var ml;(function(n){(function(t){let r;t.codec=()=>(r==null&&(r=pt((i,s,o={})=>{o.lengthDelimited!==!1&&s.fork(),i.key!=null&&i.key!==""&&(s.uint32(10),s.string(i.key)),i.value!=null&&i.value.byteLength>0&&(s.uint32(18),s.bytes(i.value)),o.lengthDelimited!==!1&&s.ldelim()},(i,s,o={})=>{const a={key:"",value:Je(0)},l=s==null?i.len:i.pos+s;for(;i.pos<l;){const c=i.uint32();switch(c>>>3){case 1:{a.key=i.string();break}case 2:{a.value=i.bytes();break}default:{i.skipType(c&7);break}}}return a})),r),t.encode=i=>dt(i,t.codec()),t.decode=(i,s)=>ft(i,t.codec(),s)})(n.Peer$metadataEntry||(n.Peer$metadataEntry={})),function(t){let r;t.codec=()=>(r==null&&(r=pt((i,s,o={})=>{o.lengthDelimited!==!1&&s.fork(),i.key!=null&&i.key!==""&&(s.uint32(10),s.string(i.key)),i.value!=null&&(s.uint32(18),ty.codec().encode(i.value,s)),o.lengthDelimited!==!1&&s.ldelim()},(i,s,o={})=>{var c;const a={key:""},l=s==null?i.len:i.pos+s;for(;i.pos<l;){const h=i.uint32();switch(h>>>3){case 1:{a.key=i.string();break}case 2:{a.value=ty.codec().decode(i,i.uint32(),{limits:(c=o.limits)==null?void 0:c.value});break}default:{i.skipType(h&7);break}}}return a})),r),t.encode=i=>dt(i,t.codec()),t.decode=(i,s)=>ft(i,t.codec(),s)}(n.Peer$tagsEntry||(n.Peer$tagsEntry={}));let e;n.codec=()=>(e==null&&(e=pt((t,r,i={})=>{if(i.lengthDelimited!==!1&&r.fork(),t.addresses!=null)for(const s of t.addresses)r.uint32(10),ey.codec().encode(s,r);if(t.protocols!=null)for(const s of t.protocols)r.uint32(18),r.string(s);if(t.publicKey!=null&&(r.uint32(34),r.bytes(t.publicKey)),t.peerRecordEnvelope!=null&&(r.uint32(42),r.bytes(t.peerRecordEnvelope)),t.metadata!=null&&t.metadata.size!==0)for(const[s,o]of t.metadata.entries())r.uint32(50),n.Peer$metadataEntry.codec().encode({key:s,value:o},r);if(t.tags!=null&&t.tags.size!==0)for(const[s,o]of t.tags.entries())r.uint32(58),n.Peer$tagsEntry.codec().encode({key:s,value:o},r);t.updated!=null&&(r.uint32(64),r.uint64Number(t.updated)),i.lengthDelimited!==!1&&r.ldelim()},(t,r,i={})=>{var a,l,c,h,d,p;const s={addresses:[],protocols:[],metadata:new Map,tags:new Map},o=r==null?t.len:t.pos+r;for(;t.pos<o;){const g=t.uint32();switch(g>>>3){case 1:{if(((a=i.limits)==null?void 0:a.addresses)!=null&&s.addresses.length===i.limits.addresses)throw new dn('Decode error - map field "addresses" had too many elements');s.addresses.push(ey.codec().decode(t,t.uint32(),{limits:(l=i.limits)==null?void 0:l.addresses$}));break}case 2:{if(((c=i.limits)==null?void 0:c.protocols)!=null&&s.protocols.length===i.limits.protocols)throw new dn('Decode error - map field "protocols" had too many elements');s.protocols.push(t.string());break}case 4:{s.publicKey=t.bytes();break}case 5:{s.peerRecordEnvelope=t.bytes();break}case 6:{if(((h=i.limits)==null?void 0:h.metadata)!=null&&s.metadata.size===i.limits.metadata)throw new YT('Decode error - map field "metadata" had too many elements');const m=n.Peer$metadataEntry.codec().decode(t,t.uint32());s.metadata.set(m.key,m.value);break}case 7:{if(((d=i.limits)==null?void 0:d.tags)!=null&&s.tags.size===i.limits.tags)throw new YT('Decode error - map field "tags" had too many elements');const m=n.Peer$tagsEntry.codec().decode(t,t.uint32(),{limits:{value:(p=i.limits)==null?void 0:p.tags$value}});s.tags.set(m.key,m.value);break}case 8:{s.updated=t.uint64Number();break}default:{t.skipType(g&7);break}}}return s})),e),n.encode=t=>dt(t,n.codec()),n.decode=(t,r)=>ft(t,n.codec(),r)})(ml||(ml={}));var ey;(function(n){let e;n.codec=()=>(e==null&&(e=pt((t,r,i={})=>{i.lengthDelimited!==!1&&r.fork(),t.multiaddr!=null&&t.multiaddr.byteLength>0&&(r.uint32(10),r.bytes(t.multiaddr)),t.isCertified!=null&&(r.uint32(16),r.bool(t.isCertified)),t.observed!=null&&(r.uint32(24),r.uint64Number(t.observed)),i.lengthDelimited!==!1&&r.ldelim()},(t,r,i={})=>{const s={multiaddr:Je(0)},o=r==null?t.len:t.pos+r;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.multiaddr=t.bytes();break}case 2:{s.isCertified=t.bool();break}case 3:{s.observed=t.uint64Number();break}default:{t.skipType(a&7);break}}}return s})),e),n.encode=t=>dt(t,n.codec()),n.decode=(t,r)=>ft(t,n.codec(),r)})(ey||(ey={}));var ty;(function(n){let e;n.codec=()=>(e==null&&(e=pt((t,r,i={})=>{i.lengthDelimited!==!1&&r.fork(),t.value!=null&&t.value!==0&&(r.uint32(8),r.uint32(t.value)),t.expiry!=null&&(r.uint32(16),r.uint64(t.expiry)),i.lengthDelimited!==!1&&r.ldelim()},(t,r,i={})=>{const s={value:0},o=r==null?t.len:t.pos+r;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.value=t.uint32();break}case 2:{s.expiry=t.uint64();break}default:{t.skipType(a&7);break}}}return s})),e),n.encode=t=>dt(t,n.codec()),n.decode=(t,r)=>ft(t,n.codec(),r)})(ty||(ty={}));function kte(n,e){if(n.publicKey!=null||e.publicKey==null)return n;let t;n.type==="RSA"&&(t=n.toMultihash());const r=Ea(e.publicKey,t);return wf(r)}function Pte(n,e,t){const r=ml.decode(e);return Nh(n,r,t)}function Nh(n,e,t){const r=new Map,i=BigInt(Date.now());for(const[s,o]of e.tags.entries())o.expiry!=null&&o.expiry<i||r.set(s,o);return{...e,id:kte(n,e),addresses:e.addresses.filter(({observed:s})=>s!=null&&s>Date.now()-t).map(({multiaddr:s,isCertified:o})=>({multiaddr:Nt(s),isCertified:o??!1})),metadata:e.metadata,peerRecordEnvelope:e.peerRecordEnvelope??void 0,tags:r}}function Rte(n,e){return Ote(n.addresses,e.addresses)&&Lte(n.protocols,e.protocols)&&Nte(n.publicKey,e.publicKey)&&Dte(n.peerRecordEnvelope,e.peerRecordEnvelope)&&$te(n.metadata,e.metadata)&&Mte(n.tags,e.tags)}function Ote(n,e){return F$(n,e,(t,r)=>!(t.isCertified!==r.isCertified||!Or(t.multiaddr,r.multiaddr)))}function Lte(n,e){return F$(n,e,(t,r)=>t===r)}function Nte(n,e){return U$(n,e)}function Dte(n,e){return U$(n,e)}function $te(n,e){return j$(n,e,(t,r)=>Or(t,r))}function Mte(n,e){return j$(n,e,(t,r)=>t.value===r.value&&t.expiry===r.expiry)}function U$(n,e){return n==null&&e==null?!0:n!=null&&e!=null?Or(n,e):!1}function F$(n,e,t){if(n.length!==e.length)return!1;for(let r=0;r<n.length;r++)if(!t(n[r],e[r]))return!1;return!0}function j$(n,e,t){if(n.size!==e.size)return!1;for(const[r,i]of n.entries()){const s=e.get(r);if(s==null||!t(i,s))return!1}return!0}const Ys="/",q$=new TextEncoder().encode(Ys),Ep=q$[0];class $n{constructor(e,t){v(this,"_buf");if(typeof e=="string")this._buf=at(e);else if(e instanceof Uint8Array)this._buf=e;else throw new Error("Invalid key, should be String of Uint8Array");if(t==null&&(t=!0),t&&this.clean(),this._buf.byteLength===0||this._buf[0]!==Ep)throw new Error("Invalid key")}toString(e="utf8"){return mt(this._buf,e)}uint8Array(){return this._buf}get[Symbol.toStringTag](){return`Key(${this.toString()})`}static withNamespaces(e){return new $n(e.join(Ys))}static random(){return new $n(Math.random().toString().substring(2))}static asKey(e){return e instanceof Uint8Array||typeof e=="string"?new $n(e):typeof e.uint8Array=="function"?new $n(e.uint8Array()):null}clean(){if((this._buf==null||this._buf.byteLength===0)&&(this._buf=q$),this._buf[0]!==Ep){const e=new Uint8Array(this._buf.byteLength+1);e.fill(Ep,0,1),e.set(this._buf,1),this._buf=e}for(;this._buf.byteLength>1&&this._buf[this._buf.byteLength-1]===Ep;)this._buf=this._buf.subarray(0,-1)}less(e){const t=this.list(),r=e.list();for(let i=0;i<t.length;i++){if(r.length<i+1)return!1;const s=t[i],o=r[i];if(s<o)return!0;if(s>o)return!1}return t.length<r.length}reverse(){return $n.withNamespaces(this.list().slice().reverse())}namespaces(){return this.list()}baseNamespace(){const e=this.namespaces();return e[e.length-1]}list(){return this.toString().split(Ys).slice(1)}type(){return Bte(this.baseNamespace())}name(){return Ute(this.baseNamespace())}instance(e){return new $n(this.toString()+":"+e)}path(){let e=this.parent().toString();return e.endsWith(Ys)||(e+=Ys),e+=this.type(),new $n(e)}parent(){const e=this.list();return e.length===1?new $n(Ys):new $n(e.slice(0,-1).join(Ys))}child(e){return this.toString()===Ys?e:e.toString()===Ys?this:new $n(this.toString()+e.toString(),!1)}isAncestorOf(e){return e.toString()===this.toString()?!1:e.toString().startsWith(this.toString())}isDecendantOf(e){return e.toString()===this.toString()?!1:this.toString().startsWith(e.toString())}isTopLevel(){return this.list().length===1}concat(...e){return $n.withNamespaces([...this.namespaces(),...Fte(e.map(t=>t.namespaces()))])}}function Bte(n){const e=n.split(":");return e.length<2?"":e.slice(0,-1).join(":")}function Ute(n){const e=n.split(":");return e[e.length-1]}function Fte(n){return[].concat(...n)}const H$="/peers/";function Sp(n){if(!Cl(n)||n.type==null)throw new rr("Invalid PeerId");const e=n.toCID().toString();return new $n(`${H$}${e}`)}async function jte(n,e,t,r,i){const s=new Map;for(const o of t){if(o==null)continue;if(o.multiaddr instanceof Uint8Array&&(o.multiaddr=Nt(o.multiaddr)),!Gy(o.multiaddr))throw new rr("Multiaddr was invalid");if(!await e(n,o.multiaddr,i))continue;const a=o.isCertified??!1,l=o.multiaddr.toString(),c=s.get(l);c!=null?o.isCertified=c.isCertified||a:s.set(l,{multiaddr:o.multiaddr,isCertified:a})}return[...s.values()].sort((o,a)=>o.multiaddr.toString().localeCompare(a.multiaddr.toString())).map(({isCertified:o,multiaddr:a})=>{const l=a.getPeerId();return n.equals(l)&&(a=a.decapsulate(Nt(`/p2p/${n}`))),{isCertified:o,multiaddr:a.bytes}})}async function bw(n,e,t,r){var p,g;if(e==null)throw new rr("Invalid PeerData");if(e.publicKey!=null&&n.publicKey!=null&&!e.publicKey.equals(n.publicKey))throw new rr("publicKey bytes do not match peer id publicKey bytes");const i=(p=r.existingPeer)==null?void 0:p.peer;if(i!=null&&!n.equals(i.id))throw new rr("peer id did not match existing peer id");let s=(i==null?void 0:i.addresses)??[],o=new Set((i==null?void 0:i.protocols)??[]),a=(i==null?void 0:i.metadata)??new Map,l=(i==null?void 0:i.tags)??new Map,c=i==null?void 0:i.peerRecordEnvelope;if(t==="patch"){if((e.multiaddrs!=null||e.addresses!=null)&&(s=[],e.multiaddrs!=null&&s.push(...e.multiaddrs.map(m=>({isCertified:!1,multiaddr:m}))),e.addresses!=null&&s.push(...e.addresses)),e.protocols!=null&&(o=new Set(e.protocols)),e.metadata!=null){const m=e.metadata instanceof Map?[...e.metadata.entries()]:Object.entries(e.metadata);a=Ap(m,{validate:$k})}if(e.tags!=null){const m=e.tags instanceof Map?[...e.tags.entries()]:Object.entries(e.tags);l=Ap(m,{validate:Mk,map:Bk})}e.peerRecordEnvelope!=null&&(c=e.peerRecordEnvelope)}if(t==="merge"){if(e.multiaddrs!=null&&s.push(...e.multiaddrs.map(m=>({isCertified:!1,multiaddr:m}))),e.addresses!=null&&s.push(...e.addresses),e.protocols!=null&&(o=new Set([...o,...e.protocols])),e.metadata!=null){const m=e.metadata instanceof Map?[...e.metadata.entries()]:Object.entries(e.metadata);for(const[E,y]of m)y==null?a.delete(E):a.set(E,y);a=Ap([...a.entries()],{validate:$k})}if(e.tags!=null){const m=e.tags instanceof Map?[...e.tags.entries()]:Object.entries(e.tags),E=new Map(l);for(const[y,S]of m)S==null?E.delete(y):E.set(y,S);l=Ap([...E.entries()],{validate:Mk,map:Bk})}e.peerRecordEnvelope!=null&&(c=e.peerRecordEnvelope)}let h;(i==null?void 0:i.id.publicKey)!=null?h=ho(i.id.publicKey):e.publicKey!=null?h=ho(e.publicKey):n.publicKey!=null&&(h=ho(n.publicKey));const d={addresses:await jte(n,r.addressFilter??(async()=>!0),s,(g=r.existingPeer)==null?void 0:g.peerPB.addresses,r),protocols:[...o.values()].sort((m,E)=>m.localeCompare(E)),metadata:a,tags:l,publicKey:h,peerRecordEnvelope:c};return d.addresses.forEach(m=>{var E,y,S;m.observed=((S=(y=(E=r.existingPeer)==null?void 0:E.peerPB.addresses)==null?void 0:y.find(b=>Or(b.multiaddr,b.multiaddr)))==null?void 0:S.observed)??Date.now()}),n.type!=="RSA"&&delete d.publicKey,d}function Ap(n,e){var r;const t=new Map;for(const[i,s]of n)s!=null&&e.validate(i,s);for(const[i,s]of n.sort(([o],[a])=>o.localeCompare(a)))s!=null&&t.set(i,((r=e.map)==null?void 0:r.call(e,i,s))??s);return t}function $k(n,e){if(typeof n!="string")throw new rr("Metadata key must be a string");if(!(e instanceof Uint8Array))throw new rr("Metadata value must be a Uint8Array")}function Mk(n,e){if(typeof n!="string")throw new rr("Tag name must be a string");if(e.value!=null){if(parseInt(`${e.value}`,10)!==e.value)throw new rr("Tag value must be an integer");if(e.value<0||e.value>100)throw new rr("Tag value must be between 0-100")}if(e.ttl!=null){if(parseInt(`${e.ttl}`,10)!==e.ttl)throw new rr("Tag ttl must be an integer");if(e.ttl<0)throw new rr("Tag ttl must be between greater than 0")}}function Bk(n,e){let t;e.expiry!=null&&(t=e.expiry),e.ttl!=null&&(t=BigInt(Date.now()+Number(e.ttl)));const r={value:e.value??0};return t!=null&&(r.expiry=t),r}function W$(n){const e=n.toString().split("/")[2],t=zt.parse(e,ba);return Jf(t)}function ww(n,e,t){const r=W$(n);return Pte(r,e,t)}function qte(n,e){return{prefix:H$,filters:(n.filters??[]).map(t=>({key:r,value:i})=>t(ww(r,i,e))),orders:(n.orders??[]).map(t=>(r,i)=>t(ww(r.key,r.value,e),ww(i.key,i.value,e)))}}var ni,Pg,Rg,Og;class Hte{constructor(e,t={}){Qe(this,ni);v(this,"peerId");v(this,"datastore");v(this,"locks");v(this,"addressFilter");v(this,"log");v(this,"maxAddressAge");v(this,"maxPeerAge");this.log=e.logger.forComponent("libp2p:peer-store"),this.peerId=e.peerId,this.datastore=e.datastore,this.addressFilter=t.addressFilter,this.locks=gte({name:"libp2p_peer_store_locks",metrics:e.metrics}),this.maxAddressAge=t.maxAddressAge??Tte,this.maxPeerAge=t.maxPeerAge??Cte}getLock(e){let t=this.locks.get(e);return t==null&&(t={refs:0,lock:Ite({name:e.toString(),singleProcess:!0})},this.locks.set(e,t)),t.refs++,t}maybeRemoveLock(e,t){t.refs--,t.refs===0&&(t.lock.finalize(),this.locks.delete(e))}async getReadLock(e,t){const r=this.getLock(e);try{const i=await r.lock.readLock(t);return()=>{i(),this.maybeRemoveLock(e,r)}}catch(i){throw this.maybeRemoveLock(e,r),i}}async getWriteLock(e,t){const r=this.getLock(e);try{const i=await r.lock.writeLock(t);return()=>{i(),this.maybeRemoveLock(e,r)}}catch(i){throw this.maybeRemoveLock(e,r),i}}async has(e,t){try{return await this.load(e,t),!0}catch(r){if(r.name!=="NotFoundError")throw r}return!1}async delete(e,t){this.peerId.equals(e)||await this.datastore.delete(Sp(e),t)}async load(e,t){const r=Sp(e),i=await this.datastore.get(r,t),s=ml.decode(i);if(Pe(this,ni,Og).call(this,e,s))throw await this.datastore.delete(r,t),new v1;return Nh(e,s,this.peerId.equals(e)?1/0:this.maxAddressAge)}async save(e,t,r){const i=await Pe(this,ni,Pg).call(this,e,r),s=await bw(e,t,"patch",{...r,addressFilter:this.addressFilter});return Pe(this,ni,Rg).call(this,e,s,i)}async patch(e,t,r){const i=await Pe(this,ni,Pg).call(this,e,r),s=await bw(e,t,"patch",{...r,addressFilter:this.addressFilter,existingPeer:i});return Pe(this,ni,Rg).call(this,e,s,i)}async merge(e,t,r){const i=await Pe(this,ni,Pg).call(this,e,r),s=await bw(e,t,"merge",{addressFilter:this.addressFilter,existingPeer:i});return Pe(this,ni,Rg).call(this,e,s,i)}async*all(e){for await(const{key:t,value:r}of this.datastore.query(qte(e??{},this.maxAddressAge),e)){const i=W$(t);if(i.equals(this.peerId))continue;const s=ml.decode(r);if(Pe(this,ni,Og).call(this,i,s)){await this.datastore.delete(t,e);continue}yield Nh(i,s,this.peerId.equals(i)?1/0:this.maxAddressAge)}}}ni=new WeakSet,Pg=async function(e,t){try{const r=Sp(e),i=await this.datastore.get(r,t),s=ml.decode(i);if(Pe(this,ni,Og).call(this,e,s))throw await this.datastore.delete(r,t),new v1;return{peerPB:s,peer:Nh(e,s,this.maxAddressAge)}}catch(r){r.name!=="NotFoundError"&&this.log.error("invalid peer data found in peer store - %e",r)}},Rg=async function(e,t,r,i){t.updated=Date.now();const s=ml.encode(t);return await this.datastore.put(Sp(e),s,i),{peer:Nh(e,t,this.maxAddressAge),previous:r==null?void 0:r.peer,updated:r==null||!Rte(t,r.peerPB)}},Og=function(e,t){if(t.updated==null)return!0;if(this.peerId.equals(e))return!1;const r=t.updated<Date.now()-this.maxPeerAge,i=Date.now()-this.maxAddressAge,s=t.addresses.filter(o=>o.observed!=null&&o.observed>i);return r&&s.length===0};var ZR,hu,Lg;ZR=Symbol.toStringTag;class Wte{constructor(e,t={}){Qe(this,hu);v(this,"store");v(this,"events");v(this,"peerId");v(this,"log");v(this,ZR,"@libp2p/peer-store");this.log=e.logger.forComponent("libp2p:peer-store"),this.events=e.events,this.peerId=e.peerId,this.store=new Hte(e,t)}async forEach(e,t){for await(const r of this.store.all(t))e(r)}async all(e){return as(this.store.all(e))}async delete(e,t){const r=await this.store.getReadLock(e,t);try{await this.store.delete(e,t)}finally{r()}}async has(e,t){const r=await this.store.getReadLock(e,t);try{return await this.store.has(e,t)}finally{this.log.trace("has release read lock"),r==null||r()}}async get(e,t){const r=await this.store.getReadLock(e,t);try{return await this.store.load(e,t)}finally{r==null||r()}}async getInfo(e,t){const r=await this.get(e,t);return{id:r.id,multiaddrs:r.addresses.map(({multiaddr:i})=>i)}}async save(e,t,r){const i=await this.store.getWriteLock(e,r);try{const s=await this.store.save(e,t,r);return Pe(this,hu,Lg).call(this,e,s),s.peer}finally{i==null||i()}}async patch(e,t,r){const i=await this.store.getWriteLock(e,r);try{const s=await this.store.patch(e,t,r);return Pe(this,hu,Lg).call(this,e,s),s.peer}finally{i==null||i()}}async merge(e,t,r){const i=await this.store.getWriteLock(e,r);try{const s=await this.store.merge(e,t,r);return Pe(this,hu,Lg).call(this,e,s),s.peer}finally{i==null||i()}}async consumePeerRecord(e,t,r){const i=Cl(t)?t:Cl(t==null?void 0:t.expectedPeer)?t.expectedPeer:void 0,s=Cl(t)||t===void 0?r:t,o=await Wl.openAndCertify(e,fo.DOMAIN,s),a=Jf(o.publicKey.toCID());if((i==null?void 0:i.equals(a))===!1)return this.log("envelope peer id was not the expected peer id - expected: %p received: %p",i,a),!1;const l=fo.createFromProtobuf(o.payload);let c;try{c=await this.get(a,s)}catch(h){if(h.name!=="NotFoundError")throw h}if((c==null?void 0:c.peerRecordEnvelope)!=null){const h=Wl.createFromProtobuf(c.peerRecordEnvelope),d=fo.createFromProtobuf(h.payload);if(d.seqNumber>=l.seqNumber)return this.log("sequence number was lower or equal to existing sequence number - stored: %d received: %d",d.seqNumber,l.seqNumber),!1}return await this.patch(l.peerId,{peerRecordEnvelope:e,addresses:l.multiaddrs.map(h=>({isCertified:!0,multiaddr:h}))},s),!0}}hu=new WeakSet,Lg=function(e,t){t.updated&&(this.peerId.equals(e)?this.events.safeDispatchEvent("self:peer:update",{detail:t}):this.events.safeDispatchEvent("peer:update",{detail:t}))};function zte(n,e={}){return new Wte(n,e)}const zc=class zc extends Error{constructor(t="Not Found"){super(t);v(this,"name",zc.name);v(this,"code",zc.code)}};v(zc,"name","NotFoundError"),v(zc,"code","ERR_NOT_FOUND");let tE=zc;function Kte(n){const[e,t]=n[Symbol.asyncIterator]!=null?[n[Symbol.asyncIterator](),Symbol.asyncIterator]:[n[Symbol.iterator](),Symbol.iterator],r=[];return{peek:()=>e.next(),push:i=>{r.push(i)},next:()=>r.length>0?{done:!1,value:r.shift()}:e.next(),[t](){return this}}}function Vte(n){return n[Symbol.asyncIterator]!=null}function Cc(n,e){let t=0;if(Vte(n))return async function*(){for await(const l of n)await e(l,t++)&&(yield l)}();const r=Kte(n),{value:i,done:s}=r.next();if(s===!0)return function*(){}();const o=e(i,t++);if(typeof o.then=="function")return async function*(){await o&&(yield i);for(const l of r)await e(l,t++)&&(yield l)}();const a=e;return function*(){o===!0&&(yield i);for(const l of r)a(l,t++)&&(yield l)}()}function Gte(n){return n[Symbol.asyncIterator]!=null}function Uk(n,e){return Gte(n)?async function*(){yield*(await as(n)).sort(e)}():function*(){yield*as(n).sort(e)}()}function Yte(n){return n[Symbol.asyncIterator]!=null}function Fk(n,e){return Yte(n)?async function*(){let t=0;if(!(e<1)){for await(const r of n)if(yield r,t++,t===e)return}}():function*(){let t=0;if(!(e<1)){for(const r of n)if(yield r,t++,t===e)return}}()}class Xte{put(e,t,r){return Promise.reject(new Error(".put is not implemented"))}get(e,t){return Promise.reject(new Error(".get is not implemented"))}has(e,t){return Promise.reject(new Error(".has is not implemented"))}delete(e,t){return Promise.reject(new Error(".delete is not implemented"))}async*putMany(e,t={}){for await(const{key:r,value:i}of e)await this.put(r,i,t),yield r}async*getMany(e,t={}){for await(const r of e)yield{key:r,value:await this.get(r,t)}}async*deleteMany(e,t={}){for await(const r of e)await this.delete(r,t),yield r}batch(){let e=[],t=[];return{put(r,i){e.push({key:r,value:i})},delete(r){t.push(r)},commit:async r=>{await hk(this.putMany(e,r)),e=[],await hk(this.deleteMany(t,r)),t=[]}}}async*_all(e,t){throw new Error("._all is not implemented")}async*_allKeys(e,t){throw new Error("._allKeys is not implemented")}query(e,t){let r=this._all(e,t);if(e.prefix!=null){const i=e.prefix;r=Cc(r,s=>s.key.toString().startsWith(i))}if(Array.isArray(e.filters)&&(r=e.filters.reduce((i,s)=>Cc(i,s),r)),Array.isArray(e.orders)&&(r=e.orders.reduce((i,s)=>Uk(i,s),r)),e.offset!=null){let i=0;const s=e.offset;r=Cc(r,()=>i++>=s)}return e.limit!=null&&(r=Fk(r,e.limit)),r}queryKeys(e,t){let r=this._allKeys(e,t);if(e.prefix!=null){const i=e.prefix;r=Cc(r,s=>s.toString().startsWith(i))}if(Array.isArray(e.filters)&&(r=e.filters.reduce((i,s)=>Cc(i,s),r)),Array.isArray(e.orders)&&(r=e.orders.reduce((i,s)=>Uk(i,s),r)),e.offset!=null){const i=e.offset;let s=0;r=Cc(r,()=>s++>=i)}return e.limit!=null&&(r=Fk(r,e.limit)),r}}class Zte extends Xte{constructor(){super();v(this,"data");this.data=new Map}put(t,r,i){var s;return(s=i==null?void 0:i.signal)==null||s.throwIfAborted(),this.data.set(t.toString(),r),t}get(t,r){var s;(s=r==null?void 0:r.signal)==null||s.throwIfAborted();const i=this.data.get(t.toString());if(i==null)throw new tE;return i}has(t,r){var i;return(i=r==null?void 0:r.signal)==null||i.throwIfAborted(),this.data.has(t.toString())}delete(t,r){var i;(i=r==null?void 0:r.signal)==null||i.throwIfAborted(),this.data.delete(t.toString())}*_all(t,r){var i,s;(i=r==null?void 0:r.signal)==null||i.throwIfAborted();for(const[o,a]of this.data.entries())yield{key:new $n(o),value:a},(s=r==null?void 0:r.signal)==null||s.throwIfAborted()}*_allKeys(t,r){var i,s;(i=r==null?void 0:r.signal)==null||i.throwIfAborted();for(const o of this.data.keys())yield new $n(o),(s=r==null?void 0:r.signal)==null||s.throwIfAborted()}}class Qte extends Map{constructor(t){super();v(this,"metric");const{name:r,metrics:i}=t;this.metric=i.registerMetric(r),this.updateComponentMetric()}set(t,r){return super.set(t,r),this.updateComponentMetric(),this}delete(t){const r=super.delete(t);return this.updateComponentMetric(),r}clear(){super.clear(),this.updateComponentMetric()}updateComponentMetric(){this.metric.update(this.size)}}function wo(n){const{name:e,metrics:t}=n;let r;return t!=null?r=new Qte({name:e,metrics:t}):r=new Map,r}const jk=864e13,Jte=448,vw=449,ere=53,tre=54,rre=55,nre=56;class ire{constructor(e,t={}){v(this,"log");v(this,"mappings");this.log=e.logger.forComponent("libp2p:address-manager:dns-mappings"),this.mappings=wo({name:"libp2p_address_manager_dns_mappings",metrics:e.metrics})}has(e){const t=this.findHost(e);for(const r of this.mappings.values())if(r.domain===t)return!0;return!1}add(e,t){t.forEach(r=>{this.log("add DNS mapping %s to %s",r,e);const i=eb(r)===!0;this.mappings.set(r,{domain:e,verified:i,expires:i?jk-Date.now():0,lastVerified:i?jk-Date.now():void 0})})}remove(e){const t=this.findHost(e);let r=!1;for(const[i,s]of this.mappings.entries())s.domain===t&&(this.log("removing %s to %s DNS mapping %e",i,s.domain,new Error("where")),this.mappings.delete(i),r=r||s.verified);return r}getAll(e){const t=[];for(let r=0;r<e.length;r++){const s=e[r].multiaddr.stringTuples(),o=s[0][1];if(o!=null)for(const[a,l]of this.mappings.entries()){if(o!==a)continue;this.maybeAddSNITuple(s,l.domain)&&(e.splice(r,1),r--,t.push({multiaddr:Nt(`/${s.map(h=>[HS(h[0]).name,h[1]].join("/")).join("/")}`),verified:l.verified,type:"dns-mapping",expires:l.expires,lastVerified:l.lastVerified}))}}return t}maybeAddSNITuple(e,t){var r;for(let i=0;i<e.length;i++)if(e[i][0]===Jte&&((r=e[i+1])==null?void 0:r[0])!==vw)return e.splice(i+1,0,[vw,t]),!0;return!1}confirm(e,t){const r=this.findHost(e);let i=!1;for(const[s,o]of this.mappings.entries())o.domain===r&&(this.log("marking %s to %s DNS mapping as verified",s,o.domain),i=o.verified,o.verified=!0,o.expires=Date.now()+t,o.lastVerified=Date.now());return i}unconfirm(e,t){const r=this.findHost(e);let i=!1;for(const[s,o]of this.mappings.entries())o.domain===r&&(this.log("removing verification of %s to %s DNS mapping",s,o.domain),i=i||o.verified,o.verified=!1,o.expires=Date.now()+t);return i}findHost(e){for(const t of e.stringTuples())if(t[0]===vw||t[0]===ere||t[0]===tre||t[0]===rre||t[0]===nre)return t[1]}}const _w=4,Ew=41,Sw=6,sre=273;class ore{constructor(e,t={}){v(this,"log");v(this,"mappings");this.log=e.logger.forComponent("libp2p:address-manager:ip-mappings"),this.mappings=wo({name:"libp2p_address_manager_ip_mappings",metrics:e.metrics})}has(e){const t=e.stringTuples();for(const r of this.mappings.values())for(const i of r)if(i.externalIp===t[0][1])return!0;return!1}add(e,t,r,i=t,s="tcp"){const o=`${e}-${t}-${s}`,a=this.mappings.get(o)??[],l={internalIp:e,internalPort:t,externalIp:r,externalPort:i,externalFamily:Ul(r)?4:6,protocol:s,verified:!1,expires:0};a.push(l),this.mappings.set(o,a)}remove(e){const t=e.stringTuples(),r=t[0][1]??"",i=t[1][0]===Sw?"tcp":"udp",s=parseInt(t[1][1]??"0");let o=!1;for(const[a,l]of this.mappings.entries()){for(let c=0;c<l.length;c++){const h=l[c];h.externalIp===r&&h.externalPort===s&&h.protocol===i&&(this.log("removing %s:%s to %s:%s %s IP mapping",h.externalIp,h.externalPort,r,s,i),o=o||h.verified,l.splice(c,1),c--)}l.length===0&&this.mappings.delete(a)}return o}getAll(e){const t=[];for(const{multiaddr:r}of e){const i=r.stringTuples();let s;if((i[0][0]===_w||i[0][0]===Ew)&&i[1][0]===Sw?s=`${i[0][1]}-${i[1][1]}-tcp`:(i[0][0]===_w||i[0][0]===Ew)&&i[1][0]===sre&&(s=`${i[0][1]}-${i[1][1]}-udp`),s==null)continue;const o=this.mappings.get(s);if(o!=null)for(const a of o)i[0][0]=a.externalFamily===4?_w:Ew,i[0][1]=a.externalIp,i[1][1]=`${a.externalPort}`,t.push({multiaddr:Nt(`/${i.map(l=>[HS(l[0]).name,l[1]].join("/")).join("/")}`),verified:a.verified,type:"ip-mapping",expires:a.expires,lastVerified:a.lastVerified})}return t}confirm(e,t){const i=e.stringTuples()[0][1];let s=!1;for(const o of this.mappings.values())for(const a of o)a.externalIp===i&&(this.log("marking %s to %s IP mapping as verified",a.internalIp,a.externalIp),s=a.verified,a.verified=!0,a.expires=Date.now()+t,a.lastVerified=Date.now());return s}unconfirm(e,t){const r=e.stringTuples(),i=r[0][1]??"",s=r[1][0]===Sw?"tcp":"udp",o=parseInt(r[1][1]??"0");let a=!1;for(const l of this.mappings.values())for(let c=0;c<l.length;c++){const h=l[c];h.externalIp===i&&h.externalPort===o&&h.protocol===s&&(this.log("removing verification of %s:%s to %s:%s %s IP mapping",h.externalIp,h.externalPort,i,o,s),a=a||h.verified,h.verified=!1,h.expires=Date.now()+t)}return a}}function are(n){try{for(const{code:e,value:t}of n.getComponents())if(e!==zu&&t!=null){if(e===xu)return t.startsWith("169.254.");if(e===ls)return t.toLowerCase().startsWith("fe80")}}catch{}return!1}const lre={maxObservedAddresses:10};class cre{constructor(e,t={}){v(this,"log");v(this,"addresses");v(this,"maxObservedAddresses");this.log=e.logger.forComponent("libp2p:address-manager:observed-addresses"),this.addresses=wo({name:"libp2p_address_manager_observed_addresses",metrics:e.metrics}),this.maxObservedAddresses=t.maxObservedAddresses??lre.maxObservedAddresses}has(e){return this.addresses.has(e.toString())}removePrefixed(e){for(const t of this.addresses.keys())t.toString().startsWith(e)&&this.addresses.delete(t)}add(e){this.addresses.size!==this.maxObservedAddresses&&(Af(e)||are(e)||(this.log("adding observed address %a",e),this.addresses.set(e.toString(),{verified:!1,expires:0})))}getAll(){return Array.from(this.addresses).map(([e,t])=>({multiaddr:Nt(e),verified:t.verified,type:"observed",expires:t.expires,lastVerified:t.lastVerified}))}remove(e){var r;const t=((r=this.addresses.get(e.toString()))==null?void 0:r.verified)??!1;return this.log("removing observed address %a",e),this.addresses.delete(e.toString()),t}confirm(e,t){const r=e.toString(),i=this.addresses.get(r)??{verified:!1,expires:Date.now()+t,lastVerified:Date.now()},s=i.verified;return i.verified=!0,i.expires=Date.now()+t,i.lastVerified=Date.now(),this.log("marking observed address %a as verified",r),this.addresses.set(r,i),s}}const ure=[xu,ls,zy,Ky,ed,Vy];function qk(n){try{for(const{code:e}of n.getComponents())if(e!==zu)return ure.includes(e)}catch{}return!1}const hre={maxObservedAddresses:10};class fre{constructor(e,t={}){v(this,"log");v(this,"addresses");v(this,"maxObservedAddresses");this.log=e.logger.forComponent("libp2p:address-manager:observed-addresses"),this.addresses=wo({name:"libp2p_address_manager_transport_addresses",metrics:e.metrics}),this.maxObservedAddresses=t.maxObservedAddresses??hre.maxObservedAddresses}get(e,t){if(Af(e))return{multiaddr:e,verified:!0,type:"transport",expires:Date.now()+t,lastVerified:Date.now()};const r=this.toKey(e);let i=this.addresses.get(r);return i==null&&(i={verified:!qk(e),expires:0},this.addresses.set(r,i)),{multiaddr:e,verified:i.verified,type:"transport",expires:i.expires,lastVerified:i.lastVerified}}has(e){const t=this.toKey(e);return this.addresses.has(t)}remove(e){var i;const t=this.toKey(e),r=((i=this.addresses.get(t))==null?void 0:i.verified)??!1;return this.log("removing observed address %a",e),this.addresses.delete(t),r}confirm(e,t){const r=this.toKey(e),i=this.addresses.get(r)??{verified:!1,expires:0,lastVerified:0},s=i.verified;return i.verified=!0,i.expires=Date.now()+t,i.lastVerified=Date.now(),this.addresses.set(r,i),s}unconfirm(e,t){const r=this.toKey(e),i=this.addresses.get(r)??{verified:!1,expires:0},s=i.verified;return i.verified=!1,i.expires=Date.now()+t,this.addresses.set(r,i),s}toKey(e){if(qk(e)){const t=e.toOptions();return`${t.host}-${t.port}-${t.transport}`}return e.toString()}}const Hk=6e4,Wk={addressVerificationTTL:Hk*10,addressVerificationRetry:Hk*5},dre=n=>n;function Aw(n,e){const t=n.getPeerId();return t!=null&&Cs(t).equals(e)&&(n=n.decapsulate(Nt(`/p2p/${e.toString()}`))),n}var QR;QR=Symbol.toStringTag;class pre{constructor(e,t={}){v(this,"log");v(this,"components");v(this,"listen");v(this,"announce");v(this,"appendAnnounce");v(this,"announceFilter");v(this,"observed");v(this,"dnsMappings");v(this,"ipMappings");v(this,"transportAddresses");v(this,"observedAddressFilter");v(this,"addressVerificationTTL");v(this,"addressVerificationRetry");v(this,QR,"@libp2p/address-manager");const{listen:r=[],announce:i=[],appendAnnounce:s=[]}=t;this.components=e,this.log=e.logger.forComponent("libp2p:address-manager"),this.listen=r.map(o=>o.toString()),this.announce=new Set(i.map(o=>o.toString())),this.appendAnnounce=new Set(s.map(o=>o.toString())),this.observed=new cre(e,t),this.dnsMappings=new ire(e,t),this.ipMappings=new ore(e,t),this.transportAddresses=new fre(e,t),this.announceFilter=t.announceFilter??dre,this.observedAddressFilter=S$(1024),this.addressVerificationTTL=t.addressVerificationTTL??Wk.addressVerificationTTL,this.addressVerificationRetry=t.addressVerificationRetry??Wk.addressVerificationRetry,this._updatePeerStoreAddresses=z1(this._updatePeerStoreAddresses.bind(this),1e3),e.events.addEventListener("transport:listening",()=>{this._updatePeerStoreAddresses()}),e.events.addEventListener("transport:close",()=>{this._updatePeerStoreAddresses()})}_updatePeerStoreAddresses(){const e=this.getAddresses().map(t=>t.getPeerId()===this.components.peerId.toString()?t.decapsulate(`/p2p/${this.components.peerId.toString()}`):t);this.components.peerStore.patch(this.components.peerId,{multiaddrs:e}).catch(t=>{this.log.error("error updating addresses",t)})}getListenAddrs(){return Array.from(this.listen).map(e=>Nt(e))}getAnnounceAddrs(){return Array.from(this.announce).map(e=>Nt(e))}getAppendAnnounceAddrs(){return Array.from(this.appendAnnounce).map(e=>Nt(e))}getObservedAddrs(){return this.observed.getAll().map(e=>e.multiaddr)}addObservedAddr(e){const t=e.stringTuples(),r=`${t[0][1]}:${t[1][1]}`;this.observedAddressFilter.has(r)||(this.observedAddressFilter.add(r),e=Aw(e,this.components.peerId),!this.ipMappings.has(e)&&(this.dnsMappings.has(e)||this.observed.add(e)))}confirmObservedAddr(e,t){e=Aw(e,this.components.peerId);let r=!0;((t==null?void 0:t.type)==="transport"||this.transportAddresses.has(e))&&!this.transportAddresses.confirm(e,(t==null?void 0:t.ttl)??this.addressVerificationTTL)&&r&&(r=!1),((t==null?void 0:t.type)==="dns-mapping"||this.dnsMappings.has(e))&&!this.dnsMappings.confirm(e,(t==null?void 0:t.ttl)??this.addressVerificationTTL)&&r&&(r=!1),((t==null?void 0:t.type)==="ip-mapping"||this.ipMappings.has(e))&&!this.ipMappings.confirm(e,(t==null?void 0:t.ttl)??this.addressVerificationTTL)&&r&&(r=!1),((t==null?void 0:t.type)==="observed"||this.observed.has(e))&&(this.maybeUpgradeToIPMapping(e)?(this.ipMappings.confirm(e,(t==null?void 0:t.ttl)??this.addressVerificationTTL),r=!1):!this.observed.confirm(e,(t==null?void 0:t.ttl)??this.addressVerificationTTL)&&r&&(r=!1)),r||this._updatePeerStoreAddresses()}removeObservedAddr(e,t){e=Aw(e,this.components.peerId),this.observed.has(e)&&this.observed.remove(e),this.transportAddresses.has(e)&&this.transportAddresses.unconfirm(e,(t==null?void 0:t.ttl)??this.addressVerificationRetry),this.dnsMappings.has(e)&&this.dnsMappings.unconfirm(e,(t==null?void 0:t.ttl)??this.addressVerificationRetry),this.ipMappings.has(e)&&this.ipMappings.unconfirm(e,(t==null?void 0:t.ttl)??this.addressVerificationRetry)}getAddresses(){const e=new Set,t=this.getAddressesWithMetadata().filter(r=>{if(!r.verified)return!1;const i=r.multiaddr.toString();return e.has(i)?!1:(e.add(i),!0)}).map(r=>r.multiaddr);return this.announceFilter(t.map(r=>{const i=Nt(r),s=i.getComponents().pop();return(s==null?void 0:s.value)===this.components.peerId.toString()?i:i.encapsulate(`/p2p/${this.components.peerId.toString()}`)}))}getAddressesWithMetadata(){const e=this.getAnnounceAddrs();if(e.length>0)return this.components.transportManager.getListeners().forEach(i=>{i.updateAnnounceAddrs(e)}),e.map(i=>({multiaddr:i,verified:!0,type:"announce",expires:Date.now()+this.addressVerificationTTL,lastVerified:Date.now()}));let t=[];t=t.concat(this.components.transportManager.getAddrs().map(i=>this.transportAddresses.get(i,this.addressVerificationTTL)));const r=this.getAppendAnnounceAddrs();return r.length>0&&(this.components.transportManager.getListeners().forEach(i=>{i.updateAnnounceAddrs(r)}),t=t.concat(r.map(i=>({multiaddr:i,verified:!0,type:"announce",expires:Date.now()+this.addressVerificationTTL,lastVerified:Date.now()})))),t=t.concat(this.observed.getAll()),t=t.concat(this.ipMappings.getAll(t)),t=t.concat(this.dnsMappings.getAll(t)),t}addDNSMapping(e,t){this.dnsMappings.add(e,t)}removeDNSMapping(e){this.dnsMappings.remove(Nt(`/dns/${e}`))&&this._updatePeerStoreAddresses()}addPublicAddressMapping(e,t,r,i=t,s="tcp"){this.ipMappings.add(e,t,r,i,s),this.observed.removePrefixed(`/ip${Ul(r)?4:6}/${r}/${s}/${i}`)}removePublicAddressMapping(e,t,r,i=t,s="tcp"){this.ipMappings.remove(Nt(`/ip${Ul(r)?4:6}/${r}/${s}/${i}`))&&this._updatePeerStoreAddresses()}maybeUpgradeToIPMapping(e){if(this.ipMappings.has(e))return!1;const t=e.toOptions();if(t.family===6||t.host==="127.0.0.1"||eb(t.host)===!0)return!1;const r=this.components.transportManager.getListeners(),i=[s=>If.exactMatch(s)||Tf.exactMatch(s),s=>Xm.exactMatch(s),s=>iJ.exactMatch(s)];for(const s of i){if(!s(e))continue;const o=r.filter(c=>c.getAddrs().filter(h=>h.toOptions().family===4&&s(h)).length>0);if(o.length!==1)continue;const a=o[0].getAddrs().filter(c=>c.toOptions().host!=="127.0.0.1").pop();if(a==null)continue;const l=a.toOptions();return this.observed.remove(e),this.ipMappings.add(l.host,l.port,t.host,t.port,t.transport),!0}return!1}}var zk;(function(n){n.NOT_STARTED_YET="The libp2p node is not started yet",n.NOT_FOUND="Not found"})(zk||(zk={}));class gre extends Error{constructor(e="Missing service"){super(e),this.name="MissingServiceError"}}class mre extends Error{constructor(e="Unmet service dependencies"){super(e),this.name="UnmetServiceDependenciesError"}}class xw extends Error{constructor(e="No content routers available"){super(e),this.name="NoContentRoutersError"}}class Kk extends Error{constructor(e="No peer routers available"){super(e),this.name="NoPeerRoutersError"}}class yre extends Error{constructor(e="Should not try to find self"){super(e),this.name="QueriedForSelfError"}}class bre extends Error{constructor(e="Unhandled protocol error"){super(e),this.name="UnhandledProtocolError"}}class wre extends Error{constructor(e="Duplicate protocol handler error"){super(e),this.name="DuplicateProtocolHandlerError"}}class Vk extends Error{constructor(e="Dial denied error"){super(e),this.name="DialDeniedError"}}class vre extends Error{constructor(e="No transport was configured to listen on this address"){super(e),this.name="UnsupportedListenAddressError"}}class _re extends Error{constructor(e="Configured listen addresses could not be listened on"){super(e),this.name="UnsupportedListenAddressesError"}}class Ere extends Error{constructor(e="No valid addresses"){super(e),this.name="NoValidAddressesError"}}class Sre extends Error{constructor(e="Connection intercepted"){super(e),this.name="ConnectionInterceptedError"}}class Are extends Error{constructor(e="Connection denied"){super(e),this.name="ConnectionDeniedError"}}class xp extends Error{constructor(e="Stream is not multiplexed"){super(e),this.name="MuxerUnavailableError"}}class Ip extends Error{constructor(e="Encryption failed"){super(e),this.name="EncryptionFailedError"}}class xre extends Error{constructor(e="Transport unavailable"){super(e),this.name="TransportUnavailableError"}}class Ire{constructor(e={}){v(this,"components",{});v(this,"_started",!1);this.components={};for(const[t,r]of Object.entries(e))this.components[t]=r;this.components.logger==null&&(this.components.logger=b$())}isStarted(){return this._started}async _invokeStartableMethod(e){await Promise.all(Object.values(this.components).filter(t=>_S(t)).map(async t=>{var r;await((r=t[e])==null?void 0:r.call(t))}))}async beforeStart(){await this._invokeStartableMethod("beforeStart")}async start(){await this._invokeStartableMethod("start"),this._started=!0}async afterStart(){await this._invokeStartableMethod("afterStart")}async beforeStop(){await this._invokeStartableMethod("beforeStop")}async stop(){await this._invokeStartableMethod("stop"),this._started=!1}async afterStop(){await this._invokeStartableMethod("afterStop")}}const Tre=["metrics","connectionProtector","dns"],Cre=["components","isStarted","beforeStart","start","afterStart","beforeStop","stop","afterStop","then","_invokeStartableMethod"];function kre(n={}){const e=new Ire(n);return new Proxy(e,{get(r,i,s){if(typeof i=="string"&&!Cre.includes(i)){const o=e.components[i];if(o==null&&!Tre.includes(i))throw new gre(`${i} not set`);return o}return Reflect.get(r,i,s)},set(r,i,s){return typeof i=="string"?e.components[i]=s:Reflect.set(r,i,s),!0}})}function Pre(n){const e={};for(const t of Object.values(n.components))for(const r of Rre(t))e[r]=!0;for(const t of Object.values(n.components))for(const r of Ore(t))if(e[r]!==!0)throw new mre(`Service "${Lre(t)}" required capability "${r}" but it was not provided by any component, you may need to add additional configuration when creating your node.`)}function Rre(n){return Array.isArray(n==null?void 0:n[bo])?n[bo]:[]}function Ore(n){return Array.isArray(n==null?void 0:n[sC])?n[sC]:[]}function Lre(n){return(n==null?void 0:n[Symbol.toStringTag])??(n==null?void 0:n.toString())??"unknown"}const Nre=4,Dre=41;function $re(n={}){return{denyDialPeer:async()=>!1,denyDialMultiaddr:async e=>{if(If.matches(e))return!1;const t=e.stringTuples();return t[0][0]===Nre||t[0][0]===Dre?!!eb(`${t[0][1]}`):!1},denyInboundConnection:async()=>!1,denyOutboundConnection:async()=>!1,denyInboundEncryptedConnection:async()=>!1,denyOutboundEncryptedConnection:async()=>!1,denyInboundUpgradedConnection:async()=>!1,denyOutboundUpgradedConnection:async()=>!1,filterMultiaddrForPeer:async()=>!0,...n}}function z$(n){if(Cl(n))return{peerId:n,multiaddrs:[]};let e=Array.isArray(n)?n:[n],t;if(e.length>0){const r=e[0].getPeerId();t=r==null?void 0:Cs(r),e.forEach(i=>{if(!Gy(i))throw new bS("Invalid multiaddr");const s=i.getPeerId();if(s==null){if(t!=null)throw new rr("Multiaddrs must all have the same peer id or have no peer id")}else{const o=Cs(s);if((t==null?void 0:t.equals(o))!==!0)throw new rr("Multiaddrs must all have the same peer id or have no peer id")}})}return e=e.filter(r=>!tJ.exactMatch(r)),{peerId:t,multiaddrs:e}}const Mre=["/ipfs/id/1.0.0","/ipfs/id/push/1.0.0","/libp2p/autonat/1.0.0","/libp2p/dcutr"];async function Bre(n,e){var i;const t=((i=n==null?void 0:n.streams)==null?void 0:i.map(s=>s.protocol))??[],r=(e==null?void 0:e.closableProtocols)??Mre;if(!(t.filter(s=>s!=null&&!r.includes(s)).length>0))try{await(n==null?void 0:n.close(e))}catch(s){n==null||n.abort(s)}}async function Ure(n,e){let t=!1;for(const i of qS.keys())if(t=n.protoNames().includes(i),t)break;if(!t)return[n];const r=await n.resolve(e);return e.log("resolved %s to",n,r.map(i=>i.toString())),r}function rE(n){try{let e;if(typeof n=="string"?e=Nt(n):e=n,!e.protoNames().includes("ipcidr")){const r=e.protoNames().includes("ip6")?"/ipcidr/128":"/ipcidr/32";e=e.encapsulate(r)}return LY(e)}catch{throw new Error(`Can't convert to IpNet, Invalid multiaddr format: ${n}`)}}class Fre{constructor(e,t={}){v(this,"connectionManager");v(this,"peerStore");v(this,"allow");v(this,"events");v(this,"log");this.allow=(t.allow??[]).map(r=>rE(r)),this.connectionManager=e.connectionManager,this.peerStore=e.peerStore,this.events=e.events,this.log=e.logger.forComponent("libp2p:connection-manager:connection-pruner"),this.maybePruneConnections=this.maybePruneConnections.bind(this)}start(){this.events.addEventListener("connection:open",this.maybePruneConnections)}stop(){this.events.removeEventListener("connection:open",this.maybePruneConnections)}maybePruneConnections(){this._maybePruneConnections().catch(e=>{this.log.error("error while pruning connections %e",e)})}async _maybePruneConnections(){const e=this.connectionManager.getConnections(),t=e.length,r=this.connectionManager.getMaxConnections();if(this.log("checking max connections limit %d/%d",t,r),t<=r)return;const i=new sd;for(const l of e){const c=l.remotePeer;if(!i.has(c)){i.set(c,0);try{const h=await this.peerStore.get(c);i.set(c,[...h.tags.values()].reduce((d,p)=>d+p.value,0))}catch(h){h.name!=="NotFoundError"&&this.log.error("error loading peer tags",h)}}}const s=this.sortConnections(e,i),o=Math.max(t-r,0),a=[];for(const l of s)if(this.log("too many connections open - closing a connection to %p",l.remotePeer),this.allow.some(h=>h.contains(l.remoteAddr.nodeAddress().address))||a.push(l),a.length===o)break;await Promise.all(a.map(async l=>{await Bre(l,{signal:AbortSignal.timeout(1e3)})})),this.events.safeDispatchEvent("connection:prune",{detail:a})}sortConnections(e,t){return e.sort((r,i)=>{const s=r.timeline.open,o=i.timeline.open;return s<o?1:s>o?-1:0}).sort((r,i)=>r.direction==="outbound"&&i.direction==="inbound"?1:r.direction==="inbound"&&i.direction==="outbound"?-1:0).sort((r,i)=>r.streams.length>i.streams.length?1:r.streams.length<i.streams.length?-1:0).sort((r,i)=>{const s=t.get(r.remotePeer)??0,o=t.get(i.remotePeer)??0;return s>o?1:s<o?-1:0})}}const K$=1e4,jre=1e4,Gk=1e4,V$=25,qre=5,Hre=10,Wre=5,zre="last-dial-failure",Kre="last-dial-success",G$=500,Vre=100,Y$=50;class Gre{constructor(e){v(this,"deferred");v(this,"signal");var t;this.signal=e,this.deferred=qr(),this.onAbort=this.onAbort.bind(this),(t=this.signal)==null||t.addEventListener("abort",this.onAbort)}onAbort(){var e;this.deferred.reject(((e=this.signal)==null?void 0:e.reason)??new yu)}cleanup(){var e;(e=this.signal)==null||e.removeEventListener("abort",this.onAbort)}}function Yre(){return`${parseInt(String(Math.random()*1e9),10).toString()}${Date.now()}`}class Xre{constructor(e,t){v(this,"id");v(this,"fn");v(this,"options");v(this,"recipients");v(this,"status");v(this,"timeline");v(this,"controller");this.id=Yre(),this.status="queued",this.fn=e,this.options=t,this.recipients=[],this.timeline={created:Date.now()},this.controller=new AbortController,this.controller.signal,this.onAbort=this.onAbort.bind(this)}abort(e){this.controller.abort(e)}onAbort(){this.recipients.reduce((t,r)=>{var i;return t&&((i=r.signal)==null?void 0:i.aborted)===!0},!0)&&(this.controller.abort(new yu),this.cleanup())}async join(e={}){var r;const t=new Gre(e.signal);return this.recipients.push(t),(r=e.signal)==null||r.addEventListener("abort",this.onAbort),t.deferred.promise}async run(){this.status="running",this.timeline.started=Date.now();try{this.controller.signal.throwIfAborted();const e=await Un(this.fn({...this.options??{},signal:this.controller.signal}),this.controller.signal);this.recipients.forEach(t=>{t.deferred.resolve(e)}),this.status="complete"}catch(e){this.recipients.forEach(t=>{t.deferred.reject(e)}),this.status="errored"}finally{this.timeline.finished=Date.now(),this.cleanup()}}cleanup(){this.recipients.forEach(e=>{var t;e.cleanup(),(t=e.signal)==null||t.removeEventListener("abort",this.onAbort)})}}class X$ extends Si{constructor(t={}){var r;super();v(this,"concurrency");v(this,"maxSize");v(this,"queue");v(this,"pending");v(this,"sort");this.concurrency=t.concurrency??Number.POSITIVE_INFINITY,this.maxSize=t.maxSize??Number.POSITIVE_INFINITY,this.pending=0,t.metricName!=null&&((r=t.metrics)==null||r.registerMetricGroup(t.metricName,{calculate:()=>({size:this.queue.length,running:this.pending,queued:this.queue.length-this.pending})})),this.sort=t.sort,this.queue=[],this.emitEmpty=z1(this.emitEmpty.bind(this),1),this.emitIdle=z1(this.emitIdle.bind(this),1)}emitEmpty(){this.size===0&&this.safeDispatchEvent("empty")}emitIdle(){this.running===0&&this.safeDispatchEvent("idle")}tryToStartAnother(){if(this.size===0)return this.emitEmpty(),this.running===0&&this.emitIdle(),!1;if(this.pending<this.concurrency){let t;for(const r of this.queue)if(r.status==="queued"){t=r;break}return t==null?!1:(this.safeDispatchEvent("active"),this.pending++,t.run().finally(()=>{for(let r=0;r<this.queue.length;r++)if(this.queue[r]===t){this.queue.splice(r,1);break}this.pending--,this.tryToStartAnother(),this.safeDispatchEvent("next")}),!0)}return!1}enqueue(t){this.queue.push(t),this.sort!=null&&this.queue.sort(this.sort)}async add(t,r){var s;if((s=r==null?void 0:r.signal)==null||s.throwIfAborted(),this.size===this.maxSize)throw new wJ;const i=new Xre(t,r);return this.enqueue(i),this.safeDispatchEvent("add"),this.tryToStartAnother(),i.join(r).then(o=>(this.safeDispatchEvent("completed",{detail:o}),this.safeDispatchEvent("success",{detail:{job:i,result:o}}),o)).catch(o=>{if(i.status==="queued"){for(let a=0;a<this.queue.length;a++)if(this.queue[a]===i){this.queue.splice(a,1);break}}throw this.safeDispatchEvent("failure",{detail:{job:i,error:o}}),o})}clear(){this.queue.splice(0,this.queue.length)}abort(){this.queue.forEach(t=>{t.abort(new yu)}),this.clear()}async onEmpty(t){this.size!==0&&await kl(this,"empty",t==null?void 0:t.signal)}async onSizeLessThan(t,r){this.size<t||await kl(this,"next",r==null?void 0:r.signal,{filter:()=>this.size<t})}async onIdle(t){this.pending===0&&this.size===0||await kl(this,"idle",t==null?void 0:t.signal)}get size(){return this.queue.length}get queued(){return this.queue.length-this.pending}get running(){return this.pending}async*toGenerator(t){var c,h,d;(c=t==null?void 0:t.signal)==null||c.throwIfAborted();const r=Gf({objectMode:!0}),i=p=>{p!=null?this.abort():this.clear(),r.end(p)},s=p=>{p.detail!=null&&r.push(p.detail)},o=p=>{i(p.detail.error)},a=()=>{i()},l=()=>{i(new yu("Queue aborted"))};this.addEventListener("completed",s),this.addEventListener("failure",o),this.addEventListener("idle",a),(h=t==null?void 0:t.signal)==null||h.addEventListener("abort",l);try{yield*r}finally{this.removeEventListener("completed",s),this.removeEventListener("failure",o),this.removeEventListener("idle",a),(d=t==null?void 0:t.signal)==null||d.removeEventListener("abort",l),i()}}}class Zre extends X${constructor(e={}){super({...e,sort:(t,r)=>t.options.priority>r.options.priority?-1:t.options.priority<r.options.priority?1:0})}}function Pf(n){const e=new globalThis.AbortController;function t(){e.abort();for(const s of n)(s==null?void 0:s.removeEventListener)!=null&&s.removeEventListener("abort",t)}for(const s of n){if((s==null?void 0:s.aborted)===!0){t();break}(s==null?void 0:s.addEventListener)!=null&&s.addEventListener("abort",t)}function r(){for(const s of n)(s==null?void 0:s.removeEventListener)!=null&&s.removeEventListener("abort",t)}const i=e.signal;return i.clear=r,i}function Qre(n){return/^127\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/i.test(n)||/^::1$/.test(n)}function Yk(n){if(!jD(n))return!1;const{address:e}=n.nodeAddress();return Qre(e)}function Jre(n,e){const t=Xm.exactMatch(n.multiaddr),r=Xm.exactMatch(e.multiaddr);if(t&&!r)return-1;if(!t&&r)return 1;const i=Tf.exactMatch(n.multiaddr),s=Tf.exactMatch(e.multiaddr);if(i&&!s)return-1;if(!i&&s)return 1;const o=If.exactMatch(n.multiaddr),a=If.exactMatch(e.multiaddr);if(o&&!a)return-1;if(!o&&a)return 1;const l=yk.exactMatch(n.multiaddr),c=yk.exactMatch(e.multiaddr);if(l&&!c)return-1;if(!l&&c)return 1;const h=gk.exactMatch(n.multiaddr),d=gk.exactMatch(e.multiaddr);if(h&&!d)return-1;if(!h&&d)return 1;const p=mk.exactMatch(n.multiaddr),g=mk.exactMatch(e.multiaddr);return p&&!g?-1:!p&&g?1:0}function ene(n,e){const t=Yk(n.multiaddr),r=Yk(e.multiaddr);return t&&!r?1:!t&&r?-1:0}function tne(n,e){const t=Af(n.multiaddr),r=Af(e.multiaddr);return t&&!r?1:!t&&r?-1:0}function rne(n,e){return n.isCertified&&!e.isCertified?-1:!n.isCertified&&e.isCertified?1:0}function nne(n,e){const t=V1.exactMatch(n.multiaddr),r=V1.exactMatch(e.multiaddr);return t&&!r?1:!t&&r?-1:0}function ine(n){return n.sort(Jre).sort(rne).sort(nne).sort(tne).sort(ene)}const Tp={maxParallelDials:Y$,maxDialQueueLength:G$,maxPeerAddrsToDial:V$,dialTimeout:K$};class sne{constructor(e,t={}){v(this,"queue");v(this,"components");v(this,"addressSorter");v(this,"maxPeerAddrsToDial");v(this,"maxDialQueueLength");v(this,"dialTimeout");v(this,"shutDownController");v(this,"connections");v(this,"log");this.addressSorter=t.addressSorter,this.maxPeerAddrsToDial=t.maxPeerAddrsToDial??Tp.maxPeerAddrsToDial,this.maxDialQueueLength=t.maxDialQueueLength??Tp.maxDialQueueLength,this.dialTimeout=t.dialTimeout??Tp.dialTimeout,this.connections=t.connections??new sd,this.log=e.logger.forComponent("libp2p:connection-manager:dial-queue"),this.components=e,this.shutDownController=new AbortController,this.shutDownController.signal;for(const[r,i]of Object.entries(t.resolvers??{}))qS.set(r,i);this.queue=new Zre({concurrency:t.maxParallelDials??Tp.maxParallelDials,metricName:"libp2p_dial_queue",metrics:e.metrics}),this.queue.addEventListener("error",r=>{var i;((i=r.detail)==null?void 0:i.name)!==yu.name&&this.log.error("error in dial queue - %e",r.detail)})}start(){this.shutDownController=new AbortController,this.shutDownController.signal}stop(){this.shutDownController.abort(),this.queue.abort()}async dial(e,t={}){var a,l,c;const{peerId:r,multiaddrs:i}=z$(e),s=Array.from(this.connections.values()).flat().find(h=>t.force===!0?!1:h.remotePeer.equals(r)?!0:i.find(d=>d.equals(h.remoteAddr)));if((s==null?void 0:s.status)==="open")return this.log("already connected to %a",s.remoteAddr),(a=t.onProgress)==null||a.call(t,new Jn("dial-queue:already-connected")),s;const o=this.queue.queue.find(h=>{if((r==null?void 0:r.equals(h.options.peerId))===!0)return!0;const d=h.options.multiaddrs;if(d==null)return!1;for(const p of i)if(d.has(p.toString()))return!0;return!1});if(o!=null){this.log("joining existing dial target for %p",r);for(const h of i)o.options.multiaddrs.add(h.toString());return(l=t.onProgress)==null||l.call(t,new Jn("dial-queue:already-in-dial-queue")),o.join(t)}if(this.queue.size>=this.maxDialQueueLength)throw new Ag("Dial queue is full");return this.log("creating dial target for %p",r,i.map(h=>h.toString())),(c=t.onProgress)==null||c.call(t,new Jn("dial-queue:add-to-dial-queue")),this.queue.add(async h=>{var p;(p=h.onProgress)==null||p.call(h,new Jn("dial-queue:start-dial"));const d=Pf([this.shutDownController.signal,h.signal]);try{return await this.dialPeer(h,d)}finally{d.clear()}},{peerId:r,priority:t.priority??Q$,multiaddrs:new Set(i.map(h=>h.toString())),signal:t.signal??AbortSignal.timeout(this.dialTimeout),onProgress:t.onProgress})}async dialPeer(e,t){var h;const r=e.peerId,i=e.multiaddrs,s=new Set;let o=e.multiaddrs.size===0,a=0,l=0;const c=[];for(this.log("starting dial to %p",r);o||i.size>0;){l++,o=!1;const d=[],p=new Set(e.multiaddrs);i.clear(),this.log("calculating addrs to dial %p from %s",r,[...p]);const g=await this.calculateMultiaddrs(r,p,{...e,signal:t});for(const m of g){if(s.has(m.multiaddr.toString())){this.log.trace("skipping previously failed multiaddr %a while dialing %p",m.multiaddr,r);continue}d.push(m)}this.log("%s dial to %p with %s",l===1?"starting":"continuing",r,d.map(m=>m.multiaddr.toString())),(h=e==null?void 0:e.onProgress)==null||h.call(e,new Jn("dial-queue:calculated-addresses",d));for(const m of d){if(a===this.maxPeerAddrsToDial)throw this.log("dialed maxPeerAddrsToDial (%d) addresses for %p, not trying any others",a,e.peerId),new Ag("Peer had more than maxPeerAddrsToDial");a++;try{const E=await this.components.transportManager.dial(m.multiaddr,{...e,signal:t});this.log("dial to %a succeeded",m.multiaddr);try{await this.components.peerStore.merge(E.remotePeer,{multiaddrs:[E.remoteAddr],metadata:{[Kre]:at(Date.now().toString())}})}catch(y){this.log.error("could not update last dial failure key for %p",r,y)}return E}catch(E){if(this.log.error("dial failed to %a",m.multiaddr,E),s.add(m.multiaddr.toString()),r!=null)try{await this.components.peerStore.merge(r,{metadata:{[zre]:at(Date.now().toString())}})}catch(y){this.log.error("could not update last dial failure key for %p",r,y)}if(t.aborted)throw new $L(E.message);c.push(E)}}}throw c.length===1?c[0]:new AggregateError(c,"All multiaddr dials failed")}async calculateMultiaddrs(e,t=new Set,r={}){var d,p;const i=[...t].map(g=>({multiaddr:Nt(g),isCertified:!1}));if(e!=null){if(this.components.peerId.equals(e))throw new Ag("Tried to dial self");if(await((p=(d=this.components.connectionGater).denyDialPeer)==null?void 0:p.call(d,e))===!0)throw new Vk("The dial request is blocked by gater.allowDialPeer");if(i.length===0){this.log("loading multiaddrs for %p",e);try{const g=await this.components.peerStore.get(e);i.push(...g.addresses),this.log("loaded multiaddrs for %p",e,i.map(({multiaddr:m})=>m.toString()))}catch(g){if(g.name!=="NotFoundError")throw g}}if(i.length===0){this.log("looking up multiaddrs for %p in the peer routing",e);try{const g=await this.components.peerRouting.findPeer(e,r);this.log("found multiaddrs for %p in the peer routing",e,i.map(({multiaddr:m})=>m.toString())),i.push(...g.multiaddrs.map(m=>({multiaddr:m,isCertified:!1})))}catch(g){g.name==="NoPeerRoutersError"?this.log("no peer routers configured",e):this.log.error("looking up multiaddrs for %p in the peer routing failed - %e",e,g)}}}let s=(await Promise.all(i.map(async g=>{const m=await Ure(g.multiaddr,{dns:this.components.dns,...r,log:this.log});return m.length===1&&m[0].equals(g.multiaddr)?g:m.map(E=>({multiaddr:E,isCertified:!1}))}))).flat();if(e!=null){const g=`/p2p/${e.toString()}`;s=s.map(m=>{const E=m.multiaddr.getComponents().pop();return(E==null?void 0:E.name)!=="p2p"?{multiaddr:m.multiaddr.encapsulate(g),isCertified:m.isCertified}:m})}const o=s.filter(g=>{if(this.components.transportManager.dialTransportForMultiaddr(g.multiaddr)==null)return!1;const m=g.multiaddr.getPeerId();return e!=null&&m!=null?e.equals(m):!0}),a=new Map;for(const g of o){const m=g.multiaddr.toString(),E=a.get(m);if(E!=null){E.isCertified=E.isCertified||g.isCertified||!1;continue}a.set(m,g)}const l=[...a.values()];if(l.length===0)throw new Ere("The dial request has no valid addresses");const c=[];for(const g of l)this.components.connectionGater.denyDialMultiaddr!=null&&await this.components.connectionGater.denyDialMultiaddr(g.multiaddr)||c.push(g);const h=this.addressSorter==null?ine(c):c.sort(this.addressSorter);if(h.length===0)throw new Vk("The connection gater denied all addresses in the dial request");return this.log.trace("addresses for %p before filtering",e??"unknown peer",s.map(({multiaddr:g})=>g.toString())),this.log.trace("addresses for %p after filtering",e??"unknown peer",h.map(({multiaddr:g})=>g.toString())),h}async isDialable(e,t={}){Array.isArray(e)||(e=[e]);try{const r=await this.calculateMultiaddrs(void 0,new Set(e.map(i=>i.toString())),t);return t.runOnLimitedConnection===!1?r.find(i=>!V1.matches(i.multiaddr))!=null:!0}catch(r){this.log.trace("error calculating if multiaddr(s) were dialable",r)}return!1}}class one extends X${has(e){return this.find(e)!=null}find(e){return this.queue.find(t=>e.equals(t.options.peerId))}}var Z$={};function qi(n,e){typeof e=="boolean"&&(e={forever:e}),this._originalTimeouts=JSON.parse(JSON.stringify(n)),this._timeouts=n,this._options=e||{},this._maxRetryTime=e&&e.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}var ane=qi;qi.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)};qi.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null};qi.prototype.retry=function(n){if(this._timeout&&clearTimeout(this._timeout),!n)return!1;var e=new Date().getTime();if(n&&e-this._operationStart>=this._maxRetryTime)return this._errors.push(n),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(n);var t=this._timeouts.shift();if(t===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),t=this._cachedTimeouts.slice(-1);else return!1;var r=this;return this._timer=setTimeout(function(){r._attempts++,r._operationTimeoutCb&&(r._timeout=setTimeout(function(){r._operationTimeoutCb(r._attempts)},r._operationTimeout),r._options.unref&&r._timeout.unref()),r._fn(r._attempts)},t),this._options.unref&&this._timer.unref(),!0};qi.prototype.attempt=function(n,e){this._fn=n,e&&(e.timeout&&(this._operationTimeout=e.timeout),e.cb&&(this._operationTimeoutCb=e.cb));var t=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){t._operationTimeoutCb()},t._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)};qi.prototype.try=function(n){console.log("Using RetryOperation.try() is deprecated"),this.attempt(n)};qi.prototype.start=function(n){console.log("Using RetryOperation.start() is deprecated"),this.attempt(n)};qi.prototype.start=qi.prototype.try;qi.prototype.errors=function(){return this._errors};qi.prototype.attempts=function(){return this._attempts};qi.prototype.mainError=function(){if(this._errors.length===0)return null;for(var n={},e=null,t=0,r=0;r<this._errors.length;r++){var i=this._errors[r],s=i.message,o=(n[s]||0)+1;n[s]=o,o>=t&&(e=i,t=o)}return e};(function(n){var e=ane;n.operation=function(t){var r=n.timeouts(t);return new e(r,{forever:t&&(t.forever||t.retries===1/0),unref:t&&t.unref,maxRetryTime:t&&t.maxRetryTime})},n.timeouts=function(t){if(t instanceof Array)return[].concat(t);var r={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var i in t)r[i]=t[i];if(r.minTimeout>r.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var s=[],o=0;o<r.retries;o++)s.push(this.createTimeout(o,r));return t&&t.forever&&!s.length&&s.push(this.createTimeout(o,r)),s.sort(function(a,l){return a-l}),s},n.createTimeout=function(t,r){var i=r.randomize?Math.random()+1:1,s=Math.round(i*Math.max(r.minTimeout,1)*Math.pow(r.factor,t));return s=Math.min(s,r.maxTimeout),s},n.wrap=function(t,r,i){if(r instanceof Array&&(i=r,r=null),!i){i=[];for(var s in t)typeof t[s]=="function"&&i.push(s)}for(var o=0;o<i.length;o++){var a=i[o],l=t[a];t[a]=(function(h){var d=n.operation(r),p=Array.prototype.slice.call(arguments,1),g=p.pop();p.push(function(m){d.retry(m)||(m&&(arguments[0]=d.mainError()),g.apply(this,arguments))}),d.attempt(function(){h.apply(t,p)})}).bind(t,l),t[a].options=r}}})(Z$);var lne=Z$;const cne=Yl(lne),une=Object.prototype.toString,hne=n=>une.call(n)==="[object Error]",fne=new Set(["network error","Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed","fetch failed","terminated"," A network error occurred.","Network connection lost"]);function dne(n){if(!(n&&hne(n)&&n.name==="TypeError"&&typeof n.message=="string"))return!1;const{message:t,stack:r}=n;return t==="Load failed"?r===void 0||"__sentry_captured__"in n:t.startsWith("error sending request for url")?!0:fne.has(t)}class pne extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,{message:e}=e):(this.originalError=new Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}}const Xk=(n,e,t)=>{const r=t.retries-(e-1);return n.attemptNumber=e,n.retriesLeft=r,n};async function gne(n,e){return new Promise((t,r)=>{e={...e},e.onFailedAttempt??(e.onFailedAttempt=()=>{}),e.shouldRetry??(e.shouldRetry=()=>!0),e.retries??(e.retries=10);const i=cne.operation(e),s=()=>{var a;i.stop(),r((a=e.signal)==null?void 0:a.reason)};e.signal&&!e.signal.aborted&&e.signal.addEventListener("abort",s,{once:!0});const o=()=>{var a;(a=e.signal)==null||a.removeEventListener("abort",s),i.stop()};i.attempt(async a=>{try{const l=await n(a);o(),t(l)}catch(l){try{if(!(l instanceof Error))throw new TypeError(`Non-error was thrown: "${l}". You should only throw errors.`);if(l instanceof pne)throw l.originalError;if(l instanceof TypeError&&!dne(l))throw l;if(Xk(l,a,e),await e.shouldRetry(l)||(i.stop(),r(l)),await e.onFailedAttempt(l),!i.retry(l))throw i.mainError()}catch(c){Xk(c,a,e),o(),r(c)}}})})}class mne{constructor(e,t={}){v(this,"log");v(this,"queue");v(this,"started");v(this,"peerStore");v(this,"retries");v(this,"retryInterval");v(this,"backoffFactor");v(this,"connectionManager");v(this,"events");this.log=e.logger.forComponent("libp2p:reconnect-queue"),this.peerStore=e.peerStore,this.connectionManager=e.connectionManager,this.queue=new one({concurrency:t.maxParallelReconnects??Wre,metricName:"libp2p_reconnect_queue",metrics:e.metrics}),this.started=!1,this.retries=t.retries??5,this.backoffFactor=t.backoffFactor,this.retryInterval=t.retryInterval,this.events=e.events,e.events.addEventListener("peer:disconnect",r=>{this.maybeReconnect(r.detail).catch(i=>{this.log.error("failed to maybe reconnect to %p - %e",r.detail,i)})})}async maybeReconnect(e){if(!this.started)return;const t=await this.peerStore.get(e);Zk(t)&&(this.queue.has(e)||this.queue.add(async r=>{await gne(async i=>{if(this.started)try{await this.connectionManager.openConnection(e,{signal:r==null?void 0:r.signal})}catch(s){throw this.log("reconnecting to %p attempt %d of %d failed - %e",e,i,this.retries,s),s}},{signal:r==null?void 0:r.signal,retries:this.retries,factor:this.backoffFactor,minTimeout:this.retryInterval})},{peerId:e}).catch(async r=>{this.log.error("failed to reconnect to %p - %e",e,r);const i={};[...t.tags.keys()].forEach(s=>{s.startsWith(TL)&&(i[s]=void 0)}),await this.peerStore.merge(e,{tags:i}),this.events.safeDispatchEvent("peer:reconnect-failure",{detail:e})}).catch(async r=>{this.log.error("failed to remove keep-alive tag from %p - %e",e,r)}))}start(){this.started=!0}async afterStart(){Promise.resolve().then(async()=>{const e=await this.peerStore.all({filters:[t=>Zk(t)]});await Promise.all(e.map(async t=>{await this.connectionManager.openConnection(t.id).catch(r=>{this.log.error(r)})}))}).catch(e=>{this.log.error(e)})}stop(){this.started=!1,this.queue.abort()}}function Zk(n){for(const e of n.tags.keys())if(e.startsWith(TL))return!0;return!1}const Q$=50,Iw={maxConnections:Vre,inboundConnectionThreshold:qre,maxIncomingPendingConnections:Hre};var JR;JR=Symbol.toStringTag;class yne{constructor(e,t={}){v(this,"started");v(this,"connections");v(this,"allow");v(this,"deny");v(this,"maxIncomingPendingConnections");v(this,"incomingPendingConnections");v(this,"outboundPendingConnections");v(this,"maxConnections");v(this,"dialQueue");v(this,"reconnectQueue");v(this,"connectionPruner");v(this,"inboundConnectionRateLimiter");v(this,"peerStore");v(this,"metrics");v(this,"events");v(this,"log");v(this,"peerId");v(this,JR,"@libp2p/connection-manager");var r;if(this.maxConnections=t.maxConnections??Iw.maxConnections,this.maxConnections<1)throw new rr("Connection Manager maxConnections must be greater than 0");this.connections=new sd,this.started=!1,this.peerId=e.peerId,this.peerStore=e.peerStore,this.metrics=e.metrics,this.events=e.events,this.log=e.logger.forComponent("libp2p:connection-manager"),this.onConnect=this.onConnect.bind(this),this.onDisconnect=this.onDisconnect.bind(this),this.allow=(t.allow??[]).map(i=>rE(i)),this.deny=(t.deny??[]).map(i=>rE(i)),this.incomingPendingConnections=0,this.maxIncomingPendingConnections=t.maxIncomingPendingConnections??Iw.maxIncomingPendingConnections,this.outboundPendingConnections=0,this.inboundConnectionRateLimiter=new YD({points:t.inboundConnectionThreshold??Iw.inboundConnectionThreshold,duration:1}),this.connectionPruner=new Fre({connectionManager:this,peerStore:e.peerStore,events:e.events,logger:e.logger},{allow:(r=t.allow)==null?void 0:r.map(i=>Nt(i))}),this.dialQueue=new sne(e,{addressSorter:t.addressSorter,maxParallelDials:t.maxParallelDials??Y$,maxDialQueueLength:t.maxDialQueueLength??G$,maxPeerAddrsToDial:t.maxPeerAddrsToDial??V$,dialTimeout:t.dialTimeout??K$,resolvers:t.resolvers??{dnsaddr:m$},connections:this.connections}),this.reconnectQueue=new mne({events:e.events,peerStore:e.peerStore,logger:e.logger,connectionManager:this},{retries:t.reconnectRetries,retryInterval:t.reconnectRetryInterval,backoffFactor:t.reconnectBackoffFactor,maxParallelReconnects:t.maxParallelReconnects})}async start(){var e,t,r;(e=this.metrics)==null||e.registerMetricGroup("libp2p_connection_manager_connections",{calculate:()=>{const i={inbound:0,"inbound pending":this.incomingPendingConnections,outbound:0,"outbound pending":this.outboundPendingConnections};for(const s of this.connections.values())for(const o of s)i[o.direction]++;return i}}),(t=this.metrics)==null||t.registerMetricGroup("libp2p_protocol_streams_total",{label:"protocol",calculate:()=>{const i={};for(const s of this.connections.values())for(const o of s)for(const a of o.streams){const l=`${a.direction} ${a.protocol??"unnegotiated"}`;i[l]=(i[l]??0)+1}return i}}),(r=this.metrics)==null||r.registerMetricGroup("libp2p_connection_manager_protocol_streams_per_connection_90th_percentile",{label:"protocol",calculate:()=>{const i={};for(const o of this.connections.values())for(const a of o){const l={};for(const c of a.streams){const h=`${c.direction} ${c.protocol??"unnegotiated"}`;l[h]=(l[h]??0)+1}for(const[c,h]of Object.entries(l))i[c]=i[c]??[],i[c].push(h)}const s={};for(let[o,a]of Object.entries(i)){a=a.sort((c,h)=>c-h);const l=Math.floor(a.length*.9);s[o]=a[l]}return s}}),this.events.addEventListener("connection:open",this.onConnect),this.events.addEventListener("connection:close",this.onDisconnect),await Rz(this.dialQueue,this.reconnectQueue,this.connectionPruner),this.started=!0,this.log("started")}async stop(){this.events.removeEventListener("connection:open",this.onConnect),this.events.removeEventListener("connection:close",this.onDisconnect),await Oz(this.reconnectQueue,this.dialQueue,this.connectionPruner);const e=[];for(const t of this.connections.values())for(const r of t)e.push((async()=>{try{await r.close()}catch(i){this.log.error(i)}})());this.log("closing %d connections",e.length),await Promise.all(e),this.connections.clear(),this.log("stopped")}getMaxConnections(){return this.maxConnections}setMaxConnections(e){if(this.maxConnections<1)throw new rr("Connection Manager maxConnections must be greater than 0");let t=!1;e<this.maxConnections&&(t=!0),this.maxConnections=e,t&&this.connectionPruner.maybePruneConnections()}onConnect(e){this._onConnect(e).catch(t=>{this.log.error(t)})}async _onConnect(e){const{detail:t}=e;if(!this.started){await t.close();return}if(t.status!=="open")return;const r=t.remotePeer,i=!this.connections.has(r),s=this.connections.get(r)??[];s.push(t),this.connections.set(r,s),r.publicKey!=null&&r.type==="RSA"&&await this.peerStore.patch(r,{publicKey:r.publicKey}),i&&this.events.safeDispatchEvent("peer:connect",{detail:t.remotePeer})}onDisconnect(e){const{detail:t}=e,r=t.remotePeer,s=(this.connections.get(r)??[]).filter(o=>o.id!==t.id);this.connections.set(r,s),s.length===0&&(this.log("onDisconnect remove all connections for peer %p",r),this.connections.delete(r),this.events.safeDispatchEvent("peer:disconnect",{detail:t.remotePeer}))}getConnections(e){if(e!=null)return this.connections.get(e)??[];let t=[];for(const r of this.connections.values())t=t.concat(r);return t}getConnectionsMap(){return this.connections}async openConnection(e,t={}){var r,i;if(!this.started)throw new pf("Not started");this.outboundPendingConnections++;try{(r=t.signal)==null||r.throwIfAborted();const{peerId:s}=z$(e);if(this.peerId.equals(s))throw new yS("Can not dial self");if(s!=null&&t.force!==!0){this.log("dial %p",s);const c=this.getConnections(s).find(h=>h.limits==null);if(c!=null)return this.log("had an existing non-limited connection to %p",s),(i=t.onProgress)==null||i.call(t,new Jn("dial-queue:already-connected")),c}const o=await this.dialQueue.dial(e,{...t,priority:t.priority??Q$});if(o.status!=="open")throw new mS("Remote closed connection during opening");let a=this.connections.get(o.remotePeer);a==null&&(a=[],this.connections.set(o.remotePeer,a));let l=!1;for(const c of a)if(c.id===o.id&&(l=!0),t.force!==!0&&c.id!==o.id&&c.remoteAddr.equals(o.remoteAddr))return o.abort(new bS("Duplicate multiaddr connection")),c;return l||a.push(o),o}finally{this.outboundPendingConnections--}}async closeConnections(e,t={}){const r=this.connections.get(e)??[];await Promise.all(r.map(async i=>{try{await i.close(t)}catch(s){i.abort(s)}}))}async acceptIncomingConnection(e){if(this.deny.some(i=>i.contains(e.remoteAddr.nodeAddress().address)))return this.log("connection from %a refused - connection remote address was in deny list",e.remoteAddr),!1;if(this.allow.some(i=>i.contains(e.remoteAddr.nodeAddress().address)))return this.incomingPendingConnections++,!0;if(this.incomingPendingConnections===this.maxIncomingPendingConnections)return this.log("connection from %a refused - incomingPendingConnections exceeded by host",e.remoteAddr),!1;if(e.remoteAddr.isThinWaistAddress()){const i=e.remoteAddr.nodeAddress().address;try{await this.inboundConnectionRateLimiter.consume(i,1)}catch{return this.log("connection from %a refused - inboundConnectionThreshold exceeded by host %s",e.remoteAddr,i),!1}}return this.getConnections().length<this.maxConnections?(this.incomingPendingConnections++,!0):(this.log("connection from %a refused - maxConnections exceeded",e.remoteAddr),!1)}afterUpgradeInbound(){this.incomingPendingConnections--}getDialQueue(){const e={queued:"queued",running:"active",errored:"error",complete:"success"};return this.dialQueue.queue.queue.map(t=>({id:t.id,status:e[t.status],peerId:t.options.peerId,multiaddrs:[...t.options.multiaddrs].map(r=>Nt(r))}))}async isDialable(e,t={}){return this.dialQueue.isDialable(e,t)}}class Tw{constructor(e){v(this,"movingAverage");v(this,"variance");v(this,"deviation");v(this,"forecast");v(this,"timeSpan");v(this,"previousTime");this.timeSpan=e,this.movingAverage=0,this.variance=0,this.deviation=0,this.forecast=0}alpha(e,t){return 1-Math.exp(-(e-t)/this.timeSpan)}push(e,t=Date.now()){if(this.previousTime!=null){const r=this.alpha(t,this.previousTime),i=e-this.movingAverage,s=r*i;this.movingAverage=r*e+(1-r)*this.movingAverage,this.variance=(1-r)*(this.variance+i*s),this.deviation=Math.sqrt(this.variance),this.forecast=this.movingAverage+r*i}else this.movingAverage=e;this.previousTime=t}}const bne=1.2,wne=2,vne=5e3,_ne=6e4,Ene=5e3;class Sne{constructor(e={}){v(this,"success");v(this,"failure");v(this,"next");v(this,"metric");v(this,"timeoutMultiplier");v(this,"failureMultiplier");v(this,"minTimeout");v(this,"maxTimeout");var r;const t=e.interval??Ene;this.success=new Tw(t),this.failure=new Tw(t),this.next=new Tw(t),this.failureMultiplier=e.failureMultiplier??wne,this.timeoutMultiplier=e.timeoutMultiplier??bne,this.minTimeout=e.minTimeout??vne,this.maxTimeout=e.maxTimeout??_ne,e.metricName!=null&&(this.metric=(r=e.metrics)==null?void 0:r.registerMetricGroup(e.metricName))}getTimeoutSignal(e={}){let t=Math.round(this.next.movingAverage*(e.timeoutFactor??this.timeoutMultiplier));t<this.minTimeout&&(t=this.minTimeout),t>this.maxTimeout&&(t=this.maxTimeout);const r=AbortSignal.timeout(t),i=Pf([e.signal,r]);return i.start=Date.now(),i.timeout=t,i}cleanUp(e){var r,i;const t=Date.now()-e.start;e.aborted?(this.failure.push(t),this.next.push(t*this.failureMultiplier),(r=this.metric)==null||r.update({failureMovingAverage:this.failure.movingAverage,failureDeviation:this.failure.deviation,failureForecast:this.failure.forecast,failureVariance:this.failure.variance,failure:t})):(this.success.push(t),this.next.push(t),(i=this.metric)==null||i.update({successMovingAverage:this.success.movingAverage,successDeviation:this.success.deviation,successForecast:this.success.forecast,successVariance:this.success.variance,success:t}))}}const Ane=1e4,xne="1.0.0",Ine="ping",Tne="ipfs",Qk=32,Cne=!0;var eO,tO;tO=Symbol.toStringTag,eO=bo;class kne{constructor(e,t={}){v(this,"protocol");v(this,"components");v(this,"log");v(this,"heartbeatInterval");v(this,"pingIntervalMs");v(this,"abortController");v(this,"timeout");v(this,"abortConnectionOnPingFailure");v(this,tO,"@libp2p/connection-monitor");v(this,eO,["@libp2p/connection-monitor"]);this.components=e,this.protocol=`/${t.protocolPrefix??Tne}/${Ine}/${xne}`,this.log=e.logger.forComponent("libp2p:connection-monitor"),this.pingIntervalMs=t.pingInterval??Ane,this.abortConnectionOnPingFailure=t.abortConnectionOnPingFailure??Cne,this.timeout=new Sne({...t.pingTimeout??{},metrics:e.metrics,metricName:"libp2p_connection_monitor_ping_time_milliseconds"})}start(){this.abortController=new AbortController,this.abortController.signal,this.heartbeatInterval=setInterval(()=>{this.components.connectionManager.getConnections().forEach(e=>{Promise.resolve().then(async()=>{var r;let t=Date.now();try{const i=this.timeout.getTimeoutSignal({signal:(r=this.abortController)==null?void 0:r.signal}),s=await e.newStream(this.protocol,{signal:i,runOnLimitedConnection:!0}),o=Bm(s);t=Date.now(),await Promise.all([o.write(BS(Qk),{signal:i}),o.read({bytes:Qk,signal:i})]),e.rtt=Date.now()-t,await o.unwrap().close({signal:i})}catch(i){if(i.name!=="UnsupportedProtocolError")throw i;e.rtt=(Date.now()-t)/2}}).catch(t=>{this.log.error("error during heartbeat",t),this.abortConnectionOnPingFailure?(this.log.error("aborting connection due to ping failure"),e.abort(t)):this.log("connection ping failed, but not aborting due to abortConnectionOnPingFailure flag")})})},this.pingIntervalMs)}stop(){var e;(e=this.abortController)==null||e.abort(),this.heartbeatInterval!=null&&clearInterval(this.heartbeatInterval)}}var rO;rO=Symbol.toStringTag;class Pne{constructor(e,t){v(this,"routers");v(this,"started");v(this,"components");v(this,rO,"@libp2p/content-routing");var r,i,s,o,a;this.routers=t.routers??[],this.started=!1,this.components=e,this.findProviders=((r=e.metrics)==null?void 0:r.traceFunction("libp2p.contentRouting.findProviders",this.findProviders.bind(this),{optionsIndex:1,getAttributesFromArgs:([l],c)=>({...c,cid:l.toString()}),getAttributesFromYieldedValue:(l,c)=>({...c,providers:[...Array.isArray(c.providers)?c.providers:[],l.id.toString()]})}))??this.findProviders,this.provide=((i=e.metrics)==null?void 0:i.traceFunction("libp2p.contentRouting.provide",this.provide.bind(this),{optionsIndex:1,getAttributesFromArgs:([l],c)=>({...c,cid:l.toString()})}))??this.provide,this.cancelReprovide=((s=e.metrics)==null?void 0:s.traceFunction("libp2p.contentRouting.cancelReprovide",this.cancelReprovide.bind(this),{optionsIndex:1,getAttributesFromArgs:([l],c)=>({...c,cid:l.toString()})}))??this.cancelReprovide,this.put=((o=e.metrics)==null?void 0:o.traceFunction("libp2p.contentRouting.put",this.put.bind(this),{optionsIndex:2,getAttributesFromArgs:([l])=>({key:mt(l,"base36")})}))??this.put,this.get=((a=e.metrics)==null?void 0:a.traceFunction("libp2p.contentRouting.get",this.get.bind(this),{optionsIndex:1,getAttributesFromArgs:([l])=>({key:mt(l,"base36")})}))??this.get}isStarted(){return this.started}async start(){this.started=!0}async stop(){this.started=!1}async*findProviders(e,t={}){if(this.routers.length===0)throw new xw("No content routers available");const r=this,i=new Zc;for await(const s of Cm(...r.routers.filter(o=>o.findProviders instanceof Function).map(o=>o.findProviders(e,t))))s!=null&&(s.multiaddrs.length>0&&await this.components.peerStore.merge(s.id,{multiaddrs:s.multiaddrs},t),!i.has(s.id)&&(i.add(s.id),yield s))}async provide(e,t={}){if(this.routers.length===0)throw new xw("No content routers available");await Promise.all(this.routers.filter(r=>r.provide instanceof Function).map(async r=>{await r.provide(e,t)}))}async cancelReprovide(e,t={}){if(this.routers.length===0)throw new xw("No content routers available");await Promise.all(this.routers.filter(r=>r.cancelReprovide instanceof Function).map(async r=>{await r.cancelReprovide(e,t)}))}async put(e,t,r){if(!this.isStarted())throw new pf;await Promise.all(this.routers.filter(i=>i.put instanceof Function).map(async i=>{await i.put(e,t,r)}))}async get(e,t){if(!this.isStarted())throw new pf;return Promise.any(this.routers.filter(r=>r.get instanceof Function).map(async r=>r.get(e,t)))}}var nO;nO=Symbol.toStringTag;class Rne{constructor(e,t={}){v(this,"log");v(this,"peerId");v(this,"peerStore");v(this,"routers");v(this,nO,"@libp2p/peer-routing");var r,i;this.log=e.logger.forComponent("libp2p:peer-routing"),this.peerId=e.peerId,this.peerStore=e.peerStore,this.routers=t.routers??[],this.findPeer=((r=e.metrics)==null?void 0:r.traceFunction("libp2p.peerRouting.findPeer",this.findPeer.bind(this),{optionsIndex:1,getAttributesFromArgs:([s],o)=>({...o,peer:s.toString()})}))??this.findPeer,this.getClosestPeers=((i=e.metrics)==null?void 0:i.traceFunction("libp2p.peerRouting.getClosestPeers",this.getClosestPeers.bind(this),{optionsIndex:1,getAttributesFromArgs:([s],o)=>({...o,key:mt(s,"base36")}),getAttributesFromYieldedValue:(s,o)=>({...o,peers:[...Array.isArray(o.peers)?o.peers:[],s.id.toString()]})}))??this.getClosestPeers}async findPeer(e,t){if(this.routers.length===0)throw new Kk("No peer routers available");if(e.toString()===this.peerId.toString())throw new yre("Should not try to find self");const r=this,i=Cm(...this.routers.filter(s=>s.findPeer instanceof Function).map(s=>async function*(){try{yield await s.findPeer(e,t)}catch(o){r.log.error(o)}}()));for await(const s of i)if(s!=null)return s.multiaddrs.length>0&&await this.peerStore.merge(s.id,{multiaddrs:s.multiaddrs},t),s;throw new v1}async*getClosestPeers(e,t={}){if(this.routers.length===0)throw new Kk("No peer routers available");const r=this,i=S$(1024);for await(const s of $Q(async function*(){const o=Cm(...r.routers.filter(a=>a.getClosestPeers instanceof Function).map(a=>a.getClosestPeers(e,t)));for await(let a of o)yield async()=>{if(a.multiaddrs.length===0)try{a=await r.findPeer(a.id,{...t,useCache:!1})}catch(l){r.log.error("could not find peer multiaddrs",l);return}return a}}()))s!=null&&(s.multiaddrs.length>0&&await this.peerStore.merge(s.id,{multiaddrs:s.multiaddrs},t),!i.has(s.id.toMultihash().bytes)&&(i.add(s.id.toMultihash().bytes),yield s))}}var iO,sO;class One extends(sO=Si,iO=Symbol.toStringTag,sO){constructor(t){super();v(this,"peerRouting");v(this,"log");v(this,"walking");v(this,"walkers");v(this,"shutdownController");v(this,"walkController");v(this,"needNext");v(this,iO,"@libp2p/random-walk");this.log=t.logger.forComponent("libp2p:random-walk"),this.peerRouting=t.peerRouting,this.walkers=0,this.walking=!1,this.shutdownController=new AbortController,this.shutdownController.signal}start(){this.shutdownController=new AbortController,this.shutdownController.signal}stop(){this.shutdownController.abort()}async*walk(t){var i,s;this.walking||this.startWalk(),this.walkers++;const r=Pf([this.shutdownController.signal,t==null?void 0:t.signal]);try{for(;;)(i=this.needNext)==null||i.resolve(),this.needNext=qr(),yield(await kl(this,"walk:peer",r,{errorEvent:"walk:error"})).detail}finally{r.clear(),this.walkers--,this.walkers===0&&((s=this.walkController)==null||s.abort(),this.walkController=void 0)}}startWalk(){this.walking=!0,this.walkController=new AbortController,this.walkController.signal;const t=Pf([this.walkController.signal,this.shutdownController.signal]),r=Date.now();let i=0;Promise.resolve().then(async()=>{for(this.log("start walk");this.walkers>0;)try{const s=BS(32);let o=Date.now();for await(const a of this.peerRouting.getClosestPeers(s,{signal:t}))t.aborted&&this.log("aborting walk"),t.throwIfAborted(),this.log("found peer %p after %dms for %d walkers",a.id,Date.now()-o,this.walkers),i++,this.safeDispatchEvent("walk:peer",{detail:a}),this.walkers===1&&this.needNext!=null&&(this.log("wait for need next"),await Un(this.needNext.promise,t)),o=Date.now();this.log("walk iteration for %b and %d walkers finished, found %d peers",s,this.walkers,i)}catch(s){this.log.error("random walk errored",s),this.safeDispatchEvent("walk:error",{detail:s})}this.log("no walkers left, ended walk")}).catch(s=>{this.log.error("random walk errored",s)}).finally(()=>{this.log("finished walk, found %d peers after %dms",i,Date.now()-r),this.walking=!1})}}const J$=32,eM=64;var oO;oO=Symbol.toStringTag;class Lne{constructor(e){v(this,"log");v(this,"topologies");v(this,"handlers");v(this,"components");v(this,oO,"@libp2p/registrar");var t;this.components=e,this.log=e.logger.forComponent("libp2p:registrar"),this.topologies=new Map,(t=e.metrics)==null||t.registerMetricGroup("libp2p_registrar_topologies",{calculate:()=>{const r={};for(const[i,s]of this.topologies)r[i]=s.size;return r}}),this.handlers=wo({name:"libp2p_registrar_protocol_handlers",metrics:e.metrics}),this._onDisconnect=this._onDisconnect.bind(this),this._onPeerUpdate=this._onPeerUpdate.bind(this),this._onPeerIdentify=this._onPeerIdentify.bind(this),this.components.events.addEventListener("peer:disconnect",this._onDisconnect),this.components.events.addEventListener("peer:update",this._onPeerUpdate),this.components.events.addEventListener("peer:identify",this._onPeerIdentify)}getProtocols(){return Array.from(new Set([...this.handlers.keys()])).sort()}getHandler(e){const t=this.handlers.get(e);if(t==null)throw new bre(`No handler registered for protocol ${e}`);return t}getTopologies(e){const t=this.topologies.get(e);return t==null?[]:[...t.values()]}async handle(e,t,r){if(this.handlers.has(e)&&(r==null?void 0:r.force)!==!0)throw new wre(`Handler already registered for protocol ${e}`);const i=n$.bind({ignoreUndefined:!0})({maxInboundStreams:J$,maxOutboundStreams:eM},r);this.handlers.set(e,{handler:t,options:i}),await this.components.peerStore.merge(this.components.peerId,{protocols:[e]},r)}async unhandle(e,t){(Array.isArray(e)?e:[e]).forEach(i=>{this.handlers.delete(i)}),await this.components.peerStore.patch(this.components.peerId,{protocols:this.getProtocols()},t)}async register(e,t){if(t==null)throw new rr("invalid topology");const r=`${(Math.random()*1e9).toString(36)}${Date.now()}`;let i=this.topologies.get(e);return i==null&&(i=new Map,this.topologies.set(e,i)),i.set(r,t),r}unregister(e){for(const[t,r]of this.topologies.entries())r.has(e)&&(r.delete(e),r.size===0&&this.topologies.delete(t))}_onDisconnect(e){const t=e.detail,r={signal:AbortSignal.timeout(5e3)};this.components.peerStore.get(t,r).then(i=>{var s,o,a;for(const l of i.protocols){const c=this.topologies.get(l);if(c!=null)for(const h of c.values())((s=h.filter)==null?void 0:s.has(t))!==!1&&((o=h.filter)==null||o.remove(t),(a=h.onDisconnect)==null||a.call(h,t))}}).catch(i=>{i.name!=="NotFoundError"&&this.log.error("could not inform topologies of disconnecting peer %p",t,i)})}_onPeerUpdate(e){var s,o,a;const{peer:t,previous:r}=e.detail,i=((r==null?void 0:r.protocols)??[]).filter(l=>!t.protocols.includes(l));for(const l of i){const c=this.topologies.get(l);if(c!=null)for(const h of c.values())((s=h.filter)==null?void 0:s.has(t.id))!==!1&&((o=h.filter)==null||o.remove(t.id),(a=h.onDisconnect)==null||a.call(h,t.id))}}_onPeerIdentify(e){var s,o,a;const t=e.detail.protocols,r=e.detail.connection,i=e.detail.peerId;for(const l of t){const c=this.topologies.get(l);if(c!=null)for(const h of c.values())r.limits!=null&&h.notifyOnLimitedConnection!==!0||((s=h.filter)==null?void 0:s.has(i))!==!0&&((o=h.filter)==null||o.add(i),(a=h.onConnect)==null||a.call(h,i,r))}}}var aO;aO=Symbol.toStringTag;class Nne{constructor(e,t={}){v(this,"log");v(this,"components");v(this,"transports");v(this,"listeners");v(this,"faultTolerance");v(this,"started");v(this,aO,"@libp2p/transport-manager");this.log=e.logger.forComponent("libp2p:transports"),this.components=e,this.started=!1,this.transports=wo({name:"libp2p_transport_manager_transports",metrics:this.components.metrics}),this.listeners=wo({name:"libp2p_transport_manager_listeners",metrics:this.components.metrics}),this.faultTolerance=t.faultTolerance??df.FATAL_ALL}add(e){const t=e[Symbol.toStringTag];if(t==null)throw new rr("Transport must have a valid tag");if(this.transports.has(t))throw new rr(`There is already a transport with the tag ${t}`);this.log("adding transport %s",t),this.transports.set(t,e),this.listeners.has(t)||this.listeners.set(t,[])}isStarted(){return this.started}start(){this.started=!0}async afterStart(){const e=this.components.addressManager.getListenAddrs();await this.listen(e)}async stop(){const e=[];for(const[t,r]of this.listeners)for(this.log("closing listeners for %s",t);r.length>0;){const i=r.pop();i!=null&&e.push(i.close())}await Promise.all(e),this.log("all listeners closed");for(const t of this.listeners.keys())this.listeners.set(t,[]);this.started=!1}async dial(e,t){var i;const r=this.dialTransportForMultiaddr(e);if(r==null)throw new xre(`No transport available for address ${String(e)}`);return(i=t==null?void 0:t.onProgress)==null||i.call(t,new Jn("transport-manager:selected-transport",r[Symbol.toStringTag])),r.dial(e,{...t,upgrader:this.components.upgrader})}getAddrs(){let e=[];for(const t of this.listeners.values())for(const r of t)e=[...e,...r.getAddrs()];return e}getTransports(){return Array.of(...this.transports.values())}getListeners(){return Array.of(...this.listeners.values()).flat()}dialTransportForMultiaddr(e){for(const t of this.transports.values())if(t.dialFilter([e]).length>0)return t}listenTransportForMultiaddr(e){for(const t of this.transports.values())if(t.listenFilter([e]).length>0)return t}async listen(e){if(!this.isStarted())throw new pf("Not started");if(e==null||e.length===0){this.log("no addresses were provided for listening, this node is dial only");return}const t={errors:new Map,ipv4:{success:0,attempts:0},ipv6:{success:0,attempts:0}};e.forEach(s=>{t.errors.set(s.toString(),new vre)});const r=[];for(const[s,o]of this.transports.entries()){const a=o.listenFilter(e);for(const l of a){this.log("creating listener for %s on %a",s,l);const c=o.createListener({upgrader:this.components.upgrader});let h=this.listeners.get(s)??[];h==null&&(h=[],this.listeners.set(s,h)),h.push(c),c.addEventListener("listening",()=>{this.components.events.safeDispatchEvent("transport:listening",{detail:c})}),c.addEventListener("close",()=>{const d=h.findIndex(p=>p===c);h.splice(d,1),this.components.events.safeDispatchEvent("transport:close",{detail:c})}),dk.matches(l)?t.ipv4.attempts++:pk.matches(l)&&t.ipv6.attempts++,r.push(c.listen(l).then(()=>{t.errors.delete(l.toString()),dk.matches(l)&&t.ipv4.success++,pk.matches(l)&&t.ipv6.success++},d=>{throw this.log.error("transport %s could not listen on address %a - %e",s,l,d),t.errors.set(l.toString(),d),d}))}}const i=await Promise.allSettled(r);if(!(i.length>0&&i.every(s=>s.status==="fulfilled"))){if(this.ipv6Unsupported(t)){this.log("all IPv4 addresses succeed but all IPv6 failed");return}if(this.faultTolerance===df.NO_FATAL){this.log("failed to listen on any address but fault tolerance allows this");return}throw new _re(`Some configured addresses failed to be listened on, you may need to remove one or more listen addresses from your configuration or set \`transportManager.faultTolerance\` to NO_FATAL:
${[...t.errors.entries()].map(([s,o])=>`
  ${s}: ${`${o.stack??o}`.split(`
`).join(`
  `)}
`).join("")}`)}}ipv6Unsupported(e){if(e.ipv4.attempts===0||e.ipv6.attempts===0)return!1;const t=e.ipv4.attempts===e.ipv4.success,r=e.ipv6.success===0;return t&&r}async remove(e){const t=this.listeners.get(e)??[];this.log.trace("removing transport %s",e);const r=[];for(this.log.trace("closing listeners for %s",e);t.length>0;){const i=t.pop();i!=null&&r.push(i.close())}await Promise.all(r),this.transports.delete(e),this.listeners.delete(e)}async removeAll(){const e=[];for(const t of this.transports.keys())e.push(this.remove(t));await Promise.all(e)}}const Zn="/multistream/1.0.0",lA=1024,Dne=at(`
`);async function Dh(n,e,t){await n.write(e,t)}async function $ne(n,e,t){await n.writeV(e,t)}async function Mne(n,e){const t=await n.read(e);if(t.byteLength===0||t.get(t.byteLength-1)!==Dne[0])throw e.log.error("Invalid mss message - missing newline",t),new is("Missing newline");return t.sublist(0,-1)}async function Qc(n,e){const t=await Mne(n,e);return mt(t.subarray())}async function Cw(n,e,t){if(e=Array.isArray(e)?[...e]:[e],e.length===1&&t.negotiateFully===!1)return Bne(n,e[0],t);const r=Iu(n,{...t,maxDataLength:lA}),i=e.shift();if(i==null)throw new Error("At least one protocol must be specified");t.log.trace('select: write ["%s", "%s"]',Zn,i);const s=at(`${Zn}
`),o=at(`${i}
`);await $ne(r,[s,o],t),t.log.trace("select: reading multistream-select header");let a=await Qc(r,t);if(t.log.trace('select: read "%s"',a),a===Zn&&(t.log.trace("select: reading protocol response"),a=await Qc(r,t),t.log.trace('select: read "%s"',a)),a===i)return{stream:r.unwrap(),protocol:i};for(const l of e){t.log.trace('select: write "%s"',l),await Dh(r,at(`${l}
`),t),t.log.trace("select: reading protocol response");const c=await Qc(r,t);if(t.log.trace('select: read "%s" for "%s"',c,l),c===l)return{stream:r.unwrap(),protocol:l}}throw new $y("protocol selection failed")}function Bne(n,e,t){const r=n.sink.bind(n),i=n.source;let s=!1,o=!1;const a=qr();let l=!1,c=!1;const h=qr();let d=!1,p=!1;const g=qr(),m=Iu({sink:r,source:i},{...t,maxDataLength:lA});n.sink=async b=>{const{sink:_}=m.unwrap();await _(async function*(){let I=!1;for await(const x of b){if(c&&await h.promise,l)yield x;else{c=!0,t.log.trace('optimistic: write ["%s", "%s", data(%d)] in sink',Zn,e,x.byteLength);const $=`${e}
`;yield new bt(Uint8Array.from([19]),at(`${Zn}
`),Ts($.length),at($),x).subarray(),t.log.trace('optimistic: wrote ["%s", "%s", data(%d)] in sink',Zn,e,x.byteLength),l=!0,c=!1,h.resolve(),E().catch(U=>{t.log.error("could not finish optimistic protocol negotiation of %s",e,U)})}I=!0}I||await E()}())};async function E(){if(o){t.log.trace("optimistic: already negotiating %s stream",e),await a.promise;return}o=!0;try{l||(t.log.trace("optimistic: doing send protocol for %s stream",e),await y()),d||(t.log.trace("optimistic: doing read protocol for %s stream",e),await S())}finally{o=!1,s=!0,a.resolve()}}async function y(){if(c){await h.promise;return}c=!0;try{t.log.trace('optimistic: write ["%s", "%s", data] in source',Zn,e),await m.writeV([at(`${Zn}
`),at(`${e}
`)]),t.log.trace('optimistic: wrote ["%s", "%s", data] in source',Zn,e)}finally{l=!0,c=!1,h.resolve()}}async function S(){if(p){await g.promise;return}p=!0;try{t.log.trace("optimistic: reading multistream select header");let b=await Qc(m,t);if(t.log.trace('optimistic: read multistream select header "%s"',b),b===Zn&&(b=await Qc(m,t)),t.log.trace('optimistic: read protocol "%s", expecting "%s"',b,e),b!==e)throw new $y("protocol selection failed")}finally{d=!0,p=!1,g.resolve()}}if(n.source=async function*(){await E(),t.log.trace('optimistic: reading data from "%s" stream',e),yield*m.unwrap().source}(),n.closeRead!=null){const b=n.closeRead.bind(n);n.closeRead=async _=>{s||await E().catch(I=>{t.log.error("could not negotiate protocol before close read",I)}),await b(_)}}if(n.closeWrite!=null){const b=n.closeWrite.bind(n);n.closeWrite=async _=>{s||await E().catch(I=>{t.log.error("could not negotiate protocol before close write",I)}),await b(_)}}if(n.close!=null){const b=n.close.bind(n);n.close=async _=>{const I=[];c&&I.push(h.promise),p&&I.push(g.promise),I.length>0?await Un(Promise.all(I),_==null?void 0:_.signal):(s=!0,o=!1,a.resolve()),await b(_)}}return{stream:n,protocol:e}}async function kw(n,e,t){e=Array.isArray(e)?e:[e],t.log.trace("handle: available protocols %s",e);const r=Iu(n,{...t,maxDataLength:lA,maxLengthLength:2});for(;;){t.log.trace("handle: reading incoming string");const i=await Qc(r,t);if(t.log.trace('handle: read "%s"',i),i===Zn){t.log.trace('handle: respond with "%s" for "%s"',Zn,i),await Dh(r,at(`${Zn}
`),t),t.log.trace('handle: responded with "%s" for "%s"',Zn,i);continue}if(e.includes(i))return t.log.trace('handle: respond with "%s" for "%s"',i,i),await Dh(r,at(`${i}
`),t),t.log.trace('handle: responded with "%s" for "%s"',i,i),{stream:r.unwrap(),protocol:i};if(i==="ls"){const s=new bt(...e.map(o=>zS.single(at(`${o}
`))),at(`
`));t.log.trace('handle: respond with "%s" for %s',e,i),await Dh(r,s,t),t.log.trace('handle: responded with "%s" for %s',e,i);continue}t.log.trace('handle: respond with "na" for "%s"',i),await Dh(r,at(`na
`),t),t.log('handle: responded with "na" for "%s"',i)}}const Une=500;var lO,cO;cO=Symbol.toStringTag,lO=Iz;class Fne{constructor(e){v(this,"id");v(this,"remoteAddr");v(this,"remotePeer");v(this,"direction");v(this,"timeline");v(this,"multiplexer");v(this,"encryption");v(this,"status");v(this,"limits");v(this,"log");v(this,"tags");v(this,"_newStream");v(this,"_close");v(this,"_abort");v(this,"_getStreams");v(this,cO,"Connection");v(this,lO,!0);const{remoteAddr:t,remotePeer:r,newStream:i,close:s,abort:o,getStreams:a}=e;this.id=`${parseInt(String(Math.random()*1e9)).toString(36)}${Date.now()}`,this.remoteAddr=t,this.remotePeer=r,this.direction=e.direction,this.status="open",this.timeline=e.timeline,this.multiplexer=e.multiplexer,this.encryption=e.encryption,this.limits=e.limits,this.log=e.logger.forComponent(`libp2p:connection:${this.direction}:${this.id}`),this.remoteAddr.getPeerId()==null&&(this.remoteAddr=this.remoteAddr.encapsulate(`/p2p/${this.remotePeer}`)),this._newStream=i,this._close=s,this._abort=o,this._getStreams=a,this.tags=[]}get streams(){return this._getStreams()}async newStream(e,t){if(this.status==="closing")throw new kL("the connection is being closed");if(this.status==="closed")throw new mS("the connection is closed");if(Array.isArray(e)||(e=[e]),this.limits!=null&&(t==null?void 0:t.runOnLimitedConnection)!==!0)throw new wS("Cannot open protocol stream on limited connection");const r=await this._newStream(e,t);return r.direction="outbound",r}async close(e={}){if(!(this.status==="closed"||this.status==="closing")){if(this.log("closing connection to %a",this.remoteAddr),this.status="closing",e.signal==null){const t=AbortSignal.timeout(Une);e={...e,signal:t}}try{this.log.trace("closing underlying transport"),await this._close(e),this.log.trace("updating timeline with close time"),this.status="closed",this.timeline.close=Date.now()}catch(t){this.log.error("error encountered during graceful close of connection to %a",this.remoteAddr,t),this.abort(t)}}}abort(e){this.status!=="closed"&&(this.log.error("aborting connection to %a due to error",this.remoteAddr,e),this.status="closing",this._abort(e),this.status="closed",this.timeline.close=Date.now())}}function jne(n){return new Fne(n)}function qne(n,e){try{const{options:t}=e.getHandler(n);return t.maxInboundStreams}catch(t){if(t.name!=="UnhandledProtocolError")throw t}return J$}function Hne(n,e,t={}){try{const{options:r}=e.getHandler(n);if(r.maxOutboundStreams!=null)return r.maxOutboundStreams}catch(r){if(r.name!=="UnhandledProtocolError")throw r}return t.maxOutboundStreams??eM}function Jk(n,e,t){let r=0;return t.streams.forEach(i=>{i.direction===e&&i.protocol===n&&r++}),r}var uO;uO=Symbol.toStringTag;class Wne{constructor(e,t){v(this,"components");v(this,"connectionEncrypters");v(this,"streamMuxers");v(this,"inboundUpgradeTimeout");v(this,"inboundStreamProtocolNegotiationTimeout");v(this,"outboundStreamProtocolNegotiationTimeout");v(this,"events");v(this,"metrics");v(this,uO,"@libp2p/upgrader");var r,i,s,o;this.components=e,this.connectionEncrypters=wo({name:"libp2p_upgrader_connection_encrypters",metrics:this.components.metrics}),t.connectionEncrypters.forEach(a=>{this.connectionEncrypters.set(a.protocol,a)}),this.streamMuxers=wo({name:"libp2p_upgrader_stream_multiplexers",metrics:this.components.metrics}),t.streamMuxers.forEach(a=>{this.streamMuxers.set(a.protocol,a)}),this.inboundUpgradeTimeout=t.inboundUpgradeTimeout??jre,this.inboundStreamProtocolNegotiationTimeout=t.inboundStreamProtocolNegotiationTimeout??Gk,this.outboundStreamProtocolNegotiationTimeout=t.outboundStreamProtocolNegotiationTimeout??Gk,this.events=e.events,this.metrics={dials:(r=e.metrics)==null?void 0:r.registerCounterGroup("libp2p_connection_manager_dials_total"),errors:(i=e.metrics)==null?void 0:i.registerCounterGroup("libp2p_connection_manager_dial_errors_total"),inboundErrors:(s=e.metrics)==null?void 0:s.registerCounterGroup("libp2p_connection_manager_dials_inbound_errors_total"),outboundErrors:(o=e.metrics)==null?void 0:o.registerCounterGroup("libp2p_connection_manager_dials_outbound_errors_total")}}async shouldBlockConnection(e,...t){const r=this.components.connectionGater[e];if(r==null)return;if(await r.apply(this.components.connectionGater,t)===!0)throw new Sre(`The multiaddr connection is blocked by gater.${e}`)}createInboundAbortSignal(e){return Pf([AbortSignal.timeout(this.inboundUpgradeTimeout),e])}async upgradeInbound(e,t){var s,o,a;let r=!1;const i=this.createInboundAbortSignal(t.signal);try{if((s=this.metrics.dials)==null||s.increment({inbound:!0}),r=await Un(this.components.connectionManager.acceptIncomingConnection(e),i),!r)throw new Are("Connection denied");await Un(this.shouldBlockConnection("denyInboundConnection",e),i),await this._performUpgrade(e,"inbound",{...t,signal:i})}catch(l){throw(o=this.metrics.errors)==null||o.increment({inbound:!0}),(a=this.metrics.inboundErrors)==null||a.increment({[l.name??"Error"]:!0}),l}finally{i.clear(),r&&this.components.connectionManager.afterUpgradeInbound()}}async upgradeOutbound(e,t){var r,i,s;try{(r=this.metrics.dials)==null||r.increment({outbound:!0});const o=e.remoteAddr.getPeerId();let a;o!=null&&(a=Cs(o),await Un(this.shouldBlockConnection("denyOutboundConnection",a,e),t.signal));let l="outbound";return t.initiator===!1&&(l="inbound"),await this._performUpgrade(e,l,t)}catch(o){throw(i=this.metrics.errors)==null||i.increment({outbound:!0}),(s=this.metrics.outboundErrors)==null||s.increment({[o.name??"Error"]:!0}),o}}async _performUpgrade(e,t,r){var h,d,p;let i,s,o,a,l;(h=this.components.metrics)==null||h.trackMultiaddrConnection(e),e.log.trace("starting the %s connection upgrade",t);let c=e;if((r==null?void 0:r.skipProtection)!==!0){const g=this.components.connectionProtector;g!=null&&(e.log("protecting the %s connection",t),c=await g.protect(e,r))}try{if(i=c,(r==null?void 0:r.skipEncryption)!==!0){(d=r==null?void 0:r.onProgress)==null||d.call(r,new Jn(`upgrader:encrypt-${t}-connection`)),{conn:i,remotePeer:s,protocol:l,streamMuxer:a}=await(t==="inbound"?this._encryptInbound(c,r):this._encryptOutbound(c,r));const g={...c,...i};await this.shouldBlockConnection(t==="inbound"?"denyInboundEncryptedConnection":"denyOutboundEncryptedConnection",s,g)}else{const g=e.remoteAddr.getPeerId();if(g==null)throw new bS(`${t} connection that skipped encryption must have a peer id`);const m=Cs(g);l="native",s=m}if(s.equals(this.components.peerId)){const g=new yS("Can not dial self");throw e.abort(g),g}if(o=i,(r==null?void 0:r.muxerFactory)!=null)a=r.muxerFactory;else if(a==null&&this.streamMuxers.size>0){(p=r==null?void 0:r.onProgress)==null||p.call(r,new Jn(`upgrader:multiplex-${t}-connection`));const g=await(t==="inbound"?this._multiplexInbound({...c,...i},this.streamMuxers,r):this._multiplexOutbound({...c,...i},this.streamMuxers,r));a=g.muxerFactory,o=g.stream}}catch(g){throw e.log.error("failed to upgrade inbound connection %s %a - %e",t==="inbound"?"from":"to",e.remoteAddr,g),g}return await this.shouldBlockConnection(t==="inbound"?"denyInboundUpgradedConnection":"denyOutboundUpgradedConnection",s,e),e.log("successfully upgraded %s connection",t),this._createConnection({cryptoProtocol:l,direction:t,maConn:e,upgradedConn:o,muxerFactory:a,remotePeer:s,limits:r==null?void 0:r.limits})}_createConnection(e){const{cryptoProtocol:t,direction:r,maConn:i,upgradedConn:s,remotePeer:o,muxerFactory:a,limits:l}=e;let c,h,d;a!=null&&(c=a.createStreamMuxer({direction:r,onIncomingStream:m=>{if(d==null)return;const E=AbortSignal.timeout(this.inboundStreamProtocolNegotiationTimeout);Promise.resolve().then(async()=>{var x;const y=this.components.registrar.getProtocols(),{stream:S,protocol:b}=await kw(m,y,{signal:E,log:m.log,yieldBytes:!1});if(d==null)return;d.log("incoming stream opened on %s",b);const _=qne(b,this.components.registrar);if(Jk(b,"inbound",d)===_){const $=new ML(`Too many inbound protocol streams for protocol "${b}" - limit ${_}`);throw m.abort($),$}m.source=S.source,m.sink=S.sink,m.protocol=b,S.closeWrite!=null&&(m.closeWrite=S.closeWrite),S.closeRead!=null&&(m.closeRead=S.closeRead),S.close!=null&&(m.close=S.close),await this.components.peerStore.merge(o,{protocols:[b]},{signal:E}),(x=this.components.metrics)==null||x.trackProtocolStream(m,d),this._onStream({connection:d,stream:m,protocol:b})}).catch(async y=>{d.log.error("error handling incoming stream id %s - %e",m.id,y),m.timeline.close==null&&await m.close({signal:E}).catch(S=>m.abort(S))})}}),h=async(m,E={})=>{var S;if(c==null)throw new xp("Connection is not multiplexed");d.log.trace("starting new stream for protocols %s",m);const y=await c.newStream();d.log.trace("started new stream %s for protocols %s",y.id,m);try{if(E.signal==null){y.log("no abort signal was passed while trying to negotiate protocols %s falling back to default timeout",m);const $=AbortSignal.timeout(this.outboundStreamProtocolNegotiationTimeout);E={...E,signal:$}}y.log.trace("selecting protocol from protocols %s",m);const{stream:b,protocol:_}=await Cw(y,m,{...E,log:y.log,yieldBytes:!0});y.log.trace("selected protocol %s",_);const I=Hne(_,this.components.registrar,E),x=Jk(_,"outbound",d);if(x>=I){const $=new vS(`Too many outbound protocol streams for protocol "${_}" - ${x}/${I}`);throw y.abort($),$}return await this.components.peerStore.merge(o,{protocols:[_]}),y.source=b.source,y.sink=b.sink,y.protocol=_,b.closeWrite!=null&&(y.closeWrite=b.closeWrite),b.closeRead!=null&&(y.closeRead=b.closeRead),b.close!=null&&(y.close=b.close),(S=this.components.metrics)==null||S.trackProtocolStream(y,d),y}catch(b){throw d.log.error("could not create new outbound stream on connection %s %a for protocols %s - %e",r==="inbound"?"from":"to",e.maConn.remoteAddr,m,b),y.timeline.close==null&&y.abort(b),b}},Promise.all([c.sink(s.source),s.sink(c.source)]).catch(m=>{d.log.error("error piping data through muxer - %e",m)}));const p=i.timeline;i.timeline=new Proxy(p,{set:(...m)=>(m[1]==="close"&&m[2]!=null&&p.close==null&&(async()=>{try{d.status==="open"&&await d.close()}catch(E){d.log.error("error closing connection after timeline close %e",E)}finally{this.events.safeDispatchEvent("connection:close",{detail:d})}})().catch(E=>{d.log.error("error thrown while dispatching connection:close event %e",E)}),Reflect.set(...m))}),i.timeline.upgraded=Date.now();const g=()=>{throw new xp("Connection is not multiplexed")};return d=jne({remoteAddr:i.remoteAddr,remotePeer:o,status:"open",direction:r,timeline:i.timeline,multiplexer:c==null?void 0:c.protocol,encryption:t,limits:l,logger:this.components.logger,newStream:h??g,getStreams:()=>(c==null?void 0:c.streams)??[],close:async m=>{await(c==null?void 0:c.close(m)),await i.close(m)},abort:m=>{i.abort(m),c==null||c.abort(m)}}),this.events.safeDispatchEvent("connection:open",{detail:d}),d.__maConnTimeline=p,d}_onStream(e){const{connection:t,stream:r,protocol:i}=e,{handler:s,options:o}=this.components.registrar.getHandler(i);if(t.limits!=null&&o.runOnLimitedConnection!==!0)throw new wS("Cannot open protocol stream on limited connection");s({connection:t,stream:r})}async _encryptInbound(e,t){const r=Array.from(this.connectionEncrypters.keys());try{const{stream:i,protocol:s}=await kw(e,r,{...t,log:e.log}),o=this.connectionEncrypters.get(s);if(o==null)throw new Ip(`no crypto module found for ${s}`);return e.log("encrypting inbound connection to %a using %s",e.remoteAddr,s),{...await o.secureInbound(i,t),protocol:s}}catch(i){throw e.log.error("encrypting inbound connection from %a failed",e.remoteAddr,i),new Ip(i.message)}}async _encryptOutbound(e,t){const r=Array.from(this.connectionEncrypters.keys());try{e.log.trace("selecting encrypter from %s",r);const{stream:i,protocol:s}=await Cw(e,r,{...t,log:e.log,yieldBytes:!0}),o=this.connectionEncrypters.get(s);if(o==null)throw new Ip(`no crypto module found for ${s}`);return e.log("encrypting outbound connection to %a using %s",e.remoteAddr,s),{...await o.secureOutbound(i,t),protocol:s}}catch(i){throw e.log.error("encrypting outbound connection to %a failed",e.remoteAddr,i),new Ip(i.message)}}async _multiplexOutbound(e,t,r){const i=Array.from(t.keys());e.log("outbound selecting muxer %s",i);try{e.log.trace("selecting stream muxer from %s",i);const{stream:s,protocol:o}=await Cw(e,i,{...r,log:e.log,yieldBytes:!0});e.log("selected %s as muxer protocol",o);const a=t.get(o);return{stream:s,muxerFactory:a}}catch(s){throw e.log.error("error multiplexing outbound connection",s),new xp(String(s))}}async _multiplexInbound(e,t,r){const i=Array.from(t.keys());e.log("inbound handling muxers %s",i);try{const{stream:s,protocol:o}=await kw(e,i,{...r,log:e.log}),a=t.get(o);return{stream:s,muxerFactory:a}}catch(s){throw e.log.error("error multiplexing inbound connection",s),new xp(String(s))}}getConnectionEncrypters(){return this.connectionEncrypters}getStreamMuxers(){return this.streamMuxers}}const tM="2.8.11",rM="js-libp2p";function zne(n,e){return`${n??rM}/${e??tM} browser/${globalThis.navigator.userAgent}`}var Ff,nE;class Kne extends Si{constructor(t){var h,d,p,g,m,E,y,S,b,_,I,x;super();Qe(this,Ff);v(this,"peerId");v(this,"peerStore");v(this,"contentRouting");v(this,"peerRouting");v(this,"metrics");v(this,"services");v(this,"logger");v(this,"status");v(this,"components");v(this,"log");this.status="stopped";const r=new Si,i=r.dispatchEvent.bind(r);r.dispatchEvent=$=>{const U=i($),O=this.dispatchEvent(new CustomEvent($.type,{detail:$.detail}));return U||O},this.peerId=t.peerId,this.logger=t.logger??b$(),this.log=this.logger.forComponent("libp2p"),this.services={};const s=((h=t.nodeInfo)==null?void 0:h.name)??rM,o=((d=t.nodeInfo)==null?void 0:d.version)??tM,a=this.components=kre({peerId:t.peerId,privateKey:t.privateKey,nodeInfo:{name:s,version:o,userAgent:((p=t.nodeInfo)==null?void 0:p.userAgent)??zne(s,o)},logger:this.logger,events:r,datastore:t.datastore??new Zte,connectionGater:$re(t.connectionGater),dns:t.dns});t.metrics!=null&&(this.metrics=this.configureComponent("metrics",t.metrics(this.components))),this.peerStore=this.configureComponent("peerStore",zte(a,{addressFilter:this.components.connectionGater.filterMultiaddrForPeer,...t.peerStore})),a.events.addEventListener("peer:update",$=>{if($.detail.previous==null){const U={id:$.detail.peer.id,multiaddrs:$.detail.peer.addresses.map(O=>O.multiaddr)};a.events.safeDispatchEvent("peer:discovery",{detail:U})}}),t.connectionProtector!=null&&this.configureComponent("connectionProtector",t.connectionProtector(a)),this.components.upgrader=new Wne(this.components,{connectionEncrypters:(t.connectionEncrypters??[]).map(($,U)=>this.configureComponent(`connection-encryption-${U}`,$(this.components))),streamMuxers:(t.streamMuxers??[]).map(($,U)=>this.configureComponent(`stream-muxers-${U}`,$(this.components))),inboundUpgradeTimeout:(g=t.connectionManager)==null?void 0:g.inboundUpgradeTimeout,inboundStreamProtocolNegotiationTimeout:((m=t.connectionManager)==null?void 0:m.inboundStreamProtocolNegotiationTimeout)??((E=t.connectionManager)==null?void 0:E.protocolNegotiationTimeout),outboundStreamProtocolNegotiationTimeout:((y=t.connectionManager)==null?void 0:y.outboundStreamProtocolNegotiationTimeout)??((S=t.connectionManager)==null?void 0:S.protocolNegotiationTimeout)}),this.configureComponent("transportManager",new Nne(this.components,t.transportManager)),this.configureComponent("connectionManager",new yne(this.components,t.connectionManager)),((b=t.connectionMonitor)==null?void 0:b.enabled)!==!1&&this.configureComponent("connectionMonitor",new kne(this.components,t.connectionMonitor)),this.configureComponent("registrar",new Lne(this.components)),this.configureComponent("addressManager",new pre(this.components,t.addresses));const l=(t.peerRouters??[]).map(($,U)=>this.configureComponent(`peer-router-${U}`,$(this.components)));this.peerRouting=this.components.peerRouting=this.configureComponent("peerRouting",new Rne(this.components,{routers:l}));const c=(t.contentRouters??[]).map(($,U)=>this.configureComponent(`content-router-${U}`,$(this.components)));if(this.contentRouting=this.components.contentRouting=this.configureComponent("contentRouting",new Pne(this.components,{routers:c})),this.configureComponent("randomWalk",new One(this.components)),(t.peerDiscovery??[]).forEach(($,U)=>{this.configureComponent(`peer-discovery-${U}`,$(this.components)).addEventListener("peer",P=>{Pe(this,Ff,nE).call(this,P)})}),(_=t.transports)==null||_.forEach(($,U)=>{this.components.transportManager.add(this.configureComponent(`transport-${U}`,$(this.components)))}),t.services!=null)for(const $ of Object.keys(t.services)){const U=t.services[$],O=U(this.components);if(O==null){this.log.error("service factory %s returned null or undefined instance",$);continue}this.services[$]=O,this.configureComponent($,O),O[nC]!=null&&(this.log("registering service %s for content routing",$),c.push(O[nC])),O[iC]!=null&&(this.log("registering service %s for peer routing",$),l.push(O[iC])),O[ff]!=null&&(this.log("registering service %s for peer discovery",$),(x=(I=O[ff]).addEventListener)==null||x.call(I,"peer",P=>{Pe(this,Ff,nE).call(this,P)}))}Pre(a)}configureComponent(t,r){return r==null&&this.log.error("component %s was null or undefined",t),this.components[t]=r,r}async start(){var t,r,i,s;if(this.status==="stopped"){this.status="starting",this.log("libp2p is starting");try{await((r=(t=this.components).beforeStart)==null?void 0:r.call(t)),await this.components.start(),await((s=(i=this.components).afterStart)==null?void 0:s.call(i)),this.status="started",this.safeDispatchEvent("start",{detail:this}),this.log("libp2p has started")}catch(o){throw this.log.error("An error occurred starting libp2p",o),this.status="started",await this.stop(),o}}}async stop(){var t,r,i,s;this.status==="started"&&(this.log("libp2p is stopping"),this.status="stopping",await((r=(t=this.components).beforeStop)==null?void 0:r.call(t)),await this.components.stop(),await((s=(i=this.components).afterStop)==null?void 0:s.call(i)),this.status="stopped",this.safeDispatchEvent("stop",{detail:this}),this.log("libp2p has stopped"))}getConnections(t){return this.components.connectionManager.getConnections(t)}getDialQueue(){return this.components.connectionManager.getDialQueue()}getPeers(){const t=new Zc;for(const r of this.components.connectionManager.getConnections())t.add(r.remotePeer);return Array.from(t)}async dial(t,r={}){return this.components.connectionManager.openConnection(t,{priority:75,...r})}async dialProtocol(t,r,i={}){if(r==null)throw new rr("no protocols were provided to open a stream");if(r=Array.isArray(r)?r:[r],r.length===0)throw new rr("no protocols were provided to open a stream");return(await this.dial(t,i)).newStream(r,i)}getMultiaddrs(){return this.components.addressManager.getAddresses()}getProtocols(){return this.components.registrar.getProtocols()}async hangUp(t,r={}){Gy(t)&&(t=Cs(t.getPeerId()??"")),await this.components.connectionManager.closeConnections(t,r)}async getPublicKey(t,r={}){if(this.log("getPublicKey %p",t),t.publicKey!=null)return t.publicKey;try{const a=await this.peerStore.get(t,r);if(a.id.publicKey!=null)return a.id.publicKey}catch(a){if(a.name!=="NotFoundError")throw a}const i=Dl([at("/pk/"),t.toMultihash().bytes]),s=await this.contentRouting.get(i,r),o=Ea(s);return await this.peerStore.patch(t,{publicKey:o},r),o}async handle(t,r,i){Array.isArray(t)||(t=[t]),await Promise.all(t.map(async s=>{await this.components.registrar.handle(s,r,i)}))}async unhandle(t,r){Array.isArray(t)||(t=[t]),await Promise.all(t.map(async i=>{await this.components.registrar.unhandle(i,r)}))}async register(t,r,i){return this.components.registrar.register(t,r,i)}unregister(t){this.components.registrar.unregister(t)}async isDialable(t,r={}){return this.components.connectionManager.isDialable(t,r)}}Ff=new WeakSet,nE=function(t){const{detail:r}=t;if(r.id.toString()===this.peerId.toString()){this.log.error("peer discovery mechanism discovered self");return}this.components.peerStore.merge(r.id,{multiaddrs:r.multiaddrs}).catch(i=>{this.log.error(i)})};async function Vne(n={}){n.privateKey??(n.privateKey=await gG());const e=new Kne({...await qee(n),peerId:vG(n.privateKey)});return n.start!==!1&&await e.start(),e}function eP(){var n;try{return((n=process==null?void 0:process.env)==null?void 0:n.NODE_ENV)==="test"}catch{return!1}}const tP={SANDBOX:"enrtree://AIRVQ5DDA4FFWLRBCHJWUWOO6X6S4ZTZ5B667LQ6AJU6PEYDLRD5O@sandbox.waku.nodes.status.im",TEST:"enrtree://AOGYWMBYOUIMOENHXCHILPKY3ZRFEULMFI4DOM442QSZ73TT2A7VI@test.waku.nodes.status.im"},rP=Yn.BOOTSTRAP,Gne=50,Yne=1e8,Ng="Invalid record id",ry=2,Xne={},Zne=Object.freeze(Object.defineProperty({__proto__:null,default:Xne},Symbol.toStringTag,{value:"Module"}));/*! noble-secp256k1 - MIT License (c) 2019 Paul Miller (paulmillr.com) */const Mt=BigInt(0),vr=BigInt(1),pa=BigInt(2),Zh=BigInt(3),nP=BigInt(8),Lr=Object.freeze({a:Mt,b:BigInt(7),P:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),n:BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),h:vr,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee")}),iP=(n,e)=>(n+e/pa)/e,Cp={beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar(n){const{n:e}=Lr,t=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-vr*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),i=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=t,o=BigInt("0x100000000000000000000000000000000"),a=iP(s*n,e),l=iP(-r*n,e);let c=Xe(n-a*t-l*i,e),h=Xe(-a*r-l*s,e);const d=c>o,p=h>o;if(d&&(c=e-c),p&&(h=e-h),c>o||h>o)throw new Error("splitScalarEndo: Endomorphism failed, k="+n);return{k1neg:d,k1:c,k2neg:p,k2:h}}},os=32,$u=32,Qne=32,sP=os+1,oP=2*os+1;function aP(n){const{a:e,b:t}=Lr,r=Xe(n*n),i=Xe(r*n);return Xe(i+e*n+t)}const kp=Lr.a===Mt;class nM extends Error{constructor(e){super(e)}}function lP(n){if(!(n instanceof Wt))throw new TypeError("JacobianPoint expected")}class Wt{constructor(e,t,r){this.x=e,this.y=t,this.z=r}static fromAffine(e){if(!(e instanceof fr))throw new TypeError("JacobianPoint#fromAffine: expected Point");return e.equals(fr.ZERO)?Wt.ZERO:new Wt(e.x,e.y,vr)}static toAffineBatch(e){const t=nie(e.map(r=>r.z));return e.map((r,i)=>r.toAffine(t[i]))}static normalizeZ(e){return Wt.toAffineBatch(e).map(Wt.fromAffine)}equals(e){lP(e);const{x:t,y:r,z:i}=this,{x:s,y:o,z:a}=e,l=Xe(i*i),c=Xe(a*a),h=Xe(t*c),d=Xe(s*l),p=Xe(Xe(r*a)*c),g=Xe(Xe(o*i)*l);return h===d&&p===g}negate(){return new Wt(this.x,Xe(-this.y),this.z)}double(){const{x:e,y:t,z:r}=this,i=Xe(e*e),s=Xe(t*t),o=Xe(s*s),a=e+s,l=Xe(pa*(Xe(a*a)-i-o)),c=Xe(Zh*i),h=Xe(c*c),d=Xe(h-pa*l),p=Xe(c*(l-d)-nP*o),g=Xe(pa*t*r);return new Wt(d,p,g)}add(e){lP(e);const{x:t,y:r,z:i}=this,{x:s,y:o,z:a}=e;if(s===Mt||o===Mt)return this;if(t===Mt||r===Mt)return e;const l=Xe(i*i),c=Xe(a*a),h=Xe(t*c),d=Xe(s*l),p=Xe(Xe(r*a)*c),g=Xe(Xe(o*i)*l),m=Xe(d-h),E=Xe(g-p);if(m===Mt)return E===Mt?this.double():Wt.ZERO;const y=Xe(m*m),S=Xe(m*y),b=Xe(h*y),_=Xe(E*E-S-pa*b),I=Xe(E*(b-_)-p*S),x=Xe(i*a*m);return new Wt(_,I,x)}subtract(e){return this.add(e.negate())}multiplyUnsafe(e){const t=Wt.ZERO;if(typeof e=="bigint"&&e===Mt)return t;let r=fP(e);if(r===vr)return this;if(!kp){let d=t,p=this;for(;r>Mt;)r&vr&&(d=d.add(p)),p=p.double(),r>>=vr;return d}let{k1neg:i,k1:s,k2neg:o,k2:a}=Cp.splitScalar(r),l=t,c=t,h=this;for(;s>Mt||a>Mt;)s&vr&&(l=l.add(h)),a&vr&&(c=c.add(h)),h=h.double(),s>>=vr,a>>=vr;return i&&(l=l.negate()),o&&(c=c.negate()),c=new Wt(Xe(c.x*Cp.beta),c.y,c.z),l.add(c)}precomputeWindow(e){const t=kp?128/e+1:256/e+1,r=[];let i=this,s=i;for(let o=0;o<t;o++){s=i,r.push(s);for(let a=1;a<2**(e-1);a++)s=s.add(i),r.push(s);i=s.double()}return r}wNAF(e,t){!t&&this.equals(Wt.BASE)&&(t=fr.BASE);const r=t&&t._WINDOW_SIZE||1;if(256%r)throw new Error("Point#wNAF: Invalid precomputation window, must be power of 2");let i=t&&iE.get(t);i||(i=this.precomputeWindow(r),t&&r!==1&&(i=Wt.normalizeZ(i),iE.set(t,i)));let s=Wt.ZERO,o=Wt.BASE;const a=1+(kp?128/r:256/r),l=2**(r-1),c=BigInt(2**r-1),h=2**r,d=BigInt(r);for(let p=0;p<a;p++){const g=p*l;let m=Number(e&c);e>>=d,m>l&&(m-=h,e+=vr);const E=g,y=g+Math.abs(m)-1,S=p%2!==0,b=m<0;m===0?o=o.add(Pp(S,i[E])):s=s.add(Pp(b,i[y]))}return{p:s,f:o}}multiply(e,t){let r=fP(e),i,s;if(kp){const{k1neg:o,k1:a,k2neg:l,k2:c}=Cp.splitScalar(r);let{p:h,f:d}=this.wNAF(a,t),{p,f:g}=this.wNAF(c,t);h=Pp(o,h),p=Pp(l,p),p=new Wt(Xe(p.x*Cp.beta),p.y,p.z),i=h.add(p),s=d.add(g)}else{const{p:o,f:a}=this.wNAF(r,t);i=o,s=a}return Wt.normalizeZ([i,s])[0]}toAffine(e){const{x:t,y:r,z:i}=this,s=this.equals(Wt.ZERO);e==null&&(e=s?nP:Gu(i));const o=e,a=Xe(o*o),l=Xe(a*o),c=Xe(t*a),h=Xe(r*l),d=Xe(i*o);if(s)return fr.ZERO;if(d!==vr)throw new Error("invZ was invalid");return new fr(c,h)}}Wt.BASE=new Wt(Lr.Gx,Lr.Gy,vr);Wt.ZERO=new Wt(Mt,vr,Mt);function Pp(n,e){const t=e.negate();return n?t:e}const iE=new WeakMap;class fr{constructor(e,t){this.x=e,this.y=t}_setWindowSize(e){this._WINDOW_SIZE=e,iE.delete(this)}hasEvenY(){return this.y%pa===Mt}static fromCompressedHex(e){const t=e.length===32,r=va(t?e:e.subarray(1));if(!Pw(r))throw new Error("Point is not on curve");const i=aP(r);let s=rie(i);const o=(s&vr)===vr;t?o&&(s=Xe(-s)):(e[0]&1)===1!==o&&(s=Xe(-s));const a=new fr(r,s);return a.assertValidity(),a}static fromUncompressedHex(e){const t=va(e.subarray(1,os+1)),r=va(e.subarray(os+1,os*2+1)),i=new fr(t,r);return i.assertValidity(),i}static fromHex(e){const t=Bu(e),r=t.length,i=t[0];if(r===os)return this.fromCompressedHex(t);if(r===sP&&(i===2||i===3))return this.fromCompressedHex(t);if(r===oP&&i===4)return this.fromUncompressedHex(t);throw new Error(`Point.fromHex: received invalid point. Expected 32-${sP} compressed bytes or ${oP} uncompressed bytes, not ${r}`)}static fromPrivateKey(e){return fr.BASE.multiply(iy(e))}static fromSignature(e,t,r){const{r:i,s}=sM(t);if(![0,1,2,3].includes(r))throw new Error("Cannot recover: invalid recovery bit");const o=cA(Bu(e)),{n:a}=Lr,l=r===2||r===3?i+a:i,c=Gu(l,a),h=Xe(-o*c,a),d=Xe(s*c,a),p=r&1?"03":"02",g=fr.fromHex(p+Jc(l)),m=fr.BASE.multiplyAndAddUnsafe(g,h,d);if(!m)throw new Error("Cannot recover signature: point at infinify");return m.assertValidity(),m}toRawBytes(e=!1){return Pl(this.toHex(e))}toHex(e=!1){const t=Jc(this.x);return e?`${this.hasEvenY()?"02":"03"}${t}`:`04${t}${Jc(this.y)}`}toHexX(){return this.toHex(!0).slice(2)}toRawX(){return this.toRawBytes(!0).slice(1)}assertValidity(){const e="Point is not on elliptic curve",{x:t,y:r}=this;if(!Pw(t)||!Pw(r))throw new Error(e);const i=Xe(r*r),s=aP(t);if(Xe(i-s)!==Mt)throw new Error(e)}equals(e){return this.x===e.x&&this.y===e.y}negate(){return new fr(this.x,Xe(-this.y))}double(){return Wt.fromAffine(this).double().toAffine()}add(e){return Wt.fromAffine(this).add(Wt.fromAffine(e)).toAffine()}subtract(e){return this.add(e.negate())}multiply(e){return Wt.fromAffine(this).multiply(e,this).toAffine()}multiplyAndAddUnsafe(e,t,r){const i=Wt.fromAffine(this),s=t===Mt||t===vr||this!==fr.BASE?i.multiplyUnsafe(t):i.multiply(t),o=Wt.fromAffine(e).multiplyUnsafe(r),a=s.add(o);return a.equals(Wt.ZERO)?void 0:a.toAffine()}}fr.BASE=new fr(Lr.Gx,Lr.Gy);fr.ZERO=new fr(Mt,Mt);function cP(n){return Number.parseInt(n[0],16)>=8?"00"+n:n}function uP(n){if(n.length<2||n[0]!==2)throw new Error(`Invalid signature integer tag: ${Mu(n)}`);const e=n[1],t=n.subarray(2,e+2);if(!e||t.length!==e)throw new Error("Invalid signature integer: wrong length");if(t[0]===0&&t[1]<=127)throw new Error("Invalid signature integer: trailing length");return{data:va(t),left:n.subarray(e+2)}}function Jne(n){if(n.length<2||n[0]!=48)throw new Error(`Invalid signature tag: ${Mu(n)}`);if(n[1]!==n.length-2)throw new Error("Invalid signature: incorrect length");const{data:e,left:t}=uP(n.subarray(2)),{data:r,left:i}=uP(t);if(i.length)throw new Error(`Invalid signature: left bytes after parsing: ${Mu(i)}`);return{r:e,s:r}}class go{constructor(e,t){this.r=e,this.s=t,this.assertValidity()}static fromCompact(e){const t=Rf(e),r="Signature.fromCompact";if(typeof e!="string"&&!t)throw new TypeError(`${r}: Expected string or Uint8Array`);const i=t?Mu(e):e;if(i.length!==128)throw new Error(`${r}: Expected 64-byte hex`);return new go(ny(i.slice(0,64)),ny(i.slice(64,128)))}static fromDER(e){const t=Rf(e);if(typeof e!="string"&&!t)throw new TypeError("Signature.fromDER: Expected string or Uint8Array");const{r,s:i}=Jne(t?e:Pl(e));return new go(r,i)}static fromHex(e){return this.fromDER(e)}assertValidity(){const{r:e,s:t}=this;if(!Of(e))throw new Error("Invalid Signature: r must be 0 < r < n");if(!Of(t))throw new Error("Invalid Signature: s must be 0 < s < n")}hasHighS(){const e=Lr.n>>vr;return this.s>e}normalizeS(){return this.hasHighS()?new go(this.r,Xe(-this.s,Lr.n)):this}toDERRawBytes(){return Pl(this.toDERHex())}toDERHex(){const e=cP(Eh(this.s)),t=cP(Eh(this.r)),r=e.length/2,i=t.length/2,s=Eh(r),o=Eh(i);return`30${Eh(i+r+4)}02${o}${t}02${s}${e}`}toRawBytes(){return this.toDERRawBytes()}toHex(){return this.toDERHex()}toCompactRawBytes(){return Pl(this.toCompactHex())}toCompactHex(){return Jc(this.r)+Jc(this.s)}}function Rf(n){return n instanceof Uint8Array||ArrayBuffer.isView(n)&&n.constructor.name==="Uint8Array"}function iM(n){if(!Rf(n))throw new Error("Uint8Array expected")}function aa(...n){if(n.every(iM),n.length===1)return n[0];const e=n.reduce((r,i)=>r+i.length,0),t=new Uint8Array(e);for(let r=0,i=0;r<n.length;r++){const s=n[r];t.set(s,i),i+=s.length}return t}const eie=Array.from({length:256},(n,e)=>e.toString(16).padStart(2,"0"));function Mu(n){iM(n);let e="";for(let t=0;t<n.length;t++)e+=eie[n[t]];return e}const Ks={_0:48,_9:57,A:65,F:70,a:97,f:102};function hP(n){if(n>=Ks._0&&n<=Ks._9)return n-Ks._0;if(n>=Ks.A&&n<=Ks.F)return n-(Ks.A-10);if(n>=Ks.a&&n<=Ks.f)return n-(Ks.a-10)}function Pl(n){if(typeof n!="string")throw new Error("hex string expected, got "+typeof n);const e=n.length,t=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const r=new Uint8Array(t);for(let i=0,s=0;i<t;i++,s+=2){const o=hP(n.charCodeAt(s)),a=hP(n.charCodeAt(s+1));if(o===void 0||a===void 0){const l=n[s]+n[s+1];throw new Error('hex string expected, got non-hex character "'+l+'" at index '+s)}r[i]=o*16+a}return r}const tie=BigInt("0x10000000000000000000000000000000000000000000000000000000000000000");function Jc(n){if(typeof n!="bigint")throw new Error("Expected bigint");if(!(Mt<=n&&n<tie))throw new Error("Expected number 0 <= n < 2^256");return n.toString(16).padStart(64,"0")}function sE(n){const e=Pl(Jc(n));if(e.length!==32)throw new Error("Error: expected 32 bytes");return e}function Eh(n){const e=n.toString(16);return e.length&1?`0${e}`:e}function ny(n){if(typeof n!="string")throw new TypeError("hexToNumber: expected string, got "+typeof n);return BigInt(`0x${n}`)}function va(n){return ny(Mu(n))}function Bu(n){return Rf(n)?Uint8Array.from(n):Pl(n)}function fP(n){if(typeof n=="number"&&Number.isSafeInteger(n)&&n>0)return BigInt(n);if(typeof n=="bigint"&&Of(n))return n;throw new TypeError("Expected valid private scalar: 0 < scalar < curve.n")}function Xe(n,e=Lr.P){const t=n%e;return t>=Mt?t:e+t}function $i(n,e){const{P:t}=Lr;let r=n;for(;e-- >Mt;)r*=r,r%=t;return r}function rie(n){const{P:e}=Lr,t=BigInt(6),r=BigInt(11),i=BigInt(22),s=BigInt(23),o=BigInt(44),a=BigInt(88),l=n*n*n%e,c=l*l*n%e,h=$i(c,Zh)*c%e,d=$i(h,Zh)*c%e,p=$i(d,pa)*l%e,g=$i(p,r)*p%e,m=$i(g,i)*g%e,E=$i(m,o)*m%e,y=$i(E,a)*E%e,S=$i(y,o)*m%e,b=$i(S,Zh)*c%e,_=$i(b,s)*g%e,I=$i(_,t)*l%e,x=$i(I,pa);if(x*x%e!==n)throw new Error("Cannot find square root");return x}function Gu(n,e=Lr.P){if(n===Mt||e<=Mt)throw new Error(`invert: expected positive integers, got n=${n} mod=${e}`);let t=Xe(n,e),r=e,i=Mt,s=vr;for(;t!==Mt;){const a=r/t,l=r%t,c=i-s*a;r=t,t=l,i=s,s=c}if(r!==vr)throw new Error("invert: does not exist");return Xe(i,e)}function nie(n,e=Lr.P){const t=new Array(n.length),r=n.reduce((s,o,a)=>o===Mt?s:(t[a]=s,Xe(s*o,e)),vr),i=Gu(r,e);return n.reduceRight((s,o,a)=>o===Mt?s:(t[a]=Xe(s*t[a],e),Xe(s*o,e)),i),t}function iie(n){const e=n.length*8-$u*8,t=va(n);return e>0?t>>BigInt(e):t}function cA(n,e=!1){const t=iie(n);if(e)return t;const{n:r}=Lr;return t>=r?t-r:t}let eu,Qh;class sie{constructor(e,t){if(this.hashLen=e,this.qByteLen=t,typeof e!="number"||e<2)throw new Error("hashLen must be a number");if(typeof t!="number"||t<2)throw new Error("qByteLen must be a number");this.v=new Uint8Array(e).fill(1),this.k=new Uint8Array(e).fill(0),this.counter=0}hmac(...e){return yl.hmacSha256(this.k,...e)}hmacSync(...e){return Qh(this.k,...e)}checkSync(){if(typeof Qh!="function")throw new nM("hmacSha256Sync needs to be set")}incr(){if(this.counter>=1e3)throw new Error("Tried 1,000 k values for sign(), all were invalid");this.counter+=1}async reseed(e=new Uint8Array){this.k=await this.hmac(this.v,Uint8Array.from([0]),e),this.v=await this.hmac(this.v),e.length!==0&&(this.k=await this.hmac(this.v,Uint8Array.from([1]),e),this.v=await this.hmac(this.v))}reseedSync(e=new Uint8Array){this.checkSync(),this.k=this.hmacSync(this.v,Uint8Array.from([0]),e),this.v=this.hmacSync(this.v),e.length!==0&&(this.k=this.hmacSync(this.v,Uint8Array.from([1]),e),this.v=this.hmacSync(this.v))}async generate(){this.incr();let e=0;const t=[];for(;e<this.qByteLen;){this.v=await this.hmac(this.v);const r=this.v.slice();t.push(r),e+=this.v.length}return aa(...t)}generateSync(){this.checkSync(),this.incr();let e=0;const t=[];for(;e<this.qByteLen;){this.v=this.hmacSync(this.v);const r=this.v.slice();t.push(r),e+=this.v.length}return aa(...t)}}function Of(n){return Mt<n&&n<Lr.n}function Pw(n){return Mt<n&&n<Lr.P}function oie(n,e,t,r=!0){const{n:i}=Lr,s=cA(n,!0);if(!Of(s))return;const o=Gu(s,i),a=fr.BASE.multiply(s),l=Xe(a.x,i);if(l===Mt)return;const c=Xe(o*Xe(e+t*l,i),i);if(c===Mt)return;let h=new go(l,c),d=(a.x===h.r?0:2)|Number(a.y&vr);return r&&h.hasHighS()&&(h=h.normalizeS(),d^=1),{sig:h,recovery:d}}function iy(n){let e;if(typeof n=="bigint")e=n;else if(typeof n=="number"&&Number.isSafeInteger(n)&&n>0)e=BigInt(n);else if(typeof n=="string"){if(n.length!==2*$u)throw new Error("Expected 32 bytes of private key");e=ny(n)}else if(Rf(n)){if(n.length!==$u)throw new Error("Expected 32 bytes of private key");e=va(n)}else throw new TypeError("Expected valid private key");if(!Of(e))throw new Error("Expected private key: 0 < key < n");return e}function aie(n){return n instanceof fr?(n.assertValidity(),n):fr.fromHex(n)}function sM(n){if(n instanceof go)return n.assertValidity(),n;try{return go.fromDER(n)}catch{return go.fromCompact(n)}}function oM(n){const e=n.length>os?n.slice(0,os):n;return va(e)}function lie(n){const e=oM(n),t=Xe(e,Lr.n);return aM(t<Mt?e:t)}function aM(n){return sE(n)}function cie(n,e,t){if(n==null)throw new Error(`sign: expected valid message hash, not "${n}"`);const r=Bu(n),i=iy(e),s=[aM(i),lie(r)];if(t!=null){t===!0&&(t=yl.randomBytes(os));const l=Bu(t);if(l.length!==os)throw new Error(`sign: Expected ${os} bytes of extra data`);s.push(l)}const o=aa(...s),a=oM(r);return{seed:o,m:a,d:i}}function uie(n,e){const{sig:t,recovery:r}=n,{der:i,recovered:s}=Object.assign({canonical:!0,der:!0},e),o=i?t.toDERRawBytes():t.toCompactRawBytes();return s?[o,r]:o}async function hie(n,e,t={}){const{seed:r,m:i,d:s}=cie(n,e,t.extraEntropy),o=new sie(Qne,$u);await o.reseed(r);let a;for(;!(a=oie(await o.generate(),i,s,t.canonical));)await o.reseed();return uie(a,t)}const fie={strict:!0};function die(n,e,t,r=fie){let i;try{i=sM(n),e=Bu(e)}catch{return!1}const{r:s,s:o}=i;if(r.strict&&i.hasHighS())return!1;const a=cA(e);let l;try{l=aie(t)}catch{return!1}const{n:c}=Lr,h=Gu(o,c),d=Xe(a*h,c),p=Xe(s*h,c),g=fr.BASE.multiplyAndAddUnsafe(l,d,p);return g?Xe(g.x,c)===s:!1}fr.BASE._setWindowSize(8);const gi={node:Zne,web:typeof self=="object"&&"crypto"in self?self.crypto:void 0},Rp={},yl={bytesToHex:Mu,hexToBytes:Pl,concatBytes:aa,mod:Xe,invert:Gu,isValidPrivateKey(n){try{return iy(n),!0}catch{return!1}},_bigintTo32Bytes:sE,_normalizePrivateKey:iy,hashToPrivateKey:n=>{n=Bu(n);const e=$u+8;if(n.length<e||n.length>1024)throw new Error("Expected valid bytes of private key as per FIPS 186");const t=Xe(va(n),Lr.n-vr)+vr;return sE(t)},randomBytes:(n=32)=>{if(gi.web)return gi.web.getRandomValues(new Uint8Array(n));if(gi.node){const{randomBytes:e}=gi.node;return Uint8Array.from(e(n))}else throw new Error("The environment doesn't have randomBytes function")},randomPrivateKey:()=>yl.hashToPrivateKey(yl.randomBytes($u+8)),precompute(n=8,e=fr.BASE){const t=e===fr.BASE?e:new fr(e.x,e.y);return t._setWindowSize(n),t.multiply(Zh),t},sha256:async(...n)=>{if(gi.web){const e=await gi.web.subtle.digest("SHA-256",aa(...n));return new Uint8Array(e)}else if(gi.node){const{createHash:e}=gi.node,t=e("sha256");return n.forEach(r=>t.update(r)),Uint8Array.from(t.digest())}else throw new Error("The environment doesn't have sha256 function")},hmacSha256:async(n,...e)=>{if(gi.web){const t=await gi.web.subtle.importKey("raw",n,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]),r=aa(...e),i=await gi.web.subtle.sign("HMAC",t,r);return new Uint8Array(i)}else if(gi.node){const{createHmac:t}=gi.node,r=t("sha256",n);return e.forEach(i=>r.update(i)),Uint8Array.from(r.digest())}else throw new Error("The environment doesn't have hmac-sha256 function")},sha256Sync:void 0,hmacSha256Sync:void 0,taggedHash:async(n,...e)=>{let t=Rp[n];if(t===void 0){const r=await yl.sha256(Uint8Array.from(n,i=>i.charCodeAt(0)));t=aa(r,r),Rp[n]=t}return yl.sha256(t,...e)},taggedHashSync:(n,...e)=>{if(typeof eu!="function")throw new nM("sha256Sync is undefined, you need to set it");let t=Rp[n];if(t===void 0){const r=eu(Uint8Array.from(n,i=>i.charCodeAt(0)));t=aa(r,r),Rp[n]=t}return eu(t,...e)},_JacobianPoint:Wt};Object.defineProperties(yl,{sha256Sync:{configurable:!1,get(){return eu},set(n){eu||(eu=n)}},hmacSha256Sync:{configurable:!1,get(){return Qh},set(n){Qh||(Qh=n)}}});var lM={exports:{}};/**
 * [js-sha3]{@link https://github.com/emn178/js-sha3}
 *
 * @version 0.9.3
 * @author Chen, Yi-Cyuan [emn178@gmail.com]
 * @copyright Chen, Yi-Cyuan 2015-2023
 * @license MIT
 */(function(n){(function(){var e="input is invalid type",t="finalize already called",r=typeof window=="object",i=r?window:{};i.JS_SHA3_NO_WINDOW&&(r=!1);var s=!r&&typeof self=="object",o=!i.JS_SHA3_NO_NODE_JS&&typeof process=="object"&&process.versions&&process.versions.node;o?i=Ui:s&&(i=self);for(var a=!i.JS_SHA3_NO_COMMON_JS&&!0&&n.exports,l=!i.JS_SHA3_NO_ARRAY_BUFFER&&typeof ArrayBuffer<"u",c="0123456789abcdef".split(""),h=[31,7936,2031616,520093696],d=[4,1024,262144,67108864],p=[1,256,65536,16777216],g=[6,1536,393216,100663296],m=[0,8,16,24],E=[1,0,32898,0,32906,2147483648,2147516416,2147483648,32907,0,2147483649,0,2147516545,2147483648,32777,2147483648,138,0,136,0,2147516425,0,2147483658,0,2147516555,0,139,2147483648,32905,2147483648,32771,2147483648,32770,2147483648,128,2147483648,32778,0,2147483658,2147483648,2147516545,2147483648,32896,2147483648,2147483649,0,2147516424,2147483648],y=[224,256,384,512],S=[128,256],b=["hex","buffer","arrayBuffer","array","digest"],_={128:168,256:136},I=i.JS_SHA3_NO_NODE_JS||!Array.isArray?function(k){return Object.prototype.toString.call(k)==="[object Array]"}:Array.isArray,x=l&&(i.JS_SHA3_NO_ARRAY_BUFFER_IS_VIEW||!ArrayBuffer.isView)?function(k){return typeof k=="object"&&k.buffer&&k.buffer.constructor===ArrayBuffer}:ArrayBuffer.isView,$=function(k){var X=typeof k;if(X==="string")return[k,!0];if(X!=="object"||k===null)throw new Error(e);if(l&&k.constructor===ArrayBuffer)return[new Uint8Array(k),!1];if(!I(k)&&!x(k))throw new Error(e);return[k,!1]},U=function(k){return $(k)[0].length===0},O=function(k){for(var X=[],ee=0;ee<k.length;++ee)X[ee]=k[ee];return X},P=function(k,X,ee){return function(me){return new oe(k,X,k).update(me)[ee]()}},M=function(k,X,ee){return function(me,be){return new oe(k,X,be).update(me)[ee]()}},K=function(k,X,ee){return function(me,be,te,le){return G["cshake"+k].update(me,be,te,le)[ee]()}},C=function(k,X,ee){return function(me,be,te,le){return G["kmac"+k].update(me,be,te,le)[ee]()}},B=function(k,X,ee,me){for(var be=0;be<b.length;++be){var te=b[be];k[te]=X(ee,me,te)}return k},N=function(k,X){var ee=P(k,X,"hex");return ee.create=function(){return new oe(k,X,k)},ee.update=function(me){return ee.create().update(me)},B(ee,P,k,X)},L=function(k,X){var ee=M(k,X,"hex");return ee.create=function(me){return new oe(k,X,me)},ee.update=function(me,be){return ee.create(be).update(me)},B(ee,M,k,X)},V=function(k,X){var ee=_[k],me=K(k,X,"hex");return me.create=function(be,te,le){return U(te)&&U(le)?G["shake"+k].create(be):new oe(k,X,be).bytepad([te,le],ee)},me.update=function(be,te,le,ge){return me.create(te,le,ge).update(be)},B(me,K,k,X)},W=function(k,X){var ee=_[k],me=C(k,X,"hex");return me.create=function(be,te,le){return new ne(k,X,te).bytepad(["KMAC",le],ee).bytepad([be],ee)},me.update=function(be,te,le,ge){return me.create(be,le,ge).update(te)},B(me,C,k,X)},H=[{name:"keccak",padding:p,bits:y,createMethod:N},{name:"sha3",padding:g,bits:y,createMethod:N},{name:"shake",padding:h,bits:S,createMethod:L},{name:"cshake",padding:d,bits:S,createMethod:V},{name:"kmac",padding:d,bits:S,createMethod:W}],G={},z=[],Z=0;Z<H.length;++Z)for(var F=H[Z],ie=F.bits,fe=0;fe<ie.length;++fe){var J=F.name+"_"+ie[fe];if(z.push(J),G[J]=F.createMethod(ie[fe],F.padding),F.name!=="sha3"){var _e=F.name+ie[fe];z.push(_e),G[_e]=G[J]}}function oe(k,X,ee){this.blocks=[],this.s=[],this.padding=X,this.outputBits=ee,this.reset=!0,this.finalized=!1,this.block=0,this.start=0,this.blockCount=1600-(k<<1)>>5,this.byteCount=this.blockCount<<2,this.outputBlocks=ee>>5,this.extraBytes=(ee&31)>>3;for(var me=0;me<50;++me)this.s[me]=0}oe.prototype.update=function(k){if(this.finalized)throw new Error(t);var X=$(k);k=X[0];for(var ee=X[1],me=this.blocks,be=this.byteCount,te=k.length,le=this.blockCount,ge=0,Ie=this.s,Ae,Te;ge<te;){if(this.reset)for(this.reset=!1,me[0]=this.block,Ae=1;Ae<le+1;++Ae)me[Ae]=0;if(ee)for(Ae=this.start;ge<te&&Ae<be;++ge)Te=k.charCodeAt(ge),Te<128?me[Ae>>2]|=Te<<m[Ae++&3]:Te<2048?(me[Ae>>2]|=(192|Te>>6)<<m[Ae++&3],me[Ae>>2]|=(128|Te&63)<<m[Ae++&3]):Te<55296||Te>=57344?(me[Ae>>2]|=(224|Te>>12)<<m[Ae++&3],me[Ae>>2]|=(128|Te>>6&63)<<m[Ae++&3],me[Ae>>2]|=(128|Te&63)<<m[Ae++&3]):(Te=65536+((Te&1023)<<10|k.charCodeAt(++ge)&1023),me[Ae>>2]|=(240|Te>>18)<<m[Ae++&3],me[Ae>>2]|=(128|Te>>12&63)<<m[Ae++&3],me[Ae>>2]|=(128|Te>>6&63)<<m[Ae++&3],me[Ae>>2]|=(128|Te&63)<<m[Ae++&3]);else for(Ae=this.start;ge<te&&Ae<be;++ge)me[Ae>>2]|=k[ge]<<m[Ae++&3];if(this.lastByteIndex=Ae,Ae>=be){for(this.start=Ae-be,this.block=me[le],Ae=0;Ae<le;++Ae)Ie[Ae]^=me[Ae];de(Ie),this.reset=!0}else this.start=Ae}return this},oe.prototype.encode=function(k,X){var ee=k&255,me=1,be=[ee];for(k=k>>8,ee=k&255;ee>0;)be.unshift(ee),k=k>>8,ee=k&255,++me;return X?be.push(me):be.unshift(me),this.update(be),be.length},oe.prototype.encodeString=function(k){var X=$(k);k=X[0];var ee=X[1],me=0,be=k.length;if(ee)for(var te=0;te<k.length;++te){var le=k.charCodeAt(te);le<128?me+=1:le<2048?me+=2:le<55296||le>=57344?me+=3:(le=65536+((le&1023)<<10|k.charCodeAt(++te)&1023),me+=4)}else me=be;return me+=this.encode(me*8),this.update(k),me},oe.prototype.bytepad=function(k,X){for(var ee=this.encode(X),me=0;me<k.length;++me)ee+=this.encodeString(k[me]);var be=(X-ee%X)%X,te=[];return te.length=be,this.update(te),this},oe.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var k=this.blocks,X=this.lastByteIndex,ee=this.blockCount,me=this.s;if(k[X>>2]|=this.padding[X&3],this.lastByteIndex===this.byteCount)for(k[0]=k[ee],X=1;X<ee+1;++X)k[X]=0;for(k[ee-1]|=2147483648,X=0;X<ee;++X)me[X]^=k[X];de(me)}},oe.prototype.toString=oe.prototype.hex=function(){this.finalize();for(var k=this.blockCount,X=this.s,ee=this.outputBlocks,me=this.extraBytes,be=0,te=0,le="",ge;te<ee;){for(be=0;be<k&&te<ee;++be,++te)ge=X[be],le+=c[ge>>4&15]+c[ge&15]+c[ge>>12&15]+c[ge>>8&15]+c[ge>>20&15]+c[ge>>16&15]+c[ge>>28&15]+c[ge>>24&15];te%k===0&&(X=O(X),de(X),be=0)}return me&&(ge=X[be],le+=c[ge>>4&15]+c[ge&15],me>1&&(le+=c[ge>>12&15]+c[ge>>8&15]),me>2&&(le+=c[ge>>20&15]+c[ge>>16&15])),le},oe.prototype.arrayBuffer=function(){this.finalize();var k=this.blockCount,X=this.s,ee=this.outputBlocks,me=this.extraBytes,be=0,te=0,le=this.outputBits>>3,ge;me?ge=new ArrayBuffer(ee+1<<2):ge=new ArrayBuffer(le);for(var Ie=new Uint32Array(ge);te<ee;){for(be=0;be<k&&te<ee;++be,++te)Ie[te]=X[be];te%k===0&&(X=O(X),de(X))}return me&&(Ie[te]=X[be],ge=ge.slice(0,le)),ge},oe.prototype.buffer=oe.prototype.arrayBuffer,oe.prototype.digest=oe.prototype.array=function(){this.finalize();for(var k=this.blockCount,X=this.s,ee=this.outputBlocks,me=this.extraBytes,be=0,te=0,le=[],ge,Ie;te<ee;){for(be=0;be<k&&te<ee;++be,++te)ge=te<<2,Ie=X[be],le[ge]=Ie&255,le[ge+1]=Ie>>8&255,le[ge+2]=Ie>>16&255,le[ge+3]=Ie>>24&255;te%k===0&&(X=O(X),de(X))}return me&&(ge=te<<2,Ie=X[be],le[ge]=Ie&255,me>1&&(le[ge+1]=Ie>>8&255),me>2&&(le[ge+2]=Ie>>16&255)),le};function ne(k,X,ee){oe.call(this,k,X,ee)}ne.prototype=new oe,ne.prototype.finalize=function(){return this.encode(this.outputBits,!0),oe.prototype.finalize.call(this)};var de=function(k){var X,ee,me,be,te,le,ge,Ie,Ae,Te,ye,Re,Fe,Ce,et,A,T,D,Y,ae,pe,Ee,ue,we,He,ze,Ke,it,Gt,er,yt,Rt,nt,St,Ot,Zt,ar,Kr,se,ce,Ue,We,Ve,lr,Cr,Vr,xi,Ii,Ti,Hi,qn,Gr,Rn,Hn,en,mn,Jl,ec,Rs,tc,Os,rc,nc;for(me=0;me<48;me+=2)be=k[0]^k[10]^k[20]^k[30]^k[40],te=k[1]^k[11]^k[21]^k[31]^k[41],le=k[2]^k[12]^k[22]^k[32]^k[42],ge=k[3]^k[13]^k[23]^k[33]^k[43],Ie=k[4]^k[14]^k[24]^k[34]^k[44],Ae=k[5]^k[15]^k[25]^k[35]^k[45],Te=k[6]^k[16]^k[26]^k[36]^k[46],ye=k[7]^k[17]^k[27]^k[37]^k[47],Re=k[8]^k[18]^k[28]^k[38]^k[48],Fe=k[9]^k[19]^k[29]^k[39]^k[49],X=Re^(le<<1|ge>>>31),ee=Fe^(ge<<1|le>>>31),k[0]^=X,k[1]^=ee,k[10]^=X,k[11]^=ee,k[20]^=X,k[21]^=ee,k[30]^=X,k[31]^=ee,k[40]^=X,k[41]^=ee,X=be^(Ie<<1|Ae>>>31),ee=te^(Ae<<1|Ie>>>31),k[2]^=X,k[3]^=ee,k[12]^=X,k[13]^=ee,k[22]^=X,k[23]^=ee,k[32]^=X,k[33]^=ee,k[42]^=X,k[43]^=ee,X=le^(Te<<1|ye>>>31),ee=ge^(ye<<1|Te>>>31),k[4]^=X,k[5]^=ee,k[14]^=X,k[15]^=ee,k[24]^=X,k[25]^=ee,k[34]^=X,k[35]^=ee,k[44]^=X,k[45]^=ee,X=Ie^(Re<<1|Fe>>>31),ee=Ae^(Fe<<1|Re>>>31),k[6]^=X,k[7]^=ee,k[16]^=X,k[17]^=ee,k[26]^=X,k[27]^=ee,k[36]^=X,k[37]^=ee,k[46]^=X,k[47]^=ee,X=Te^(be<<1|te>>>31),ee=ye^(te<<1|be>>>31),k[8]^=X,k[9]^=ee,k[18]^=X,k[19]^=ee,k[28]^=X,k[29]^=ee,k[38]^=X,k[39]^=ee,k[48]^=X,k[49]^=ee,Ce=k[0],et=k[1],Vr=k[11]<<4|k[10]>>>28,xi=k[10]<<4|k[11]>>>28,it=k[20]<<3|k[21]>>>29,Gt=k[21]<<3|k[20]>>>29,tc=k[31]<<9|k[30]>>>23,Os=k[30]<<9|k[31]>>>23,We=k[40]<<18|k[41]>>>14,Ve=k[41]<<18|k[40]>>>14,St=k[2]<<1|k[3]>>>31,Ot=k[3]<<1|k[2]>>>31,A=k[13]<<12|k[12]>>>20,T=k[12]<<12|k[13]>>>20,Ii=k[22]<<10|k[23]>>>22,Ti=k[23]<<10|k[22]>>>22,er=k[33]<<13|k[32]>>>19,yt=k[32]<<13|k[33]>>>19,rc=k[42]<<2|k[43]>>>30,nc=k[43]<<2|k[42]>>>30,Hn=k[5]<<30|k[4]>>>2,en=k[4]<<30|k[5]>>>2,Zt=k[14]<<6|k[15]>>>26,ar=k[15]<<6|k[14]>>>26,D=k[25]<<11|k[24]>>>21,Y=k[24]<<11|k[25]>>>21,Hi=k[34]<<15|k[35]>>>17,qn=k[35]<<15|k[34]>>>17,Rt=k[45]<<29|k[44]>>>3,nt=k[44]<<29|k[45]>>>3,we=k[6]<<28|k[7]>>>4,He=k[7]<<28|k[6]>>>4,mn=k[17]<<23|k[16]>>>9,Jl=k[16]<<23|k[17]>>>9,Kr=k[26]<<25|k[27]>>>7,se=k[27]<<25|k[26]>>>7,ae=k[36]<<21|k[37]>>>11,pe=k[37]<<21|k[36]>>>11,Gr=k[47]<<24|k[46]>>>8,Rn=k[46]<<24|k[47]>>>8,lr=k[8]<<27|k[9]>>>5,Cr=k[9]<<27|k[8]>>>5,ze=k[18]<<20|k[19]>>>12,Ke=k[19]<<20|k[18]>>>12,ec=k[29]<<7|k[28]>>>25,Rs=k[28]<<7|k[29]>>>25,ce=k[38]<<8|k[39]>>>24,Ue=k[39]<<8|k[38]>>>24,Ee=k[48]<<14|k[49]>>>18,ue=k[49]<<14|k[48]>>>18,k[0]=Ce^~A&D,k[1]=et^~T&Y,k[10]=we^~ze&it,k[11]=He^~Ke&Gt,k[20]=St^~Zt&Kr,k[21]=Ot^~ar&se,k[30]=lr^~Vr&Ii,k[31]=Cr^~xi&Ti,k[40]=Hn^~mn&ec,k[41]=en^~Jl&Rs,k[2]=A^~D&ae,k[3]=T^~Y&pe,k[12]=ze^~it&er,k[13]=Ke^~Gt&yt,k[22]=Zt^~Kr&ce,k[23]=ar^~se&Ue,k[32]=Vr^~Ii&Hi,k[33]=xi^~Ti&qn,k[42]=mn^~ec&tc,k[43]=Jl^~Rs&Os,k[4]=D^~ae&Ee,k[5]=Y^~pe&ue,k[14]=it^~er&Rt,k[15]=Gt^~yt&nt,k[24]=Kr^~ce&We,k[25]=se^~Ue&Ve,k[34]=Ii^~Hi&Gr,k[35]=Ti^~qn&Rn,k[44]=ec^~tc&rc,k[45]=Rs^~Os&nc,k[6]=ae^~Ee&Ce,k[7]=pe^~ue&et,k[16]=er^~Rt&we,k[17]=yt^~nt&He,k[26]=ce^~We&St,k[27]=Ue^~Ve&Ot,k[36]=Hi^~Gr&lr,k[37]=qn^~Rn&Cr,k[46]=tc^~rc&Hn,k[47]=Os^~nc&en,k[8]=Ee^~Ce&A,k[9]=ue^~et&T,k[18]=Rt^~we&ze,k[19]=nt^~He&Ke,k[28]=We^~St&Zt,k[29]=Ve^~Ot&ar,k[38]=Gr^~lr&Vr,k[39]=Rn^~Cr&xi,k[48]=rc^~Hn&mn,k[49]=nc^~en&Jl,k[0]^=E[me],k[1]^=E[me+1]};if(a)n.exports=G;else for(Z=0;Z<z.length;++Z)i[z[Z]]=G[z[Z]]})()})(lM);var pie=lM.exports;const gie=Yl(pie);function lb(n){return new Uint8Array(gie.keccak256.arrayBuffer(n))}function cM(n,e,t){try{const r=go.fromCompact(n.slice(0,64));return die(r,e,t)}catch{return!1}}function mie(n,e,t,r){let i=Nt("/"+n+"/"+$m(n,t));return i=i.encapsulate(Nt("/"+e+"/"+$m(e,r))),i}function $h(n,e){switch(e){case"udp":return $h(n,"udp4")||$h(n,"udp6");case"tcp":return $h(n,"tcp4")||$h(n,"tcp6")}const t=e.endsWith("6"),r=n.get(t?"ip6":"ip");if(!r)return;const i=e.slice(0,3);let s;switch(i){case"udp":s=t?n.get("udp6"):n.get("udp");break;case"tcp":s=t?n.get("tcp6"):n.get("tcp");break;default:return}if(s)return mie(t?"ip6":"ip4",i,r,s)}const yie=parseInt("11111",2),oE=parseInt("10000000",2),bie=parseInt("01111111",2),dP={0:Sh,1:Sh,2:wie,3:Eie,4:Sie,5:_ie,6:vie,16:Sh,22:Sh,48:Sh};function uA(n,e={offset:0}){const t=n[e.offset]&yie;if(e.offset++,dP[t]!=null)return dP[t](n,e);throw new Error("No decoder for tag "+t)}function od(n,e){let t=0;if((n[e.offset]&oE)===oE){const r=n[e.offset]&bie;let i="0x";e.offset++;for(let s=0;s<r;s++,e.offset++)i+=n[e.offset].toString(16).padStart(2,"0");t=parseInt(i,16)}else t=n[e.offset],e.offset++;return t}function Sh(n,e){od(n,e);const t=[];for(;!(e.offset>=n.byteLength);){const r=uA(n,e);if(r===null)break;t.push(r)}return t}function wie(n,e){const t=od(n,e),r=e.offset,i=e.offset+t,s=[];for(let o=r;o<i;o++)o===r&&n[o]===0||s.push(n[o]);return e.offset+=t,Uint8Array.from(s)}function vie(n,e){const t=od(n,e),r=e.offset+t,i=n[e.offset];e.offset++;let s=0,o=0;i<40?(s=0,o=i):i<80?(s=1,o=i-40):(s=2,o=i-80);let a=`${s}.${o}`,l=[];for(;e.offset<r;){const c=n[e.offset];if(e.offset++,l.push(c&127),c<128){l.reverse();let h=0;for(let d=0;d<l.length;d++)h+=l[d]<<d*7;a+=`.${h}`,l=[]}}return a}function _ie(n,e){return e.offset++,null}function Eie(n,e){const t=od(n,e),r=n[e.offset];e.offset++;const i=n.subarray(e.offset,e.offset+t-1);if(e.offset+=t,r!==0)throw new Error("Unused bits in bit string is unimplemented");return i}function Sie(n,e){const t=od(n,e),r=n.subarray(e.offset,e.offset+t);return e.offset+=t,r}function Aie(n){let e=n.toString(16);e.length%2===1&&(e="0"+e);const t=new bt;for(let r=0;r<e.length;r+=2)t.append(Uint8Array.from([parseInt(`${e[r]}${e[r+1]}`,16)]));return t}function hA(n){if(n.byteLength<128)return Uint8Array.from([n.byteLength]);const e=Aie(n.byteLength);return new bt(Uint8Array.from([e.byteLength|oE]),e)}function aE(n){const e=new bt,t=128;return(n.subarray()[0]&t)===t&&e.append(Uint8Array.from([0])),e.append(n),new bt(Uint8Array.from([2]),hA(e),e)}function uM(n){const e=Uint8Array.from([0]),t=new bt(e,n);return new bt(Uint8Array.from([3]),hA(t),t)}function Jh(n,e=48){const t=new bt;for(const r of n)t.append(r);return new bt(Uint8Array.from([e]),hA(t),t)}const xie="1.2.840.10045.3.1.7",Iie="1.3.132.0.34",Tie="1.3.132.0.35";async function Cie(n,e,t,r){var o,a;const i=await crypto.subtle.importKey("jwk",n,{name:"ECDSA",namedCurve:n.crv??"P-256"},!1,["verify"]);(o=r==null?void 0:r.signal)==null||o.throwIfAborted();const s=await crypto.subtle.verify({name:"ECDSA",hash:{name:"SHA-256"}},i,e,t.subarray());return(a=r==null?void 0:r.signal)==null||a.throwIfAborted(),s}const kie=Uint8Array.from([6,8,42,134,72,206,61,3,1,7]),Pie=Uint8Array.from([6,5,43,129,4,0,34]),Rie=Uint8Array.from([6,5,43,129,4,0,35]),Oie={ext:!0,kty:"EC",crv:"P-256"},Lie={ext:!0,kty:"EC",crv:"P-384"},Nie={ext:!0,kty:"EC",crv:"P-521"},Rw=32,Ow=48,Lw=66;function Die(n){const e=n[1][1][0],t=1;let r,i;if(e.byteLength===Rw*2+1)return r=mt(e.subarray(t,t+Rw),"base64url"),i=mt(e.subarray(t+Rw),"base64url"),new Nw({...Oie,key_ops:["verify"],x:r,y:i});if(e.byteLength===Ow*2+1)return r=mt(e.subarray(t,t+Ow),"base64url"),i=mt(e.subarray(t+Ow),"base64url"),new Nw({...Lie,key_ops:["verify"],x:r,y:i});if(e.byteLength===Lw*2+1)return r=mt(e.subarray(t,t+Lw),"base64url"),i=mt(e.subarray(t+Lw),"base64url"),new Nw({...Nie,key_ops:["verify"],x:r,y:i});throw new rr(`coordinates were wrong length, got ${e.byteLength}, expected 65, 97 or 133`)}function $ie(n){return Jh([aE(Uint8Array.from([1])),Jh([Mie(n.crv)],160),Jh([uM(new bt(Uint8Array.from([4]),at(n.x??"","base64url"),at(n.y??"","base64url")))],161)]).subarray()}function Mie(n){if(n==="P-256")return kie;if(n==="P-384")return Pie;if(n==="P-521")return Rie;throw new rr(`Invalid curve ${n}`)}class Nw{constructor(e){v(this,"type","ECDSA");v(this,"jwk");v(this,"_raw");this.jwk=e}get raw(){return this._raw==null&&(this._raw=$ie(this.jwk)),this._raw}toMultihash(){return Ia.digest(pA(this))}toCID(){return zt.createV1(114,this.toMultihash())}toString(){return _r.encode(this.toMultihash().bytes).substring(1)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:Or(this.raw,e.raw)}async verify(e,t,r){return Cie(this.jwk,t,e,r)}}class pP extends Error{constructor(e="An error occurred while verifying a message"){super(e),this.name="VerificationError"}}class Bie extends Error{constructor(e="Missing Web Crypto API"){super(e),this.name="WebCryptoMissingError"}}const Lf={get(n=globalThis){const e=n.crypto;if((e==null?void 0:e.subtle)==null)throw new Bie("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p/blob/main/packages/crypto/README.md#web-crypto-api");return e}},fA=32;let Dw;const Uie=(async()=>{try{return await Lf.get().subtle.generateKey({name:"Ed25519"},!0,["sign","verify"]),!0}catch{return!1}})();async function Fie(n,e,t){if(n.buffer instanceof ArrayBuffer){const r=await Lf.get().subtle.importKey("raw",n.buffer,{name:"Ed25519"},!1,["verify"]);return await Lf.get().subtle.verify({name:"Ed25519"},r,e,t instanceof Uint8Array?t:t.subarray())}throw new TypeError("WebCrypto does not support SharedArrayBuffer for Ed25519 keys")}function jie(n,e,t){return JZ.verify(e,t instanceof Uint8Array?t:t.subarray(),n)}async function qie(n,e,t){return Dw==null&&(Dw=await Uie),Dw?Fie(n,e,t):jie(n,e,t)}function hM(n){return n==null?!1:typeof n.then=="function"&&typeof n.catch=="function"&&typeof n.finally=="function"}class Hie{constructor(e){v(this,"type","Ed25519");v(this,"raw");this.raw=fM(e,fA)}toMultihash(){return Ia.digest(pA(this))}toCID(){return zt.createV1(114,this.toMultihash())}toString(){return _r.encode(this.toMultihash().bytes).substring(1)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:Or(this.raw,e.raw)}verify(e,t,r){var s;(s=r==null?void 0:r.signal)==null||s.throwIfAborted();const i=qie(this.raw,t,e);return hM(i)?i.then(o=>{var a;return(a=r==null?void 0:r.signal)==null||a.throwIfAborted(),o}):i}}function Wie(n){return n=fM(n,fA),new Hie(n)}function fM(n,e){if(n=Uint8Array.from(n??[]),n.length!==e)throw new rr(`Key must be a Uint8Array of length ${e}, got ${n.length}`);return n}var ks;(function(n){n.RSA="RSA",n.Ed25519="Ed25519",n.secp256k1="secp256k1",n.ECDSA="ECDSA"})(ks||(ks={}));var lE;(function(n){n[n.RSA=0]="RSA",n[n.Ed25519=1]="Ed25519",n[n.secp256k1=2]="secp256k1",n[n.ECDSA=3]="ECDSA"})(lE||(lE={}));(function(n){n.codec=()=>fS(lE)})(ks||(ks={}));var sy;(function(n){let e;n.codec=()=>(e==null&&(e=pt((t,r,i={})=>{i.lengthDelimited!==!1&&r.fork(),t.Type!=null&&(r.uint32(8),ks.codec().encode(t.Type,r)),t.Data!=null&&(r.uint32(18),r.bytes(t.Data)),i.lengthDelimited!==!1&&r.ldelim()},(t,r,i={})=>{const s={},o=r==null?t.len:t.pos+r;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.Type=ks.codec().decode(t);break}case 2:{s.Data=t.bytes();break}default:{t.skipType(a&7);break}}}return s})),e),n.encode=t=>dt(t,n.codec()),n.decode=(t,r)=>ft(t,n.codec(),r)})(sy||(sy={}));var gP;(function(n){let e;n.codec=()=>(e==null&&(e=pt((t,r,i={})=>{i.lengthDelimited!==!1&&r.fork(),t.Type!=null&&(r.uint32(8),ks.codec().encode(t.Type,r)),t.Data!=null&&(r.uint32(18),r.bytes(t.Data)),i.lengthDelimited!==!1&&r.ldelim()},(t,r,i={})=>{const s={},o=r==null?t.len:t.pos+r;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.Type=ks.codec().decode(t);break}case 2:{s.Data=t.bytes();break}default:{t.skipType(a&7);break}}}return s})),e),n.encode=t=>dt(t,n.codec()),n.decode=(t,r)=>ft(t,n.codec(),r)})(gP||(gP={}));class zie{constructor(e,t){v(this,"type","RSA");v(this,"jwk");v(this,"_raw");v(this,"_multihash");this.jwk=e,this._multihash=t}get raw(){return this._raw==null&&(this._raw=Yie(this.jwk)),this._raw}toMultihash(){return this._multihash}toCID(){return zt.createV1(114,this._multihash)}toString(){return _r.encode(this.toMultihash().bytes).substring(1)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:Or(this.raw,e.raw)}verify(e,t,r){return Qie(this.jwk,t,e,r)}}const Kie=18,Vie=Uint8Array.from([48,13,6,9,42,134,72,134,247,13,1,1,1,5,0]);function Gie(n){const e=uA(n[1],{offset:0});return{kty:"RSA",n:mt(e[0],"base64url"),e:mt(e[1],"base64url")}}function Yie(n){if(n.n==null||n.e==null)throw new rr("JWK was missing components");return Jh([Vie,uM(Jh([aE(at(n.n,"base64url")),aE(at(n.e,"base64url"))]))]).subarray()}function Xie(n,e,t){const r=Gie(n);if(t==null){const i=Kc(sy.encode({Type:ks.RSA,Data:e}));t=Kf(Kie,i)}return new zie(r,t)}const Zie="1.2.840.113549.1.1.1";async function Qie(n,e,t,r){var o,a;const i=await Lf.get().subtle.importKey("jwk",n,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);(o=r==null?void 0:r.signal)==null||o.throwIfAborted();const s=await Lf.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},i,e,t instanceof Uint8Array?t:t.subarray());return(a=r==null?void 0:r.signal)==null||a.throwIfAborted(),s}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const mP=(n,e)=>(n+(n>=0?e:-e)/dM)/e;function Jie(n,e,t){const[[r,i],[s,o]]=e,a=mP(o*n,t),l=mP(-i*n,t);let c=n-a*r-l*s,h=-a*i-l*o;const d=c<uo,p=h<uo;d&&(c=-c),p&&(h=-h);const g=rd(Math.ceil(nD(t)/2))+tu;if(c<uo||c>=g||h<uo||h>=g)throw new Error("splitScalar (endomorphism): failed, k="+n);return{k1neg:d,k1:c,k2neg:p,k2:h}}function cE(n){if(!["compact","recovered","der"].includes(n))throw new Error('Signature format must be "compact", "recovered", or "der"');return n}function $w(n,e){const t={};for(let r of Object.keys(e))t[r]=n[r]===void 0?e[r]:n[r];return Fl(t.lowS,"lowS"),Fl(t.prehash,"prehash"),t.format!==void 0&&cE(t.format),t}class ese extends Error{constructor(e=""){super(e)}}const no={Err:ese,_tlv:{encode:(n,e)=>{const{Err:t}=no;if(n<0||n>256)throw new t("tlv.encode: wrong tag");if(e.length&1)throw new t("tlv.encode: unpadded data");const r=e.length/2,i=mp(r);if(i.length/2&128)throw new t("tlv.encode: long form length too big");const s=r>127?mp(i.length/2|128):"";return mp(n)+s+i+e},decode(n,e){const{Err:t}=no;let r=0;if(n<0||n>256)throw new t("tlv.encode: wrong tag");if(e.length<2||e[r++]!==n)throw new t("tlv.decode: wrong tlv");const i=e[r++],s=!!(i&128);let o=0;if(!s)o=i;else{const l=i&127;if(!l)throw new t("tlv.decode(long): indefinite length not supported");if(l>4)throw new t("tlv.decode(long): byte length is too big");const c=e.subarray(r,r+l);if(c.length!==l)throw new t("tlv.decode: length bytes not complete");if(c[0]===0)throw new t("tlv.decode(long): zero leftmost byte");for(const h of c)o=o<<8|h;if(r+=l,o<128)throw new t("tlv.decode(long): not minimal encoding")}const a=e.subarray(r,r+o);if(a.length!==o)throw new t("tlv.decode: wrong value length");return{v:a,l:e.subarray(r+o)}}},_int:{encode(n){const{Err:e}=no;if(n<uo)throw new e("integer: negative integers are not allowed");let t=mp(n);if(Number.parseInt(t[0],16)&8&&(t="00"+t),t.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return t},decode(n){const{Err:e}=no;if(n[0]&128)throw new e("invalid signature integer: negative");if(n[0]===0&&!(n[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return Xy(n)}},toSig(n){const{Err:e,_int:t,_tlv:r}=no,i=wr("signature",n),{v:s,l:o}=r.decode(48,i);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l}=r.decode(2,s),{v:c,l:h}=r.decode(2,l);if(h.length)throw new e("invalid signature: left bytes after parsing");return{r:t.decode(a),s:t.decode(c)}},hexFromSig(n){const{_tlv:e,_int:t}=no,r=e.encode(2,t.encode(n.r)),i=e.encode(2,t.encode(n.s)),s=r+i;return e.encode(48,s)}},uo=BigInt(0),tu=BigInt(1),dM=BigInt(2),Op=BigInt(3),tse=BigInt(4);function Hc(n,e){const{BYTES:t}=n;let r;if(typeof e=="bigint")r=e;else{let i=wr("private key",e);try{r=n.fromBytes(i)}catch{throw new Error(`invalid private key: expected ui8a of size ${t}, got ${typeof e}`)}}if(!n.isValidNot0(r))throw new Error("invalid private key: out of range [1..N-1]");return r}function rse(n,e={}){const t=wD("weierstrass",n,e),{Fp:r,Fn:i}=t;let s=t.CURVE;const{h:o,n:a}=s;Ku(e,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});const{endo:l}=e;if(l&&(!r.is0(s.a)||typeof l.beta!="bigint"||!Array.isArray(l.basises)))throw new Error('invalid endo: expected "beta": bigint and "basises": array');const c=gM(r,i);function h(){if(!r.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function d(C,B,N){const{x:L,y:V}=B.toAffine(),W=r.toBytes(L);if(Fl(N,"isCompressed"),N){h();const H=!r.isOdd(V);return _s(pM(H),W)}else return _s(Uint8Array.of(4),W,r.toBytes(V))}function p(C){ss(C,void 0,"Point");const{publicKey:B,publicKeyUncompressed:N}=c,L=C.length,V=C[0],W=C.subarray(1);if(L===B&&(V===2||V===3)){const H=r.fromBytes(W);if(!r.isValid(H))throw new Error("bad point: is not on curve, wrong x");const G=E(H);let z;try{z=r.sqrt(G)}catch(ie){const fe=ie instanceof Error?": "+ie.message:"";throw new Error("bad point: is not on curve, sqrt error"+fe)}h();const Z=r.isOdd(z);return(V&1)===1!==Z&&(z=r.neg(z)),{x:H,y:z}}else if(L===N&&V===4){const H=r.BYTES,G=r.fromBytes(W.subarray(0,H)),z=r.fromBytes(W.subarray(H,H*2));if(!y(G,z))throw new Error("bad point: is not on curve");return{x:G,y:z}}else throw new Error(`bad point: got length ${L}, expected compressed=${B} or uncompressed=${N}`)}const g=e.toBytes||d,m=e.fromBytes||p;function E(C){const B=r.sqr(C),N=r.mul(B,C);return r.add(r.add(N,r.mul(C,s.a)),s.b)}function y(C,B){const N=r.sqr(B),L=E(C);return r.eql(N,L)}if(!y(s.Gx,s.Gy))throw new Error("bad curve params: generator point");const S=r.mul(r.pow(s.a,Op),tse),b=r.mul(r.sqr(s.b),BigInt(27));if(r.is0(r.add(S,b)))throw new Error("bad curve params: a or b");function _(C,B,N=!1){if(!r.isValid(B)||N&&r.is0(B))throw new Error(`bad point coordinate ${C}`);return B}function I(C){if(!(C instanceof P))throw new Error("ProjectivePoint expected")}function x(C){if(!l||!l.basises)throw new Error("no endo");return Jie(C,l.basises,i.ORDER)}const $=Um((C,B)=>{const{X:N,Y:L,Z:V}=C;if(r.eql(V,r.ONE))return{x:N,y:L};const W=C.is0();B==null&&(B=W?r.ONE:r.inv(V));const H=r.mul(N,B),G=r.mul(L,B),z=r.mul(V,B);if(W)return{x:r.ZERO,y:r.ZERO};if(!r.eql(z,r.ONE))throw new Error("invZ was invalid");return{x:H,y:G}}),U=Um(C=>{if(C.is0()){if(e.allowInfinityPoint&&!r.is0(C.Y))return;throw new Error("bad point: ZERO")}const{x:B,y:N}=C.toAffine();if(!r.isValid(B)||!r.isValid(N))throw new Error("bad point: x or y not field elements");if(!y(B,N))throw new Error("bad point: equation left != right");if(!C.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function O(C,B,N,L,V){return N=new P(r.mul(N.X,C),N.Y,N.Z),B=Fm(L,B),N=Fm(V,N),B.add(N)}class P{constructor(B,N,L){this.X=_("x",B),this.Y=_("y",N,!0),this.Z=_("z",L),Object.freeze(this)}static CURVE(){return s}static fromAffine(B){const{x:N,y:L}=B||{};if(!B||!r.isValid(N)||!r.isValid(L))throw new Error("invalid affine point");if(B instanceof P)throw new Error("projective point not allowed");return r.is0(N)&&r.is0(L)?P.ZERO:new P(N,L,r.ONE)}static fromBytes(B){const N=P.fromAffine(m(ss(B,void 0,"point")));return N.assertValidity(),N}static fromHex(B){return P.fromBytes(wr("pointHex",B))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(B=8,N=!0){return K.createCache(this,B),N||this.multiply(Op),this}assertValidity(){U(this)}hasEvenY(){const{y:B}=this.toAffine();if(!r.isOdd)throw new Error("Field doesn't support isOdd");return!r.isOdd(B)}equals(B){I(B);const{X:N,Y:L,Z:V}=this,{X:W,Y:H,Z:G}=B,z=r.eql(r.mul(N,G),r.mul(W,V)),Z=r.eql(r.mul(L,G),r.mul(H,V));return z&&Z}negate(){return new P(this.X,r.neg(this.Y),this.Z)}double(){const{a:B,b:N}=s,L=r.mul(N,Op),{X:V,Y:W,Z:H}=this;let G=r.ZERO,z=r.ZERO,Z=r.ZERO,F=r.mul(V,V),ie=r.mul(W,W),fe=r.mul(H,H),J=r.mul(V,W);return J=r.add(J,J),Z=r.mul(V,H),Z=r.add(Z,Z),G=r.mul(B,Z),z=r.mul(L,fe),z=r.add(G,z),G=r.sub(ie,z),z=r.add(ie,z),z=r.mul(G,z),G=r.mul(J,G),Z=r.mul(L,Z),fe=r.mul(B,fe),J=r.sub(F,fe),J=r.mul(B,J),J=r.add(J,Z),Z=r.add(F,F),F=r.add(Z,F),F=r.add(F,fe),F=r.mul(F,J),z=r.add(z,F),fe=r.mul(W,H),fe=r.add(fe,fe),F=r.mul(fe,J),G=r.sub(G,F),Z=r.mul(fe,ie),Z=r.add(Z,Z),Z=r.add(Z,Z),new P(G,z,Z)}add(B){I(B);const{X:N,Y:L,Z:V}=this,{X:W,Y:H,Z:G}=B;let z=r.ZERO,Z=r.ZERO,F=r.ZERO;const ie=s.a,fe=r.mul(s.b,Op);let J=r.mul(N,W),_e=r.mul(L,H),oe=r.mul(V,G),ne=r.add(N,L),de=r.add(W,H);ne=r.mul(ne,de),de=r.add(J,_e),ne=r.sub(ne,de),de=r.add(N,V);let k=r.add(W,G);return de=r.mul(de,k),k=r.add(J,oe),de=r.sub(de,k),k=r.add(L,V),z=r.add(H,G),k=r.mul(k,z),z=r.add(_e,oe),k=r.sub(k,z),F=r.mul(ie,de),z=r.mul(fe,oe),F=r.add(z,F),z=r.sub(_e,F),F=r.add(_e,F),Z=r.mul(z,F),_e=r.add(J,J),_e=r.add(_e,J),oe=r.mul(ie,oe),de=r.mul(fe,de),_e=r.add(_e,oe),oe=r.sub(J,oe),oe=r.mul(ie,oe),de=r.add(de,oe),J=r.mul(_e,de),Z=r.add(Z,J),J=r.mul(k,de),z=r.mul(ne,z),z=r.sub(z,J),J=r.mul(ne,_e),F=r.mul(k,F),F=r.add(F,J),new P(z,Z,F)}subtract(B){return this.add(B.negate())}is0(){return this.equals(P.ZERO)}multiply(B){const{endo:N}=e;if(!i.isValidNot0(B))throw new Error("invalid scalar: out of range");let L,V;const W=H=>K.cached(this,H,G=>dl(P,G));if(N){const{k1neg:H,k1:G,k2neg:z,k2:Z}=x(B),{p:F,f:ie}=W(G),{p:fe,f:J}=W(Z);V=ie.add(J),L=O(N.beta,F,fe,H,z)}else{const{p:H,f:G}=W(B);L=H,V=G}return dl(P,[L,V])[0]}multiplyUnsafe(B){const{endo:N}=e,L=this;if(!i.isValid(B))throw new Error("invalid scalar: out of range");if(B===uo||L.is0())return P.ZERO;if(B===tu)return L;if(K.hasCache(this))return this.multiply(B);if(N){const{k1neg:V,k1:W,k2neg:H,k2:G}=x(B),{p1:z,p2:Z}=MZ(P,L,W,G);return O(N.beta,z,Z,V,H)}else return K.unsafe(L,B)}multiplyAndAddUnsafe(B,N,L){const V=this.multiplyUnsafe(N).add(B.multiplyUnsafe(L));return V.is0()?void 0:V}toAffine(B){return $(this,B)}isTorsionFree(){const{isTorsionFree:B}=e;return o===tu?!0:B?B(P,this):K.unsafe(this,a).is0()}clearCofactor(){const{clearCofactor:B}=e;return o===tu?this:B?B(P,this):this.multiplyUnsafe(o)}isSmallOrder(){return this.multiplyUnsafe(o).is0()}toBytes(B=!0){return Fl(B,"isCompressed"),this.assertValidity(),g(P,this,B)}toHex(B=!0){return Tl(this.toBytes(B))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get px(){return this.X}get py(){return this.X}get pz(){return this.Z}toRawBytes(B=!0){return this.toBytes(B)}_setWindowSize(B){this.precompute(B)}static normalizeZ(B){return dl(P,B)}static msm(B,N){return bD(P,i,B,N)}static fromPrivateKey(B){return P.BASE.multiply(Hc(i,B))}}P.BASE=new P(s.Gx,s.Gy,r.ONE),P.ZERO=new P(r.ZERO,r.ONE,r.ZERO),P.Fp=r,P.Fn=i;const M=i.BITS,K=new yD(P,e.endo?Math.ceil(M/2):M);return P.BASE.precompute(8),P}function pM(n){return Uint8Array.of(n?2:3)}function gM(n,e){return{secretKey:e.BYTES,publicKey:1+n.BYTES,publicKeyUncompressed:1+2*n.BYTES,publicKeyHasPrefix:!0,signature:2*e.BYTES}}function nse(n,e={}){const{Fn:t}=n,r=e.randomBytes||Ly,i=Object.assign(gM(n.Fp,t),{seed:pD(t.ORDER)});function s(g){try{return!!Hc(t,g)}catch{return!1}}function o(g,m){const{publicKey:E,publicKeyUncompressed:y}=i;try{const S=g.length;return m===!0&&S!==E||m===!1&&S!==y?!1:!!n.fromBytes(g)}catch{return!1}}function a(g=r(i.seed)){return NZ(ss(g,i.seed,"seed"),t.ORDER)}function l(g,m=!0){return n.BASE.multiply(Hc(t,g)).toBytes(m)}function c(g){const m=a(g);return{secretKey:m,publicKey:l(m)}}function h(g){if(typeof g=="bigint")return!1;if(g instanceof n)return!0;const{secretKey:m,publicKey:E,publicKeyUncompressed:y}=i;if(t.allowedLengths||m===E)return;const S=wr("key",g).length;return S===E||S===y}function d(g,m,E=!0){if(h(g)===!0)throw new Error("first arg must be private key");if(h(m)===!1)throw new Error("second arg must be public key");const y=Hc(t,g);return n.fromHex(m).multiply(y).toBytes(E)}return Object.freeze({getPublicKey:l,getSharedSecret:d,keygen:c,Point:n,utils:{isValidSecretKey:s,isValidPublicKey:o,randomSecretKey:a,isValidPrivateKey:s,randomPrivateKey:a,normPrivateKeyToScalar:g=>Hc(t,g),precompute(g=8,m=n.BASE){return m.precompute(g,!1)}},lengths:i})}function ise(n,e,t={}){Oy(e),Ku(t,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});const r=t.randomBytes||Ly,i=t.hmac||((N,...L)=>Zy(e,N,_s(...L))),{Fp:s,Fn:o}=n,{ORDER:a,BITS:l}=o,{keygen:c,getPublicKey:h,getSharedSecret:d,utils:p,lengths:g}=nse(n,t),m={prehash:!1,lowS:typeof t.lowS=="boolean"?t.lowS:!1,format:void 0,extraEntropy:!1},E="compact";function y(N){const L=a>>tu;return N>L}function S(N,L){if(!o.isValidNot0(L))throw new Error(`invalid signature ${N}: out of range 1..Point.Fn.ORDER`);return L}function b(N,L){cE(L);const V=g.signature,W=L==="compact"?V:L==="recovered"?V+1:void 0;return ss(N,W,`${L} signature`)}class _{constructor(L,V,W){this.r=S("r",L),this.s=S("s",V),W!=null&&(this.recovery=W),Object.freeze(this)}static fromBytes(L,V=E){b(L,V);let W;if(V==="der"){const{r:Z,s:F}=no.toSig(ss(L));return new _(Z,F)}V==="recovered"&&(W=L[0],V="compact",L=L.subarray(1));const H=o.BYTES,G=L.subarray(0,H),z=L.subarray(H,H*2);return new _(o.fromBytes(G),o.fromBytes(z),W)}static fromHex(L,V){return this.fromBytes(Im(L),V)}addRecoveryBit(L){return new _(this.r,this.s,L)}recoverPublicKey(L){const V=s.ORDER,{r:W,s:H,recovery:G}=this;if(G==null||![0,1,2,3].includes(G))throw new Error("recovery id invalid");if(a*dM<V&&G>1)throw new Error("recovery id is ambiguous for h>1 curve");const Z=G===2||G===3?W+a:W;if(!s.isValid(Z))throw new Error("recovery id 2 or 3 invalid");const F=s.toBytes(Z),ie=n.fromBytes(_s(pM((G&1)===0),F)),fe=o.inv(Z),J=x(wr("msgHash",L)),_e=o.create(-J*fe),oe=o.create(H*fe),ne=n.BASE.multiplyUnsafe(_e).add(ie.multiplyUnsafe(oe));if(ne.is0())throw new Error("point at infinify");return ne.assertValidity(),ne}hasHighS(){return y(this.s)}toBytes(L=E){if(cE(L),L==="der")return Im(no.hexFromSig(this));const V=o.toBytes(this.r),W=o.toBytes(this.s);if(L==="recovered"){if(this.recovery==null)throw new Error("recovery bit must be present");return _s(Uint8Array.of(this.recovery),V,W)}return _s(V,W)}toHex(L){return Tl(this.toBytes(L))}assertValidity(){}static fromCompact(L){return _.fromBytes(wr("sig",L),"compact")}static fromDER(L){return _.fromBytes(wr("sig",L),"der")}normalizeS(){return this.hasHighS()?new _(this.r,o.neg(this.s),this.recovery):this}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return Tl(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return Tl(this.toBytes("compact"))}}const I=t.bits2int||function(L){if(L.length>8192)throw new Error("input is too large");const V=Xy(L),W=L.length*8-l;return W>0?V>>BigInt(W):V},x=t.bits2int_modN||function(L){return o.create(I(L))},$=rd(l);function U(N){return Sf("num < 2^"+l,N,uo,$),o.toBytes(N)}function O(N,L){return ss(N,void 0,"message"),L?ss(e(N),void 0,"prehashed message"):N}function P(N,L,V){if(["recovered","canonical"].some(_e=>_e in V))throw new Error("sign() legacy options not supported");const{lowS:W,prehash:H,extraEntropy:G}=$w(V,m);N=O(N,H);const z=x(N),Z=Hc(o,L),F=[U(Z),U(z)];if(G!=null&&G!==!1){const _e=G===!0?r(g.secretKey):G;F.push(wr("extraEntropy",_e))}const ie=_s(...F),fe=z;function J(_e){const oe=I(_e);if(!o.isValidNot0(oe))return;const ne=o.inv(oe),de=n.BASE.multiply(oe).toAffine(),k=o.create(de.x);if(k===uo)return;const X=o.create(ne*o.create(fe+k*Z));if(X===uo)return;let ee=(de.x===k?0:2)|Number(de.y&tu),me=X;return W&&y(X)&&(me=o.neg(X),ee^=1),new _(k,me,ee)}return{seed:ie,k2sig:J}}function M(N,L,V={}){N=wr("message",N);const{seed:W,k2sig:H}=P(N,L,V);return AZ(e.outputLen,o.BYTES,i)(W,H)}function K(N){let L;const V=typeof N=="string"||Vf(N),W=!V&&N!==null&&typeof N=="object"&&typeof N.r=="bigint"&&typeof N.s=="bigint";if(!V&&!W)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");if(W)L=new _(N.r,N.s);else if(V){try{L=_.fromBytes(wr("sig",N),"der")}catch(H){if(!(H instanceof no.Err))throw H}if(!L)try{L=_.fromBytes(wr("sig",N),"compact")}catch{return!1}}return L||!1}function C(N,L,V,W={}){const{lowS:H,prehash:G,format:z}=$w(W,m);if(V=wr("publicKey",V),L=O(wr("message",L),G),"strict"in W)throw new Error("options.strict was renamed to lowS");const Z=z===void 0?K(N):_.fromBytes(wr("sig",N),z);if(Z===!1)return!1;try{const F=n.fromBytes(V);if(H&&Z.hasHighS())return!1;const{r:ie,s:fe}=Z,J=x(L),_e=o.inv(fe),oe=o.create(J*_e),ne=o.create(ie*_e),de=n.BASE.multiplyUnsafe(oe).add(F.multiplyUnsafe(ne));return de.is0()?!1:o.create(de.x)===ie}catch{return!1}}function B(N,L,V={}){const{prehash:W}=$w(V,m);return L=O(L,W),_.fromBytes(N,"recovered").recoverPublicKey(L).toBytes()}return Object.freeze({keygen:c,getPublicKey:h,getSharedSecret:d,utils:p,lengths:g,Point:n,sign:M,verify:C,recoverPublicKey:B,Signature:_,hash:e})}function sse(n){const e={a:n.a,b:n.b,p:n.Fp.ORDER,n:n.n,h:n.h,Gx:n.Gx,Gy:n.Gy},t=n.Fp;let r=n.allowedPrivateKeyLengths?Array.from(new Set(n.allowedPrivateKeyLengths.map(o=>Math.ceil(o/2)))):void 0;const i=Xl(e.n,{BITS:n.nBitLength,allowedLengths:r,modFromBytes:n.wrapPrivateKey}),s={Fp:t,Fn:i,allowInfinityPoint:n.allowInfinityPoint,endo:n.endo,isTorsionFree:n.isTorsionFree,clearCofactor:n.clearCofactor,fromBytes:n.fromBytes,toBytes:n.toBytes};return{CURVE:e,curveOpts:s}}function ose(n){const{CURVE:e,curveOpts:t}=sse(n),r={hmac:n.hmac,randomBytes:n.randomBytes,lowS:n.lowS,bits2int:n.bits2int,bits2int_modN:n.bits2int_modN};return{CURVE:e,curveOpts:t,hash:n.hash,ecdsaOpts:r}}function ase(n,e){const t=e.Point;return Object.assign({},e,{ProjectivePoint:t,CURVE:Object.assign({},n,fD(t.Fn.ORDER,t.Fn.BITS))})}function lse(n){const{CURVE:e,curveOpts:t,hash:r,ecdsaOpts:i}=ose(n),s=rse(e,t),o=ise(s,r,i);return ase(n,o)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function cse(n,e){const t=r=>lse({...n,hash:r});return{...t(e),create:t}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const dA={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),n:BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),h:BigInt(1),a:BigInt(0),b:BigInt(7),Gx:BigInt("0x79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798"),Gy:BigInt("0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8")},use={beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),basises:[[BigInt("0x3086d221a7d46bcde86c90e49284eb15"),-BigInt("0xe4437ed6010e88286f547fa90abfe4c3")],[BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),BigInt("0x3086d221a7d46bcde86c90e49284eb15")]]},yP=BigInt(2);function hse(n){const e=dA.p,t=BigInt(3),r=BigInt(6),i=BigInt(11),s=BigInt(22),o=BigInt(23),a=BigInt(44),l=BigInt(88),c=n*n*n%e,h=c*c*n%e,d=Ar(h,t,e)*h%e,p=Ar(d,t,e)*h%e,g=Ar(p,yP,e)*c%e,m=Ar(g,i,e)*g%e,E=Ar(m,s,e)*m%e,y=Ar(E,a,e)*E%e,S=Ar(y,l,e)*y%e,b=Ar(S,a,e)*E%e,_=Ar(b,t,e)*h%e,I=Ar(_,o,e)*m%e,x=Ar(I,r,e)*c%e,$=Ar(x,yP,e);if(!uE.eql(uE.sqr($),n))throw new Error("Cannot find square root");return $}const uE=Xl(dA.p,{sqrt:hse}),oy=cse({...dA,Fp:uE,lowS:!0,endo:use},bL),fse=33;function dse(n,e,t,r){var s;const i=hS.digest(t instanceof Uint8Array?t:t.subarray());if(hM(i))return i.then(({digest:o})=>{var a;return(a=r==null?void 0:r.signal)==null||a.throwIfAborted(),oy.verify(e,o,n)}).catch(o=>{throw o.name==="AbortError"?o:new pP(String(o))});try{return(s=r==null?void 0:r.signal)==null||s.throwIfAborted(),oy.verify(e,i.digest,n)}catch(o){throw new pP(String(o))}}class pse{constructor(e){v(this,"type","secp256k1");v(this,"raw");v(this,"_key");this._key=yse(e),this.raw=mse(this._key)}toMultihash(){return Ia.digest(pA(this))}toCID(){return zt.createV1(114,this.toMultihash())}toString(){return _r.encode(this.toMultihash().bytes).substring(1)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:Or(this.raw,e.raw)}verify(e,t,r){return dse(this._key,t,e,r)}}function gse(n){return new pse(n)}function mse(n){return oy.ProjectivePoint.fromHex(n).toRawBytes(!0)}function yse(n){try{return oy.ProjectivePoint.fromHex(n),n}catch(e){throw new kz(String(e))}}function bse(n){var r,i;if(n.byteLength===fA)return Wie(n);if(n.byteLength===fse)return gse(n);const e=uA(n),t=(r=e[1])==null?void 0:r[0];if(t===xie||t===Iie||t===Tie)return Die(e);if(((i=e[0])==null?void 0:i[0])===Zie)return Xie(e,n);throw new rr("Could not extract public key from raw bytes")}function pA(n){return sy.encode({Type:ks[n.type],Data:n.raw})}const wse=Symbol.for("nodejs.util.inspect.custom"),vse=114;var hO;class gA{constructor(e){v(this,"type");v(this,"multihash");v(this,"publicKey");v(this,"string");v(this,hO,!0);this.type=e.type,this.multihash=e.multihash,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return`PeerId(${this.toString()})`}toString(){return this.string==null&&(this.string=_r.encode(this.multihash.bytes).slice(1)),this.string}toMultihash(){return this.multihash}toCID(){return zt.createV1(vse,this.multihash)}toJSON(){return this.toString()}equals(e){var t;if(e==null)return!1;if(e instanceof Uint8Array)return Or(this.multihash.bytes,e);if(typeof e=="string")return this.toString()===e;if(((t=e==null?void 0:e.toMultihash())==null?void 0:t.bytes)!=null)return Or(this.multihash.bytes,e.toMultihash().bytes);throw new Error("not valid Id")}[(hO=Dy,wse)](){return`PeerId(${this.toString()})`}}class _se extends gA{constructor(t){super({...t,type:"RSA"});v(this,"type","RSA");v(this,"publicKey");this.publicKey=t.publicKey}}class Ese extends gA{constructor(t){super({...t,type:"Ed25519"});v(this,"type","Ed25519");v(this,"publicKey");this.publicKey=t.publicKey}}class Sse extends gA{constructor(t){super({...t,type:"secp256k1"});v(this,"type","secp256k1");v(this,"publicKey");this.publicKey=t.publicKey}}function Ase(n){if(n.type==="Ed25519")return new Ese({multihash:n.toCID().multihash,publicKey:n});if(n.type==="secp256k1")return new Sse({multihash:n.toCID().multihash,publicKey:n});if(n.type==="RSA")return new _se({multihash:n.toCID().multihash,publicKey:n});throw new BL}const xse="Keypair type not implemented";function Ise(n){const e=bse(n);if(e.type!=="secp256k1")throw new Error(xse);return Ase(e)}function Tse(n){const e=[];let t=0;for(;t<n.length;){const i=new DataView(n.buffer,t,ry).getUint16(0);t+=ry;const s=n.slice(t,t+i);t+=i,e.push(Nt(s))}return e}function Cse(n){const e=n.reduce((s,o)=>s+ry+o.bytes.length,0),t=new Uint8Array(e),r=new DataView(t.buffer);let i=0;return n.forEach(s=>{if(s.getPeerId())throw new Error("`multiaddr` field MUST not contain peer id");r.setUint16(i,s.bytes.length),i+=ry,t.set(s.bytes,i),i+=s.bytes.length}),t}function kse(n){let e=0;return n.lightPush&&(e+=1),e=e<<1,n.filter&&(e+=1),e=e<<1,n.store&&(e+=1),e=e<<1,n.relay&&(e+=1),e}function Pse(n){const e={relay:!1,store:!1,filter:!1,lightPush:!1};return n%2&&(e.relay=!0),n=n>>1,n%2&&(e.store=!0),n=n>>1,n%2&&(e.filter=!0),n=n>>1,n%2&&(e.lightPush=!0),e}class Rse extends Map{constructor(t={},r=BigInt(1),i){super(Object.entries(t));v(this,"seq");v(this,"signature");this.seq=r,this.signature=i}set(t,r){return this.signature=void 0,this.seq++,super.set(t,r)}get id(){const t=this.get("id");if(!t)throw new Error("id not found.");return uf(t)}get publicKey(){switch(this.id){case"v4":return this.get("secp256k1");default:throw new Error(Ng)}}get rs(){const t=this.get("rs");if(t)return w1(t)}get rsv(){const t=this.get("rsv");if(t)return w1(t)}get ip(){return bP(this,"ip","ip4")}set ip(t){hE(this,"ip","ip4",t)}get tcp(){return Lp(this,"tcp","tcp")}set tcp(t){Np(this,"tcp","tcp",t)}get udp(){return Lp(this,"udp","udp")}set udp(t){Np(this,"udp","udp",t)}get ip6(){return bP(this,"ip6","ip6")}set ip6(t){hE(this,"ip6","ip6",t)}get tcp6(){return Lp(this,"tcp6","tcp")}set tcp6(t){Np(this,"tcp6","tcp",t)}get udp6(){return Lp(this,"udp6","udp")}set udp6(t){Np(this,"udp6","udp",t)}get multiaddrs(){const t=this.get("multiaddrs");if(t)return Tse(t)}set multiaddrs(t){fE(this,"multiaddrs",t,Cse)}get waku2(){const t=this.get("waku2");if(t)return Pse(t[0])}set waku2(t){fE(this,"waku2",t,r=>new Uint8Array([kse(r)]))}}function bP(n,e,t){const r=n.get(e);if(r)return $m(t,r)}function Lp(n,e,t){const r=n.get(e);if(r)return Number($m(t,r))}function hE(n,e,t,r){fE(n,e,r,NY.bind({},t))}function Np(n,e,t,r){hE(n,e,t,r==null?void 0:r.toString(10))}function fE(n,e,t,r){t!==void 0?n.set(e,r(t)):n.delete(e)}async function Ose(n,e){return hie(lb(e),n,{der:!1})}function Lse(n){const t=fr.fromHex(n).toRawBytes(!1);return Ny(lb(t.slice(1)))}const wP=new Ct("enr");var vP;(function(n){n.TCP="tcp",n.UDP="udp"})(vP||(vP={}));var dE;(function(n){n.TCP4="tcp4",n.UDP4="udp4",n.TCP6="tcp6",n.UDP6="udp6"})(dE||(dE={}));const yy=class yy extends Rse{constructor(){super(...arguments);v(this,"peerId");v(this,"getLocationMultiaddr",$h.bind({},this))}static create(t={},r=BigInt(1),i){const s=new yy(t,r,i);try{const o=s.publicKey;o&&(s.peerId=Ise(o))}catch(o){wP.error("Could not calculate peer id for ENR",o)}return s}get nodeId(){switch(this.id){case"v4":return this.publicKey?Lse(this.publicKey):void 0;default:throw new Error(Ng)}}get shardInfo(){return this.rs&&this.rsv&&wP.warn("ENR contains both `rs` and `rsv` fields."),this.rs||this.rsv}setLocationMultiaddr(t){const r=t.protoNames();if(r.length!==2&&r[1]!=="udp"&&r[1]!=="tcp")throw new Error("Invalid multiaddr");const i=t.tuples();if(!i[0][1]||!i[1][1])throw new Error("Invalid multiaddr");i[0][0]===4?(this.set("ip",i[0][1]),this.set(r[1],i[1][1])):(this.set("ip6",i[0][1]),this.set(r[1]+"6",i[1][1]))}getAllLocationMultiaddrs(){const t=[];for(const i of Object.values(dE)){const s=this.getLocationMultiaddr(i);s&&t.push(s)}const r=this.multiaddrs??[];return t.concat(r).map(i=>this.peerId?i.encapsulate(`/p2p/${this.peerId.toString()}`):i)}get peerInfo(){const t=this.peerId;if(t)return{id:t,multiaddrs:this.getAllLocationMultiaddrs()}}getFullMultiaddr(t){if(this.peerId){const r=this.getLocationMultiaddr(t);if(r)return r.encapsulate(`/p2p/${this.peerId.toString()}`)}}getFullMultiaddrs(){if(this.peerId&&this.multiaddrs){const t=this.peerId;return this.multiaddrs.map(r=>r.encapsulate(`/p2p/${t.toString()}`))}return[]}verify(t,r){if(!this.get("id")||this.id!=="v4")throw new Error(Ng);if(!this.publicKey)throw new Error("Failed to verify ENR: No public key");return cM(r,lb(t),this.publicKey)}async sign(t,r){switch(this.id){case"v4":this.signature=await Ose(r,t);break;default:throw new Error(Ng)}return this.signature}};v(yy,"RECORD_PREFIX","enr:");let Uu=yy;const Nse="logger/5.8.0";let _P=!1,EP=!1;const Dg={debug:1,default:2,info:2,warning:3,error:4,off:5};let SP=Dg.default,Mw=null;function Dse(){try{const n=[];if(["NFD","NFC","NFKD","NFKC"].forEach(e=>{try{if("test".normalize(e)!=="test")throw new Error("bad normalize")}catch{n.push(e)}}),n.length)throw new Error("missing "+n.join(", "));if("".normalize("NFD")!=="e")throw new Error("broken implementation")}catch(n){return n.message}return null}const AP=Dse();var pE;(function(n){n.DEBUG="DEBUG",n.INFO="INFO",n.WARNING="WARNING",n.ERROR="ERROR",n.OFF="OFF"})(pE||(pE={}));var ts;(function(n){n.UNKNOWN_ERROR="UNKNOWN_ERROR",n.NOT_IMPLEMENTED="NOT_IMPLEMENTED",n.UNSUPPORTED_OPERATION="UNSUPPORTED_OPERATION",n.NETWORK_ERROR="NETWORK_ERROR",n.SERVER_ERROR="SERVER_ERROR",n.TIMEOUT="TIMEOUT",n.BUFFER_OVERRUN="BUFFER_OVERRUN",n.NUMERIC_FAULT="NUMERIC_FAULT",n.MISSING_NEW="MISSING_NEW",n.INVALID_ARGUMENT="INVALID_ARGUMENT",n.MISSING_ARGUMENT="MISSING_ARGUMENT",n.UNEXPECTED_ARGUMENT="UNEXPECTED_ARGUMENT",n.CALL_EXCEPTION="CALL_EXCEPTION",n.INSUFFICIENT_FUNDS="INSUFFICIENT_FUNDS",n.NONCE_EXPIRED="NONCE_EXPIRED",n.REPLACEMENT_UNDERPRICED="REPLACEMENT_UNDERPRICED",n.UNPREDICTABLE_GAS_LIMIT="UNPREDICTABLE_GAS_LIMIT",n.TRANSACTION_REPLACED="TRANSACTION_REPLACED",n.ACTION_REJECTED="ACTION_REJECTED"})(ts||(ts={}));const xP="0123456789abcdef";class Ht{constructor(e){Object.defineProperty(this,"version",{enumerable:!0,value:e,writable:!1})}_log(e,t){const r=e.toLowerCase();Dg[r]==null&&this.throwArgumentError("invalid log level name","logLevel",e),!(SP>Dg[r])&&console.log.apply(console,t)}debug(...e){this._log(Ht.levels.DEBUG,e)}info(...e){this._log(Ht.levels.INFO,e)}warn(...e){this._log(Ht.levels.WARNING,e)}makeError(e,t,r){if(EP)return this.makeError("censored error",t,{});t||(t=Ht.errors.UNKNOWN_ERROR),r||(r={});const i=[];Object.keys(r).forEach(l=>{const c=r[l];try{if(c instanceof Uint8Array){let h="";for(let d=0;d<c.length;d++)h+=xP[c[d]>>4],h+=xP[c[d]&15];i.push(l+"=Uint8Array(0x"+h+")")}else i.push(l+"="+JSON.stringify(c))}catch{i.push(l+"="+JSON.stringify(r[l].toString()))}}),i.push(`code=${t}`),i.push(`version=${this.version}`);const s=e;let o="";switch(t){case ts.NUMERIC_FAULT:{o="NUMERIC_FAULT";const l=e;switch(l){case"overflow":case"underflow":case"division-by-zero":o+="-"+l;break;case"negative-power":case"negative-width":o+="-unsupported";break;case"unbound-bitwise-result":o+="-unbound-result";break}break}case ts.CALL_EXCEPTION:case ts.INSUFFICIENT_FUNDS:case ts.MISSING_NEW:case ts.NONCE_EXPIRED:case ts.REPLACEMENT_UNDERPRICED:case ts.TRANSACTION_REPLACED:case ts.UNPREDICTABLE_GAS_LIMIT:o=t;break}o&&(e+=" [ See: https://links.ethers.org/v5-errors-"+o+" ]"),i.length&&(e+=" ("+i.join(", ")+")");const a=new Error(e);return a.reason=s,a.code=t,Object.keys(r).forEach(function(l){a[l]=r[l]}),a}throwError(e,t,r){throw this.makeError(e,t,r)}throwArgumentError(e,t,r){return this.throwError(e,Ht.errors.INVALID_ARGUMENT,{argument:t,value:r})}assert(e,t,r,i){e||this.throwError(t,r,i)}assertArgument(e,t,r,i){e||this.throwArgumentError(t,r,i)}checkNormalize(e){AP&&this.throwError("platform missing String.prototype.normalize",Ht.errors.UNSUPPORTED_OPERATION,{operation:"String.prototype.normalize",form:AP})}checkSafeUint53(e,t){typeof e=="number"&&(t==null&&(t="value not safe"),(e<0||e>=9007199254740991)&&this.throwError(t,Ht.errors.NUMERIC_FAULT,{operation:"checkSafeInteger",fault:"out-of-safe-range",value:e}),e%1&&this.throwError(t,Ht.errors.NUMERIC_FAULT,{operation:"checkSafeInteger",fault:"non-integer",value:e}))}checkArgumentCount(e,t,r){r?r=": "+r:r="",e<t&&this.throwError("missing argument"+r,Ht.errors.MISSING_ARGUMENT,{count:e,expectedCount:t}),e>t&&this.throwError("too many arguments"+r,Ht.errors.UNEXPECTED_ARGUMENT,{count:e,expectedCount:t})}checkNew(e,t){(e===Object||e==null)&&this.throwError("missing new",Ht.errors.MISSING_NEW,{name:t.name})}checkAbstract(e,t){e===t?this.throwError("cannot instantiate abstract class "+JSON.stringify(t.name)+" directly; use a sub-class",Ht.errors.UNSUPPORTED_OPERATION,{name:e.name,operation:"new"}):(e===Object||e==null)&&this.throwError("missing new",Ht.errors.MISSING_NEW,{name:t.name})}static globalLogger(){return Mw||(Mw=new Ht(Nse)),Mw}static setCensorship(e,t){if(!e&&t&&this.globalLogger().throwError("cannot permanently disable censorship",Ht.errors.UNSUPPORTED_OPERATION,{operation:"setCensorship"}),_P){if(!e)return;this.globalLogger().throwError("error censorship permanent",Ht.errors.UNSUPPORTED_OPERATION,{operation:"setCensorship"})}EP=!!e,_P=!!t}static setLogLevel(e){const t=Dg[e.toLowerCase()];if(t==null){Ht.globalLogger().warn("invalid log level - "+e);return}SP=t}static from(e){return new Ht(e)}}Ht.errors=ts;Ht.levels=pE;const $se="bytes/5.8.0",ru=new Ht($se);function mM(n){return!!n.toHexString}function $g(n){return n.slice||(n.slice=function(){const e=Array.prototype.slice.call(arguments);return $g(new Uint8Array(Array.prototype.slice.apply(n,e)))}),n}function Mse(n){return yA(n)&&!(n.length%2)||mA(n)}function IP(n){return typeof n=="number"&&n==n&&n%1===0}function mA(n){if(n==null)return!1;if(n.constructor===Uint8Array)return!0;if(typeof n=="string"||!IP(n.length)||n.length<0)return!1;for(let e=0;e<n.length;e++){const t=n[e];if(!IP(t)||t<0||t>=256)return!1}return!0}function yM(n,e){if(e||(e={}),typeof n=="number"){ru.checkSafeUint53(n,"invalid arrayify value");const t=[];for(;n;)t.unshift(n&255),n=parseInt(String(n/256));return t.length===0&&t.push(0),$g(new Uint8Array(t))}if(e.allowMissingPrefix&&typeof n=="string"&&n.substring(0,2)!=="0x"&&(n="0x"+n),mM(n)&&(n=n.toHexString()),yA(n)){let t=n.substring(2);t.length%2&&(e.hexPad==="left"?t="0"+t:e.hexPad==="right"?t+="0":ru.throwArgumentError("hex data is odd-length","value",n));const r=[];for(let i=0;i<t.length;i+=2)r.push(parseInt(t.substring(i,i+2),16));return $g(new Uint8Array(r))}return mA(n)?$g(new Uint8Array(n)):ru.throwArgumentError("invalid arrayify value","value",n)}function yA(n,e){return!(typeof n!="string"||!n.match(/^0x[0-9A-Fa-f]*$/))}const Bw="0123456789abcdef";function Mg(n,e){if(e||(e={}),typeof n=="number"){ru.checkSafeUint53(n,"invalid hexlify value");let t="";for(;n;)t=Bw[n&15]+t,n=Math.floor(n/16);return t.length?(t.length%2&&(t="0"+t),"0x"+t):"0x00"}if(typeof n=="bigint")return n=n.toString(16),n.length%2?"0x0"+n:"0x"+n;if(e.allowMissingPrefix&&typeof n=="string"&&n.substring(0,2)!=="0x"&&(n="0x"+n),mM(n))return n.toHexString();if(yA(n))return n.length%2&&(e.hexPad==="left"?n="0x0"+n.substring(2):e.hexPad==="right"?n+="0":ru.throwArgumentError("hex data is odd-length","value",n)),n.toLowerCase();if(mA(n)){let t="0x";for(let r=0;r<n.length;r++){let i=n[r];t+=Bw[(i&240)>>4]+Bw[i&15]}return t}return ru.throwArgumentError("invalid hexlify value","value",n)}const Bse="rlp/5.8.0",gs=new Ht(Bse);function TP(n){const e=[];for(;n;)e.unshift(n&255),n>>=8;return e}function CP(n,e,t){let r=0;for(let i=0;i<t;i++)r=r*256+n[e+i];return r}function bM(n){if(Array.isArray(n)){let r=[];if(n.forEach(function(s){r=r.concat(bM(s))}),r.length<=55)return r.unshift(192+r.length),r;const i=TP(r.length);return i.unshift(247+i.length),i.concat(r)}Mse(n)||gs.throwArgumentError("RLP object must be BytesLike","object",n);const e=Array.prototype.slice.call(yM(n));if(e.length===1&&e[0]<=127)return e;if(e.length<=55)return e.unshift(128+e.length),e;const t=TP(e.length);return t.unshift(183+t.length),t.concat(e)}function Use(n){return Mg(bM(n))}function kP(n,e,t,r){const i=[];for(;t<e+1+r;){const s=wM(n,t);i.push(s.result),t+=s.consumed,t>e+1+r&&gs.throwError("child data too short",Ht.errors.BUFFER_OVERRUN,{})}return{consumed:1+r,result:i}}function wM(n,e){if(n.length===0&&gs.throwError("data too short",Ht.errors.BUFFER_OVERRUN,{}),n[e]>=248){const t=n[e]-247;e+1+t>n.length&&gs.throwError("data short segment too short",Ht.errors.BUFFER_OVERRUN,{});const r=CP(n,e+1,t);return e+1+t+r>n.length&&gs.throwError("data long segment too short",Ht.errors.BUFFER_OVERRUN,{}),kP(n,e,e+1+t,t+r)}else if(n[e]>=192){const t=n[e]-192;return e+1+t>n.length&&gs.throwError("data array too short",Ht.errors.BUFFER_OVERRUN,{}),kP(n,e,e+1,t)}else if(n[e]>=184){const t=n[e]-183;e+1+t>n.length&&gs.throwError("data array too short",Ht.errors.BUFFER_OVERRUN,{});const r=CP(n,e+1,t);e+1+t+r>n.length&&gs.throwError("data array too short",Ht.errors.BUFFER_OVERRUN,{});const i=Mg(n.slice(e+1+t,e+1+t+r));return{consumed:1+t+r,result:i}}else if(n[e]>=128){const t=n[e]-128;e+1+t>n.length&&gs.throwError("data too short",Ht.errors.BUFFER_OVERRUN,{});const r=Mg(n.slice(e+1,e+1+t));return{consumed:1+t,result:r}}return{consumed:1,result:Mg(n[e])}}function Fse(n){const e=yM(n),t=wM(e,0);return t.consumed!==e.length&&gs.throwArgumentError("invalid rlp data","data",n),t.result}const jse=new Ct("enr:decoder");class cb{static fromString(e){if(!e.startsWith(Uu.RECORD_PREFIX))throw new Error(`"string encoded ENR must start with '${Uu.RECORD_PREFIX}'`);return cb.fromRLP(at(e.slice(4),"base64url"))}static fromRLP(e){const t=Fse(e).map(wL);return qse(t)}}async function qse(n){const{signature:e,seq:t,kvs:r}=Wse(n),i={};for(let a=0;a<r.length;a+=2)try{i[uf(r[a])]=r[a+1]}catch(l){jse.error("Failed to decode ENR key to UTF-8, skipping it",r[a],l)}const s=Hse(t),o=Uu.create(i,s,e);return zse(t,r,o,e),o}function Hse(n){return n.length?BigInt("0x"+Ny(n)):BigInt(0)}function Wse(n){if(!Array.isArray(n))throw new Error("Decoded ENR must be an array");if(n.length%2!==0)throw new Error("Decoded ENR must have an even number of elements");const[e,t,...r]=n;if(!e||Array.isArray(e))throw new Error("Decoded ENR invalid signature: must be a byte array");if(!t||Array.isArray(t))throw new Error("Decoded ENR invalid sequence number: must be a byte array");return{signature:e,seq:t,kvs:r}}function zse(n,e,t,r){const i=wL(Use([n,...e]));if(!t.verify(i,r))throw new Error("Unable to verify ENR signature")}var yi,sr,yr,ua,fu,ha,$t,Bg,Qi,vM,gE,mE,yE,_M,Ug;class PP extends Map{constructor(t={}){super();Qe(this,$t);Qe(this,yi,0);Qe(this,sr,new Map);Qe(this,yr,new Map);Qe(this,ua);Qe(this,fu);Qe(this,ha);if(!(t.maxSize&&t.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");if(typeof t.maxAge=="number"&&t.maxAge===0)throw new TypeError("`maxAge` must be a number greater than 0");qe(this,ua,t.maxSize),qe(this,fu,t.maxAge||Number.POSITIVE_INFINITY),qe(this,ha,t.onEviction)}get __oldCache(){return q(this,yr)}get(t){if(q(this,sr).has(t)){const r=q(this,sr).get(t);return Pe(this,$t,gE).call(this,t,r)}if(q(this,yr).has(t)){const r=q(this,yr).get(t);if(Pe(this,$t,Qi).call(this,t,r)===!1)return Pe(this,$t,_M).call(this,t,r),r.value}}set(t,r,{maxAge:i=q(this,fu)}={}){const s=typeof i=="number"&&i!==Number.POSITIVE_INFINITY?Date.now()+i:void 0;return q(this,sr).has(t)?q(this,sr).set(t,{value:r,expiry:s}):Pe(this,$t,yE).call(this,t,{value:r,expiry:s}),this}has(t){return q(this,sr).has(t)?!Pe(this,$t,Qi).call(this,t,q(this,sr).get(t)):q(this,yr).has(t)?!Pe(this,$t,Qi).call(this,t,q(this,yr).get(t)):!1}peek(t){if(q(this,sr).has(t))return Pe(this,$t,mE).call(this,t,q(this,sr));if(q(this,yr).has(t))return Pe(this,$t,mE).call(this,t,q(this,yr))}expiresIn(t){const r=q(this,sr).get(t)??q(this,yr).get(t);if(r)return r.expiry?r.expiry-Date.now():Number.POSITIVE_INFINITY}delete(t){const r=q(this,sr).delete(t);return r&&Gi(this,yi)._--,q(this,yr).delete(t)||r}clear(){q(this,sr).clear(),q(this,yr).clear(),qe(this,yi,0)}resize(t){if(!(t&&t>0))throw new TypeError("`maxSize` must be a number greater than 0");const r=[...Pe(this,$t,Ug).call(this)],i=r.length-t;i<0?(qe(this,sr,new Map(r)),qe(this,yr,new Map),qe(this,yi,r.length)):(i>0&&Pe(this,$t,Bg).call(this,r.slice(0,i)),qe(this,yr,new Map(r.slice(i))),qe(this,sr,new Map),qe(this,yi,0)),qe(this,ua,t)}evict(t=1){const r=Number(t);if(!r||r<=0)return;const i=[...Pe(this,$t,Ug).call(this)],s=Math.trunc(Math.min(r,Math.max(i.length-1,0)));s<=0||(Pe(this,$t,Bg).call(this,i.slice(0,s)),qe(this,yr,new Map(i.slice(s))),qe(this,sr,new Map),qe(this,yi,0))}*keys(){for(const[t]of this)yield t}*values(){for(const[,t]of this)yield t}*[Symbol.iterator](){for(const t of q(this,sr)){const[r,i]=t;Pe(this,$t,Qi).call(this,r,i)===!1&&(yield[r,i.value])}for(const t of q(this,yr)){const[r,i]=t;q(this,sr).has(r)||Pe(this,$t,Qi).call(this,r,i)===!1&&(yield[r,i.value])}}*entriesDescending(){let t=[...q(this,sr)];for(let r=t.length-1;r>=0;--r){const i=t[r],[s,o]=i;Pe(this,$t,Qi).call(this,s,o)===!1&&(yield[s,o.value])}t=[...q(this,yr)];for(let r=t.length-1;r>=0;--r){const i=t[r],[s,o]=i;q(this,sr).has(s)||Pe(this,$t,Qi).call(this,s,o)===!1&&(yield[s,o.value])}}*entriesAscending(){for(const[t,r]of Pe(this,$t,Ug).call(this))yield[t,r.value]}get size(){if(!q(this,yi))return q(this,yr).size;let t=0;for(const r of q(this,yr).keys())q(this,sr).has(r)||t++;return Math.min(q(this,yi)+t,q(this,ua))}get maxSize(){return q(this,ua)}get maxAge(){return q(this,fu)}entries(){return this.entriesAscending()}forEach(t,r=this){for(const[i,s]of this.entriesAscending())t.call(r,s,i,this)}get[Symbol.toStringTag](){return"QuickLRU"}toString(){return`QuickLRU(${this.size}/${this.maxSize})`}[Symbol.for("nodejs.util.inspect.custom")](){return this.toString()}}yi=new WeakMap,sr=new WeakMap,yr=new WeakMap,ua=new WeakMap,fu=new WeakMap,ha=new WeakMap,$t=new WeakSet,Bg=function(t){if(typeof q(this,ha)=="function")for(const[r,i]of t)q(this,ha).call(this,r,i.value)},Qi=function(t,r){return typeof r.expiry=="number"&&r.expiry<=Date.now()?(typeof q(this,ha)=="function"&&q(this,ha).call(this,t,r.value),this.delete(t)):!1},vM=function(t,r){if(Pe(this,$t,Qi).call(this,t,r)===!1)return r.value},gE=function(t,r){return r.expiry?Pe(this,$t,vM).call(this,t,r):r.value},mE=function(t,r){const i=r.get(t);return Pe(this,$t,gE).call(this,t,i)},yE=function(t,r){q(this,sr).set(t,r),Gi(this,yi)._++,q(this,yi)>=q(this,ua)&&(qe(this,yi,0),Pe(this,$t,Bg).call(this,q(this,yr)),qe(this,yr,q(this,sr)),qe(this,sr,new Map))},_M=function(t,r){q(this,yr).delete(t),Pe(this,$t,yE).call(this,t,r)},Ug=function*(){for(const t of q(this,yr)){const[r,i]=t;q(this,sr).has(r)||Pe(this,$t,Qi).call(this,r,i)===!1&&(yield t)}for(const t of q(this,sr)){const[r,i]=t;Pe(this,$t,Qi).call(this,r,i)===!1&&(yield t)}};function Uw(n,e,t){return`${n}?name=${e}&type=${t}`}async function Kse(n,e){return await(await fetch(n,{headers:new Headers({accept:"application/dns-json"}),signal:e})).json()}function kc(n,e){return`${e}_${n}`}const Fw=Object.assign(Bn("dns-over-http-resolver"),{error:Bn("dns-over-http-resolver:error")});class Vse{constructor(e={}){v(this,"_cache");v(this,"_TXTcache");v(this,"_servers");v(this,"_request");v(this,"_abortControllers");this._cache=new PP({maxSize:(e==null?void 0:e.maxCache)??100}),this._TXTcache=new PP({maxSize:(e==null?void 0:e.maxCache)??100}),this._servers=["https://cloudflare-dns.com/dns-query","https://dns.google/resolve"],this._request=e.request??Kse,this._abortControllers=[]}cancel(){this._abortControllers.forEach(e=>{e.abort()})}getServers(){return this._servers}_getShuffledServers(){const e=[...this._servers];for(let t=e.length-1;t>0;t--){const r=Math.floor(Math.random()*t),i=e[t];e[t]=e[r],e[r]=i}return e}setServers(e){this._servers=e}async resolve(e,t="A"){switch(t){case"A":return this.resolve4(e);case"AAAA":return this.resolve6(e);case"TXT":return this.resolveTxt(e);default:throw new Error(`${t} is not supported`)}}async resolve4(e){const t="A",r=this._cache.get(kc(e,t));if(r!=null)return r;let i=!1;for(const s of this._getShuffledServers()){const o=new AbortController;this._abortControllers.push(o);try{const a=await this._request(Uw(s,e,t),o.signal),l=a.Answer.map(h=>h.data),c=Math.min(...a.Answer.map(h=>h.TTL));return this._cache.set(kc(e,t),l,{maxAge:c}),l}catch{o.signal.aborted&&(i=!0),Fw.error(`${s} could not resolve ${e} record ${t}`)}finally{this._abortControllers=this._abortControllers.filter(a=>a!==o)}}throw i?Object.assign(new Error("queryA ECANCELLED"),{code:"ECANCELLED"}):new Error(`Could not resolve ${e} record ${t}`)}async resolve6(e){const t="AAAA",r=this._cache.get(kc(e,t));if(r!=null)return r;let i=!1;for(const s of this._getShuffledServers()){const o=new AbortController;this._abortControllers.push(o);try{const a=await this._request(Uw(s,e,t),o.signal),l=a.Answer.map(h=>h.data),c=Math.min(...a.Answer.map(h=>h.TTL));return this._cache.set(kc(e,t),l,{maxAge:c}),l}catch{o.signal.aborted&&(i=!0),Fw.error(`${s} could not resolve ${e} record ${t}`)}finally{this._abortControllers=this._abortControllers.filter(a=>a!==o)}}throw i?Object.assign(new Error("queryAaaa ECANCELLED"),{code:"ECANCELLED"}):new Error(`Could not resolve ${e} record ${t}`)}async resolveTxt(e){const t="TXT",r=this._TXTcache.get(kc(e,t));if(r!=null)return r;let i=!1;for(const s of this._getShuffledServers()){const o=new AbortController;this._abortControllers.push(o);try{const a=await this._request(Uw(s,e,t),o.signal),l=a.Answer.map(h=>[h.data.replace(/['"]+/g,"")]),c=Math.min(...a.Answer.map(h=>h.TTL));return this._TXTcache.set(kc(e,t),l,{maxAge:c}),l}catch{o.signal.aborted&&(i=!0),Fw.error(`${s} could not resolve ${e} record ${t}`)}finally{this._abortControllers=this._abortControllers.filter(a=>a!==o)}}throw i?Object.assign(new Error("queryTxt ECANCELLED"),{code:"ECANCELLED"}):new Error(`Could not resolve ${e} record ${t}`)}clearCache(){this._cache.clear(),this._TXTcache.clear()}}const Gse=new Ct("dns-over-https");class bA{constructor(e=new Vse){v(this,"resolver");this.resolver=e}static async create(){return new bA}async resolveTXT(e){let t;try{t=await this.resolver.resolveTxt(e)}catch(i){throw Gse.error("query failed: ",i),new Error("DNS query failed")}if(!t)throw new Error(`Could not resolve ${e}`);const r=[];return t.forEach(i=>{typeof i=="string"?r.push(i):Array.isArray(i)?i.forEach(s=>{typeof s=="string"?r.push(s):r.push(uf(s))}):r.push(uf(i))}),r}}var EM={exports:{}};/*
 * [hi-base32]{@link https://github.com/emn178/hi-base32}
 *
 * @version 0.5.0
 * @author Chen, Yi-Cyuan [emn178@gmail.com]
 * @copyright Chen, Yi-Cyuan 2015-2018
 * @license MIT
 */(function(n){(function(){var e=typeof window=="object"?window:{},t=!e.HI_BASE32_NO_NODE_JS&&typeof process=="object"&&process.versions&&process.versions.node;t&&(e=Ui);var r=!e.HI_BASE32_NO_COMMON_JS&&!0&&n.exports,i="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567".split(""),s={A:0,B:1,C:2,D:3,E:4,F:5,G:6,H:7,I:8,J:9,K:10,L:11,M:12,N:13,O:14,P:15,Q:16,R:17,S:18,T:19,U:20,V:21,W:22,X:23,Y:24,Z:25,2:26,3:27,4:28,5:29,6:30,7:31},o=[0,0,0,0,0,0,0,0],a=function(y,S){S.length>10&&(S="..."+S.substr(-10));var b=new Error("Decoded data is not valid UTF-8. Maybe try base32.decode.asBytes()? Partial data after reading "+y+" bytes: "+S+" <-");throw b.position=y,b},l=function(y){for(var S="",b=y.length,_=0,I=0,x,$;_<b;){if(x=y[_++],x<=127){S+=String.fromCharCode(x);continue}else x>191&&x<=223?($=x&31,I=1):x<=239?($=x&15,I=2):x<=247?($=x&7,I=3):a(_,S);for(var U=0;U<I;++U)x=y[_++],(x<128||x>191)&&a(_,S),$<<=6,$+=x&63;$>=55296&&$<=57343&&a(_,S),$>1114111&&a(_,S),$<=65535?S+=String.fromCharCode($):($-=65536,S+=String.fromCharCode(($>>10)+55296),S+=String.fromCharCode(($&1023)+56320))}return S},c=function(y){if(y==="")return[];if(!/^[A-Z2-7=]+$/.test(y))throw new Error("Invalid base32 characters");y=y.replace(/=/g,"");for(var S,b,_,I,x,$,U,O,P=[],M=0,K=y.length,C=0,B=K>>3<<3;C<B;)S=s[y.charAt(C++)],b=s[y.charAt(C++)],_=s[y.charAt(C++)],I=s[y.charAt(C++)],x=s[y.charAt(C++)],$=s[y.charAt(C++)],U=s[y.charAt(C++)],O=s[y.charAt(C++)],P[M++]=(S<<3|b>>>2)&255,P[M++]=(b<<6|_<<1|I>>>4)&255,P[M++]=(I<<4|x>>>1)&255,P[M++]=(x<<7|$<<2|U>>>3)&255,P[M++]=(U<<5|O)&255;var N=K-B;return N===2?(S=s[y.charAt(C++)],b=s[y.charAt(C++)],P[M++]=(S<<3|b>>>2)&255):N===4?(S=s[y.charAt(C++)],b=s[y.charAt(C++)],_=s[y.charAt(C++)],I=s[y.charAt(C++)],P[M++]=(S<<3|b>>>2)&255,P[M++]=(b<<6|_<<1|I>>>4)&255):N===5?(S=s[y.charAt(C++)],b=s[y.charAt(C++)],_=s[y.charAt(C++)],I=s[y.charAt(C++)],x=s[y.charAt(C++)],P[M++]=(S<<3|b>>>2)&255,P[M++]=(b<<6|_<<1|I>>>4)&255,P[M++]=(I<<4|x>>>1)&255):N===7&&(S=s[y.charAt(C++)],b=s[y.charAt(C++)],_=s[y.charAt(C++)],I=s[y.charAt(C++)],x=s[y.charAt(C++)],$=s[y.charAt(C++)],U=s[y.charAt(C++)],P[M++]=(S<<3|b>>>2)&255,P[M++]=(b<<6|_<<1|I>>>4)&255,P[M++]=(I<<4|x>>>1)&255,P[M++]=(x<<7|$<<2|U>>>3)&255),P},h=function(y){for(var S,b,_,I,x,$="",U=y.length,O=0,P=parseInt(U/5)*5;O<P;)S=y.charCodeAt(O++),b=y.charCodeAt(O++),_=y.charCodeAt(O++),I=y.charCodeAt(O++),x=y.charCodeAt(O++),$+=i[S>>>3]+i[(S<<2|b>>>6)&31]+i[b>>>1&31]+i[(b<<4|_>>>4)&31]+i[(_<<1|I>>>7)&31]+i[I>>>2&31]+i[(I<<3|x>>>5)&31]+i[x&31];var M=U-P;return M===1?(S=y.charCodeAt(O),$+=i[S>>>3]+i[S<<2&31]+"======"):M===2?(S=y.charCodeAt(O++),b=y.charCodeAt(O),$+=i[S>>>3]+i[(S<<2|b>>>6)&31]+i[b>>>1&31]+i[b<<4&31]+"===="):M===3?(S=y.charCodeAt(O++),b=y.charCodeAt(O++),_=y.charCodeAt(O),$+=i[S>>>3]+i[(S<<2|b>>>6)&31]+i[b>>>1&31]+i[(b<<4|_>>>4)&31]+i[_<<1&31]+"==="):M===4&&(S=y.charCodeAt(O++),b=y.charCodeAt(O++),_=y.charCodeAt(O++),I=y.charCodeAt(O),$+=i[S>>>3]+i[(S<<2|b>>>6)&31]+i[b>>>1&31]+i[(b<<4|_>>>4)&31]+i[(_<<1|I>>>7)&31]+i[I>>>2&31]+i[I<<3&31]+"="),$},d=function(y){var S,b,_,I,x,$,U=!1,O="",P=0,M,K=0,C=y.length;if(y==="")return O;do{for(o[0]=o[5],o[1]=o[6],o[2]=o[7],M=K;P<C&&M<5;++P)$=y.charCodeAt(P),$<128?o[M++]=$:$<2048?(o[M++]=192|$>>6,o[M++]=128|$&63):$<55296||$>=57344?(o[M++]=224|$>>12,o[M++]=128|$>>6&63,o[M++]=128|$&63):($=65536+(($&1023)<<10|y.charCodeAt(++P)&1023),o[M++]=240|$>>18,o[M++]=128|$>>12&63,o[M++]=128|$>>6&63,o[M++]=128|$&63);K=M-5,P===C&&++P,P>C&&M<6&&(U=!0),S=o[0],M>4?(b=o[1],_=o[2],I=o[3],x=o[4],O+=i[S>>>3]+i[(S<<2|b>>>6)&31]+i[b>>>1&31]+i[(b<<4|_>>>4)&31]+i[(_<<1|I>>>7)&31]+i[I>>>2&31]+i[(I<<3|x>>>5)&31]+i[x&31]):M===1?O+=i[S>>>3]+i[S<<2&31]+"======":M===2?(b=o[1],O+=i[S>>>3]+i[(S<<2|b>>>6)&31]+i[b>>>1&31]+i[b<<4&31]+"===="):M===3?(b=o[1],_=o[2],O+=i[S>>>3]+i[(S<<2|b>>>6)&31]+i[b>>>1&31]+i[(b<<4|_>>>4)&31]+i[_<<1&31]+"==="):(b=o[1],_=o[2],I=o[3],O+=i[S>>>3]+i[(S<<2|b>>>6)&31]+i[b>>>1&31]+i[(b<<4|_>>>4)&31]+i[(_<<1|I>>>7)&31]+i[I>>>2&31]+i[I<<3&31]+"=")}while(!U);return O},p=function(y){for(var S,b,_,I,x,$="",U=y.length,O=0,P=parseInt(U/5)*5;O<P;)S=y[O++],b=y[O++],_=y[O++],I=y[O++],x=y[O++],$+=i[S>>>3]+i[(S<<2|b>>>6)&31]+i[b>>>1&31]+i[(b<<4|_>>>4)&31]+i[(_<<1|I>>>7)&31]+i[I>>>2&31]+i[(I<<3|x>>>5)&31]+i[x&31];var M=U-P;return M===1?(S=y[O],$+=i[S>>>3]+i[S<<2&31]+"======"):M===2?(S=y[O++],b=y[O],$+=i[S>>>3]+i[(S<<2|b>>>6)&31]+i[b>>>1&31]+i[b<<4&31]+"===="):M===3?(S=y[O++],b=y[O++],_=y[O],$+=i[S>>>3]+i[(S<<2|b>>>6)&31]+i[b>>>1&31]+i[(b<<4|_>>>4)&31]+i[_<<1&31]+"==="):M===4&&(S=y[O++],b=y[O++],_=y[O++],I=y[O],$+=i[S>>>3]+i[(S<<2|b>>>6)&31]+i[b>>>1&31]+i[(b<<4|_>>>4)&31]+i[(_<<1|I>>>7)&31]+i[I>>>2&31]+i[I<<3&31]+"="),$},g=function(y,S){var b=typeof y!="string";return b&&y.constructor===ArrayBuffer&&(y=new Uint8Array(y)),b?p(y):S?h(y):d(y)},m=function(y,S){if(!S)return l(c(y));if(y==="")return"";if(!/^[A-Z2-7=]+$/.test(y))throw new Error("Invalid base32 characters");var b,_,I,x,$,U,O,P,M="",K=y.indexOf("=");K===-1&&(K=y.length);for(var C=0,B=K>>3<<3;C<B;)b=s[y.charAt(C++)],_=s[y.charAt(C++)],I=s[y.charAt(C++)],x=s[y.charAt(C++)],$=s[y.charAt(C++)],U=s[y.charAt(C++)],O=s[y.charAt(C++)],P=s[y.charAt(C++)],M+=String.fromCharCode((b<<3|_>>>2)&255)+String.fromCharCode((_<<6|I<<1|x>>>4)&255)+String.fromCharCode((x<<4|$>>>1)&255)+String.fromCharCode(($<<7|U<<2|O>>>3)&255)+String.fromCharCode((O<<5|P)&255);var N=K-B;return N===2?(b=s[y.charAt(C++)],_=s[y.charAt(C++)],M+=String.fromCharCode((b<<3|_>>>2)&255)):N===4?(b=s[y.charAt(C++)],_=s[y.charAt(C++)],I=s[y.charAt(C++)],x=s[y.charAt(C++)],M+=String.fromCharCode((b<<3|_>>>2)&255)+String.fromCharCode((_<<6|I<<1|x>>>4)&255)):N===5?(b=s[y.charAt(C++)],_=s[y.charAt(C++)],I=s[y.charAt(C++)],x=s[y.charAt(C++)],$=s[y.charAt(C++)],M+=String.fromCharCode((b<<3|_>>>2)&255)+String.fromCharCode((_<<6|I<<1|x>>>4)&255)+String.fromCharCode((x<<4|$>>>1)&255)):N===7&&(b=s[y.charAt(C++)],_=s[y.charAt(C++)],I=s[y.charAt(C++)],x=s[y.charAt(C++)],$=s[y.charAt(C++)],U=s[y.charAt(C++)],O=s[y.charAt(C++)],M+=String.fromCharCode((b<<3|_>>>2)&255)+String.fromCharCode((_<<6|I<<1|x>>>4)&255)+String.fromCharCode((x<<4|$>>>1)&255)+String.fromCharCode(($<<7|U<<2|O>>>3)&255)),M},E={encode:g,decode:m};m.asBytes=c,r?n.exports=E:e.base32=E})()})(EM);var Yse=EM.exports;const Xse=Yl(Yse),rl=class rl{static parseAndVerifyRoot(e,t){if(!e.startsWith(this.ROOT_PREFIX))throw new Error(`ENRTree root entry must start with '${this.ROOT_PREFIX}'`);const r=rl.parseRootValues(e),i=Xse.decode.asBytes(t),s=e.split(" sig")[0],o=mu(s),a=at(r.signature,"base64url").slice(0,64);if(!cM(a,lb(o),new Uint8Array(i)))throw new Error("Unable to verify ENRTree root signature");return r.eRoot}static parseRootValues(e){const t=e.match(/^enrtree-root:v1 e=([^ ]+) l=([^ ]+) seq=(\d+) sig=([^ ]+)$/);if(!Array.isArray(t))throw new Error("Could not parse ENRTree root entry");t.shift();const[r,i,s,o]=t;if(!r)throw new Error("Could not parse 'e' value from ENRTree root entry");if(!i)throw new Error("Could not parse 'l' value from ENRTree root entry");if(!s)throw new Error("Could not parse 'seq' value from ENRTree root entry");if(!o)throw new Error("Could not parse 'sig' value from ENRTree root entry");return{eRoot:r,lRoot:i,seq:Number(s),signature:o}}static parseTree(e){if(!e.startsWith(this.TREE_PREFIX))throw new Error(`ENRTree tree entry must start with '${this.TREE_PREFIX}'`);const t=e.match(/^enrtree:\/\/([^@]+)@(.+)$/);if(!Array.isArray(t))throw new Error("Could not parse ENRTree tree entry");t.shift();const[r,i]=t;if(!r)throw new Error("Could not parse public key from ENRTree tree entry");if(!i)throw new Error("Could not parse domain from ENRTree tree entry");return{publicKey:r,domain:i}}static parseBranch(e){if(!e.startsWith(this.BRANCH_PREFIX))throw new Error(`ENRTree branch entry must start with '${this.BRANCH_PREFIX}'`);return e.split(this.BRANCH_PREFIX)[1].split(",")}};v(rl,"RECORD_PREFIX",Uu.RECORD_PREFIX),v(rl,"TREE_PREFIX","enrtree:"),v(rl,"BRANCH_PREFIX","enrtree-branch:"),v(rl,"ROOT_PREFIX","enrtree-root:");let Qn=rl;const Zse=new Ct("discovery:fetch_nodes");async function*Qse(n,e=10,t=3){const r=new Set;let i=0,s=0;for(;i<e&&s<t;){i++;const o=await n();if(!o||!o.nodeId){s++;continue}r.has(o.nodeId)||(r.add(o.nodeId),o.waku2&&(yield o),Zse.info(`got new peer candidate from DNS address=${o.nodeId}@${o.ip}`))}}const RP=new Ct("discovery:dns");class wA{constructor(e){v(this,"dns");v(this,"_DNSTreeCache");this._DNSTreeCache={},this.dns=e}static async dnsOverHttp(e){return e||(e=await bA.create()),new wA(e)}async*getNextPeer(e){for(const t of JW(e)){const{publicKey:r,domain:i}=Qn.parseTree(t),s={domain:i,publicKey:r,visits:{}};for await(const o of Qse(()=>this._search(i,s)))yield o}}async _search(e,t){try{const r=await this._getTXTRecord(e,t);t.visits[e]=!0;let i,s;const o=Jse(r);try{switch(o){case Qn.ROOT_PREFIX:return i=Qn.parseAndVerifyRoot(r,t.publicKey),await this._search(i,t);case Qn.BRANCH_PREFIX:return s=Qn.parseBranch(r),i=eoe(s,t),await this._search(i,t);case Qn.RECORD_PREFIX:return cb.fromString(r);default:return null}}catch(a){return RP.error(`Failed to search DNS tree ${o} at subdomain ${e}: ${a}`),null}}catch(r){return RP.error(`Failed to retrieve TXT record at subdomain ${e}: ${r}`),null}}async _getTXTRecord(e,t){if(this._DNSTreeCache[e])return this._DNSTreeCache[e];const r=e!==t.domain?`${e}.${t.domain}`:t.domain,i=await this.dns.resolveTXT(r);if(!i.length)throw new Error("Received empty result array while fetching TXT record");if(!i[0].length)throw new Error("Received empty TXT record");const s=i.join("");return this._DNSTreeCache[e]=s,s}}function Jse(n){return n.startsWith(Qn.ROOT_PREFIX)?Qn.ROOT_PREFIX:n.startsWith(Qn.BRANCH_PREFIX)?Qn.BRANCH_PREFIX:n.startsWith(Qn.RECORD_PREFIX)?Qn.RECORD_PREFIX:""}function eoe(n,e){const t={};for(const[i,s]of n.entries())e.visits[s]&&(t[i]=!0);if(Object.keys(t).length===n.length)throw new Error("Unresolvable circular path detected");let r;do r=Math.floor(Math.random()*n.length);while(t[r]);return n[r]}const OP=new Ct("peer-discovery-dns");class toe extends Si{constructor(t,r){super();v(this,"nextPeer");v(this,"_started");v(this,"_components");v(this,"_options");this._started=!1,this._components=t,this._options=r;const{enrUrls:i}=r;OP.info("Use following EIP-1459 ENR Tree URLs: ",i)}async start(){OP.info("Starting peer discovery via dns"),this._started=!0,await this.findPeers()}async findPeers(){if(!this.nextPeer){let{enrUrls:t}=this._options;Array.isArray(t)||(t=[t]);const r=await wA.dnsOverHttp();this.nextPeer=r.getNextPeer.bind(r,t)}for await(const t of this.nextPeer()){if(!this._started)return;const{peerInfo:r,shardInfo:i}=t;if(!r)continue;const s={[rP]:{value:this._options.tagValue??Gne,ttl:this._options.tagTTL??Yne}};let o=!1;await this._components.peerStore.has(r.id)?(await this._components.peerStore.get(r.id)).tags.has(rP)||(o=!0,await this._components.peerStore.merge(r.id,{tags:s})):(o=!0,await this._components.peerStore.save(r.id,{tags:s,...i&&{metadata:{shardInfo:gS(i)}}})),o&&this.dispatchEvent(new CustomEvent("peer",{detail:r}))}}stop(){this._started=!1}get[ff](){return!0}get[Symbol.toStringTag](){return zz}}function roe(n){return e=>new toe(e,{enrUrls:n})}const noe=60,ioe=Yn.PEER_EXCHANGE,soe=50,ooe=3e4,SM="/vac/waku/peer-exchange/2.0.0-alpha1";class Nf{constructor(e){v(this,"proto");this.proto=e}static createRequest(e){const{numPeers:t}=e;return new Nf({query:{numPeers:t},response:void 0})}encode(){return _m.encode(this.proto)}static decode(e){const t=_m.decode(e);return new Nf(t)}get query(){return this.proto.query}get response(){return this.proto.response}}const jw=new Ct("peer-exchange");class aoe{constructor(e){v(this,"components");v(this,"streamManager");this.components=e,this.streamManager=new wu(SM,e)}async query(e){var l;const{numPeers:t,peerId:r}=e,i=Nf.createRequest({numPeers:BigInt(t)});if(!await this.components.peerStore.has(r))return{peerInfos:null,error:oo.NO_PEER_AVAILABLE};const o=await this.streamManager.getStream(r);if(!o)return jw.error(`Failed to get a stream for remote peer:${(l=r==null?void 0:r.toString)==null?void 0:l.call(r)}`),{peerInfos:null,error:oo.NO_STREAM_AVAILABLE};const a=await Fi([i.encode()],zS,o,Mm,async c=>await as(c));try{const c=new bt;a.forEach(p=>{c.append(p)});const{response:h}=Nf.decode(c);return h?{peerInfos:await Promise.all(h.peerInfos.map(p=>p.enr).filter(dS).map(async p=>({ENR:await cb.fromRLP(p)}))),error:null}:(jw.error("PeerExchangeRPC message did not contains a `response` field"),{peerInfos:null,error:oo.EMPTY_PAYLOAD})}catch(c){return jw.error("Failed to decode push reply",c),{peerInfos:null,error:oo.DECODE_FAILED}}}}const Zi=new Ct("peer-exchange-discovery");class loe extends Si{constructor(t,r={}){super();v(this,"components");v(this,"peerExchange");v(this,"options");v(this,"isStarted",!1);v(this,"queryingPeers",new Set);v(this,"peerExpirationRecords",new Map);v(this,"continuousDiscoveryInterval",null);this.components=t,this.peerExchange=new aoe(t),this.options={...r,TTL:r.TTL??ooe},this.handleDiscoveredPeer=this.handleDiscoveredPeer.bind(this)}start(){this.isStarted||(Zi.info("Starting peer exchange node discovery, discovering peers"),this.isStarted=!0,this.components.events.addEventListener("peer:identify",this.handleDiscoveredPeer),this.continuousDiscoveryInterval=setInterval(()=>{this.handlePeriodicDiscovery()},this.options.TTL))}stop(){this.isStarted&&(Zi.info("Stopping peer exchange node discovery"),this.isStarted=!1,this.queryingPeers.clear(),this.peerExpirationRecords.clear(),this.continuousDiscoveryInterval&&clearInterval(this.continuousDiscoveryInterval),this.components.events.removeEventListener("peer:identify",this.handleDiscoveredPeer))}get[ff](){return!0}get[Symbol.toStringTag](){return"@waku/peer-exchange"}async handleDiscoveredPeer(t){this.runQuery(t.detail.peerId,t.detail.protocols)}async handlePeriodicDiscovery(){const t=this.components.connectionManager.getConnections();await Promise.all(t.map(async r=>{try{const i=r.remotePeer.toString();if(!(this.peerExpirationRecords.has(i)?this.peerExpirationRecords.get(i)<=Date.now():!0))return null;const o=await this.components.peerStore.get(r.remotePeer);return this.runQuery(r.remotePeer,o.protocols)}catch(i){return Zi.warn("Error getting peer info",i),null}}))}async runQuery(t,r){if(!r.includes(SM)||this.queryingPeers.has(t.toString())){Zi.info(`Skipping peer ${t} as it is already querying or does not support peer exchange`);return}try{this.queryingPeers.add(t.toString()),await this.query(t)}catch(i){Zi.error("Error querying peer",i)}this.peerExpirationRecords.set(t.toString(),Date.now()+this.options.TTL),this.queryingPeers.delete(t.toString())}async query(t){const r=t.toString();Zi.info(`Querying peer exchange for ${r}`);const{error:i,peerInfos:s}=await this.peerExchange.query({numPeers:noe,peerId:t});if(i){Zi.error(`Peer exchange query to ${r} failed`,i);return}for(const{ENR:o}of s){if(!o){Zi.warn(`No ENR in peerInfo object from ${r}, skipping`);continue}const{peerInfo:a,shardInfo:l}=o;if(!a){Zi.warn(`No peerInfo in ENR from ${r}, skipping`);continue}const h=!await this.hasShardInfo(a.id)&&l?{metadata:{shardInfo:gS(l)}}:void 0;await this.components.peerStore.merge(a.id,{tags:{[ioe]:{value:soe}},...h,...a.multiaddrs&&{multiaddrs:a.multiaddrs}}),Zi.info(`Discovered peer: ${a.id.toString()}`),this.dispatchEvent(new CustomEvent("peer",{detail:{id:a.id,multiaddrs:a.multiaddrs}}))}}async hasShardInfo(t){try{const r=await this.components.peerStore.get(t);return r?r.metadata.has("shardInfo"):!1}catch(r){Zi.warn(`Error getting shard info for ${t.toString()}`,r)}return!1}}function coe(n={}){return e=>new loe(e,n)}const LP=Yn.PEER_CACHE,uoe=50,hoe=n=>!!n&&typeof n=="object"&&"id"in n&&typeof n.id=="string"&&"multiaddrs"in n&&Array.isArray(n.multiaddrs);class foe{get(){return[]}set(e){}remove(){}}class doe{get(){try{const e=localStorage.getItem("waku:peers");return(e?JSON.parse(e):[]).filter(hoe)}catch{return[]}}set(e){try{localStorage.setItem("waku:peers",JSON.stringify(e))}catch{}}remove(){try{localStorage.removeItem("waku:peers")}catch{}}}const poe=()=>{try{if(typeof localStorage<"u")return new doe}catch{}return new foe},Dp=new Ct("peer-cache");class goe extends Si{constructor(t,r){super();v(this,"components");v(this,"isStarted",!1);v(this,"cache");v(this,"handleDiscoveredPeer",t=>{const{peerId:r,listenAddrs:i}=t.detail,s=i.map(c=>c.toString()),o=r.toString(),a=this.readPeerInfoFromCache(),l=a.findIndex(c=>c.id===o);l!==-1?a[l].multiaddrs=s:a.push({id:o,multiaddrs:s}),this.writePeerInfoToCache(a)});this.components=t,this.cache=(r==null?void 0:r.cache)??poe()}get[Symbol.toStringTag](){return`@waku/${LP}`}async start(){this.isStarted||(Dp.info("Starting Peer Cache Discovery"),this.components.events.addEventListener("peer:identify",this.handleDiscoveredPeer),await this.discoverPeers(),this.isStarted=!0)}stop(){this.isStarted&&(Dp.info("Stopping Peer Cache Discovery"),this.components.events.removeEventListener("peer:identify",this.handleDiscoveredPeer),this.isStarted=!1)}async discoverPeers(){const t=this.readPeerInfoFromCache();for(const r of t){const i=Cs(r.id),s=r.multiaddrs.map(o=>Nt(o));await this.components.peerStore.has(i)||(await this.components.peerStore.save(i,{multiaddrs:s,tags:{[LP]:{value:uoe}}}),this.dispatchEvent(new CustomEvent("peer",{detail:{id:i,multiaddrs:s}})))}}readPeerInfoFromCache(){try{return this.cache.get()}catch(t){return Dp.error("Error parsing peers from cache:",t),[]}}writePeerInfoToCache(t){try{this.cache.set(t)}catch(r){Dp.error("Error saving peers to cache:",r)}}}function moe(n={}){return e=>new goe(e,n)}function NP(n,e){const t=[tP.SANDBOX,tP.TEST],r=[];return n!=null&&n.dns&&r.push(roe(t)),(n!=null&&n.peerCache||e)&&r.push(moe({cache:e})),n!=null&&n.peerExchange&&r.push(coe()),r}const yoe=new Ct("sdk:create"),boe="js-waku",woe=10;async function voe(n,e,t){!(e!=null&&e.hideWebSocketInfo)&&!eP()&&(console.info("%cIgnore WebSocket connection failures","background: gray; color: white; font-size: x-large"),console.info("%cWaku tries to discover peers and some of them are expected to fail","background: gray; color: white; font-size: x-large"));const r=(e==null?void 0:e.filterMultiaddrs)===!1||eP()?e$:lee;return Vne({transports:[dee({filter:r})],streamMuxers:[FJ()],connectionEncrypters:[wQ()],...e,services:{identify:fJ({agentVersion:t??boe}),ping:GJ({maxInboundStreams:(e==null?void 0:e.pingMaxInboundStreams)??woe}),metadata:tX(n),...e==null?void 0:e.services}})}async function _oe(n){var o;const t=(n.networkConfig??qL).clusterId??jL;yoe.info("Creating Waku node with cluster id: ",t);const r=(n==null?void 0:n.libp2p)??{},i=r.peerDiscovery??[];n!=null&&n.defaultBootstrap?i.push(...NP({dns:!0,peerExchange:!0,peerCache:!0,...n.discovery},n.peerCache)):i.push(...NP(n.discovery,n.peerCache));const s=[...n.bootstrapPeers||[],...((o=n.store)==null?void 0:o.peers)||[]];return s.length&&i.push(PQ({list:s})),r.peerDiscovery=i,voe(t,r,n==null?void 0:n.userAgent)}async function Eoe(n={}){const e=await _oe(n),t=new WX(n,e,{store:!0,lightpush:!0,filter:!0});return(n==null?void 0:n.autoStart)!==!1&&await t.start(),t}var Fg=0,vA={size:0,kind:17,base:null,node:null,finalizer:null},_A={size:0,kind:17,base:null,node:null,finalizer:null},EA={size:0,kind:17,base:null,node:null,finalizer:null},SA={size:0,kind:17,base:null,node:null,finalizer:null},AM={size:0,kind:17,base:null,node:null,finalizer:null},xM={size:0,kind:22,base:null,node:null,finalizer:null},ay={size:0,kind:28,base:null,node:null,finalizer:null},Soe={size:0,kind:29,base:null,node:null,finalizer:null},IM={size:0,kind:22,base:null,node:null,finalizer:null},ad={size:0,kind:17,base:null,node:null,finalizer:null},Yu={size:0,kind:17,base:null,node:null,finalizer:null},ub={size:0,kind:17,base:null,node:null,finalizer:null},AA={size:0,kind:17,base:null,node:null,finalizer:null},Aoe={kind:2,len:0,offset:0,typ:null,name:null,sons:[]};AA.node=Aoe;var xoe={kind:2,len:0,offset:0,typ:null,name:null,sons:[]};ub.node=xoe;var Ioe={kind:2,len:0,offset:0,typ:null,name:null,sons:[]};Yu.node=Ioe;IM.base=ad;xM.base=ad;var Toe={kind:2,len:5,offset:0,typ:null,name:null,sons:[{kind:1,offset:"parent",len:0,typ:IM,name:"parent",sons:null},{kind:1,offset:"name",len:0,typ:Soe,name:"name",sons:null},{kind:1,offset:"message",len:0,typ:ay,name:"msg",sons:null},{kind:1,offset:"trace",len:0,typ:ay,name:"trace",sons:null},{kind:1,offset:"up",len:0,typ:xM,name:"up",sons:null}]};ad.node=Toe;var Coe={kind:2,len:0,offset:0,typ:null,name:null,sons:[]};AM.node=Coe;ad.base=AM;Yu.base=ad;ub.base=Yu;AA.base=ub;var koe={kind:2,len:0,offset:0,typ:null,name:null,sons:[]};SA.node=koe;SA.base=ub;var Poe={kind:2,len:0,offset:0,typ:null,name:null,sons:[]};EA.node=Poe;EA.base=Yu;var Roe={kind:2,len:0,offset:0,typ:null,name:null,sons:[]};_A.node=Roe;_A.base=Yu;var Ooe={kind:2,len:0,offset:0,typ:null,name:null,sons:[]};vA.node=Ooe;vA.base=Yu;function Loe(n){var e=null,t=DP(n.length),r=0,i=0;e:for(;;){if(!(r<n.length))break e;var s=n[r];if(s<128)t[i]=String.fromCharCode(s),r+=1;else{var o=DP(0);t:for(;;){var a=s.toString(16);if((a==null?0:a.length)==1?o.push("%0"):o.push("%"),o.push(a),r+=1,n.length<=r||n[r]<128)break t;s=n[r]}++Fg;try{t[i]=decodeURIComponent(o.join("")),--Fg}catch{--Fg,t[i]=o.join("")}finally{}}i+=1}if(t.length<i)for(var l=t.length;l<i;++l)t.push(null);else t.length=i;return e=t.join(""),e}function ld(n,e){throw n.name=e,Fg==0&&Uoe(n),n}function jg(n,e){return e==0&&CM(),e==-1&&n==2147483647&&xA(),Math.trunc(n%e)}function qw(n){var e,t=0;return n<0?e=n*-1:e=n,t=e,t}function Noe(n,e){return e==0&&CM(),e==-1&&n==2147483647&&xA(),Math.trunc(n/e)}function TM(n,e){var t=n*e;return IA(t),t}function bE(n,e){var t=n-e;return IA(t),t}function ga(n,e){var t=n+e;return IA(t),t}function Doe(n,e,t){var r=0;e:if(e<=n&&n<=t){r=n;break e}else Foe();return r}function $oe(){for(var n={},e=0;e<arguments.length;++e){var t=arguments[e];if(typeof t=="object")for(var r=t[0];r<=t[1];++r)n[r]=!0;else n[t]=!0}return n}var Moe=$oe(17,16,4,18,27,19,23,22,21);function Rl(n,e,t){var r=null;switch(t.kind){case 21:case 22:case 23:case 5:zoe(t)?r=[e[0],e[1]]:r=e;break;case 19:if(n==null)n={};else for(var i in n)delete n[i];for(var i in e)n[i]=e[i];r=n;break;case 18:case 17:t.base!=null?r=Rl(n,e,t.base):t.kind==17?r=n??{m_type:t}:r=n??{},wE(r,e,t.node);break;case 4:case 16:if(ArrayBuffer.isView(e))n==null||n.length!=e.length?n=new e.constructor(e):n.set(e,0),r=n;else if(e===null)r=null;else{(n==null||n.length!=e.length)&&(n=new Array(e.length)),r=n;for(var s=0;s<e.length;++s)r[s]=Rl(r[s],e[s],t.base)}break;case 24:case 27:if(e===null)r=null;else{(n==null||n.length!=e.length)&&(n=new Array(e.length)),r=n;for(var s=0;s<e.length;++s)r[s]=Rl(r[s],e[s],t.base)}break;case 28:e!==null&&(r=e.slice(0));break;default:r=e;break}return r}function ly(n,e,t){var r=0;e:if(e<=n&&n<=t){r=n;break e}else Koe(n,e,t);return r}function Boe(n,e,t){n[e]===null&&(n[e]=[]);var r=n[e].length;n[e].length+=t.length;for(var i=0;i<t.length;++i)n[e][r+i]=t.charCodeAt(i)}function DP(n){var e=[];e=new Array(n);for(var t=0;t<n;++t)e[t]=null;return e}function Uoe(n){var e=[[]];n.message.length!=0?(e[0].push.apply(e[0],[69,114,114,111,114,58,32,117,110,104,97,110,100,108,101,100,32,101,120,99,101,112,116,105,111,110,58,32]),e[0].push.apply(e[0],n.message)):e[0].push.apply(e[0],[69,114,114,111,114,58,32,117,110,104,97,110,100,108,101,100,32,101,120,99,101,112,116,105,111,110]),e[0].push.apply(e[0],[32,91]),Boe(e,0,n.name),e[0].push.apply(e[0],[93,10]);var t=Loe(e[0]);throw typeof Error<"u"?new Error(t):t}function CM(){ld({message:[100,105,118,105,115,105,111,110,32,98,121,32,122,101,114,111],parent:null,m_type:AA,name:null,trace:[],up:null},"DivByZeroDefect")}function xA(){ld({message:[111,118,101,114,45,32,111,114,32,117,110,100,101,114,102,108,111,119],parent:null,m_type:SA,name:null,trace:[],up:null},"OverflowDefect")}function IA(n){(n>2147483647||n<-2147483648)&&xA()}function Foe(){ld({message:[118,97,108,117,101,32,111,117,116,32,111,102,32,114,97,110,103,101],parent:null,m_type:EA,name:null,trace:[],up:null},"RangeDefect")}function joe(n,e,t,r,i){var s,o=n[e].length;if(n[e].length<(s=Doe(ga(o,i),0,2147483647),s))for(var a=n[e].length;a<s;++a)n[e].push(0);else n[e].length=s;{var l=0,c=0;e:for(;;){if(!(c<i))break e;l=c,n[e][ly(ga(o,l),0,n[e].length-1)]=t.charCodeAt(ly(ga(r,l),0,t.length-1)),c=ga(c,1)}}}function qoe(n,e,t){joe(n,e,t,0,t==null?0:t.length)}function Hoe(n,e,t){qoe(n,e,t+"")}function Woe(n,e,t){Hoe(n,e,t)}function Hw(n){var e=[[]];return Woe(e,0,n),e[0]}function zoe(n){var e=!1;e:{e=Moe[n.base.kind]==null;break e}return e}function wE(n,e,t){switch(t.kind){case 0:break;case 1:n[t.offset]=Rl(n[t.offset],e[t.offset],t.typ);break;case 2:for(var r=0;r<t.sons.length;r++)wE(n,e,t.sons[r]);break;case 3:n[t.offset]=Rl(n[t.offset],e[t.offset],t.typ);for(var r=0;r<t.sons.length;++r)wE(n,e,t.sons[r][1]);break}}function Koe(n,e,t){var r;t<e?r=[105,110,100,101,120,32,111,117,116,32,111,102,32,98,111,117,110,100,115,44,32,116,104,101,32,99,111,110,116,97,105,110,101,114,32,105,115,32,101,109,112,116,121]:r=[105,110,100,101,120,32].concat(Hw(n),[32,110,111,116,32,105,110,32],Hw(e),[32,46,46,32],Hw(t)),ld({message:Rl(null,r,ay),parent:null,m_type:_A,name:null,trace:[],up:null},"IndexDefect")}function Pc(n,e){var t=0,r=65535,i=(n>>>16&r)>>>0,s=(n&r)>>>0,o=(e>>>16&r)>>>0,a=(e&r)>>>0;return t=(s*a>>>0)+((i*a>>>0)+(s*o>>>0)>>>0<<16>>>0)>>>0,t}function Ww(n,e){var t=0;return t=(n<<e>>>0|n>>>bE(32,e))>>>0,t}function Voe(n){var e=0;e:{var t=n.length,r=4,i=Noe(t,r),s=0,o=0;t:for(;;){if(!(o<TM(i,r)))break t;var a=0,l=r;r:for(;;){if(!(0<l))break r;l=bE(l,1),a=(a<<8>>>0|Number(BigInt.asUintN(32,BigInt(n[ly(ga(o,l),0,n.length-1)]))))>>>0}o=ga(o,r),a=Pc(a,3432918353),a=Ww(a,15),a=Pc(a,461845907),s=(s^a)>>>0,s=Ww(s,13),s=(s*5>>>0)+3864292196>>>0}var c=0,h=jg(t,r);t:for(;;){if(!(0<h))break t;h=bE(h,1),c=(c<<8>>>0|Number(BigInt.asUintN(32,BigInt(n[ly(ga(o,h),0,n.length-1)]))))>>>0}c=Pc(c,3432918353),c=Ww(c,15),c=Pc(c,461845907),s=(s^c)>>>0,s=(s^Number(BigInt.asUintN(32,BigInt(t))))>>>0,s=(s^s>>>16)>>>0,s=Pc(s,2246822507),s=(s^s>>>13)>>>0,s=Pc(s,3266489909),s=(s^s>>>16)>>>0,e=Number(BigInt.asIntN(32,BigInt(s)));break e}return e}function $P(n){var e=0;return e=Voe(n.slice(0,n.length-1+1)),e}function Goe(n,e,t){var r=0,i=jg(qw($P(n)),t),s=jg(qw($P(n.concat([32,98]))),t);return r=jg(qw(ga(i,TM(e,s))),t),r}function Yoe(n){ld({message:Rl(null,n,ay),m_type:vA,parent:null,name:null,trace:[],up:null},"AssertionDefect")}function Xoe(n){Yoe(n)}function Zoe(n){Xoe(n)}Goe([100,117,109,109,121],0,1)!=0&&Zoe([110,105,109,95,104,97,115,104,46,110,105,109,40,50,54,44,32,51,41,32,96,104,97,115,104,78,40,34,100,117,109,109,121,34,44,32,48,44,32,49,41,32,61,61,32,48,96,32]);var MP;(function(n){n.Send="send",n.Receive="receive",n.SendEphemeral="sendEphemeral"})(MP||(MP={}));var BP;(function(n){n.OutMessageSent="sds:out:message-sent",n.InMessageDelivered="sds:in:message-delivered",n.InMessageReceived="sds:in:message-received",n.OutMessageAcknowledged="sds:out:message-acknowledged",n.OutMessagePossiblyAcknowledged="sds:out:message-possibly-acknowledged",n.InMessageMissing="sds:in:message-missing",n.OutSyncSent="sds:out:sync-sent",n.InSyncReceived="sds:in:sync-received",n.InMessageLost="sds:in:message-irretrievably-lost",n.ErrorTask="sds:error-task"})(BP||(BP={}));var cy={exports:{}};/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */cy.exports;(function(n,e){(function(){var t,r="4.17.21",i=200,s="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",o="Expected a function",a="Invalid `variable` option passed into `_.template`",l="__lodash_hash_undefined__",c=500,h="__lodash_placeholder__",d=1,p=2,g=4,m=1,E=2,y=1,S=2,b=4,_=8,I=16,x=32,$=64,U=128,O=256,P=512,M=30,K="...",C=800,B=16,N=1,L=2,V=3,W=1/0,H=9007199254740991,G=17976931348623157e292,z=NaN,Z=4294967295,F=Z-1,ie=Z>>>1,fe=[["ary",U],["bind",y],["bindKey",S],["curry",_],["curryRight",I],["flip",P],["partial",x],["partialRight",$],["rearg",O]],J="[object Arguments]",_e="[object Array]",oe="[object AsyncFunction]",ne="[object Boolean]",de="[object Date]",k="[object DOMException]",X="[object Error]",ee="[object Function]",me="[object GeneratorFunction]",be="[object Map]",te="[object Number]",le="[object Null]",ge="[object Object]",Ie="[object Promise]",Ae="[object Proxy]",Te="[object RegExp]",ye="[object Set]",Re="[object String]",Fe="[object Symbol]",Ce="[object Undefined]",et="[object WeakMap]",A="[object WeakSet]",T="[object ArrayBuffer]",D="[object DataView]",Y="[object Float32Array]",ae="[object Float64Array]",pe="[object Int8Array]",Ee="[object Int16Array]",ue="[object Int32Array]",we="[object Uint8Array]",He="[object Uint8ClampedArray]",ze="[object Uint16Array]",Ke="[object Uint32Array]",it=/\b__p \+= '';/g,Gt=/\b(__p \+=) '' \+/g,er=/(__e\(.*?\)|\b__t\)) \+\n'';/g,yt=/&(?:amp|lt|gt|quot|#39);/g,Rt=/[&<>"']/g,nt=RegExp(yt.source),St=RegExp(Rt.source),Ot=/<%-([\s\S]+?)%>/g,Zt=/<%([\s\S]+?)%>/g,ar=/<%=([\s\S]+?)%>/g,Kr=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,se=/^\w*$/,ce=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Ue=/[\\^$.*+?()[\]{}|]/g,We=RegExp(Ue.source),Ve=/^\s+/,lr=/\s/,Cr=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Vr=/\{\n\/\* \[wrapped with (.+)\] \*/,xi=/,? & /,Ii=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Ti=/[()=,{}\[\]\/\s]/,Hi=/\\(\\)?/g,qn=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Gr=/\w*$/,Rn=/^[-+]0x[0-9a-f]+$/i,Hn=/^0b[01]+$/i,en=/^\[object .+?Constructor\]$/,mn=/^0o[0-7]+$/i,Jl=/^(?:0|[1-9]\d*)$/,ec=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Rs=/($^)/,tc=/['\n\r\u2028\u2029\\]/g,Os="\\ud800-\\udfff",rc="\\u0300-\\u036f",nc="\\ufe20-\\ufe2f",F6="\\u20d0-\\u20ff",$A=rc+nc+F6,MA="\\u2700-\\u27bf",BA="a-z\\xdf-\\xf6\\xf8-\\xff",j6="\\xac\\xb1\\xd7\\xf7",q6="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",H6="\\u2000-\\u206f",W6=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",UA="A-Z\\xc0-\\xd6\\xd8-\\xde",FA="\\ufe0e\\ufe0f",jA=j6+q6+H6+W6,db="[']",z6="["+Os+"]",qA="["+jA+"]",ud="["+$A+"]",HA="\\d+",K6="["+MA+"]",WA="["+BA+"]",zA="[^"+Os+jA+HA+MA+BA+UA+"]",pb="\\ud83c[\\udffb-\\udfff]",V6="(?:"+ud+"|"+pb+")",KA="[^"+Os+"]",gb="(?:\\ud83c[\\udde6-\\uddff]){2}",mb="[\\ud800-\\udbff][\\udc00-\\udfff]",ic="["+UA+"]",VA="\\u200d",GA="(?:"+WA+"|"+zA+")",G6="(?:"+ic+"|"+zA+")",YA="(?:"+db+"(?:d|ll|m|re|s|t|ve))?",XA="(?:"+db+"(?:D|LL|M|RE|S|T|VE))?",ZA=V6+"?",QA="["+FA+"]?",Y6="(?:"+VA+"(?:"+[KA,gb,mb].join("|")+")"+QA+ZA+")*",X6="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Z6="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",JA=QA+ZA+Y6,Q6="(?:"+[K6,gb,mb].join("|")+")"+JA,J6="(?:"+[KA+ud+"?",ud,gb,mb,z6].join("|")+")",eB=RegExp(db,"g"),tB=RegExp(ud,"g"),yb=RegExp(pb+"(?="+pb+")|"+J6+JA,"g"),rB=RegExp([ic+"?"+WA+"+"+YA+"(?="+[qA,ic,"$"].join("|")+")",G6+"+"+XA+"(?="+[qA,ic+GA,"$"].join("|")+")",ic+"?"+GA+"+"+YA,ic+"+"+XA,Z6,X6,HA,Q6].join("|"),"g"),nB=RegExp("["+VA+Os+$A+FA+"]"),iB=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,sB=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],oB=-1,dr={};dr[Y]=dr[ae]=dr[pe]=dr[Ee]=dr[ue]=dr[we]=dr[He]=dr[ze]=dr[Ke]=!0,dr[J]=dr[_e]=dr[T]=dr[ne]=dr[D]=dr[de]=dr[X]=dr[ee]=dr[be]=dr[te]=dr[ge]=dr[Te]=dr[ye]=dr[Re]=dr[et]=!1;var cr={};cr[J]=cr[_e]=cr[T]=cr[D]=cr[ne]=cr[de]=cr[Y]=cr[ae]=cr[pe]=cr[Ee]=cr[ue]=cr[be]=cr[te]=cr[ge]=cr[Te]=cr[ye]=cr[Re]=cr[Fe]=cr[we]=cr[He]=cr[ze]=cr[Ke]=!0,cr[X]=cr[ee]=cr[et]=!1;var aB={:"A",:"A",:"A",:"A",:"A",:"A",:"a",:"a",:"a",:"a",:"a",:"a",:"C",:"c",:"D",:"d",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"N",:"n",:"O",:"O",:"O",:"O",:"O",:"O",:"o",:"o",:"o",:"o",:"o",:"o",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"Y",:"y",:"y",:"Ae",:"ae",:"Th",:"th",:"ss",:"A",:"A",:"A",:"a",:"a",:"a",:"C",:"C",:"C",:"C",:"c",:"c",:"c",:"c",:"D",:"D",:"d",:"d",:"E",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"e",:"G",:"G",:"G",:"G",:"g",:"g",:"g",:"g",:"H",:"H",:"h",:"h",:"I",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"i",:"J",:"j",:"K",:"k",:"k",:"L",:"L",:"L",:"L",:"L",:"l",:"l",:"l",:"l",:"l",:"N",:"N",:"N",:"N",:"n",:"n",:"n",:"n",:"O",:"O",:"O",:"o",:"o",:"o",:"R",:"R",:"R",:"r",:"r",:"r",:"S",:"S",:"S",:"S",:"s",:"s",:"s",:"s",:"T",:"T",:"T",:"t",:"t",:"t",:"U",:"U",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"u",:"u",:"W",:"w",:"Y",:"y",:"Y",:"Z",:"Z",:"Z",:"z",:"z",:"z",:"IJ",:"ij",:"Oe",:"oe",:"'n",:"s"},lB={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},cB={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},uB={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},hB=parseFloat,fB=parseInt,e2=typeof Ui=="object"&&Ui&&Ui.Object===Object&&Ui,dB=typeof self=="object"&&self&&self.Object===Object&&self,tn=e2||dB||Function("return this")(),bb=e&&!e.nodeType&&e,Pa=bb&&!0&&n&&!n.nodeType&&n,t2=Pa&&Pa.exports===bb,wb=t2&&e2.process,Ci=function(){try{var Se=Pa&&Pa.require&&Pa.require("util").types;return Se||wb&&wb.binding&&wb.binding("util")}catch{}}(),r2=Ci&&Ci.isArrayBuffer,n2=Ci&&Ci.isDate,i2=Ci&&Ci.isMap,s2=Ci&&Ci.isRegExp,o2=Ci&&Ci.isSet,a2=Ci&&Ci.isTypedArray;function si(Se,De,ke){switch(ke.length){case 0:return Se.call(De);case 1:return Se.call(De,ke[0]);case 2:return Se.call(De,ke[0],ke[1]);case 3:return Se.call(De,ke[0],ke[1],ke[2])}return Se.apply(De,ke)}function pB(Se,De,ke,Ze){for(var vt=-1,qt=Se==null?0:Se.length;++vt<qt;){var Hr=Se[vt];De(Ze,Hr,ke(Hr),Se)}return Ze}function ki(Se,De){for(var ke=-1,Ze=Se==null?0:Se.length;++ke<Ze&&De(Se[ke],ke,Se)!==!1;);return Se}function gB(Se,De){for(var ke=Se==null?0:Se.length;ke--&&De(Se[ke],ke,Se)!==!1;);return Se}function l2(Se,De){for(var ke=-1,Ze=Se==null?0:Se.length;++ke<Ze;)if(!De(Se[ke],ke,Se))return!1;return!0}function Ao(Se,De){for(var ke=-1,Ze=Se==null?0:Se.length,vt=0,qt=[];++ke<Ze;){var Hr=Se[ke];De(Hr,ke,Se)&&(qt[vt++]=Hr)}return qt}function hd(Se,De){var ke=Se==null?0:Se.length;return!!ke&&sc(Se,De,0)>-1}function vb(Se,De,ke){for(var Ze=-1,vt=Se==null?0:Se.length;++Ze<vt;)if(ke(De,Se[Ze]))return!0;return!1}function gr(Se,De){for(var ke=-1,Ze=Se==null?0:Se.length,vt=Array(Ze);++ke<Ze;)vt[ke]=De(Se[ke],ke,Se);return vt}function xo(Se,De){for(var ke=-1,Ze=De.length,vt=Se.length;++ke<Ze;)Se[vt+ke]=De[ke];return Se}function _b(Se,De,ke,Ze){var vt=-1,qt=Se==null?0:Se.length;for(Ze&&qt&&(ke=Se[++vt]);++vt<qt;)ke=De(ke,Se[vt],vt,Se);return ke}function mB(Se,De,ke,Ze){var vt=Se==null?0:Se.length;for(Ze&&vt&&(ke=Se[--vt]);vt--;)ke=De(ke,Se[vt],vt,Se);return ke}function Eb(Se,De){for(var ke=-1,Ze=Se==null?0:Se.length;++ke<Ze;)if(De(Se[ke],ke,Se))return!0;return!1}var yB=Sb("length");function bB(Se){return Se.split("")}function wB(Se){return Se.match(Ii)||[]}function c2(Se,De,ke){var Ze;return ke(Se,function(vt,qt,Hr){if(De(vt,qt,Hr))return Ze=qt,!1}),Ze}function fd(Se,De,ke,Ze){for(var vt=Se.length,qt=ke+(Ze?1:-1);Ze?qt--:++qt<vt;)if(De(Se[qt],qt,Se))return qt;return-1}function sc(Se,De,ke){return De===De?RB(Se,De,ke):fd(Se,u2,ke)}function vB(Se,De,ke,Ze){for(var vt=ke-1,qt=Se.length;++vt<qt;)if(Ze(Se[vt],De))return vt;return-1}function u2(Se){return Se!==Se}function h2(Se,De){var ke=Se==null?0:Se.length;return ke?xb(Se,De)/ke:z}function Sb(Se){return function(De){return De==null?t:De[Se]}}function Ab(Se){return function(De){return Se==null?t:Se[De]}}function f2(Se,De,ke,Ze,vt){return vt(Se,function(qt,Hr,ir){ke=Ze?(Ze=!1,qt):De(ke,qt,Hr,ir)}),ke}function _B(Se,De){var ke=Se.length;for(Se.sort(De);ke--;)Se[ke]=Se[ke].value;return Se}function xb(Se,De){for(var ke,Ze=-1,vt=Se.length;++Ze<vt;){var qt=De(Se[Ze]);qt!==t&&(ke=ke===t?qt:ke+qt)}return ke}function Ib(Se,De){for(var ke=-1,Ze=Array(Se);++ke<Se;)Ze[ke]=De(ke);return Ze}function EB(Se,De){return gr(De,function(ke){return[ke,Se[ke]]})}function d2(Se){return Se&&Se.slice(0,y2(Se)+1).replace(Ve,"")}function oi(Se){return function(De){return Se(De)}}function Tb(Se,De){return gr(De,function(ke){return Se[ke]})}function Ju(Se,De){return Se.has(De)}function p2(Se,De){for(var ke=-1,Ze=Se.length;++ke<Ze&&sc(De,Se[ke],0)>-1;);return ke}function g2(Se,De){for(var ke=Se.length;ke--&&sc(De,Se[ke],0)>-1;);return ke}function SB(Se,De){for(var ke=Se.length,Ze=0;ke--;)Se[ke]===De&&++Ze;return Ze}var AB=Ab(aB),xB=Ab(lB);function IB(Se){return"\\"+uB[Se]}function TB(Se,De){return Se==null?t:Se[De]}function oc(Se){return nB.test(Se)}function CB(Se){return iB.test(Se)}function kB(Se){for(var De,ke=[];!(De=Se.next()).done;)ke.push(De.value);return ke}function Cb(Se){var De=-1,ke=Array(Se.size);return Se.forEach(function(Ze,vt){ke[++De]=[vt,Ze]}),ke}function m2(Se,De){return function(ke){return Se(De(ke))}}function Io(Se,De){for(var ke=-1,Ze=Se.length,vt=0,qt=[];++ke<Ze;){var Hr=Se[ke];(Hr===De||Hr===h)&&(Se[ke]=h,qt[vt++]=ke)}return qt}function dd(Se){var De=-1,ke=Array(Se.size);return Se.forEach(function(Ze){ke[++De]=Ze}),ke}function PB(Se){var De=-1,ke=Array(Se.size);return Se.forEach(function(Ze){ke[++De]=[Ze,Ze]}),ke}function RB(Se,De,ke){for(var Ze=ke-1,vt=Se.length;++Ze<vt;)if(Se[Ze]===De)return Ze;return-1}function OB(Se,De,ke){for(var Ze=ke+1;Ze--;)if(Se[Ze]===De)return Ze;return Ze}function ac(Se){return oc(Se)?NB(Se):yB(Se)}function Wi(Se){return oc(Se)?DB(Se):bB(Se)}function y2(Se){for(var De=Se.length;De--&&lr.test(Se.charAt(De)););return De}var LB=Ab(cB);function NB(Se){for(var De=yb.lastIndex=0;yb.test(Se);)++De;return De}function DB(Se){return Se.match(yb)||[]}function $B(Se){return Se.match(rB)||[]}var MB=function Se(De){De=De==null?tn:lc.defaults(tn.Object(),De,lc.pick(tn,sB));var ke=De.Array,Ze=De.Date,vt=De.Error,qt=De.Function,Hr=De.Math,ir=De.Object,kb=De.RegExp,BB=De.String,Pi=De.TypeError,pd=ke.prototype,UB=qt.prototype,cc=ir.prototype,gd=De["__core-js_shared__"],md=UB.toString,Qt=cc.hasOwnProperty,FB=0,b2=function(){var u=/[^.]+$/.exec(gd&&gd.keys&&gd.keys.IE_PROTO||"");return u?"Symbol(src)_1."+u:""}(),yd=cc.toString,jB=md.call(ir),qB=tn._,HB=kb("^"+md.call(Qt).replace(Ue,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),bd=t2?De.Buffer:t,To=De.Symbol,wd=De.Uint8Array,w2=bd?bd.allocUnsafe:t,vd=m2(ir.getPrototypeOf,ir),v2=ir.create,_2=cc.propertyIsEnumerable,_d=pd.splice,E2=To?To.isConcatSpreadable:t,eh=To?To.iterator:t,Ra=To?To.toStringTag:t,Ed=function(){try{var u=$a(ir,"defineProperty");return u({},"",{}),u}catch{}}(),WB=De.clearTimeout!==tn.clearTimeout&&De.clearTimeout,zB=Ze&&Ze.now!==tn.Date.now&&Ze.now,KB=De.setTimeout!==tn.setTimeout&&De.setTimeout,Sd=Hr.ceil,Ad=Hr.floor,Pb=ir.getOwnPropertySymbols,VB=bd?bd.isBuffer:t,S2=De.isFinite,GB=pd.join,YB=m2(ir.keys,ir),Wr=Hr.max,yn=Hr.min,XB=Ze.now,ZB=De.parseInt,A2=Hr.random,QB=pd.reverse,Rb=$a(De,"DataView"),th=$a(De,"Map"),Ob=$a(De,"Promise"),uc=$a(De,"Set"),rh=$a(De,"WeakMap"),nh=$a(ir,"create"),xd=rh&&new rh,hc={},JB=Ma(Rb),e4=Ma(th),t4=Ma(Ob),r4=Ma(uc),n4=Ma(rh),Id=To?To.prototype:t,ih=Id?Id.valueOf:t,x2=Id?Id.toString:t;function Q(u){if(kr(u)&&!_t(u)&&!(u instanceof kt)){if(u instanceof Ri)return u;if(Qt.call(u,"__wrapped__"))return Tx(u)}return new Ri(u)}var fc=function(){function u(){}return function(f){if(!Sr(f))return{};if(v2)return v2(f);u.prototype=f;var w=new u;return u.prototype=t,w}}();function Td(){}function Ri(u,f){this.__wrapped__=u,this.__actions__=[],this.__chain__=!!f,this.__index__=0,this.__values__=t}Q.templateSettings={escape:Ot,evaluate:Zt,interpolate:ar,variable:"",imports:{_:Q}},Q.prototype=Td.prototype,Q.prototype.constructor=Q,Ri.prototype=fc(Td.prototype),Ri.prototype.constructor=Ri;function kt(u){this.__wrapped__=u,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=Z,this.__views__=[]}function i4(){var u=new kt(this.__wrapped__);return u.__actions__=Wn(this.__actions__),u.__dir__=this.__dir__,u.__filtered__=this.__filtered__,u.__iteratees__=Wn(this.__iteratees__),u.__takeCount__=this.__takeCount__,u.__views__=Wn(this.__views__),u}function s4(){if(this.__filtered__){var u=new kt(this);u.__dir__=-1,u.__filtered__=!0}else u=this.clone(),u.__dir__*=-1;return u}function o4(){var u=this.__wrapped__.value(),f=this.__dir__,w=_t(u),R=f<0,j=w?u.length:0,re=b5(0,j,this.__views__),he=re.start,ve=re.end,xe=ve-he,Me=R?ve:he-1,Be=this.__iteratees__,je=Be.length,Ge=0,tt=yn(xe,this.__takeCount__);if(!w||!R&&j==xe&&tt==xe)return Y2(u,this.__actions__);var ut=[];e:for(;xe--&&Ge<tt;){Me+=f;for(var At=-1,ht=u[Me];++At<je;){var Tt=Be[At],Lt=Tt.iteratee,ci=Tt.type,Nn=Lt(ht);if(ci==L)ht=Nn;else if(!Nn){if(ci==N)continue e;break e}}ut[Ge++]=ht}return ut}kt.prototype=fc(Td.prototype),kt.prototype.constructor=kt;function Oa(u){var f=-1,w=u==null?0:u.length;for(this.clear();++f<w;){var R=u[f];this.set(R[0],R[1])}}function a4(){this.__data__=nh?nh(null):{},this.size=0}function l4(u){var f=this.has(u)&&delete this.__data__[u];return this.size-=f?1:0,f}function c4(u){var f=this.__data__;if(nh){var w=f[u];return w===l?t:w}return Qt.call(f,u)?f[u]:t}function u4(u){var f=this.__data__;return nh?f[u]!==t:Qt.call(f,u)}function h4(u,f){var w=this.__data__;return this.size+=this.has(u)?0:1,w[u]=nh&&f===t?l:f,this}Oa.prototype.clear=a4,Oa.prototype.delete=l4,Oa.prototype.get=c4,Oa.prototype.has=u4,Oa.prototype.set=h4;function Ls(u){var f=-1,w=u==null?0:u.length;for(this.clear();++f<w;){var R=u[f];this.set(R[0],R[1])}}function f4(){this.__data__=[],this.size=0}function d4(u){var f=this.__data__,w=Cd(f,u);if(w<0)return!1;var R=f.length-1;return w==R?f.pop():_d.call(f,w,1),--this.size,!0}function p4(u){var f=this.__data__,w=Cd(f,u);return w<0?t:f[w][1]}function g4(u){return Cd(this.__data__,u)>-1}function m4(u,f){var w=this.__data__,R=Cd(w,u);return R<0?(++this.size,w.push([u,f])):w[R][1]=f,this}Ls.prototype.clear=f4,Ls.prototype.delete=d4,Ls.prototype.get=p4,Ls.prototype.has=g4,Ls.prototype.set=m4;function Ns(u){var f=-1,w=u==null?0:u.length;for(this.clear();++f<w;){var R=u[f];this.set(R[0],R[1])}}function y4(){this.size=0,this.__data__={hash:new Oa,map:new(th||Ls),string:new Oa}}function b4(u){var f=Fd(this,u).delete(u);return this.size-=f?1:0,f}function w4(u){return Fd(this,u).get(u)}function v4(u){return Fd(this,u).has(u)}function _4(u,f){var w=Fd(this,u),R=w.size;return w.set(u,f),this.size+=w.size==R?0:1,this}Ns.prototype.clear=y4,Ns.prototype.delete=b4,Ns.prototype.get=w4,Ns.prototype.has=v4,Ns.prototype.set=_4;function La(u){var f=-1,w=u==null?0:u.length;for(this.__data__=new Ns;++f<w;)this.add(u[f])}function E4(u){return this.__data__.set(u,l),this}function S4(u){return this.__data__.has(u)}La.prototype.add=La.prototype.push=E4,La.prototype.has=S4;function zi(u){var f=this.__data__=new Ls(u);this.size=f.size}function A4(){this.__data__=new Ls,this.size=0}function x4(u){var f=this.__data__,w=f.delete(u);return this.size=f.size,w}function I4(u){return this.__data__.get(u)}function T4(u){return this.__data__.has(u)}function C4(u,f){var w=this.__data__;if(w instanceof Ls){var R=w.__data__;if(!th||R.length<i-1)return R.push([u,f]),this.size=++w.size,this;w=this.__data__=new Ns(R)}return w.set(u,f),this.size=w.size,this}zi.prototype.clear=A4,zi.prototype.delete=x4,zi.prototype.get=I4,zi.prototype.has=T4,zi.prototype.set=C4;function I2(u,f){var w=_t(u),R=!w&&Ba(u),j=!w&&!R&&Oo(u),re=!w&&!R&&!j&&mc(u),he=w||R||j||re,ve=he?Ib(u.length,BB):[],xe=ve.length;for(var Me in u)(f||Qt.call(u,Me))&&!(he&&(Me=="length"||j&&(Me=="offset"||Me=="parent")||re&&(Me=="buffer"||Me=="byteLength"||Me=="byteOffset")||Bs(Me,xe)))&&ve.push(Me);return ve}function T2(u){var f=u.length;return f?u[Hb(0,f-1)]:t}function k4(u,f){return jd(Wn(u),Na(f,0,u.length))}function P4(u){return jd(Wn(u))}function Lb(u,f,w){(w!==t&&!Ki(u[f],w)||w===t&&!(f in u))&&Ds(u,f,w)}function sh(u,f,w){var R=u[f];(!(Qt.call(u,f)&&Ki(R,w))||w===t&&!(f in u))&&Ds(u,f,w)}function Cd(u,f){for(var w=u.length;w--;)if(Ki(u[w][0],f))return w;return-1}function R4(u,f,w,R){return Co(u,function(j,re,he){f(R,j,w(j),he)}),R}function C2(u,f){return u&&us(f,Yr(f),u)}function O4(u,f){return u&&us(f,Kn(f),u)}function Ds(u,f,w){f=="__proto__"&&Ed?Ed(u,f,{configurable:!0,enumerable:!0,value:w,writable:!0}):u[f]=w}function Nb(u,f){for(var w=-1,R=f.length,j=ke(R),re=u==null;++w<R;)j[w]=re?t:p0(u,f[w]);return j}function Na(u,f,w){return u===u&&(w!==t&&(u=u<=w?u:w),f!==t&&(u=u>=f?u:f)),u}function Oi(u,f,w,R,j,re){var he,ve=f&d,xe=f&p,Me=f&g;if(w&&(he=j?w(u,R,j,re):w(u)),he!==t)return he;if(!Sr(u))return u;var Be=_t(u);if(Be){if(he=v5(u),!ve)return Wn(u,he)}else{var je=bn(u),Ge=je==ee||je==me;if(Oo(u))return Q2(u,ve);if(je==ge||je==J||Ge&&!j){if(he=xe||Ge?{}:yx(u),!ve)return xe?c5(u,O4(he,u)):l5(u,C2(he,u))}else{if(!cr[je])return j?u:{};he=_5(u,je,ve)}}re||(re=new zi);var tt=re.get(u);if(tt)return tt;re.set(u,he),Vx(u)?u.forEach(function(ht){he.add(Oi(ht,f,w,ht,u,re))}):zx(u)&&u.forEach(function(ht,Tt){he.set(Tt,Oi(ht,f,w,Tt,u,re))});var ut=Me?xe?e0:Jb:xe?Kn:Yr,At=Be?t:ut(u);return ki(At||u,function(ht,Tt){At&&(Tt=ht,ht=u[Tt]),sh(he,Tt,Oi(ht,f,w,Tt,u,re))}),he}function L4(u){var f=Yr(u);return function(w){return k2(w,u,f)}}function k2(u,f,w){var R=w.length;if(u==null)return!R;for(u=ir(u);R--;){var j=w[R],re=f[j],he=u[j];if(he===t&&!(j in u)||!re(he))return!1}return!0}function P2(u,f,w){if(typeof u!="function")throw new Pi(o);return fh(function(){u.apply(t,w)},f)}function oh(u,f,w,R){var j=-1,re=hd,he=!0,ve=u.length,xe=[],Me=f.length;if(!ve)return xe;w&&(f=gr(f,oi(w))),R?(re=vb,he=!1):f.length>=i&&(re=Ju,he=!1,f=new La(f));e:for(;++j<ve;){var Be=u[j],je=w==null?Be:w(Be);if(Be=R||Be!==0?Be:0,he&&je===je){for(var Ge=Me;Ge--;)if(f[Ge]===je)continue e;xe.push(Be)}else re(f,je,R)||xe.push(Be)}return xe}var Co=nx(cs),R2=nx($b,!0);function N4(u,f){var w=!0;return Co(u,function(R,j,re){return w=!!f(R,j,re),w}),w}function kd(u,f,w){for(var R=-1,j=u.length;++R<j;){var re=u[R],he=f(re);if(he!=null&&(ve===t?he===he&&!li(he):w(he,ve)))var ve=he,xe=re}return xe}function D4(u,f,w,R){var j=u.length;for(w=Et(w),w<0&&(w=-w>j?0:j+w),R=R===t||R>j?j:Et(R),R<0&&(R+=j),R=w>R?0:Yx(R);w<R;)u[w++]=f;return u}function O2(u,f){var w=[];return Co(u,function(R,j,re){f(R,j,re)&&w.push(R)}),w}function rn(u,f,w,R,j){var re=-1,he=u.length;for(w||(w=S5),j||(j=[]);++re<he;){var ve=u[re];f>0&&w(ve)?f>1?rn(ve,f-1,w,R,j):xo(j,ve):R||(j[j.length]=ve)}return j}var Db=ix(),L2=ix(!0);function cs(u,f){return u&&Db(u,f,Yr)}function $b(u,f){return u&&L2(u,f,Yr)}function Pd(u,f){return Ao(f,function(w){return Us(u[w])})}function Da(u,f){f=Po(f,u);for(var w=0,R=f.length;u!=null&&w<R;)u=u[hs(f[w++])];return w&&w==R?u:t}function N2(u,f,w){var R=f(u);return _t(u)?R:xo(R,w(u))}function On(u){return u==null?u===t?Ce:le:Ra&&Ra in ir(u)?y5(u):P5(u)}function Mb(u,f){return u>f}function $4(u,f){return u!=null&&Qt.call(u,f)}function M4(u,f){return u!=null&&f in ir(u)}function B4(u,f,w){return u>=yn(f,w)&&u<Wr(f,w)}function Bb(u,f,w){for(var R=w?vb:hd,j=u[0].length,re=u.length,he=re,ve=ke(re),xe=1/0,Me=[];he--;){var Be=u[he];he&&f&&(Be=gr(Be,oi(f))),xe=yn(Be.length,xe),ve[he]=!w&&(f||j>=120&&Be.length>=120)?new La(he&&Be):t}Be=u[0];var je=-1,Ge=ve[0];e:for(;++je<j&&Me.length<xe;){var tt=Be[je],ut=f?f(tt):tt;if(tt=w||tt!==0?tt:0,!(Ge?Ju(Ge,ut):R(Me,ut,w))){for(he=re;--he;){var At=ve[he];if(!(At?Ju(At,ut):R(u[he],ut,w)))continue e}Ge&&Ge.push(ut),Me.push(tt)}}return Me}function U4(u,f,w,R){return cs(u,function(j,re,he){f(R,w(j),re,he)}),R}function ah(u,f,w){f=Po(f,u),u=Ex(u,f);var R=u==null?u:u[hs(Ni(f))];return R==null?t:si(R,u,w)}function D2(u){return kr(u)&&On(u)==J}function F4(u){return kr(u)&&On(u)==T}function j4(u){return kr(u)&&On(u)==de}function lh(u,f,w,R,j){return u===f?!0:u==null||f==null||!kr(u)&&!kr(f)?u!==u&&f!==f:q4(u,f,w,R,lh,j)}function q4(u,f,w,R,j,re){var he=_t(u),ve=_t(f),xe=he?_e:bn(u),Me=ve?_e:bn(f);xe=xe==J?ge:xe,Me=Me==J?ge:Me;var Be=xe==ge,je=Me==ge,Ge=xe==Me;if(Ge&&Oo(u)){if(!Oo(f))return!1;he=!0,Be=!1}if(Ge&&!Be)return re||(re=new zi),he||mc(u)?px(u,f,w,R,j,re):g5(u,f,xe,w,R,j,re);if(!(w&m)){var tt=Be&&Qt.call(u,"__wrapped__"),ut=je&&Qt.call(f,"__wrapped__");if(tt||ut){var At=tt?u.value():u,ht=ut?f.value():f;return re||(re=new zi),j(At,ht,w,R,re)}}return Ge?(re||(re=new zi),m5(u,f,w,R,j,re)):!1}function H4(u){return kr(u)&&bn(u)==be}function Ub(u,f,w,R){var j=w.length,re=j,he=!R;if(u==null)return!re;for(u=ir(u);j--;){var ve=w[j];if(he&&ve[2]?ve[1]!==u[ve[0]]:!(ve[0]in u))return!1}for(;++j<re;){ve=w[j];var xe=ve[0],Me=u[xe],Be=ve[1];if(he&&ve[2]){if(Me===t&&!(xe in u))return!1}else{var je=new zi;if(R)var Ge=R(Me,Be,xe,u,f,je);if(!(Ge===t?lh(Be,Me,m|E,R,je):Ge))return!1}}return!0}function $2(u){if(!Sr(u)||x5(u))return!1;var f=Us(u)?HB:en;return f.test(Ma(u))}function W4(u){return kr(u)&&On(u)==Te}function z4(u){return kr(u)&&bn(u)==ye}function K4(u){return kr(u)&&Vd(u.length)&&!!dr[On(u)]}function M2(u){return typeof u=="function"?u:u==null?Vn:typeof u=="object"?_t(u)?F2(u[0],u[1]):U2(u):oI(u)}function Fb(u){if(!hh(u))return YB(u);var f=[];for(var w in ir(u))Qt.call(u,w)&&w!="constructor"&&f.push(w);return f}function V4(u){if(!Sr(u))return k5(u);var f=hh(u),w=[];for(var R in u)R=="constructor"&&(f||!Qt.call(u,R))||w.push(R);return w}function jb(u,f){return u<f}function B2(u,f){var w=-1,R=zn(u)?ke(u.length):[];return Co(u,function(j,re,he){R[++w]=f(j,re,he)}),R}function U2(u){var f=r0(u);return f.length==1&&f[0][2]?vx(f[0][0],f[0][1]):function(w){return w===u||Ub(w,u,f)}}function F2(u,f){return i0(u)&&bx(f)?vx(hs(u),f):function(w){var R=p0(w,u);return R===t&&R===f?g0(w,u):lh(f,R,m|E)}}function Rd(u,f,w,R,j){u!==f&&Db(f,function(re,he){if(j||(j=new zi),Sr(re))G4(u,f,he,w,Rd,R,j);else{var ve=R?R(o0(u,he),re,he+"",u,f,j):t;ve===t&&(ve=re),Lb(u,he,ve)}},Kn)}function G4(u,f,w,R,j,re,he){var ve=o0(u,w),xe=o0(f,w),Me=he.get(xe);if(Me){Lb(u,w,Me);return}var Be=re?re(ve,xe,w+"",u,f,he):t,je=Be===t;if(je){var Ge=_t(xe),tt=!Ge&&Oo(xe),ut=!Ge&&!tt&&mc(xe);Be=xe,Ge||tt||ut?_t(ve)?Be=ve:Nr(ve)?Be=Wn(ve):tt?(je=!1,Be=Q2(xe,!0)):ut?(je=!1,Be=J2(xe,!0)):Be=[]:dh(xe)||Ba(xe)?(Be=ve,Ba(ve)?Be=Xx(ve):(!Sr(ve)||Us(ve))&&(Be=yx(xe))):je=!1}je&&(he.set(xe,Be),j(Be,xe,R,re,he),he.delete(xe)),Lb(u,w,Be)}function j2(u,f){var w=u.length;if(w)return f+=f<0?w:0,Bs(f,w)?u[f]:t}function q2(u,f,w){f.length?f=gr(f,function(re){return _t(re)?function(he){return Da(he,re.length===1?re[0]:re)}:re}):f=[Vn];var R=-1;f=gr(f,oi(ct()));var j=B2(u,function(re,he,ve){var xe=gr(f,function(Me){return Me(re)});return{criteria:xe,index:++R,value:re}});return _B(j,function(re,he){return a5(re,he,w)})}function Y4(u,f){return H2(u,f,function(w,R){return g0(u,R)})}function H2(u,f,w){for(var R=-1,j=f.length,re={};++R<j;){var he=f[R],ve=Da(u,he);w(ve,he)&&ch(re,Po(he,u),ve)}return re}function X4(u){return function(f){return Da(f,u)}}function qb(u,f,w,R){var j=R?vB:sc,re=-1,he=f.length,ve=u;for(u===f&&(f=Wn(f)),w&&(ve=gr(u,oi(w)));++re<he;)for(var xe=0,Me=f[re],Be=w?w(Me):Me;(xe=j(ve,Be,xe,R))>-1;)ve!==u&&_d.call(ve,xe,1),_d.call(u,xe,1);return u}function W2(u,f){for(var w=u?f.length:0,R=w-1;w--;){var j=f[w];if(w==R||j!==re){var re=j;Bs(j)?_d.call(u,j,1):Kb(u,j)}}return u}function Hb(u,f){return u+Ad(A2()*(f-u+1))}function Z4(u,f,w,R){for(var j=-1,re=Wr(Sd((f-u)/(w||1)),0),he=ke(re);re--;)he[R?re:++j]=u,u+=w;return he}function Wb(u,f){var w="";if(!u||f<1||f>H)return w;do f%2&&(w+=u),f=Ad(f/2),f&&(u+=u);while(f);return w}function xt(u,f){return a0(_x(u,f,Vn),u+"")}function Q4(u){return T2(yc(u))}function J4(u,f){var w=yc(u);return jd(w,Na(f,0,w.length))}function ch(u,f,w,R){if(!Sr(u))return u;f=Po(f,u);for(var j=-1,re=f.length,he=re-1,ve=u;ve!=null&&++j<re;){var xe=hs(f[j]),Me=w;if(xe==="__proto__"||xe==="constructor"||xe==="prototype")return u;if(j!=he){var Be=ve[xe];Me=R?R(Be,xe,ve):t,Me===t&&(Me=Sr(Be)?Be:Bs(f[j+1])?[]:{})}sh(ve,xe,Me),ve=ve[xe]}return u}var z2=xd?function(u,f){return xd.set(u,f),u}:Vn,e5=Ed?function(u,f){return Ed(u,"toString",{configurable:!0,enumerable:!1,value:y0(f),writable:!0})}:Vn;function t5(u){return jd(yc(u))}function Li(u,f,w){var R=-1,j=u.length;f<0&&(f=-f>j?0:j+f),w=w>j?j:w,w<0&&(w+=j),j=f>w?0:w-f>>>0,f>>>=0;for(var re=ke(j);++R<j;)re[R]=u[R+f];return re}function r5(u,f){var w;return Co(u,function(R,j,re){return w=f(R,j,re),!w}),!!w}function Od(u,f,w){var R=0,j=u==null?R:u.length;if(typeof f=="number"&&f===f&&j<=ie){for(;R<j;){var re=R+j>>>1,he=u[re];he!==null&&!li(he)&&(w?he<=f:he<f)?R=re+1:j=re}return j}return zb(u,f,Vn,w)}function zb(u,f,w,R){var j=0,re=u==null?0:u.length;if(re===0)return 0;f=w(f);for(var he=f!==f,ve=f===null,xe=li(f),Me=f===t;j<re;){var Be=Ad((j+re)/2),je=w(u[Be]),Ge=je!==t,tt=je===null,ut=je===je,At=li(je);if(he)var ht=R||ut;else Me?ht=ut&&(R||Ge):ve?ht=ut&&Ge&&(R||!tt):xe?ht=ut&&Ge&&!tt&&(R||!At):tt||At?ht=!1:ht=R?je<=f:je<f;ht?j=Be+1:re=Be}return yn(re,F)}function K2(u,f){for(var w=-1,R=u.length,j=0,re=[];++w<R;){var he=u[w],ve=f?f(he):he;if(!w||!Ki(ve,xe)){var xe=ve;re[j++]=he===0?0:he}}return re}function V2(u){return typeof u=="number"?u:li(u)?z:+u}function ai(u){if(typeof u=="string")return u;if(_t(u))return gr(u,ai)+"";if(li(u))return x2?x2.call(u):"";var f=u+"";return f=="0"&&1/u==-W?"-0":f}function ko(u,f,w){var R=-1,j=hd,re=u.length,he=!0,ve=[],xe=ve;if(w)he=!1,j=vb;else if(re>=i){var Me=f?null:d5(u);if(Me)return dd(Me);he=!1,j=Ju,xe=new La}else xe=f?[]:ve;e:for(;++R<re;){var Be=u[R],je=f?f(Be):Be;if(Be=w||Be!==0?Be:0,he&&je===je){for(var Ge=xe.length;Ge--;)if(xe[Ge]===je)continue e;f&&xe.push(je),ve.push(Be)}else j(xe,je,w)||(xe!==ve&&xe.push(je),ve.push(Be))}return ve}function Kb(u,f){return f=Po(f,u),u=Ex(u,f),u==null||delete u[hs(Ni(f))]}function G2(u,f,w,R){return ch(u,f,w(Da(u,f)),R)}function Ld(u,f,w,R){for(var j=u.length,re=R?j:-1;(R?re--:++re<j)&&f(u[re],re,u););return w?Li(u,R?0:re,R?re+1:j):Li(u,R?re+1:0,R?j:re)}function Y2(u,f){var w=u;return w instanceof kt&&(w=w.value()),_b(f,function(R,j){return j.func.apply(j.thisArg,xo([R],j.args))},w)}function Vb(u,f,w){var R=u.length;if(R<2)return R?ko(u[0]):[];for(var j=-1,re=ke(R);++j<R;)for(var he=u[j],ve=-1;++ve<R;)ve!=j&&(re[j]=oh(re[j]||he,u[ve],f,w));return ko(rn(re,1),f,w)}function X2(u,f,w){for(var R=-1,j=u.length,re=f.length,he={};++R<j;){var ve=R<re?f[R]:t;w(he,u[R],ve)}return he}function Gb(u){return Nr(u)?u:[]}function Yb(u){return typeof u=="function"?u:Vn}function Po(u,f){return _t(u)?u:i0(u,f)?[u]:Ix(Yt(u))}var n5=xt;function Ro(u,f,w){var R=u.length;return w=w===t?R:w,!f&&w>=R?u:Li(u,f,w)}var Z2=WB||function(u){return tn.clearTimeout(u)};function Q2(u,f){if(f)return u.slice();var w=u.length,R=w2?w2(w):new u.constructor(w);return u.copy(R),R}function Xb(u){var f=new u.constructor(u.byteLength);return new wd(f).set(new wd(u)),f}function i5(u,f){var w=f?Xb(u.buffer):u.buffer;return new u.constructor(w,u.byteOffset,u.byteLength)}function s5(u){var f=new u.constructor(u.source,Gr.exec(u));return f.lastIndex=u.lastIndex,f}function o5(u){return ih?ir(ih.call(u)):{}}function J2(u,f){var w=f?Xb(u.buffer):u.buffer;return new u.constructor(w,u.byteOffset,u.length)}function ex(u,f){if(u!==f){var w=u!==t,R=u===null,j=u===u,re=li(u),he=f!==t,ve=f===null,xe=f===f,Me=li(f);if(!ve&&!Me&&!re&&u>f||re&&he&&xe&&!ve&&!Me||R&&he&&xe||!w&&xe||!j)return 1;if(!R&&!re&&!Me&&u<f||Me&&w&&j&&!R&&!re||ve&&w&&j||!he&&j||!xe)return-1}return 0}function a5(u,f,w){for(var R=-1,j=u.criteria,re=f.criteria,he=j.length,ve=w.length;++R<he;){var xe=ex(j[R],re[R]);if(xe){if(R>=ve)return xe;var Me=w[R];return xe*(Me=="desc"?-1:1)}}return u.index-f.index}function tx(u,f,w,R){for(var j=-1,re=u.length,he=w.length,ve=-1,xe=f.length,Me=Wr(re-he,0),Be=ke(xe+Me),je=!R;++ve<xe;)Be[ve]=f[ve];for(;++j<he;)(je||j<re)&&(Be[w[j]]=u[j]);for(;Me--;)Be[ve++]=u[j++];return Be}function rx(u,f,w,R){for(var j=-1,re=u.length,he=-1,ve=w.length,xe=-1,Me=f.length,Be=Wr(re-ve,0),je=ke(Be+Me),Ge=!R;++j<Be;)je[j]=u[j];for(var tt=j;++xe<Me;)je[tt+xe]=f[xe];for(;++he<ve;)(Ge||j<re)&&(je[tt+w[he]]=u[j++]);return je}function Wn(u,f){var w=-1,R=u.length;for(f||(f=ke(R));++w<R;)f[w]=u[w];return f}function us(u,f,w,R){var j=!w;w||(w={});for(var re=-1,he=f.length;++re<he;){var ve=f[re],xe=R?R(w[ve],u[ve],ve,w,u):t;xe===t&&(xe=u[ve]),j?Ds(w,ve,xe):sh(w,ve,xe)}return w}function l5(u,f){return us(u,n0(u),f)}function c5(u,f){return us(u,gx(u),f)}function Nd(u,f){return function(w,R){var j=_t(w)?pB:R4,re=f?f():{};return j(w,u,ct(R,2),re)}}function dc(u){return xt(function(f,w){var R=-1,j=w.length,re=j>1?w[j-1]:t,he=j>2?w[2]:t;for(re=u.length>3&&typeof re=="function"?(j--,re):t,he&&Ln(w[0],w[1],he)&&(re=j<3?t:re,j=1),f=ir(f);++R<j;){var ve=w[R];ve&&u(f,ve,R,re)}return f})}function nx(u,f){return function(w,R){if(w==null)return w;if(!zn(w))return u(w,R);for(var j=w.length,re=f?j:-1,he=ir(w);(f?re--:++re<j)&&R(he[re],re,he)!==!1;);return w}}function ix(u){return function(f,w,R){for(var j=-1,re=ir(f),he=R(f),ve=he.length;ve--;){var xe=he[u?ve:++j];if(w(re[xe],xe,re)===!1)break}return f}}function u5(u,f,w){var R=f&y,j=uh(u);function re(){var he=this&&this!==tn&&this instanceof re?j:u;return he.apply(R?w:this,arguments)}return re}function sx(u){return function(f){f=Yt(f);var w=oc(f)?Wi(f):t,R=w?w[0]:f.charAt(0),j=w?Ro(w,1).join(""):f.slice(1);return R[u]()+j}}function pc(u){return function(f){return _b(iI(nI(f).replace(eB,"")),u,"")}}function uh(u){return function(){var f=arguments;switch(f.length){case 0:return new u;case 1:return new u(f[0]);case 2:return new u(f[0],f[1]);case 3:return new u(f[0],f[1],f[2]);case 4:return new u(f[0],f[1],f[2],f[3]);case 5:return new u(f[0],f[1],f[2],f[3],f[4]);case 6:return new u(f[0],f[1],f[2],f[3],f[4],f[5]);case 7:return new u(f[0],f[1],f[2],f[3],f[4],f[5],f[6])}var w=fc(u.prototype),R=u.apply(w,f);return Sr(R)?R:w}}function h5(u,f,w){var R=uh(u);function j(){for(var re=arguments.length,he=ke(re),ve=re,xe=gc(j);ve--;)he[ve]=arguments[ve];var Me=re<3&&he[0]!==xe&&he[re-1]!==xe?[]:Io(he,xe);if(re-=Me.length,re<w)return ux(u,f,Dd,j.placeholder,t,he,Me,t,t,w-re);var Be=this&&this!==tn&&this instanceof j?R:u;return si(Be,this,he)}return j}function ox(u){return function(f,w,R){var j=ir(f);if(!zn(f)){var re=ct(w,3);f=Yr(f),w=function(ve){return re(j[ve],ve,j)}}var he=u(f,w,R);return he>-1?j[re?f[he]:he]:t}}function ax(u){return Ms(function(f){var w=f.length,R=w,j=Ri.prototype.thru;for(u&&f.reverse();R--;){var re=f[R];if(typeof re!="function")throw new Pi(o);if(j&&!he&&Ud(re)=="wrapper")var he=new Ri([],!0)}for(R=he?R:w;++R<w;){re=f[R];var ve=Ud(re),xe=ve=="wrapper"?t0(re):t;xe&&s0(xe[0])&&xe[1]==(U|_|x|O)&&!xe[4].length&&xe[9]==1?he=he[Ud(xe[0])].apply(he,xe[3]):he=re.length==1&&s0(re)?he[ve]():he.thru(re)}return function(){var Me=arguments,Be=Me[0];if(he&&Me.length==1&&_t(Be))return he.plant(Be).value();for(var je=0,Ge=w?f[je].apply(this,Me):Be;++je<w;)Ge=f[je].call(this,Ge);return Ge}})}function Dd(u,f,w,R,j,re,he,ve,xe,Me){var Be=f&U,je=f&y,Ge=f&S,tt=f&(_|I),ut=f&P,At=Ge?t:uh(u);function ht(){for(var Tt=arguments.length,Lt=ke(Tt),ci=Tt;ci--;)Lt[ci]=arguments[ci];if(tt)var Nn=gc(ht),ui=SB(Lt,Nn);if(R&&(Lt=tx(Lt,R,j,tt)),re&&(Lt=rx(Lt,re,he,tt)),Tt-=ui,tt&&Tt<Me){var Dr=Io(Lt,Nn);return ux(u,f,Dd,ht.placeholder,w,Lt,Dr,ve,xe,Me-Tt)}var Vi=je?w:this,js=Ge?Vi[u]:u;return Tt=Lt.length,ve?Lt=R5(Lt,ve):ut&&Tt>1&&Lt.reverse(),Be&&xe<Tt&&(Lt.length=xe),this&&this!==tn&&this instanceof ht&&(js=At||uh(js)),js.apply(Vi,Lt)}return ht}function lx(u,f){return function(w,R){return U4(w,u,f(R),{})}}function $d(u,f){return function(w,R){var j;if(w===t&&R===t)return f;if(w!==t&&(j=w),R!==t){if(j===t)return R;typeof w=="string"||typeof R=="string"?(w=ai(w),R=ai(R)):(w=V2(w),R=V2(R)),j=u(w,R)}return j}}function Zb(u){return Ms(function(f){return f=gr(f,oi(ct())),xt(function(w){var R=this;return u(f,function(j){return si(j,R,w)})})})}function Md(u,f){f=f===t?" ":ai(f);var w=f.length;if(w<2)return w?Wb(f,u):f;var R=Wb(f,Sd(u/ac(f)));return oc(f)?Ro(Wi(R),0,u).join(""):R.slice(0,u)}function f5(u,f,w,R){var j=f&y,re=uh(u);function he(){for(var ve=-1,xe=arguments.length,Me=-1,Be=R.length,je=ke(Be+xe),Ge=this&&this!==tn&&this instanceof he?re:u;++Me<Be;)je[Me]=R[Me];for(;xe--;)je[Me++]=arguments[++ve];return si(Ge,j?w:this,je)}return he}function cx(u){return function(f,w,R){return R&&typeof R!="number"&&Ln(f,w,R)&&(w=R=t),f=Fs(f),w===t?(w=f,f=0):w=Fs(w),R=R===t?f<w?1:-1:Fs(R),Z4(f,w,R,u)}}function Bd(u){return function(f,w){return typeof f=="string"&&typeof w=="string"||(f=Di(f),w=Di(w)),u(f,w)}}function ux(u,f,w,R,j,re,he,ve,xe,Me){var Be=f&_,je=Be?he:t,Ge=Be?t:he,tt=Be?re:t,ut=Be?t:re;f|=Be?x:$,f&=~(Be?$:x),f&b||(f&=-4);var At=[u,f,j,tt,je,ut,Ge,ve,xe,Me],ht=w.apply(t,At);return s0(u)&&Sx(ht,At),ht.placeholder=R,Ax(ht,u,f)}function Qb(u){var f=Hr[u];return function(w,R){if(w=Di(w),R=R==null?0:yn(Et(R),292),R&&S2(w)){var j=(Yt(w)+"e").split("e"),re=f(j[0]+"e"+(+j[1]+R));return j=(Yt(re)+"e").split("e"),+(j[0]+"e"+(+j[1]-R))}return f(w)}}var d5=uc&&1/dd(new uc([,-0]))[1]==W?function(u){return new uc(u)}:v0;function hx(u){return function(f){var w=bn(f);return w==be?Cb(f):w==ye?PB(f):EB(f,u(f))}}function $s(u,f,w,R,j,re,he,ve){var xe=f&S;if(!xe&&typeof u!="function")throw new Pi(o);var Me=R?R.length:0;if(Me||(f&=-97,R=j=t),he=he===t?he:Wr(Et(he),0),ve=ve===t?ve:Et(ve),Me-=j?j.length:0,f&$){var Be=R,je=j;R=j=t}var Ge=xe?t:t0(u),tt=[u,f,w,R,j,Be,je,re,he,ve];if(Ge&&C5(tt,Ge),u=tt[0],f=tt[1],w=tt[2],R=tt[3],j=tt[4],ve=tt[9]=tt[9]===t?xe?0:u.length:Wr(tt[9]-Me,0),!ve&&f&(_|I)&&(f&=-25),!f||f==y)var ut=u5(u,f,w);else f==_||f==I?ut=h5(u,f,ve):(f==x||f==(y|x))&&!j.length?ut=f5(u,f,w,R):ut=Dd.apply(t,tt);var At=Ge?z2:Sx;return Ax(At(ut,tt),u,f)}function fx(u,f,w,R){return u===t||Ki(u,cc[w])&&!Qt.call(R,w)?f:u}function dx(u,f,w,R,j,re){return Sr(u)&&Sr(f)&&(re.set(f,u),Rd(u,f,t,dx,re),re.delete(f)),u}function p5(u){return dh(u)?t:u}function px(u,f,w,R,j,re){var he=w&m,ve=u.length,xe=f.length;if(ve!=xe&&!(he&&xe>ve))return!1;var Me=re.get(u),Be=re.get(f);if(Me&&Be)return Me==f&&Be==u;var je=-1,Ge=!0,tt=w&E?new La:t;for(re.set(u,f),re.set(f,u);++je<ve;){var ut=u[je],At=f[je];if(R)var ht=he?R(At,ut,je,f,u,re):R(ut,At,je,u,f,re);if(ht!==t){if(ht)continue;Ge=!1;break}if(tt){if(!Eb(f,function(Tt,Lt){if(!Ju(tt,Lt)&&(ut===Tt||j(ut,Tt,w,R,re)))return tt.push(Lt)})){Ge=!1;break}}else if(!(ut===At||j(ut,At,w,R,re))){Ge=!1;break}}return re.delete(u),re.delete(f),Ge}function g5(u,f,w,R,j,re,he){switch(w){case D:if(u.byteLength!=f.byteLength||u.byteOffset!=f.byteOffset)return!1;u=u.buffer,f=f.buffer;case T:return!(u.byteLength!=f.byteLength||!re(new wd(u),new wd(f)));case ne:case de:case te:return Ki(+u,+f);case X:return u.name==f.name&&u.message==f.message;case Te:case Re:return u==f+"";case be:var ve=Cb;case ye:var xe=R&m;if(ve||(ve=dd),u.size!=f.size&&!xe)return!1;var Me=he.get(u);if(Me)return Me==f;R|=E,he.set(u,f);var Be=px(ve(u),ve(f),R,j,re,he);return he.delete(u),Be;case Fe:if(ih)return ih.call(u)==ih.call(f)}return!1}function m5(u,f,w,R,j,re){var he=w&m,ve=Jb(u),xe=ve.length,Me=Jb(f),Be=Me.length;if(xe!=Be&&!he)return!1;for(var je=xe;je--;){var Ge=ve[je];if(!(he?Ge in f:Qt.call(f,Ge)))return!1}var tt=re.get(u),ut=re.get(f);if(tt&&ut)return tt==f&&ut==u;var At=!0;re.set(u,f),re.set(f,u);for(var ht=he;++je<xe;){Ge=ve[je];var Tt=u[Ge],Lt=f[Ge];if(R)var ci=he?R(Lt,Tt,Ge,f,u,re):R(Tt,Lt,Ge,u,f,re);if(!(ci===t?Tt===Lt||j(Tt,Lt,w,R,re):ci)){At=!1;break}ht||(ht=Ge=="constructor")}if(At&&!ht){var Nn=u.constructor,ui=f.constructor;Nn!=ui&&"constructor"in u&&"constructor"in f&&!(typeof Nn=="function"&&Nn instanceof Nn&&typeof ui=="function"&&ui instanceof ui)&&(At=!1)}return re.delete(u),re.delete(f),At}function Ms(u){return a0(_x(u,t,Px),u+"")}function Jb(u){return N2(u,Yr,n0)}function e0(u){return N2(u,Kn,gx)}var t0=xd?function(u){return xd.get(u)}:v0;function Ud(u){for(var f=u.name+"",w=hc[f],R=Qt.call(hc,f)?w.length:0;R--;){var j=w[R],re=j.func;if(re==null||re==u)return j.name}return f}function gc(u){var f=Qt.call(Q,"placeholder")?Q:u;return f.placeholder}function ct(){var u=Q.iteratee||b0;return u=u===b0?M2:u,arguments.length?u(arguments[0],arguments[1]):u}function Fd(u,f){var w=u.__data__;return A5(f)?w[typeof f=="string"?"string":"hash"]:w.map}function r0(u){for(var f=Yr(u),w=f.length;w--;){var R=f[w],j=u[R];f[w]=[R,j,bx(j)]}return f}function $a(u,f){var w=TB(u,f);return $2(w)?w:t}function y5(u){var f=Qt.call(u,Ra),w=u[Ra];try{u[Ra]=t;var R=!0}catch{}var j=yd.call(u);return R&&(f?u[Ra]=w:delete u[Ra]),j}var n0=Pb?function(u){return u==null?[]:(u=ir(u),Ao(Pb(u),function(f){return _2.call(u,f)}))}:_0,gx=Pb?function(u){for(var f=[];u;)xo(f,n0(u)),u=vd(u);return f}:_0,bn=On;(Rb&&bn(new Rb(new ArrayBuffer(1)))!=D||th&&bn(new th)!=be||Ob&&bn(Ob.resolve())!=Ie||uc&&bn(new uc)!=ye||rh&&bn(new rh)!=et)&&(bn=function(u){var f=On(u),w=f==ge?u.constructor:t,R=w?Ma(w):"";if(R)switch(R){case JB:return D;case e4:return be;case t4:return Ie;case r4:return ye;case n4:return et}return f});function b5(u,f,w){for(var R=-1,j=w.length;++R<j;){var re=w[R],he=re.size;switch(re.type){case"drop":u+=he;break;case"dropRight":f-=he;break;case"take":f=yn(f,u+he);break;case"takeRight":u=Wr(u,f-he);break}}return{start:u,end:f}}function w5(u){var f=u.match(Vr);return f?f[1].split(xi):[]}function mx(u,f,w){f=Po(f,u);for(var R=-1,j=f.length,re=!1;++R<j;){var he=hs(f[R]);if(!(re=u!=null&&w(u,he)))break;u=u[he]}return re||++R!=j?re:(j=u==null?0:u.length,!!j&&Vd(j)&&Bs(he,j)&&(_t(u)||Ba(u)))}function v5(u){var f=u.length,w=new u.constructor(f);return f&&typeof u[0]=="string"&&Qt.call(u,"index")&&(w.index=u.index,w.input=u.input),w}function yx(u){return typeof u.constructor=="function"&&!hh(u)?fc(vd(u)):{}}function _5(u,f,w){var R=u.constructor;switch(f){case T:return Xb(u);case ne:case de:return new R(+u);case D:return i5(u,w);case Y:case ae:case pe:case Ee:case ue:case we:case He:case ze:case Ke:return J2(u,w);case be:return new R;case te:case Re:return new R(u);case Te:return s5(u);case ye:return new R;case Fe:return o5(u)}}function E5(u,f){var w=f.length;if(!w)return u;var R=w-1;return f[R]=(w>1?"& ":"")+f[R],f=f.join(w>2?", ":" "),u.replace(Cr,`{
/* [wrapped with `+f+`] */
`)}function S5(u){return _t(u)||Ba(u)||!!(E2&&u&&u[E2])}function Bs(u,f){var w=typeof u;return f=f??H,!!f&&(w=="number"||w!="symbol"&&Jl.test(u))&&u>-1&&u%1==0&&u<f}function Ln(u,f,w){if(!Sr(w))return!1;var R=typeof f;return(R=="number"?zn(w)&&Bs(f,w.length):R=="string"&&f in w)?Ki(w[f],u):!1}function i0(u,f){if(_t(u))return!1;var w=typeof u;return w=="number"||w=="symbol"||w=="boolean"||u==null||li(u)?!0:se.test(u)||!Kr.test(u)||f!=null&&u in ir(f)}function A5(u){var f=typeof u;return f=="string"||f=="number"||f=="symbol"||f=="boolean"?u!=="__proto__":u===null}function s0(u){var f=Ud(u),w=Q[f];if(typeof w!="function"||!(f in kt.prototype))return!1;if(u===w)return!0;var R=t0(w);return!!R&&u===R[0]}function x5(u){return!!b2&&b2 in u}var I5=gd?Us:E0;function hh(u){var f=u&&u.constructor,w=typeof f=="function"&&f.prototype||cc;return u===w}function bx(u){return u===u&&!Sr(u)}function vx(u,f){return function(w){return w==null?!1:w[u]===f&&(f!==t||u in ir(w))}}function T5(u){var f=zd(u,function(R){return w.size===c&&w.clear(),R}),w=f.cache;return f}function C5(u,f){var w=u[1],R=f[1],j=w|R,re=j<(y|S|U),he=R==U&&w==_||R==U&&w==O&&u[7].length<=f[8]||R==(U|O)&&f[7].length<=f[8]&&w==_;if(!(re||he))return u;R&y&&(u[2]=f[2],j|=w&y?0:b);var ve=f[3];if(ve){var xe=u[3];u[3]=xe?tx(xe,ve,f[4]):ve,u[4]=xe?Io(u[3],h):f[4]}return ve=f[5],ve&&(xe=u[5],u[5]=xe?rx(xe,ve,f[6]):ve,u[6]=xe?Io(u[5],h):f[6]),ve=f[7],ve&&(u[7]=ve),R&U&&(u[8]=u[8]==null?f[8]:yn(u[8],f[8])),u[9]==null&&(u[9]=f[9]),u[0]=f[0],u[1]=j,u}function k5(u){var f=[];if(u!=null)for(var w in ir(u))f.push(w);return f}function P5(u){return yd.call(u)}function _x(u,f,w){return f=Wr(f===t?u.length-1:f,0),function(){for(var R=arguments,j=-1,re=Wr(R.length-f,0),he=ke(re);++j<re;)he[j]=R[f+j];j=-1;for(var ve=ke(f+1);++j<f;)ve[j]=R[j];return ve[f]=w(he),si(u,this,ve)}}function Ex(u,f){return f.length<2?u:Da(u,Li(f,0,-1))}function R5(u,f){for(var w=u.length,R=yn(f.length,w),j=Wn(u);R--;){var re=f[R];u[R]=Bs(re,w)?j[re]:t}return u}function o0(u,f){if(!(f==="constructor"&&typeof u[f]=="function")&&f!="__proto__")return u[f]}var Sx=xx(z2),fh=KB||function(u,f){return tn.setTimeout(u,f)},a0=xx(e5);function Ax(u,f,w){var R=f+"";return a0(u,E5(R,O5(w5(R),w)))}function xx(u){var f=0,w=0;return function(){var R=XB(),j=B-(R-w);if(w=R,j>0){if(++f>=C)return arguments[0]}else f=0;return u.apply(t,arguments)}}function jd(u,f){var w=-1,R=u.length,j=R-1;for(f=f===t?R:f;++w<f;){var re=Hb(w,j),he=u[re];u[re]=u[w],u[w]=he}return u.length=f,u}var Ix=T5(function(u){var f=[];return u.charCodeAt(0)===46&&f.push(""),u.replace(ce,function(w,R,j,re){f.push(j?re.replace(Hi,"$1"):R||w)}),f});function hs(u){if(typeof u=="string"||li(u))return u;var f=u+"";return f=="0"&&1/u==-W?"-0":f}function Ma(u){if(u!=null){try{return md.call(u)}catch{}try{return u+""}catch{}}return""}function O5(u,f){return ki(fe,function(w){var R="_."+w[0];f&w[1]&&!hd(u,R)&&u.push(R)}),u.sort()}function Tx(u){if(u instanceof kt)return u.clone();var f=new Ri(u.__wrapped__,u.__chain__);return f.__actions__=Wn(u.__actions__),f.__index__=u.__index__,f.__values__=u.__values__,f}function L5(u,f,w){(w?Ln(u,f,w):f===t)?f=1:f=Wr(Et(f),0);var R=u==null?0:u.length;if(!R||f<1)return[];for(var j=0,re=0,he=ke(Sd(R/f));j<R;)he[re++]=Li(u,j,j+=f);return he}function N5(u){for(var f=-1,w=u==null?0:u.length,R=0,j=[];++f<w;){var re=u[f];re&&(j[R++]=re)}return j}function D5(){var u=arguments.length;if(!u)return[];for(var f=ke(u-1),w=arguments[0],R=u;R--;)f[R-1]=arguments[R];return xo(_t(w)?Wn(w):[w],rn(f,1))}var $5=xt(function(u,f){return Nr(u)?oh(u,rn(f,1,Nr,!0)):[]}),M5=xt(function(u,f){var w=Ni(f);return Nr(w)&&(w=t),Nr(u)?oh(u,rn(f,1,Nr,!0),ct(w,2)):[]}),B5=xt(function(u,f){var w=Ni(f);return Nr(w)&&(w=t),Nr(u)?oh(u,rn(f,1,Nr,!0),t,w):[]});function U5(u,f,w){var R=u==null?0:u.length;return R?(f=w||f===t?1:Et(f),Li(u,f<0?0:f,R)):[]}function F5(u,f,w){var R=u==null?0:u.length;return R?(f=w||f===t?1:Et(f),f=R-f,Li(u,0,f<0?0:f)):[]}function j5(u,f){return u&&u.length?Ld(u,ct(f,3),!0,!0):[]}function q5(u,f){return u&&u.length?Ld(u,ct(f,3),!0):[]}function H5(u,f,w,R){var j=u==null?0:u.length;return j?(w&&typeof w!="number"&&Ln(u,f,w)&&(w=0,R=j),D4(u,f,w,R)):[]}function Cx(u,f,w){var R=u==null?0:u.length;if(!R)return-1;var j=w==null?0:Et(w);return j<0&&(j=Wr(R+j,0)),fd(u,ct(f,3),j)}function kx(u,f,w){var R=u==null?0:u.length;if(!R)return-1;var j=R-1;return w!==t&&(j=Et(w),j=w<0?Wr(R+j,0):yn(j,R-1)),fd(u,ct(f,3),j,!0)}function Px(u){var f=u==null?0:u.length;return f?rn(u,1):[]}function W5(u){var f=u==null?0:u.length;return f?rn(u,W):[]}function z5(u,f){var w=u==null?0:u.length;return w?(f=f===t?1:Et(f),rn(u,f)):[]}function K5(u){for(var f=-1,w=u==null?0:u.length,R={};++f<w;){var j=u[f];R[j[0]]=j[1]}return R}function Rx(u){return u&&u.length?u[0]:t}function V5(u,f,w){var R=u==null?0:u.length;if(!R)return-1;var j=w==null?0:Et(w);return j<0&&(j=Wr(R+j,0)),sc(u,f,j)}function G5(u){var f=u==null?0:u.length;return f?Li(u,0,-1):[]}var Y5=xt(function(u){var f=gr(u,Gb);return f.length&&f[0]===u[0]?Bb(f):[]}),X5=xt(function(u){var f=Ni(u),w=gr(u,Gb);return f===Ni(w)?f=t:w.pop(),w.length&&w[0]===u[0]?Bb(w,ct(f,2)):[]}),Z5=xt(function(u){var f=Ni(u),w=gr(u,Gb);return f=typeof f=="function"?f:t,f&&w.pop(),w.length&&w[0]===u[0]?Bb(w,t,f):[]});function Q5(u,f){return u==null?"":GB.call(u,f)}function Ni(u){var f=u==null?0:u.length;return f?u[f-1]:t}function J5(u,f,w){var R=u==null?0:u.length;if(!R)return-1;var j=R;return w!==t&&(j=Et(w),j=j<0?Wr(R+j,0):yn(j,R-1)),f===f?OB(u,f,j):fd(u,u2,j,!0)}function eU(u,f){return u&&u.length?j2(u,Et(f)):t}var tU=xt(Ox);function Ox(u,f){return u&&u.length&&f&&f.length?qb(u,f):u}function rU(u,f,w){return u&&u.length&&f&&f.length?qb(u,f,ct(w,2)):u}function nU(u,f,w){return u&&u.length&&f&&f.length?qb(u,f,t,w):u}var iU=Ms(function(u,f){var w=u==null?0:u.length,R=Nb(u,f);return W2(u,gr(f,function(j){return Bs(j,w)?+j:j}).sort(ex)),R});function sU(u,f){var w=[];if(!(u&&u.length))return w;var R=-1,j=[],re=u.length;for(f=ct(f,3);++R<re;){var he=u[R];f(he,R,u)&&(w.push(he),j.push(R))}return W2(u,j),w}function l0(u){return u==null?u:QB.call(u)}function oU(u,f,w){var R=u==null?0:u.length;return R?(w&&typeof w!="number"&&Ln(u,f,w)?(f=0,w=R):(f=f==null?0:Et(f),w=w===t?R:Et(w)),Li(u,f,w)):[]}function aU(u,f){return Od(u,f)}function lU(u,f,w){return zb(u,f,ct(w,2))}function cU(u,f){var w=u==null?0:u.length;if(w){var R=Od(u,f);if(R<w&&Ki(u[R],f))return R}return-1}function uU(u,f){return Od(u,f,!0)}function hU(u,f,w){return zb(u,f,ct(w,2),!0)}function fU(u,f){var w=u==null?0:u.length;if(w){var R=Od(u,f,!0)-1;if(Ki(u[R],f))return R}return-1}function dU(u){return u&&u.length?K2(u):[]}function pU(u,f){return u&&u.length?K2(u,ct(f,2)):[]}function gU(u){var f=u==null?0:u.length;return f?Li(u,1,f):[]}function mU(u,f,w){return u&&u.length?(f=w||f===t?1:Et(f),Li(u,0,f<0?0:f)):[]}function yU(u,f,w){var R=u==null?0:u.length;return R?(f=w||f===t?1:Et(f),f=R-f,Li(u,f<0?0:f,R)):[]}function bU(u,f){return u&&u.length?Ld(u,ct(f,3),!1,!0):[]}function wU(u,f){return u&&u.length?Ld(u,ct(f,3)):[]}var vU=xt(function(u){return ko(rn(u,1,Nr,!0))}),_U=xt(function(u){var f=Ni(u);return Nr(f)&&(f=t),ko(rn(u,1,Nr,!0),ct(f,2))}),EU=xt(function(u){var f=Ni(u);return f=typeof f=="function"?f:t,ko(rn(u,1,Nr,!0),t,f)});function SU(u){return u&&u.length?ko(u):[]}function AU(u,f){return u&&u.length?ko(u,ct(f,2)):[]}function xU(u,f){return f=typeof f=="function"?f:t,u&&u.length?ko(u,t,f):[]}function c0(u){if(!(u&&u.length))return[];var f=0;return u=Ao(u,function(w){if(Nr(w))return f=Wr(w.length,f),!0}),Ib(f,function(w){return gr(u,Sb(w))})}function Lx(u,f){if(!(u&&u.length))return[];var w=c0(u);return f==null?w:gr(w,function(R){return si(f,t,R)})}var IU=xt(function(u,f){return Nr(u)?oh(u,f):[]}),TU=xt(function(u){return Vb(Ao(u,Nr))}),CU=xt(function(u){var f=Ni(u);return Nr(f)&&(f=t),Vb(Ao(u,Nr),ct(f,2))}),kU=xt(function(u){var f=Ni(u);return f=typeof f=="function"?f:t,Vb(Ao(u,Nr),t,f)}),PU=xt(c0);function RU(u,f){return X2(u||[],f||[],sh)}function OU(u,f){return X2(u||[],f||[],ch)}var LU=xt(function(u){var f=u.length,w=f>1?u[f-1]:t;return w=typeof w=="function"?(u.pop(),w):t,Lx(u,w)});function Nx(u){var f=Q(u);return f.__chain__=!0,f}function NU(u,f){return f(u),u}function qd(u,f){return f(u)}var DU=Ms(function(u){var f=u.length,w=f?u[0]:0,R=this.__wrapped__,j=function(re){return Nb(re,u)};return f>1||this.__actions__.length||!(R instanceof kt)||!Bs(w)?this.thru(j):(R=R.slice(w,+w+(f?1:0)),R.__actions__.push({func:qd,args:[j],thisArg:t}),new Ri(R,this.__chain__).thru(function(re){return f&&!re.length&&re.push(t),re}))});function $U(){return Nx(this)}function MU(){return new Ri(this.value(),this.__chain__)}function BU(){this.__values__===t&&(this.__values__=Gx(this.value()));var u=this.__index__>=this.__values__.length,f=u?t:this.__values__[this.__index__++];return{done:u,value:f}}function UU(){return this}function FU(u){for(var f,w=this;w instanceof Td;){var R=Tx(w);R.__index__=0,R.__values__=t,f?j.__wrapped__=R:f=R;var j=R;w=w.__wrapped__}return j.__wrapped__=u,f}function jU(){var u=this.__wrapped__;if(u instanceof kt){var f=u;return this.__actions__.length&&(f=new kt(this)),f=f.reverse(),f.__actions__.push({func:qd,args:[l0],thisArg:t}),new Ri(f,this.__chain__)}return this.thru(l0)}function qU(){return Y2(this.__wrapped__,this.__actions__)}var HU=Nd(function(u,f,w){Qt.call(u,w)?++u[w]:Ds(u,w,1)});function WU(u,f,w){var R=_t(u)?l2:N4;return w&&Ln(u,f,w)&&(f=t),R(u,ct(f,3))}function zU(u,f){var w=_t(u)?Ao:O2;return w(u,ct(f,3))}var KU=ox(Cx),VU=ox(kx);function GU(u,f){return rn(Hd(u,f),1)}function YU(u,f){return rn(Hd(u,f),W)}function XU(u,f,w){return w=w===t?1:Et(w),rn(Hd(u,f),w)}function Dx(u,f){var w=_t(u)?ki:Co;return w(u,ct(f,3))}function $x(u,f){var w=_t(u)?gB:R2;return w(u,ct(f,3))}var ZU=Nd(function(u,f,w){Qt.call(u,w)?u[w].push(f):Ds(u,w,[f])});function QU(u,f,w,R){u=zn(u)?u:yc(u),w=w&&!R?Et(w):0;var j=u.length;return w<0&&(w=Wr(j+w,0)),Gd(u)?w<=j&&u.indexOf(f,w)>-1:!!j&&sc(u,f,w)>-1}var JU=xt(function(u,f,w){var R=-1,j=typeof f=="function",re=zn(u)?ke(u.length):[];return Co(u,function(he){re[++R]=j?si(f,he,w):ah(he,f,w)}),re}),e8=Nd(function(u,f,w){Ds(u,w,f)});function Hd(u,f){var w=_t(u)?gr:B2;return w(u,ct(f,3))}function t8(u,f,w,R){return u==null?[]:(_t(f)||(f=f==null?[]:[f]),w=R?t:w,_t(w)||(w=w==null?[]:[w]),q2(u,f,w))}var r8=Nd(function(u,f,w){u[w?0:1].push(f)},function(){return[[],[]]});function n8(u,f,w){var R=_t(u)?_b:f2,j=arguments.length<3;return R(u,ct(f,4),w,j,Co)}function i8(u,f,w){var R=_t(u)?mB:f2,j=arguments.length<3;return R(u,ct(f,4),w,j,R2)}function s8(u,f){var w=_t(u)?Ao:O2;return w(u,Kd(ct(f,3)))}function o8(u){var f=_t(u)?T2:Q4;return f(u)}function a8(u,f,w){(w?Ln(u,f,w):f===t)?f=1:f=Et(f);var R=_t(u)?k4:J4;return R(u,f)}function l8(u){var f=_t(u)?P4:t5;return f(u)}function c8(u){if(u==null)return 0;if(zn(u))return Gd(u)?ac(u):u.length;var f=bn(u);return f==be||f==ye?u.size:Fb(u).length}function u8(u,f,w){var R=_t(u)?Eb:r5;return w&&Ln(u,f,w)&&(f=t),R(u,ct(f,3))}var h8=xt(function(u,f){if(u==null)return[];var w=f.length;return w>1&&Ln(u,f[0],f[1])?f=[]:w>2&&Ln(f[0],f[1],f[2])&&(f=[f[0]]),q2(u,rn(f,1),[])}),Wd=zB||function(){return tn.Date.now()};function f8(u,f){if(typeof f!="function")throw new Pi(o);return u=Et(u),function(){if(--u<1)return f.apply(this,arguments)}}function Mx(u,f,w){return f=w?t:f,f=u&&f==null?u.length:f,$s(u,U,t,t,t,t,f)}function Bx(u,f){var w;if(typeof f!="function")throw new Pi(o);return u=Et(u),function(){return--u>0&&(w=f.apply(this,arguments)),u<=1&&(f=t),w}}var u0=xt(function(u,f,w){var R=y;if(w.length){var j=Io(w,gc(u0));R|=x}return $s(u,R,f,w,j)}),Ux=xt(function(u,f,w){var R=y|S;if(w.length){var j=Io(w,gc(Ux));R|=x}return $s(f,R,u,w,j)});function Fx(u,f,w){f=w?t:f;var R=$s(u,_,t,t,t,t,t,f);return R.placeholder=Fx.placeholder,R}function jx(u,f,w){f=w?t:f;var R=$s(u,I,t,t,t,t,t,f);return R.placeholder=jx.placeholder,R}function qx(u,f,w){var R,j,re,he,ve,xe,Me=0,Be=!1,je=!1,Ge=!0;if(typeof u!="function")throw new Pi(o);f=Di(f)||0,Sr(w)&&(Be=!!w.leading,je="maxWait"in w,re=je?Wr(Di(w.maxWait)||0,f):re,Ge="trailing"in w?!!w.trailing:Ge);function tt(Dr){var Vi=R,js=j;return R=j=t,Me=Dr,he=u.apply(js,Vi),he}function ut(Dr){return Me=Dr,ve=fh(Tt,f),Be?tt(Dr):he}function At(Dr){var Vi=Dr-xe,js=Dr-Me,aI=f-Vi;return je?yn(aI,re-js):aI}function ht(Dr){var Vi=Dr-xe,js=Dr-Me;return xe===t||Vi>=f||Vi<0||je&&js>=re}function Tt(){var Dr=Wd();if(ht(Dr))return Lt(Dr);ve=fh(Tt,At(Dr))}function Lt(Dr){return ve=t,Ge&&R?tt(Dr):(R=j=t,he)}function ci(){ve!==t&&Z2(ve),Me=0,R=xe=j=ve=t}function Nn(){return ve===t?he:Lt(Wd())}function ui(){var Dr=Wd(),Vi=ht(Dr);if(R=arguments,j=this,xe=Dr,Vi){if(ve===t)return ut(xe);if(je)return Z2(ve),ve=fh(Tt,f),tt(xe)}return ve===t&&(ve=fh(Tt,f)),he}return ui.cancel=ci,ui.flush=Nn,ui}var d8=xt(function(u,f){return P2(u,1,f)}),p8=xt(function(u,f,w){return P2(u,Di(f)||0,w)});function g8(u){return $s(u,P)}function zd(u,f){if(typeof u!="function"||f!=null&&typeof f!="function")throw new Pi(o);var w=function(){var R=arguments,j=f?f.apply(this,R):R[0],re=w.cache;if(re.has(j))return re.get(j);var he=u.apply(this,R);return w.cache=re.set(j,he)||re,he};return w.cache=new(zd.Cache||Ns),w}zd.Cache=Ns;function Kd(u){if(typeof u!="function")throw new Pi(o);return function(){var f=arguments;switch(f.length){case 0:return!u.call(this);case 1:return!u.call(this,f[0]);case 2:return!u.call(this,f[0],f[1]);case 3:return!u.call(this,f[0],f[1],f[2])}return!u.apply(this,f)}}function m8(u){return Bx(2,u)}var y8=n5(function(u,f){f=f.length==1&&_t(f[0])?gr(f[0],oi(ct())):gr(rn(f,1),oi(ct()));var w=f.length;return xt(function(R){for(var j=-1,re=yn(R.length,w);++j<re;)R[j]=f[j].call(this,R[j]);return si(u,this,R)})}),h0=xt(function(u,f){var w=Io(f,gc(h0));return $s(u,x,t,f,w)}),Hx=xt(function(u,f){var w=Io(f,gc(Hx));return $s(u,$,t,f,w)}),b8=Ms(function(u,f){return $s(u,O,t,t,t,f)});function w8(u,f){if(typeof u!="function")throw new Pi(o);return f=f===t?f:Et(f),xt(u,f)}function v8(u,f){if(typeof u!="function")throw new Pi(o);return f=f==null?0:Wr(Et(f),0),xt(function(w){var R=w[f],j=Ro(w,0,f);return R&&xo(j,R),si(u,this,j)})}function _8(u,f,w){var R=!0,j=!0;if(typeof u!="function")throw new Pi(o);return Sr(w)&&(R="leading"in w?!!w.leading:R,j="trailing"in w?!!w.trailing:j),qx(u,f,{leading:R,maxWait:f,trailing:j})}function E8(u){return Mx(u,1)}function S8(u,f){return h0(Yb(f),u)}function A8(){if(!arguments.length)return[];var u=arguments[0];return _t(u)?u:[u]}function x8(u){return Oi(u,g)}function I8(u,f){return f=typeof f=="function"?f:t,Oi(u,g,f)}function T8(u){return Oi(u,d|g)}function C8(u,f){return f=typeof f=="function"?f:t,Oi(u,d|g,f)}function k8(u,f){return f==null||k2(u,f,Yr(f))}function Ki(u,f){return u===f||u!==u&&f!==f}var P8=Bd(Mb),R8=Bd(function(u,f){return u>=f}),Ba=D2(function(){return arguments}())?D2:function(u){return kr(u)&&Qt.call(u,"callee")&&!_2.call(u,"callee")},_t=ke.isArray,O8=r2?oi(r2):F4;function zn(u){return u!=null&&Vd(u.length)&&!Us(u)}function Nr(u){return kr(u)&&zn(u)}function L8(u){return u===!0||u===!1||kr(u)&&On(u)==ne}var Oo=VB||E0,N8=n2?oi(n2):j4;function D8(u){return kr(u)&&u.nodeType===1&&!dh(u)}function $8(u){if(u==null)return!0;if(zn(u)&&(_t(u)||typeof u=="string"||typeof u.splice=="function"||Oo(u)||mc(u)||Ba(u)))return!u.length;var f=bn(u);if(f==be||f==ye)return!u.size;if(hh(u))return!Fb(u).length;for(var w in u)if(Qt.call(u,w))return!1;return!0}function M8(u,f){return lh(u,f)}function B8(u,f,w){w=typeof w=="function"?w:t;var R=w?w(u,f):t;return R===t?lh(u,f,t,w):!!R}function f0(u){if(!kr(u))return!1;var f=On(u);return f==X||f==k||typeof u.message=="string"&&typeof u.name=="string"&&!dh(u)}function U8(u){return typeof u=="number"&&S2(u)}function Us(u){if(!Sr(u))return!1;var f=On(u);return f==ee||f==me||f==oe||f==Ae}function Wx(u){return typeof u=="number"&&u==Et(u)}function Vd(u){return typeof u=="number"&&u>-1&&u%1==0&&u<=H}function Sr(u){var f=typeof u;return u!=null&&(f=="object"||f=="function")}function kr(u){return u!=null&&typeof u=="object"}var zx=i2?oi(i2):H4;function F8(u,f){return u===f||Ub(u,f,r0(f))}function j8(u,f,w){return w=typeof w=="function"?w:t,Ub(u,f,r0(f),w)}function q8(u){return Kx(u)&&u!=+u}function H8(u){if(I5(u))throw new vt(s);return $2(u)}function W8(u){return u===null}function z8(u){return u==null}function Kx(u){return typeof u=="number"||kr(u)&&On(u)==te}function dh(u){if(!kr(u)||On(u)!=ge)return!1;var f=vd(u);if(f===null)return!0;var w=Qt.call(f,"constructor")&&f.constructor;return typeof w=="function"&&w instanceof w&&md.call(w)==jB}var d0=s2?oi(s2):W4;function K8(u){return Wx(u)&&u>=-H&&u<=H}var Vx=o2?oi(o2):z4;function Gd(u){return typeof u=="string"||!_t(u)&&kr(u)&&On(u)==Re}function li(u){return typeof u=="symbol"||kr(u)&&On(u)==Fe}var mc=a2?oi(a2):K4;function V8(u){return u===t}function G8(u){return kr(u)&&bn(u)==et}function Y8(u){return kr(u)&&On(u)==A}var X8=Bd(jb),Z8=Bd(function(u,f){return u<=f});function Gx(u){if(!u)return[];if(zn(u))return Gd(u)?Wi(u):Wn(u);if(eh&&u[eh])return kB(u[eh]());var f=bn(u),w=f==be?Cb:f==ye?dd:yc;return w(u)}function Fs(u){if(!u)return u===0?u:0;if(u=Di(u),u===W||u===-W){var f=u<0?-1:1;return f*G}return u===u?u:0}function Et(u){var f=Fs(u),w=f%1;return f===f?w?f-w:f:0}function Yx(u){return u?Na(Et(u),0,Z):0}function Di(u){if(typeof u=="number")return u;if(li(u))return z;if(Sr(u)){var f=typeof u.valueOf=="function"?u.valueOf():u;u=Sr(f)?f+"":f}if(typeof u!="string")return u===0?u:+u;u=d2(u);var w=Hn.test(u);return w||mn.test(u)?fB(u.slice(2),w?2:8):Rn.test(u)?z:+u}function Xx(u){return us(u,Kn(u))}function Q8(u){return u?Na(Et(u),-H,H):u===0?u:0}function Yt(u){return u==null?"":ai(u)}var J8=dc(function(u,f){if(hh(f)||zn(f)){us(f,Yr(f),u);return}for(var w in f)Qt.call(f,w)&&sh(u,w,f[w])}),Zx=dc(function(u,f){us(f,Kn(f),u)}),Yd=dc(function(u,f,w,R){us(f,Kn(f),u,R)}),eF=dc(function(u,f,w,R){us(f,Yr(f),u,R)}),tF=Ms(Nb);function rF(u,f){var w=fc(u);return f==null?w:C2(w,f)}var nF=xt(function(u,f){u=ir(u);var w=-1,R=f.length,j=R>2?f[2]:t;for(j&&Ln(f[0],f[1],j)&&(R=1);++w<R;)for(var re=f[w],he=Kn(re),ve=-1,xe=he.length;++ve<xe;){var Me=he[ve],Be=u[Me];(Be===t||Ki(Be,cc[Me])&&!Qt.call(u,Me))&&(u[Me]=re[Me])}return u}),iF=xt(function(u){return u.push(t,dx),si(Qx,t,u)});function sF(u,f){return c2(u,ct(f,3),cs)}function oF(u,f){return c2(u,ct(f,3),$b)}function aF(u,f){return u==null?u:Db(u,ct(f,3),Kn)}function lF(u,f){return u==null?u:L2(u,ct(f,3),Kn)}function cF(u,f){return u&&cs(u,ct(f,3))}function uF(u,f){return u&&$b(u,ct(f,3))}function hF(u){return u==null?[]:Pd(u,Yr(u))}function fF(u){return u==null?[]:Pd(u,Kn(u))}function p0(u,f,w){var R=u==null?t:Da(u,f);return R===t?w:R}function dF(u,f){return u!=null&&mx(u,f,$4)}function g0(u,f){return u!=null&&mx(u,f,M4)}var pF=lx(function(u,f,w){f!=null&&typeof f.toString!="function"&&(f=yd.call(f)),u[f]=w},y0(Vn)),gF=lx(function(u,f,w){f!=null&&typeof f.toString!="function"&&(f=yd.call(f)),Qt.call(u,f)?u[f].push(w):u[f]=[w]},ct),mF=xt(ah);function Yr(u){return zn(u)?I2(u):Fb(u)}function Kn(u){return zn(u)?I2(u,!0):V4(u)}function yF(u,f){var w={};return f=ct(f,3),cs(u,function(R,j,re){Ds(w,f(R,j,re),R)}),w}function bF(u,f){var w={};return f=ct(f,3),cs(u,function(R,j,re){Ds(w,j,f(R,j,re))}),w}var wF=dc(function(u,f,w){Rd(u,f,w)}),Qx=dc(function(u,f,w,R){Rd(u,f,w,R)}),vF=Ms(function(u,f){var w={};if(u==null)return w;var R=!1;f=gr(f,function(re){return re=Po(re,u),R||(R=re.length>1),re}),us(u,e0(u),w),R&&(w=Oi(w,d|p|g,p5));for(var j=f.length;j--;)Kb(w,f[j]);return w});function _F(u,f){return Jx(u,Kd(ct(f)))}var EF=Ms(function(u,f){return u==null?{}:Y4(u,f)});function Jx(u,f){if(u==null)return{};var w=gr(e0(u),function(R){return[R]});return f=ct(f),H2(u,w,function(R,j){return f(R,j[0])})}function SF(u,f,w){f=Po(f,u);var R=-1,j=f.length;for(j||(j=1,u=t);++R<j;){var re=u==null?t:u[hs(f[R])];re===t&&(R=j,re=w),u=Us(re)?re.call(u):re}return u}function AF(u,f,w){return u==null?u:ch(u,f,w)}function xF(u,f,w,R){return R=typeof R=="function"?R:t,u==null?u:ch(u,f,w,R)}var eI=hx(Yr),tI=hx(Kn);function IF(u,f,w){var R=_t(u),j=R||Oo(u)||mc(u);if(f=ct(f,4),w==null){var re=u&&u.constructor;j?w=R?new re:[]:Sr(u)?w=Us(re)?fc(vd(u)):{}:w={}}return(j?ki:cs)(u,function(he,ve,xe){return f(w,he,ve,xe)}),w}function TF(u,f){return u==null?!0:Kb(u,f)}function CF(u,f,w){return u==null?u:G2(u,f,Yb(w))}function kF(u,f,w,R){return R=typeof R=="function"?R:t,u==null?u:G2(u,f,Yb(w),R)}function yc(u){return u==null?[]:Tb(u,Yr(u))}function PF(u){return u==null?[]:Tb(u,Kn(u))}function RF(u,f,w){return w===t&&(w=f,f=t),w!==t&&(w=Di(w),w=w===w?w:0),f!==t&&(f=Di(f),f=f===f?f:0),Na(Di(u),f,w)}function OF(u,f,w){return f=Fs(f),w===t?(w=f,f=0):w=Fs(w),u=Di(u),B4(u,f,w)}function LF(u,f,w){if(w&&typeof w!="boolean"&&Ln(u,f,w)&&(f=w=t),w===t&&(typeof f=="boolean"?(w=f,f=t):typeof u=="boolean"&&(w=u,u=t)),u===t&&f===t?(u=0,f=1):(u=Fs(u),f===t?(f=u,u=0):f=Fs(f)),u>f){var R=u;u=f,f=R}if(w||u%1||f%1){var j=A2();return yn(u+j*(f-u+hB("1e-"+((j+"").length-1))),f)}return Hb(u,f)}var NF=pc(function(u,f,w){return f=f.toLowerCase(),u+(w?rI(f):f)});function rI(u){return m0(Yt(u).toLowerCase())}function nI(u){return u=Yt(u),u&&u.replace(ec,AB).replace(tB,"")}function DF(u,f,w){u=Yt(u),f=ai(f);var R=u.length;w=w===t?R:Na(Et(w),0,R);var j=w;return w-=f.length,w>=0&&u.slice(w,j)==f}function $F(u){return u=Yt(u),u&&St.test(u)?u.replace(Rt,xB):u}function MF(u){return u=Yt(u),u&&We.test(u)?u.replace(Ue,"\\$&"):u}var BF=pc(function(u,f,w){return u+(w?"-":"")+f.toLowerCase()}),UF=pc(function(u,f,w){return u+(w?" ":"")+f.toLowerCase()}),FF=sx("toLowerCase");function jF(u,f,w){u=Yt(u),f=Et(f);var R=f?ac(u):0;if(!f||R>=f)return u;var j=(f-R)/2;return Md(Ad(j),w)+u+Md(Sd(j),w)}function qF(u,f,w){u=Yt(u),f=Et(f);var R=f?ac(u):0;return f&&R<f?u+Md(f-R,w):u}function HF(u,f,w){u=Yt(u),f=Et(f);var R=f?ac(u):0;return f&&R<f?Md(f-R,w)+u:u}function WF(u,f,w){return w||f==null?f=0:f&&(f=+f),ZB(Yt(u).replace(Ve,""),f||0)}function zF(u,f,w){return(w?Ln(u,f,w):f===t)?f=1:f=Et(f),Wb(Yt(u),f)}function KF(){var u=arguments,f=Yt(u[0]);return u.length<3?f:f.replace(u[1],u[2])}var VF=pc(function(u,f,w){return u+(w?"_":"")+f.toLowerCase()});function GF(u,f,w){return w&&typeof w!="number"&&Ln(u,f,w)&&(f=w=t),w=w===t?Z:w>>>0,w?(u=Yt(u),u&&(typeof f=="string"||f!=null&&!d0(f))&&(f=ai(f),!f&&oc(u))?Ro(Wi(u),0,w):u.split(f,w)):[]}var YF=pc(function(u,f,w){return u+(w?" ":"")+m0(f)});function XF(u,f,w){return u=Yt(u),w=w==null?0:Na(Et(w),0,u.length),f=ai(f),u.slice(w,w+f.length)==f}function ZF(u,f,w){var R=Q.templateSettings;w&&Ln(u,f,w)&&(f=t),u=Yt(u),f=Yd({},f,R,fx);var j=Yd({},f.imports,R.imports,fx),re=Yr(j),he=Tb(j,re),ve,xe,Me=0,Be=f.interpolate||Rs,je="__p += '",Ge=kb((f.escape||Rs).source+"|"+Be.source+"|"+(Be===ar?qn:Rs).source+"|"+(f.evaluate||Rs).source+"|$","g"),tt="//# sourceURL="+(Qt.call(f,"sourceURL")?(f.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++oB+"]")+`
`;u.replace(Ge,function(ht,Tt,Lt,ci,Nn,ui){return Lt||(Lt=ci),je+=u.slice(Me,ui).replace(tc,IB),Tt&&(ve=!0,je+=`' +
__e(`+Tt+`) +
'`),Nn&&(xe=!0,je+=`';
`+Nn+`;
__p += '`),Lt&&(je+=`' +
((__t = (`+Lt+`)) == null ? '' : __t) +
'`),Me=ui+ht.length,ht}),je+=`';
`;var ut=Qt.call(f,"variable")&&f.variable;if(!ut)je=`with (obj) {
`+je+`
}
`;else if(Ti.test(ut))throw new vt(a);je=(xe?je.replace(it,""):je).replace(Gt,"$1").replace(er,"$1;"),je="function("+(ut||"obj")+`) {
`+(ut?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(ve?", __e = _.escape":"")+(xe?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+je+`return __p
}`;var At=sI(function(){return qt(re,tt+"return "+je).apply(t,he)});if(At.source=je,f0(At))throw At;return At}function QF(u){return Yt(u).toLowerCase()}function JF(u){return Yt(u).toUpperCase()}function e9(u,f,w){if(u=Yt(u),u&&(w||f===t))return d2(u);if(!u||!(f=ai(f)))return u;var R=Wi(u),j=Wi(f),re=p2(R,j),he=g2(R,j)+1;return Ro(R,re,he).join("")}function t9(u,f,w){if(u=Yt(u),u&&(w||f===t))return u.slice(0,y2(u)+1);if(!u||!(f=ai(f)))return u;var R=Wi(u),j=g2(R,Wi(f))+1;return Ro(R,0,j).join("")}function r9(u,f,w){if(u=Yt(u),u&&(w||f===t))return u.replace(Ve,"");if(!u||!(f=ai(f)))return u;var R=Wi(u),j=p2(R,Wi(f));return Ro(R,j).join("")}function n9(u,f){var w=M,R=K;if(Sr(f)){var j="separator"in f?f.separator:j;w="length"in f?Et(f.length):w,R="omission"in f?ai(f.omission):R}u=Yt(u);var re=u.length;if(oc(u)){var he=Wi(u);re=he.length}if(w>=re)return u;var ve=w-ac(R);if(ve<1)return R;var xe=he?Ro(he,0,ve).join(""):u.slice(0,ve);if(j===t)return xe+R;if(he&&(ve+=xe.length-ve),d0(j)){if(u.slice(ve).search(j)){var Me,Be=xe;for(j.global||(j=kb(j.source,Yt(Gr.exec(j))+"g")),j.lastIndex=0;Me=j.exec(Be);)var je=Me.index;xe=xe.slice(0,je===t?ve:je)}}else if(u.indexOf(ai(j),ve)!=ve){var Ge=xe.lastIndexOf(j);Ge>-1&&(xe=xe.slice(0,Ge))}return xe+R}function i9(u){return u=Yt(u),u&&nt.test(u)?u.replace(yt,LB):u}var s9=pc(function(u,f,w){return u+(w?" ":"")+f.toUpperCase()}),m0=sx("toUpperCase");function iI(u,f,w){return u=Yt(u),f=w?t:f,f===t?CB(u)?$B(u):wB(u):u.match(f)||[]}var sI=xt(function(u,f){try{return si(u,t,f)}catch(w){return f0(w)?w:new vt(w)}}),o9=Ms(function(u,f){return ki(f,function(w){w=hs(w),Ds(u,w,u0(u[w],u))}),u});function a9(u){var f=u==null?0:u.length,w=ct();return u=f?gr(u,function(R){if(typeof R[1]!="function")throw new Pi(o);return[w(R[0]),R[1]]}):[],xt(function(R){for(var j=-1;++j<f;){var re=u[j];if(si(re[0],this,R))return si(re[1],this,R)}})}function l9(u){return L4(Oi(u,d))}function y0(u){return function(){return u}}function c9(u,f){return u==null||u!==u?f:u}var u9=ax(),h9=ax(!0);function Vn(u){return u}function b0(u){return M2(typeof u=="function"?u:Oi(u,d))}function f9(u){return U2(Oi(u,d))}function d9(u,f){return F2(u,Oi(f,d))}var p9=xt(function(u,f){return function(w){return ah(w,u,f)}}),g9=xt(function(u,f){return function(w){return ah(u,w,f)}});function w0(u,f,w){var R=Yr(f),j=Pd(f,R);w==null&&!(Sr(f)&&(j.length||!R.length))&&(w=f,f=u,u=this,j=Pd(f,Yr(f)));var re=!(Sr(w)&&"chain"in w)||!!w.chain,he=Us(u);return ki(j,function(ve){var xe=f[ve];u[ve]=xe,he&&(u.prototype[ve]=function(){var Me=this.__chain__;if(re||Me){var Be=u(this.__wrapped__),je=Be.__actions__=Wn(this.__actions__);return je.push({func:xe,args:arguments,thisArg:u}),Be.__chain__=Me,Be}return xe.apply(u,xo([this.value()],arguments))})}),u}function m9(){return tn._===this&&(tn._=qB),this}function v0(){}function y9(u){return u=Et(u),xt(function(f){return j2(f,u)})}var b9=Zb(gr),w9=Zb(l2),v9=Zb(Eb);function oI(u){return i0(u)?Sb(hs(u)):X4(u)}function _9(u){return function(f){return u==null?t:Da(u,f)}}var E9=cx(),S9=cx(!0);function _0(){return[]}function E0(){return!1}function A9(){return{}}function x9(){return""}function I9(){return!0}function T9(u,f){if(u=Et(u),u<1||u>H)return[];var w=Z,R=yn(u,Z);f=ct(f),u-=Z;for(var j=Ib(R,f);++w<u;)f(w);return j}function C9(u){return _t(u)?gr(u,hs):li(u)?[u]:Wn(Ix(Yt(u)))}function k9(u){var f=++FB;return Yt(u)+f}var P9=$d(function(u,f){return u+f},0),R9=Qb("ceil"),O9=$d(function(u,f){return u/f},1),L9=Qb("floor");function N9(u){return u&&u.length?kd(u,Vn,Mb):t}function D9(u,f){return u&&u.length?kd(u,ct(f,2),Mb):t}function $9(u){return h2(u,Vn)}function M9(u,f){return h2(u,ct(f,2))}function B9(u){return u&&u.length?kd(u,Vn,jb):t}function U9(u,f){return u&&u.length?kd(u,ct(f,2),jb):t}var F9=$d(function(u,f){return u*f},1),j9=Qb("round"),q9=$d(function(u,f){return u-f},0);function H9(u){return u&&u.length?xb(u,Vn):0}function W9(u,f){return u&&u.length?xb(u,ct(f,2)):0}return Q.after=f8,Q.ary=Mx,Q.assign=J8,Q.assignIn=Zx,Q.assignInWith=Yd,Q.assignWith=eF,Q.at=tF,Q.before=Bx,Q.bind=u0,Q.bindAll=o9,Q.bindKey=Ux,Q.castArray=A8,Q.chain=Nx,Q.chunk=L5,Q.compact=N5,Q.concat=D5,Q.cond=a9,Q.conforms=l9,Q.constant=y0,Q.countBy=HU,Q.create=rF,Q.curry=Fx,Q.curryRight=jx,Q.debounce=qx,Q.defaults=nF,Q.defaultsDeep=iF,Q.defer=d8,Q.delay=p8,Q.difference=$5,Q.differenceBy=M5,Q.differenceWith=B5,Q.drop=U5,Q.dropRight=F5,Q.dropRightWhile=j5,Q.dropWhile=q5,Q.fill=H5,Q.filter=zU,Q.flatMap=GU,Q.flatMapDeep=YU,Q.flatMapDepth=XU,Q.flatten=Px,Q.flattenDeep=W5,Q.flattenDepth=z5,Q.flip=g8,Q.flow=u9,Q.flowRight=h9,Q.fromPairs=K5,Q.functions=hF,Q.functionsIn=fF,Q.groupBy=ZU,Q.initial=G5,Q.intersection=Y5,Q.intersectionBy=X5,Q.intersectionWith=Z5,Q.invert=pF,Q.invertBy=gF,Q.invokeMap=JU,Q.iteratee=b0,Q.keyBy=e8,Q.keys=Yr,Q.keysIn=Kn,Q.map=Hd,Q.mapKeys=yF,Q.mapValues=bF,Q.matches=f9,Q.matchesProperty=d9,Q.memoize=zd,Q.merge=wF,Q.mergeWith=Qx,Q.method=p9,Q.methodOf=g9,Q.mixin=w0,Q.negate=Kd,Q.nthArg=y9,Q.omit=vF,Q.omitBy=_F,Q.once=m8,Q.orderBy=t8,Q.over=b9,Q.overArgs=y8,Q.overEvery=w9,Q.overSome=v9,Q.partial=h0,Q.partialRight=Hx,Q.partition=r8,Q.pick=EF,Q.pickBy=Jx,Q.property=oI,Q.propertyOf=_9,Q.pull=tU,Q.pullAll=Ox,Q.pullAllBy=rU,Q.pullAllWith=nU,Q.pullAt=iU,Q.range=E9,Q.rangeRight=S9,Q.rearg=b8,Q.reject=s8,Q.remove=sU,Q.rest=w8,Q.reverse=l0,Q.sampleSize=a8,Q.set=AF,Q.setWith=xF,Q.shuffle=l8,Q.slice=oU,Q.sortBy=h8,Q.sortedUniq=dU,Q.sortedUniqBy=pU,Q.split=GF,Q.spread=v8,Q.tail=gU,Q.take=mU,Q.takeRight=yU,Q.takeRightWhile=bU,Q.takeWhile=wU,Q.tap=NU,Q.throttle=_8,Q.thru=qd,Q.toArray=Gx,Q.toPairs=eI,Q.toPairsIn=tI,Q.toPath=C9,Q.toPlainObject=Xx,Q.transform=IF,Q.unary=E8,Q.union=vU,Q.unionBy=_U,Q.unionWith=EU,Q.uniq=SU,Q.uniqBy=AU,Q.uniqWith=xU,Q.unset=TF,Q.unzip=c0,Q.unzipWith=Lx,Q.update=CF,Q.updateWith=kF,Q.values=yc,Q.valuesIn=PF,Q.without=IU,Q.words=iI,Q.wrap=S8,Q.xor=TU,Q.xorBy=CU,Q.xorWith=kU,Q.zip=PU,Q.zipObject=RU,Q.zipObjectDeep=OU,Q.zipWith=LU,Q.entries=eI,Q.entriesIn=tI,Q.extend=Zx,Q.extendWith=Yd,w0(Q,Q),Q.add=P9,Q.attempt=sI,Q.camelCase=NF,Q.capitalize=rI,Q.ceil=R9,Q.clamp=RF,Q.clone=x8,Q.cloneDeep=T8,Q.cloneDeepWith=C8,Q.cloneWith=I8,Q.conformsTo=k8,Q.deburr=nI,Q.defaultTo=c9,Q.divide=O9,Q.endsWith=DF,Q.eq=Ki,Q.escape=$F,Q.escapeRegExp=MF,Q.every=WU,Q.find=KU,Q.findIndex=Cx,Q.findKey=sF,Q.findLast=VU,Q.findLastIndex=kx,Q.findLastKey=oF,Q.floor=L9,Q.forEach=Dx,Q.forEachRight=$x,Q.forIn=aF,Q.forInRight=lF,Q.forOwn=cF,Q.forOwnRight=uF,Q.get=p0,Q.gt=P8,Q.gte=R8,Q.has=dF,Q.hasIn=g0,Q.head=Rx,Q.identity=Vn,Q.includes=QU,Q.indexOf=V5,Q.inRange=OF,Q.invoke=mF,Q.isArguments=Ba,Q.isArray=_t,Q.isArrayBuffer=O8,Q.isArrayLike=zn,Q.isArrayLikeObject=Nr,Q.isBoolean=L8,Q.isBuffer=Oo,Q.isDate=N8,Q.isElement=D8,Q.isEmpty=$8,Q.isEqual=M8,Q.isEqualWith=B8,Q.isError=f0,Q.isFinite=U8,Q.isFunction=Us,Q.isInteger=Wx,Q.isLength=Vd,Q.isMap=zx,Q.isMatch=F8,Q.isMatchWith=j8,Q.isNaN=q8,Q.isNative=H8,Q.isNil=z8,Q.isNull=W8,Q.isNumber=Kx,Q.isObject=Sr,Q.isObjectLike=kr,Q.isPlainObject=dh,Q.isRegExp=d0,Q.isSafeInteger=K8,Q.isSet=Vx,Q.isString=Gd,Q.isSymbol=li,Q.isTypedArray=mc,Q.isUndefined=V8,Q.isWeakMap=G8,Q.isWeakSet=Y8,Q.join=Q5,Q.kebabCase=BF,Q.last=Ni,Q.lastIndexOf=J5,Q.lowerCase=UF,Q.lowerFirst=FF,Q.lt=X8,Q.lte=Z8,Q.max=N9,Q.maxBy=D9,Q.mean=$9,Q.meanBy=M9,Q.min=B9,Q.minBy=U9,Q.stubArray=_0,Q.stubFalse=E0,Q.stubObject=A9,Q.stubString=x9,Q.stubTrue=I9,Q.multiply=F9,Q.nth=eU,Q.noConflict=m9,Q.noop=v0,Q.now=Wd,Q.pad=jF,Q.padEnd=qF,Q.padStart=HF,Q.parseInt=WF,Q.random=LF,Q.reduce=n8,Q.reduceRight=i8,Q.repeat=zF,Q.replace=KF,Q.result=SF,Q.round=j9,Q.runInContext=Se,Q.sample=o8,Q.size=c8,Q.snakeCase=VF,Q.some=u8,Q.sortedIndex=aU,Q.sortedIndexBy=lU,Q.sortedIndexOf=cU,Q.sortedLastIndex=uU,Q.sortedLastIndexBy=hU,Q.sortedLastIndexOf=fU,Q.startCase=YF,Q.startsWith=XF,Q.subtract=q9,Q.sum=H9,Q.sumBy=W9,Q.template=ZF,Q.times=T9,Q.toFinite=Fs,Q.toInteger=Et,Q.toLength=Yx,Q.toLower=QF,Q.toNumber=Di,Q.toSafeInteger=Q8,Q.toString=Yt,Q.toUpper=JF,Q.trim=e9,Q.trimEnd=t9,Q.trimStart=r9,Q.truncate=n9,Q.unescape=i9,Q.uniqueId=k9,Q.upperCase=s9,Q.upperFirst=m0,Q.each=Dx,Q.eachRight=$x,Q.first=Rx,w0(Q,function(){var u={};return cs(Q,function(f,w){Qt.call(Q.prototype,w)||(u[w]=f)}),u}(),{chain:!1}),Q.VERSION=r,ki(["bind","bindKey","curry","curryRight","partial","partialRight"],function(u){Q[u].placeholder=Q}),ki(["drop","take"],function(u,f){kt.prototype[u]=function(w){w=w===t?1:Wr(Et(w),0);var R=this.__filtered__&&!f?new kt(this):this.clone();return R.__filtered__?R.__takeCount__=yn(w,R.__takeCount__):R.__views__.push({size:yn(w,Z),type:u+(R.__dir__<0?"Right":"")}),R},kt.prototype[u+"Right"]=function(w){return this.reverse()[u](w).reverse()}}),ki(["filter","map","takeWhile"],function(u,f){var w=f+1,R=w==N||w==V;kt.prototype[u]=function(j){var re=this.clone();return re.__iteratees__.push({iteratee:ct(j,3),type:w}),re.__filtered__=re.__filtered__||R,re}}),ki(["head","last"],function(u,f){var w="take"+(f?"Right":"");kt.prototype[u]=function(){return this[w](1).value()[0]}}),ki(["initial","tail"],function(u,f){var w="drop"+(f?"":"Right");kt.prototype[u]=function(){return this.__filtered__?new kt(this):this[w](1)}}),kt.prototype.compact=function(){return this.filter(Vn)},kt.prototype.find=function(u){return this.filter(u).head()},kt.prototype.findLast=function(u){return this.reverse().find(u)},kt.prototype.invokeMap=xt(function(u,f){return typeof u=="function"?new kt(this):this.map(function(w){return ah(w,u,f)})}),kt.prototype.reject=function(u){return this.filter(Kd(ct(u)))},kt.prototype.slice=function(u,f){u=Et(u);var w=this;return w.__filtered__&&(u>0||f<0)?new kt(w):(u<0?w=w.takeRight(-u):u&&(w=w.drop(u)),f!==t&&(f=Et(f),w=f<0?w.dropRight(-f):w.take(f-u)),w)},kt.prototype.takeRightWhile=function(u){return this.reverse().takeWhile(u).reverse()},kt.prototype.toArray=function(){return this.take(Z)},cs(kt.prototype,function(u,f){var w=/^(?:filter|find|map|reject)|While$/.test(f),R=/^(?:head|last)$/.test(f),j=Q[R?"take"+(f=="last"?"Right":""):f],re=R||/^find/.test(f);j&&(Q.prototype[f]=function(){var he=this.__wrapped__,ve=R?[1]:arguments,xe=he instanceof kt,Me=ve[0],Be=xe||_t(he),je=function(Tt){var Lt=j.apply(Q,xo([Tt],ve));return R&&Ge?Lt[0]:Lt};Be&&w&&typeof Me=="function"&&Me.length!=1&&(xe=Be=!1);var Ge=this.__chain__,tt=!!this.__actions__.length,ut=re&&!Ge,At=xe&&!tt;if(!re&&Be){he=At?he:new kt(this);var ht=u.apply(he,ve);return ht.__actions__.push({func:qd,args:[je],thisArg:t}),new Ri(ht,Ge)}return ut&&At?u.apply(this,ve):(ht=this.thru(je),ut?R?ht.value()[0]:ht.value():ht)})}),ki(["pop","push","shift","sort","splice","unshift"],function(u){var f=pd[u],w=/^(?:push|sort|unshift)$/.test(u)?"tap":"thru",R=/^(?:pop|shift)$/.test(u);Q.prototype[u]=function(){var j=arguments;if(R&&!this.__chain__){var re=this.value();return f.apply(_t(re)?re:[],j)}return this[w](function(he){return f.apply(_t(he)?he:[],j)})}}),cs(kt.prototype,function(u,f){var w=Q[f];if(w){var R=w.name+"";Qt.call(hc,R)||(hc[R]=[]),hc[R].push({name:f,func:w})}}),hc[Dd(t,S).name]=[{name:"wrapper",func:t}],kt.prototype.clone=i4,kt.prototype.reverse=s4,kt.prototype.value=o4,Q.prototype.at=DU,Q.prototype.chain=$U,Q.prototype.commit=MU,Q.prototype.next=BU,Q.prototype.plant=FU,Q.prototype.reverse=jU,Q.prototype.toJSON=Q.prototype.valueOf=Q.prototype.value=qU,Q.prototype.first=Q.prototype.head,eh&&(Q.prototype[eh]=UU),Q},lc=MB();Pa?((Pa.exports=lc)._=lc,bb._=lc):tn._=lc}).call(Ui)})(cy,cy.exports);cy.exports;new Ct("sds:message");new Ct("sds:message-channel");new Ct("sdk:query-on-connect");var UP;(function(n){n.MessagesRetrieved="messages:retrieved"})(UP||(UP={}));new Ct("sdk:missing-message-retriever");new Ct("sdk:reliable-channel");hr.ENCODE_FAILED,hr.EMPTY_PAYLOAD,hr.SIZE_TOO_BIG,hr.RLN_PROOF_GENERATION;const kM=n=>`/${pu}-${n}/0/msg/json`,FP=(n,e,t)=>n.lightPush.send(n.createEncoder({contentTopic:kM(e),ephemeral:!0}),{payload:Sl(t)},{autoRetry:!0}),Qoe=Ey({init:()=>Eoe({defaultBootstrap:!0,discovery:{dns:!0,peerExchange:!0,peerCache:!0}}).then(async n=>(await n.start(),await n.waitForPeers(),n)),subscribe:async(n,e,t,r)=>{const i=o=>a=>{a.payload&&r(o,jh(a.payload),(l,c)=>FP(n,l,c))},s=await oa([e,t].map(o=>{const a=n.createDecoder({contentTopic:kM(o)});return n.filter.subscribe(a,i(o)),()=>n.filter.unsubscribe(a)}));return()=>s.forEach(o=>o())},announce:(n,e)=>FP(n,e,Ll({peerId:bi}))});var vE=function(n,e){return vE=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])},vE(n,e)};function PM(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");vE(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var uy=function(){return uy=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++){t=arguments[r];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e},uy.apply(this,arguments)};function Xu(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(t[r[i]]=n[r[i]]);return t}function RM(n,e,t,r){var i=arguments.length,s=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,r);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(s=(i<3?o(s):i>3?o(e,t,s):o(e,t))||s);return i>3&&s&&Object.defineProperty(e,t,s),s}function OM(n,e){return function(t,r){e(t,r,n)}}function LM(n,e,t,r,i,s){function o(S){if(S!==void 0&&typeof S!="function")throw new TypeError("Function expected");return S}for(var a=r.kind,l=a==="getter"?"get":a==="setter"?"set":"value",c=!e&&n?r.static?n:n.prototype:null,h=e||(c?Object.getOwnPropertyDescriptor(c,r.name):{}),d,p=!1,g=t.length-1;g>=0;g--){var m={};for(var E in r)m[E]=E==="access"?{}:r[E];for(var E in r.access)m.access[E]=r.access[E];m.addInitializer=function(S){if(p)throw new TypeError("Cannot add initializers after decoration has completed");s.push(o(S||null))};var y=(0,t[g])(a==="accessor"?{get:h.get,set:h.set}:h[l],m);if(a==="accessor"){if(y===void 0)continue;if(y===null||typeof y!="object")throw new TypeError("Object expected");(d=o(y.get))&&(h.get=d),(d=o(y.set))&&(h.set=d),(d=o(y.init))&&i.unshift(d)}else(d=o(y))&&(a==="field"?i.unshift(d):h[l]=d)}c&&Object.defineProperty(c,r.name,h),p=!0}function NM(n,e,t){for(var r=arguments.length>2,i=0;i<e.length;i++)t=r?e[i].call(n,t):e[i].call(n);return r?t:void 0}function DM(n){return typeof n=="symbol"?n:"".concat(n)}function $M(n,e,t){return typeof e=="symbol"&&(e=e.description?"[".concat(e.description,"]"):""),Object.defineProperty(n,"name",{configurable:!0,value:t?"".concat(t," ",e):e})}function MM(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)}function rt(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(h){try{c(r.next(h))}catch(d){o(d)}}function l(h){try{c(r.throw(h))}catch(d){o(d)}}function c(h){h.done?s(h.value):i(h.value).then(a,l)}c((r=r.apply(n,e||[])).next())})}function BM(n,e){var t={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,o=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return o.next=a(0),o.throw=a(1),o.return=a(2),typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(c){return function(h){return l([c,h])}}function l(c){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,c[0]&&(t=0)),t;)try{if(r=1,i&&(s=c[0]&2?i.return:c[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,c[1])).done)return s;switch(i=0,s&&(c=[c[0]&2,s.value]),c[0]){case 0:case 1:s=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,i=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(s=t.trys,!(s=s.length>0&&s[s.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!s||c[1]>s[0]&&c[1]<s[3])){t.label=c[1];break}if(c[0]===6&&t.label<s[1]){t.label=s[1],s=c;break}if(s&&t.label<s[2]){t.label=s[2],t.ops.push(c);break}s[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(n,t)}catch(h){c=[6,h],i=0}finally{r=s=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}var hb=Object.create?function(n,e,t,r){r===void 0&&(r=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,r,i)}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]};function UM(n,e){for(var t in n)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&hb(e,n,t)}function hy(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function TA(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(o)throw o.error}}return s}function FM(){for(var n=[],e=0;e<arguments.length;e++)n=n.concat(TA(arguments[e]));return n}function jM(){for(var n=0,e=0,t=arguments.length;e<t;e++)n+=arguments[e].length;for(var r=Array(n),i=0,e=0;e<t;e++)for(var s=arguments[e],o=0,a=s.length;o<a;o++,i++)r[i]=s[o];return r}function qM(n,e,t){if(t||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return n.concat(s||Array.prototype.slice.call(e))}function Fu(n){return this instanceof Fu?(this.v=n,this):new Fu(n)}function HM(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=t.apply(n,e||[]),i,s=[];return i=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",o),i[Symbol.asyncIterator]=function(){return this},i;function o(g){return function(m){return Promise.resolve(m).then(g,d)}}function a(g,m){r[g]&&(i[g]=function(E){return new Promise(function(y,S){s.push([g,E,y,S])>1||l(g,E)})},m&&(i[g]=m(i[g])))}function l(g,m){try{c(r[g](m))}catch(E){p(s[0][3],E)}}function c(g){g.value instanceof Fu?Promise.resolve(g.value.v).then(h,d):p(s[0][2],g)}function h(g){l("next",g)}function d(g){l("throw",g)}function p(g,m){g(m),s.shift(),s.length&&l(s[0][0],s[0][1])}}function WM(n){var e,t;return e={},r("next"),r("throw",function(i){throw i}),r("return"),e[Symbol.iterator]=function(){return this},e;function r(i,s){e[i]=n[i]?function(o){return(t=!t)?{value:Fu(n[i](o)),done:!1}:s?s(o):o}:s}}function zM(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],t;return e?e.call(n):(n=typeof hy=="function"?hy(n):n[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(s){t[s]=n[s]&&function(o){return new Promise(function(a,l){o=n[s](o),i(a,l,o.done,o.value)})}}function i(s,o,a,l){Promise.resolve(l).then(function(c){s({value:c,done:a})},o)}}function KM(n,e){return Object.defineProperty?Object.defineProperty(n,"raw",{value:e}):n.raw=e,n}var Joe=Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e},_E=function(n){return _E=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},_E(n)};function VM(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t=_E(n),r=0;r<t.length;r++)t[r]!=="default"&&hb(e,n,t[r]);return Joe(e,n),e}function GM(n){return n&&n.__esModule?n:{default:n}}function YM(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)}function XM(n,e,t,r,i){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!i:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?i.call(n,t):i?i.value=t:e.set(n,t),t}function ZM(n,e){if(e===null||typeof e!="object"&&typeof e!="function")throw new TypeError("Cannot use 'in' operator on non-object");return typeof n=="function"?e===n:n.has(e)}function QM(n,e,t){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var r,i;if(t){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=e[Symbol.asyncDispose]}if(r===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=e[Symbol.dispose],t&&(i=r)}if(typeof r!="function")throw new TypeError("Object not disposable.");i&&(r=function(){try{i.call(this)}catch(s){return Promise.reject(s)}}),n.stack.push({value:e,dispose:r,async:t})}else t&&n.stack.push({async:!0});return e}var eae=typeof SuppressedError=="function"?SuppressedError:function(n,e,t){var r=new Error(t);return r.name="SuppressedError",r.error=n,r.suppressed=e,r};function JM(n){function e(s){n.error=n.hasError?new eae(s,n.error,"An error was suppressed during disposal."):s,n.hasError=!0}var t,r=0;function i(){for(;t=n.stack.pop();)try{if(!t.async&&r===1)return r=0,n.stack.push(t),Promise.resolve().then(i);if(t.dispose){var s=t.dispose.call(t.value);if(t.async)return r|=2,Promise.resolve(s).then(i,function(o){return e(o),i()})}else r|=1}catch(o){e(o)}if(r===1)return n.hasError?Promise.reject(n.error):Promise.resolve();if(n.hasError)throw n.error}return i()}function e6(n,e){return typeof n=="string"&&/^\.\.?\//.test(n)?n.replace(/\.(tsx)$|((?:\.d)?)((?:\.[^./]+?)?)\.([cm]?)ts$/i,function(t,r,i,s,o){return r?e?".jsx":".js":i&&(!s||!o)?t:i+s+"."+o.toLowerCase()+"js"}):n}const tae={__extends:PM,__assign:uy,__rest:Xu,__decorate:RM,__param:OM,__esDecorate:LM,__runInitializers:NM,__propKey:DM,__setFunctionName:$M,__metadata:MM,__awaiter:rt,__generator:BM,__createBinding:hb,__exportStar:UM,__values:hy,__read:TA,__spread:FM,__spreadArrays:jM,__spreadArray:qM,__await:Fu,__asyncGenerator:HM,__asyncDelegator:WM,__asyncValues:zM,__makeTemplateObject:KM,__importStar:VM,__importDefault:GM,__classPrivateFieldGet:YM,__classPrivateFieldSet:XM,__classPrivateFieldIn:ZM,__addDisposableResource:QM,__disposeResources:JM,__rewriteRelativeImportExtension:e6},rae=Object.freeze(Object.defineProperty({__proto__:null,__addDisposableResource:QM,get __assign(){return uy},__asyncDelegator:WM,__asyncGenerator:HM,__asyncValues:zM,__await:Fu,__awaiter:rt,__classPrivateFieldGet:YM,__classPrivateFieldIn:ZM,__classPrivateFieldSet:XM,__createBinding:hb,__decorate:RM,__disposeResources:JM,__esDecorate:LM,__exportStar:UM,__extends:PM,__generator:BM,__importDefault:GM,__importStar:VM,__makeTemplateObject:KM,__metadata:MM,__param:OM,__propKey:DM,__read:TA,__rest:Xu,__rewriteRelativeImportExtension:e6,__runInitializers:NM,__setFunctionName:$M,__spread:FM,__spreadArray:qM,__spreadArrays:jM,__values:hy,default:tae},Symbol.toStringTag,{value:"Module"})),nae=n=>n?(...e)=>n(...e):(...e)=>fetch(...e);class CA extends Error{constructor(e,t="FunctionsError",r){super(e),this.name=t,this.context=r}}class iae extends CA{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class jP extends CA{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class qP extends CA{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var EE;(function(n){n.Any="any",n.ApNortheast1="ap-northeast-1",n.ApNortheast2="ap-northeast-2",n.ApSouth1="ap-south-1",n.ApSoutheast1="ap-southeast-1",n.ApSoutheast2="ap-southeast-2",n.CaCentral1="ca-central-1",n.EuCentral1="eu-central-1",n.EuWest1="eu-west-1",n.EuWest2="eu-west-2",n.EuWest3="eu-west-3",n.SaEast1="sa-east-1",n.UsEast1="us-east-1",n.UsWest1="us-west-1",n.UsWest2="us-west-2"})(EE||(EE={}));class sae{constructor(e,{headers:t={},customFetch:r,region:i=EE.Any}={}){this.url=e,this.headers=t,this.region=i,this.fetch=nae(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e){return rt(this,arguments,void 0,function*(t,r={}){var i;let s,o;try{const{headers:a,method:l,body:c,signal:h,timeout:d}=r;let p={},{region:g}=r;g||(g=this.region);const m=new URL(`${this.url}/${t}`);g&&g!=="any"&&(p["x-region"]=g,m.searchParams.set("forceFunctionRegion",g));let E;c&&(a&&!Object.prototype.hasOwnProperty.call(a,"Content-Type")||!a)?typeof Blob<"u"&&c instanceof Blob||c instanceof ArrayBuffer?(p["Content-Type"]="application/octet-stream",E=c):typeof c=="string"?(p["Content-Type"]="text/plain",E=c):typeof FormData<"u"&&c instanceof FormData?E=c:(p["Content-Type"]="application/json",E=JSON.stringify(c)):E=c;let y=h;d&&(o=new AbortController,s=setTimeout(()=>o.abort(),d),h?(y=o.signal,h.addEventListener("abort",()=>o.abort())):y=o.signal);const S=yield this.fetch(m.toString(),{method:l||"POST",headers:Object.assign(Object.assign(Object.assign({},p),this.headers),a),body:E,signal:y}).catch(x=>{throw new iae(x)}),b=S.headers.get("x-relay-error");if(b&&b==="true")throw new jP(S);if(!S.ok)throw new qP(S);let _=((i=S.headers.get("Content-Type"))!==null&&i!==void 0?i:"text/plain").split(";")[0].trim(),I;return _==="application/json"?I=yield S.json():_==="application/octet-stream"||_==="application/pdf"?I=yield S.blob():_==="text/event-stream"?I=S:_==="multipart/form-data"?I=yield S.formData():I=yield S.text(),{data:I,error:null,response:S}}catch(a){return{data:null,error:a,response:a instanceof qP||a instanceof jP?a.context:void 0}}finally{s&&clearTimeout(s)}})}}var Mn={};const Zu=Lz(rae);var $p={},Mp={},Bp={},Up={},Fp={},jp={},HP;function t6(){if(HP)return jp;HP=1,Object.defineProperty(jp,"__esModule",{value:!0});class n extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}}return jp.default=n,jp}var WP;function r6(){if(WP)return Fp;WP=1,Object.defineProperty(Fp,"__esModule",{value:!0});const e=Zu.__importDefault(t6());class t{constructor(i){var s,o;this.shouldThrowOnError=!1,this.method=i.method,this.url=i.url,this.headers=new Headers(i.headers),this.schema=i.schema,this.body=i.body,this.shouldThrowOnError=(s=i.shouldThrowOnError)!==null&&s!==void 0?s:!1,this.signal=i.signal,this.isMaybeSingle=(o=i.isMaybeSingle)!==null&&o!==void 0?o:!1,i.fetch?this.fetch=i.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(i,s){return this.headers=new Headers(this.headers),this.headers.set(i,s),this}then(i,s){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const o=this.fetch;let a=o(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async l=>{var c,h,d,p;let g=null,m=null,E=null,y=l.status,S=l.statusText;if(l.ok){if(this.method!=="HEAD"){const x=await l.text();x===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((c=this.headers.get("Accept"))===null||c===void 0)&&c.includes("application/vnd.pgrst.plan+text"))?m=x:m=JSON.parse(x))}const _=(h=this.headers.get("Prefer"))===null||h===void 0?void 0:h.match(/count=(exact|planned|estimated)/),I=(d=l.headers.get("content-range"))===null||d===void 0?void 0:d.split("/");_&&I&&I.length>1&&(E=parseInt(I[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(m)&&(m.length>1?(g={code:"PGRST116",details:`Results contain ${m.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},m=null,E=null,y=406,S="Not Acceptable"):m.length===1?m=m[0]:m=null)}else{const _=await l.text();try{g=JSON.parse(_),Array.isArray(g)&&l.status===404&&(m=[],g=null,y=200,S="OK")}catch{l.status===404&&_===""?(y=204,S="No Content"):g={message:_}}if(g&&this.isMaybeSingle&&(!((p=g==null?void 0:g.details)===null||p===void 0)&&p.includes("0 rows"))&&(g=null,y=200,S="OK"),g&&this.shouldThrowOnError)throw new e.default(g)}return{error:g,data:m,count:E,status:y,statusText:S}});return this.shouldThrowOnError||(a=a.catch(l=>{var c,h,d;return{error:{message:`${(c=l==null?void 0:l.name)!==null&&c!==void 0?c:"FetchError"}: ${l==null?void 0:l.message}`,details:`${(h=l==null?void 0:l.stack)!==null&&h!==void 0?h:""}`,hint:"",code:`${(d=l==null?void 0:l.code)!==null&&d!==void 0?d:""}`},data:null,count:null,status:0,statusText:""}})),a.then(i,s)}returns(){return this}overrideTypes(){return this}}return Fp.default=t,Fp}var zP;function n6(){if(zP)return Up;zP=1,Object.defineProperty(Up,"__esModule",{value:!0});const e=Zu.__importDefault(r6());class t extends e.default{select(i){let s=!1;const o=(i??"*").split("").map(a=>/\s/.test(a)&&!s?"":(a==='"'&&(s=!s),a)).join("");return this.url.searchParams.set("select",o),this.headers.append("Prefer","return=representation"),this}order(i,{ascending:s=!0,nullsFirst:o,foreignTable:a,referencedTable:l=a}={}){const c=l?`${l}.order`:"order",h=this.url.searchParams.get(c);return this.url.searchParams.set(c,`${h?`${h},`:""}${i}.${s?"asc":"desc"}${o===void 0?"":o?".nullsfirst":".nullslast"}`),this}limit(i,{foreignTable:s,referencedTable:o=s}={}){const a=typeof o>"u"?"limit":`${o}.limit`;return this.url.searchParams.set(a,`${i}`),this}range(i,s,{foreignTable:o,referencedTable:a=o}={}){const l=typeof a>"u"?"offset":`${a}.offset`,c=typeof a>"u"?"limit":`${a}.limit`;return this.url.searchParams.set(l,`${i}`),this.url.searchParams.set(c,`${s-i+1}`),this}abortSignal(i){return this.signal=i,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:i=!1,verbose:s=!1,settings:o=!1,buffers:a=!1,wal:l=!1,format:c="text"}={}){var h;const d=[i?"analyze":null,s?"verbose":null,o?"settings":null,a?"buffers":null,l?"wal":null].filter(Boolean).join("|"),p=(h=this.headers.get("Accept"))!==null&&h!==void 0?h:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${c}; for="${p}"; options=${d};`),c==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(i){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${i}`),this}}return Up.default=t,Up}var KP;function kA(){if(KP)return Bp;KP=1,Object.defineProperty(Bp,"__esModule",{value:!0});const e=Zu.__importDefault(n6()),t=new RegExp("[,()]");class r extends e.default{eq(s,o){return this.url.searchParams.append(s,`eq.${o}`),this}neq(s,o){return this.url.searchParams.append(s,`neq.${o}`),this}gt(s,o){return this.url.searchParams.append(s,`gt.${o}`),this}gte(s,o){return this.url.searchParams.append(s,`gte.${o}`),this}lt(s,o){return this.url.searchParams.append(s,`lt.${o}`),this}lte(s,o){return this.url.searchParams.append(s,`lte.${o}`),this}like(s,o){return this.url.searchParams.append(s,`like.${o}`),this}likeAllOf(s,o){return this.url.searchParams.append(s,`like(all).{${o.join(",")}}`),this}likeAnyOf(s,o){return this.url.searchParams.append(s,`like(any).{${o.join(",")}}`),this}ilike(s,o){return this.url.searchParams.append(s,`ilike.${o}`),this}ilikeAllOf(s,o){return this.url.searchParams.append(s,`ilike(all).{${o.join(",")}}`),this}ilikeAnyOf(s,o){return this.url.searchParams.append(s,`ilike(any).{${o.join(",")}}`),this}is(s,o){return this.url.searchParams.append(s,`is.${o}`),this}in(s,o){const a=Array.from(new Set(o)).map(l=>typeof l=="string"&&t.test(l)?`"${l}"`:`${l}`).join(",");return this.url.searchParams.append(s,`in.(${a})`),this}contains(s,o){return typeof o=="string"?this.url.searchParams.append(s,`cs.${o}`):Array.isArray(o)?this.url.searchParams.append(s,`cs.{${o.join(",")}}`):this.url.searchParams.append(s,`cs.${JSON.stringify(o)}`),this}containedBy(s,o){return typeof o=="string"?this.url.searchParams.append(s,`cd.${o}`):Array.isArray(o)?this.url.searchParams.append(s,`cd.{${o.join(",")}}`):this.url.searchParams.append(s,`cd.${JSON.stringify(o)}`),this}rangeGt(s,o){return this.url.searchParams.append(s,`sr.${o}`),this}rangeGte(s,o){return this.url.searchParams.append(s,`nxl.${o}`),this}rangeLt(s,o){return this.url.searchParams.append(s,`sl.${o}`),this}rangeLte(s,o){return this.url.searchParams.append(s,`nxr.${o}`),this}rangeAdjacent(s,o){return this.url.searchParams.append(s,`adj.${o}`),this}overlaps(s,o){return typeof o=="string"?this.url.searchParams.append(s,`ov.${o}`):this.url.searchParams.append(s,`ov.{${o.join(",")}}`),this}textSearch(s,o,{config:a,type:l}={}){let c="";l==="plain"?c="pl":l==="phrase"?c="ph":l==="websearch"&&(c="w");const h=a===void 0?"":`(${a})`;return this.url.searchParams.append(s,`${c}fts${h}.${o}`),this}match(s){return Object.entries(s).forEach(([o,a])=>{this.url.searchParams.append(o,`eq.${a}`)}),this}not(s,o,a){return this.url.searchParams.append(s,`not.${o}.${a}`),this}or(s,{foreignTable:o,referencedTable:a=o}={}){const l=a?`${a}.or`:"or";return this.url.searchParams.append(l,`(${s})`),this}filter(s,o,a){return this.url.searchParams.append(s,`${o}.${a}`),this}}return Bp.default=r,Bp}var VP;function i6(){if(VP)return Mp;VP=1,Object.defineProperty(Mp,"__esModule",{value:!0});const e=Zu.__importDefault(kA());class t{constructor(i,{headers:s={},schema:o,fetch:a}){this.url=i,this.headers=new Headers(s),this.schema=o,this.fetch=a}select(i,s){const{head:o=!1,count:a}=s??{},l=o?"HEAD":"GET";let c=!1;const h=(i??"*").split("").map(d=>/\s/.test(d)&&!c?"":(d==='"'&&(c=!c),d)).join("");return this.url.searchParams.set("select",h),a&&this.headers.append("Prefer",`count=${a}`),new e.default({method:l,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(i,{count:s,defaultToNull:o=!0}={}){var a;const l="POST";if(s&&this.headers.append("Prefer",`count=${s}`),o||this.headers.append("Prefer","missing=default"),Array.isArray(i)){const c=i.reduce((h,d)=>h.concat(Object.keys(d)),[]);if(c.length>0){const h=[...new Set(c)].map(d=>`"${d}"`);this.url.searchParams.set("columns",h.join(","))}}return new e.default({method:l,url:this.url,headers:this.headers,schema:this.schema,body:i,fetch:(a=this.fetch)!==null&&a!==void 0?a:fetch})}upsert(i,{onConflict:s,ignoreDuplicates:o=!1,count:a,defaultToNull:l=!0}={}){var c;const h="POST";if(this.headers.append("Prefer",`resolution=${o?"ignore":"merge"}-duplicates`),s!==void 0&&this.url.searchParams.set("on_conflict",s),a&&this.headers.append("Prefer",`count=${a}`),l||this.headers.append("Prefer","missing=default"),Array.isArray(i)){const d=i.reduce((p,g)=>p.concat(Object.keys(g)),[]);if(d.length>0){const p=[...new Set(d)].map(g=>`"${g}"`);this.url.searchParams.set("columns",p.join(","))}}return new e.default({method:h,url:this.url,headers:this.headers,schema:this.schema,body:i,fetch:(c=this.fetch)!==null&&c!==void 0?c:fetch})}update(i,{count:s}={}){var o;const a="PATCH";return s&&this.headers.append("Prefer",`count=${s}`),new e.default({method:a,url:this.url,headers:this.headers,schema:this.schema,body:i,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch})}delete({count:i}={}){var s;const o="DELETE";return i&&this.headers.append("Prefer",`count=${i}`),new e.default({method:o,url:this.url,headers:this.headers,schema:this.schema,fetch:(s=this.fetch)!==null&&s!==void 0?s:fetch})}}return Mp.default=t,Mp}var GP;function oae(){if(GP)return $p;GP=1,Object.defineProperty($p,"__esModule",{value:!0});const n=Zu,e=n.__importDefault(i6()),t=n.__importDefault(kA());class r{constructor(s,{headers:o={},schema:a,fetch:l}={}){this.url=s,this.headers=new Headers(o),this.schemaName=a,this.fetch=l}from(s){const o=new URL(`${this.url}/${s}`);return new e.default(o,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(s){return new r(this.url,{headers:this.headers,schema:s,fetch:this.fetch})}rpc(s,o={},{head:a=!1,get:l=!1,count:c}={}){var h;let d;const p=new URL(`${this.url}/rpc/${s}`);let g;a||l?(d=a?"HEAD":"GET",Object.entries(o).filter(([E,y])=>y!==void 0).map(([E,y])=>[E,Array.isArray(y)?`{${y.join(",")}}`:`${y}`]).forEach(([E,y])=>{p.searchParams.append(E,y)})):(d="POST",g=o);const m=new Headers(this.headers);return c&&m.set("Prefer",`count=${c}`),new t.default({method:d,url:p,headers:m,schema:this.schemaName,body:g,fetch:(h=this.fetch)!==null&&h!==void 0?h:fetch})}}return $p.default=r,$p}Object.defineProperty(Mn,"__esModule",{value:!0});var s6=Mn.PostgrestError=g6=Mn.PostgrestBuilder=d6=Mn.PostgrestTransformBuilder=h6=Mn.PostgrestFilterBuilder=c6=Mn.PostgrestQueryBuilder=a6=Mn.PostgrestClient=void 0;const Qu=Zu,o6=Qu.__importDefault(oae());var a6=Mn.PostgrestClient=o6.default;const l6=Qu.__importDefault(i6());var c6=Mn.PostgrestQueryBuilder=l6.default;const u6=Qu.__importDefault(kA());var h6=Mn.PostgrestFilterBuilder=u6.default;const f6=Qu.__importDefault(n6());var d6=Mn.PostgrestTransformBuilder=f6.default;const p6=Qu.__importDefault(r6());var g6=Mn.PostgrestBuilder=p6.default;const m6=Qu.__importDefault(t6());s6=Mn.PostgrestError=m6.default;var y6=Mn.default={PostgrestClient:o6.default,PostgrestQueryBuilder:l6.default,PostgrestFilterBuilder:u6.default,PostgrestTransformBuilder:f6.default,PostgrestBuilder:p6.default,PostgrestError:m6.default};const aae=V9({__proto__:null,get PostgrestBuilder(){return g6},get PostgrestClient(){return a6},get PostgrestError(){return s6},get PostgrestFilterBuilder(){return h6},get PostgrestQueryBuilder(){return c6},get PostgrestTransformBuilder(){return d6},default:y6},[Mn]),{PostgrestClient:lae,PostgrestQueryBuilder:Fue,PostgrestFilterBuilder:jue,PostgrestTransformBuilder:que,PostgrestBuilder:Hue,PostgrestError:Wue}=y6||aae;class cae{static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){const t=process.versions;if(t&&t.node){const r=t.node,i=parseInt(r.replace(/^v/,"").split(".")[0]);return i>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${i} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${i} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+=`

Suggested solution: ${e.workaround}`),new Error(t)}static createWebSocket(e,t){const r=this.getWebSocketConstructor();return new r(e,t)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const uae="2.81.1",hae=`realtime-js/${uae}`,b6="1.0.0",fae="2.0.0",YP=b6,SE=1e4,dae=1e3,pae=100;var Ja;(function(n){n[n.connecting=0]="connecting",n[n.open=1]="open",n[n.closing=2]="closing",n[n.closed=3]="closed"})(Ja||(Ja={}));var zr;(function(n){n.closed="closed",n.errored="errored",n.joined="joined",n.joining="joining",n.leaving="leaving"})(zr||(zr={}));var Bi;(function(n){n.close="phx_close",n.error="phx_error",n.join="phx_join",n.reply="phx_reply",n.leave="phx_leave",n.access_token="access_token"})(Bi||(Bi={}));var AE;(function(n){n.websocket="websocket"})(AE||(AE={}));var el;(function(n){n.Connecting="connecting",n.Open="open",n.Closing="closing",n.Closed="closed"})(el||(el={}));class gae{constructor(){this.HEADER_LENGTH=1,this.META_LENGTH=4,this.USER_BROADCAST_PUSH_META_LENGTH=5,this.KINDS={push:0,reply:1,broadcast:2,userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST="broadcast"}encode(e,t){if(this._isArrayBuffer(e.payload))return t(this._binaryEncodePush(e));if(e.event===this.BROADCAST&&!(e.payload instanceof ArrayBuffer)&&typeof e.payload.event=="string")return t(this._binaryEncodeUserBroadcastPush(e));let r=[e.join_ref,e.ref,e.topic,e.event,e.payload];return t(JSON.stringify(r))}_binaryEncodePush(e){const{join_ref:t,ref:r,event:i,topic:s,payload:o}=e,a=this.META_LENGTH+t.length+r.length+s.length+i.length,l=new ArrayBuffer(this.HEADER_LENGTH+a);let c=new DataView(l),h=0;c.setUint8(h++,this.KINDS.push),c.setUint8(h++,t.length),c.setUint8(h++,r.length),c.setUint8(h++,s.length),c.setUint8(h++,i.length),Array.from(t,p=>c.setUint8(h++,p.charCodeAt(0))),Array.from(r,p=>c.setUint8(h++,p.charCodeAt(0))),Array.from(s,p=>c.setUint8(h++,p.charCodeAt(0))),Array.from(i,p=>c.setUint8(h++,p.charCodeAt(0)));var d=new Uint8Array(l.byteLength+o.byteLength);return d.set(new Uint8Array(l),0),d.set(new Uint8Array(o),l.byteLength),d.buffer}_binaryEncodeUserBroadcastPush(e){var t;return this._isArrayBuffer((t=e.payload)===null||t===void 0?void 0:t.payload)?this._encodeBinaryUserBroadcastPush(e):this._encodeJsonUserBroadcastPush(e)}_encodeBinaryUserBroadcastPush(e){var t,r;const{join_ref:i,ref:s,topic:o}=e,a=e.payload.event,l=(r=(t=e.payload)===null||t===void 0?void 0:t.payload)!==null&&r!==void 0?r:new ArrayBuffer(0),c=this.USER_BROADCAST_PUSH_META_LENGTH+i.length+s.length+o.length+a.length,h=new ArrayBuffer(this.HEADER_LENGTH+c);let d=new DataView(h),p=0;d.setUint8(p++,this.KINDS.userBroadcastPush),d.setUint8(p++,i.length),d.setUint8(p++,s.length),d.setUint8(p++,o.length),d.setUint8(p++,a.length),d.setUint8(p++,this.BINARY_ENCODING),Array.from(i,m=>d.setUint8(p++,m.charCodeAt(0))),Array.from(s,m=>d.setUint8(p++,m.charCodeAt(0))),Array.from(o,m=>d.setUint8(p++,m.charCodeAt(0))),Array.from(a,m=>d.setUint8(p++,m.charCodeAt(0)));var g=new Uint8Array(h.byteLength+l.byteLength);return g.set(new Uint8Array(h),0),g.set(new Uint8Array(l),h.byteLength),g.buffer}_encodeJsonUserBroadcastPush(e){var t,r;const{join_ref:i,ref:s,topic:o}=e,a=e.payload.event,l=(r=(t=e.payload)===null||t===void 0?void 0:t.payload)!==null&&r!==void 0?r:{},h=new TextEncoder().encode(JSON.stringify(l)).buffer,d=this.USER_BROADCAST_PUSH_META_LENGTH+i.length+s.length+o.length+a.length,p=new ArrayBuffer(this.HEADER_LENGTH+d);let g=new DataView(p),m=0;g.setUint8(m++,this.KINDS.userBroadcastPush),g.setUint8(m++,i.length),g.setUint8(m++,s.length),g.setUint8(m++,o.length),g.setUint8(m++,a.length),g.setUint8(m++,this.JSON_ENCODING),Array.from(i,y=>g.setUint8(m++,y.charCodeAt(0))),Array.from(s,y=>g.setUint8(m++,y.charCodeAt(0))),Array.from(o,y=>g.setUint8(m++,y.charCodeAt(0))),Array.from(a,y=>g.setUint8(m++,y.charCodeAt(0)));var E=new Uint8Array(p.byteLength+h.byteLength);return E.set(new Uint8Array(p),0),E.set(new Uint8Array(h),p.byteLength),E.buffer}decode(e,t){if(this._isArrayBuffer(e)){let r=this._binaryDecode(e);return t(r)}if(typeof e=="string"){const r=JSON.parse(e),[i,s,o,a,l]=r;return t({join_ref:i,ref:s,topic:o,event:a,payload:l})}return t({})}_binaryDecode(e){const t=new DataView(e),r=t.getUint8(0),i=new TextDecoder;switch(r){case this.KINDS.push:return this._decodePush(e,t,i);case this.KINDS.reply:return this._decodeReply(e,t,i);case this.KINDS.broadcast:return this._decodeBroadcast(e,t,i);case this.KINDS.userBroadcast:return this._decodeUserBroadcast(e,t,i)}}_decodePush(e,t,r){const i=t.getUint8(1),s=t.getUint8(2),o=t.getUint8(3);let a=this.HEADER_LENGTH+this.META_LENGTH-1;const l=r.decode(e.slice(a,a+i));a=a+i;const c=r.decode(e.slice(a,a+s));a=a+s;const h=r.decode(e.slice(a,a+o));a=a+o;const d=JSON.parse(r.decode(e.slice(a,e.byteLength)));return{join_ref:l,ref:null,topic:c,event:h,payload:d}}_decodeReply(e,t,r){const i=t.getUint8(1),s=t.getUint8(2),o=t.getUint8(3),a=t.getUint8(4);let l=this.HEADER_LENGTH+this.META_LENGTH;const c=r.decode(e.slice(l,l+i));l=l+i;const h=r.decode(e.slice(l,l+s));l=l+s;const d=r.decode(e.slice(l,l+o));l=l+o;const p=r.decode(e.slice(l,l+a));l=l+a;const g=JSON.parse(r.decode(e.slice(l,e.byteLength))),m={status:p,response:g};return{join_ref:c,ref:h,topic:d,event:Bi.reply,payload:m}}_decodeBroadcast(e,t,r){const i=t.getUint8(1),s=t.getUint8(2);let o=this.HEADER_LENGTH+2;const a=r.decode(e.slice(o,o+i));o=o+i;const l=r.decode(e.slice(o,o+s));o=o+s;const c=JSON.parse(r.decode(e.slice(o,e.byteLength)));return{join_ref:null,ref:null,topic:a,event:l,payload:c}}_decodeUserBroadcast(e,t,r){const i=t.getUint8(1),s=t.getUint8(2),o=t.getUint8(3),a=t.getUint8(4);let l=this.HEADER_LENGTH+4;const c=r.decode(e.slice(l,l+i));l=l+i;const h=r.decode(e.slice(l,l+s));l=l+s;const d=r.decode(e.slice(l,l+o));l=l+o;const p=e.slice(l,e.byteLength),g=a===this.JSON_ENCODING?JSON.parse(r.decode(p)):p,m={type:this.BROADCAST,event:h,payload:g};return o>0&&(m.meta=JSON.parse(d)),{join_ref:null,ref:null,topic:c,event:this.BROADCAST,payload:m}}_isArrayBuffer(e){var t;return e instanceof ArrayBuffer||((t=e==null?void 0:e.constructor)===null||t===void 0?void 0:t.name)==="ArrayBuffer"}}class w6{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var ur;(function(n){n.abstime="abstime",n.bool="bool",n.date="date",n.daterange="daterange",n.float4="float4",n.float8="float8",n.int2="int2",n.int4="int4",n.int4range="int4range",n.int8="int8",n.int8range="int8range",n.json="json",n.jsonb="jsonb",n.money="money",n.numeric="numeric",n.oid="oid",n.reltime="reltime",n.text="text",n.time="time",n.timestamp="timestamp",n.timestamptz="timestamptz",n.timetz="timetz",n.tsrange="tsrange",n.tstzrange="tstzrange"})(ur||(ur={}));const XP=(n,e,t={})=>{var r;const i=(r=t.skipTypes)!==null&&r!==void 0?r:[];return e?Object.keys(e).reduce((s,o)=>(s[o]=mae(o,n,e,i),s),{}):{}},mae=(n,e,t,r)=>{const i=e.find(a=>a.name===n),s=i==null?void 0:i.type,o=t[n];return s&&!r.includes(s)?v6(s,o):xE(o)},v6=(n,e)=>{if(n.charAt(0)==="_"){const t=n.slice(1,n.length);return vae(e,t)}switch(n){case ur.bool:return yae(e);case ur.float4:case ur.float8:case ur.int2:case ur.int4:case ur.int8:case ur.numeric:case ur.oid:return bae(e);case ur.json:case ur.jsonb:return wae(e);case ur.timestamp:return _ae(e);case ur.abstime:case ur.date:case ur.daterange:case ur.int4range:case ur.int8range:case ur.money:case ur.reltime:case ur.text:case ur.time:case ur.timestamptz:case ur.timetz:case ur.tsrange:case ur.tstzrange:return xE(e);default:return xE(e)}},xE=n=>n,yae=n=>{switch(n){case"t":return!0;case"f":return!1;default:return n}},bae=n=>{if(typeof n=="string"){const e=parseFloat(n);if(!Number.isNaN(e))return e}return n},wae=n=>{if(typeof n=="string")try{return JSON.parse(n)}catch(e){return console.log(`JSON parse error: ${e}`),n}return n},vae=(n,e)=>{if(typeof n!="string")return n;const t=n.length-1,r=n[t];if(n[0]==="{"&&r==="}"){let s;const o=n.slice(1,t);try{s=JSON.parse("["+o+"]")}catch{s=o?o.split(","):[]}return s.map(a=>v6(e,a))}return n},_ae=n=>typeof n=="string"?n.replace(" ","T"):n,_6=n=>{const e=new URL(n);return e.protocol=e.protocol.replace(/^ws/i,"http"),e.pathname=e.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),e.pathname===""||e.pathname==="/"?e.pathname="/api/broadcast":e.pathname=e.pathname+"/api/broadcast",e.href};class zw{constructor(e,t,r={},i=SE){this.channel=e,this.event=t,this.payload=r,this.timeout=i,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var r;return this._hasReceived(e)&&t((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(r=>r.status===e).forEach(r=>r.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var ZP;(function(n){n.SYNC="sync",n.JOIN="join",n.LEAVE="leave"})(ZP||(ZP={}));class ef{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=(t==null?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},i=>{const{onJoin:s,onLeave:o,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=ef.syncState(this.state,i,s,o),this.pendingDiffs.forEach(l=>{this.state=ef.syncDiff(this.state,l,s,o)}),this.pendingDiffs=[],a()}),this.channel._on(r.diff,{},i=>{const{onJoin:s,onLeave:o,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(i):(this.state=ef.syncDiff(this.state,i,s,o),a())}),this.onJoin((i,s,o)=>{this.channel._trigger("presence",{event:"join",key:i,currentPresences:s,newPresences:o})}),this.onLeave((i,s,o)=>{this.channel._trigger("presence",{event:"leave",key:i,currentPresences:s,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,r,i){const s=this.cloneDeep(e),o=this.transformState(t),a={},l={};return this.map(s,(c,h)=>{o[c]||(l[c]=h)}),this.map(o,(c,h)=>{const d=s[c];if(d){const p=h.map(y=>y.presence_ref),g=d.map(y=>y.presence_ref),m=h.filter(y=>g.indexOf(y.presence_ref)<0),E=d.filter(y=>p.indexOf(y.presence_ref)<0);m.length>0&&(a[c]=m),E.length>0&&(l[c]=E)}else a[c]=h}),this.syncDiff(s,{joins:a,leaves:l},r,i)}static syncDiff(e,t,r,i){const{joins:s,leaves:o}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return r||(r=()=>{}),i||(i=()=>{}),this.map(s,(a,l)=>{var c;const h=(c=e[a])!==null&&c!==void 0?c:[];if(e[a]=this.cloneDeep(l),h.length>0){const d=e[a].map(g=>g.presence_ref),p=h.filter(g=>d.indexOf(g.presence_ref)<0);e[a].unshift(...p)}r(a,h,l)}),this.map(o,(a,l)=>{let c=e[a];if(!c)return;const h=l.map(d=>d.presence_ref);c=c.filter(d=>h.indexOf(d.presence_ref)<0),e[a]=c,i(a,c,l),c.length===0&&delete e[a]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(r=>t(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,r)=>{const i=e[r];return"metas"in i?t[r]=i.metas.map(s=>(s.presence_ref=s.phx_ref,delete s.phx_ref,delete s.phx_ref_prev,s)):t[r]=i,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var QP;(function(n){n.ALL="*",n.INSERT="INSERT",n.UPDATE="UPDATE",n.DELETE="DELETE"})(QP||(QP={}));var tf;(function(n){n.BROADCAST="broadcast",n.PRESENCE="presence",n.POSTGRES_CHANGES="postgres_changes",n.SYSTEM="system"})(tf||(tf={}));var Zs;(function(n){n.SUBSCRIBED="SUBSCRIBED",n.TIMED_OUT="TIMED_OUT",n.CLOSED="CLOSED",n.CHANNEL_ERROR="CHANNEL_ERROR"})(Zs||(Zs={}));class PA{constructor(e,t={config:{}},r){var i,s;if(this.topic=e,this.params=t,this.socket=r,this.bindings={},this.state=zr.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new zw(this,Bi.join,this.params,this.timeout),this.rejoinTimer=new w6(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=zr.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(o=>o.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=zr.closed,this.socket._remove(this)}),this._onError(o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=zr.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=zr.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=zr.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Bi.reply,{},(o,a)=>{this._trigger(this._replyEventName(a),o)}),this.presence=new ef(this),this.broadcastEndpointURL=_6(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((s=(i=this.params.config)===null||i===void 0?void 0:i.broadcast)===null||s===void 0)&&s.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(e,t=this.timeout){var r,i,s;if(this.socket.isConnected()||this.socket.connect(),this.state==zr.closed){const{config:{broadcast:o,presence:a,private:l}}=this.params,c=(i=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(g=>g.filter))!==null&&i!==void 0?i:[],h=!!this.bindings[tf.PRESENCE]&&this.bindings[tf.PRESENCE].length>0||((s=this.params.config.presence)===null||s===void 0?void 0:s.enabled)===!0,d={},p={broadcast:o,presence:Object.assign(Object.assign({},a),{enabled:h}),postgres_changes:c,private:l};this.socket.accessTokenValue&&(d.access_token=this.socket.accessTokenValue),this._onError(g=>e==null?void 0:e(Zs.CHANNEL_ERROR,g)),this._onClose(()=>e==null?void 0:e(Zs.CLOSED)),this.updateJoinPayload(Object.assign({config:p},d)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:g})=>{var m;if(this.socket.setAuth(),g===void 0){e==null||e(Zs.SUBSCRIBED);return}else{const E=this.bindings.postgres_changes,y=(m=E==null?void 0:E.length)!==null&&m!==void 0?m:0,S=[];for(let b=0;b<y;b++){const _=E[b],{filter:{event:I,schema:x,table:$,filter:U}}=_,O=g&&g[b];if(O&&O.event===I&&O.schema===x&&O.table===$&&O.filter===U)S.push(Object.assign(Object.assign({},_),{id:O.id}));else{this.unsubscribe(),this.state=zr.errored,e==null||e(Zs.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=S,e&&e(Zs.SUBSCRIBED);return}}).receive("error",g=>{this.state=zr.errored,e==null||e(Zs.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(g).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(Zs.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,r){return this.state===zr.joined&&e===tf.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(e,t,r)}async httpSend(e,t,r={}){var i;const s=this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"";if(t==null)return Promise.reject("Payload is required for httpSend()");const o={method:"POST",headers:{Authorization:s,apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:e,payload:t,private:this.private}]})},a=await this._fetchWithTimeout(this.broadcastEndpointURL,o,(i=r.timeout)!==null&&i!==void 0?i:this.timeout);if(a.status===202)return{success:!0};let l=a.statusText;try{const c=await a.json();l=c.error||c.message||l}catch{}return Promise.reject(new Error(l))}async send(e,t={}){var r,i;if(!this._canPush()&&e.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:s,payload:o}=e,l={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:s,payload:o,private:this.private}]})};try{const c=await this._fetchWithTimeout(this.broadcastEndpointURL,l,(r=t.timeout)!==null&&r!==void 0?r:this.timeout);return await((i=c.body)===null||i===void 0?void 0:i.cancel()),c.ok?"ok":"error"}catch(c){return c.name==="AbortError"?"timed out":"error"}}else return new Promise(s=>{var o,a,l;const c=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((l=(a=(o=this.params)===null||o===void 0?void 0:o.config)===null||a===void 0?void 0:a.broadcast)===null||l===void 0)&&l.ack)&&s("ok"),c.receive("ok",()=>s("ok")),c.receive("error",()=>s("error")),c.receive("timeout",()=>s("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=zr.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Bi.close,"leave",this._joinRef())};this.joinPush.destroy();let r=null;return new Promise(i=>{r=new zw(this,Bi.leave,{},e),r.receive("ok",()=>{t(),i("ok")}).receive("timeout",()=>{t(),i("timed out")}).receive("error",()=>{i("error")}),r.send(),this._canPush()||r.trigger("ok",{})}).finally(()=>{r==null||r.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=zr.closed,this.bindings={}}async _fetchWithTimeout(e,t,r){const i=new AbortController,s=setTimeout(()=>i.abort(),r),o=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:i.signal}));return clearTimeout(s),o}_push(e,t,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let i=new zw(this,e,t,r);return this._canPush()?i.send():this._addToPushBuffer(i),i}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>pae){const t=this.pushBuffer.shift();t&&(t.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${t.event}`,t.payload))}}_onMessage(e,t,r){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,r){var i,s;const o=e.toLocaleLowerCase(),{close:a,error:l,leave:c,join:h}=Bi;if(r&&[a,l,c,h].indexOf(o)>=0&&r!==this._joinRef())return;let p=this._onMessage(o,t,r);if(t&&!p)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(i=this.bindings.postgres_changes)===null||i===void 0||i.filter(g=>{var m,E,y;return((m=g.filter)===null||m===void 0?void 0:m.event)==="*"||((y=(E=g.filter)===null||E===void 0?void 0:E.event)===null||y===void 0?void 0:y.toLocaleLowerCase())===o}).map(g=>g.callback(p,r)):(s=this.bindings[o])===null||s===void 0||s.filter(g=>{var m,E,y,S,b,_;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in g){const I=g.id,x=(m=g.filter)===null||m===void 0?void 0:m.event;return I&&((E=t.ids)===null||E===void 0?void 0:E.includes(I))&&(x==="*"||(x==null?void 0:x.toLocaleLowerCase())===((y=t.data)===null||y===void 0?void 0:y.type.toLocaleLowerCase()))}else{const I=(b=(S=g==null?void 0:g.filter)===null||S===void 0?void 0:S.event)===null||b===void 0?void 0:b.toLocaleLowerCase();return I==="*"||I===((_=t==null?void 0:t.event)===null||_===void 0?void 0:_.toLocaleLowerCase())}else return g.type.toLocaleLowerCase()===o}).map(g=>{if(typeof p=="object"&&"ids"in p){const m=p.data,{schema:E,table:y,commit_timestamp:S,type:b,errors:_}=m;p=Object.assign(Object.assign({},{schema:E,table:y,commit_timestamp:S,eventType:b,new:{},old:{},errors:_}),this._getPayloadRecords(m))}g.callback(p,r)})}_isClosed(){return this.state===zr.closed}_isJoined(){return this.state===zr.joined}_isJoining(){return this.state===zr.joining}_isLeaving(){return this.state===zr.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,r){const i=e.toLocaleLowerCase(),s={type:i,filter:t,callback:r};return this.bindings[i]?this.bindings[i].push(s):this.bindings[i]=[s],this}_off(e,t){const r=e.toLocaleLowerCase();return this.bindings[r]&&(this.bindings[r]=this.bindings[r].filter(i=>{var s;return!(((s=i.type)===null||s===void 0?void 0:s.toLocaleLowerCase())===r&&PA.isEqual(i.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(e[r]!==t[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(Bi.close,{},e)}_onError(e){this._on(Bi.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=zr.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=XP(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=XP(e.columns,e.old_record)),t}}const Kw=()=>{},qp={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},Eae=[1e3,2e3,5e3,1e4],Sae=1e4,Aae=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class xae{constructor(e,t){var r;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=SE,this.transport=null,this.heartbeatIntervalMs=qp.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Kw,this.ref=0,this.reconnectTimer=null,this.vsn=YP,this.logger=Kw,this.conn=null,this.sendBuffer=[],this.serializer=new gae,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=i=>i?(...s)=>i(...s):(...s)=>fetch(...s),!(!((r=t==null?void 0:t.params)===null||r===void 0)&&r.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=t.params.apikey,this.endPoint=`${e}/${AE.websocket}`,this.httpEndpoint=_6(e),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(t==null?void 0:t.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=cae.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const t=e.message;throw t.includes("Node.js")?new Error(`${t}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${t}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(e,t){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const r=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(r),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(e?this.conn.close(e,t??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,r){this.logger(e,t,r)}connectionState(){switch(this.conn&&this.conn.readyState){case Ja.connecting:return el.Connecting;case Ja.open:return el.Open;case Ja.closing:return el.Closing;default:return el.Closed}}isConnected(){return this.connectionState()===el.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,t={config:{}}){const r=`realtime:${e}`,i=this.getChannels().find(s=>s.topic===r);if(i)return i;{const s=new PA(`realtime:${e}`,t,this);return this.channels.push(s),s}}push(e){const{topic:t,event:r,payload:i,ref:s}=e,o=()=>{this.encode(e,a=>{var l;(l=this.conn)===null||l===void 0||l.send(a)})};this.log("push",`${t} ${r} (${s})`,i),this.isConnected()?o():this.sendBuffer.push(o)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var e;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(t){this.log("error","error in heartbeat callback",t)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(t){this.log("error","error in heartbeat callback",t)}this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(dae,"heartbeat timeout"),setTimeout(()=>{var t;this.isConnected()||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout()},qp.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(t){this.log("error","error in heartbeat callback",t)}this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(r=>r.topic===e&&(r._isJoined()||r._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,t=>{if(t.topic==="phoenix"&&t.event==="phx_reply")try{this.heartbeatCallback(t.payload.status==="ok"?"ok":"error")}catch(c){this.log("error","error in heartbeat callback",c)}t.ref&&t.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:r,event:i,payload:s,ref:o}=t,a=o?`(${o})`:"",l=s.status||"";this.log("receive",`${l} ${r} ${i} ${a}`.trim(),s),this.channels.filter(c=>c._isMember(r)).forEach(c=>c._trigger(i,s,o)),this._triggerStateCallbacks("message",t)})}_clearTimer(e){var t;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((t=this.reconnectTimer)===null||t===void 0||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_teardownConnection(){if(this.conn){if(this.conn.readyState===Ja.open||this.conn.readyState===Ja.connecting)try{this.conn.close()}catch(e){this.log("error","Error closing connection",e)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(t=>{this.log("error","error waiting for auth on connect",t),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(Bi.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const r=e.match(/\?/)?"&":"?",i=new URLSearchParams(t);return`${e}${r}${i}`}_workerObjectUrl(e){let t;if(e)t=e;else{const r=new Blob([Aae],{type:"application/javascript"});t=URL.createObjectURL(r)}return t}_setConnectionState(e,t=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=t)}async _performAuth(e=null){let t;e?t=e:this.accessToken?t=await this.accessToken():t=this.accessTokenValue,this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(r=>{const i={access_token:t,version:hae};t&&r.updateJoinPayload(i),r.joinedOnce&&r._isJoined()&&r._push(Bi.access_token,{access_token:t})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this.setAuth().catch(t=>{this.log("error",`error setting auth in ${e}`,t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(r=>{try{r(t)}catch(i){this.log("error",`error in ${e} callback`,i)}})}catch(r){this.log("error",`error triggering ${e} callbacks`,r)}}_setupReconnectionTimer(){this.reconnectTimer=new w6(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},qp.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var t,r,i,s,o,a,l,c,h,d,p,g;switch(this.transport=(t=e==null?void 0:e.transport)!==null&&t!==void 0?t:null,this.timeout=(r=e==null?void 0:e.timeout)!==null&&r!==void 0?r:SE,this.heartbeatIntervalMs=(i=e==null?void 0:e.heartbeatIntervalMs)!==null&&i!==void 0?i:qp.HEARTBEAT_INTERVAL,this.worker=(s=e==null?void 0:e.worker)!==null&&s!==void 0?s:!1,this.accessToken=(o=e==null?void 0:e.accessToken)!==null&&o!==void 0?o:null,this.heartbeatCallback=(a=e==null?void 0:e.heartbeatCallback)!==null&&a!==void 0?a:Kw,this.vsn=(l=e==null?void 0:e.vsn)!==null&&l!==void 0?l:YP,e!=null&&e.params&&(this.params=e.params),e!=null&&e.logger&&(this.logger=e.logger),(e!=null&&e.logLevel||e!=null&&e.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(c=e==null?void 0:e.reconnectAfterMs)!==null&&c!==void 0?c:m=>Eae[m-1]||Sae,this.vsn){case b6:this.encode=(h=e==null?void 0:e.encode)!==null&&h!==void 0?h:(m,E)=>E(JSON.stringify(m)),this.decode=(d=e==null?void 0:e.decode)!==null&&d!==void 0?d:(m,E)=>E(JSON.parse(m));break;case fae:this.encode=(p=e==null?void 0:e.encode)!==null&&p!==void 0?p:this.serializer.encode.bind(this.serializer),this.decode=(g=e==null?void 0:e.decode)!==null&&g!==void 0?g:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e==null?void 0:e.workerUrl}}}class RA extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function xr(n){return typeof n=="object"&&n!==null&&"__isStorageError"in n}class Iae extends RA{constructor(e,t,r){super(e),this.name="StorageApiError",this.status=t,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class IE extends RA{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}const OA=n=>n?(...e)=>n(...e):(...e)=>fetch(...e),Tae=()=>Response,TE=n=>{if(Array.isArray(n))return n.map(t=>TE(t));if(typeof n=="function"||n!==Object(n))return n;const e={};return Object.entries(n).forEach(([t,r])=>{const i=t.replace(/([-_][a-z])/gi,s=>s.toUpperCase().replace(/[-_]/g,""));e[i]=TE(r)}),e},Cae=n=>{if(typeof n!="object"||n===null)return!1;const e=Object.getPrototypeOf(n);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)},Vw=n=>{var e;return n.msg||n.message||n.error_description||(typeof n.error=="string"?n.error:(e=n.error)===null||e===void 0?void 0:e.message)||JSON.stringify(n)},kae=(n,e,t)=>rt(void 0,void 0,void 0,function*(){const r=yield Tae();n instanceof r&&!(t!=null&&t.noResolveJson)?n.json().then(i=>{const s=n.status||500,o=(i==null?void 0:i.statusCode)||s+"";e(new Iae(Vw(i),s,o))}).catch(i=>{e(new IE(Vw(i),i))}):e(new IE(Vw(n),n))}),Pae=(n,e,t,r)=>{const i={method:n,headers:(e==null?void 0:e.headers)||{}};return n==="GET"||!r?i:(Cae(r)?(i.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),i.body=JSON.stringify(r)):i.body=r,e!=null&&e.duplex&&(i.duplex=e.duplex),Object.assign(Object.assign({},i),t))};function cd(n,e,t,r,i,s){return rt(this,void 0,void 0,function*(){return new Promise((o,a)=>{n(t,Pae(e,r,i,s)).then(l=>{if(!l.ok)throw l;return r!=null&&r.noResolveJson?l:l.json()}).then(l=>o(l)).catch(l=>kae(l,a,r))})})}function Df(n,e,t,r){return rt(this,void 0,void 0,function*(){return cd(n,"GET",e,t,r)})}function rs(n,e,t,r,i){return rt(this,void 0,void 0,function*(){return cd(n,"POST",e,r,i,t)})}function CE(n,e,t,r,i){return rt(this,void 0,void 0,function*(){return cd(n,"PUT",e,r,i,t)})}function Rae(n,e,t,r){return rt(this,void 0,void 0,function*(){return cd(n,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),r)})}function LA(n,e,t,r,i){return rt(this,void 0,void 0,function*(){return cd(n,"DELETE",e,r,i,t)})}class Oae{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t}then(e,t){return this.execute().then(e,t)}execute(){return rt(this,void 0,void 0,function*(){try{return{data:(yield this.downloadFn()).body,error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(xr(e))return{data:null,error:e};throw e}})}}var E6;class Lae{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t,this[E6]="BlobDownloadBuilder",this.promise=null}asStream(){return new Oae(this.downloadFn,this.shouldThrowOnError)}then(e,t){return this.getPromise().then(e,t)}catch(e){return this.getPromise().catch(e)}finally(e){return this.getPromise().finally(e)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}execute(){return rt(this,void 0,void 0,function*(){try{return{data:yield(yield this.downloadFn()).blob(),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(xr(e))return{data:null,error:e};throw e}})}}E6=Symbol.toStringTag;const Nae={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},JP={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class Dae{constructor(e,t={},r,i){this.shouldThrowOnError=!1,this.url=e,this.headers=t,this.bucketId=r,this.fetch=OA(i)}throwOnError(){return this.shouldThrowOnError=!0,this}uploadOrUpdate(e,t,r,i){return rt(this,void 0,void 0,function*(){try{let s;const o=Object.assign(Object.assign({},JP),i);let a=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(o.upsert)});const l=o.metadata;typeof Blob<"u"&&r instanceof Blob?(s=new FormData,s.append("cacheControl",o.cacheControl),l&&s.append("metadata",this.encodeMetadata(l)),s.append("",r)):typeof FormData<"u"&&r instanceof FormData?(s=r,s.has("cacheControl")||s.append("cacheControl",o.cacheControl),l&&!s.has("metadata")&&s.append("metadata",this.encodeMetadata(l))):(s=r,a["cache-control"]=`max-age=${o.cacheControl}`,a["content-type"]=o.contentType,l&&(a["x-metadata"]=this.toBase64(this.encodeMetadata(l))),(typeof ReadableStream<"u"&&s instanceof ReadableStream||s&&typeof s=="object"&&"pipe"in s&&typeof s.pipe=="function")&&!o.duplex&&(o.duplex="half")),i!=null&&i.headers&&(a=Object.assign(Object.assign({},a),i.headers));const c=this._removeEmptyFolders(t),h=this._getFinalPath(c),d=yield(e=="PUT"?CE:rs)(this.fetch,`${this.url}/object/${h}`,s,Object.assign({headers:a},o!=null&&o.duplex?{duplex:o.duplex}:{}));return{data:{path:c,id:d.Id,fullPath:d.Key},error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(xr(s))return{data:null,error:s};throw s}})}upload(e,t,r){return rt(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,r)})}uploadToSignedUrl(e,t,r,i){return rt(this,void 0,void 0,function*(){const s=this._removeEmptyFolders(e),o=this._getFinalPath(s),a=new URL(this.url+`/object/upload/sign/${o}`);a.searchParams.set("token",t);try{let l;const c=Object.assign({upsert:JP.upsert},i),h=Object.assign(Object.assign({},this.headers),{"x-upsert":String(c.upsert)});typeof Blob<"u"&&r instanceof Blob?(l=new FormData,l.append("cacheControl",c.cacheControl),l.append("",r)):typeof FormData<"u"&&r instanceof FormData?(l=r,l.append("cacheControl",c.cacheControl)):(l=r,h["cache-control"]=`max-age=${c.cacheControl}`,h["content-type"]=c.contentType);const d=yield CE(this.fetch,a.toString(),l,{headers:h});return{data:{path:s,fullPath:d.Key},error:null}}catch(l){if(this.shouldThrowOnError)throw l;if(xr(l))return{data:null,error:l};throw l}})}createSignedUploadUrl(e,t){return rt(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e);const i=Object.assign({},this.headers);t!=null&&t.upsert&&(i["x-upsert"]="true");const s=yield rs(this.fetch,`${this.url}/object/upload/sign/${r}`,{},{headers:i}),o=new URL(this.url+s.url),a=o.searchParams.get("token");if(!a)throw new RA("No token returned by API");return{data:{signedUrl:o.toString(),path:e,token:a},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(xr(r))return{data:null,error:r};throw r}})}update(e,t,r){return rt(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,r)})}move(e,t,r){return rt(this,void 0,void 0,function*(){try{return{data:yield rs(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:r==null?void 0:r.destinationBucket},{headers:this.headers}),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(xr(i))return{data:null,error:i};throw i}})}copy(e,t,r){return rt(this,void 0,void 0,function*(){try{return{data:{path:(yield rs(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:r==null?void 0:r.destinationBucket},{headers:this.headers})).Key},error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(xr(i))return{data:null,error:i};throw i}})}createSignedUrl(e,t,r){return rt(this,void 0,void 0,function*(){try{let i=this._getFinalPath(e),s=yield rs(this.fetch,`${this.url}/object/sign/${i}`,Object.assign({expiresIn:t},r!=null&&r.transform?{transform:r.transform}:{}),{headers:this.headers});const o=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return s={signedUrl:encodeURI(`${this.url}${s.signedURL}${o}`)},{data:s,error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(xr(i))return{data:null,error:i};throw i}})}createSignedUrls(e,t,r){return rt(this,void 0,void 0,function*(){try{const i=yield rs(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),s=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return{data:i.map(o=>Object.assign(Object.assign({},o),{signedUrl:o.signedURL?encodeURI(`${this.url}${o.signedURL}${s}`):null})),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(xr(i))return{data:null,error:i};throw i}})}download(e,t){const i=typeof(t==null?void 0:t.transform)<"u"?"render/image/authenticated":"object",s=this.transformOptsToQueryString((t==null?void 0:t.transform)||{}),o=s?`?${s}`:"",a=this._getFinalPath(e),l=()=>Df(this.fetch,`${this.url}/${i}/${a}${o}`,{headers:this.headers,noResolveJson:!0});return new Lae(l,this.shouldThrowOnError)}info(e){return rt(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const r=yield Df(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:TE(r),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(xr(r))return{data:null,error:r};throw r}})}exists(e){return rt(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield Rae(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(xr(r)&&r instanceof IE){const i=r.originalError;if([400,404].includes(i==null?void 0:i.status))return{data:!1,error:r}}throw r}})}getPublicUrl(e,t){const r=this._getFinalPath(e),i=[],s=t!=null&&t.download?`download=${t.download===!0?"":t.download}`:"";s!==""&&i.push(s);const a=typeof(t==null?void 0:t.transform)<"u"?"render/image":"object",l=this.transformOptsToQueryString((t==null?void 0:t.transform)||{});l!==""&&i.push(l);let c=i.join("&");return c!==""&&(c=`?${c}`),{data:{publicUrl:encodeURI(`${this.url}/${a}/public/${r}${c}`)}}}remove(e){return rt(this,void 0,void 0,function*(){try{return{data:yield LA(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(xr(t))return{data:null,error:t};throw t}})}list(e,t,r){return rt(this,void 0,void 0,function*(){try{const i=Object.assign(Object.assign(Object.assign({},Nae),t),{prefix:e||""});return{data:yield rs(this.fetch,`${this.url}/object/list/${this.bucketId}`,i,{headers:this.headers},r),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(xr(i))return{data:null,error:i};throw i}})}listV2(e,t){return rt(this,void 0,void 0,function*(){try{const r=Object.assign({},e);return{data:yield rs(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,r,{headers:this.headers},t),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(xr(r))return{data:null,error:r};throw r}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const S6="2.81.1",A6={"X-Client-Info":`storage-js/${S6}`};class $ae{constructor(e,t={},r,i){this.shouldThrowOnError=!1;const s=new URL(e);i!=null&&i.useNewHostname&&/supabase\.(co|in|red)$/.test(s.hostname)&&!s.hostname.includes("storage.supabase.")&&(s.hostname=s.hostname.replace("supabase.","storage.supabase.")),this.url=s.href.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},A6),t),this.fetch=OA(r)}throwOnError(){return this.shouldThrowOnError=!0,this}listBuckets(e){return rt(this,void 0,void 0,function*(){try{const t=this.listBucketOptionsToQueryString(e);return{data:yield Df(this.fetch,`${this.url}/bucket${t}`,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(xr(t))return{data:null,error:t};throw t}})}getBucket(e){return rt(this,void 0,void 0,function*(){try{return{data:yield Df(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(xr(t))return{data:null,error:t};throw t}})}createBucket(e){return rt(this,arguments,void 0,function*(t,r={public:!1}){try{return{data:yield rs(this.fetch,`${this.url}/bucket`,{id:t,name:t,type:r.type,public:r.public,file_size_limit:r.fileSizeLimit,allowed_mime_types:r.allowedMimeTypes},{headers:this.headers}),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(xr(i))return{data:null,error:i};throw i}})}updateBucket(e,t){return rt(this,void 0,void 0,function*(){try{return{data:yield CE(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(xr(r))return{data:null,error:r};throw r}})}emptyBucket(e){return rt(this,void 0,void 0,function*(){try{return{data:yield rs(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(xr(t))return{data:null,error:t};throw t}})}deleteBucket(e){return rt(this,void 0,void 0,function*(){try{return{data:yield LA(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(xr(t))return{data:null,error:t};throw t}})}listBucketOptionsToQueryString(e){const t={};return e&&("limit"in e&&(t.limit=String(e.limit)),"offset"in e&&(t.offset=String(e.offset)),e.search&&(t.search=e.search),e.sortColumn&&(t.sortColumn=e.sortColumn),e.sortOrder&&(t.sortOrder=e.sortOrder)),Object.keys(t).length>0?"?"+new URLSearchParams(t).toString():""}}class Mae{constructor(e,t={},r){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},A6),t),this.fetch=OA(r)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(e){return rt(this,void 0,void 0,function*(){try{return{data:yield rs(this.fetch,`${this.url}/bucket`,{name:e},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(xr(t))return{data:null,error:t};throw t}})}listBuckets(e){return rt(this,void 0,void 0,function*(){try{const t=new URLSearchParams;(e==null?void 0:e.limit)!==void 0&&t.set("limit",e.limit.toString()),(e==null?void 0:e.offset)!==void 0&&t.set("offset",e.offset.toString()),e!=null&&e.sortColumn&&t.set("sortColumn",e.sortColumn),e!=null&&e.sortOrder&&t.set("sortOrder",e.sortOrder),e!=null&&e.search&&t.set("search",e.search);const r=t.toString(),i=r?`${this.url}/bucket?${r}`:`${this.url}/bucket`;return{data:yield Df(this.fetch,i,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(xr(t))return{data:null,error:t};throw t}})}deleteBucket(e){return rt(this,void 0,void 0,function*(){try{return{data:yield LA(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(xr(t))return{data:null,error:t};throw t}})}}const NA={"X-Client-Info":`storage-js/${S6}`,"Content-Type":"application/json"};class x6 extends Error{constructor(e){super(e),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}}function wi(n){return typeof n=="object"&&n!==null&&"__isStorageVectorsError"in n}class Gw extends x6{constructor(e,t,r){super(e),this.name="StorageVectorsApiError",this.status=t,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class Bae extends x6{constructor(e,t){super(e),this.name="StorageVectorsUnknownError",this.originalError=t}}var eR;(function(n){n.InternalError="InternalError",n.S3VectorConflictException="S3VectorConflictException",n.S3VectorNotFoundException="S3VectorNotFoundException",n.S3VectorBucketNotEmpty="S3VectorBucketNotEmpty",n.S3VectorMaxBucketsExceeded="S3VectorMaxBucketsExceeded",n.S3VectorMaxIndexesExceeded="S3VectorMaxIndexesExceeded"})(eR||(eR={}));const DA=n=>n?(...e)=>n(...e):(...e)=>fetch(...e),Uae=n=>{if(typeof n!="object"||n===null)return!1;const e=Object.getPrototypeOf(n);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)},tR=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),Fae=(n,e,t)=>rt(void 0,void 0,void 0,function*(){if(n&&typeof n=="object"&&"status"in n&&"ok"in n&&typeof n.status=="number"&&!(t!=null&&t.noResolveJson)){const i=n.status||500,s=n;if(typeof s.json=="function")s.json().then(o=>{const a=(o==null?void 0:o.statusCode)||(o==null?void 0:o.code)||i+"";e(new Gw(tR(o),i,a))}).catch(()=>{const o=i+"",a=s.statusText||`HTTP ${i} error`;e(new Gw(a,i,o))});else{const o=i+"",a=s.statusText||`HTTP ${i} error`;e(new Gw(a,i,o))}}else e(new Bae(tR(n),n))}),jae=(n,e,t,r)=>{const i={method:n,headers:(e==null?void 0:e.headers)||{}};return r?(Uae(r)?(i.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),i.body=JSON.stringify(r)):i.body=r,Object.assign(Object.assign({},i),t)):i};function qae(n,e,t,r,i,s){return rt(this,void 0,void 0,function*(){return new Promise((o,a)=>{n(t,jae(e,r,i,s)).then(l=>{if(!l.ok)throw l;if(r!=null&&r.noResolveJson)return l;const c=l.headers.get("content-type");return!c||!c.includes("application/json")?{}:l.json()}).then(l=>o(l)).catch(l=>Fae(l,a,r))})})}function vi(n,e,t,r,i){return rt(this,void 0,void 0,function*(){return qae(n,"POST",e,r,i,t)})}class Hae{constructor(e,t={},r){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},NA),t),this.fetch=DA(r)}throwOnError(){return this.shouldThrowOnError=!0,this}createIndex(e){return rt(this,void 0,void 0,function*(){try{return{data:(yield vi(this.fetch,`${this.url}/CreateIndex`,e,{headers:this.headers}))||{},error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(wi(t))return{data:null,error:t};throw t}})}getIndex(e,t){return rt(this,void 0,void 0,function*(){try{return{data:yield vi(this.fetch,`${this.url}/GetIndex`,{vectorBucketName:e,indexName:t},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(wi(r))return{data:null,error:r};throw r}})}listIndexes(e){return rt(this,void 0,void 0,function*(){try{return{data:yield vi(this.fetch,`${this.url}/ListIndexes`,e,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(wi(t))return{data:null,error:t};throw t}})}deleteIndex(e,t){return rt(this,void 0,void 0,function*(){try{return{data:(yield vi(this.fetch,`${this.url}/DeleteIndex`,{vectorBucketName:e,indexName:t},{headers:this.headers}))||{},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(wi(r))return{data:null,error:r};throw r}})}}class Wae{constructor(e,t={},r){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},NA),t),this.fetch=DA(r)}throwOnError(){return this.shouldThrowOnError=!0,this}putVectors(e){return rt(this,void 0,void 0,function*(){try{if(e.vectors.length<1||e.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return{data:(yield vi(this.fetch,`${this.url}/PutVectors`,e,{headers:this.headers}))||{},error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(wi(t))return{data:null,error:t};throw t}})}getVectors(e){return rt(this,void 0,void 0,function*(){try{return{data:yield vi(this.fetch,`${this.url}/GetVectors`,e,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(wi(t))return{data:null,error:t};throw t}})}listVectors(e){return rt(this,void 0,void 0,function*(){try{if(e.segmentCount!==void 0){if(e.segmentCount<1||e.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(e.segmentIndex!==void 0&&(e.segmentIndex<0||e.segmentIndex>=e.segmentCount))throw new Error(`segmentIndex must be between 0 and ${e.segmentCount-1}`)}return{data:yield vi(this.fetch,`${this.url}/ListVectors`,e,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(wi(t))return{data:null,error:t};throw t}})}queryVectors(e){return rt(this,void 0,void 0,function*(){try{return{data:yield vi(this.fetch,`${this.url}/QueryVectors`,e,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(wi(t))return{data:null,error:t};throw t}})}deleteVectors(e){return rt(this,void 0,void 0,function*(){try{if(e.keys.length<1||e.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return{data:(yield vi(this.fetch,`${this.url}/DeleteVectors`,e,{headers:this.headers}))||{},error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(wi(t))return{data:null,error:t};throw t}})}}class zae{constructor(e,t={},r){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},NA),t),this.fetch=DA(r)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(e){return rt(this,void 0,void 0,function*(){try{return{data:(yield vi(this.fetch,`${this.url}/CreateVectorBucket`,{vectorBucketName:e},{headers:this.headers}))||{},error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(wi(t))return{data:null,error:t};throw t}})}getBucket(e){return rt(this,void 0,void 0,function*(){try{return{data:yield vi(this.fetch,`${this.url}/GetVectorBucket`,{vectorBucketName:e},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(wi(t))return{data:null,error:t};throw t}})}listBuckets(){return rt(this,arguments,void 0,function*(e={}){try{return{data:yield vi(this.fetch,`${this.url}/ListVectorBuckets`,e,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(wi(t))return{data:null,error:t};throw t}})}deleteBucket(e){return rt(this,void 0,void 0,function*(){try{return{data:(yield vi(this.fetch,`${this.url}/DeleteVectorBucket`,{vectorBucketName:e},{headers:this.headers}))||{},error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(wi(t))return{data:null,error:t};throw t}})}}class Kae extends zae{constructor(e,t={}){super(e,t.headers||{},t.fetch)}from(e){return new Vae(this.url,this.headers,e,this.fetch)}}class Vae extends Hae{constructor(e,t,r,i){super(e,t,i),this.vectorBucketName=r}createIndex(e){const t=Object.create(null,{createIndex:{get:()=>super.createIndex}});return rt(this,void 0,void 0,function*(){return t.createIndex.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName}))})}listIndexes(){const e=Object.create(null,{listIndexes:{get:()=>super.listIndexes}});return rt(this,arguments,void 0,function*(t={}){return e.listIndexes.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName}))})}getIndex(e){const t=Object.create(null,{getIndex:{get:()=>super.getIndex}});return rt(this,void 0,void 0,function*(){return t.getIndex.call(this,this.vectorBucketName,e)})}deleteIndex(e){const t=Object.create(null,{deleteIndex:{get:()=>super.deleteIndex}});return rt(this,void 0,void 0,function*(){return t.deleteIndex.call(this,this.vectorBucketName,e)})}index(e){return new Gae(this.url,this.headers,this.vectorBucketName,e,this.fetch)}}class Gae extends Wae{constructor(e,t,r,i,s){super(e,t,s),this.vectorBucketName=r,this.indexName=i}putVectors(e){const t=Object.create(null,{putVectors:{get:()=>super.putVectors}});return rt(this,void 0,void 0,function*(){return t.putVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}getVectors(e){const t=Object.create(null,{getVectors:{get:()=>super.getVectors}});return rt(this,void 0,void 0,function*(){return t.getVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}listVectors(){const e=Object.create(null,{listVectors:{get:()=>super.listVectors}});return rt(this,arguments,void 0,function*(t={}){return e.listVectors.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}queryVectors(e){const t=Object.create(null,{queryVectors:{get:()=>super.queryVectors}});return rt(this,void 0,void 0,function*(){return t.queryVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}deleteVectors(e){const t=Object.create(null,{deleteVectors:{get:()=>super.deleteVectors}});return rt(this,void 0,void 0,function*(){return t.deleteVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}}class Yae extends $ae{constructor(e,t={},r,i){super(e,t,r,i)}from(e){return new Dae(this.url,this.headers,e,this.fetch)}get vectors(){return new Kae(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new Mae(this.url+"/iceberg",this.headers,this.fetch)}}const Xae="2.81.1";let Mh="";typeof Deno<"u"?Mh="deno":typeof document<"u"?Mh="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Mh="react-native":Mh="node";const Zae={"X-Client-Info":`supabase-js-${Mh}/${Xae}`},Qae={headers:Zae},Jae={schema:"public"},ele={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},tle={},rle=n=>n?(...e)=>n(...e):(...e)=>fetch(...e),nle=()=>Headers,ile=(n,e,t)=>{const r=rle(t),i=nle();return async(s,o)=>{var a;const l=(a=await e())!==null&&a!==void 0?a:n;let c=new i(o==null?void 0:o.headers);return c.has("apikey")||c.set("apikey",n),c.has("Authorization")||c.set("Authorization",`Bearer ${l}`),r(s,Object.assign(Object.assign({},o),{headers:c}))}};function sle(n){return n.endsWith("/")?n:n+"/"}function ole(n,e){var t,r;const{db:i,auth:s,realtime:o,global:a}=n,{db:l,auth:c,realtime:h,global:d}=e,p={db:Object.assign(Object.assign({},l),i),auth:Object.assign(Object.assign({},c),s),realtime:Object.assign(Object.assign({},h),o),storage:{},global:Object.assign(Object.assign(Object.assign({},d),a),{headers:Object.assign(Object.assign({},(t=d==null?void 0:d.headers)!==null&&t!==void 0?t:{}),(r=a==null?void 0:a.headers)!==null&&r!==void 0?r:{})}),accessToken:async()=>""};return n.accessToken?p.accessToken=n.accessToken:delete p.accessToken,p}function ale(n){const e=n==null?void 0:n.trim();if(!e)throw new Error("supabaseUrl is required.");if(!e.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(sle(e))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}const I6="2.81.1",Fc=30*1e3,kE=3,Yw=kE*Fc,lle="http://localhost:9999",cle="supabase.auth.token",ule={"X-Client-Info":`gotrue-js/${I6}`},PE="X-Supabase-Api-Version",T6={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},hle=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,fle=10*60*1e3;class $f extends Error{constructor(e,t,r){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=r}}function st(n){return typeof n=="object"&&n!==null&&"__isAuthError"in n}class dle extends $f{constructor(e,t,r){super(e,t,r),this.name="AuthApiError",this.status=t,this.code=r}}function ple(n){return st(n)&&n.name==="AuthApiError"}class tl extends $f{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class Ca extends $f{constructor(e,t,r,i){super(e,r,i),this.name=t,this.status=r}}class Ji extends Ca{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function gle(n){return st(n)&&n.name==="AuthSessionMissingError"}class Rc extends Ca{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Hp extends Ca{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Wp extends Ca{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function mle(n){return st(n)&&n.name==="AuthImplicitGrantRedirectError"}class rR extends Ca{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class RE extends Ca{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function Xw(n){return st(n)&&n.name==="AuthRetryableFetchError"}class nR extends Ca{constructor(e,t,r){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=r}}class OE extends Ca{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const fy="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),iR=` 	
\r=`.split(""),yle=(()=>{const n=new Array(128);for(let e=0;e<n.length;e+=1)n[e]=-1;for(let e=0;e<iR.length;e+=1)n[iR[e].charCodeAt(0)]=-2;for(let e=0;e<fy.length;e+=1)n[fy[e].charCodeAt(0)]=e;return n})();function sR(n,e,t){if(n!==null)for(e.queue=e.queue<<8|n,e.queuedBits+=8;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;t(fy[r]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;t(fy[r]),e.queuedBits-=6}}function C6(n,e,t){const r=yle[n];if(r>-1)for(e.queue=e.queue<<6|r,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(r===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(n)}"`)}}function oR(n){const e=[],t=o=>{e.push(String.fromCodePoint(o))},r={utf8seq:0,codepoint:0},i={queue:0,queuedBits:0},s=o=>{vle(o,r,t)};for(let o=0;o<n.length;o+=1)C6(n.charCodeAt(o),i,s);return e.join("")}function ble(n,e){if(n<=127){e(n);return}else if(n<=2047){e(192|n>>6),e(128|n&63);return}else if(n<=65535){e(224|n>>12),e(128|n>>6&63),e(128|n&63);return}else if(n<=1114111){e(240|n>>18),e(128|n>>12&63),e(128|n>>6&63),e(128|n&63);return}throw new Error(`Unrecognized Unicode codepoint: ${n.toString(16)}`)}function wle(n,e){for(let t=0;t<n.length;t+=1){let r=n.charCodeAt(t);if(r>55295&&r<=56319){const i=(r-55296)*1024&65535;r=(n.charCodeAt(t+1)-56320&65535|i)+65536,t+=1}ble(r,e)}}function vle(n,e,t){if(e.utf8seq===0){if(n<=127){t(n);return}for(let r=1;r<6;r+=1)if(!(n>>7-r&1)){e.utf8seq=r;break}if(e.utf8seq===2)e.codepoint=n&31;else if(e.utf8seq===3)e.codepoint=n&15;else if(e.utf8seq===4)e.codepoint=n&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(n<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|n&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function nu(n){const e=[],t={queue:0,queuedBits:0},r=i=>{e.push(i)};for(let i=0;i<n.length;i+=1)C6(n.charCodeAt(i),t,r);return new Uint8Array(e)}function _le(n){const e=[];return wle(n,t=>e.push(t)),new Uint8Array(e)}function bl(n){const e=[],t={queue:0,queuedBits:0},r=i=>{e.push(i)};return n.forEach(i=>sR(i,t,r)),sR(null,t,r),e.join("")}function Ele(n){return Math.round(Date.now()/1e3)+n}function Sle(){return Symbol("auth-callback")}const ln=()=>typeof window<"u"&&typeof document<"u",za={tested:!1,writable:!1},k6=()=>{if(!ln())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(za.tested)return za.writable;const n=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(n,n),globalThis.localStorage.removeItem(n),za.tested=!0,za.writable=!0}catch{za.tested=!0,za.writable=!1}return za.writable};function Ale(n){const e={},t=new URL(n);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((i,s)=>{e[s]=i})}catch{}return t.searchParams.forEach((r,i)=>{e[i]=r}),e}const P6=n=>n?(...e)=>n(...e):(...e)=>fetch(...e),xle=n=>typeof n=="object"&&n!==null&&"status"in n&&"ok"in n&&"json"in n&&typeof n.json=="function",jc=async(n,e,t)=>{await n.setItem(e,JSON.stringify(t))},Ka=async(n,e)=>{const t=await n.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},Go=async(n,e)=>{await n.removeItem(e)};class fb{constructor(){this.promise=new fb.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}fb.promiseConstructor=Promise;function Zw(n){const e=n.split(".");if(e.length!==3)throw new OE("Invalid JWT structure");for(let r=0;r<e.length;r++)if(!hle.test(e[r]))throw new OE("JWT not in base64url format");return{header:JSON.parse(oR(e[0])),payload:JSON.parse(oR(e[1])),signature:nu(e[2]),raw:{header:e[0],payload:e[1]}}}async function Ile(n){return await new Promise(e=>{setTimeout(()=>e(null),n)})}function Tle(n,e){return new Promise((r,i)=>{(async()=>{for(let s=0;s<1/0;s++)try{const o=await n(s);if(!e(s,null,o)){r(o);return}}catch(o){if(!e(s,o)){i(o);return}}})()})}function Cle(n){return("0"+n.toString(16)).substr(-2)}function kle(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=t.length;let i="";for(let s=0;s<56;s++)i+=t.charAt(Math.floor(Math.random()*r));return i}return crypto.getRandomValues(e),Array.from(e,Cle).join("")}async function Ple(n){const t=new TextEncoder().encode(n),r=await crypto.subtle.digest("SHA-256",t),i=new Uint8Array(r);return Array.from(i).map(s=>String.fromCharCode(s)).join("")}async function Rle(n){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),n;const t=await Ple(n);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Oc(n,e,t=!1){const r=kle();let i=r;t&&(i+="/PASSWORD_RECOVERY"),await jc(n,`${e}-code-verifier`,i);const s=await Rle(r);return[s,r===s?"plain":"s256"]}const Ole=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function Lle(n){const e=n.headers.get(PE);if(!e||!e.match(Ole))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function Nle(n){if(!n)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(n<=e)throw new Error("JWT has expired")}function Dle(n){switch(n){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const $le=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Lc(n){if(!$le.test(n))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function Qw(){const n={};return new Proxy(n,{get:(e,t)=>{if(t==="__isUserNotAvailableProxy")return!0;if(typeof t=="symbol"){const r=t.toString();if(r==="Symbol(Symbol.toPrimitive)"||r==="Symbol(Symbol.toStringTag)"||r==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${t}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function Mle(n,e){return new Proxy(n,{get:(t,r,i)=>{if(r==="__isInsecureUserWarningProxy")return!0;if(typeof r=="symbol"){const s=r.toString();if(s==="Symbol(Symbol.toPrimitive)"||s==="Symbol(Symbol.toStringTag)"||s==="Symbol(util.inspect.custom)"||s==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(t,r,i)}return!e.value&&typeof r=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),e.value=!0),Reflect.get(t,r,i)}})}function aR(n){return JSON.parse(JSON.stringify(n))}const Ga=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),Ble=[502,503,504];async function lR(n){var e;if(!xle(n))throw new RE(Ga(n),0);if(Ble.includes(n.status))throw new RE(Ga(n),n.status);let t;try{t=await n.json()}catch(s){throw new tl(Ga(s),s)}let r;const i=Lle(n);if(i&&i.getTime()>=T6["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?r=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(r=t.error_code),r){if(r==="weak_password")throw new nR(Ga(t),n.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(r==="session_not_found")throw new Ji}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((s,o)=>s&&typeof o=="string",!0))throw new nR(Ga(t),n.status,t.weak_password.reasons);throw new dle(Ga(t),n.status||500,r)}const Ule=(n,e,t,r)=>{const i={method:n,headers:(e==null?void 0:e.headers)||{}};return n==="GET"?i:(i.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),i.body=JSON.stringify(r),Object.assign(Object.assign({},i),t))};async function gt(n,e,t,r){var i;const s=Object.assign({},r==null?void 0:r.headers);s[PE]||(s[PE]=T6["2024-01-01"].name),r!=null&&r.jwt&&(s.Authorization=`Bearer ${r.jwt}`);const o=(i=r==null?void 0:r.query)!==null&&i!==void 0?i:{};r!=null&&r.redirectTo&&(o.redirect_to=r.redirectTo);const a=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",l=await Fle(n,e,t+a,{headers:s,noResolveJson:r==null?void 0:r.noResolveJson},{},r==null?void 0:r.body);return r!=null&&r.xform?r==null?void 0:r.xform(l):{data:Object.assign({},l),error:null}}async function Fle(n,e,t,r,i,s){const o=Ule(e,r,i,s);let a;try{a=await n(t,Object.assign({},o))}catch(l){throw console.error(l),new RE(Ga(l),0)}if(a.ok||await lR(a),r!=null&&r.noResolveJson)return a;try{return await a.json()}catch(l){await lR(l)}}function es(n){var e;let t=null;Hle(n)&&(t=Object.assign({},n),n.expires_at||(t.expires_at=Ele(n.expires_in)));const r=(e=n.user)!==null&&e!==void 0?e:n;return{data:{session:t,user:r},error:null}}function cR(n){const e=es(n);return!e.error&&n.weak_password&&typeof n.weak_password=="object"&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.message&&typeof n.weak_password.message=="string"&&n.weak_password.reasons.reduce((t,r)=>t&&typeof r=="string",!0)&&(e.data.weak_password=n.weak_password),e}function la(n){var e;return{data:{user:(e=n.user)!==null&&e!==void 0?e:n},error:null}}function jle(n){return{data:n,error:null}}function qle(n){const{action_link:e,email_otp:t,hashed_token:r,redirect_to:i,verification_type:s}=n,o=Xu(n,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),a={action_link:e,email_otp:t,hashed_token:r,redirect_to:i,verification_type:s},l=Object.assign({},o);return{data:{properties:a,user:l},error:null}}function uR(n){return n}function Hle(n){return n.access_token&&n.refresh_token&&n.expires_in}const Jw=["global","local","others"];class Wle{constructor({url:e="",headers:t={},fetch:r}){this.url=e,this.headers=t,this.fetch=P6(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(e,t=Jw[0]){if(Jw.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${Jw.join(", ")}`);try{return await gt(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(r){if(st(r))return{data:null,error:r};throw r}}async inviteUserByEmail(e,t={}){try{return await gt(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:la})}catch(r){if(st(r))return{data:{user:null},error:r};throw r}}async generateLink(e){try{const{options:t}=e,r=Xu(e,["options"]),i=Object.assign(Object.assign({},r),t);return"newEmail"in r&&(i.new_email=r==null?void 0:r.newEmail,delete i.newEmail),await gt(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:i,headers:this.headers,xform:qle,redirectTo:t==null?void 0:t.redirectTo})}catch(t){if(st(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await gt(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:la})}catch(t){if(st(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,r,i,s,o,a,l;try{const c={nextPage:null,lastPage:0,total:0},h=await gt(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&r!==void 0?r:"",per_page:(s=(i=e==null?void 0:e.perPage)===null||i===void 0?void 0:i.toString())!==null&&s!==void 0?s:""},xform:uR});if(h.error)throw h.error;const d=await h.json(),p=(o=h.headers.get("x-total-count"))!==null&&o!==void 0?o:0,g=(l=(a=h.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&l!==void 0?l:[];return g.length>0&&(g.forEach(m=>{const E=parseInt(m.split(";")[0].split("=")[1].substring(0,1)),y=JSON.parse(m.split(";")[1].split("=")[1]);c[`${y}Page`]=E}),c.total=parseInt(p)),{data:Object.assign(Object.assign({},d),c),error:null}}catch(c){if(st(c))return{data:{users:[]},error:c};throw c}}async getUserById(e){Lc(e);try{return await gt(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:la})}catch(t){if(st(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){Lc(e);try{return await gt(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:la})}catch(r){if(st(r))return{data:{user:null},error:r};throw r}}async deleteUser(e,t=!1){Lc(e);try{return await gt(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:la})}catch(r){if(st(r))return{data:{user:null},error:r};throw r}}async _listFactors(e){Lc(e.userId);try{const{data:t,error:r}=await gt(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:i=>({data:{factors:i},error:null})});return{data:t,error:r}}catch(t){if(st(t))return{data:null,error:t};throw t}}async _deleteFactor(e){Lc(e.userId),Lc(e.id);try{return{data:await gt(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(st(t))return{data:null,error:t};throw t}}async _listOAuthClients(e){var t,r,i,s,o,a,l;try{const c={nextPage:null,lastPage:0,total:0},h=await gt(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&r!==void 0?r:"",per_page:(s=(i=e==null?void 0:e.perPage)===null||i===void 0?void 0:i.toString())!==null&&s!==void 0?s:""},xform:uR});if(h.error)throw h.error;const d=await h.json(),p=(o=h.headers.get("x-total-count"))!==null&&o!==void 0?o:0,g=(l=(a=h.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&l!==void 0?l:[];return g.length>0&&(g.forEach(m=>{const E=parseInt(m.split(";")[0].split("=")[1].substring(0,1)),y=JSON.parse(m.split(";")[1].split("=")[1]);c[`${y}Page`]=E}),c.total=parseInt(p)),{data:Object.assign(Object.assign({},d),c),error:null}}catch(c){if(st(c))return{data:{clients:[]},error:c};throw c}}async _createOAuthClient(e){try{return await gt(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:e,headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if(st(t))return{data:null,error:t};throw t}}async _getOAuthClient(e){try{return await gt(this.fetch,"GET",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if(st(t))return{data:null,error:t};throw t}}async _updateOAuthClient(e,t){try{return await gt(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${e}`,{body:t,headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(st(r))return{data:null,error:r};throw r}}async _deleteOAuthClient(e){try{return await gt(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(t){if(st(t))return{data:null,error:t};throw t}}async _regenerateOAuthClientSecret(e){try{return await gt(this.fetch,"POST",`${this.url}/admin/oauth/clients/${e}/regenerate_secret`,{headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if(st(t))return{data:null,error:t};throw t}}}function hR(n={}){return{getItem:e=>n[e]||null,setItem:(e,t)=>{n[e]=t},removeItem:e=>{delete n[e]}}}const Nc={debug:!!(globalThis&&k6()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class R6 extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class zle extends R6{}async function Kle(n,e,t){Nc.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",n,e);const r=new globalThis.AbortController;return e>0&&setTimeout(()=>{r.abort(),Nc.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",n)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(n,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async i=>{if(i){Nc.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",n,i.name);try{return await t()}finally{Nc.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",n,i.name)}}else{if(e===0)throw Nc.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",n),new zle(`Acquiring an exclusive Navigator LockManager lock "${n}" immediately failed`);if(Nc.debug)try{const s=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(s,null,"  "))}catch(s){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",s)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}function Vle(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function O6(n){if(!/^0x[a-fA-F0-9]{40}$/.test(n))throw new Error(`@supabase/auth-js: Address "${n}" is invalid.`);return n.toLowerCase()}function Gle(n){return parseInt(n,16)}function Yle(n){const e=new TextEncoder().encode(n);return"0x"+Array.from(e,r=>r.toString(16).padStart(2,"0")).join("")}function Xle(n){var e;const{chainId:t,domain:r,expirationTime:i,issuedAt:s=new Date,nonce:o,notBefore:a,requestId:l,resources:c,scheme:h,uri:d,version:p}=n;{if(!Number.isInteger(t))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${t}`);if(!r)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(o&&o.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${o}`);if(!d)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(p!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${p}`);if(!((e=n.statement)===null||e===void 0)&&e.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${n.statement}`)}const g=O6(n.address),m=h?`${h}://${r}`:r,E=n.statement?`${n.statement}
`:"",y=`${m} wants you to sign in with your Ethereum account:
${g}

${E}`;let S=`URI: ${d}
Version: ${p}
Chain ID: ${t}${o?`
Nonce: ${o}`:""}
Issued At: ${s.toISOString()}`;if(i&&(S+=`
Expiration Time: ${i.toISOString()}`),a&&(S+=`
Not Before: ${a.toISOString()}`),l&&(S+=`
Request ID: ${l}`),c){let b=`
Resources:`;for(const _ of c){if(!_||typeof _!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${_}`);b+=`
- ${_}`}S+=b}return`${y}
${S}`}class Ur extends Error{constructor({message:e,code:t,cause:r,name:i}){var s;super(e,{cause:r}),this.__isWebAuthnError=!0,this.name=(s=i??(r instanceof Error?r.name:void 0))!==null&&s!==void 0?s:"Unknown Error",this.code=t}}class dy extends Ur{constructor(e,t){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t,message:e}),this.name="WebAuthnUnknownError",this.originalError=t}}function Zle({error:n,options:e}){var t,r,i;const{publicKey:s}=e;if(!s)throw Error("options was missing required publicKey property");if(n.name==="AbortError"){if(e.signal instanceof AbortSignal)return new Ur({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:n})}else if(n.name==="ConstraintError"){if(((t=s.authenticatorSelection)===null||t===void 0?void 0:t.requireResidentKey)===!0)return new Ur({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:n});if(e.mediation==="conditional"&&((r=s.authenticatorSelection)===null||r===void 0?void 0:r.userVerification)==="required")return new Ur({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:n});if(((i=s.authenticatorSelection)===null||i===void 0?void 0:i.userVerification)==="required")return new Ur({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:n})}else{if(n.name==="InvalidStateError")return new Ur({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:n});if(n.name==="NotAllowedError")return new Ur({message:n.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n});if(n.name==="NotSupportedError")return s.pubKeyCredParams.filter(a=>a.type==="public-key").length===0?new Ur({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:n}):new Ur({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:n});if(n.name==="SecurityError"){const o=window.location.hostname;if(L6(o)){if(s.rp.id!==o)return new Ur({message:`The RP ID "${s.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:n})}else return new Ur({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:n})}else if(n.name==="TypeError"){if(s.user.id.byteLength<1||s.user.id.byteLength>64)return new Ur({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:n})}else if(n.name==="UnknownError")return new Ur({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:n})}return new Ur({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n})}function Qle({error:n,options:e}){const{publicKey:t}=e;if(!t)throw Error("options was missing required publicKey property");if(n.name==="AbortError"){if(e.signal instanceof AbortSignal)return new Ur({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:n})}else{if(n.name==="NotAllowedError")return new Ur({message:n.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n});if(n.name==="SecurityError"){const r=window.location.hostname;if(L6(r)){if(t.rpId!==r)return new Ur({message:`The RP ID "${t.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:n})}else return new Ur({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:n})}else if(n.name==="UnknownError")return new Ur({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:n})}return new Ur({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n})}class Jle{createNewAbortSignal(){if(this.controller){const t=new Error("Cancelling existing WebAuthn API call for new one");t.name="AbortError",this.controller.abort(t)}const e=new AbortController;return this.controller=e,e.signal}cancelCeremony(){if(this.controller){const e=new Error("Manually cancelling existing WebAuthn API call");e.name="AbortError",this.controller.abort(e),this.controller=void 0}}}const ece=new Jle;function tce(n){if(!n)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(n);const{challenge:e,user:t,excludeCredentials:r}=n,i=Xu(n,["challenge","user","excludeCredentials"]),s=nu(e).buffer,o=Object.assign(Object.assign({},t),{id:nu(t.id).buffer}),a=Object.assign(Object.assign({},i),{challenge:s,user:o});if(r&&r.length>0){a.excludeCredentials=new Array(r.length);for(let l=0;l<r.length;l++){const c=r[l];a.excludeCredentials[l]=Object.assign(Object.assign({},c),{id:nu(c.id).buffer,type:c.type||"public-key",transports:c.transports})}}return a}function rce(n){if(!n)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(n);const{challenge:e,allowCredentials:t}=n,r=Xu(n,["challenge","allowCredentials"]),i=nu(e).buffer,s=Object.assign(Object.assign({},r),{challenge:i});if(t&&t.length>0){s.allowCredentials=new Array(t.length);for(let o=0;o<t.length;o++){const a=t[o];s.allowCredentials[o]=Object.assign(Object.assign({},a),{id:nu(a.id).buffer,type:a.type||"public-key",transports:a.transports})}}return s}function nce(n){var e;if("toJSON"in n&&typeof n.toJSON=="function")return n.toJSON();const t=n;return{id:n.id,rawId:n.id,response:{attestationObject:bl(new Uint8Array(n.response.attestationObject)),clientDataJSON:bl(new Uint8Array(n.response.clientDataJSON))},type:"public-key",clientExtensionResults:n.getClientExtensionResults(),authenticatorAttachment:(e=t.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function ice(n){var e;if("toJSON"in n&&typeof n.toJSON=="function")return n.toJSON();const t=n,r=n.getClientExtensionResults(),i=n.response;return{id:n.id,rawId:n.id,response:{authenticatorData:bl(new Uint8Array(i.authenticatorData)),clientDataJSON:bl(new Uint8Array(i.clientDataJSON)),signature:bl(new Uint8Array(i.signature)),userHandle:i.userHandle?bl(new Uint8Array(i.userHandle)):void 0},type:"public-key",clientExtensionResults:r,authenticatorAttachment:(e=t.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function L6(n){return n==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(n)}function fR(){var n,e;return!!(ln()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((n=navigator==null?void 0:navigator.credentials)===null||n===void 0?void 0:n.create)=="function"&&typeof((e=navigator==null?void 0:navigator.credentials)===null||e===void 0?void 0:e.get)=="function")}async function sce(n){try{const e=await navigator.credentials.create(n);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new dy("Browser returned unexpected credential type",e)}:{data:null,error:new dy("Empty credential response",e)}}catch(e){return{data:null,error:Zle({error:e,options:n})}}}async function oce(n){try{const e=await navigator.credentials.get(n);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new dy("Browser returned unexpected credential type",e)}:{data:null,error:new dy("Empty credential response",e)}}catch(e){return{data:null,error:Qle({error:e,options:n})}}}const ace={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},lce={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function py(...n){const e=i=>i!==null&&typeof i=="object"&&!Array.isArray(i),t=i=>i instanceof ArrayBuffer||ArrayBuffer.isView(i),r={};for(const i of n)if(i)for(const s in i){const o=i[s];if(o!==void 0)if(Array.isArray(o))r[s]=o;else if(t(o))r[s]=o;else if(e(o)){const a=r[s];e(a)?r[s]=py(a,o):r[s]=py(o)}else r[s]=o}return r}function cce(n,e){return py(ace,n,e||{})}function uce(n,e){return py(lce,n,e||{})}class hce{constructor(e){this.client=e,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(e){return this.client.mfa.enroll(Object.assign(Object.assign({},e),{factorType:"webauthn"}))}async _challenge({factorId:e,webauthn:t,friendlyName:r,signal:i},s){try{const{data:o,error:a}=await this.client.mfa.challenge({factorId:e,webauthn:t});if(!o)return{data:null,error:a};const l=i??ece.createNewAbortSignal();if(o.webauthn.type==="create"){const{user:c}=o.webauthn.credential_options.publicKey;c.name||(c.name=`${c.id}:${r}`),c.displayName||(c.displayName=c.name)}switch(o.webauthn.type){case"create":{const c=cce(o.webauthn.credential_options.publicKey,s==null?void 0:s.create),{data:h,error:d}=await sce({publicKey:c,signal:l});return h?{data:{factorId:e,challengeId:o.id,webauthn:{type:o.webauthn.type,credential_response:h}},error:null}:{data:null,error:d}}case"request":{const c=uce(o.webauthn.credential_options.publicKey,s==null?void 0:s.request),{data:h,error:d}=await oce(Object.assign(Object.assign({},o.webauthn.credential_options),{publicKey:c,signal:l}));return h?{data:{factorId:e,challengeId:o.id,webauthn:{type:o.webauthn.type,credential_response:h}},error:null}:{data:null,error:d}}}}catch(o){return st(o)?{data:null,error:o}:{data:null,error:new tl("Unexpected error in challenge",o)}}}async _verify({challengeId:e,factorId:t,webauthn:r}){return this.client.mfa.verify({factorId:t,challengeId:e,webauthn:r})}async _authenticate({factorId:e,webauthn:{rpId:t=typeof window<"u"?window.location.hostname:void 0,rpOrigins:r=typeof window<"u"?[window.location.origin]:void 0,signal:i}={}},s){if(!t)return{data:null,error:new $f("rpId is required for WebAuthn authentication")};try{if(!fR())return{data:null,error:new tl("Browser does not support WebAuthn",null)};const{data:o,error:a}=await this.challenge({factorId:e,webauthn:{rpId:t,rpOrigins:r},signal:i},{request:s});if(!o)return{data:null,error:a};const{webauthn:l}=o;return this._verify({factorId:e,challengeId:o.challengeId,webauthn:{type:l.type,rpId:t,rpOrigins:r,credential_response:l.credential_response}})}catch(o){return st(o)?{data:null,error:o}:{data:null,error:new tl("Unexpected error in authenticate",o)}}}async _register({friendlyName:e,webauthn:{rpId:t=typeof window<"u"?window.location.hostname:void 0,rpOrigins:r=typeof window<"u"?[window.location.origin]:void 0,signal:i}={}},s){if(!t)return{data:null,error:new $f("rpId is required for WebAuthn registration")};try{if(!fR())return{data:null,error:new tl("Browser does not support WebAuthn",null)};const{data:o,error:a}=await this._enroll({friendlyName:e});if(!o)return await this.client.mfa.listFactors().then(h=>{var d;return(d=h.data)===null||d===void 0?void 0:d.all.find(p=>p.factor_type==="webauthn"&&p.friendly_name===e&&p.status!=="unverified")}).then(h=>h?this.client.mfa.unenroll({factorId:h==null?void 0:h.id}):void 0),{data:null,error:a};const{data:l,error:c}=await this._challenge({factorId:o.id,friendlyName:o.friendly_name,webauthn:{rpId:t,rpOrigins:r},signal:i},{create:s});return l?this._verify({factorId:o.id,challengeId:l.challengeId,webauthn:{rpId:t,rpOrigins:r,type:l.webauthn.type,credential_response:l.webauthn.credential_response}}):{data:null,error:c}}catch(o){return st(o)?{data:null,error:o}:{data:null,error:new tl("Unexpected error in register",o)}}}}Vle();const fce={url:lle,storageKey:cle,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:ule,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1};async function dR(n,e,t){return await t()}const Dc={};class Mf{get jwks(){var e,t;return(t=(e=Dc[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&t!==void 0?t:{keys:[]}}set jwks(e){Dc[this.storageKey]=Object.assign(Object.assign({},Dc[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return(t=(e=Dc[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&t!==void 0?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){Dc[this.storageKey]=Object.assign(Object.assign({},Dc[this.storageKey]),{cachedAt:e})}constructor(e){var t,r,i;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const s=Object.assign(Object.assign({},fce),e);if(this.storageKey=s.storageKey,this.instanceID=(t=Mf.nextInstanceID[this.storageKey])!==null&&t!==void 0?t:0,Mf.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!s.debug,typeof s.debug=="function"&&(this.logger=s.debug),this.instanceID>0&&ln()){const o=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(o),this.logDebugMessages&&console.trace(o)}if(this.persistSession=s.persistSession,this.autoRefreshToken=s.autoRefreshToken,this.admin=new Wle({url:s.url,headers:s.headers,fetch:s.fetch}),this.url=s.url,this.headers=s.headers,this.fetch=P6(s.fetch),this.lock=s.lock||dR,this.detectSessionInUrl=s.detectSessionInUrl,this.flowType=s.flowType,this.hasCustomAuthorizationHeader=s.hasCustomAuthorizationHeader,this.throwOnError=s.throwOnError,s.lock?this.lock=s.lock:ln()&&(!((r=globalThis==null?void 0:globalThis.navigator)===null||r===void 0)&&r.locks)?this.lock=Kle:this.lock=dR,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new hce(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this)},this.persistSession?(s.storage?this.storage=s.storage:k6()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=hR(this.memoryStorage)),s.userStorage&&(this.userStorage=s.userStorage)):(this.memoryStorage={},this.storage=hR(this.memoryStorage)),ln()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(o){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",o)}(i=this.broadcastChannel)===null||i===void 0||i.addEventListener("message",async o=>{this._debug("received broadcast notification from other tab or client",o),await this._notifyAllSubscribers(o.data.event,o.data.session,!1)})}this.initialize()}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(e){if(this.throwOnError&&e&&e.error)throw e.error;return e}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${I6}) ${new Date().toISOString()}`}_debug(...e){return this.logDebugMessages&&this.logger(this._logPrefix(),...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{let t={},r="none";if(ln()&&(t=Ale(window.location.href),this._isImplicitGrantCallback(t)?r="implicit":await this._isPKCECallback(t)&&(r="pkce")),ln()&&this.detectSessionInUrl&&r!=="none"){const{data:i,error:s}=await this._getSessionFromURL(t,r);if(s){if(this._debug("#_initialize()","error detecting session from URL",s),mle(s)){const l=(e=s.details)===null||e===void 0?void 0:e.code;if(l==="identity_already_exists"||l==="identity_not_found"||l==="single_identity_not_deletable")return{error:s}}return await this._removeSession(),{error:s}}const{session:o,redirectType:a}=i;return this._debug("#_initialize()","detected session in URL",o,"redirect type",a),await this._saveSession(o),setTimeout(async()=>{a==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",o):await this._notifyAllSubscribers("SIGNED_IN",o)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return st(t)?this._returnResult({error:t}):this._returnResult({error:new tl("Unexpected error during initialization",t)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,r,i;try{const s=await gt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(r=(t=e==null?void 0:e.options)===null||t===void 0?void 0:t.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:(i=e==null?void 0:e.options)===null||i===void 0?void 0:i.captchaToken}},xform:es}),{data:o,error:a}=s;if(a||!o)return this._returnResult({data:{user:null,session:null},error:a});const l=o.session,c=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",l)),this._returnResult({data:{user:c,session:l},error:null})}catch(s){if(st(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}}async signUp(e){var t,r,i;try{let s;if("email"in e){const{email:h,password:d,options:p}=e;let g=null,m=null;this.flowType==="pkce"&&([g,m]=await Oc(this.storage,this.storageKey)),s=await gt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:p==null?void 0:p.emailRedirectTo,body:{email:h,password:d,data:(t=p==null?void 0:p.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:p==null?void 0:p.captchaToken},code_challenge:g,code_challenge_method:m},xform:es})}else if("phone"in e){const{phone:h,password:d,options:p}=e;s=await gt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:h,password:d,data:(r=p==null?void 0:p.data)!==null&&r!==void 0?r:{},channel:(i=p==null?void 0:p.channel)!==null&&i!==void 0?i:"sms",gotrue_meta_security:{captcha_token:p==null?void 0:p.captchaToken}},xform:es})}else throw new Hp("You must provide either an email or phone number and a password");const{data:o,error:a}=s;if(a||!o)return this._returnResult({data:{user:null,session:null},error:a});const l=o.session,c=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",l)),this._returnResult({data:{user:c,session:l},error:null})}catch(s){if(st(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}}async signInWithPassword(e){try{let t;if("email"in e){const{email:s,password:o,options:a}=e;t=await gt(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:s,password:o,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:cR})}else if("phone"in e){const{phone:s,password:o,options:a}=e;t=await gt(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:s,password:o,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:cR})}else throw new Hp("You must provide either an email or phone number and a password");const{data:r,error:i}=t;if(i)return this._returnResult({data:{user:null,session:null},error:i});if(!r||!r.session||!r.user){const s=new Rc;return this._returnResult({data:{user:null,session:null},error:s})}return r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),this._returnResult({data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:i})}catch(t){if(st(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async signInWithOAuth(e){var t,r,i,s;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(r=e.options)===null||r===void 0?void 0:r.scopes,queryParams:(i=e.options)===null||i===void 0?void 0:i.queryParams,skipBrowserRedirect:(s=e.options)===null||s===void 0?void 0:s.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;switch(t){case"ethereum":return await this.signInWithEthereum(e);case"solana":return await this.signInWithSolana(e);default:throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}}async signInWithEthereum(e){var t,r,i,s,o,a,l,c,h,d,p;let g,m;if("message"in e)g=e.message,m=e.signature;else{const{chain:E,wallet:y,statement:S,options:b}=e;let _;if(ln())if(typeof y=="object")_=y;else{const P=window;if("ethereum"in P&&typeof P.ethereum=="object"&&"request"in P.ethereum&&typeof P.ethereum.request=="function")_=P.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof y!="object"||!(b!=null&&b.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");_=y}const I=new URL((t=b==null?void 0:b.url)!==null&&t!==void 0?t:window.location.href),x=await _.request({method:"eth_requestAccounts"}).then(P=>P).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!x||x.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const $=O6(x[0]);let U=(r=b==null?void 0:b.signInWithEthereum)===null||r===void 0?void 0:r.chainId;if(!U){const P=await _.request({method:"eth_chainId"});U=Gle(P)}const O={domain:I.host,address:$,statement:S,uri:I.href,version:"1",chainId:U,nonce:(i=b==null?void 0:b.signInWithEthereum)===null||i===void 0?void 0:i.nonce,issuedAt:(o=(s=b==null?void 0:b.signInWithEthereum)===null||s===void 0?void 0:s.issuedAt)!==null&&o!==void 0?o:new Date,expirationTime:(a=b==null?void 0:b.signInWithEthereum)===null||a===void 0?void 0:a.expirationTime,notBefore:(l=b==null?void 0:b.signInWithEthereum)===null||l===void 0?void 0:l.notBefore,requestId:(c=b==null?void 0:b.signInWithEthereum)===null||c===void 0?void 0:c.requestId,resources:(h=b==null?void 0:b.signInWithEthereum)===null||h===void 0?void 0:h.resources};g=Xle(O),m=await _.request({method:"personal_sign",params:[Yle(g),$]})}try{const{data:E,error:y}=await gt(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:g,signature:m},!((d=e.options)===null||d===void 0)&&d.captchaToken?{gotrue_meta_security:{captcha_token:(p=e.options)===null||p===void 0?void 0:p.captchaToken}}:null),xform:es});if(y)throw y;if(!E||!E.session||!E.user){const S=new Rc;return this._returnResult({data:{user:null,session:null},error:S})}return E.session&&(await this._saveSession(E.session),await this._notifyAllSubscribers("SIGNED_IN",E.session)),this._returnResult({data:Object.assign({},E),error:y})}catch(E){if(st(E))return this._returnResult({data:{user:null,session:null},error:E});throw E}}async signInWithSolana(e){var t,r,i,s,o,a,l,c,h,d,p,g;let m,E;if("message"in e)m=e.message,E=e.signature;else{const{chain:y,wallet:S,statement:b,options:_}=e;let I;if(ln())if(typeof S=="object")I=S;else{const $=window;if("solana"in $&&typeof $.solana=="object"&&("signIn"in $.solana&&typeof $.solana.signIn=="function"||"signMessage"in $.solana&&typeof $.solana.signMessage=="function"))I=$.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof S!="object"||!(_!=null&&_.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");I=S}const x=new URL((t=_==null?void 0:_.url)!==null&&t!==void 0?t:window.location.href);if("signIn"in I&&I.signIn){const $=await I.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},_==null?void 0:_.signInWithSolana),{version:"1",domain:x.host,uri:x.href}),b?{statement:b}:null));let U;if(Array.isArray($)&&$[0]&&typeof $[0]=="object")U=$[0];else if($&&typeof $=="object"&&"signedMessage"in $&&"signature"in $)U=$;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in U&&"signature"in U&&(typeof U.signedMessage=="string"||U.signedMessage instanceof Uint8Array)&&U.signature instanceof Uint8Array)m=typeof U.signedMessage=="string"?U.signedMessage:new TextDecoder().decode(U.signedMessage),E=U.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in I)||typeof I.signMessage!="function"||!("publicKey"in I)||typeof I!="object"||!I.publicKey||!("toBase58"in I.publicKey)||typeof I.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");m=[`${x.host} wants you to sign in with your Solana account:`,I.publicKey.toBase58(),...b?["",b,""]:[""],"Version: 1",`URI: ${x.href}`,`Issued At: ${(i=(r=_==null?void 0:_.signInWithSolana)===null||r===void 0?void 0:r.issuedAt)!==null&&i!==void 0?i:new Date().toISOString()}`,...!((s=_==null?void 0:_.signInWithSolana)===null||s===void 0)&&s.notBefore?[`Not Before: ${_.signInWithSolana.notBefore}`]:[],...!((o=_==null?void 0:_.signInWithSolana)===null||o===void 0)&&o.expirationTime?[`Expiration Time: ${_.signInWithSolana.expirationTime}`]:[],...!((a=_==null?void 0:_.signInWithSolana)===null||a===void 0)&&a.chainId?[`Chain ID: ${_.signInWithSolana.chainId}`]:[],...!((l=_==null?void 0:_.signInWithSolana)===null||l===void 0)&&l.nonce?[`Nonce: ${_.signInWithSolana.nonce}`]:[],...!((c=_==null?void 0:_.signInWithSolana)===null||c===void 0)&&c.requestId?[`Request ID: ${_.signInWithSolana.requestId}`]:[],...!((d=(h=_==null?void 0:_.signInWithSolana)===null||h===void 0?void 0:h.resources)===null||d===void 0)&&d.length?["Resources",..._.signInWithSolana.resources.map(U=>`- ${U}`)]:[]].join(`
`);const $=await I.signMessage(new TextEncoder().encode(m),"utf8");if(!$||!($ instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");E=$}}try{const{data:y,error:S}=await gt(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:m,signature:bl(E)},!((p=e.options)===null||p===void 0)&&p.captchaToken?{gotrue_meta_security:{captcha_token:(g=e.options)===null||g===void 0?void 0:g.captchaToken}}:null),xform:es});if(S)throw S;if(!y||!y.session||!y.user){const b=new Rc;return this._returnResult({data:{user:null,session:null},error:b})}return y.session&&(await this._saveSession(y.session),await this._notifyAllSubscribers("SIGNED_IN",y.session)),this._returnResult({data:Object.assign({},y),error:S})}catch(y){if(st(y))return this._returnResult({data:{user:null,session:null},error:y});throw y}}async _exchangeCodeForSession(e){const t=await Ka(this.storage,`${this.storageKey}-code-verifier`),[r,i]=(t??"").split("/");try{const{data:s,error:o}=await gt(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:es});if(await Go(this.storage,`${this.storageKey}-code-verifier`),o)throw o;if(!s||!s.session||!s.user){const a=new Rc;return this._returnResult({data:{user:null,session:null,redirectType:null},error:a})}return s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),this._returnResult({data:Object.assign(Object.assign({},s),{redirectType:i??null}),error:o})}catch(s){if(st(s))return this._returnResult({data:{user:null,session:null,redirectType:null},error:s});throw s}}async signInWithIdToken(e){try{const{options:t,provider:r,token:i,access_token:s,nonce:o}=e,a=await gt(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:i,access_token:s,nonce:o,gotrue_meta_security:{captcha_token:t==null?void 0:t.captchaToken}},xform:es}),{data:l,error:c}=a;if(c)return this._returnResult({data:{user:null,session:null},error:c});if(!l||!l.session||!l.user){const h=new Rc;return this._returnResult({data:{user:null,session:null},error:h})}return l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),this._returnResult({data:l,error:c})}catch(t){if(st(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async signInWithOtp(e){var t,r,i,s,o;try{if("email"in e){const{email:a,options:l}=e;let c=null,h=null;this.flowType==="pkce"&&([c,h]=await Oc(this.storage,this.storageKey));const{error:d}=await gt(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:a,data:(t=l==null?void 0:l.data)!==null&&t!==void 0?t:{},create_user:(r=l==null?void 0:l.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},code_challenge:c,code_challenge_method:h},redirectTo:l==null?void 0:l.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:d})}if("phone"in e){const{phone:a,options:l}=e,{data:c,error:h}=await gt(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:a,data:(i=l==null?void 0:l.data)!==null&&i!==void 0?i:{},create_user:(s=l==null?void 0:l.shouldCreateUser)!==null&&s!==void 0?s:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},channel:(o=l==null?void 0:l.channel)!==null&&o!==void 0?o:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:c==null?void 0:c.message_id},error:h})}throw new Hp("You must provide either an email or phone number.")}catch(a){if(st(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async verifyOtp(e){var t,r;try{let i,s;"options"in e&&(i=(t=e.options)===null||t===void 0?void 0:t.redirectTo,s=(r=e.options)===null||r===void 0?void 0:r.captchaToken);const{data:o,error:a}=await gt(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:s}}),redirectTo:i,xform:es});if(a)throw a;if(!o)throw new Error("An error occurred on token verification.");const l=o.session,c=o.user;return l!=null&&l.access_token&&(await this._saveSession(l),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",l)),this._returnResult({data:{user:c,session:l},error:null})}catch(i){if(st(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signInWithSSO(e){var t,r,i,s,o;try{let a=null,l=null;this.flowType==="pkce"&&([a,l]=await Oc(this.storage,this.storageKey));const c=await gt(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(r=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&r!==void 0?r:void 0}),!((i=e==null?void 0:e.options)===null||i===void 0)&&i.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:a,code_challenge_method:l}),headers:this.headers,xform:jle});return!((s=c.data)===null||s===void 0)&&s.url&&ln()&&!(!((o=e.options)===null||o===void 0)&&o.skipBrowserRedirect)&&window.location.assign(c.data.url),this._returnResult(c)}catch(a){if(st(a))return this._returnResult({data:null,error:a});throw a}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:r}=e;if(r)throw r;if(!t)throw new Ji;const{error:i}=await gt(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return this._returnResult({data:{user:null,session:null},error:i})})}catch(e){if(st(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:r,type:i,options:s}=e,{error:o}=await gt(this.fetch,"POST",t,{headers:this.headers,body:{email:r,type:i,gotrue_meta_security:{captcha_token:s==null?void 0:s.captchaToken}},redirectTo:s==null?void 0:s.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:o})}else if("phone"in e){const{phone:r,type:i,options:s}=e,{data:o,error:a}=await gt(this.fetch,"POST",t,{headers:this.headers,body:{phone:r,type:i,gotrue_meta_security:{captcha_token:s==null?void 0:s.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:o==null?void 0:o.message_id},error:a})}throw new Hp("You must provide either an email or phone number and a type")}catch(t){if(st(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const r=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),i=(async()=>(await r,await t()))();return this.pendingInLock.push((async()=>{try{await i}catch{}})()),i}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const r=t();for(this.pendingInLock.push((async()=>{try{await r}catch{}})()),await r;this.pendingInLock.length;){const i=[...this.pendingInLock];await Promise.all(i),this.pendingInLock.splice(0,i.length)}return await r}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await Ka(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const r=e.expires_at?e.expires_at*1e3-Date.now()<Yw:!1;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",e.expires_at),!r){if(this.userStorage){const o=await Ka(this.userStorage,this.storageKey+"-user");o!=null&&o.user?e.user=o.user:e.user=Qw()}if(this.storage.isServer&&e.user&&!e.user.__isUserNotAvailableProxy){const o={value:this.suppressGetSessionWarning};e.user=Mle(e.user,o),o.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:e},error:null}}const{data:i,error:s}=await this._callRefreshToken(e.refresh_token);return s?this._returnResult({data:{session:null},error:s}):this._returnResult({data:{session:i},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await gt(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:la}):await this._useSession(async t=>{var r,i,s;const{data:o,error:a}=t;if(a)throw a;return!(!((r=o.session)===null||r===void 0)&&r.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Ji}:await gt(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(s=(i=o.session)===null||i===void 0?void 0:i.access_token)!==null&&s!==void 0?s:void 0,xform:la})})}catch(t){if(st(t))return gle(t)&&(await this._removeSession(),await Go(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:t});throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async r=>{const{data:i,error:s}=r;if(s)throw s;if(!i.session)throw new Ji;const o=i.session;let a=null,l=null;this.flowType==="pkce"&&e.email!=null&&([a,l]=await Oc(this.storage,this.storageKey));const{data:c,error:h}=await gt(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t==null?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:a,code_challenge_method:l}),jwt:o.access_token,xform:la});if(h)throw h;return o.user=c.user,await this._saveSession(o),await this._notifyAllSubscribers("USER_UPDATED",o),this._returnResult({data:{user:o.user},error:null})})}catch(r){if(st(r))return this._returnResult({data:{user:null},error:r});throw r}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Ji;const t=Date.now()/1e3;let r=t,i=!0,s=null;const{payload:o}=Zw(e.access_token);if(o.exp&&(r=o.exp,i=r<=t),i){const{data:a,error:l}=await this._callRefreshToken(e.refresh_token);if(l)return this._returnResult({data:{user:null,session:null},error:l});if(!a)return{data:{user:null,session:null},error:null};s=a}else{const{data:a,error:l}=await this._getUser(e.access_token);if(l)throw l;s={access_token:e.access_token,refresh_token:e.refresh_token,user:a.user,token_type:"bearer",expires_in:r-t,expires_at:r},await this._saveSession(s),await this._notifyAllSubscribers("SIGNED_IN",s)}return this._returnResult({data:{user:s.user,session:s},error:null})}catch(t){if(st(t))return this._returnResult({data:{session:null,user:null},error:t});throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var r;if(!e){const{data:o,error:a}=t;if(a)throw a;e=(r=o.session)!==null&&r!==void 0?r:void 0}if(!(e!=null&&e.refresh_token))throw new Ji;const{data:i,error:s}=await this._callRefreshToken(e.refresh_token);return s?this._returnResult({data:{user:null,session:null},error:s}):i?this._returnResult({data:{user:i.user,session:i},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(t){if(st(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async _getSessionFromURL(e,t){try{if(!ln())throw new Wp("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Wp(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new rR("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Wp("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new rR("No code detected.");const{data:b,error:_}=await this._exchangeCodeForSession(e.code);if(_)throw _;const I=new URL(window.location.href);return I.searchParams.delete("code"),window.history.replaceState(window.history.state,"",I.toString()),{data:{session:b.session,redirectType:null},error:null}}const{provider_token:r,provider_refresh_token:i,access_token:s,refresh_token:o,expires_in:a,expires_at:l,token_type:c}=e;if(!s||!a||!o||!c)throw new Wp("No session defined in URL");const h=Math.round(Date.now()/1e3),d=parseInt(a);let p=h+d;l&&(p=parseInt(l));const g=p-h;g*1e3<=Fc&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${g}s, should have been closer to ${d}s`);const m=p-d;h-m>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",m,p,h):h-m<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",m,p,h);const{data:E,error:y}=await this._getUser(s);if(y)throw y;const S={provider_token:r,provider_refresh_token:i,access_token:s,expires_in:d,expires_at:p,refresh_token:o,token_type:c,user:E.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:S,redirectType:e.type},error:null})}catch(r){if(st(r))return this._returnResult({data:{session:null,redirectType:null},error:r});throw r}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await Ka(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var r;const{data:i,error:s}=t;if(s)return this._returnResult({error:s});const o=(r=i.session)===null||r===void 0?void 0:r.access_token;if(o){const{error:a}=await this.admin.signOut(o,e);if(a&&!(ple(a)&&(a.status===404||a.status===401||a.status===403)))return this._returnResult({error:a})}return e!=="others"&&(await this._removeSession(),await Go(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(e){const t=Sle(),r={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,r),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession(async t=>{var r,i;try{const{data:{session:s},error:o}=t;if(o)throw o;await((r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",s)),this._debug("INITIAL_SESSION","callback id",e,"session",s)}catch(s){await((i=this.stateChangeEmitters.get(e))===null||i===void 0?void 0:i.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",s),console.error(s)}})}async resetPasswordForEmail(e,t={}){let r=null,i=null;this.flowType==="pkce"&&([r,i]=await Oc(this.storage,this.storageKey,!0));try{return await gt(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:i,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(s){if(st(s))return this._returnResult({data:null,error:s});throw s}}async getUserIdentities(){var e;try{const{data:t,error:r}=await this.getUser();if(r)throw r;return this._returnResult({data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null})}catch(t){if(st(t))return this._returnResult({data:null,error:t});throw t}}async linkIdentity(e){return"token"in e?this.linkIdentityIdToken(e):this.linkIdentityOAuth(e)}async linkIdentityOAuth(e){var t;try{const{data:r,error:i}=await this._useSession(async s=>{var o,a,l,c,h;const{data:d,error:p}=s;if(p)throw p;const g=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(o=e.options)===null||o===void 0?void 0:o.redirectTo,scopes:(a=e.options)===null||a===void 0?void 0:a.scopes,queryParams:(l=e.options)===null||l===void 0?void 0:l.queryParams,skipBrowserRedirect:!0});return await gt(this.fetch,"GET",g,{headers:this.headers,jwt:(h=(c=d.session)===null||c===void 0?void 0:c.access_token)!==null&&h!==void 0?h:void 0})});if(i)throw i;return ln()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(r==null?void 0:r.url),this._returnResult({data:{provider:e.provider,url:r==null?void 0:r.url},error:null})}catch(r){if(st(r))return this._returnResult({data:{provider:e.provider,url:null},error:r});throw r}}async linkIdentityIdToken(e){return await this._useSession(async t=>{var r;try{const{error:i,data:{session:s}}=t;if(i)throw i;const{options:o,provider:a,token:l,access_token:c,nonce:h}=e,d=await gt(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(r=s==null?void 0:s.access_token)!==null&&r!==void 0?r:void 0,body:{provider:a,id_token:l,access_token:c,nonce:h,link_identity:!0,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:es}),{data:p,error:g}=d;return g?this._returnResult({data:{user:null,session:null},error:g}):!p||!p.session||!p.user?this._returnResult({data:{user:null,session:null},error:new Rc}):(p.session&&(await this._saveSession(p.session),await this._notifyAllSubscribers("USER_UPDATED",p.session)),this._returnResult({data:p,error:g}))}catch(i){if(st(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}})}async unlinkIdentity(e){try{return await this._useSession(async t=>{var r,i;const{data:s,error:o}=t;if(o)throw o;return await gt(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(i=(r=s.session)===null||r===void 0?void 0:r.access_token)!==null&&i!==void 0?i:void 0})})}catch(t){if(st(t))return this._returnResult({data:null,error:t});throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const r=Date.now();return await Tle(async i=>(i>0&&await Ile(200*Math.pow(2,i-1)),this._debug(t,"refreshing attempt",i),await gt(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:es})),(i,s)=>{const o=200*Math.pow(2,i);return s&&Xw(s)&&Date.now()+o-r<Fc})}catch(r){if(this._debug(t,"error",r),st(r))return this._returnResult({data:{session:null,user:null},error:r});throw r}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const r=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",r),ln()&&!t.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e,t;const r="#_recoverAndRefresh()";this._debug(r,"begin");try{const i=await Ka(this.storage,this.storageKey);if(i&&this.userStorage){let o=await Ka(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!o&&(o={user:i.user},await jc(this.userStorage,this.storageKey+"-user",o)),i.user=(e=o==null?void 0:o.user)!==null&&e!==void 0?e:Qw()}else if(i&&!i.user&&!i.user){const o=await Ka(this.storage,this.storageKey+"-user");o&&(o!=null&&o.user)?(i.user=o.user,await Go(this.storage,this.storageKey+"-user"),await jc(this.storage,this.storageKey,i)):i.user=Qw()}if(this._debug(r,"session from storage",i),!this._isValidSession(i)){this._debug(r,"session is not valid"),i!==null&&await this._removeSession();return}const s=((t=i.expires_at)!==null&&t!==void 0?t:1/0)*1e3-Date.now()<Yw;if(this._debug(r,`session has${s?"":" not"} expired with margin of ${Yw}s`),s){if(this.autoRefreshToken&&i.refresh_token){const{error:o}=await this._callRefreshToken(i.refresh_token);o&&(console.error(o),Xw(o)||(this._debug(r,"refresh failed with a non-retryable error, removing the session",o),await this._removeSession()))}}else if(i.user&&i.user.__isUserNotAvailableProxy===!0)try{const{data:o,error:a}=await this._getUser(i.access_token);!a&&(o!=null&&o.user)?(i.user=o.user,await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)):this._debug(r,"could not get user data, skipping SIGNED_IN notification")}catch(o){console.error("Error getting user data:",o),this._debug(r,"error getting user data, skipping SIGNED_IN notification",o)}else await this._notifyAllSubscribers("SIGNED_IN",i)}catch(i){this._debug(r,"error",i),console.error(i);return}finally{this._debug(r,"end")}}async _callRefreshToken(e){var t,r;if(!e)throw new Ji;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const i=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(i,"begin");try{this.refreshingDeferred=new fb;const{data:s,error:o}=await this._refreshAccessToken(e);if(o)throw o;if(!s.session)throw new Ji;await this._saveSession(s.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",s.session);const a={data:s.session,error:null};return this.refreshingDeferred.resolve(a),a}catch(s){if(this._debug(i,"error",s),st(s)){const o={data:null,error:s};return Xw(s)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(o),o}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(s),s}finally{this.refreshingDeferred=null,this._debug(i,"end")}}async _notifyAllSubscribers(e,t,r=!0){const i=`#_notifyAllSubscribers(${e})`;this._debug(i,"begin",t,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:t});const s=[],o=Array.from(this.stateChangeEmitters.values()).map(async a=>{try{await a.callback(e,t)}catch(l){s.push(l)}});if(await Promise.all(o),s.length>0){for(let a=0;a<s.length;a+=1)console.error(s[a]);throw s[0]}}finally{this._debug(i,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const t=Object.assign({},e),r=t.user&&t.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!r&&t.user&&await jc(this.userStorage,this.storageKey+"-user",{user:t.user});const i=Object.assign({},t);delete i.user;const s=aR(i);await jc(this.storage,this.storageKey,s)}else{const i=aR(t);await jc(this.storage,this.storageKey,i)}}async _removeSession(){this._debug("#_removeSession()"),await Go(this.storage,this.storageKey),await Go(this.storage,this.storageKey+"-code-verifier"),await Go(this.storage,this.storageKey+"-user"),this.userStorage&&await Go(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&ln()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),Fc);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:r}}=t;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const i=Math.floor((r.expires_at*1e3-e)/Fc);this._debug("#_autoRefreshTokenTick()",`access token expires in ${i} ticks, a tick lasts ${Fc}ms, refresh threshold is ${kE} ticks`),i<=kE&&await this._callRefreshToken(r.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof R6)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!ln()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,r){const i=[`provider=${encodeURIComponent(t)}`];if(r!=null&&r.redirectTo&&i.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),r!=null&&r.scopes&&i.push(`scopes=${encodeURIComponent(r.scopes)}`),this.flowType==="pkce"){const[s,o]=await Oc(this.storage,this.storageKey),a=new URLSearchParams({code_challenge:`${encodeURIComponent(s)}`,code_challenge_method:`${encodeURIComponent(o)}`});i.push(a.toString())}if(r!=null&&r.queryParams){const s=new URLSearchParams(r.queryParams);i.push(s.toString())}return r!=null&&r.skipBrowserRedirect&&i.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${e}?${i.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var r;const{data:i,error:s}=t;return s?this._returnResult({data:null,error:s}):await gt(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(r=i==null?void 0:i.session)===null||r===void 0?void 0:r.access_token})})}catch(t){if(st(t))return this._returnResult({data:null,error:t});throw t}}async _enroll(e){try{return await this._useSession(async t=>{var r,i;const{data:s,error:o}=t;if(o)return this._returnResult({data:null,error:o});const a=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:e.factorType==="totp"?{issuer:e.issuer}:{}),{data:l,error:c}=await gt(this.fetch,"POST",`${this.url}/factors`,{body:a,headers:this.headers,jwt:(r=s==null?void 0:s.session)===null||r===void 0?void 0:r.access_token});return c?this._returnResult({data:null,error:c}):(e.factorType==="totp"&&l.type==="totp"&&(!((i=l==null?void 0:l.totp)===null||i===void 0)&&i.qr_code)&&(l.totp.qr_code=`data:image/svg+xml;utf-8,${l.totp.qr_code}`),this._returnResult({data:l,error:null}))})}catch(t){if(st(t))return this._returnResult({data:null,error:t});throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:i,error:s}=t;if(s)return this._returnResult({data:null,error:s});const o=Object.assign({challenge_id:e.challengeId},"webauthn"in e?{webauthn:Object.assign(Object.assign({},e.webauthn),{credential_response:e.webauthn.type==="create"?nce(e.webauthn.credential_response):ice(e.webauthn.credential_response)})}:{code:e.code}),{data:a,error:l}=await gt(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:o,headers:this.headers,jwt:(r=i==null?void 0:i.session)===null||r===void 0?void 0:r.access_token});return l?this._returnResult({data:null,error:l}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+a.expires_in},a)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",a),this._returnResult({data:a,error:l}))})}catch(t){if(st(t))return this._returnResult({data:null,error:t});throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:i,error:s}=t;if(s)return this._returnResult({data:null,error:s});const o=await gt(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:e,headers:this.headers,jwt:(r=i==null?void 0:i.session)===null||r===void 0?void 0:r.access_token});if(o.error)return o;const{data:a}=o;if(a.type!=="webauthn")return{data:a,error:null};switch(a.webauthn.type){case"create":return{data:Object.assign(Object.assign({},a),{webauthn:Object.assign(Object.assign({},a.webauthn),{credential_options:Object.assign(Object.assign({},a.webauthn.credential_options),{publicKey:tce(a.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},a),{webauthn:Object.assign(Object.assign({},a.webauthn),{credential_options:Object.assign(Object.assign({},a.webauthn.credential_options),{publicKey:rce(a.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(t){if(st(t))return this._returnResult({data:null,error:t});throw t}})}async _challengeAndVerify(e){const{data:t,error:r}=await this._challenge({factorId:e.factorId});return r?this._returnResult({data:null,error:r}):await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){var e;const{data:{user:t},error:r}=await this.getUser();if(r)return{data:null,error:r};const i={all:[],phone:[],totp:[],webauthn:[]};for(const s of(e=t==null?void 0:t.factors)!==null&&e!==void 0?e:[])i.all.push(s),s.status==="verified"&&i[s.factor_type].push(s);return{data:i,error:null}}async _getAuthenticatorAssuranceLevel(){var e,t;const{data:{session:r},error:i}=await this.getSession();if(i)return this._returnResult({data:null,error:i});if(!r)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:s}=Zw(r.access_token);let o=null;s.aal&&(o=s.aal);let a=o;((t=(e=r.user.factors)===null||e===void 0?void 0:e.filter(h=>h.status==="verified"))!==null&&t!==void 0?t:[]).length>0&&(a="aal2");const c=s.amr||[];return{data:{currentLevel:o,nextLevel:a,currentAuthenticationMethods:c},error:null}}async _getAuthorizationDetails(e){try{return await this._useSession(async t=>{const{data:{session:r},error:i}=t;return i?this._returnResult({data:null,error:i}):r?await gt(this.fetch,"GET",`${this.url}/oauth/authorizations/${e}`,{headers:this.headers,jwt:r.access_token,xform:s=>({data:s,error:null})}):this._returnResult({data:null,error:new Ji})})}catch(t){if(st(t))return this._returnResult({data:null,error:t});throw t}}async _approveAuthorization(e,t){try{return await this._useSession(async r=>{const{data:{session:i},error:s}=r;if(s)return this._returnResult({data:null,error:s});if(!i)return this._returnResult({data:null,error:new Ji});const o=await gt(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:i.access_token,body:{action:"approve"},xform:a=>({data:a,error:null})});return o.data&&o.data.redirect_url&&ln()&&!(t!=null&&t.skipBrowserRedirect)&&window.location.assign(o.data.redirect_url),o})}catch(r){if(st(r))return this._returnResult({data:null,error:r});throw r}}async _denyAuthorization(e,t){try{return await this._useSession(async r=>{const{data:{session:i},error:s}=r;if(s)return this._returnResult({data:null,error:s});if(!i)return this._returnResult({data:null,error:new Ji});const o=await gt(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:i.access_token,body:{action:"deny"},xform:a=>({data:a,error:null})});return o.data&&o.data.redirect_url&&ln()&&!(t!=null&&t.skipBrowserRedirect)&&window.location.assign(o.data.redirect_url),o})}catch(r){if(st(r))return this._returnResult({data:null,error:r});throw r}}async fetchJwk(e,t={keys:[]}){let r=t.keys.find(a=>a.kid===e);if(r)return r;const i=Date.now();if(r=this.jwks.keys.find(a=>a.kid===e),r&&this.jwks_cached_at+fle>i)return r;const{data:s,error:o}=await gt(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(o)throw o;return!s.keys||s.keys.length===0||(this.jwks=s,this.jwks_cached_at=i,r=s.keys.find(a=>a.kid===e),!r)?null:r}async getClaims(e,t={}){try{let r=e;if(!r){const{data:g,error:m}=await this.getSession();if(m||!g.session)return this._returnResult({data:null,error:m});r=g.session.access_token}const{header:i,payload:s,signature:o,raw:{header:a,payload:l}}=Zw(r);t!=null&&t.allowExpired||Nle(s.exp);const c=!i.alg||i.alg.startsWith("HS")||!i.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(i.kid,t!=null&&t.keys?{keys:t.keys}:t==null?void 0:t.jwks);if(!c){const{error:g}=await this.getUser(r);if(g)throw g;return{data:{claims:s,header:i,signature:o},error:null}}const h=Dle(i.alg),d=await crypto.subtle.importKey("jwk",c,h,!0,["verify"]);if(!await crypto.subtle.verify(h,d,o,_le(`${a}.${l}`)))throw new OE("Invalid JWT signature");return{data:{claims:s,header:i,signature:o},error:null}}catch(r){if(st(r))return this._returnResult({data:null,error:r});throw r}}}Mf.nextInstanceID={};const dce=Mf;class pce extends dce{constructor(e){super(e)}}class gce{constructor(e,t,r){var i,s,o;this.supabaseUrl=e,this.supabaseKey=t;const a=ale(e);if(!t)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",a),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",a),this.storageUrl=new URL("storage/v1",a),this.functionsUrl=new URL("functions/v1",a);const l=`sb-${a.hostname.split(".")[0]}-auth-token`,c={db:Jae,realtime:tle,auth:Object.assign(Object.assign({},ele),{storageKey:l}),global:Qae},h=ole(r??{},c);this.storageKey=(i=h.auth.storageKey)!==null&&i!==void 0?i:"",this.headers=(s=h.global.headers)!==null&&s!==void 0?s:{},h.accessToken?(this.accessToken=h.accessToken,this.auth=new Proxy({},{get:(d,p)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(p)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((o=h.auth)!==null&&o!==void 0?o:{},this.headers,h.global.fetch),this.fetch=ile(t,this._getAccessToken.bind(this),h.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},h.realtime)),this.accessToken&&this.accessToken().then(d=>this.realtime.setAuth(d)).catch(d=>console.warn("Failed to set initial Realtime auth token:",d)),this.rest=new lae(new URL("rest/v1",a).href,{headers:this.headers,schema:h.db.schema,fetch:this.fetch}),this.storage=new Yae(this.storageUrl.href,this.headers,this.fetch,r==null?void 0:r.storage),h.accessToken||this._listenForAuthEvents()}get functions(){return new sae(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},r={head:!1,get:!1,count:void 0}){return this.rest.rpc(e,t,r)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var e,t;if(this.accessToken)return await this.accessToken();const{data:r}=await this.auth.getSession();return(t=(e=r.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:this.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:i,userStorage:s,storageKey:o,flowType:a,lock:l,debug:c,throwOnError:h},d,p){const g={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new pce({url:this.authUrl.href,headers:Object.assign(Object.assign({},g),d),storageKey:o,autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:i,userStorage:s,flowType:a,lock:l,debug:c,throwOnError:h,fetch:p,hasCustomAuthorizationHeader:Object.keys(this.headers).some(m=>m.toLowerCase()==="authorization")})}_initRealtimeClient(e){return new xae(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,r)=>{this._handleTokenChanged(t,"CLIENT",r==null?void 0:r.access_token)})}_handleTokenChanged(e,t,r){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==r?(this.changedAccessToken=r,this.realtime.setAuth(r)):e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const mce=(n,e,t)=>new gce(n,e,t);function yce(){if(typeof window<"u"||typeof process>"u")return!1;const n=process.version;if(n==null)return!1;const e=n.match(/^v(\d+)\./);return e?parseInt(e[1],10)<=18:!1}yce()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const Yo={broadcast:"broadcast",join:"join",sdp:"sdp"},bce=Ey({init:n=>mce(n.appId,n.supabaseKey),subscribe:(n,e,t,r)=>{const i=[],s=(l,c)=>{const h=n.channel(l);h.subscribe(async d=>{if(d==="SUBSCRIBED"){if(a){n.removeChannel(h);return}return i.push(h),c(h)}d!=="CLOSED"&&(await n.removeChannel(h),setTimeout(()=>s(l,c),999))})},o=(l,c)=>s(l,h=>h.send({type:Yo.broadcast,event:Yo.sdp,payload:c}));s(t,l=>l.on(Yo.broadcast,{event:Yo.sdp},({payload:c})=>r(t,c,o))),s(e,l=>l.on(Yo.broadcast,{event:Yo.join},({payload:c})=>r(e,c,o)));let a=!1;return()=>{i.forEach(l=>n.removeChannel(l)),a=!0}},announce:(n,e)=>n.channel(e).send({type:Yo.broadcast,event:Yo.join,payload:{peerId:bi}})}),pR={torrent:{joinRoom:G7,selfId:bi},mqtt:{joinRoom:oH,selfId:bi},ipfs:{joinRoom:Qoe,selfId:bi},supabase:{joinRoom:bce,selfId:bi}},wce="torrent",N6=pR[wce]??pR.supabase,vce=N6.joinRoom,gR=N6.selfId,_ce="metro-retro:board:",LE=n=>`${_ce}${n}`;function Ece(n){if(typeof window>"u")return null;const e=window.localStorage.getItem(LE(n));if(!e)return null;try{return JSON.parse(e)}catch(t){return console.warn("Failed to parse snapshot",t),window.localStorage.removeItem(LE(n)),null}}function Sce(n,e){if(!(typeof window>"u"))try{window.localStorage.setItem(LE(n),JSON.stringify(e))}catch(t){console.warn("Failed to persist snapshot",t)}}const Ace="wss://tracker.webtorrent.dev,wss://tracker.openwebtorrent.com",mR=Ace.split(",").map(n=>n.trim()).filter(Boolean),yR="start-stop-continue",xce=["start-stop-continue","mad-sad-glad"],Ice=n=>typeof n=="string"&&xce.includes(n);class Tce extends EventTarget{constructor(e,t,r){var i;super(),this.status="connecting",this.notes=new Map,this.participants=new Map,this.background=yR,this.timerState={running:!1,remainingMs:0,deadline:null,updatedAt:0},this.revealAll=!1,this.boardId=e,this.localOwnerKey=(t==null?void 0:t.ownerKey)||El(),this.localParticipant={id:gR,label:((i=t==null?void 0:t.label)==null?void 0:i.trim())||`Guest ${El().slice(0,4).toUpperCase()}`,color:(t==null?void 0:t.color)||this.randomAccent()},this.background=r??yR,this.participants.set(gR,this.localParticipant),this.restoreSnapshot(),this.connectRoom()}dispose(){var e;typeof window<"u"&&window.clearTimeout(this.persistHandle),(e=this.room)==null||e.leave()}getNotes(){return Array.from(this.notes.values()).sort((e,t)=>e.createdAt-t.createdAt)}getParticipants(){return Array.from(this.participants.values())}getLocalParticipant(){return this.localParticipant}getBoardBackground(){return this.background}getTimerState(){return{...this.timerState}}getRevealState(){return this.revealAll}setBoardBackground(e){var r;if(!e)return;e!==this.background&&this.applyBackground(e),(r=this.sendSettingsMessage)==null||r.call(this,{type:"background",value:e})}setRevealState(e){var r;const t=!!e;this.revealAll!==t&&(this.revealAll=t,(r=this.sendSettingsMessage)==null||r.call(this,{type:"reveal",value:t}),this.dispatchEvent(new CustomEvent("reveal-changed",{detail:t})))}updateTimerState(e){var t;this.isValidTimerState(e)&&(this.applyTimerState(e),(t=this.sendSettingsMessage)==null||t.call(this,{type:"timer-update",state:e}))}fireConfetti(e){var t;this.dispatchEvent(new CustomEvent("confetti-fired",{detail:e})),(t=this.sendFunMessage)==null||t.call(this,{type:"confetti",shot:e})}createNote(e,t,r){const i=Date.now(),s={id:El(),columnId:e,text:"",...this.normalizePosition(t,r),color:this.localParticipant.color,authorId:this.localParticipant.id,ownerKey:this.localOwnerKey,createdAt:i,updatedAt:i};return this.applyUpsert(s),this.broadcastNote({type:"upsert",note:s}),s}updateNote(e,t){const r=this.notes.get(e);if(!r)return;const i={...r,...t,updatedAt:Date.now()};this.applyUpsert(i),this.broadcastNote({type:"upsert",note:i})}moveNote(e,t,r,i){this.updateNote(e,{columnId:t,...this.normalizePosition(r,i)})}deleteNote(e){this.notes.get(e)&&(this.notes.delete(e),this.emitNotesChanged(),this.schedulePersist(),this.broadcastNote({type:"delete",id:e,updatedAt:Date.now()}))}connectRoom(){const e=this.buildRoomConfig();try{this.room=vce(e,this.boardId)}catch(t){this.handleRoomInitError(t);return}this.updateStatus("connected"),this.setupMessaging(),this.setupPresence(),this.setupFunChannel(),this.setupSettingsChannel()}setupMessaging(){if(!this.room)return;const[e,t]=this.room.makeAction("note");this.sendNoteMessage=(r,i)=>e(r,i),t((r,i)=>{var s;switch(r.type){case"upsert":this.applyUpsert(r.note);break;case"delete":this.applyDelete(r.id,r.updatedAt);break;case"sync-request":(s=this.sendNoteMessage)==null||s.call(this,{type:"sync-response",notes:this.getNotes()},i);break;case"sync-response":r.notes.forEach(o=>this.applyUpsert(o));break}}),this.room.onPeerJoin(r=>{var i,s;this.updateStatus("connected"),(i=this.sendPresenceMessage)==null||i.call(this,{participant:this.localParticipant},r),(s=this.sendNoteMessage)==null||s.call(this,{type:"sync-request"},r)}),this.room.onPeerLeave(r=>{this.participants.delete(r),this.emitParticipantsChanged()})}setupPresence(){var r;if(!this.room)return;const[e,t]=this.room.makeAction("presence");this.sendPresenceMessage=(i,s)=>e(i,s),t(i=>{i!=null&&i.participant&&(this.participants.set(i.participant.id,i.participant),this.emitParticipantsChanged())}),this.emitParticipantsChanged(),(r=this.sendPresenceMessage)==null||r.call(this,{participant:this.localParticipant})}setupFunChannel(){if(!this.room)return;const[e,t]=this.room.makeAction("fun");this.sendFunMessage=(r,i)=>e(r,i),t(r=>{(r==null?void 0:r.type)!=="confetti"||!r.shot||this.dispatchEvent(new CustomEvent("confetti-fired",{detail:r.shot}))})}setupSettingsChannel(){if(!this.room)return;const[e,t]=this.room.makeAction("settings");this.sendSettingsMessage=(r,i)=>e(r,i),t((r,i)=>{(r==null?void 0:r.type)==="background"&&Ice(r.value)?this.applyBackground(r.value):(r==null?void 0:r.type)==="background-request"?this.respondWithBackground(i):(r==null?void 0:r.type)==="timer-update"&&this.isValidTimerState(r.state)?this.applyTimerState(r.state):(r==null?void 0:r.type)==="timer-request"?this.respondWithTimer(i):(r==null?void 0:r.type)==="reveal"?this.applyRevealState(!!r.value):(r==null?void 0:r.type)==="reveal-request"&&this.respondWithReveal(i)}),this.requestBackgroundSync(),this.requestTimerSync(),this.requestRevealSync()}broadcastNote(e){var t;(t=this.sendNoteMessage)==null||t.call(this,e)}applyUpsert(e){const t=this.notes.get(e.id);t&&t.updatedAt>e.updatedAt||(this.notes.set(e.id,e),this.schedulePersist(),this.emitNotesChanged())}applyDelete(e,t){const r=this.notes.get(e);!r||r.updatedAt>t||(this.notes.delete(e),this.emitNotesChanged(),this.schedulePersist())}emitNotesChanged(){this.dispatchEvent(new CustomEvent("notes-changed",{detail:this.getNotes()}))}emitParticipantsChanged(){this.dispatchEvent(new CustomEvent("participants-changed",{detail:this.getParticipants()}))}applyBackground(e){!e||e===this.background||(this.background=e,this.dispatchEvent(new CustomEvent("background-changed",{detail:e})))}respondWithBackground(e){var t;(t=this.sendSettingsMessage)==null||t.call(this,{type:"background",value:this.background},e??null)}requestBackgroundSync(){var e;(e=this.sendSettingsMessage)==null||e.call(this,{type:"background-request"})}respondWithTimer(e){var t;(t=this.sendSettingsMessage)==null||t.call(this,{type:"timer-update",state:this.timerState},e??null)}requestTimerSync(){var e;(e=this.sendSettingsMessage)==null||e.call(this,{type:"timer-request"})}respondWithReveal(e){var t;(t=this.sendSettingsMessage)==null||t.call(this,{type:"reveal",value:this.revealAll},e??null)}requestRevealSync(){var e;(e=this.sendSettingsMessage)==null||e.call(this,{type:"reveal-request"})}buildRoomConfig(){const e={appId:"metro-retro"};return mR.length&&(e.relayUrls=mR),e}normalizePosition(e,t){const r=Number.isFinite(e)?Number(e):24,i=Number.isFinite(t)?Number(t):24;return{x:Math.max(12,r),y:Math.max(12,i)}}updateStatus(e){this.status=e,this.dispatchEvent(new CustomEvent("status-changed",{detail:e}))}applyTimerState(e){this.isValidTimerState(e)&&(e.updatedAt<this.timerState.updatedAt||(this.timerState=e,this.dispatchEvent(new CustomEvent("timer-changed",{detail:e}))))}isValidTimerState(e){if(!e)return!1;const t=r=>typeof r=="number"&&Number.isFinite(r);return!t(e.remainingMs)||e.remainingMs<0||e.deadline!==null&&!t(e.deadline)||!t(e.updatedAt)?!1:typeof e.running=="boolean"}restoreSnapshot(){const e=Ece(this.boardId);e!=null&&e.notes&&(e.notes.forEach(t=>this.notes.set(t.id,t)),this.emitNotesChanged())}schedulePersist(){typeof window>"u"||(window.clearTimeout(this.persistHandle),this.persistHandle=window.setTimeout(()=>{Sce(this.boardId,{notes:this.getNotes()})},400))}randomAccent(){const e=["#fbbf24","#ef4444","#22d3ee","#a855f7","#34d399","#f472b6"];return e[Math.floor(Math.random()*e.length)]}applyRevealState(e){const t=!!e;this.revealAll!==t&&(this.revealAll=t,this.dispatchEvent(new CustomEvent("reveal-changed",{detail:t})))}handleRoomInitError(e){console.error(e);const t=this.isPeerLimitError(e)?{type:"peer-limit"}:{type:"connection",message:e instanceof Error?e.message:"Failed to connect"};this.updateStatus("disconnected"),this.dispatchEvent(new CustomEvent("connection-error",{detail:t}))}isPeerLimitError(e){if(!e)return!1;const t=(e==null?void 0:e.message)??"";return!t||!/PeerConnection/i.test(t)?!1:(e==null?void 0:e.name)==="UnknownError"}}const Cce=[{id:"good",label:"Good",description:"Wins and bright spots worth repeating",accent:"#34d399"},{id:"bad",label:"Bad",description:"Pain points or risks we should address",accent:"#f87171"},{id:"start",label:"Start",description:"New ideas to try next sprint",accent:"#60a5fa"},{id:"stop",label:"Stop",description:"Habits that no longer serve us",accent:"#fbbf24"}],kce=110,Pce=70,D6="application/x-metro-note",NE=[{id:"start-stop-continue",label:"Start / Stop / Continue",description:"Three-part action board",asset:"start-stop-continue.png",columns:[{title:"Start",description:"Ideas to try",accent:"#0ea5e9"},{title:"Stop",description:"Habits to drop",accent:"#f97316"},{title:"Continue",description:"Keep doing these",accent:"#6366f1"}]},{id:"mad-sad-glad",label:"Mad / Sad / Glad",description:"Emotional check-in",asset:"mad-sad-glad.png",columns:[{title:"Mad",description:"Frustrations & annoyances",accent:"#f87171"},{title:"Sad",description:"Letdowns & concerns",accent:"#facc15"},{title:"Glad",description:"Highlights & celebrations",accent:"#34d399"}]}];/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const $6={ATTRIBUTE:1,CHILD:2},M6=n=>(...e)=>({_$litDirective$:n,values:e});let B6=class{constructor(e){}get _$AU(){return this._$AM._$AU}_$AT(e,t,r){this._$Ct=e,this._$AM=t,this._$Ci=r}_$AS(e,t){return this.update(e,t)}update(e,t){return this.render(...t)}};/**
 * @license
 * Copyright 2018 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const U6="important",Rce=" !"+U6,Bh=M6(class extends B6{constructor(n){var e;if(super(n),n.type!==$6.ATTRIBUTE||n.name!=="style"||((e=n.strings)==null?void 0:e.length)>2)throw Error("The `styleMap` directive must be used in the `style` attribute and must be the only part in the attribute.")}render(n){return Object.keys(n).reduce((e,t)=>{const r=n[t];return r==null?e:e+`${t=t.includes("-")?t:t.replace(/(?:^(webkit|moz|ms|o)|)(?=[A-Z])/g,"-$&").toLowerCase()}:${r};`},"")}update(n,[e]){const{style:t}=n.element;if(this.ft===void 0)return this.ft=new Set(Object.keys(e)),this.render(e);for(const r of this.ft)e[r]==null&&(this.ft.delete(r),r.includes("-")?t.removeProperty(r):t[r]=null);for(const r in e){const i=e[r];if(i!=null){this.ft.add(r);const s=typeof i=="string"&&i.endsWith(Rce);r.includes("-")||s?t.setProperty(r,s?i.slice(0,-11):i,s?U6:""):t[r]=i}}return _a}});/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */class DE extends B6{constructor(e){if(super(e),this.it=jr,e.type!==$6.CHILD)throw Error(this.constructor.directiveName+"() can only be used in child bindings")}render(e){if(e===jr||e==null)return this._t=void 0,this.it=e;if(e===_a)return e;if(typeof e!="string")throw Error(this.constructor.directiveName+"() called with a non-string value");if(e===this.it)return this._t;this.it=e;const t=[e];return t.raw=t,this._t={_$litType$:this.constructor.resultType,strings:t,values:[]}}}DE.directiveName="unsafeHTML",DE.resultType=1;/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */class $E extends DE{}$E.directiveName="unsafeSVG",$E.resultType=2;const Oce=M6($E),Lce=`<svg
  width="140"
  height="140"
  viewBox="0 0 140 140"
  xmlns="http://www.w3.org/2000/svg"
>
  <defs>
    <!-- Paper gradient -->
    <linearGradient id="noteGradient" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="var(--note-top, #fff79a)" />
      <stop offset="100%" stop-color="var(--note-bottom, #ffd34a)" />
    </linearGradient>

    <!-- Fold gradient -->
    <linearGradient id="foldGradient" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0%" stop-color="var(--note-fold-light, #fffde2)" />
      <stop offset="100%" stop-color="var(--note-fold-dark, #ffd768)" />
    </linearGradient>

    <filter id="noteShadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow
        dx="0"
        dy="6"
        stdDeviation="6"
        flood-color="var(--note-shadow, rgba(0, 0, 0, 0.3))"
        flood-opacity="0.35"
      />
    </filter>
  </defs>

  <g filter="url(#noteShadow)">
    <path
      id="note-body"
      d="M4 4 H112 L136 28 V136 H4 Z"
      fill="url(#noteGradient)"
      stroke="var(--note-stroke, #e0a800)"
      stroke-width="1.5"
    />

    <path
      id="note-fold"
      d="M112 4 L136 28 H112 Z"
      fill="url(#foldGradient)"
      stroke="var(--note-stroke, #e0a800)"
      stroke-width="1.5"
      stroke-linejoin="round"
    />
  </g>
</svg>
`;var Nce=Object.defineProperty,Dce=Object.getOwnPropertyDescriptor,ka=(n,e,t,r)=>{for(var i=r>1?void 0:r?Dce(e,t):e,s=n.length-1,o;s>=0;s--)(o=n[s])&&(i=(r?o(e,t,i):o(i))||i);return r&&i&&Nce(e,t,i),i};let Ps=class extends ya{constructor(){super(...arguments),this.autoFocus=!1,this.obscured=!1,this.editing=!1,this.draft="",this.commitEdit=()=>{!this.controller||!this.editing||(this.controller.updateNote(this.note.id,{text:this.draft.trim()}),this.editing=!1)}}updated(n){var e;n.has("note")&&!this.editing&&(this.draft=((e=this.note)==null?void 0:e.text)??""),(n.has("autoFocus")||n.has("note"))&&this.autoFocus&&!this.editing&&this.note&&this.beginEditing()}render(){if(!this.note)return null;const n=this.getPaletteStyles(this.note.color);return or`
            <article
                class="note"
                draggable=${String(!this.editing)}
                style=${Bh({...n,"--tilt":`${this.getTilt(this.note.id)}deg`})}
                @dragstart=${this.handleDragStart}
                @dblclick=${this.beginEditing}
            >
                <div class="note-shell" aria-hidden="true">
                    ${Oce(Lce)}
                </div>
                <button
                    class="delete"
                    @click=${this.handleDelete}
                    title="Delete note"
                >
                    &times;
                </button>
                <div class="note-content">
                    ${this.editing?or`
                              <textarea
                                  .value=${this.draft}
                                  @input=${this.handleInput}
                                  @keydown=${this.handleKeyDown}
                                  @blur=${this.commitEdit}
                              ></textarea>
                          `:or`<p
                              ?empty=${this.note.text.length===0}
                              @click=${this.beginEditing}
                          >
                              ${this.note.text||"Double-click to add text"}
                          </p>`}
                </div>
            </article>
        `}getTilt(n){let e=0;for(let t=0;t<n.length;t++)e=(e<<5)-e+n.charCodeAt(t),e|=0;return(e>>>0)%800/100-4}getPaletteStyles(n){const e=this.normalizeHex(n);if(!e)return{};const t=i=>this.mixHex(e,"#ffffff",i),r=i=>this.mixHex(e,"#000000",i);return{"--note-top":t(.35),"--note-bottom":r(.1),"--note-fold-light":t(.55),"--note-fold-dark":r(.05),"--note-stroke":r(.25),"--note-shadow":r(.7)}}normalizeHex(n){const e=n.trim().toLowerCase();if(/^#([0-9a-f]{3})$/i.test(e)){const[,t]=/^#([0-9a-f]{3})$/i.exec(e)??[];return t?`#${t.split("").map(r=>r+r).join("")}`:null}return/^#([0-9a-f]{6})$/i.test(e)?e:null}mixHex(n,e,t){const r=this.hexToRgb(n),i=this.hexToRgb(e);if(!r||!i)return n;const s=Math.min(Math.max(t,0),1),o=(a,l)=>Math.round(a+(l-a)*s);return this.rgbToHex({r:o(r.r,i.r),g:o(r.g,i.g),b:o(r.b,i.b)})}hexToRgb(n){const e=/^#([0-9a-f]{6})$/i.exec(n);if(!e)return null;const t=e[1],r=parseInt(t.slice(0,2),16),i=parseInt(t.slice(2,4),16),s=parseInt(t.slice(4,6),16);return{r,g:i,b:s}}rgbToHex({r:n,g:e,b:t}){const r=i=>i.toString(16).padStart(2,"0");return`#${r(Math.max(0,Math.min(255,n)))}${r(Math.max(0,Math.min(255,e)))}${r(Math.max(0,Math.min(255,t)))}`}beginEditing(n){n==null||n.stopPropagation(),!(this.editing||this.obscured)&&(this.editing=!0,this.draft=this.note.text,this.dispatchEvent(new CustomEvent("note-editing-started",{detail:this.note.id,bubbles:!0,composed:!0})),this.updateComplete.then(()=>{var e,t;(e=this.textarea)==null||e.focus(),(t=this.textarea)==null||t.select()}))}handleInput(n){const e=n.target;this.draft=e.value}handleKeyDown(n){n.key==="Enter"&&!n.shiftKey&&(n.preventDefault(),this.commitEdit()),n.key==="Escape"&&(n.preventDefault(),this.cancelEdit())}cancelEdit(){this.editing=!1,this.draft=this.note.text}handleDelete(n){var e;n.stopPropagation(),(e=this.controller)==null||e.deleteNote(this.note.id)}handleDragStart(n){if(!n.dataTransfer||this.editing)return;const e=this.getBoundingClientRect(),t=n.clientX-e.left,r=n.clientY-e.top;n.dataTransfer.setData(D6,JSON.stringify({noteId:this.note.id,offsetX:t,offsetY:r})),n.dataTransfer.effectAllowed="move"}};Ps.styles=by`
        :host {
            position: absolute;
            display: block;
            width: 110px;
            min-height: 70px;
        }

        .note {
            position: absolute;
            width: 110px;
            min-height: 70px;
            color: #4c3100;
            cursor: grab;
            transition: transform 120ms ease;
            transform-origin: center;
            transform: rotate(var(--tilt, 0deg));
        }

        .note:active {
            cursor: grabbing;
            transform: rotate(var(--tilt, 0deg)) scale(1.02);
        }

        .note-shell {
            pointer-events: none;
        }

        .note-shell svg {
            width: 100%;
            height: auto;
            display: block;
        }

        :host([dimmed]) {
            opacity: 0.25;
            filter: saturate(0.3);
        }

        .note-content {
            position: absolute;
            inset: 0.8rem 0.6rem 1.1rem;
            display: flex;
            align-items: flex-start;
            overflow: hidden;
        }

        :host([obscured]) .note-content {
            filter: blur(10px);
        }

        :host([obscured]) .note-content::after {
            content: "";
            position: absolute;
            inset: 0;
            background: rgba(255, 255, 255, 0.35);
            border-radius: 8px;
            pointer-events: none;
        }

        .note-content :is(p, textarea) {
            flex: 1;
            max-height: 100%;
        }

        p {
            margin: 0;
            word-break: break-word;
            font-size: 0.95rem;
            line-height: 1.3;
            overflow: hidden;
        }

        p[empty] {
            opacity: 0.7;
        }

        textarea {
            width: 100%;
            min-height: 45px;
            height: 100%;
            max-height: 100%;
            border: none;
            resize: none;
            background: transparent;
            font: inherit;
            color: inherit;
            outline: none;
            overflow: auto;
        }

        .delete {
            position: absolute;
            top: 6px;
            right: 6px;
            border: none;
            background: rgba(15, 23, 42, 0.25);
            color: #2f1a00;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            cursor: pointer;
            z-index: 1;
        }
    `;ka([Ai({attribute:!1})],Ps.prototype,"note",2);ka([Ai({attribute:!1})],Ps.prototype,"controller",2);ka([Ai({attribute:!1})],Ps.prototype,"autoFocus",2);ka([Ai({type:Boolean,reflect:!0})],Ps.prototype,"obscured",2);ka([Vt()],Ps.prototype,"editing",2);ka([Vt()],Ps.prototype,"draft",2);ka([_y("textarea")],Ps.prototype,"textarea",2);Ps=ka([vy("sticky-note")],Ps);var $ce=Object.defineProperty,Mce=Object.getOwnPropertyDescriptor,jn=(n,e,t,r)=>{for(var i=r>1?void 0:r?Mce(e,t):e,s=n.length-1,o;s>=0;s--)(o=n[s])&&(i=(r?o(e,t,i):o(i))||i);return r&&i&&$ce(e,t,i),i};const bR=2200,wR=1240;let pn=class extends ya{constructor(){super(...arguments),this.notes=[],this.zoom=1,this.panX=0,this.panY=0,this.isPanning=!1,this.pendingEditNoteId=null,this.highlightedParticipantId=null,this.background="start-stop-continue",this.localParticipantId=null,this.ownerKey=null,this.revealAll=!1,this.panOrigin=null,this.zoomStep=.45,this.minZoom=.4,this.maxZoom=3,this.handleKeyZoom=n=>{if(!n.metaKey&&!n.ctrlKey||this.shouldIgnoreKeyZoom(n))return;const e=this.getWorkspaceRect();e&&(n.key==="="||n.key==="+"?(n.preventDefault(),this.zoomTo(this.zoom+this.zoomStep,{x:e.width/2,y:e.height/2})):n.key==="-"||n.key==="_"?(n.preventDefault(),this.zoomTo(this.zoom-this.zoomStep,{x:e.width/2,y:e.height/2})):n.key==="0"&&(n.preventDefault(),this.resetView()))},this.zoomIn=()=>{const n=this.getWorkspaceRect();this.zoomTo(this.zoom*(1+this.zoomStep),n?{x:n.width/2,y:n.height/2}:void 0)},this.handleNoteEditingStarted=n=>{const e=n.detail;e&&this.pendingEditNoteId===e&&(this.pendingEditNoteId=null)},this.zoomOut=()=>{const n=this.getWorkspaceRect();this.zoomTo(this.zoom*(1-this.zoomStep/2),n?{x:n.width/2,y:n.height/2}:void 0)},this.resetView=()=>{this.zoom=1,this.centerBoard()}}connectedCallback(){super.connectedCallback(),window.addEventListener("keydown",this.handleKeyZoom,{passive:!1}),queueMicrotask(()=>this.centerBoard())}disconnectedCallback(){var n;window.removeEventListener("keydown",this.handleKeyZoom),(n=this.unsubscribe)==null||n.call(this),super.disconnectedCallback()}updated(n){n.has("controller")&&this.bindNotes()}render(){return or`
      <section
        class="board"
        @dblclick=${this.handleDoubleClick}
        @dragover=${this.handleDragOver}
        @drop=${this.handleDrop}
        @wheel=${this.handleWheel}
        @pointerdown=${this.handlePointerDown}
        @pointermove=${this.handlePointerMove}
        @pointerup=${this.handlePointerUp}
        @pointerleave=${this.handlePointerUp}
      >
        <div
          class="pan-layer"
          style=${Bh({"--pan-x":`${this.panX}px`,"--pan-y":`${this.panY}px`})}
        >
          <div
            class="workspace"
            style=${Bh({"--scale":`${this.zoom}`,"--board-width":`${bR}px`,"--board-height":`${wR}px`})}
          >
            ${this.renderTemplate()}
            <div class="note-layer">
              ${this.notes.map(n=>this.renderNote(n))}
            </div>
          </div>
        </div>
        <div class="canvas-controls" @click=${n=>n.stopPropagation()}>
          <button class="icon" @click=${this.zoomOut} aria-label="Zoom out"></button>
          <span>${Math.round(this.zoom*100)}%</span>
          <button class="icon" @click=${this.zoomIn} aria-label="Zoom in">+</button>
          <button class="reset" @click=${this.resetView} aria-label="Reset view">Reset</button>
        </div>
        ${this.controller?null:or`<div class="board-placeholder">Connecting to board</div>`}
      </section>
    `}bindNotes(){var e;if((e=this.unsubscribe)==null||e.call(this),!this.controller){this.notes=[];return}const n=t=>{const r=t.detail;this.notes=r};this.controller.addEventListener("notes-changed",n),this.unsubscribe=()=>{var t;return(t=this.controller)==null?void 0:t.removeEventListener("notes-changed",n)},this.notes=this.controller.getNotes()}renderNote(n){const e=!!(this.highlightedParticipantId&&n.authorId&&n.authorId!==this.highlightedParticipantId),t=!!(this.highlightedParticipantId&&!n.authorId),r=n.ownerKey&&this.ownerKey?n.ownerKey===this.ownerKey:!1,i=n.authorId&&this.localParticipantId?n.authorId===this.localParticipantId:!1,s=r||i,o=!this.revealAll&&!!(n.authorId||n.ownerKey)&&!s;return or`
      <sticky-note
        style=${Bh({left:`${n.x}px`,top:`${n.y}px`})}
        ?dimmed=${e||t}
        .note=${n}
        .controller=${this.controller}
        .autoFocus=${n.id===this.pendingEditNoteId}
        .obscured=${o}
        @note-editing-started=${this.handleNoteEditingStarted}
      ></sticky-note>
    `}renderTemplate(){const n=this.getBackgroundLayout();return n?or`
      <div
        class="board-template"
        style=${Bh({"--template-image":`url(${n.asset})`})}
        aria-hidden="true"
        role="presentation"
      ></div>
    `:null}handleDoubleClick(n){if(!this.controller||this.eventTargetsNote(n))return;const e=this.getWorkspaceRect();if(!e)return;const t=(n.clientX-e.left)/this.zoom-kce/2,r=(n.clientY-e.top)/this.zoom-Pce/2,i=this.controller.createNote(this.defaultColumnId,t,r);this.pendingEditNoteId=i.id}handleDragOver(n){n.dataTransfer&&(n.preventDefault(),n.dataTransfer.dropEffect="move")}handleDrop(n){var l;if(!n.dataTransfer||!this.controller)return;const e=n.dataTransfer.getData(D6);if(!e)return;n.preventDefault();const t=this.parsePayload(e);if(!t)return;const i=((l=this.notes.find(c=>c.id===t.noteId))==null?void 0:l.columnId)??this.defaultColumnId,s=this.getWorkspaceRect();if(!s)return;const o=(n.clientX-s.left)/this.zoom-t.offsetX,a=(n.clientY-s.top)/this.zoom-t.offsetY;this.controller.moveNote(t.noteId,i,o,a)}handleWheel(n){if(n.preventDefault(),n.ctrlKey||n.metaKey){const e=this.getWorkspaceRect();if(!e)return;const t={x:n.clientX-e.left,y:n.clientY-e.top},r=Math.exp(-n.deltaY*.0045);this.zoomTo(this.zoom*r,t);return}this.panX-=n.deltaX,this.panY-=n.deltaY}handlePointerDown(n){var t;if(n.button!==0||this.eventTargetsNote(n))return;this.isPanning=!0,this.panOrigin={x:n.clientX,y:n.clientY};const e=n.currentTarget;(t=e.setPointerCapture)==null||t.call(e,n.pointerId)}handlePointerMove(n){if(!this.isPanning||!this.panOrigin)return;const e=n.clientX-this.panOrigin.x,t=n.clientY-this.panOrigin.y;this.panX+=e,this.panY+=t,this.panOrigin={x:n.clientX,y:n.clientY}}handlePointerUp(n){var t;if(!this.isPanning)return;this.isPanning=!1,this.panOrigin=null;const e=n.currentTarget;(t=e.releasePointerCapture)==null||t.call(e,n.pointerId)}zoomTo(n,e){const t=Math.min(this.maxZoom,Math.max(this.minZoom,n));t!==this.zoom&&(e&&this.adjustPanForZoom(t,e),this.zoom=Number(t.toFixed(2)))}adjustPanForZoom(n,e){const t=this.zoom;if(!t)return;const r=(e.x-this.panX)/t,i=(e.y-this.panY)/t;this.panX=e.x-r*n,this.panY=e.y-i*n}shouldIgnoreKeyZoom(n){var i;const e=n.target;if(!e)return!1;const t=e.tagName;return((i=e.getAttribute("contenteditable"))==null?void 0:i.toLowerCase())==="true"||t==="INPUT"||t==="TEXTAREA"||t==="SELECT"}centerBoard(){const n=this.getBoundingClientRect();!n.width||!n.height||(this.panX=(n.width-bR*this.zoom)/2,this.panY=(n.height-wR*this.zoom)/2)}getWorkspaceRect(){var n,e;return((n=this.workspace)==null?void 0:n.getBoundingClientRect())??((e=this.noteLayer)==null?void 0:e.getBoundingClientRect())??this.getBoundingClientRect()}get defaultColumnId(){var n;return(n=Cce[0])==null?void 0:n.id}getBackgroundLayout(){return NE.find(n=>n.id===this.background)}eventTargetsNote(n){return n.composedPath().some(e=>e instanceof HTMLElement&&e.tagName==="STICKY-NOTE")}parsePayload(n){try{const e=JSON.parse(n);return typeof e.noteId!="string"?null:{noteId:e.noteId,offsetX:Number(e.offsetX)||0,offsetY:Number(e.offsetY)||0}}catch{return null}}};pn.styles=by`
    :host {
      position: fixed;
      inset: 0;
      display: block;
      z-index: 0;
    }

    .board {
      position: absolute;
      inset: 0;
      background: #ffffff;
      overflow: hidden;
    }

    .pan-layer {
      position: absolute;
      inset: 0;
      transform: translate(var(--pan-x, 0px), var(--pan-y, 0px));
    }

    .workspace {
      position: absolute;
      width: var(--board-width, 2200px);
      height: var(--board-height, 1240px);
      transform-origin: 0 0;
      transform: scale(var(--scale, 1));
    }

    .board-template {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      background-image: var(--template-image);
      background-size: cover;
      background-position: center;
      border-radius: 28px;
      border: 1px solid rgba(15, 23, 42, 0.1);
      box-shadow: 0 20px 60px rgba(15, 23, 42, 0.15);
      pointer-events: none;
      z-index: 1;
      opacity: 0.95;
    }

    .note-layer {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      z-index: 2;
      pointer-events: none;
    }

    .note-layer sticky-note {
      pointer-events: auto;
    }

    .board-placeholder {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      padding: 1rem 1.5rem;
      text-align: center;
      color: #475569;
      border: 1px dashed rgba(15, 23, 42, 0.2);
      border-radius: 16px;
      background: rgba(255, 255, 255, 0.9);
    }

    .canvas-controls {
      position: absolute;
      bottom: 1.5rem;
      right: 2rem;
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      background: rgba(255, 255, 255, 0.9);
      border: 1px solid rgba(15, 23, 42, 0.12);
      border-radius: 999px;
      padding: 0.35rem 0.75rem;
      font-size: 0.9rem;
      color: #0f172a;
      box-shadow: 0 10px 30px rgba(15, 23, 42, 0.1);
      pointer-events: auto;
    }

    .canvas-controls button {
      border: none;
      background: rgba(15, 23, 42, 0.06);
      color: inherit;
      font-size: 0.85rem;
      cursor: pointer;
      line-height: 1;
    }

    .canvas-controls button.icon {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      display: grid;
      place-items: center;
      font-size: 1.1rem;
    }

    .canvas-controls button.reset {
      border-radius: 8px;
      padding: 0.2rem 0.7rem;
      background: rgba(15, 23, 42, 0.08);
      font-size: 0.8rem;
    }

    .canvas-controls span {
      min-width: 3rem;
      text-align: center;
    }

    @media (max-width: 900px) {
      .canvas-controls {
        right: 1rem;
        bottom: 1rem;
      }
    }
  `;jn([Ai({attribute:!1})],pn.prototype,"controller",2);jn([Vt()],pn.prototype,"notes",2);jn([Vt()],pn.prototype,"zoom",2);jn([Vt()],pn.prototype,"panX",2);jn([Vt()],pn.prototype,"panY",2);jn([Vt()],pn.prototype,"isPanning",2);jn([Vt()],pn.prototype,"pendingEditNoteId",2);jn([Ai({attribute:!1})],pn.prototype,"highlightedParticipantId",2);jn([Ai({attribute:!1})],pn.prototype,"background",2);jn([Ai({attribute:!1})],pn.prototype,"localParticipantId",2);jn([Ai({attribute:!1})],pn.prototype,"ownerKey",2);jn([Ai({attribute:!1})],pn.prototype,"revealAll",2);jn([_y(".note-layer")],pn.prototype,"noteLayer",2);jn([_y(".workspace")],pn.prototype,"workspace",2);pn=jn([vy("retro-board")],pn);var Bce=Object.defineProperty,Uce=Object.getOwnPropertyDescriptor,Ql=(n,e,t,r)=>{for(var i=r>1?void 0:r?Uce(e,t):e,s=n.length-1,o;s>=0;s--)(o=n[s])&&(i=(r?o(e,t,i):o(i))||i);return r&&i&&Bce(e,t,i),i};const vR=["#f87171","#fb923c","#facc15","#34d399","#38bdf8","#a855f7","#ec4899"];let vo=class extends ya{constructor(){super(...arguments),this.active=!1,this.pulling=!1,this.pullVector={x:0,y:0},this.origin=null,this.ctx=null,this.lastTick=performance.now(),this.particles=[],this.onRemoteConfetti=n=>{const e=n.detail;e&&this.spawnConfetti(e)},this.handleResize=()=>{this.ensureCanvasSize()}}firstUpdated(){this.setupCanvas()}connectedCallback(){super.connectedCallback(),this.startLoop(),window.addEventListener("resize",this.handleResize)}disconnectedCallback(){var n;super.disconnectedCallback(),window.removeEventListener("resize",this.handleResize),this.stopLoop(),(n=this.controller)==null||n.removeEventListener("confetti-fired",this.onRemoteConfetti)}updated(n){var e;if(n.has("controller")){const t=n.get("controller");t==null||t.removeEventListener("confetti-fired",this.onRemoteConfetti),(e=this.controller)==null||e.addEventListener("confetti-fired",this.onRemoteConfetti)}n.has("active")&&!this.active&&this.resetPull()}render(){return or`
      <canvas part="canvas" aria-hidden="true"></canvas>
      <div
        class="sling-surface"
        data-active=${this.active?"true":"false"}
        data-pulling=${this.pulling?"true":"false"}
        @pointerdown=${this.handlePointerDown}
        @pointermove=${this.handlePointerMove}
        @pointerup=${this.handlePointerUp}
        @pointerleave=${this.handlePointerUp}
      >
        ${this.renderReticle()}
      </div>
    `}renderReticle(){if(!this.pulling||!this.origin)return null;const n=this.origin.x+this.pullVector.x,e=this.origin.y+this.pullVector.y,t=Math.atan2(this.pullVector.y,this.pullVector.x),r=Math.min(this.maxPull,this.magnitude);return or`
      <div class="pull-reticle">
        <span
          class="reticle-band"
          style=${`left:${this.origin.x}px; top:${this.origin.y}px; width:${r}px; transform: translateY(-50%) rotate(${t}rad);`}
        ></span>
        <span
          class="reticle-origin"
          style=${`left:${this.origin.x}px; top:${this.origin.y}px;`}
        ></span>
        <span
          class="reticle-handle"
          style=${`left:${n}px; top:${e}px;`}
        ></span>
      </div>
    `}get magnitude(){return Math.hypot(this.pullVector.x,this.pullVector.y)}get maxPull(){return 160}getPointerLocal(n){const e=this.getBoundingClientRect();return{x:n.clientX-e.left,y:n.clientY-e.top}}handlePointerDown(n){var t;if(!this.active)return;n.preventDefault(),this.pulling=!0,this.origin=this.getPointerLocal(n),this.pullVector={x:0,y:0};const e=n.currentTarget;(t=e.setPointerCapture)==null||t.call(e,n.pointerId),this.updatePull(n)}handlePointerMove(n){this.pulling&&(n.preventDefault(),this.updatePull(n))}handlePointerUp(n){var s;if(!this.pulling||!this.origin)return;n.preventDefault(),this.updatePull(n);const e=this.magnitude,t={...this.pullVector},r={...this.origin};this.pulling=!1;const i=n.currentTarget;(s=i.releasePointerCapture)==null||s.call(i,n.pointerId),this.pullVector={x:0,y:0},this.origin=null,!(e<12)&&this.launchConfetti(e,t,r)}updatePull(n){if(!this.origin)return;const e=this.getPointerLocal(n),t={x:e.x-this.origin.x,y:e.y-this.origin.y},r=Math.hypot(t.x,t.y)||1,s=Math.min(r,this.maxPull)/r;this.pullVector={x:t.x*s,y:t.y*s},this.requestUpdate()}launchConfetti(n,e,t){var d,p;const r=this.getCanvasWidth(),i=this.getCanvasHeight(),s=t.x/r,o=t.y/i,a={x:-e.x/r,y:-e.y/i},l=Math.min(1,n/this.maxPull),c=((p=(d=this.controller)==null?void 0:d.getLocalParticipant())==null?void 0:p.color)||"#34d399",h={id:El(),originX:s,originY:o,vectorX:a.x,vectorY:a.y,power:l,color:c,createdAt:Date.now()};this.controller?this.controller.fireConfetti(h):this.spawnConfetti(h),this.dispatchEvent(new CustomEvent("confetti-shot",{bubbles:!0,composed:!0}))}spawnConfetti(n){this.ensureCanvasSize();const e=this.getCanvasWidth(),t=this.getCanvasHeight(),r={x:n.originX*e,y:n.originY*t},i={x:n.vectorX*e,y:n.vectorY*t},s=Math.hypot(i.x,i.y)||1,o={x:i.x/s,y:i.y/s},a=400+n.power*650,l=Math.floor(80+n.power*70),c=this.buildPalette(n.color);for(let h=0;h<l;h++){const d=(Math.random()-.5)*.9,p=Math.atan2(o.y,o.x)+d,g=a*(.5+Math.random()*.9),m=Math.cos(p)*g+(Math.random()-.5)*120,E=Math.sin(p)*g+(Math.random()-.5)*120,y=2200+Math.random()*800,S=2.8+Math.random()*2.8;this.particles.push({x:r.x,y:r.y,vx:m,vy:E,size:S,rotation:Math.random()*Math.PI*2,rotationSpeed:(Math.random()-.5)*8,color:c[Math.floor(Math.random()*c.length)],life:y,ttl:y,shape:Math.random()>.4?"square":"circle"})}}buildPalette(n){if(!/^#([0-9a-f]{3}|[0-9a-f]{6})$/i.test(n))return[...vR];const e=n.replace("#",""),t=e.length===3?e.split("").map(o=>o+o).join(""):e,r=parseInt(t,16),i=o=>Math.min(255,Math.max(0,o)),s=o=>{const a=i((r>>16&255)+o),l=i((r>>8&255)+o),c=i((r&255)+o);return`#${((1<<24)+(a<<16)+(l<<8)+c).toString(16).slice(1)}`};return[s(70),s(30),n,s(-30),"#ffffff",...vR]}setupCanvas(){this.canvas&&(this.ctx=this.canvas.getContext("2d"),this.ensureCanvasSize())}ensureCanvasSize(){if(!this.canvas)return;const n=this.getCanvasWidth(),e=this.getCanvasHeight();(this.canvas.width!==n||this.canvas.height!==e)&&(this.canvas.width=n,this.canvas.height=e)}getCanvasWidth(){return Math.floor(this.offsetWidth||window.innerWidth||1)}getCanvasHeight(){return Math.floor(this.offsetHeight||window.innerHeight||1)}startLoop(){if(this.frameHandle)return;const n=()=>{this.frameHandle=window.requestAnimationFrame(n),this.stepParticles(),this.drawParticles()};this.frameHandle=window.requestAnimationFrame(n)}stopLoop(){this.frameHandle&&(window.cancelAnimationFrame(this.frameHandle),this.frameHandle=void 0)}stepParticles(){const n=performance.now(),e=Math.min(32,n-this.lastTick),t=e/1e3;this.lastTick=n;const r=900;this.particles=this.particles.filter(i=>(i.life-=e,i.life<=0?!1:(i.vy+=r*t,i.x+=i.vx*t,i.y+=i.vy*t,i.rotation+=i.rotationSpeed*t,i.y<this.getCanvasHeight()+80)))}drawParticles(){if(!(!this.ctx||!this.canvas)){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);for(const n of this.particles){const e=Math.max(0,n.life/n.ttl);this.ctx.save(),this.ctx.globalAlpha=e,this.ctx.translate(n.x,n.y),this.ctx.rotate(n.rotation),this.ctx.fillStyle=n.color,n.shape==="circle"?(this.ctx.beginPath(),this.ctx.arc(0,0,n.size/2,0,Math.PI*2),this.ctx.fill()):this.ctx.fillRect(-n.size/2,-n.size/2,n.size,n.size*.6),this.ctx.restore()}}}resetPull(){this.pulling=!1,this.pullVector={x:0,y:0},this.origin=null}};vo.styles=by`
    :host {
      position: fixed;
      inset: 0;
      width: 100%;
      height: 100%;
      display: block;
      pointer-events: none;
      z-index: 3;
    }

    canvas {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
    }

    .sling-surface {
      position: absolute;
      inset: 0;
      pointer-events: none;
    }

    .sling-surface[data-active='true'] {
      pointer-events: auto;
      cursor: crosshair;
      touch-action: none;
    }

    .sling-surface[data-active='true'][data-pulling='true'] {
      cursor: grabbing;
    }

    .pull-reticle {
      position: absolute;
      inset: 0;
      pointer-events: none;
    }

    .reticle-origin,
    .reticle-handle {
      position: absolute;
      width: 12px;
      height: 12px;
      margin-left: -6px;
      margin-top: -6px;
      border-radius: 50%;
      box-shadow: 0 10px 16px rgba(15, 23, 42, 0.2);
    }

    .reticle-origin {
      background: rgba(15, 23, 42, 0.8);
      border: 2px solid rgba(248, 250, 252, 0.8);
    }

    .reticle-handle {
      background: linear-gradient(135deg, #0ea5e9, #a855f7);
      border: 2px solid rgba(255, 255, 255, 0.9);
    }

    .reticle-band {
      position: absolute;
      height: 4px;
      border-radius: 999px;
      transform-origin: 0 50%;
      background: linear-gradient(90deg, rgba(14, 165, 233, 0.9), rgba(99, 102, 241, 0.95));
      box-shadow: 0 4px 12px rgba(79, 70, 229, 0.35);
    }
  `;Ql([Ai({attribute:!1})],vo.prototype,"controller",2);Ql([Ai({type:Boolean,reflect:!0})],vo.prototype,"active",2);Ql([Vt()],vo.prototype,"pulling",2);Ql([Vt()],vo.prototype,"pullVector",2);Ql([Vt()],vo.prototype,"origin",2);Ql([_y("canvas")],vo.prototype,"canvas",2);vo=Ql([vy("confetti-sling")],vo);var Fce=Object.defineProperty,jce=Object.getOwnPropertyDescriptor,Mr=(n,e,t,r)=>{for(var i=r>1?void 0:r?jce(e,t):e,s=n.length-1,o;s>=0;s--)(o=n[s])&&(i=(r?o(e,t,i):o(i))||i);return r&&i&&Fce(e,t,i),i};const _R="metro-retro-profile",ER="metro-retro-background",SR="libretro-onboarding",AR="libretro-recents",xR="libretro-profile-id",qce="libretro-reveal-",ME=["#fbbf24","#ef4444","#22d3ee","#a855f7","#34d399","#f472b6"],zp={name:"",color:ME[0]},Hce=60*1e3;let Tr=class extends ya{constructor(){super(...arguments),this.boardId=null,this.copyState="idle",this.profile=null,this.profileDraft={...zp},this.showProfileDialog=!1,this.participants=[],this.highlightedParticipantId=null,this.background="start-stop-continue",this.confettiEnabled=!1,this.showOnboarding=!0,this.timerRemainingMs=0,this.timerRunning=!1,this.connectionStatus="connecting",this.showStaging=!1,this.recentBoards=[],this.joinBoardInput="",this.connectionError=null,this.revealAll=!1,this.profileId=null,this.timerInterval=null,this.timerDeadline=null,this.pendingTimerBroadcastKey=null,this.onHashChange=()=>this.handleRoute(),this.onParticipantsChange=n=>{const e=n.detail;this.participants=e,this.highlightedParticipantId&&!e.some(t=>t.id===this.highlightedParticipantId)&&(this.highlightedParticipantId=null)},this.onBackgroundChange=n=>{const e=n.detail;e&&(this.background=e,this.persistBackground(e))},this.startFreshBoard=()=>{this.navigateToBoard(El())},this.handleFilterChange=n=>{const e=n.target.value;this.highlightedParticipantId=e||null},this.handleJoinInput=n=>{const e=n.target;this.joinBoardInput=e.value},this.handleJoinBoard=n=>{n.preventDefault();const e=this.joinBoardInput.trim();if(e){if(typeof window<"u")try{const r=new URL(e,window.location.origin).hash.match(/board\/([\w-]+)/i);if(r!=null&&r[1]){this.navigateToBoard(r[1]),this.joinBoardInput="";return}}catch{}this.navigateToBoard(e),this.joinBoardInput=""}},this.onControllerError=n=>{const e=n.detail;e&&(e.type==="peer-limit"?this.connectionError="Your browser hit its peer connection limit. Close other tabs using libRetro or reload to try again.":this.connectionError=e.message||"Failed to join the board.",this.returnToStaging())},this.onTimerStateChange=n=>{const e=n.detail;if(e){if(this.pendingTimerBroadcastKey&&this.pendingTimerBroadcastKey===this.timerStateKey(e)){this.pendingTimerBroadcastKey=null;return}this.applyTimerState(e)}},this.onRevealStateChange=n=>{const e=n.detail;this.revealAll=!!e,this.boardId&&this.persistRevealStateValue(this.boardId,this.revealAll)},this.onConnectionStatusChange=n=>{const e=n.detail;e&&(this.connectionStatus=e)},this.handleBackgroundChange=n=>{var t;const e=n.target.value;this.background=e,this.persistBackground(e),(t=this.controller)==null||t.setBoardBackground(e)},this.handleConfettiShortcut=n=>{!this.isReadyForConfetti||!this.isShortcutEvent(n)||(n.preventDefault(),this.confettiEnabled=!this.confettiEnabled)},this.handleConfettiShot=()=>{this.confettiEnabled=!1},this.handleRevealAll=()=>{this.revealAll||(this.controller?this.controller.setRevealState(!0):this.revealAll=!0,this.boardId&&this.persistRevealStateValue(this.boardId,!0))},this.toggleTimer=()=>{this.timerRunning?this.pauseTimer():this.startTimer()},this.resetTimer=()=>{this.pushTimerState(this.createTimerState(!1,0))},this.addTimerMinute=()=>{const n=this.currentTimerRemaining+Hce,e=this.createTimerState(this.timerRunning,n);this.pushTimerState(e)},this.handleProfileSubmit=n=>{n.preventDefault();const e=this.profileDraft.name.trim();if(!e)return;const t={name:e,color:this.profileDraft.color||zp.color};this.profile=t,this.profileDraft={...t},this.showProfileDialog=!1,this.persistProfile(t),this.boardId?this.bootstrapBoard(this.boardId):this.handleRoute()},this.handleProfileNameInput=n=>{const e=n.target;this.profileDraft={...this.profileDraft,name:e.value}},this.handleProfileColorInput=n=>{const e=n.target;this.profileDraft={...this.profileDraft,color:e.value}},this.randomizeProfileColor=()=>{const n=ME[Math.floor(Math.random()*ME.length)];this.profileDraft={...this.profileDraft,color:n}},this.dismissOnboarding=()=>{if(this.showOnboarding=!1,!(typeof window>"u"))try{window.localStorage.setItem(SR,"dismissed")}catch{}},this.openProfileDialog=()=>{this.profileDraft=this.profile?{...this.profile}:{...zp},this.showProfileDialog=!0},this.closeProfileDialog=()=>{this.profile&&(this.profileDraft={...this.profile},this.showProfileDialog=!1)}}connectedCallback(){super.connectedCallback(),this.initializeProfile(),this.initializeProfileId(),this.initializeBackground(),this.initializeOnboarding(),this.initializeRecentBoards(),window.addEventListener("hashchange",this.onHashChange),window.addEventListener("keydown",this.handleConfettiShortcut),this.handleRoute()}disconnectedCallback(){var n;window.removeEventListener("hashchange",this.onHashChange),window.removeEventListener("keydown",this.handleConfettiShortcut),this.clearTimerInterval(),this.detachControllerListeners(),(n=this.controller)==null||n.dispose(),super.disconnectedCallback()}render(){const n=!!(this.boardId&&this.controller&&this.profile),e=this.showStaging;return or`
            <retro-board
                .controller=${this.controller}
                .highlightedParticipantId=${this.highlightedParticipantId}
                .background=${this.background}
                .localParticipantId=${this.localParticipantId}
                .ownerKey=${this.profileId}
                .revealAll=${this.revealAll}
            ></retro-board>
            <confetti-sling
                .controller=${this.controller}
                .active=${this.confettiEnabled&&n}
                @confetti-shot=${this.handleConfettiShot}
            ></confetti-sling>
            <div class="ui-overlay">
                ${n?or`
                          <div class="toolbar">
                              <div class="toolbar-brand">
                                  <span class="logo-dot"></span>
                                  <div class="brand-text">
                                      <p class="title">libRetro</p>
                                      <p class="meta">
                                          Board #${this.shortBoardId}
                                      </p>
                                  </div>
                              </div>
                              <div class="toolbar-controls">
                                  ${this.renderBackgroundControl()}
                                  ${this.renderFilterControl()}
                                  ${this.renderConnectionStatus()}
                                  ${this.renderTimerControl()}
                                  <div class="toolbar-actions">
                                      <button
                                          class="ghost"
                                          type="button"
                                          ?disabled=${this.revealAll}
                                          @click=${this.handleRevealAll}
                                      >
                                          ${this.revealAll?"Revealed":"Reveal all"}
                                      </button>
                                      <button
                                          class="ghost"
                                          @click=${this.handleCopyLink}
                                      >
                                          ${this.copyLabel}
                                      </button>
                                  </div>
                              </div>
                          </div>
                          ${this.renderProfilePanel()}
                          ${this.renderOnboarding()}
                      `:e?this.renderStagingArea():or`<div class="loading">
                            Preparing your retro board
                        </div>`}
                ${this.renderProfileDialog()}
            </div>
        `}get copyLabel(){switch(this.copyState){case"copied":return"Link copied";case"error":return"Copy failed";default:return"Copy link"}}get shortBoardId(){return this.boardId?this.boardId.slice(0,6).toUpperCase():""}handleRoute(){const n=this.extractBoardId();if(!n){this.returnToStaging();return}n===this.boardId&&this.controller||(this.showStaging=!1,this.bootstrapBoard(n))}returnToStaging(){var n;this.detachControllerListeners(),(n=this.controller)==null||n.dispose(),this.controller=void 0,this.boardId=null,this.participants=[],this.connectionStatus="disconnected",this.applyTimerState(null),this.showStaging=!0,this.joinBoardInput="",this.revealAll=!1}extractBoardId(){const e=window.location.hash.replace(/^#/,"").match(/board\/([\w-]+)/i);return(e==null?void 0:e[1])??null}navigateToBoard(n){this.connectionError=null,window.location.hash=`#/board/${n}`}bootstrapBoard(n){var i;if(this.detachControllerListeners(),(i=this.controller)==null||i.dispose(),this.boardId=n,!this.profile){this.controller=void 0,this.participants=[],this.connectionStatus="disconnected",this.applyTimerState(null);return}const e=new Tce(n,this.profileToParticipant(this.profile),this.background);e.addEventListener("participants-changed",this.onParticipantsChange),e.addEventListener("background-changed",this.onBackgroundChange),e.addEventListener("status-changed",this.onConnectionStatusChange),e.addEventListener("timer-changed",this.onTimerStateChange),e.addEventListener("reveal-changed",this.onRevealStateChange),e.addEventListener("connection-error",this.onControllerError),this.controller=e,this.participants=e.getParticipants(),this.background=e.getBoardBackground(),this.persistBackground(this.background),this.connectionStatus=e.status,this.applyTimerState(e.getTimerState()),this.connectionError=null;const t=this.readRevealState(n),r=e.getRevealState();t&&!r?(this.revealAll=!0,e.setRevealState(!0)):(this.revealAll=r||t,this.persistRevealStateValue(n,this.revealAll)),this.recordRecentBoard(n),this.copyState="idle"}async handleCopyLink(){try{await navigator.clipboard.writeText(window.location.href),this.copyState="copied"}catch{this.copyState="error"}finally{window.setTimeout(()=>this.copyState="idle",2e3)}}initializeProfile(){const n=this.readProfileFromStorage();if(n){this.profile=n,this.profileDraft={...n},this.showProfileDialog=!1,this.ensureProfileId();return}this.profile=null,this.profileDraft={...zp},this.showProfileDialog=!0,this.ensureProfileId()}initializeProfileId(){this.profileId=this.readProfileIdFromStorage(),this.profileId||(this.profileId=El(),this.persistProfileId(this.profileId))}initializeOnboarding(){if(typeof window>"u"){this.showOnboarding=!0;return}try{const n=window.localStorage.getItem(SR);this.showOnboarding=n!=="dismissed"}catch{this.showOnboarding=!0}}readProfileFromStorage(){if(typeof window>"u")return null;try{const n=window.localStorage.getItem(_R);if(!n)return null;const e=JSON.parse(n);return typeof(e==null?void 0:e.name)!="string"||typeof(e==null?void 0:e.color)!="string"?null:{name:e.name,color:e.color}}catch{return null}}persistProfile(n){if(typeof window>"u")return;const e=this.ensureProfileId();this.profileId=e;try{window.localStorage.setItem(_R,JSON.stringify(n)),this.persistProfileId(e)}catch{}}renderProfileDialog(){if(!this.showProfileDialog&&this.profile)return null;const n=this.profileDraft.name.trim().length>0,e=!!this.profile;return or`
            <div class="profile-overlay">
                <form class="profile-card" @submit=${this.handleProfileSubmit}>
                    <header>
                        <p class="eyebrow">Welcome</p>
                        <h2>Set up your marker</h2>
                        <p class="note">
                            Pick a display name and sticky color so teammates
                            know who is who.
                        </p>
                    </header>
                    <label>
                        <span>Name</span>
                        <input
                            type="text"
                            .value=${this.profileDraft.name}
                            @input=${this.handleProfileNameInput}
                            placeholder="e.g. Casey"
                            required
                        />
                    </label>
                    <label>
                        <span>Color</span>
                        <div class="color-row">
                            <input
                                type="color"
                                class="color-picker"
                                .value=${this.profileDraft.color}
                                @input=${this.handleProfileColorInput}
                            />
                            <button
                                type="button"
                                class="ghost"
                                @click=${this.randomizeProfileColor}
                            >
                                Random
                            </button>
                        </div>
                    </label>
                    <div class="profile-actions">
                        ${e?or`<button
                                  type="button"
                                  class="ghost"
                                  @click=${this.closeProfileDialog}
                              >
                                  Cancel
                              </button>`:null}
                        <button
                            class="primary"
                            type="submit"
                            ?disabled=${!n}
                        >
                            ${this.profile?"Save":"Enter board"}
                        </button>
                    </div>
                </form>
            </div>
        `}renderFilterControl(){return this.participants.length?or`
            <label class="filter-control">
                <select
                    @change=${this.handleFilterChange}
                    .value=${this.highlightedParticipantId??""}
                >
                    <option value="">All notes</option>
                    ${this.participants.map(n=>or`<option value=${n.id}>
                                ${n.label}
                            </option>`)}
                </select>
            </label>
        `:null}renderProfilePanel(){if(!this.profile)return null;const n=this.localParticipantId,e=this.participants.filter(t=>t.id!==n);return or`
            <div class="profile-panel">
                <button
                    type="button"
                    class="participant-circle self"
                    style=${`--circle:${this.profile.color}`}
                    @click=${this.openProfileDialog}
                    aria-label="Edit profile"
                    title="Edit profile"
                >
                    ${this.profileInitials}
                </button>
                <div class="participant-stack" role="list">
                    ${e.map(t=>or`
                            <span
                                class="participant-circle peer"
                                role="listitem"
                                style=${`--circle:${t.color}`}
                                title=${t.label}
                            >
                                ${this.participantInitials(t.label)}
                            </span>
                        `)}
                </div>
            </div>
        `}renderOnboarding(){return this.showOnboarding?or`
            <div class="onboarding-card" role="dialog" aria-live="polite">
                <div class="onboarding-header">
                    <p class="eyebrow">Quick guide</p>
                    <button
                        type="button"
                        class="ghost onboarding-dismiss"
                        aria-label="Dismiss onboarding"
                        @click=${this.dismissOnboarding}
                    >
                        
                    </button>
                </div>
                <h3>Welcome to libRetro</h3>
                <ul>
                    <li>Double-click anywhere on the board to drop a sticky.</li>
                    <li>Hold and drag to pan; use the +/- buttons to zoom.</li>
                    <li>Press <strong>Shift + C</strong> to fire one confetti sling.</li>
                </ul>
                <button class="primary" type="button" @click=${this.dismissOnboarding}>
                    Got it
                </button>
            </div>
        `:null}renderStagingArea(){return or`
            <div class="staging">
                <div class="staging-card">
                    ${this.connectionError?or`<div class="staging-error">
                              ${this.connectionError}
                          </div>`:null}
                    <div class="staging-header">
                        <h2>Pick a session</h2>
                        <p>
                            Create a fresh retro or jump back into one of your
                            recent boards.
                        </p>
                    </div>
                    <button
                        class="primary"
                        type="button"
                        @click=${this.startFreshBoard}
                    >
                        Start a new board
                    </button>
                    <form class="join-form" @submit=${this.handleJoinBoard}>
                        <label>
                            <span>Join by ID</span>
                            <div class="join-row">
                                <input
                                    type="text"
                                    placeholder="Enter board ID or URL"
                                    .value=${this.joinBoardInput}
                                    @input=${this.handleJoinInput}
                                />
                                <button type="submit" class="ghost">
                                    Join
                                </button>
                            </div>
                        </label>
                    </form>
                    ${this.recentBoards.length?or`
                              <div class="recent-list">
                                  <p>Recent boards</p>
                                  <div class="recent-grid">
                                      ${this.recentBoards.map(n=>or`
                                              <button
                                                  type="button"
                                                  class="recent-pill"
                                                  @click=${()=>this.navigateToBoard(n)}
                                              >
                                                  <span class="pill-title">
                                                      ${n.slice(0,6).toUpperCase()}
                                                  </span>
                                                  <span class="pill-sub">
                                                      ${n}
                                                  </span>
                                              </button>
                                          `)}
                                  </div>
                              </div>
                          `:null}
                </div>
            </div>
        `}renderTimerControl(){return or`
            <div class="timer-control">
                <button
                    type="button"
                    class="ghost timer-add"
                    @click=${this.addTimerMinute}
                >
                    +
                </button>
                <span class="timer-display" aria-live="polite">
                    ${this.formattedTimer}
                </span>
                <button
                    type="button"
                    class="ghost"
                    @click=${this.toggleTimer}
                    ?disabled=${!this.canStartTimer}
                    aria-label=${this.timerRunning?"Pause timer":"Start timer"}
                >
                    ${this.timerRunning?"":""}
                </button>
                <button
                    type="button"
                    class="ghost"
                    ?disabled=${!this.canResetTimer}
                    @click=${this.resetTimer}
                    aria-label="Reset timer"
                >
                    
                </button>
            </div>
        `}renderConnectionStatus(){return this.connectionStatus==="connected"?null:or`
            <span
                class=${`connection-status ${this.connectionStatus}`}
                aria-live="polite"
            >
                ${this.connectionStatusLabel}
            </span>
        `}renderBackgroundControl(){return or`
            <label class="filter-control">
                <select
                    @change=${this.handleBackgroundChange}
                    .value=${this.background}
                >
                    ${NE.map(n=>or`<option value=${n.id}>
                                ${n.label}
                            </option>`)}
                </select>
            </label>
        `}startTimer(){if(this.timerRunning)return;const n=this.currentTimerRemaining;n<=0||this.pushTimerState(this.createTimerState(!0,n))}pauseTimer(){if(!this.timerRunning)return;const n=this.currentTimerRemaining;this.pushTimerState(this.createTimerState(!1,n))}clearTimerInterval(){this.timerInterval!==null&&(clearInterval(this.timerInterval),this.timerInterval=null)}pushTimerState(n){this.applyTimerState(n),this.controller?(this.pendingTimerBroadcastKey=this.timerStateKey(n),this.controller.updateTimerState(n)):this.pendingTimerBroadcastKey=null}applyTimerState(n){const e=this.timerRunning;if(this.clearTimerInterval(),!n){this.timerRunning=!1,this.timerRemainingMs=0,this.timerDeadline=null,this.pendingTimerBroadcastKey=null;return}this.timerRunning=n.running,n.running&&n.deadline?(this.timerDeadline=n.deadline,this.tickTimerFromDeadline(),typeof window<"u"&&(this.timerInterval=window.setInterval(()=>this.tickTimerFromDeadline(),250))):(this.timerDeadline=null,this.timerRemainingMs=n.remainingMs,e&&n.remainingMs===0&&this.playTimerAlarm())}tickTimerFromDeadline(){if(!this.timerDeadline)return;const n=Math.max(0,this.timerDeadline-Date.now());this.timerRemainingMs=n,n===0&&this.pushTimerState(this.createTimerState(!1,0))}createTimerState(n,e){const t=Math.max(0,Math.round(e)),r=Date.now();return{running:n,remainingMs:t,deadline:n?r+t:null,updatedAt:r}}get currentTimerRemaining(){return this.timerRunning&&this.timerDeadline?Math.max(0,this.timerDeadline-Date.now()):this.timerRemainingMs}timerStateKey(n){return`${n.updatedAt}:${n.running?1:0}:${n.remainingMs}:${n.deadline??0}`}detachControllerListeners(){var n,e,t,r,i,s;(n=this.controller)==null||n.removeEventListener("participants-changed",this.onParticipantsChange),(e=this.controller)==null||e.removeEventListener("background-changed",this.onBackgroundChange),(t=this.controller)==null||t.removeEventListener("status-changed",this.onConnectionStatusChange),(r=this.controller)==null||r.removeEventListener("timer-changed",this.onTimerStateChange),(i=this.controller)==null||i.removeEventListener("connection-error",this.onControllerError),(s=this.controller)==null||s.removeEventListener("reveal-changed",this.onRevealStateChange)}playTimerAlarm(){if(typeof window>"u")return;const n=window.AudioContext||window.webkitAudioContext;if(n)try{this.audioContext??(this.audioContext=new n);const e=this.audioContext;e.state==="suspended"&&e.resume();const t=e.currentTime,r=.35,i=.12;for(let s=0;s<3;s++){const o=t+s*(r+i),a=e.createOscillator();a.type="square",a.frequency.setValueAtTime(950+s*20,o);const l=e.createOscillator();l.type="sine",l.frequency.setValueAtTime(5,o);const c=e.createGain();c.gain.value=18,l.connect(c).connect(a.frequency);const h=e.createBiquadFilter();h.type="lowpass",h.frequency.setValueAtTime(1800,o),h.Q.value=.8;const d=e.createGain();d.gain.setValueAtTime(1e-4,o),d.gain.exponentialRampToValueAtTime(.6,o+.02),d.gain.exponentialRampToValueAtTime(.001,o+r);const p=e.createDelay();p.delayTime.value=.18;const g=e.createGain();g.gain.value=.25,p.connect(g).connect(e.destination),a.connect(h),h.connect(d).connect(e.destination),h.connect(p),a.start(o),a.stop(o+r+.4),l.start(o),l.stop(o+r+.4)}}catch{}}get canStartTimer(){return this.timerRunning||this.timerRemainingMs>0}get canResetTimer(){return this.timerRunning||this.timerRemainingMs>0}get formattedTimer(){const n=Math.ceil(this.timerRemainingMs/1e3),e=Math.floor(n/3600),t=Math.floor(n%3600/60),r=n%60,i=s=>s.toString().padStart(2,"0");return e>0?`${e}:${i(t)}:${i(r)}`:`${i(t)}:${i(r)}`}get connectionStatusLabel(){switch(this.connectionStatus){case"connected":return"Connected";case"disconnected":return"Disconnected";default:return"Connecting"}}get isReadyForConfetti(){return!!(this.boardId&&this.controller&&this.profile)}get localParticipantId(){var n,e;return((e=(n=this.controller)==null?void 0:n.getLocalParticipant())==null?void 0:e.id)??null}get profileInitials(){var t,r;const n=(r=(t=this.profile)==null?void 0:t.name)==null?void 0:r.trim();return n?(n.split(/\s+/).filter(Boolean).slice(0,2).map(i=>i[0]).join("")||n.slice(0,2)).toUpperCase():"YOU"}participantInitials(n){const e=n==null?void 0:n.trim();return e?(e.split(/\s+/).filter(Boolean).slice(0,2).map(r=>r[0]).join("")||e.slice(0,2)).toUpperCase():"?"}isShortcutEvent(n){var i;if(!n.shiftKey||n.key.toLowerCase()!=="c")return!1;const e=n.target;if(!e)return!0;const t=e.tagName;return!(((i=e.getAttribute("contenteditable"))==null?void 0:i.toLowerCase())==="true"||t==="INPUT"||t==="TEXTAREA"||t==="SELECT")}profileToParticipant(n){return{label:n.name,color:n.color,ownerKey:this.ensureProfileId()}}initializeBackground(){const n=this.readBackgroundFromStorage();this.background=n??"start-stop-continue"}readBackgroundFromStorage(){if(typeof window>"u")return null;const n=window.localStorage.getItem(ER);return n&&NE.some(e=>e.id===n)?n:null}persistBackground(n){typeof window>"u"||window.localStorage.setItem(ER,n)}initializeRecentBoards(){if(typeof window>"u"){this.recentBoards=[];return}try{const n=window.localStorage.getItem(AR);if(!n){this.recentBoards=[];return}const e=JSON.parse(n);Array.isArray(e)?this.recentBoards=e.filter(t=>typeof t=="string").slice(0,8):this.recentBoards=[]}catch{this.recentBoards=[]}}persistRecentBoards(n){if(!(typeof window>"u"))try{window.localStorage.setItem(AR,JSON.stringify(n))}catch{}}recordRecentBoard(n){const e=n.trim();if(!e)return;const t=[e,...this.recentBoards.filter(r=>r!==e)].slice(0,8);this.recentBoards=t,this.persistRecentBoards(t)}readProfileIdFromStorage(){if(typeof window>"u")return null;try{return window.localStorage.getItem(xR)??null}catch{return null}}persistProfileId(n){if(!(typeof window>"u"))try{window.localStorage.setItem(xR,n)}catch{}}ensureProfileId(){if(this.profileId)return this.profileId;const n=this.readProfileIdFromStorage();if(n)return this.profileId=n,n;const e=El();return this.profileId=e,this.persistProfileId(e),e}revealStorageKey(n){return`${qce}${n}`}readRevealState(n){if(typeof window>"u")return!1;try{return window.localStorage.getItem(this.revealStorageKey(n))==="revealed"}catch{return!1}}persistRevealStateValue(n,e){if(!(typeof window>"u"))try{const t=this.revealStorageKey(n);e?window.localStorage.setItem(t,"revealed"):window.localStorage.removeItem(t)}catch{}}};Tr.styles=by`
        :host {
            display: block;
            font-family:
                "Inter",
                system-ui,
                -apple-system,
                BlinkMacSystemFont,
                sans-serif;
            color: #0f172a;
        }

        retro-board {
            position: fixed;
            inset: 0;
            z-index: 0;
        }

        .ui-overlay {
            position: fixed;
            inset: 0;
            z-index: 2;
            pointer-events: none;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            justify-content: flex-start;
        }

        .loading {
            margin-top: 20vh;
            font-size: 1.125rem;
            background: rgba(255, 255, 255, 0.85);
            padding: 1rem 1.5rem;
            border-radius: 16px;
            display: inline-block;
            pointer-events: auto;
        }

        .staging {
            margin-top: 10vh;
            display: flex;
            justify-content: center;
            pointer-events: auto;
        }

        .staging-card {
            width: min(520px, 100%);
            background: rgba(255, 255, 255, 0.98);
            border-radius: 18px;
            border: 1px solid rgba(15, 23, 42, 0.08);
            padding: 1.75rem;
            box-shadow: 0 18px 50px rgba(15, 23, 42, 0.15);
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .staging-error {
            border-radius: 12px;
            border: 1px solid rgba(248, 113, 113, 0.4);
            background: rgba(254, 226, 226, 0.7);
            color: #b91c1c;
            padding: 0.75rem 1rem;
            font-size: 0.9rem;
        }

        .staging-header h2 {
            margin: 0;
        }

        .staging-header p {
            margin: 0.25rem 0 0;
            color: #475569;
        }

        .join-form label {
            display: flex;
            flex-direction: column;
            gap: 0.35rem;
            font-size: 0.85rem;
            color: #475569;
        }

        .join-row {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .join-row input {
            flex: 1;
            min-width: 0;
            border-radius: 8px;
            border: 1px solid rgba(148, 163, 184, 0.6);
            padding: 0.5rem 0.75rem;
            font-size: 0.95rem;
        }

        .recent-list {
            margin-top: 0.5rem;
        }

        .recent-list p {
            margin: 0 0 0.5rem;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: #94a3b8;
        }

        .recent-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .recent-pill {
            border-radius: 12px;
            border: 1px solid rgba(148, 163, 184, 0.4);
            padding: 0.5rem 0.85rem;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            background: #ffffff;
            cursor: pointer;
        }

        .pill-title {
            font-weight: 600;
            font-size: 0.9rem;
        }

        .pill-sub {
            font-size: 0.7rem;
            color: #94a3b8;
        }

        .toolbar {
            pointer-events: auto;
            display: flex;
            align-items: center;
            gap: 1.5rem;
            padding: 0.85rem 1.25rem;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.98);
            border: 1px solid rgba(15, 23, 42, 0.08);
            box-shadow: 0 8px 24px rgba(15, 23, 42, 0.08);
            width: min(100%, 960px);
        }

        .toolbar-brand {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            min-width: 0;
        }

        .logo-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: linear-gradient(120deg, #0ea5e9, #6366f1);
        }

        .brand-text {
            display: flex;
            flex-direction: column;
            line-height: 1.2;
        }

        .title {
            margin: 0;
            font-size: 1rem;
            font-weight: 600;
            color: #111827;
        }

        .meta {
            margin: 0;
            font-size: 0.8rem;
            color: #6b7280;
        }

        .toolbar-controls {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            flex: 1;
            justify-content: flex-end;
            flex-wrap: wrap;
        }

        .timer-control {
            display: inline-flex;
            align-items: center;
            gap: 0.4rem;
            padding: 0.35rem 0.75rem;
            border-radius: 10px;
            background: rgba(15, 23, 42, 0.05);
            border: 1px solid rgba(15, 23, 42, 0.06);
            font-size: 0.9rem;
            flex-wrap: wrap;
            font-family:
                "JetBrains Mono",
                "SFMono-Regular",
                Menlo,
                Consolas,
                monospace;
        }

        .connection-status {
            display: inline-flex;
            align-items: center;
            gap: 0.35rem;
            font-size: 0.8rem;
            padding: 0.25rem 0.6rem;
            border-radius: 999px;
            background: rgba(15, 23, 42, 0.06);
            color: #0f172a;
            font-weight: 500;
        }

        .connection-status.connecting::before,
        .connection-status.disconnected::before,
        .connection-status.connected::before {
            content: "";
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: currentColor;
            display: inline-block;
        }

        .connection-status.connecting {
            color: #f97316;
        }

        .connection-status.disconnected {
            color: #ef4444;
        }

        .connection-status.connected {
            color: #22c55e;
        }

        .timer-display {
            font-weight: 600;
            font-variant-numeric: tabular-nums;
            min-width: 60px;
            text-align: center;
        }

        .timer-add {
            font-size: 1.1rem;
            line-height: 1;
            padding: 0.3rem 0.75rem;
        }

        .timer-control button {
            padding: 0.3rem 0.75rem;
        }

        .timer-control button[disabled] {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .toolbar-actions {
            display: flex;
            gap: 0.45rem;
            align-items: center;
        }

        .filter-control {
            display: flex;
            flex-direction: column;
            gap: 0.2rem;
            font-size: 0.75rem;
            color: #64748b;
        }

        .filter-control span {
            text-transform: uppercase;
            letter-spacing: 0.08em;
            font-size: 0.7rem;
            color: #94a3b8;
        }

        .filter-control select {
            border-radius: 8px;
            border: 1px solid rgba(148, 163, 184, 0.6);
            padding: 0.35rem 0.9rem;
            font-size: 0.85rem;
            background: #ffffff;
        }

        .eyebrow {
            font-size: 0.75rem;
            letter-spacing: 0.12em;
            text-transform: uppercase;
            margin: 0;
            color: #94a3b8;
        }

        button {
            border-radius: 8px;
            padding: 0.45rem 1.1rem;
            font-size: 0.9rem;
            cursor: pointer;
            transition:
                background 120ms ease,
                color 120ms ease;
            pointer-events: auto;
            border: 1px solid transparent;
        }

        .primary {
            background: #111827;
            color: #f8fafc;
            border-color: #111827;
        }

        .ghost {
            background: #ffffff;
            color: #111827;
            border-color: rgba(15, 23, 42, 0.15);
        }

        .profile-panel {
            position: absolute;
            top: 1.5rem;
            right: 1.5rem;
            pointer-events: auto;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            align-items: center;
        }

        .participant-stack {
            display: flex;
            flex-direction: column;
            gap: 0.35rem;
            align-items: center;
        }

        .onboarding-card {
            position: absolute;
            top: 1.5rem;
            left: 1.5rem;
            width: min(280px, 90vw);
            background: rgba(255, 255, 255, 0.98);
            border-radius: 16px;
            border: 1px solid rgba(15, 23, 42, 0.08);
            box-shadow: 0 20px 45px rgba(15, 23, 42, 0.15);
            padding: 1rem 1.25rem;
            display: flex;
            flex-direction: column;
            gap: 0.65rem;
        }

        .onboarding-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 0.5rem;
        }

        .onboarding-card h3 {
            margin: 0;
            font-size: 1.1rem;
        }

        .onboarding-card ul {
            margin: 0;
            padding-left: 1.1rem;
            color: #475569;
            font-size: 0.9rem;
            display: flex;
            flex-direction: column;
            gap: 0.35rem;
        }

        .onboarding-card strong {
            font-weight: 600;
            color: #0f172a;
        }

        .onboarding-dismiss {
            width: 28px;
            height: 28px;
            padding: 0;
            display: grid;
            place-items: center;
            font-size: 1.1rem;
            border-radius: 50%;
        }

        .participant-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--circle, #94a3b8);
            color: #0f172a;
            font-weight: 600;
            text-transform: uppercase;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border: 1px solid rgba(15, 23, 42, 0.18);
            box-shadow: 0 6px 12px rgba(15, 23, 42, 0.12);
        }

        .participant-circle.self {
            width: 48px;
            height: 48px;
            cursor: pointer;
        }

        .profile-overlay {
            position: fixed;
            inset: 0;
            background: rgba(15, 23, 42, 0.3);
            display: grid;
            place-items: center;
            pointer-events: auto;
            padding: 1.5rem;
        }

        .profile-card {
            width: min(420px, 100%);
            background: #ffffff;
            border-radius: 16px;
            padding: 1.75rem;
            box-shadow: 0 25px 60px rgba(15, 23, 42, 0.15);
            border: 1px solid rgba(15, 23, 42, 0.08);
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .profile-card header {
            margin-bottom: 0.5rem;
        }

        .profile-card h2 {
            margin: 0.15rem 0 0.25rem;
            font-size: 1.4rem;
        }

        .profile-card .note {
            margin: 0;
            color: #64748b;
            font-size: 0.9rem;
        }

        label {
            display: flex;
            flex-direction: column;
            gap: 0.4rem;
            font-size: 0.9rem;
            color: #475569;
        }

        input[type="text"] {
            border-radius: 8px;
            border: 1px solid rgba(148, 163, 184, 0.6);
            padding: 0.65rem 0.9rem;
            font-size: 1rem;
        }

        .color-row {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            flex-wrap: wrap;
        }

        .color-picker {
            width: 52px;
            height: 44px;
            padding: 0;
            border: 1px solid rgba(148, 163, 184, 0.6);
            border-radius: 10px;
            background: #ffffff;
            cursor: pointer;
        }

        .color-picker::-webkit-color-swatch-wrapper {
            padding: 0;
            border-radius: 8px;
        }

        .color-picker::-webkit-color-swatch {
            border: none;
            border-radius: 8px;
        }

        .profile-actions {
            display: flex;
            justify-content: flex-end;
            gap: 0.5rem;
        }

        .profile-actions .primary[disabled] {
            opacity: 0.4;
            cursor: not-allowed;
        }

        @media (max-width: 768px) {
            .ui-overlay {
                padding: 1rem;
            }

            .toolbar {
                flex-direction: column;
                align-items: stretch;
                gap: 0.85rem;
            }

            .toolbar-controls {
                width: 100%;
                justify-content: flex-start;
            }

            .toolbar-actions {
                width: 100%;
                justify-content: flex-start;
                flex-wrap: wrap;
            }

            .profile-card {
                padding: 1.25rem;
            }

            .staging {
                margin-top: 4vh;
            }

            .staging-card {
                padding: 1.25rem;
            }

            .join-row {
                flex-direction: column;
            }
        }
    `;Mr([Vt()],Tr.prototype,"boardId",2);Mr([Vt()],Tr.prototype,"controller",2);Mr([Vt()],Tr.prototype,"copyState",2);Mr([Vt()],Tr.prototype,"profile",2);Mr([Vt()],Tr.prototype,"profileDraft",2);Mr([Vt()],Tr.prototype,"showProfileDialog",2);Mr([Vt()],Tr.prototype,"participants",2);Mr([Vt()],Tr.prototype,"highlightedParticipantId",2);Mr([Vt()],Tr.prototype,"background",2);Mr([Vt()],Tr.prototype,"confettiEnabled",2);Mr([Vt()],Tr.prototype,"showOnboarding",2);Mr([Vt()],Tr.prototype,"timerRemainingMs",2);Mr([Vt()],Tr.prototype,"timerRunning",2);Mr([Vt()],Tr.prototype,"connectionStatus",2);Mr([Vt()],Tr.prototype,"showStaging",2);Mr([Vt()],Tr.prototype,"recentBoards",2);Mr([Vt()],Tr.prototype,"joinBoardInput",2);Mr([Vt()],Tr.prototype,"connectionError",2);Mr([Vt()],Tr.prototype,"revealAll",2);Mr([Vt()],Tr.prototype,"profileId",2);Tr=Mr([vy("app-root")],Tr);
